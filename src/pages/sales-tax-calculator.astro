---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Sales Tax Calculator - Calculate Tax on Purchases 2026";
const description = "Free sales tax calculator. Find sales tax amount and total price. Reverse sales tax calculation. US state tax rates included.";

const relatedCalcs = [
  { name: "Tip Calculator", url: "/tip-calculator", description: "Restaurant tip calculator." },
  { name: "Income Tax Calculator", url: "/income-tax-calculator", description: "Federal & state taxes." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Calculate percentages." },
  { name: "Salary Calculator", url: "/salary-calculator", description: "Salary converter." },
  { name: "Paycheck Calculator", url: "/paycheck-calculator", description: "Take-home pay." },
  { name: "Mortgage Calculator", url: "/mortgage-calculator", description: "Home loan payments." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Sales Tax Calculator"
  keywords="sales tax calculator, tax calculator, sales tax rate, reverse sales tax, state tax rate, purchase tax"
  breadcrumbs={[{ name: "Sales Tax Calculator", url: "/sales-tax-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Sales Tax Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate sales tax, total price, or find the pre-tax price from a total amount.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Mode Tabs -->
      <div class="flex gap-2 mb-6">
        <button class="stax-mode-btn px-4 py-2 rounded-full text-sm font-semibold bg-primary text-white" data-mode="forward">Calculate Tax</button>
        <button class="stax-mode-btn px-4 py-2 rounded-full text-sm font-semibold bg-surface-alt text-text-secondary" data-mode="reverse">Reverse (from Total)</button>
      </div>

      <!-- Forward Mode -->
      <div id="stax-forward">
        <div class="mb-5">
          <label class="block text-sm font-medium text-text mb-1">Price Before Tax</label>
          <div class="relative">
            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-text-muted font-bold">$</span>
            <input type="number" id="stax-price" class="w-full pl-8 pr-4 py-3 border border-border rounded-xl text-2xl font-bold" value="100" min="0" step="0.01">
          </div>
        </div>
      </div>

      <!-- Reverse Mode -->
      <div id="stax-reverse" class="hidden">
        <div class="mb-5">
          <label class="block text-sm font-medium text-text mb-1">Total Price (Tax Included)</label>
          <div class="relative">
            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-text-muted font-bold">$</span>
            <input type="number" id="stax-total-input" class="w-full pl-8 pr-4 py-3 border border-border rounded-xl text-2xl font-bold" value="107" min="0" step="0.01">
          </div>
        </div>
      </div>

      <!-- Tax Rate -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-text mb-1">Tax Rate (%)</label>
        <div class="flex items-center gap-3">
          <input type="range" id="stax-rate-slider" min="0" max="15" step="0.125" value="7" class="flex-1">
          <input type="number" id="stax-rate-input" class="w-24 px-3 py-2 border border-border rounded-lg text-center font-bold" value="7" min="0" max="30" step="0.125">
          <span class="text-text-muted font-bold">%</span>
        </div>
      </div>

      <!-- Quick State Rates -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-text mb-2">Quick State Rates</label>
        <div class="flex flex-wrap gap-1.5">
          <button class="stax-state px-2.5 py-1 bg-surface-alt rounded-lg text-xs font-medium hover:bg-primary/10" data-rate="0">OR 0%</button>
          <button class="stax-state px-2.5 py-1 bg-surface-alt rounded-lg text-xs font-medium hover:bg-primary/10" data-rate="4">CO 4%</button>
          <button class="stax-state px-2.5 py-1 bg-surface-alt rounded-lg text-xs font-medium hover:bg-primary/10" data-rate="6">PA 6%</button>
          <button class="stax-state px-2.5 py-1 bg-surface-alt rounded-lg text-xs font-medium hover:bg-primary/10" data-rate="6.25">TX 6.25%</button>
          <button class="stax-state px-2.5 py-1 bg-surface-alt rounded-lg text-xs font-medium hover:bg-primary/10" data-rate="6.5">FL 6%</button>
          <button class="stax-state px-2.5 py-1 bg-surface-alt rounded-lg text-xs font-medium hover:bg-primary/10" data-rate="7.25">CA 7.25%</button>
          <button class="stax-state px-2.5 py-1 bg-surface-alt rounded-lg text-xs font-medium hover:bg-primary/10" data-rate="8">NY 8%</button>
          <button class="stax-state px-2.5 py-1 bg-surface-alt rounded-lg text-xs font-medium hover:bg-primary/10" data-rate="9.5">TN 9.5%</button>
        </div>
      </div>

      <!-- Results -->
      <div class="space-y-3 mb-6">
        <div class="flex justify-between items-center p-4 bg-surface-alt rounded-xl">
          <span class="text-text-secondary">Pre-Tax Price</span>
          <span class="text-xl font-bold" id="stax-pretax">$100.00</span>
        </div>
        <div class="flex justify-between items-center p-4 bg-surface-alt rounded-xl">
          <span class="text-text-secondary">Sales Tax</span>
          <span class="text-xl font-bold text-danger" id="stax-tax">$7.00</span>
        </div>
        <div class="flex justify-between items-center p-4 bg-primary rounded-xl text-white">
          <span class="text-blue-200">Total Price</span>
          <span class="text-2xl font-bold" id="stax-total">$107.00</span>
        </div>
      </div>

      <!-- Multi-item Calculator -->
      <div class="border-t border-border pt-6 mt-6">
        <h3 class="font-semibold text-text mb-3">Quick Multi-Item Tax</h3>
        <div class="space-y-2" id="stax-items">
          <div class="flex gap-2 stax-item">
            <input type="text" class="flex-1 px-3 py-2 border border-border rounded-lg text-sm stax-item-name" placeholder="Item name">
            <input type="number" class="w-28 px-3 py-2 border border-border rounded-lg text-sm text-right stax-item-price" placeholder="Price" value="0" min="0" step="0.01">
          </div>
        </div>
        <button id="stax-add-item" class="mt-2 px-3 py-1.5 bg-surface-alt rounded-lg text-sm font-medium hover:bg-primary/10 transition-colors">+ Add Item</button>
        <div class="mt-3 flex justify-between font-semibold">
          <span>Items Total + Tax:</span>
          <span id="stax-items-total">$0.00</span>
        </div>
      </div>

      <div class="mt-6">
        <ShareButton calculatorId="sales-tax" />
        <FeedbackWidget />
      </div>
    </div>

    <!-- State Tax Table -->
    <div class="mt-12 bg-white border border-border rounded-2xl p-6 sm:p-8">
      <h2 class="text-2xl font-bold text-text mb-4">US State Sales Tax Rates (2026)</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-border text-left">
              <th class="py-2 pr-3 font-semibold">State</th>
              <th class="py-2 pr-3 font-semibold">Rate</th>
              <th class="py-2 pr-3 font-semibold">State</th>
              <th class="py-2 font-semibold">Rate</th>
            </tr>
          </thead>
          <tbody class="text-text-secondary">
            <tr class="border-b border-border/30"><td class="py-1.5 pr-3">Alabama</td><td class="py-1.5 pr-3">4%</td><td class="py-1.5 pr-3">Montana</td><td class="py-1.5 font-semibold text-secondary">0%</td></tr>
            <tr class="border-b border-border/30"><td class="py-1.5 pr-3">Alaska</td><td class="py-1.5 pr-3 font-semibold text-secondary">0%</td><td class="py-1.5 pr-3">Nebraska</td><td class="py-1.5">5.5%</td></tr>
            <tr class="border-b border-border/30"><td class="py-1.5 pr-3">Arizona</td><td class="py-1.5 pr-3">5.6%</td><td class="py-1.5 pr-3">Nevada</td><td class="py-1.5">6.85%</td></tr>
            <tr class="border-b border-border/30"><td class="py-1.5 pr-3">California</td><td class="py-1.5 pr-3 font-semibold text-danger">7.25%</td><td class="py-1.5 pr-3">New Hampshire</td><td class="py-1.5 font-semibold text-secondary">0%</td></tr>
            <tr class="border-b border-border/30"><td class="py-1.5 pr-3">Colorado</td><td class="py-1.5 pr-3">2.9%</td><td class="py-1.5 pr-3">New York</td><td class="py-1.5">4%</td></tr>
            <tr class="border-b border-border/30"><td class="py-1.5 pr-3">Delaware</td><td class="py-1.5 pr-3 font-semibold text-secondary">0%</td><td class="py-1.5 pr-3">Oregon</td><td class="py-1.5 font-semibold text-secondary">0%</td></tr>
            <tr class="border-b border-border/30"><td class="py-1.5 pr-3">Florida</td><td class="py-1.5 pr-3">6%</td><td class="py-1.5 pr-3">Pennsylvania</td><td class="py-1.5">6%</td></tr>
            <tr class="border-b border-border/30"><td class="py-1.5 pr-3">Illinois</td><td class="py-1.5 pr-3">6.25%</td><td class="py-1.5 pr-3">Tennessee</td><td class="py-1.5 font-semibold text-danger">7%</td></tr>
            <tr><td class="py-1.5 pr-3">Indiana</td><td class="py-1.5 pr-3">7%</td><td class="py-1.5 pr-3">Texas</td><td class="py-1.5">6.25%</td></tr>
          </tbody>
        </table>
      </div>
      <p class="text-xs text-text-muted mt-3">Note: Rates shown are state-level only. Local taxes may apply. 5 states have no sales tax: Alaska, Delaware, Montana, New Hampshire, Oregon.</p>
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Sales Tax Works</h2>
      <p>Sales tax is a consumption tax charged on the sale of goods and services. In the US, sales tax rates vary by state and locality. The tax is calculated as a percentage of the purchase price.</p>

      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">
        Tax Amount = Price × Tax Rate / 100<br>
        Total = Price + Tax Amount
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Reverse Sales Tax</h3>
      <p>To find the pre-tax price from a total that includes tax:</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">
        Pre-Tax Price = Total / (1 + Tax Rate / 100)
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>Which states have no sales tax?</strong> Five US states have no state sales tax: Alaska, Delaware, Montana, New Hampshire, and Oregon.</p>
      <p><strong>What's the highest sales tax?</strong> Tennessee and Louisiana have the highest combined state and local rates, often exceeding 9.5%.</p>
      <p><strong>Is sales tax applied to online purchases?</strong> Yes, since the 2018 South Dakota v. Wayfair Supreme Court decision, states can require online retailers to collect sales tax.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let staxMode = 'forward';
    const fmtMoney = (n: number) => '$' + n.toFixed(2);

    function getRate(): number {
      return parseFloat((document.getElementById('stax-rate-input') as HTMLInputElement).value) || 0;
    }

    function calcSalesTax() {
      const rate = getRate();

      if (staxMode === 'forward') {
        const price = parseFloat((document.getElementById('stax-price') as HTMLInputElement).value) || 0;
        const tax = price * rate / 100;
        const total = price + tax;
        document.getElementById('stax-pretax')!.textContent = fmtMoney(price);
        document.getElementById('stax-tax')!.textContent = fmtMoney(tax);
        document.getElementById('stax-total')!.textContent = fmtMoney(total);
      } else {
        const total = parseFloat((document.getElementById('stax-total-input') as HTMLInputElement).value) || 0;
        const price = total / (1 + rate / 100);
        const tax = total - price;
        document.getElementById('stax-pretax')!.textContent = fmtMoney(price);
        document.getElementById('stax-tax')!.textContent = fmtMoney(tax);
        document.getElementById('stax-total')!.textContent = fmtMoney(total);
      }

      calcItems();
      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    function calcItems() {
      const rate = getRate();
      let itemsTotal = 0;
      document.querySelectorAll('.stax-item-price').forEach(el => {
        itemsTotal += parseFloat((el as HTMLInputElement).value) || 0;
      });
      const withTax = itemsTotal * (1 + rate / 100);
      document.getElementById('stax-items-total')!.textContent = fmtMoney(withTax);
    }

    function setRate(val: number) {
      (document.getElementById('stax-rate-slider') as HTMLInputElement).value = String(val);
      (document.getElementById('stax-rate-input') as HTMLInputElement).value = String(val);
      calcSalesTax();
    }

    setTimeout(() => {
      // Mode toggle
      document.querySelectorAll('.stax-mode-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.stax-mode-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-surface-alt', 'text-text-secondary');
          });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary');
          btn.classList.add('bg-primary', 'text-white');
          staxMode = (btn as HTMLElement).dataset.mode || 'forward';
          document.getElementById('stax-forward')!.classList.toggle('hidden', staxMode !== 'forward');
          document.getElementById('stax-reverse')!.classList.toggle('hidden', staxMode !== 'reverse');
          calcSalesTax();
        });
      });

      // Rate controls
      document.getElementById('stax-rate-slider')!.addEventListener('input', (e) => {
        (document.getElementById('stax-rate-input') as HTMLInputElement).value = (e.target as HTMLInputElement).value;
        calcSalesTax();
      });
      document.getElementById('stax-rate-input')!.addEventListener('input', (e) => {
        (document.getElementById('stax-rate-slider') as HTMLInputElement).value = (e.target as HTMLInputElement).value;
        calcSalesTax();
      });

      // State buttons
      document.querySelectorAll('.stax-state').forEach(btn => {
        btn.addEventListener('click', () => setRate(parseFloat((btn as HTMLElement).dataset.rate || '0')));
      });

      // Price inputs
      document.getElementById('stax-price')!.addEventListener('input', calcSalesTax);
      document.getElementById('stax-total-input')!.addEventListener('input', calcSalesTax);

      // Add item
      document.getElementById('stax-add-item')!.addEventListener('click', () => {
        const container = document.getElementById('stax-items')!;
        const div = document.createElement('div');
        div.className = 'flex gap-2 stax-item';
        div.innerHTML = `<input type="text" class="flex-1 px-3 py-2 border border-border rounded-lg text-sm stax-item-name" placeholder="Item name">
          <input type="number" class="w-28 px-3 py-2 border border-border rounded-lg text-sm text-right stax-item-price" placeholder="Price" value="0" min="0" step="0.01">
          <button class="text-text-muted hover:text-danger stax-remove-item">×</button>`;
        container.appendChild(div);
        div.querySelector('.stax-item-price')!.addEventListener('input', calcItems);
        div.querySelector('.stax-remove-item')!.addEventListener('click', () => { div.remove(); calcItems(); });
      });

      calcSalesTax();
    }, 50);
  </script>
</CalculatorLayout>
