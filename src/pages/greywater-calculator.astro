---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Greywater Calculator - Reuse Volume & Irrigation Area";
const description = "Calculate greywater volume from household fixtures, reuse potential, storage tank size, and irrigation area coverage for water conservation.";
const relatedCalcs = [
  { name: "Water Usage", url: "/water-usage-calculator", description: "Daily water consumption." },
  { name: "Irrigation", url: "/irrigation-calculator", description: "Irrigation system design." },
  { name: "Rain Harvest", url: "/rain-harvest-calculator", description: "Rainwater collection." },
  { name: "Sprinkler", url: "/sprinkler-calculator", description: "Sprinkler system sizing." },
  { name: "Pool Volume", url: "/pool-volume-calculator", description: "Water volume calculation." },
  { name: "Drainage", url: "/drainage-calculator", description: "Drainage system design." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Greywater Calculator" keywords="greywater calculator, grey water reuse, irrigation area, storage tank, water conservation" breadcrumbs={[{ name: "Greywater", url: "/greywater-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Greywater Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate how much greywater your home produces and how much irrigation area it can support.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Number of People</label>
          <input type="number" id="gw2-people" class="gw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" min="1" max="20" step="1">
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Greywater Sources (check to include)</h3>
          <div class="space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" id="gw2-shower" class="gw2-in" checked> Showers/Baths (avg 15 gal/person/day)</label>
            <label class="flex items-center gap-2"><input type="checkbox" id="gw2-lav" class="gw2-in" checked> Bathroom Sinks (avg 5 gal/person/day)</label>
            <label class="flex items-center gap-2"><input type="checkbox" id="gw2-laundry" class="gw2-in" checked> Laundry (avg 15 gal/load, 1 load/2 days)</label>
            <label class="flex items-center gap-2"><input type="checkbox" id="gw2-kitchen" class="gw2-in"> Kitchen Sink (avg 5 gal/person/day - not always allowed)</label>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Climate Zone</label>
            <select id="gw2-climate" class="gw2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="arid">Arid/Desert</option>
              <option value="semi" selected>Semi-Arid</option>
              <option value="moderate">Moderate</option>
              <option value="humid">Humid</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Soil Type</label>
            <select id="gw2-soil" class="gw2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="sand">Sandy</option>
              <option value="loam" selected>Loam</option>
              <option value="clay">Clay</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Daily Greywater Volume</div>
          <div class="text-4xl font-extrabold" id="gw2-daily">0 gallons/day</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Weekly Volume</div><div class="text-xl font-bold" id="gw2-weekly">0 gal</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Annual Volume</div><div class="text-xl font-bold" id="gw2-annual">0 gal</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Irrigation Area</div><div class="text-xl font-bold" id="gw2-area">0 sq ft</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Storage Tank Size</div><div class="text-xl font-bold" id="gw2-tank">0 gal</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Savings Estimate</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between"><span>Water Bill Savings (annual)</span><span class="font-bold" id="gw2-savings">$0</span></div>
            <div class="flex justify-between"><span>Percent of Usage Reused</span><span class="font-bold" id="gw2-pct">0%</span></div>
            <div class="flex justify-between"><span>Reuse Potential Rating</span><span class="font-bold" id="gw2-rating">--</span></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="greywater" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcGW2() {
      const people = parseInt((document.getElementById('gw2-people') as HTMLInputElement).value) || 4;
      const shower = (document.getElementById('gw2-shower') as HTMLInputElement).checked;
      const lav = (document.getElementById('gw2-lav') as HTMLInputElement).checked;
      const laundry = (document.getElementById('gw2-laundry') as HTMLInputElement).checked;
      const kitchen = (document.getElementById('gw2-kitchen') as HTMLInputElement).checked;
      const climate = (document.getElementById('gw2-climate') as HTMLSelectElement).value;
      const soil = (document.getElementById('gw2-soil') as HTMLSelectElement).value;

      let dailyGal = 0;
      if (shower) dailyGal += people * 15;
      if (lav) dailyGal += people * 5;
      if (laundry) dailyGal += 15 * Math.ceil(people / 2) * 0.5; // loads per day
      if (kitchen) dailyGal += people * 5;

      const weeklyGal = dailyGal * 7;
      const annualGal = dailyGal * 365;

      // Irrigation water need per sq ft per week (inches)
      const irrigNeed: Record<string, number> = { arid: 2.0, semi: 1.5, moderate: 1.0, humid: 0.5 };
      const weeklyInches = irrigNeed[climate] || 1.5;
      // 1 gallon covers 1.6 sq ft at 1 inch depth (0.623 gal/sqft/inch)
      const sqFtPerGal = 1 / (weeklyInches * 0.623);
      const irrigArea = Math.round(weeklyGal * sqFtPerGal);

      // Soil absorption factor
      const soilFactor: Record<string, number> = { sand: 1.3, loam: 1.0, clay: 0.7 };
      const adjustedArea = Math.round(irrigArea * (soilFactor[soil] || 1.0));

      // Storage tank: 1-2 days of production (greywater should be used within 24-48 hrs)
      const tankSize = Math.ceil(dailyGal * 1.5 / 50) * 50; // round up to nearest 50

      // Total household water usage estimate: ~75 gal/person/day
      const totalUsage = people * 75;
      const reusePct = Math.min(100, (dailyGal / totalUsage * 100));

      // Annual savings at ~$0.01 per gallon (water + sewer)
      const annualSavings = annualGal * 0.01;

      let rating = 'Low';
      if (reusePct > 40) rating = 'Excellent';
      else if (reusePct > 25) rating = 'Good';
      else if (reusePct > 15) rating = 'Moderate';
      else rating = 'Low';

      document.getElementById('gw2-daily')!.textContent = Math.round(dailyGal) + ' gallons/day';
      document.getElementById('gw2-weekly')!.textContent = Math.round(weeklyGal).toLocaleString() + ' gal';
      document.getElementById('gw2-annual')!.textContent = Math.round(annualGal).toLocaleString() + ' gal';
      document.getElementById('gw2-area')!.textContent = adjustedArea.toLocaleString() + ' sq ft';
      document.getElementById('gw2-tank')!.textContent = tankSize + ' gal';
      document.getElementById('gw2-savings')!.textContent = '$' + Math.round(annualSavings);
      document.getElementById('gw2-pct')!.textContent = reusePct.toFixed(1) + '%';
      document.getElementById('gw2-rating')!.textContent = rating;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.gw2-in').forEach(el => { el.addEventListener('input', calcGW2); el.addEventListener('change', calcGW2); });
      calcGW2();
    }, 50);
  </script>
</CalculatorLayout>
