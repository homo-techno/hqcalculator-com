---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Half-Life Decay Calculator - Multi-Isotope Chains & Activity";
const description = "Calculate multi-isotope decay chains, activity over time, specific activity, and convert between becquerels, curies, and disintegrations per second.";
const relatedCalcs = [
  { name: "Radioactive Decay", url: "/radioactive-decay-calculator", description: "Nuclear decay." },
  { name: "Half-Life Calculator", url: "/half-life-calculator", description: "Half-life basics." },
  { name: "Exponent Calculator", url: "/exponent-calculator", description: "Exponential math." },
  { name: "Logarithm Calculator", url: "/logarithm-calculator", description: "Logarithm calculations." },
  { name: "Scientific Notation", url: "/scientific-notation-calculator", description: "Scientific notation." },
  { name: "Mole Calculator", url: "/mole-calculator", description: "Mole conversions." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Half-Life Decay Calculator" keywords="half-life, decay chain, activity, becquerel, curie, specific activity, isotope, radioactive decay" breadcrumbs={[{ name: "Half-Life Decay", url: "/half-life-decay-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Half-Life Decay Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Multi-isotope decay, activity tracking, specific activity, and unit conversions (Bq, Ci).</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="flex gap-2 mb-2">
          <button id="hd-m1" class="hd-mode flex-1 py-2 rounded-xl border-2 border-primary bg-blue-50 text-primary font-bold text-sm" data-mode="single">Single Isotope</button>
          <button id="hd-m2" class="hd-mode flex-1 py-2 rounded-xl border-2 border-border text-text-muted font-bold text-sm" data-mode="activity">Activity Calc</button>
          <button id="hd-m3" class="hd-mode flex-1 py-2 rounded-xl border-2 border-border text-text-muted font-bold text-sm" data-mode="chain">Decay Chain</button>
        </div>

        <div id="hd-panel-single">
          <div class="grid grid-cols-2 gap-3">
            <div><label class="block text-xs font-medium text-text mb-1">Initial Amount (N₀)</label><input type="number" id="hd-n0" class="hd-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="any"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Half-Life (t½)</label><input type="number" id="hd-hl" class="hd-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="any"></div>
          </div>
          <div class="grid grid-cols-2 gap-3 mt-3">
            <div><label class="block text-xs font-medium text-text mb-1">Time Elapsed</label><input type="number" id="hd-t" class="hd-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="any"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Time Unit</label>
              <select id="hd-unit" class="hd-in w-full px-4 py-3 border border-border rounded-xl font-bold">
                <option value="1">Seconds</option>
                <option value="60">Minutes</option>
                <option value="3600">Hours</option>
                <option value="86400">Days</option>
                <option value="31557600" selected>Years</option>
              </select>
            </div>
          </div>
        </div>

        <div id="hd-panel-activity" class="hidden">
          <div class="grid grid-cols-2 gap-3">
            <div><label class="block text-xs font-medium text-text mb-1">Mass of Sample (g)</label><input type="number" id="hd-mass" class="hd-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="any"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Molar Mass (g/mol)</label><input type="number" id="hd-mm" class="hd-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="0.01"></div>
          </div>
          <div class="grid grid-cols-2 gap-3 mt-3">
            <div><label class="block text-xs font-medium text-text mb-1">Half-Life (seconds)</label><input type="number" id="hd-hla" class="hd-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="any"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Time After (seconds)</label><input type="number" id="hd-ta" class="hd-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="any"></div>
          </div>
        </div>

        <div id="hd-panel-chain" class="hidden">
          <p class="text-xs text-text-muted mb-2">Parent decays to Daughter: N₂(t) from Bateman equations</p>
          <div class="grid grid-cols-2 gap-3">
            <div><label class="block text-xs font-medium text-text mb-1">Parent N₀ (atoms)</label><input type="number" id="hd-pn0" class="hd-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="any"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Parent t½ (seconds)</label><input type="number" id="hd-phl" class="hd-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="any"></div>
          </div>
          <div class="grid grid-cols-2 gap-3 mt-3">
            <div><label class="block text-xs font-medium text-text mb-1">Daughter t½ (seconds)</label><input type="number" id="hd-dhl" class="hd-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="any"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Time (seconds)</label><input type="number" id="hd-ct" class="hd-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="any"></div>
          </div>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="hd-label">Remaining Amount</div>
          <div class="text-5xl font-extrabold font-mono" id="hd-result">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase" id="hd-s1l">Decay Constant</div><div class="text-xl font-bold font-mono" id="hd-s1">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase" id="hd-s2l">Activity (Bq)</div><div class="text-xl font-bold font-mono" id="hd-s2">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase" id="hd-s3l">Activity (Ci)</div><div class="text-xl font-bold font-mono" id="hd-s3">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="half-life-decay" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    const NA = 6.02214076e23;
    let hdMode = 'single';

    function setHdMode(m: string) {
      hdMode = m;
      document.getElementById('hd-panel-single')!.classList.toggle('hidden', m !== 'single');
      document.getElementById('hd-panel-activity')!.classList.toggle('hidden', m !== 'activity');
      document.getElementById('hd-panel-chain')!.classList.toggle('hidden', m !== 'chain');
      document.querySelectorAll('.hd-mode').forEach(b => {
        const btn = b as HTMLButtonElement;
        const active = btn.dataset.mode === m;
        btn.className = `hd-mode flex-1 py-2 rounded-xl border-2 font-bold text-sm ${active ? 'border-primary bg-blue-50 text-primary' : 'border-border text-text-muted'}`;
      });
      calcHD();
    }

    function calcHD() {
      const label = document.getElementById('hd-label')!;
      const result = document.getElementById('hd-result')!;

      if (hdMode === 'single') {
        const N0 = parseFloat((document.getElementById('hd-n0') as HTMLInputElement).value) || 0;
        const hl = parseFloat((document.getElementById('hd-hl') as HTMLInputElement).value) || 1;
        const t = parseFloat((document.getElementById('hd-t') as HTMLInputElement).value) || 0;
        const unitFactor = parseFloat((document.getElementById('hd-unit') as HTMLSelectElement).value);
        const hlSec = hl * unitFactor;
        const tSec = t * unitFactor;
        const lambda = Math.LN2 / hlSec;
        const Nt = N0 * Math.exp(-lambda * tSec);
        const activity = lambda * Nt; // dps = Bq
        const actCi = activity / 3.7e10;
        label.textContent = 'Remaining Amount';
        result.textContent = Nt >= 1e9 ? Nt.toExponential(4) : Nt.toFixed(4);
        document.getElementById('hd-s1l')!.textContent = '\u03BB (s\u207B\u00B9)';
        document.getElementById('hd-s1')!.textContent = lambda.toExponential(4);
        document.getElementById('hd-s2l')!.textContent = 'Activity (Bq)';
        document.getElementById('hd-s2')!.textContent = activity.toExponential(4);
        document.getElementById('hd-s3l')!.textContent = 'Activity (Ci)';
        document.getElementById('hd-s3')!.textContent = actCi.toExponential(4);
      } else if (hdMode === 'activity') {
        const mass = parseFloat((document.getElementById('hd-mass') as HTMLInputElement).value) || 0;
        const mm = parseFloat((document.getElementById('hd-mm') as HTMLInputElement).value) || 1;
        const hl = parseFloat((document.getElementById('hd-hla') as HTMLInputElement).value) || 1;
        const t = parseFloat((document.getElementById('hd-ta') as HTMLInputElement).value) || 0;
        const moles = mass / mm;
        const atoms = moles * NA;
        const lambda = Math.LN2 / hl;
        const atomsT = atoms * Math.exp(-lambda * t);
        const activity = lambda * atomsT;
        const actCi = activity / 3.7e10;
        const specAct = mass > 0 ? activity / mass : 0; // Bq/g
        label.textContent = 'Activity at Time t';
        result.textContent = activity.toExponential(4) + ' Bq';
        document.getElementById('hd-s1l')!.textContent = 'Specific Activity';
        document.getElementById('hd-s1')!.textContent = specAct.toExponential(3) + ' Bq/g';
        document.getElementById('hd-s2l')!.textContent = 'Atoms Remaining';
        document.getElementById('hd-s2')!.textContent = atomsT.toExponential(4);
        document.getElementById('hd-s3l')!.textContent = 'Activity (Ci)';
        document.getElementById('hd-s3')!.textContent = actCi.toExponential(4);
      } else {
        const pN0 = parseFloat((document.getElementById('hd-pn0') as HTMLInputElement).value) || 0;
        const pHL = parseFloat((document.getElementById('hd-phl') as HTMLInputElement).value) || 1;
        const dHL = parseFloat((document.getElementById('hd-dhl') as HTMLInputElement).value) || 1;
        const t = parseFloat((document.getElementById('hd-ct') as HTMLInputElement).value) || 0;
        const lP = Math.LN2 / pHL;
        const lD = Math.LN2 / dHL;
        // Bateman equation: N_daughter(t) = N0 * lP/(lD-lP) * (e^(-lP*t) - e^(-lD*t))
        const parentN = pN0 * Math.exp(-lP * t);
        let daughterN = 0;
        if (Math.abs(lD - lP) > 1e-30) {
          daughterN = pN0 * (lP / (lD - lP)) * (Math.exp(-lP * t) - Math.exp(-lD * t));
        }
        const parentAct = lP * parentN;
        const daughterAct = lD * Math.max(0, daughterN);
        label.textContent = 'Parent Remaining';
        result.textContent = parentN.toExponential(4) + ' atoms';
        document.getElementById('hd-s1l')!.textContent = 'Daughter Atoms';
        document.getElementById('hd-s1')!.textContent = Math.max(0, daughterN).toExponential(4);
        document.getElementById('hd-s2l')!.textContent = 'Parent A (Bq)';
        document.getElementById('hd-s2')!.textContent = parentAct.toExponential(4);
        document.getElementById('hd-s3l')!.textContent = 'Daughter A (Bq)';
        document.getElementById('hd-s3')!.textContent = daughterAct.toExponential(4);
      }
      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      (document.getElementById('hd-n0') as HTMLInputElement).value = '1000000';
      (document.getElementById('hd-hl') as HTMLInputElement).value = '5730';
      (document.getElementById('hd-t') as HTMLInputElement).value = '11460';
      (document.getElementById('hd-mass') as HTMLInputElement).value = '0.001';
      (document.getElementById('hd-mm') as HTMLInputElement).value = '226';
      (document.getElementById('hd-hla') as HTMLInputElement).value = '5.05e10';
      (document.getElementById('hd-ta') as HTMLInputElement).value = '0';
      (document.getElementById('hd-pn0') as HTMLInputElement).value = '1e12';
      (document.getElementById('hd-phl') as HTMLInputElement).value = '3600';
      (document.getElementById('hd-dhl') as HTMLInputElement).value = '600';
      (document.getElementById('hd-ct') as HTMLInputElement).value = '1800';
      document.querySelectorAll('.hd-mode').forEach(b => b.addEventListener('click', () => setHdMode((b as HTMLButtonElement).dataset.mode!)));
      document.querySelectorAll('.hd-in').forEach(el => { el.addEventListener('input', calcHD); el.addEventListener('change', calcHD); });
      calcHD();
    }, 50);
  </script>
</CalculatorLayout>
