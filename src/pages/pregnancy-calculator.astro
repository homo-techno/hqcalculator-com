---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Pregnancy Calculator - Due Date & Week-by-Week Tracker 2026";
const description = "Free pregnancy calculator. Estimate your due date, current week, trimester, and key milestones. Week-by-week pregnancy timeline with development stages.";

const relatedCalcs = [
  { name: "Age Calculator", url: "/age-calculator", description: "Calculate exact age." },
  { name: "Date Calculator", url: "/date-calculator", description: "Days between dates." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body Mass Index calculator." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calorie needs." },
  { name: "Ovulation Calculator", url: "/ovulation-calculator", description: "Fertility window tracker." },
  { name: "Ideal Weight Calculator", url: "/ideal-weight-calculator", description: "Healthy weight range." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Pregnancy Calculator"
  keywords="pregnancy calculator, due date calculator, pregnancy week calculator, pregnancy timeline, expected due date, gestational age"
  breadcrumbs={[{ name: "Pregnancy Calculator", url: "/pregnancy-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Pregnancy Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your due date and track your pregnancy week by week. Enter the first day of your last menstrual period.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <!-- Method Selection -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-text mb-2">Calculation Method</label>
            <div class="flex gap-2">
              <button class="preg-method-btn px-4 py-2 rounded-full text-sm font-semibold bg-primary text-white" data-method="lmp">Last Period (LMP)</button>
              <button class="preg-method-btn px-4 py-2 rounded-full text-sm font-semibold bg-surface-alt text-text-secondary" data-method="conception">Conception Date</button>
              <button class="preg-method-btn px-4 py-2 rounded-full text-sm font-semibold bg-surface-alt text-text-secondary" data-method="due">Known Due Date</button>
            </div>
          </div>

          <!-- Date Input -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-text mb-1" id="preg-date-label">First Day of Last Period</label>
            <input type="date" id="preg-date" class="w-full px-4 py-3 border border-border rounded-xl text-lg">
          </div>

          <!-- Cycle Length -->
          <div class="mb-6" id="preg-cycle-wrap">
            <label class="block text-sm font-medium text-text mb-1">Average Cycle Length</label>
            <div class="flex items-center gap-3">
              <input type="range" id="preg-cycle-slider" min="20" max="45" value="28" class="flex-1">
              <span class="text-lg font-bold w-16 text-center" id="preg-cycle-val">28 days</span>
            </div>
          </div>
        </div>

        <!-- Results -->
        <div class="space-y-4">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Due Date</div>
            <div class="text-3xl sm:text-4xl font-extrabold" id="preg-due-date">—</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Current Week</div>
              <div class="text-xl font-bold text-primary" id="preg-week">—</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Trimester</div>
              <div class="text-xl font-bold" id="preg-trimester">—</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Days Remaining</div>
              <div class="text-xl font-bold" id="preg-days-left">—</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Conception Date</div>
              <div class="text-xl font-bold" id="preg-conception">—</div>
            </div>
          </div>

          <!-- Progress Bar -->
          <div class="bg-surface-alt rounded-xl p-4">
            <div class="flex justify-between text-xs text-text-muted mb-2">
              <span>Week 0</span>
              <span>Week 13</span>
              <span>Week 27</span>
              <span>Week 40</span>
            </div>
            <div class="w-full bg-white rounded-full h-4 overflow-hidden relative">
              <div class="absolute inset-0 flex">
                <div class="h-full bg-pink-200" style="width: 32.5%"></div>
                <div class="h-full bg-purple-200" style="width: 35%"></div>
                <div class="h-full bg-blue-200" style="width: 32.5%"></div>
              </div>
              <div class="absolute inset-0">
                <div class="h-full bg-primary rounded-full transition-all duration-500" id="preg-bar" style="width: 0%"></div>
              </div>
            </div>
            <div class="flex justify-between text-xs mt-1">
              <span class="text-pink-500 font-medium">1st Trimester</span>
              <span class="text-purple-500 font-medium">2nd Trimester</span>
              <span class="text-blue-500 font-medium">3rd Trimester</span>
            </div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="pregnancy" />
      <FeedbackWidget />
    </div>

    <!-- Key Dates -->
    <div class="mt-12 bg-white border border-border rounded-2xl p-6 sm:p-8">
      <h2 class="text-2xl font-bold text-text mb-4">Key Pregnancy Dates</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-border text-left">
              <th class="py-2 pr-3 font-semibold">Milestone</th>
              <th class="py-2 pr-3 font-semibold">Week</th>
              <th class="py-2 font-semibold">Estimated Date</th>
            </tr>
          </thead>
          <tbody id="preg-milestones" class="text-text-secondary"></tbody>
        </table>
      </div>
    </div>

    <!-- Week-by-Week Guide -->
    <div class="mt-12 bg-white border border-border rounded-2xl p-6 sm:p-8">
      <h2 class="text-2xl font-bold text-text mb-4">Trimester Overview</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="p-5 bg-pink-50 rounded-xl border border-pink-100">
          <h3 class="font-bold text-pink-700 mb-2">1st Trimester (Weeks 1-13)</h3>
          <ul class="text-sm text-text-secondary space-y-1">
            <li>Week 4: Implantation, pregnancy test positive</li>
            <li>Week 6: Heart begins beating</li>
            <li>Week 8: All major organs forming</li>
            <li>Week 10: Fingers and toes develop</li>
            <li>Week 12: First ultrasound, risk of miscarriage decreases</li>
          </ul>
        </div>
        <div class="p-5 bg-purple-50 rounded-xl border border-purple-100">
          <h3 class="font-bold text-purple-700 mb-2">2nd Trimester (Weeks 14-27)</h3>
          <ul class="text-sm text-text-secondary space-y-1">
            <li>Week 16: Gender may be visible</li>
            <li>Week 18-20: You may feel first movements</li>
            <li>Week 20: Anatomy scan ultrasound</li>
            <li>Week 24: Viability milestone</li>
            <li>Week 27: Eyes open, sleep cycles begin</li>
          </ul>
        </div>
        <div class="p-5 bg-blue-50 rounded-xl border border-blue-100">
          <h3 class="font-bold text-blue-700 mb-2">3rd Trimester (Weeks 28-40)</h3>
          <ul class="text-sm text-text-secondary space-y-1">
            <li>Week 28: Lungs developing, rapid growth</li>
            <li>Week 32: Bones hardening, practice breathing</li>
            <li>Week 36: Baby may move to head-down position</li>
            <li>Week 37: Considered early term</li>
            <li>Week 39-40: Full term, ready for birth</li>
          </ul>
        </div>
      </div>
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Due Date Is Calculated</h2>
      <p>The estimated due date (EDD) is calculated using Naegele's Rule: add 280 days (40 weeks) to the first day of your last menstrual period (LMP). This assumes a 28-day cycle. If your cycle is longer or shorter, the calculation adjusts accordingly.</p>

      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">
        Due Date = LMP + 280 days + (Cycle Length - 28) days
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Understanding Gestational Age</h3>
      <p>Gestational age is counted from the first day of your last period, not from conception. This means you're already considered about 2 weeks pregnant at the time of conception. Your doctor will use this dating method for all prenatal care.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Important Prenatal Appointments</h3>
      <ul>
        <li><strong>Week 8-12:</strong> First prenatal visit, blood tests, dating ultrasound</li>
        <li><strong>Week 11-13:</strong> First trimester screening (nuchal translucency)</li>
        <li><strong>Week 15-20:</strong> Second trimester screening (AFP, quad screen)</li>
        <li><strong>Week 18-22:</strong> Anatomy scan (detailed ultrasound)</li>
        <li><strong>Week 24-28:</strong> Glucose screening test</li>
        <li><strong>Week 36+:</strong> Weekly visits, Group B Strep test at 36 weeks</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">How Accurate Is the Due Date?</h3>
      <p>Only about 5% of babies are born on their exact due date. Most babies arrive between 38 and 42 weeks. The due date is an estimate based on the average pregnancy length. An ultrasound in the first trimester can refine this estimate with greater accuracy.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What if I don't know my last period date?</strong> Your doctor can estimate the due date using an early ultrasound, which is most accurate in the first trimester. You can also use the conception date method if you know when you conceived.</p>
      <p><strong>Can my due date change?</strong> Yes. If an ultrasound shows a significant difference from the LMP-based due date (more than 7 days in the first trimester), your doctor may adjust it.</p>
      <p><strong>What is full term?</strong> Full term is 39-40 weeks. Early term is 37-38 weeks. Late term is 41 weeks, and post-term is 42+ weeks.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let currentMethod = 'lmp';

    function formatDate(d: Date): string {
      return d.toLocaleDateString('en-US', { weekday: 'short', month: 'long', day: 'numeric', year: 'numeric' });
    }
    function shortDate(d: Date): string {
      return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    function calcPregnancy() {
      const dateStr = (document.getElementById('preg-date') as HTMLInputElement).value;
      if (!dateStr) return;

      const inputDate = new Date(dateStr + 'T00:00:00');
      const cycleLength = parseInt((document.getElementById('preg-cycle-slider') as HTMLInputElement).value) || 28;
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      let lmpDate: Date;
      let dueDate: Date;
      let conceptionDate: Date;

      switch (currentMethod) {
        case 'lmp':
          lmpDate = new Date(inputDate);
          conceptionDate = new Date(lmpDate);
          conceptionDate.setDate(conceptionDate.getDate() + (cycleLength - 14));
          dueDate = new Date(lmpDate);
          dueDate.setDate(dueDate.getDate() + 280 + (cycleLength - 28));
          break;
        case 'conception':
          conceptionDate = new Date(inputDate);
          lmpDate = new Date(conceptionDate);
          lmpDate.setDate(lmpDate.getDate() - 14);
          dueDate = new Date(conceptionDate);
          dueDate.setDate(dueDate.getDate() + 266);
          break;
        case 'due':
          dueDate = new Date(inputDate);
          lmpDate = new Date(dueDate);
          lmpDate.setDate(lmpDate.getDate() - 280);
          conceptionDate = new Date(lmpDate);
          conceptionDate.setDate(conceptionDate.getDate() + 14);
          break;
        default:
          return;
      }

      // Gestational age
      const diffMs = today.getTime() - lmpDate.getTime();
      const totalDays = Math.floor(diffMs / 86400000);
      const weeks = Math.floor(totalDays / 7);
      const days = totalDays % 7;
      const daysLeft = Math.max(0, Math.ceil((dueDate.getTime() - today.getTime()) / 86400000));

      let trimester: string;
      if (weeks < 13) trimester = '1st Trimester';
      else if (weeks < 27) trimester = '2nd Trimester';
      else trimester = '3rd Trimester';

      // Update display
      document.getElementById('preg-due-date')!.textContent = formatDate(dueDate);
      document.getElementById('preg-week')!.textContent = totalDays >= 0 ? `Week ${weeks}, Day ${days}` : '—';
      document.getElementById('preg-trimester')!.textContent = totalDays >= 0 ? trimester : '—';
      document.getElementById('preg-days-left')!.textContent = totalDays >= 0 ? String(daysLeft) : '—';
      document.getElementById('preg-conception')!.textContent = shortDate(conceptionDate);

      // Progress bar
      const progress = Math.min(100, Math.max(0, (totalDays / 280) * 100));
      document.getElementById('preg-bar')!.style.width = progress + '%';

      // Milestones
      const milestones = [
        { name: 'Conception (estimated)', week: 2, offset: 14 },
        { name: 'First heartbeat detectable', week: 6, offset: 42 },
        { name: 'End of embryonic period', week: 10, offset: 70 },
        { name: 'First trimester screening', week: 12, offset: 84 },
        { name: 'Second trimester begins', week: 14, offset: 98 },
        { name: 'Gender may be visible', week: 16, offset: 112 },
        { name: 'Anatomy scan', week: 20, offset: 140 },
        { name: 'Viability milestone', week: 24, offset: 168 },
        { name: 'Third trimester begins', week: 28, offset: 196 },
        { name: 'Baby is head-down', week: 36, offset: 252 },
        { name: 'Full term', week: 39, offset: 273 },
        { name: 'Due date', week: 40, offset: 280 },
      ];

      const tbody = document.getElementById('preg-milestones')!;
      tbody.innerHTML = milestones.map(m => {
        const mDate = new Date(lmpDate);
        mDate.setDate(mDate.getDate() + m.offset);
        const isPast = today >= mDate;
        const isCurrent = Math.abs(weeks - m.week) <= 1;
        return `<tr class="border-b border-border/30 ${isCurrent ? 'bg-primary/5 font-medium' : ''} ${isPast ? 'text-text-muted' : ''}">
          <td class="py-2 pr-3">${isPast ? '✓ ' : ''}${m.name}</td>
          <td class="py-2 pr-3">Week ${m.week}</td>
          <td class="py-2">${shortDate(mDate)}</td>
        </tr>`;
      }).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      // Set default date (today - 10 weeks for demo)
      const defaultDate = new Date();
      defaultDate.setDate(defaultDate.getDate() - 70);
      const dateInput = document.getElementById('preg-date') as HTMLInputElement;
      dateInput.value = defaultDate.toISOString().split('T')[0];

      // Method buttons
      document.querySelectorAll('.preg-method-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.preg-method-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-surface-alt', 'text-text-secondary');
          });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary');
          btn.classList.add('bg-primary', 'text-white');
          currentMethod = (btn as HTMLElement).dataset.method || 'lmp';

          const labels: Record<string, string> = {
            lmp: 'First Day of Last Period',
            conception: 'Conception Date',
            due: 'Known Due Date'
          };
          document.getElementById('preg-date-label')!.textContent = labels[currentMethod];
          document.getElementById('preg-cycle-wrap')!.style.display = currentMethod === 'lmp' ? '' : 'none';
          calcPregnancy();
        });
      });

      // Cycle slider
      const cycleSlider = document.getElementById('preg-cycle-slider')!;
      cycleSlider.addEventListener('input', () => {
        document.getElementById('preg-cycle-val')!.textContent = (cycleSlider as HTMLInputElement).value + ' days';
        calcPregnancy();
      });

      // Date input
      dateInput.addEventListener('change', calcPregnancy);

      calcPregnancy();
    }, 50);
  </script>
</CalculatorLayout>
