---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Metabolic Age Calculator - Compare Your BMR";
const description = "Estimate your metabolic age by comparing your BMR to age-group averages. Uses Mifflin-St Jeor equation.";
const relatedCalcs = [
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body mass index." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calorie needs." },
  { name: "Caloric Deficit Calculator", url: "/caloric-deficit-calculator", description: "Weight loss plan." },
  { name: "Body Surface Area Calculator", url: "/body-surface-area-calculator", description: "BSA calculation." },
  { name: "Workout Volume Calculator", url: "/workout-volume-calculator", description: "Training volume." },
  { name: "Macro Calculator", url: "/macro-calculator", description: "Macronutrients." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Metabolic Age Calculator" keywords="metabolic age, BMR, basal metabolic rate, metabolism, Mifflin-St Jeor, resting metabolism" breadcrumbs={[{ name: "Metabolic Age", url: "/metabolic-age-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Metabolic Age Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Discover your metabolic age by comparing your BMR to age-group averages.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Sex</label>
          <select id="ma-sex" class="ma-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="male" selected>Male</option>
            <option value="female">Female</option>
          </select>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Age (years)</label><input type="number" id="ma-age" class="ma-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="35" min="18" max="100" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Height (cm)</label><input type="number" id="ma-ht" class="ma-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="175" min="100" max="250" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Weight (kg)</label><input type="number" id="ma-wt" class="ma-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="75" min="30" max="250" step="0.5"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Your Metabolic Age</div>
          <div class="text-5xl font-extrabold font-mono" id="ma-result">0</div>
          <div class="text-sm text-blue-200 mt-1" id="ma-compare"></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Your BMR</div><div class="text-xl font-bold" id="ma-bmr">0 cal</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Average BMR</div><div class="text-xl font-bold" id="ma-avg">0 cal</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Difference</div><div class="text-xl font-bold" id="ma-diff">0 cal</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">What This Means</h3>
          <div class="text-sm" id="ma-explain"></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">BMR by Age (average)</h3>
          <div class="grid grid-cols-2 gap-2 text-sm">
            <div class="flex justify-between"><span>20-29 years</span><span class="font-bold">1700-1900 cal</span></div>
            <div class="flex justify-between"><span>30-39 years</span><span class="font-bold">1600-1800 cal</span></div>
            <div class="flex justify-between"><span>40-49 years</span><span class="font-bold">1500-1700 cal</span></div>
            <div class="flex justify-between"><span>50-59 years</span><span class="font-bold">1400-1600 cal</span></div>
            <div class="flex justify-between"><span>60-69 years</span><span class="font-bold">1300-1500 cal</span></div>
            <div class="flex justify-between"><span>70+ years</span><span class="font-bold">1200-1400 cal</span></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="metabolic-age" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">What Is Metabolic Age?</h2>
      <p>Metabolic age compares your Basal Metabolic Rate (BMR) to the average BMR for different age groups. If your metabolic age is lower than your actual age, your metabolism is faster than average. The Mifflin-St Jeor equation is used: For men: BMR = 10 x weight(kg) + 6.25 x height(cm) - 5 x age - 5. For women: BMR = 10 x weight(kg) + 6.25 x height(cm) - 5 x age - 161.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcMetAge() {
      const sex = (document.getElementById('ma-sex') as HTMLSelectElement).value;
      const age = parseInt((document.getElementById('ma-age') as HTMLInputElement).value) || 35;
      const ht = parseFloat((document.getElementById('ma-ht') as HTMLInputElement).value) || 175;
      const wt = parseFloat((document.getElementById('ma-wt') as HTMLInputElement).value) || 75;
      let bmr: number;
      if (sex === 'male') {
        bmr = 10 * wt + 6.25 * ht - 5 * age + 5;
      } else {
        bmr = 10 * wt + 6.25 * ht - 5 * age - 161;
      }
      const avgBmrByAge = (a: number, s: string): number => {
        const base = s === 'male' ? 1800 : 1500;
        const decline = s === 'male' ? 10 : 7;
        return base - (a - 25) * decline;
      };
      const avgBmr = avgBmrByAge(age, sex);
      const diff = bmr - avgBmr;
      let metAge = age;
      for (let testAge = 18; testAge <= 90; testAge++) {
        const testAvg = avgBmrByAge(testAge, sex);
        if (Math.abs(bmr - testAvg) < Math.abs(bmr - avgBmrByAge(metAge, sex)) || testAge === 18) {
          if (Math.abs(bmr - testAvg) <= Math.abs(bmr - avgBmrByAge(metAge, sex))) {
            metAge = testAge;
          }
        }
      }
      let minDiff = Infinity;
      for (let testAge = 18; testAge <= 90; testAge++) {
        const testAvg = avgBmrByAge(testAge, sex);
        const d = Math.abs(bmr - testAvg);
        if (d < minDiff) {
          minDiff = d;
          metAge = testAge;
        }
      }
      const ageDiff = metAge - age;
      let compare = '';
      if (ageDiff < -3) compare = metAge + ' years old (younger - great metabolism!)';
      else if (ageDiff > 3) compare = metAge + ' years old (older - metabolism could improve)';
      else compare = metAge + ' years old (about your actual age)';
      let explain = '';
      if (ageDiff < -3) explain = 'Your metabolism is faster than average for your age. This means you burn more calories at rest, which is associated with higher muscle mass and overall fitness.';
      else if (ageDiff > 3) explain = 'Your metabolism is slower than average for your age. Building muscle through strength training and staying active can help boost your metabolic rate.';
      else explain = 'Your metabolism is on par with the average for your age group. Maintaining regular exercise and a balanced diet will help keep it healthy.';
      document.getElementById('ma-result')!.textContent = metAge.toString();
      document.getElementById('ma-compare')!.textContent = compare;
      document.getElementById('ma-bmr')!.textContent = Math.round(bmr) + ' cal';
      document.getElementById('ma-avg')!.textContent = Math.round(avgBmr) + ' cal';
      document.getElementById('ma-diff')!.textContent = (diff > 0 ? '+' : '') + Math.round(diff) + ' cal';
      document.getElementById('ma-explain')!.textContent = explain;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ma-in').forEach(el => { el.addEventListener('input', calcMetAge); el.addEventListener('change', calcMetAge); });
      calcMetAge();
    }, 50);
  </script>
</CalculatorLayout>
