---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Hours Calculator - Work Hours & Time Card Calculator";
const description = "Calculate total work hours between clock-in and clock-out times. Track weekly hours, overtime, and gross pay. Free timesheet calculator.";

const relatedCalcs = [
  { name: "Time Calculator", url: "/time-calculator", description: "Add/subtract time." },
  { name: "Hourly to Salary", url: "/hourly-to-salary-calculator", description: "Wage conversion." },
  { name: "Salary Calculator", url: "/salary-calculator", description: "Salary breakdown." },
  { name: "Paycheck Calculator", url: "/paycheck-calculator", description: "Take-home pay." },
  { name: "Date Calculator", url: "/date-calculator", description: "Date differences." },
  { name: "Tip Calculator", url: "/tip-calculator", description: "Restaurant tips." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Hours Calculator"
  keywords="hours calculator, work hours calculator, timesheet calculator, time card calculator, clock in clock out, overtime calculator"
  breadcrumbs={[{ name: "Hours Calculator", url: "/hours-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Hours Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Track work hours from clock-in to clock-out. Calculate total hours, overtime, and gross pay.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2">
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="border-b border-border text-left">
                  <th class="py-2 pr-2 font-semibold">Day</th>
                  <th class="py-2 pr-2 font-semibold">Start</th>
                  <th class="py-2 pr-2 font-semibold">End</th>
                  <th class="py-2 pr-2 font-semibold">Break (min)</th>
                  <th class="py-2 font-semibold text-right">Hours</th>
                </tr>
              </thead>
              <tbody id="hr-tbody">
                <tr class="hr-day border-b border-border/30" data-day="Mon">
                  <td class="py-2 pr-2 font-medium">Mon</td>
                  <td class="py-2 pr-2"><input type="time" class="hr-start px-2 py-1.5 border border-border rounded-lg" value="09:00"></td>
                  <td class="py-2 pr-2"><input type="time" class="hr-end px-2 py-1.5 border border-border rounded-lg" value="17:00"></td>
                  <td class="py-2 pr-2"><input type="number" class="hr-break w-16 px-2 py-1.5 border border-border rounded-lg text-center" value="30" min="0"></td>
                  <td class="py-2 text-right font-bold hr-day-hours">0</td>
                </tr>
                <tr class="hr-day border-b border-border/30" data-day="Tue">
                  <td class="py-2 pr-2 font-medium">Tue</td>
                  <td class="py-2 pr-2"><input type="time" class="hr-start px-2 py-1.5 border border-border rounded-lg" value="09:00"></td>
                  <td class="py-2 pr-2"><input type="time" class="hr-end px-2 py-1.5 border border-border rounded-lg" value="17:00"></td>
                  <td class="py-2 pr-2"><input type="number" class="hr-break w-16 px-2 py-1.5 border border-border rounded-lg text-center" value="30" min="0"></td>
                  <td class="py-2 text-right font-bold hr-day-hours">0</td>
                </tr>
                <tr class="hr-day border-b border-border/30" data-day="Wed">
                  <td class="py-2 pr-2 font-medium">Wed</td>
                  <td class="py-2 pr-2"><input type="time" class="hr-start px-2 py-1.5 border border-border rounded-lg" value="09:00"></td>
                  <td class="py-2 pr-2"><input type="time" class="hr-end px-2 py-1.5 border border-border rounded-lg" value="17:00"></td>
                  <td class="py-2 pr-2"><input type="number" class="hr-break w-16 px-2 py-1.5 border border-border rounded-lg text-center" value="30" min="0"></td>
                  <td class="py-2 text-right font-bold hr-day-hours">0</td>
                </tr>
                <tr class="hr-day border-b border-border/30" data-day="Thu">
                  <td class="py-2 pr-2 font-medium">Thu</td>
                  <td class="py-2 pr-2"><input type="time" class="hr-start px-2 py-1.5 border border-border rounded-lg" value="09:00"></td>
                  <td class="py-2 pr-2"><input type="time" class="hr-end px-2 py-1.5 border border-border rounded-lg" value="17:00"></td>
                  <td class="py-2 pr-2"><input type="number" class="hr-break w-16 px-2 py-1.5 border border-border rounded-lg text-center" value="30" min="0"></td>
                  <td class="py-2 text-right font-bold hr-day-hours">0</td>
                </tr>
                <tr class="hr-day border-b border-border/30" data-day="Fri">
                  <td class="py-2 pr-2 font-medium">Fri</td>
                  <td class="py-2 pr-2"><input type="time" class="hr-start px-2 py-1.5 border border-border rounded-lg" value="09:00"></td>
                  <td class="py-2 pr-2"><input type="time" class="hr-end px-2 py-1.5 border border-border rounded-lg" value="17:00"></td>
                  <td class="py-2 pr-2"><input type="number" class="hr-break w-16 px-2 py-1.5 border border-border rounded-lg text-center" value="30" min="0"></td>
                  <td class="py-2 text-right font-bold hr-day-hours">0</td>
                </tr>
                <tr class="hr-day border-b border-border/30" data-day="Sat">
                  <td class="py-2 pr-2 font-medium text-text-muted">Sat</td>
                  <td class="py-2 pr-2"><input type="time" class="hr-start px-2 py-1.5 border border-border rounded-lg" value=""></td>
                  <td class="py-2 pr-2"><input type="time" class="hr-end px-2 py-1.5 border border-border rounded-lg" value=""></td>
                  <td class="py-2 pr-2"><input type="number" class="hr-break w-16 px-2 py-1.5 border border-border rounded-lg text-center" value="0" min="0"></td>
                  <td class="py-2 text-right font-bold hr-day-hours">0</td>
                </tr>
                <tr class="hr-day" data-day="Sun">
                  <td class="py-2 pr-2 font-medium text-text-muted">Sun</td>
                  <td class="py-2 pr-2"><input type="time" class="hr-start px-2 py-1.5 border border-border rounded-lg" value=""></td>
                  <td class="py-2 pr-2"><input type="time" class="hr-end px-2 py-1.5 border border-border rounded-lg" value=""></td>
                  <td class="py-2 pr-2"><input type="number" class="hr-break w-16 px-2 py-1.5 border border-border rounded-lg text-center" value="0" min="0"></td>
                  <td class="py-2 text-right font-bold hr-day-hours">0</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="mt-4 p-4 bg-surface-alt rounded-xl">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Hourly Rate (optional)</label>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
                  <input type="number" id="hr-rate" class="w-full pl-7 pr-3 py-2 border border-border rounded-lg" value="25" min="0" step="0.25">
                </div>
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Overtime after (hrs/week)</label>
                <input type="number" id="hr-ot-after" class="w-full px-3 py-2 border border-border rounded-lg" value="40" min="0">
              </div>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Hours</div>
            <div class="text-4xl font-extrabold" id="hr-total">0:00</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Regular</div>
              <div class="text-xl font-bold" id="hr-regular">0:00</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Overtime</div>
              <div class="text-xl font-bold text-danger" id="hr-overtime">0:00</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Decimal Hours</div>
              <div class="text-xl font-bold" id="hr-decimal">0.00</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Days Worked</div>
              <div class="text-xl font-bold" id="hr-days">0</div>
            </div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Gross Pay</div>
            <div class="text-2xl font-bold text-secondary" id="hr-pay">$0.00</div>
            <div class="text-xs text-text-muted mt-1" id="hr-pay-detail"></div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="hours" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Work Hours</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">Work Hours = (Clock Out − Clock In) − Break Time</div>
      <p>Enter your start and end times for each day along with any break duration. The calculator automatically sums your weekly hours and determines overtime based on a 40-hour threshold (customizable).</p>

      <h3 class="text-xl font-semibold text-text mt-8">Overtime Rules</h3>
      <ul>
        <li><strong>Federal (FLSA):</strong> Overtime kicks in after 40 hours/week at 1.5× regular rate</li>
        <li><strong>California:</strong> Daily overtime after 8 hours; double time after 12 hours</li>
        <li>Some states have additional overtime rules — check your state's labor laws</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>Do breaks count as work hours?</strong> Unpaid breaks (typically 30+ minutes) are deducted. Short rest breaks (5-20 minutes) are usually paid and counted as work time under FLSA.</p>
      <p><strong>How is overtime calculated?</strong> Federal law requires 1.5× your regular rate for hours over 40/week. This calculator uses that standard but you can adjust the threshold.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function timeToMin(t: string): number {
      if (!t) return -1;
      const [h, m] = t.split(':').map(Number);
      return h * 60 + m;
    }

    function formatHM(totalMin: number): string {
      const h = Math.floor(totalMin / 60);
      const m = Math.round(totalMin % 60);
      return `${h}:${String(m).padStart(2, '0')}`;
    }

    function calcHours() {
      let totalMin = 0;
      let daysWorked = 0;

      document.querySelectorAll('.hr-day').forEach(row => {
        const start = timeToMin((row.querySelector('.hr-start') as HTMLInputElement).value);
        const end = timeToMin((row.querySelector('.hr-end') as HTMLInputElement).value);
        const brk = parseInt((row.querySelector('.hr-break') as HTMLInputElement).value) || 0;
        const display = row.querySelector('.hr-day-hours') as HTMLElement;

        if (start >= 0 && end >= 0) {
          let diff = end - start;
          if (diff < 0) diff += 24 * 60; // overnight shift
          diff = Math.max(0, diff - brk);
          totalMin += diff;
          daysWorked++;
          display.textContent = (diff / 60).toFixed(2);
        } else {
          display.textContent = '—';
        }
      });

      const totalHrs = totalMin / 60;
      const otAfter = parseFloat((document.getElementById('hr-ot-after') as HTMLInputElement).value) || 40;
      const regularMin = Math.min(totalMin, otAfter * 60);
      const otMin = Math.max(0, totalMin - otAfter * 60);

      document.getElementById('hr-total')!.textContent = formatHM(totalMin);
      document.getElementById('hr-regular')!.textContent = formatHM(regularMin);
      document.getElementById('hr-overtime')!.textContent = formatHM(otMin);
      document.getElementById('hr-decimal')!.textContent = totalHrs.toFixed(2);
      document.getElementById('hr-days')!.textContent = String(daysWorked);

      // Pay
      const rate = parseFloat((document.getElementById('hr-rate') as HTMLInputElement).value) || 0;
      const regularPay = (regularMin / 60) * rate;
      const otPay = (otMin / 60) * rate * 1.5;
      const totalPay = regularPay + otPay;
      document.getElementById('hr-pay')!.textContent = '$' + totalPay.toFixed(2);
      document.getElementById('hr-pay-detail')!.textContent = otMin > 0
        ? `Regular: $${regularPay.toFixed(2)} + OT: $${otPay.toFixed(2)}`
        : `${totalHrs.toFixed(1)} hrs × $${rate}/hr`;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.hr-start, .hr-end, .hr-break').forEach(el => el.addEventListener('input', calcHours));
      document.getElementById('hr-rate')!.addEventListener('input', calcHours);
      document.getElementById('hr-ot-after')!.addEventListener('input', calcHours);
      calcHours();
    }, 50);
  </script>
</CalculatorLayout>
