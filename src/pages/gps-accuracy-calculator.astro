---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "GPS Accuracy Calculator - PDOP, HDOP & Error Estimation";
const description = "Estimate GPS position accuracy from PDOP, HDOP, VDOP values and UERE. Calculate 95% confidence circle radius for survey planning.";
const relatedCalcs = [
  { name: "Distance & Bearing", url: "/distance-bearing-calculator", description: "GPS distance & bearing." },
  { name: "Coordinate Converter", url: "/coordinate-converter-calculator", description: "Coordinate formats." },
  { name: "Datum Conversion", url: "/datum-conversion-calculator", description: "Datum shifts." },
  { name: "Total Station", url: "/total-station-calculator", description: "Total station calcs." },
  { name: "Map Distance", url: "/map-distance-calculator", description: "Map to ground distance." },
  { name: "Stakeout Calculator", url: "/stakeout-calculator", description: "Stakeout coordinates." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="GPS Accuracy Calculator" keywords="GPS accuracy, PDOP, HDOP, VDOP, position error, UERE, GPS survey, confidence circle" breadcrumbs={[{ name: "GPS Accuracy Calculator", url: "/gps-accuracy-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">GPS Accuracy Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate horizontal and vertical position accuracy from dilution of precision (DOP) values and User Equivalent Range Error (UERE).</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-text mb-1">HDOP</label>
            <input type="number" id="gac-hdop" class="gac-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.2" step="0.1" min="0.1">
          </div>
          <div>
            <label class="block text-sm font-semibold text-text mb-1">VDOP</label>
            <input type="number" id="gac-vdop" class="gac-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.8" step="0.1" min="0.1">
          </div>
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">UERE - User Equivalent Range Error (m)</label>
          <input type="number" id="gac-uere" class="gac-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6.0" step="0.1" min="0.1">
          <p class="text-xs text-text-muted mt-1">Typical: ~6m civilian, ~1m SBAS-aided, 0.01-0.02m RTK</p>
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Number of Satellites</label>
          <input type="number" id="gac-sats" class="gac-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="4" max="30">
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Horizontal Accuracy (1-sigma)</div>
          <div class="text-5xl font-extrabold font-mono" id="gac-hacc">--</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Vertical Accuracy (1-sigma)</div>
            <div class="text-xl font-bold" id="gac-vacc">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">3D Accuracy (PDOP)</div>
            <div class="text-xl font-bold" id="gac-3d">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">95% Horiz. Confidence</div>
            <div class="text-xl font-bold" id="gac-h95">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">95% Vert. Confidence</div>
            <div class="text-xl font-bold" id="gac-v95">--</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">PDOP</div>
          <div class="text-xl font-bold" id="gac-pdop">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">DOP Quality Rating</div>
          <div class="text-xl font-bold" id="gac-rating">--</div>
        </div>
      </div>
      <ShareButton calculatorId="gps-accuracy" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">GPS Accuracy Estimation</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p>Horizontal Error = HDOP x UERE</p>
        <p>Vertical Error = VDOP x UERE</p>
        <p>PDOP = sqrt(HDOP^2 + VDOP^2)</p>
        <p>95% Confidence = 1.96 x sigma</p>
      </div>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcGAC() {
      const hdop = parseFloat((document.getElementById('gac-hdop') as HTMLInputElement).value) || 1;
      const vdop = parseFloat((document.getElementById('gac-vdop') as HTMLInputElement).value) || 1;
      const uere = parseFloat((document.getElementById('gac-uere') as HTMLInputElement).value) || 6;
      const sats = parseInt((document.getElementById('gac-sats') as HTMLInputElement).value) || 8;
      const pdop = Math.sqrt(hdop * hdop + vdop * vdop);
      const hErr = hdop * uere;
      const vErr = vdop * uere;
      const err3d = pdop * uere;
      const h95 = hErr * 1.96;
      const v95 = vErr * 1.96;
      let rating = '';
      if (pdop <= 1) rating = 'Ideal';
      else if (pdop <= 2) rating = 'Excellent';
      else if (pdop <= 5) rating = 'Good';
      else if (pdop <= 10) rating = 'Moderate';
      else if (pdop <= 20) rating = 'Fair';
      else rating = 'Poor';
      document.getElementById('gac-hacc')!.textContent = hErr.toFixed(2) + ' m';
      document.getElementById('gac-vacc')!.textContent = vErr.toFixed(2) + ' m';
      document.getElementById('gac-3d')!.textContent = err3d.toFixed(2) + ' m';
      document.getElementById('gac-h95')!.textContent = h95.toFixed(2) + ' m';
      document.getElementById('gac-v95')!.textContent = v95.toFixed(2) + ' m';
      document.getElementById('gac-pdop')!.textContent = pdop.toFixed(2);
      document.getElementById('gac-rating')!.textContent = rating + ' (' + sats + ' sats)';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.gac-in').forEach(el => { el.addEventListener('input', calcGAC); el.addEventListener('change', calcGAC); });
      calcGAC();
    }, 50);
  </script>
</CalculatorLayout>
