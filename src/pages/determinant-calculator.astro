---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Determinant Calculator - 2x2 and 3x3 Matrix Determinant";
const description = "Calculate the determinant of a 2x2 or 3x3 matrix. Shows cofactors and whether the matrix is invertible.";

const relatedCalcs = [
  { name: "Cross Product Calculator", url: "/cross-product-calculator", description: "3D vector cross product." },
  { name: "Dot Product Calculator", url: "/dot-product-calculator", description: "Vector dot product." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math operations." },
  { name: "Average Calculator", url: "/average-calculator", description: "Mean, median, mode." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage calculations." },
  { name: "Number Sequence", url: "/number-sequence-calculator", description: "Sequence pattern detection." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Determinant Calculator"
  keywords="determinant calculator, matrix determinant, 2x2 determinant, 3x3 determinant, cofactors, invertible matrix"
  breadcrumbs={[{ name: "Determinant Calculator", url: "/determinant-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Determinant Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Compute the determinant of a 2&times;2 or 3&times;3 matrix with cofactors and invertibility check.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Matrix Size</label>
          <select id="dt-mode" class="dt-in w-full px-4 py-2 border border-border rounded-xl text-lg">
            <option value="2">2 &times; 2</option>
            <option value="3" selected>3 &times; 3</option>
          </select>
        </div>

        <div id="dt-matrix-2" class="hidden">
          <h3 class="font-semibold text-text mb-2">2&times;2 Matrix</h3>
          <div class="grid grid-cols-2 gap-2">
            <input type="number" id="dt-a11" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="1" />
            <input type="number" id="dt-a12" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="2" />
            <input type="number" id="dt-a21" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="3" />
            <input type="number" id="dt-a22" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="4" />
          </div>
        </div>

        <div id="dt-matrix-3">
          <h3 class="font-semibold text-text mb-2">3&times;3 Matrix</h3>
          <div class="grid grid-cols-3 gap-2">
            <input type="number" id="dt-b11" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="6" />
            <input type="number" id="dt-b12" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="1" />
            <input type="number" id="dt-b13" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="1" />
            <input type="number" id="dt-b21" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="4" />
            <input type="number" id="dt-b22" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="-2" />
            <input type="number" id="dt-b23" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="5" />
            <input type="number" id="dt-b31" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="2" />
            <input type="number" id="dt-b32" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="8" />
            <input type="number" id="dt-b33" class="dt-in w-full px-3 py-2 border border-border rounded-xl text-lg text-center font-mono" value="7" />
          </div>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Determinant</div>
          <div class="text-5xl font-extrabold font-mono" id="dt-result">0</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Invertible?</div>
            <div class="text-xl font-bold" id="dt-invertible">—</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Matrix Size</div>
            <div class="text-xl font-bold" id="dt-size">3&times;3</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Cofactors (First Row)</h3>
          <div class="text-sm text-text-secondary font-mono" id="dt-cofactors"></div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Step-by-Step</h3>
          <div class="text-sm text-text-secondary font-mono whitespace-pre-wrap" id="dt-steps"></div>
        </div>
      </div>

      <ShareButton calculatorId="determinant" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Understanding Matrix Determinants</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>2&times;2:</strong> det = a*d - b*c</p>
        <p><strong>3&times;3:</strong> Cofactor expansion along the first row</p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">Properties</h3>
      <ul>
        <li>A matrix is invertible if and only if its determinant is non-zero</li>
        <li>det(AB) = det(A) &times; det(B)</li>
        <li>Swapping two rows changes the sign of the determinant</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcDT() {
      const mode = (document.getElementById('dt-mode') as HTMLSelectElement).value;
      const is2 = mode === '2';

      document.getElementById('dt-matrix-2')!.classList.toggle('hidden', !is2);
      document.getElementById('dt-matrix-3')!.classList.toggle('hidden', is2);
      document.getElementById('dt-size')!.innerHTML = is2 ? '2&times;2' : '3&times;3';

      let det = 0;
      let cofactorStr = '';
      let steps = '';

      if (is2) {
        const a = parseFloat((document.getElementById('dt-a11') as HTMLInputElement).value) || 0;
        const b = parseFloat((document.getElementById('dt-a12') as HTMLInputElement).value) || 0;
        const c = parseFloat((document.getElementById('dt-a21') as HTMLInputElement).value) || 0;
        const d = parseFloat((document.getElementById('dt-a22') as HTMLInputElement).value) || 0;

        det = a * d - b * c;
        cofactorStr = `C11 = ${d}, C12 = ${-c}`;
        steps = `det = (${a})(${d}) - (${b})(${c})\n    = ${a * d} - ${b * c}\n    = ${det}`;
      } else {
        const v = (id: string) => parseFloat((document.getElementById(id) as HTMLInputElement).value) || 0;
        const a = v('dt-b11'), b = v('dt-b12'), c = v('dt-b13');
        const d = v('dt-b21'), e = v('dt-b22'), f = v('dt-b23');
        const g = v('dt-b31'), h = v('dt-b32'), i = v('dt-b33');

        const c11 = e * i - f * h;
        const c12 = -(d * i - f * g);
        const c13 = d * h - e * g;

        det = a * c11 + b * c12 + c * c13;
        cofactorStr = `C11 = ${c11}, C12 = ${c12}, C13 = ${c13}`;
        steps = `Expanding along Row 1:\n`;
        steps += `det = ${a}(${e}·${i} - ${f}·${h}) - ${b}(${d}·${i} - ${f}·${g}) + ${c}(${d}·${h} - ${e}·${g})\n`;
        steps += `    = ${a}(${c11}) + ${b}(${c12 >= 0 ? '' : ''}${c12}) + ${c}(${c13})\n`;
        steps += `    = ${a * c11} + ${b * c12} + ${c * c13}\n`;
        steps += `    = ${det}`;
      }

      document.getElementById('dt-result')!.textContent = String(det);
      document.getElementById('dt-invertible')!.textContent = det !== 0 ? 'Yes' : 'No (Singular)';
      document.getElementById('dt-cofactors')!.textContent = cofactorStr;
      document.getElementById('dt-steps')!.textContent = steps;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.dt-in').forEach(el => {
        el.addEventListener('input', calcDT);
        el.addEventListener('change', calcDT);
      });
      calcDT();
    }, 50);
  </script>
</CalculatorLayout>
