---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Cooling Tower Calculator - Capacity, Approach & Water Flow";
const description = "Calculate cooling tower capacity, approach temperature, range, evaporation rate, and makeup water requirements from design conditions.";

const relatedCalcs = [
  { name: "Chiller Sizing Calculator", url: "/chiller-sizing-calculator", description: "Chiller tonnage." },
  { name: "Heat Exchanger Calculator", url: "/heat-exchanger-calculator", description: "Heat transfer." },
  { name: "Psychrometric Calculator", url: "/psychrometric-calculator", description: "Air properties." },
  { name: "Cooling Load Calculator", url: "/cooling-load-calculator", description: "Building load." },
  { name: "Fan Law Calculator", url: "/fan-law-calculator", description: "Fan laws." },
  { name: "Refrigeration Cycle Calculator", url: "/refrigeration-cycle-calculator", description: "COP / EER." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Cooling Tower Calculator"
  keywords="cooling tower calculator, cooling tower capacity, approach temperature, range, evaporation rate, makeup water, wet bulb"
  breadcrumbs={[{ name: "Cooling Tower Calculator", url: "/cooling-tower-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Cooling Tower Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate cooling tower capacity, approach, range, and water requirements.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-5">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Hot Water Temp (°F)</label>
            <input type="number" id="ct2-hot" class="ct2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="95" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Cold Water Temp (°F)</label>
            <input type="number" id="ct2-cold" class="ct2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="85" step="1">
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Wet Bulb Temp (°F)</label>
            <input type="number" id="ct2-wb" class="ct2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="78" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Water Flow Rate (GPM)</label>
            <input type="number" id="ct2-gpm" class="ct2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="300" min="1" step="10">
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Cycles of Concentration</label>
            <input type="number" id="ct2-cycles" class="ct2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="2" max="10" step="0.5">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Drift Loss (%)</label>
            <input type="number" id="ct2-drift" class="ct2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.02" min="0" max="1" step="0.01">
          </div>
        </div>

        <!-- Results -->
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Tower Capacity</div>
          <div class="text-4xl font-extrabold" id="ct2-capacity">--</div>
          <div class="text-sm text-blue-200 mt-1">nominal tons</div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Range</div>
            <div class="text-xl font-bold" id="ct2-range">--</div>
            <div class="text-xs text-text-muted">°F</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Approach</div>
            <div class="text-xl font-bold" id="ct2-approach">--</div>
            <div class="text-xs text-text-muted">°F</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Heat Rejection</div>
            <div class="text-xl font-bold" id="ct2-btu">--</div>
            <div class="text-xs text-text-muted">BTU/hr</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Evaporation Rate</div>
            <div class="text-xl font-bold" id="ct2-evap">--</div>
            <div class="text-xs text-text-muted">GPM</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Blowdown Rate</div>
            <div class="text-xl font-bold" id="ct2-blow">--</div>
            <div class="text-xs text-text-muted">GPM</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Makeup Water</div>
            <div class="text-xl font-bold" id="ct2-makeup">--</div>
            <div class="text-xs text-text-muted">GPM</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="cooling-tower" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl mx-auto prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Cooling Tower Calculations</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p>Range = Hot Water Temp - Cold Water Temp</p>
        <p>Approach = Cold Water Temp - Wet Bulb Temp</p>
        <p>Heat Rejection = GPM x 500 x Range (BTU/hr)</p>
        <p>Nominal Tons = Heat Rejection / 15,000</p>
        <p>Evaporation = GPM x Range x 0.001 (approx)</p>
      </div>
      <ul>
        <li><strong>Range:</strong> Temperature drop of water through the tower (typically 10°F)</li>
        <li><strong>Approach:</strong> How close cold water gets to wet bulb (typically 5-10°F)</li>
        <li>A nominal cooling tower ton is 15,000 BTU/hr (not 12,000 BTU/hr)</li>
        <li>Lower approach = larger, more expensive tower</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcCT2() {
      const hotTemp = parseFloat((document.getElementById('ct2-hot') as HTMLInputElement).value) || 0;
      const coldTemp = parseFloat((document.getElementById('ct2-cold') as HTMLInputElement).value) || 0;
      const wetBulb = parseFloat((document.getElementById('ct2-wb') as HTMLInputElement).value) || 0;
      const gpm = parseFloat((document.getElementById('ct2-gpm') as HTMLInputElement).value) || 0;
      const cycles = parseFloat((document.getElementById('ct2-cycles') as HTMLInputElement).value) || 5;
      const driftPct = parseFloat((document.getElementById('ct2-drift') as HTMLInputElement).value) || 0.02;

      const range = hotTemp - coldTemp;
      const approach = coldTemp - wetBulb;

      // Heat rejection: Q = GPM x 500 x range
      const btu = gpm * 500 * range;

      // Nominal tower tons (15,000 BTU/hr per nominal ton)
      const nominalTons = btu / 15000;

      // Evaporation rate: approximately 1% of flow per 10°F range
      const evapRate = gpm * range * 0.001;

      // Drift loss
      const driftRate = gpm * (driftPct / 100);

      // Blowdown = Evaporation / (Cycles - 1) - Drift
      const blowdown = Math.max(0, evapRate / (cycles - 1) - driftRate);

      // Total makeup = evaporation + blowdown + drift
      const makeup = evapRate + blowdown + driftRate;

      document.getElementById('ct2-capacity')!.textContent = nominalTons.toFixed(1);
      document.getElementById('ct2-range')!.textContent = range.toFixed(1);
      document.getElementById('ct2-approach')!.textContent = approach.toFixed(1);
      document.getElementById('ct2-btu')!.textContent = Math.round(btu).toLocaleString();
      document.getElementById('ct2-evap')!.textContent = evapRate.toFixed(2);
      document.getElementById('ct2-blow')!.textContent = blowdown.toFixed(2);
      document.getElementById('ct2-makeup')!.textContent = makeup.toFixed(2);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.ct2-in').forEach(el => {
        el.addEventListener('input', calcCT2);
        el.addEventListener('change', calcCT2);
      });
      calcCT2();
    }, 50);
  </script>
</CalculatorLayout>
