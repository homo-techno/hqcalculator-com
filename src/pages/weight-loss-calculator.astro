---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Weight Loss Calculator - Calorie Deficit & Timeline Planner";
const description = "Calculate how long it will take to reach your goal weight. Find your daily calorie target for safe, sustainable weight loss.";

const relatedCalcs = [
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calorie needs." },
  { name: "TDEE Calculator", url: "/tdee-calculator", description: "Total daily energy." },
  { name: "BMR Calculator", url: "/bmr-calculator", description: "Basal metabolic rate." },
  { name: "Macro Calculator", url: "/macro-calculator", description: "Macro split calculator." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body Mass Index." },
  { name: "Body Fat Calculator", url: "/body-fat-calculator", description: "Body fat percentage." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Weight Loss Calculator" keywords="weight loss calculator, calorie deficit calculator, how long to lose weight, weight loss timeline, diet calculator" breadcrumbs={[{ name: "Weight Loss Calculator", url: "/weight-loss-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Weight Loss Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find out how long it will take to reach your goal weight with a personalized calorie plan.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="mb-5"><label class="block text-sm font-medium text-text mb-2">Gender</label><div class="flex gap-2"><button class="wl-gender-btn flex-1 py-2.5 rounded-xl font-semibold bg-primary text-white border border-primary" data-gender="male">Male</button><button class="wl-gender-btn flex-1 py-2.5 rounded-xl font-semibold bg-surface-alt text-text-secondary border border-border" data-gender="female">Female</button></div></div>
          <div class="grid grid-cols-2 gap-3 mb-5">
            <div><label class="block text-xs font-medium text-text mb-1">Age</label><input type="number" id="wl-age" class="w-full px-3 py-2.5 border border-border rounded-xl text-lg" value="30" min="15" max="120"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Height (cm)</label><input type="number" id="wl-height" class="w-full px-3 py-2.5 border border-border rounded-xl text-lg" value="175" min="120" max="230"></div>
          </div>
          <div class="grid grid-cols-2 gap-3 mb-5">
            <div><label class="block text-xs font-medium text-text mb-1">Current Weight (kg)</label><input type="number" id="wl-current" class="w-full px-3 py-2.5 border border-border rounded-xl text-lg" value="90" min="30" max="300"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Goal Weight (kg)</label><input type="number" id="wl-goal" class="w-full px-3 py-2.5 border border-border rounded-xl text-lg" value="75" min="30" max="300"></div>
          </div>
          <div class="mb-5"><label class="block text-sm font-medium text-text mb-1">Activity Level</label><select id="wl-activity" class="w-full px-3 py-2.5 border border-border rounded-xl"><option value="1.2">Sedentary</option><option value="1.375">Light Exercise (1-3 days/week)</option><option value="1.55" selected>Moderate Exercise (3-5 days/week)</option><option value="1.725">Heavy Exercise (6-7 days/week)</option><option value="1.9">Athlete</option></select></div>
          <div class="mb-5"><label class="block text-sm font-medium text-text mb-2">Weight Loss Rate</label>
            <div class="space-y-2">
              <label class="flex items-center gap-3 p-3 border border-border rounded-xl cursor-pointer wl-rate-opt"><input type="radio" name="wl-rate" value="0.25" class="text-primary"><div><span class="font-semibold text-sm">Slow (0.25 kg/week)</span><span class="text-xs text-text-muted ml-2">Easiest to maintain</span></div></label>
              <label class="flex items-center gap-3 p-3 border border-primary rounded-xl cursor-pointer bg-primary/5 wl-rate-opt"><input type="radio" name="wl-rate" value="0.5" checked class="text-primary"><div><span class="font-semibold text-sm">Moderate (0.5 kg/week)</span><span class="text-xs text-text-muted ml-2">Recommended</span></div></label>
              <label class="flex items-center gap-3 p-3 border border-border rounded-xl cursor-pointer wl-rate-opt"><input type="radio" name="wl-rate" value="1" class="text-primary"><div><span class="font-semibold text-sm">Fast (1 kg/week)</span><span class="text-xs text-text-muted ml-2">Aggressive deficit</span></div></label>
            </div>
          </div>
        </div>
        <div class="space-y-4">
          <div class="p-6 bg-primary rounded-2xl text-white text-center"><div class="text-sm text-blue-200 uppercase mb-1">Time to Goal</div><div class="text-4xl font-extrabold" id="wl-time">0 weeks</div></div>
          <div class="p-5 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Daily Calorie Target</div><div class="text-3xl font-bold text-primary" id="wl-calories">0 cal</div></div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Your TDEE</div><div class="text-xl font-bold" id="wl-tdee">0</div></div>
            <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Daily Deficit</div><div class="text-xl font-bold text-danger" id="wl-deficit">0</div></div>
            <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Weight to Lose</div><div class="text-xl font-bold" id="wl-to-lose">0 kg</div></div>
            <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Goal Date</div><div class="text-xl font-bold" id="wl-date">—</div></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl"><h3 class="font-semibold text-sm text-text mb-2">Weight Projection</h3><div class="space-y-1 text-sm" id="wl-timeline"></div></div>
        </div>
      </div>
      <ShareButton calculatorId="weight-loss" /><FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Weight Loss Works</h2>
      <p>Weight loss occurs when you consume fewer calories than you burn (calorie deficit). 1 kg of body fat ≈ 7,700 calories. To lose 0.5 kg per week, you need a daily deficit of about 550 calories.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">Daily Deficit = (Weight to lose × 7700) / (Weeks × 7)</div>
      <h3 class="text-xl font-semibold text-text mt-8">Safe Weight Loss Guidelines</h3>
      <ul><li>Lose 0.5-1 kg (1-2 lbs) per week maximum</li><li>Never eat below 1200 cal (women) or 1500 cal (men)</li><li>Prioritize protein (1.6-2.2g/kg) to preserve muscle</li><li>Include strength training to maintain muscle mass</li></ul>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    let wlGender = 'male';
    function calcWL() {
      const age = parseFloat((document.getElementById('wl-age') as HTMLInputElement).value) || 0;
      const height = parseFloat((document.getElementById('wl-height') as HTMLInputElement).value) || 0;
      const current = parseFloat((document.getElementById('wl-current') as HTMLInputElement).value) || 0;
      const goal = parseFloat((document.getElementById('wl-goal') as HTMLInputElement).value) || 0;
      const activity = parseFloat((document.getElementById('wl-activity') as HTMLSelectElement).value);
      const rate = parseFloat((document.querySelector('input[name="wl-rate"]:checked') as HTMLInputElement)?.value || '0.5');
      let bmr = wlGender === 'male' ? 10 * current + 6.25 * height - 5 * age + 5 : 10 * current + 6.25 * height - 5 * age - 161;
      const tdee = Math.round(bmr * activity);
      const toLose = Math.max(0, current - goal);
      const weeks = rate > 0 ? Math.ceil(toLose / rate) : 0;
      const dailyDeficit = Math.round(rate * 7700 / 7);
      const targetCal = Math.max(wlGender === 'male' ? 1500 : 1200, tdee - dailyDeficit);
      const goalDate = new Date(); goalDate.setDate(goalDate.getDate() + weeks * 7);
      document.getElementById('wl-time')!.textContent = weeks > 0 ? (weeks < 8 ? weeks + ' weeks' : Math.round(weeks / 4.33) + ' months') : 'Already there!';
      document.getElementById('wl-calories')!.textContent = targetCal + ' cal';
      document.getElementById('wl-tdee')!.textContent = tdee + ' cal';
      document.getElementById('wl-deficit')!.textContent = '-' + dailyDeficit + ' cal';
      document.getElementById('wl-to-lose')!.textContent = toLose.toFixed(1) + ' kg';
      document.getElementById('wl-date')!.textContent = weeks > 0 ? goalDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : '—';
      const timeline = document.getElementById('wl-timeline')!;
      const steps: string[] = [];
      for (let w = 4; w <= weeks && steps.length < 8; w += Math.max(4, Math.floor(weeks / 8))) {
        const lost = Math.min(toLose, rate * w);
        steps.push(`<div class="flex justify-between"><span class="text-text-muted">Week ${w}</span><span class="font-medium">${(current - lost).toFixed(1)} kg</span></div>`);
      }
      if (weeks > 0) steps.push(`<div class="flex justify-between font-semibold text-primary"><span>Goal (Week ${weeks})</span><span>${goal} kg</span></div>`);
      timeline.innerHTML = steps.join('');
      document.querySelectorAll('.wl-rate-opt').forEach(opt => { const r = opt.querySelector('input') as HTMLInputElement; if (r.checked) { opt.classList.add('border-primary', 'bg-primary/5'); opt.classList.remove('border-border'); } else { opt.classList.remove('border-primary', 'bg-primary/5'); opt.classList.add('border-border'); } });
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.wl-gender-btn').forEach(btn => { btn.addEventListener('click', () => { document.querySelectorAll('.wl-gender-btn').forEach(b => { b.classList.remove('bg-primary','text-white','border-primary'); b.classList.add('bg-surface-alt','text-text-secondary','border-border'); }); btn.classList.remove('bg-surface-alt','text-text-secondary','border-border'); btn.classList.add('bg-primary','text-white','border-primary'); wlGender = (btn as HTMLElement).dataset.gender || 'male'; calcWL(); }); });
      ['wl-age','wl-height','wl-current','wl-goal'].forEach(id => document.getElementById(id)!.addEventListener('input', calcWL));
      document.getElementById('wl-activity')!.addEventListener('change', calcWL);
      document.querySelectorAll('input[name="wl-rate"]').forEach(r => r.addEventListener('change', calcWL));
      calcWL();
    }, 50);
  </script>
</CalculatorLayout>
