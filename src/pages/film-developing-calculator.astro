---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Film Developing Calculator - Chemical Dilution, Dev Time & Tank Volumes";
const description = "Calculate film developing chemical dilution ratios, development time by temperature, push/pull adjustments, and tank volumes for darkroom processing.";
const relatedCalcs = [
  { name: "Dilution Calculator", url: "/dilution-calculator", description: "General dilution ratios." },
  { name: "Exposure Calculator", url: "/exposure-calculator", description: "Exposure settings." },
  { name: "Coffee Ratio", url: "/coffee-ratio-calculator", description: "Ratio calculations." },
  { name: "Color Temperature", url: "/color-temperature-calculator", description: "Color temp conversions." },
  { name: "Photo Resolution", url: "/photo-resolution-calculator", description: "Image resolution." },
  { name: "Ratio Calculator", url: "/ratio-calculator", description: "General ratio math." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Film Developing Calculator" keywords="film developing calculator, darkroom timer, chemical dilution, development time, push pull film, tank volume, developer dilution" breadcrumbs={[{ name: "Film Developing", url: "/film-developing-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Film Developing Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate chemical dilutions, development times by temperature, and push/pull adjustments for film processing.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Tank Type</label>
          <select id="fd-tank" class="fd-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="300" selected>Single Reel (300ml / 35mm)</option>
            <option value="600">Double Reel (600ml / 35mm x2)</option>
            <option value="500">Single Reel (500ml / 120)</option>
            <option value="1000">Double Reel (1000ml / 120 x2)</option>
            <option value="0">Custom Volume</option>
          </select>
        </div>
        <div id="fd-custom-vol-wrap" style="display:none">
          <label class="block text-sm font-medium text-text mb-1">Custom Tank Volume (ml)</label>
          <input type="number" id="fd-custom-vol" class="fd-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="300" min="100" step="10">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Developer Dilution</label>
          <select id="fd-dilution" class="fd-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="0">Stock (undiluted)</option>
            <option value="1" selected>1+1</option>
            <option value="3">1+3</option>
            <option value="4">1+4</option>
            <option value="7">1+7</option>
            <option value="9">1+9</option>
            <option value="14">1+14</option>
            <option value="19">1+19</option>
            <option value="24">1+24</option>
            <option value="31">1+31</option>
            <option value="49">1+49</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Base Development Time (minutes at 20C/68F)</label>
          <input type="number" id="fd-basetime" class="fd-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="9" min="1" max="120" step="0.5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Actual Temperature</label>
          <div class="flex gap-2">
            <input type="number" id="fd-temp" class="fd-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="20" min="15" max="30" step="0.5">
            <select id="fd-tempunit" class="fd-in px-4 py-3 border border-border rounded-xl text-lg">
              <option value="C" selected>C</option>
              <option value="F">F</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Push / Pull (stops)</label>
          <select id="fd-push" class="fd-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="-2">Pull -2</option>
            <option value="-1">Pull -1</option>
            <option value="0" selected>Normal</option>
            <option value="1">Push +1</option>
            <option value="2">Push +2</option>
            <option value="3">Push +3</option>
          </select>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Adjusted Development Time</div>
          <div class="text-4xl font-extrabold" id="fd-time"></div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Developer Volume</div>
            <div class="text-xl font-bold text-text" id="fd-dev-vol"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Water Volume</div>
            <div class="text-xl font-bold text-text" id="fd-water-vol"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Total Solution</div>
            <div class="text-xl font-bold text-text" id="fd-total-vol"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Temp Adjustment</div>
            <div class="text-xl font-bold text-text" id="fd-temp-adj"></div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h4 class="font-semibold text-sm text-text mb-2">Processing Steps Reminder</h4>
          <div class="text-sm text-text-secondary space-y-1">
            <div>1. Developer: <span class="font-bold" id="fd-step-dev"></span></div>
            <div>2. Stop Bath: 1 minute</div>
            <div>3. Fixer: 5-8 minutes</div>
            <div>4. Wash: 10-15 minutes</div>
            <div>5. Photo-Flo / Wetting Agent: 1 minute</div>
            <div>6. Hang to dry: 2-4 hours</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="film-developing" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Film Developing Basics</h2>
      <p>Development time varies with temperature, dilution, and push/pull processing. The standard reference temperature is 20C (68F). Higher temperatures speed up development.</p>
      <p><strong>Temperature compensation:</strong> For each degree Celsius above 20, reduce development time by approximately 10%. Below 20, increase by 10% per degree.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcFD() {
      const tankVal = parseInt((document.getElementById('fd-tank') as HTMLSelectElement).value);
      let tankVol = tankVal;
      if (tankVal === 0) {
        document.getElementById('fd-custom-vol-wrap')!.style.display = '';
        tankVol = parseInt((document.getElementById('fd-custom-vol') as HTMLInputElement).value) || 300;
      } else {
        document.getElementById('fd-custom-vol-wrap')!.style.display = 'none';
      }

      const dilParts = parseInt((document.getElementById('fd-dilution') as HTMLSelectElement).value);
      const baseTime = parseFloat((document.getElementById('fd-basetime') as HTMLInputElement).value) || 9;
      let temp = parseFloat((document.getElementById('fd-temp') as HTMLInputElement).value) || 20;
      const tempUnit = (document.getElementById('fd-tempunit') as HTMLSelectElement).value;
      const pushStops = parseInt((document.getElementById('fd-push') as HTMLSelectElement).value);

      let tempC = tempUnit === 'F' ? (temp - 32) * 5 / 9 : temp;

      // Temperature compensation: ~10% per degree from 20C
      const tempFactor = Math.pow(0.9, tempC - 20);
      let adjustedTime = baseTime * tempFactor;

      // Push/pull: +1 stop ~ +40% time, pull ~ -20% per stop
      if (pushStops > 0) {
        adjustedTime *= (1 + pushStops * 0.4);
      } else if (pushStops < 0) {
        adjustedTime *= Math.pow(0.8, Math.abs(pushStops));
      }

      const mins = Math.floor(adjustedTime);
      const secs = Math.round((adjustedTime - mins) * 60);

      document.getElementById('fd-time')!.textContent = mins + ':' + String(secs).padStart(2, '0');

      // Dilution volumes
      const totalParts = 1 + dilParts;
      const devVol = dilParts === 0 ? tankVol : Math.round(tankVol / totalParts);
      const waterVol = tankVol - devVol;

      document.getElementById('fd-dev-vol')!.textContent = devVol + ' ml';
      document.getElementById('fd-water-vol')!.textContent = waterVol + ' ml';
      document.getElementById('fd-total-vol')!.textContent = tankVol + ' ml';

      const tempDiffPct = ((1 - tempFactor) * 100);
      const sign = tempDiffPct >= 0 ? '+' : '';
      document.getElementById('fd-temp-adj')!.textContent = sign + tempDiffPct.toFixed(0) + '% (' + tempC.toFixed(1) + '\u00B0C)';

      document.getElementById('fd-step-dev')!.textContent = mins + ':' + String(secs).padStart(2, '0') + ' (agitate first 30s, then 10s every minute)';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.fd-in').forEach(el => {
        el.addEventListener('input', calcFD);
        el.addEventListener('change', calcFD);
      });
      calcFD();
    }, 50);
  </script>
</CalculatorLayout>
