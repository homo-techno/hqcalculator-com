---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Geothermal Gradient Calculator - Temperature at Depth";
const description = "Calculate temperature at depth from surface temperature and geothermal gradient. Estimate heat flow and thermal conductivity for geological studies.";
const relatedCalcs = [
  { name: "Temperature Converter", url: "/temperature-converter", description: "Convert temperatures." },
  { name: "Heat Transfer Calculator", url: "/heat-transfer-calculator", description: "Heat transfer." },
  { name: "Density Calculator", url: "/density-calculator", description: "Material density." },
  { name: "Energy Converter", url: "/energy-converter", description: "Energy units." },
  { name: "Pressure Converter", url: "/pressure-converter", description: "Pressure units." },
  { name: "Earthquake Magnitude", url: "/earthquake-magnitude-calculator", description: "Earthquake scale." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Geothermal Gradient Calculator" keywords="geothermal gradient, temperature at depth, heat flow, thermal conductivity, geothermal energy" breadcrumbs={[{ name: "Geothermal Gradient", url: "/geothermal-gradient-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Geothermal Gradient Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate subsurface temperature at any depth using geothermal gradient, and calculate heat flow from thermal conductivity.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Surface Temperature (°C)</label>
            <input type="number" id="gg-surface" class="gg-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="15" step="0.5">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Geothermal Gradient (°C/km)</label>
            <input type="number" id="gg-gradient" class="gg-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="25" min="0" step="1">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Target Depth (m)</label>
            <input type="number" id="gg-depth" class="gg-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="3000" min="0" step="100">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Thermal Conductivity (W/m·K)</label>
            <input type="number" id="gg-conduct" class="gg-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="2.5" min="0" step="0.1">
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Geological Setting</label>
          <select id="gg-setting" class="gg-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="25">Continental Average (25°C/km)</option>
            <option value="30">Active Rift Zone (30°C/km)</option>
            <option value="40">Volcanic Region (40°C/km)</option>
            <option value="60">Geothermal Hotspot (60°C/km)</option>
            <option value="15">Stable Craton (15°C/km)</option>
            <option value="20">Oceanic Crust (20°C/km)</option>
            <option value="0">Custom</option>
          </select>
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Temperature at Depth</div>
          <div class="text-4xl font-extrabold" id="gg-temp">0°C</div>
          <div class="text-sm text-blue-200 mt-1" id="gg-tempf">0°F</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Heat Flow</div>
            <div class="text-xl font-bold" id="gg-heatflow">0 mW/m²</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Depth (km)</div>
            <div class="text-xl font-bold" id="gg-depthkm">0 km</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Temp Increase</div>
            <div class="text-xl font-bold" id="gg-increase">0°C</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Boiling Depth</div>
            <div class="text-xl font-bold" id="gg-boiling">0 m</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Geothermal Suitability</div>
          <div class="text-xl font-bold" id="gg-suit">--</div>
        </div>
      </div>

      <ShareButton calculatorId="geothermal-gradient" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Geothermal Gradient Formula</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>T(depth)</strong> = T(surface) + Gradient x Depth</p>
        <p><strong>Heat Flow</strong> = Thermal Conductivity x Gradient (in °C/m)</p>
        <p><strong>Boiling Depth</strong> = (100 - T(surface)) / Gradient x 1000</p>
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcGG() {
      const surface = parseFloat((document.getElementById('gg-surface') as HTMLInputElement).value) || 0;
      let gradient = parseFloat((document.getElementById('gg-gradient') as HTMLInputElement).value) || 0;
      const depth = parseFloat((document.getElementById('gg-depth') as HTMLInputElement).value) || 0;
      const conduct = parseFloat((document.getElementById('gg-conduct') as HTMLInputElement).value) || 0;

      const setting = (document.getElementById('gg-setting') as HTMLSelectElement).value;
      if (setting !== '0') {
        gradient = parseFloat(setting);
        (document.getElementById('gg-gradient') as HTMLInputElement).value = setting;
      }

      const depthKm = depth / 1000;
      const tempIncrease = gradient * depthKm;
      const tempAtDepth = surface + tempIncrease;
      const tempF = tempAtDepth * 9 / 5 + 32;
      const heatFlow = conduct * (gradient / 1000) * 1000;
      const boilingDepth = gradient > 0 ? ((100 - surface) / gradient) * 1000 : 0;

      let suitability = '';
      if (tempAtDepth >= 150) suitability = 'Excellent - Power Generation';
      else if (tempAtDepth >= 100) suitability = 'Good - Binary Power Plant';
      else if (tempAtDepth >= 50) suitability = 'Moderate - Direct Use Heating';
      else if (tempAtDepth >= 25) suitability = 'Low - Ground Source Heat Pump';
      else suitability = 'Minimal geothermal potential';

      const fmt = (n: number) => n.toLocaleString('en-US', { maximumFractionDigits: 1 });

      document.getElementById('gg-temp')!.textContent = fmt(tempAtDepth) + '\u00B0C';
      document.getElementById('gg-tempf')!.textContent = fmt(tempF) + '\u00B0F';
      document.getElementById('gg-heatflow')!.textContent = fmt(heatFlow) + ' mW/m\u00B2';
      document.getElementById('gg-depthkm')!.textContent = (depthKm).toFixed(2) + ' km';
      document.getElementById('gg-increase')!.textContent = '+' + fmt(tempIncrease) + '\u00B0C';
      document.getElementById('gg-boiling')!.textContent = fmt(boilingDepth) + ' m';
      document.getElementById('gg-suit')!.textContent = suitability;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.gg-in').forEach(el => { el.addEventListener('input', calcGG); el.addEventListener('change', calcGG); });
      calcGG();
    }, 50);
  </script>
</CalculatorLayout>
