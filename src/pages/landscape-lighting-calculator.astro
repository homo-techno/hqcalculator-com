---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Landscape Lighting Calculator - Fixtures, Transformer & Wiring";
const description = "Calculate landscape lighting fixture count, transformer wattage, wire run length, and voltage drop per run for low-voltage outdoor lighting systems.";
const relatedCalcs = [
  { name: "Lighting", url: "/lighting-calculator", description: "Lighting design." },
  { name: "Wire Gauge", url: "/wire-gauge-calculator", description: "Wire sizing." },
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Energy costs." },
  { name: "Voltage Divider", url: "/voltage-divider-calculator", description: "Voltage division." },
  { name: "LED Resistor", url: "/led-resistor-calculator", description: "LED circuits." },
  { name: "Solar Panel", url: "/solar-panel-calculator", description: "Solar sizing." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Landscape Lighting Calculator" keywords="landscape lighting calculator, low voltage lighting, transformer sizing, outdoor light fixtures, wire run voltage drop" breadcrumbs={[{ name: "Landscape Lighting", url: "/landscape-lighting-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Landscape Lighting Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Size your low-voltage landscape lighting system with proper transformer and wiring.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Fixture Counts</h3>
          <div class="grid grid-cols-2 gap-2">
            <div><label class="block text-xs text-text-muted">Path Lights (3W each)</label><input type="number" id="ll-path" class="ll-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="8" min="0"></div>
            <div><label class="block text-xs text-text-muted">Spot/Up Lights (5W each)</label><input type="number" id="ll-spot" class="ll-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="4" min="0"></div>
            <div><label class="block text-xs text-text-muted">Flood Lights (10W each)</label><input type="number" id="ll-flood" class="ll-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="2" min="0"></div>
            <div><label class="block text-xs text-text-muted">Deck/Step Lights (2W each)</label><input type="number" id="ll-deck" class="ll-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="6" min="0"></div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Total Wire Run (feet)</label>
            <input type="number" id="ll-run" class="ll-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="150" min="10" step="10">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Wire Gauge</label>
            <select id="ll-gauge" class="ll-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="16">16 AWG (up to 150 ft)</option>
              <option value="14">14 AWG (up to 200 ft)</option>
              <option value="12" selected>12 AWG (up to 250 ft)</option>
              <option value="10">10 AWG (up to 300+ ft)</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">System Voltage</label>
            <select id="ll-volts" class="ll-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="12" selected>12V (standard)</option>
              <option value="15">15V (long runs)</option>
              <option value="24">24V (commercial)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Hours Per Night</label>
            <input type="number" id="ll-hrs" class="ll-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="1" max="12" step="1">
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Transformer</div>
          <div class="text-5xl font-extrabold font-mono" id="ll-result">0 W</div>
          <div class="text-sm text-blue-200 mt-1" id="ll-note">-</div>
        </div>
        <div class="p-4 rounded-xl text-center" id="ll-status-box">
          <div class="font-bold text-sm" id="ll-status">-</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Fixtures</div>
            <div class="text-xl font-bold font-mono" id="ll-count">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Watts</div>
            <div class="text-xl font-bold font-mono" id="ll-watts">0 W</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Voltage Drop</div>
            <div class="text-xl font-bold font-mono" id="ll-drop">0%</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Current Draw</div>
            <div class="text-xl font-bold font-mono" id="ll-amps">0 A</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Monthly Cost</div>
            <div class="text-xl font-bold font-mono" id="ll-monthly">$0</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="landscape-lighting" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    const LL_WIRE_RES: Record<string, number> = { '16': 4.016, '14': 2.525, '12': 1.588, '10': 0.999 };

    function calcLL() {
      const path = parseInt((document.getElementById('ll-path') as HTMLInputElement).value) || 0;
      const spot = parseInt((document.getElementById('ll-spot') as HTMLInputElement).value) || 0;
      const flood = parseInt((document.getElementById('ll-flood') as HTMLInputElement).value) || 0;
      const deck = parseInt((document.getElementById('ll-deck') as HTMLInputElement).value) || 0;
      const wireRun = parseFloat((document.getElementById('ll-run') as HTMLInputElement).value) || 150;
      const gauge = (document.getElementById('ll-gauge') as HTMLSelectElement).value;
      const sysVolt = parseFloat((document.getElementById('ll-volts') as HTMLSelectElement).value) || 12;
      const hrs = parseFloat((document.getElementById('ll-hrs') as HTMLInputElement).value) || 6;

      const totalFixtures = path + spot + flood + deck;
      const totalWatts = path * 3 + spot * 5 + flood * 10 + deck * 2;
      const totalAmps = sysVolt > 0 ? totalWatts / sysVolt : 0;

      // Voltage drop: V = I * R * 2 * L / 1000 (round trip)
      const rPer1000 = LL_WIRE_RES[gauge] || 1.588;
      const vDrop = totalAmps * rPer1000 * wireRun * 2 / 1000;
      const vDropPct = sysVolt > 0 ? (vDrop / sysVolt) * 100 : 0;

      // Transformer sizing: total watts + 20% headroom
      const transWatts = Math.ceil(totalWatts * 1.2);
      // Standard transformer sizes
      const transSizes = [60, 100, 150, 200, 300, 600, 900];
      const recTrans = transSizes.find(t => t >= transWatts) || 900;

      // Monthly cost (120V input side)
      const monthlyCost = (totalWatts * hrs * 30) / 1000 * 0.14;

      document.getElementById('ll-result')!.textContent = recTrans + ' W';
      document.getElementById('ll-note')!.textContent = totalWatts + 'W load on ' + sysVolt + 'V system';
      document.getElementById('ll-count')!.textContent = totalFixtures.toString();
      document.getElementById('ll-watts')!.textContent = totalWatts + ' W';
      document.getElementById('ll-drop')!.textContent = vDropPct.toFixed(1) + '%';
      document.getElementById('ll-amps')!.textContent = totalAmps.toFixed(1) + ' A';
      document.getElementById('ll-monthly')!.textContent = '$' + monthlyCost.toFixed(2);

      let status: string, color: string;
      if (vDropPct > 10) {
        status = 'Voltage drop too high (' + vDropPct.toFixed(1) + '%) — use heavier gauge wire or split into runs';
        color = 'bg-red-50 text-red-800';
      } else if (vDropPct > 5) {
        status = 'Voltage drop ' + vDropPct.toFixed(1) + '% — consider upgrading wire or using hub method';
        color = 'bg-yellow-50 text-yellow-800';
      } else {
        status = 'Voltage drop within 5% — system properly sized';
        color = 'bg-green-50 text-green-800';
      }
      document.getElementById('ll-status')!.textContent = status;
      document.getElementById('ll-status-box')!.className = 'p-4 rounded-xl text-center ' + color;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.ll-in').forEach(el => {
        el.addEventListener('input', calcLL);
        el.addEventListener('change', calcLL);
      });
      calcLL();
    }, 50);
  </script>
</CalculatorLayout>
