---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Set Theory Calculator - Union, Intersection & More";
const description = "Perform set operations on two sets. Shows union, intersection, difference, symmetric difference, and cardinality.";

const relatedCalcs = [
  { name: "Boolean Algebra", url: "/boolean-algebra-calculator", description: "Boolean logic operations." },
  { name: "Probability Calculator", url: "/probability-calculator", description: "General probability." },
  { name: "Average Calculator", url: "/average-calculator", description: "Mean, median, mode." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage calculations." },
  { name: "Number Sequence", url: "/number-sequence-calculator", description: "Sequence detection." },
  { name: "Correlation Calculator", url: "/correlation-calculator", description: "Pearson correlation." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Set Theory Calculator"
  keywords="set theory calculator, union intersection, set difference, symmetric difference, cardinality, venn diagram"
  breadcrumbs={[{ name: "Set Theory Calculator", url: "/set-theory-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Set Theory Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Enter two sets (comma-separated values) to compute union, intersection, differences, and more.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Set A <span class="text-text-muted">(comma-separated)</span></label>
          <textarea id="st2-a" class="st2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-mono" rows="2" placeholder="1, 2, 3, 4, 5">1, 2, 3, 4, 5</textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Set B <span class="text-text-muted">(comma-separated)</span></label>
          <textarea id="st2-b" class="st2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-mono" rows="2" placeholder="3, 4, 5, 6, 7">3, 4, 5, 6, 7</textarea>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">A &cup; B (Union)</div>
          <div class="text-2xl font-extrabold font-mono break-all" id="st2-result">{}</div>
        </div>

        <div class="grid grid-cols-1 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl">
            <div class="text-xs text-text-muted uppercase mb-1">A &cap; B (Intersection)</div>
            <div class="text-lg font-bold font-mono" id="st2-inter">{}</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl">
            <div class="text-xs text-text-muted uppercase mb-1">A &minus; B (Difference)</div>
            <div class="text-lg font-bold font-mono" id="st2-diffab">{}</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl">
            <div class="text-xs text-text-muted uppercase mb-1">B &minus; A (Difference)</div>
            <div class="text-lg font-bold font-mono" id="st2-diffba">{}</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl">
            <div class="text-xs text-text-muted uppercase mb-1">A &Delta; B (Symmetric Difference)</div>
            <div class="text-lg font-bold font-mono" id="st2-sym">{}</div>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">|A|</div>
            <div class="text-xl font-bold" id="st2-carda">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">|B|</div>
            <div class="text-xl font-bold" id="st2-cardb">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">|A &cup; B|</div>
            <div class="text-xl font-bold" id="st2-cardu">0</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Set Properties</h3>
          <div class="text-sm text-text-secondary whitespace-pre-wrap" id="st2-props"></div>
        </div>
      </div>

      <ShareButton calculatorId="set-theory" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Set Operations</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Union (A &cup; B):</strong> All elements in A or B (or both)</p>
        <p><strong>Intersection (A &cap; B):</strong> Elements in both A and B</p>
        <p><strong>Difference (A &minus; B):</strong> Elements in A but not in B</p>
        <p><strong>Symmetric Difference (A &Delta; B):</strong> Elements in A or B, but not both</p>
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function parseSet(input: string): string[] {
      return [...new Set(input.split(',').map(s => s.trim()).filter(s => s.length > 0))];
    }

    function formatSet(arr: string[]): string {
      return arr.length === 0 ? '{ } (empty set)' : '{ ' + arr.join(', ') + ' }';
    }

    function calcST2() {
      const setA = parseSet((document.getElementById('st2-a') as HTMLTextAreaElement).value);
      const setB = parseSet((document.getElementById('st2-b') as HTMLTextAreaElement).value);

      const bSet = new Set(setB);
      const aSet = new Set(setA);

      const union = [...new Set([...setA, ...setB])];
      const intersection = setA.filter(x => bSet.has(x));
      const diffAB = setA.filter(x => !bSet.has(x));
      const diffBA = setB.filter(x => !aSet.has(x));
      const symDiff = [...diffAB, ...diffBA];

      document.getElementById('st2-result')!.textContent = formatSet(union);
      document.getElementById('st2-inter')!.textContent = formatSet(intersection);
      document.getElementById('st2-diffab')!.textContent = formatSet(diffAB);
      document.getElementById('st2-diffba')!.textContent = formatSet(diffBA);
      document.getElementById('st2-sym')!.textContent = formatSet(symDiff);

      document.getElementById('st2-carda')!.textContent = String(setA.length);
      document.getElementById('st2-cardb')!.textContent = String(setB.length);
      document.getElementById('st2-cardu')!.textContent = String(union.length);

      let props = '';
      const isSubsetAB = setA.every(x => bSet.has(x));
      const isSubsetBA = setB.every(x => aSet.has(x));
      const isEqual = isSubsetAB && isSubsetBA;
      const isDisjoint = intersection.length === 0;

      props += `A ⊆ B: ${isSubsetAB ? 'Yes' : 'No'}\n`;
      props += `B ⊆ A: ${isSubsetBA ? 'Yes' : 'No'}\n`;
      props += `A = B: ${isEqual ? 'Yes' : 'No'}\n`;
      props += `Disjoint: ${isDisjoint ? 'Yes (no common elements)' : 'No'}\n`;
      props += `|A ∩ B| = ${intersection.length}\n`;
      props += `|A ∪ B| = |A| + |B| - |A ∩ B| = ${setA.length} + ${setB.length} - ${intersection.length} = ${union.length}`;

      document.getElementById('st2-props')!.textContent = props;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.st2-in').forEach(el => {
        el.addEventListener('input', calcST2);
        el.addEventListener('change', calcST2);
      });
      calcST2();
    }, 50);
  </script>
</CalculatorLayout>
