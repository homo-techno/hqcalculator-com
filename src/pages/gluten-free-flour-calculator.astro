---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Gluten-Free Flour Calculator - Blend Ratios & Xanthan Gum";
const description = "Calculate gluten-free flour blend ratios and xanthan gum amounts for baking. Create custom GF flour mixes for bread, cakes, cookies, and pastries.";
const relatedCalcs = [
  { name: "Bread Flour Calculator", url: "/bread-flour-calculator", description: "Flour protein content and substitutions." },
  { name: "Baker's Percentage Calculator", url: "/baker-percentage-calculator", description: "Calculate baker's percentages." },
  { name: "Baking Conversion Calculator", url: "/baking-conversion-calculator", description: "Convert between baking units." },
  { name: "Cookie Batch Calculator", url: "/cookie-batch-calculator", description: "Scale cookie recipes." },
  { name: "Cake Pan Converter", url: "/cake-pan-converter-calculator", description: "Convert between pan sizes." },
  { name: "Baking Altitude Calculator", url: "/baking-altitude-calculator", description: "High altitude adjustments." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Gluten-Free Flour Calculator" keywords="gluten free flour, GF flour blend, xanthan gum, rice flour blend, gluten free baking, flour substitute" breadcrumbs={[{ name: "Gluten-Free Flour", url: "/gluten-free-flour-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Gluten-Free Flour Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Create gluten-free flour blends with the right ratios for your baking needs. Get xanthan gum amounts for proper binding.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Blend Type</label>
          <select id="gff-blend" class="gff-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="allpurpose">All-Purpose GF Blend</option>
            <option value="bread">GF Bread Blend (higher protein)</option>
            <option value="cake">GF Cake/Pastry Blend (lighter)</option>
            <option value="cookies">GF Cookie Blend</option>
            <option value="pizza">GF Pizza Dough Blend</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Total Flour Needed (grams)</label>
          <input type="number" id="gff-total" class="gff-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="480" min="50" step="10">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Baking Application</label>
          <select id="gff-app" class="gff-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="bread">Bread / Rolls</option>
            <option value="cake">Cake</option>
            <option value="cookies">Cookies / Bars</option>
            <option value="muffins">Muffins / Quick Bread</option>
            <option value="pie">Pie Crust</option>
            <option value="pancakes">Pancakes / Waffles</option>
          </select>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Xanthan Gum Needed</div>
          <div class="text-5xl font-extrabold font-mono" id="gff-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">White Rice Flour</div>
            <div class="text-xl font-bold font-mono" id="gff-rice">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Starch Component</div>
            <div class="text-xl font-bold font-mono" id="gff-starch">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Protein Flour</div>
            <div class="text-xl font-bold font-mono" id="gff-protein">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Extra Component</div>
            <div class="text-xl font-bold font-mono" id="gff-extra">--</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-muted uppercase mb-2">Blend Details</div>
          <div class="text-sm text-text-secondary" id="gff-details">--</div>
        </div>
      </div>
      <ShareButton calculatorId="gluten-free-flour" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcGFF() {
      const blend = (document.getElementById('gff-blend') as HTMLSelectElement).value;
      const total = parseFloat((document.getElementById('gff-total') as HTMLInputElement).value) || 480;
      const app = (document.getElementById('gff-app') as HTMLSelectElement).value;

      // Blend ratios: rice%, starch%, protein%, extra%
      // Starch = tapioca/potato starch, Protein = sorghum/millet/oat flour, Extra = varies
      const blends: Record<string, {rice: number, starch: number, protein: number, extra: number, starchName: string, proteinName: string, extraName: string, details: string}> = {
        allpurpose: {
          rice: 0.40, starch: 0.30, protein: 0.20, extra: 0.10,
          starchName: 'Tapioca Starch', proteinName: 'Brown Rice Flour', extraName: 'Potato Starch',
          details: 'Versatile blend suitable for most baking. 40% white rice flour + 30% tapioca starch + 20% brown rice flour + 10% potato starch.'
        },
        bread: {
          rice: 0.30, starch: 0.20, protein: 0.35, extra: 0.15,
          starchName: 'Tapioca Starch', proteinName: 'Sorghum Flour', extraName: 'Millet Flour',
          details: 'Higher protein for bread structure. 30% white rice + 20% tapioca + 35% sorghum + 15% millet. Add psyllium husk (1 tbsp per cup) for extra structure.'
        },
        cake: {
          rice: 0.45, starch: 0.35, protein: 0.10, extra: 0.10,
          starchName: 'Cornstarch', proteinName: 'Sweet Rice Flour', extraName: 'Tapioca Starch',
          details: 'Light and tender for cakes and pastries. 45% white rice + 35% cornstarch + 10% sweet rice flour + 10% tapioca.'
        },
        cookies: {
          rice: 0.35, starch: 0.25, protein: 0.25, extra: 0.15,
          starchName: 'Tapioca Starch', proteinName: 'Oat Flour (GF)', extraName: 'Almond Flour',
          details: 'Balanced for cookies with flavor and texture. 35% white rice + 25% tapioca + 25% GF oat flour + 15% almond flour.'
        },
        pizza: {
          rice: 0.30, starch: 0.25, protein: 0.30, extra: 0.15,
          starchName: 'Tapioca Starch', proteinName: 'Sorghum Flour', extraName: 'Potato Starch',
          details: 'Stretchy and chewy for pizza. 30% white rice + 25% tapioca + 30% sorghum + 15% potato starch. Add 2 tsp psyllium husk per cup.'
        },
      };

      // Xanthan gum per cup of GF flour (by application)
      const xanthanPerCup: Record<string, number> = {
        bread: 1.0,      // 1 tsp per cup
        cake: 0.5,       // 1/2 tsp per cup
        cookies: 0.5,    // 1/2 tsp per cup
        muffins: 0.75,   // 3/4 tsp per cup
        pie: 0.5,        // 1/2 tsp per cup
        pancakes: 0.25,  // 1/4 tsp per cup
      };

      const b = blends[blend];
      const riceG = total * b.rice;
      const starchG = total * b.starch;
      const proteinG = total * b.protein;
      const extraG = total * b.extra;

      // 1 cup GF flour ~ 160g
      const cups = total / 160;
      const xanthanTsp = cups * (xanthanPerCup[app] || 0.5);
      const xanthanG = xanthanTsp * 2.5; // ~2.5g per tsp

      document.getElementById('gff-result')!.textContent = xanthanTsp.toFixed(1) + ' tsp (' + xanthanG.toFixed(1) + ' g)';
      document.getElementById('gff-rice')!.textContent = riceG.toFixed(0) + ' g (' + (riceG / 160).toFixed(1) + ' cups)';
      document.getElementById('gff-starch')!.textContent = starchG.toFixed(0) + 'g ' + b.starchName;
      document.getElementById('gff-protein')!.textContent = proteinG.toFixed(0) + 'g ' + b.proteinName;
      document.getElementById('gff-extra')!.textContent = extraG.toFixed(0) + 'g ' + b.extraName;
      document.getElementById('gff-details')!.textContent = b.details;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.gff-in').forEach(el => { el.addEventListener('input', calcGFF); el.addEventListener('change', calcGFF); });
      calcGFF();
    }, 50);
  </script>
</CalculatorLayout>
