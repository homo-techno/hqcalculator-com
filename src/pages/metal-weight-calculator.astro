---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Metal Weight Calculator - Plate, Tube, Bar, Angle & Channel";
const description = "Calculate the weight of metal shapes including plate, round tube, square tube, round bar, flat bar, angle, and channel by material type and dimensions.";

const relatedCalcs = [
  { name: "Structural Steel Calculator", url: "/structural-steel-calculator", description: "I-beam section properties." },
  { name: "Welding Rod Calculator", url: "/welding-rod-calculator", description: "Electrode consumption." },
  { name: "Metal Expansion Calculator", url: "/metal-expansion-calculator", description: "Thermal expansion." },
  { name: "Sheet Metal Bend", url: "/sheet-metal-bend-calculator", description: "Bend allowance." },
  { name: "Metal Finishing Calculator", url: "/metal-finishing-calculator", description: "Surface finishing needs." },
  { name: "Cutting Speed Calculator", url: "/cutting-speed-calculator", description: "Machining speeds." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Metal Weight Calculator"
  keywords="metal weight calculator, steel weight, aluminum weight, plate weight, tube weight, bar weight, angle weight, channel weight, metal density"
  breadcrumbs={[{ name: "Metal Weight Calculator", url: "/metal-weight-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Metal Weight Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate the weight of metal shapes by material type and dimensions.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Material -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Material</label>
        <select id="mw2-material" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="7.85">Mild Steel (7.85 g/cm³)</option>
          <option value="7.98">Stainless Steel 304 (7.98 g/cm³)</option>
          <option value="2.71">Aluminum 6061 (2.71 g/cm³)</option>
          <option value="8.94">Copper (8.94 g/cm³)</option>
          <option value="8.50">Brass (8.50 g/cm³)</option>
          <option value="4.51">Titanium (4.51 g/cm³)</option>
          <option value="7.30">Cast Iron (7.30 g/cm³)</option>
          <option value="11.34">Lead (11.34 g/cm³)</option>
          <option value="7.14">Zinc (7.14 g/cm³)</option>
        </select>
      </div>

      <!-- Shape -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Shape</label>
        <select id="mw2-shape" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="plate">Flat Plate / Sheet</option>
          <option value="roundbar">Round Bar / Rod</option>
          <option value="squarebar">Square Bar</option>
          <option value="flatbar">Flat Bar / Rectangle</option>
          <option value="roundtube">Round Tube / Pipe</option>
          <option value="squaretube">Square Tube</option>
          <option value="angle">Angle (L-Shape)</option>
          <option value="channel">Channel (C-Shape)</option>
        </select>
      </div>

      <!-- Unit System -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Unit System</label>
        <select id="mw2-units" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="imperial">Imperial (inches, feet)</option>
          <option value="metric">Metric (mm, meters)</option>
        </select>
      </div>

      <!-- Dynamic dimensions -->
      <div id="mw2-dims" class="mb-5">
        <!-- Filled by JS -->
      </div>

      <!-- Length -->
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Length</label>
          <input type="number" id="mw2-length" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="48" min="0" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Quantity</label>
          <input type="number" id="mw2-qty" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="1" step="1">
        </div>
      </div>

      <!-- Results -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Weight</div>
        <div class="text-4xl font-extrabold" id="mw2-weight">--</div>
        <div class="text-sm text-blue-200 mt-1" id="mw2-weightunit">lbs</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Weight (kg)</div>
          <div class="text-xl font-bold" id="mw2-kg">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Weight Per Unit Length</div>
          <div class="text-xl font-bold" id="mw2-perlen">--</div>
          <div class="text-xs text-text-muted" id="mw2-perlenunit">lb/ft</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Cross-Section Area</div>
          <div class="text-xl font-bold" id="mw2-area">--</div>
          <div class="text-xs text-text-muted">in²</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Volume</div>
          <div class="text-xl font-bold" id="mw2-vol">--</div>
          <div class="text-xs text-text-muted">in³</div>
        </div>
      </div>

      <ShareButton calculatorId="metal-weight" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Metal Weight</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm">
        <p><strong>Weight</strong> = Volume x Density</p>
        <p><strong>Volume</strong> = Cross-Section Area x Length</p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">Common Metal Densities</h3>
      <ul>
        <li><strong>Mild Steel:</strong> 7.85 g/cm³ (0.284 lb/in³)</li>
        <li><strong>Stainless 304:</strong> 7.98 g/cm³ (0.289 lb/in³)</li>
        <li><strong>Aluminum 6061:</strong> 2.71 g/cm³ (0.098 lb/in³)</li>
        <li><strong>Copper:</strong> 8.94 g/cm³ (0.323 lb/in³)</li>
        <li><strong>Titanium:</strong> 4.51 g/cm³ (0.163 lb/in³)</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function buildDims() {
      const shape = (document.getElementById('mw2-shape') as HTMLSelectElement).value;
      const units = (document.getElementById('mw2-units') as HTMLSelectElement).value;
      const dimUnit = units === 'imperial' ? 'in' : 'mm';
      const container = document.getElementById('mw2-dims')!;

      let html = '';
      if (shape === 'plate') {
        html = `<div class="grid grid-cols-2 gap-4">
          <div><label class="block text-sm font-medium text-text mb-2">Width (${dimUnit})</label>
          <input type="number" id="mw2-d1" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 24 : 600}" min="0" step="0.1"></div>
          <div><label class="block text-sm font-medium text-text mb-2">Thickness (${dimUnit})</label>
          <input type="number" id="mw2-d2" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 0.25 : 6}" min="0" step="0.01"></div></div>`;
      } else if (shape === 'roundbar') {
        html = `<div><label class="block text-sm font-medium text-text mb-2">Diameter (${dimUnit})</label>
          <input type="number" id="mw2-d1" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 1 : 25}" min="0" step="0.01"></div>`;
      } else if (shape === 'squarebar') {
        html = `<div><label class="block text-sm font-medium text-text mb-2">Side (${dimUnit})</label>
          <input type="number" id="mw2-d1" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 1 : 25}" min="0" step="0.01"></div>`;
      } else if (shape === 'flatbar') {
        html = `<div class="grid grid-cols-2 gap-4">
          <div><label class="block text-sm font-medium text-text mb-2">Width (${dimUnit})</label>
          <input type="number" id="mw2-d1" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 2 : 50}" min="0" step="0.1"></div>
          <div><label class="block text-sm font-medium text-text mb-2">Thickness (${dimUnit})</label>
          <input type="number" id="mw2-d2" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 0.25 : 6}" min="0" step="0.01"></div></div>`;
      } else if (shape === 'roundtube') {
        html = `<div class="grid grid-cols-2 gap-4">
          <div><label class="block text-sm font-medium text-text mb-2">OD (${dimUnit})</label>
          <input type="number" id="mw2-d1" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 2 : 50}" min="0" step="0.1"></div>
          <div><label class="block text-sm font-medium text-text mb-2">Wall Thickness (${dimUnit})</label>
          <input type="number" id="mw2-d2" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 0.12 : 3}" min="0" step="0.01"></div></div>`;
      } else if (shape === 'squaretube') {
        html = `<div class="grid grid-cols-2 gap-4">
          <div><label class="block text-sm font-medium text-text mb-2">Side (${dimUnit})</label>
          <input type="number" id="mw2-d1" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 2 : 50}" min="0" step="0.1"></div>
          <div><label class="block text-sm font-medium text-text mb-2">Wall Thickness (${dimUnit})</label>
          <input type="number" id="mw2-d2" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 0.12 : 3}" min="0" step="0.01"></div></div>`;
      } else if (shape === 'angle') {
        html = `<div class="grid grid-cols-3 gap-4">
          <div><label class="block text-sm font-medium text-text mb-2">Leg A (${dimUnit})</label>
          <input type="number" id="mw2-d1" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 2 : 50}" min="0" step="0.1"></div>
          <div><label class="block text-sm font-medium text-text mb-2">Leg B (${dimUnit})</label>
          <input type="number" id="mw2-d2" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 2 : 50}" min="0" step="0.1"></div>
          <div><label class="block text-sm font-medium text-text mb-2">Thickness (${dimUnit})</label>
          <input type="number" id="mw2-d3" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 0.25 : 6}" min="0" step="0.01"></div></div>`;
      } else if (shape === 'channel') {
        html = `<div class="grid grid-cols-3 gap-4">
          <div><label class="block text-sm font-medium text-text mb-2">Web Height (${dimUnit})</label>
          <input type="number" id="mw2-d1" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 4 : 100}" min="0" step="0.1"></div>
          <div><label class="block text-sm font-medium text-text mb-2">Flange (${dimUnit})</label>
          <input type="number" id="mw2-d2" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 1.5 : 40}" min="0" step="0.1"></div>
          <div><label class="block text-sm font-medium text-text mb-2">Thickness (${dimUnit})</label>
          <input type="number" id="mw2-d3" class="mw2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="${units === 'imperial' ? 0.25 : 6}" min="0" step="0.01"></div></div>`;
      }
      container.innerHTML = html;

      // Re-bind new inputs
      container.querySelectorAll('.mw2-in').forEach(el => {
        el.addEventListener('input', calcMW2);
        el.addEventListener('change', calcMW2);
      });
    }

    function calcMW2() {
      const density_gcc = parseFloat((document.getElementById('mw2-material') as HTMLSelectElement).value) || 7.85;
      const shape = (document.getElementById('mw2-shape') as HTMLSelectElement).value;
      const units = (document.getElementById('mw2-units') as HTMLSelectElement).value;
      const length = parseFloat((document.getElementById('mw2-length') as HTMLInputElement).value) || 0;
      const qty = parseInt((document.getElementById('mw2-qty') as HTMLInputElement).value) || 1;

      const d1 = parseFloat((document.getElementById('mw2-d1') as HTMLInputElement)?.value) || 0;
      const d2 = parseFloat((document.getElementById('mw2-d2') as HTMLInputElement)?.value) || 0;
      const d3 = parseFloat((document.getElementById('mw2-d3') as HTMLInputElement)?.value) || 0;

      // Convert to inches if metric
      const toIn = units === 'metric' ? 1 / 25.4 : 1;
      const a = d1 * toIn;
      const b = d2 * toIn;
      const c = d3 * toIn;
      const lenIn = units === 'metric' ? length * 1000 / 25.4 : length; // length in inches (metric: meters -> mm -> in)

      // density in lb/in³
      const density = density_gcc * 0.0361273;

      let area_in2 = 0; // cross-section area in in²
      if (shape === 'plate') {
        area_in2 = a * b; // width * thickness
      } else if (shape === 'roundbar') {
        area_in2 = Math.PI * (a / 2) ** 2;
      } else if (shape === 'squarebar') {
        area_in2 = a * a;
      } else if (shape === 'flatbar') {
        area_in2 = a * b;
      } else if (shape === 'roundtube') {
        const od = a;
        const id = od - 2 * b;
        area_in2 = Math.PI / 4 * (od * od - Math.max(0, id * id));
      } else if (shape === 'squaretube') {
        const outer = a * a;
        const inner = Math.max(0, a - 2 * b) ** 2;
        area_in2 = outer - inner;
      } else if (shape === 'angle') {
        // L-shape: two legs minus overlap at corner
        area_in2 = (a + b - c) * c;
      } else if (shape === 'channel') {
        // C-shape: web + 2 flanges
        area_in2 = (a - 2 * c) * c + 2 * b * c;
      }

      const vol_in3 = area_in2 * lenIn;
      const weight_lb = vol_in3 * density * qty;
      const weight_kg = weight_lb * 0.453592;

      const lenFt = lenIn / 12;
      const perLenLbFt = lenFt > 0 ? (weight_lb / qty) / lenFt : 0;
      const perLenKgM = units === 'metric' && length > 0 ? (weight_kg / qty) / length : perLenLbFt * 1.48816;

      document.getElementById('mw2-weight')!.textContent = weight_lb.toFixed(2);
      document.getElementById('mw2-kg')!.textContent = weight_kg.toFixed(2);
      document.getElementById('mw2-area')!.textContent = area_in2.toFixed(4);
      document.getElementById('mw2-vol')!.textContent = vol_in3.toFixed(2);

      if (units === 'imperial') {
        document.getElementById('mw2-weightunit')!.textContent = 'lbs';
        document.getElementById('mw2-perlen')!.textContent = perLenLbFt.toFixed(3);
        document.getElementById('mw2-perlenunit')!.textContent = 'lb/ft';
      } else {
        document.getElementById('mw2-weightunit')!.textContent = 'lbs';
        document.getElementById('mw2-perlen')!.textContent = perLenKgM.toFixed(3);
        document.getElementById('mw2-perlenunit')!.textContent = 'kg/m';
      }

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.getElementById('mw2-shape')!.addEventListener('change', () => { buildDims(); calcMW2(); });
      document.getElementById('mw2-units')!.addEventListener('change', () => { buildDims(); calcMW2(); });

      document.querySelectorAll('.mw2-in').forEach(el => {
        el.addEventListener('input', calcMW2);
        el.addEventListener('change', calcMW2);
      });

      buildDims();
      calcMW2();
    }, 50);
  </script>
</CalculatorLayout>
