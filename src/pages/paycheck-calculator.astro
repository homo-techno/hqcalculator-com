---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Paycheck Calculator - Free Take-Home Pay Estimator 2026";
const description = "Calculate your take-home pay after federal tax, FICA, and state tax. See your net paycheck for any pay frequency with deduction breakdowns.";

const relatedCalcs = [
  { name: "Salary Calculator", url: "/salary-calculator", description: "Salary breakdown." },
  { name: "Income Tax Calculator", url: "/income-tax-calculator", description: "Federal tax." },
  { name: "Hourly to Salary", url: "/hourly-to-salary-calculator", description: "Wage conversion." },
  { name: "Hours Calculator", url: "/hours-calculator", description: "Work hours." },
  { name: "Retirement Calculator", url: "/retirement-calculator", description: "Retirement planning." },
  { name: "Savings Calculator", url: "/savings-calculator", description: "Savings growth." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Paycheck Calculator"
  keywords="paycheck calculator, take home pay, net pay calculator, salary after tax, pay stub calculator, payroll calculator"
  breadcrumbs={[{ name: "Paycheck Calculator", url: "/paycheck-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Paycheck Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your net take-home pay after federal income tax, FICA, and state taxes.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-1">Annual Salary (Gross)</label>
            <div class="relative">
              <span class="absolute left-4 top-1/2 -translate-y-1/2 text-text-muted font-bold">$</span>
              <input type="number" id="pc-salary" class="w-full pl-8 pr-4 py-3 border border-border rounded-xl text-2xl font-bold" value="75000" min="0" step="1000">
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Pay Frequency</label>
            <div class="grid grid-cols-2 gap-2">
              <button class="pc-freq-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border" data-freq="weekly">Weekly (52)</button>
              <button class="pc-freq-btn px-3 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary" data-freq="biweekly">Bi-Weekly (26)</button>
              <button class="pc-freq-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border" data-freq="semimonthly">Semi-Monthly (24)</button>
              <button class="pc-freq-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border" data-freq="monthly">Monthly (12)</button>
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Filing Status</label>
            <select id="pc-status" class="w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="single">Single</option>
              <option value="married">Married Filing Jointly</option>
              <option value="head">Head of Household</option>
            </select>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-1">State Tax Rate (%)</label>
            <div class="flex gap-2">
              <input type="number" id="pc-state" class="flex-1 px-4 py-3 border border-border rounded-xl text-lg" value="5" min="0" max="15" step="0.1">
              <span class="self-center text-text-muted font-semibold">%</span>
            </div>
            <div class="flex gap-1 mt-2 flex-wrap">
              <button class="pc-state-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-rate="0">TX/FL (0%)</button>
              <button class="pc-state-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-rate="3.07">PA (3.07%)</button>
              <button class="pc-state-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-rate="5">IL (5%)</button>
              <button class="pc-state-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-rate="6.99">NY (~7%)</button>
              <button class="pc-state-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-rate="9.3">CA (~9%)</button>
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-1">Pre-Tax Deductions <span class="text-text-muted">(401k, HSA, etc.)</span></label>
            <div class="relative">
              <span class="absolute left-4 top-1/2 -translate-y-1/2 text-text-muted font-bold">$</span>
              <input type="number" id="pc-pretax" class="w-full pl-8 pr-4 py-3 border border-border rounded-xl text-lg" value="0" min="0" step="50">
            </div>
            <div class="text-xs text-text-muted mt-1">Annual amount (e.g., $6,500 for 401k)</div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="pc-freq-label">Bi-Weekly Take-Home</div>
            <div class="text-4xl sm:text-5xl font-extrabold" id="pc-net">$0</div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Annual Net</div>
              <div class="text-xl font-bold text-secondary" id="pc-annual-net">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Monthly Net</div>
              <div class="text-xl font-bold" id="pc-monthly-net">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Tax Rate</div>
              <div class="text-xl font-bold" id="pc-tax-rate">0%</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Deductions</div>
              <div class="text-xl font-bold text-danger" id="pc-total-ded">$0</div>
            </div>
          </div>

          <!-- Breakdown -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-3">Per-Paycheck Breakdown</h3>
            <div class="space-y-2 text-sm" id="pc-breakdown"></div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="paycheck" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Understanding Your Paycheck</h2>
      <p>Your take-home pay is your gross salary minus federal income tax, FICA taxes (Social Security + Medicare), state income tax, and any pre-tax deductions.</p>

      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">Net Pay = Gross − Federal Tax − FICA − State Tax − Pre-Tax Deductions</div>

      <h3 class="text-xl font-semibold text-text mt-8">FICA Taxes (2025-2026)</h3>
      <ul>
        <li><strong>Social Security:</strong> 6.2% on income up to $176,100 (2025)</li>
        <li><strong>Medicare:</strong> 1.45% on all income + 0.9% additional on income over $200,000</li>
        <li><strong>Total FICA:</strong> 7.65% for most employees</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>Why is my paycheck so small?</strong> Federal tax, state tax, and FICA combined can take 25-40%+ of your gross pay depending on income and location.</p>
      <p><strong>How do pre-tax deductions help?</strong> 401(k), HSA, and similar contributions reduce your taxable income, lowering your tax bill while building savings.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let pcFreq = 'biweekly';
    const freqPeriods: Record<string, number> = { weekly: 52, biweekly: 26, semimonthly: 24, monthly: 12 };
    const freqLabels: Record<string, string> = { weekly: 'Weekly', biweekly: 'Bi-Weekly', semimonthly: 'Semi-Monthly', monthly: 'Monthly' };

    const fmt = (n: number) => '$' + Math.round(n).toLocaleString('en-US');

    const brackets: Record<string, { rate: number; limit: number }[]> = {
      single: [
        { rate: 10, limit: 11925 }, { rate: 12, limit: 48475 }, { rate: 22, limit: 103350 },
        { rate: 24, limit: 197300 }, { rate: 32, limit: 250525 }, { rate: 35, limit: 626350 }, { rate: 37, limit: Infinity }
      ],
      married: [
        { rate: 10, limit: 23850 }, { rate: 12, limit: 96950 }, { rate: 22, limit: 206700 },
        { rate: 24, limit: 394600 }, { rate: 32, limit: 501050 }, { rate: 35, limit: 751600 }, { rate: 37, limit: Infinity }
      ],
      head: [
        { rate: 10, limit: 17000 }, { rate: 12, limit: 64850 }, { rate: 22, limit: 103350 },
        { rate: 24, limit: 197300 }, { rate: 32, limit: 250500 }, { rate: 35, limit: 626350 }, { rate: 37, limit: Infinity }
      ]
    };

    const stdDed: Record<string, number> = { single: 15000, married: 30000, head: 22500 };

    function calcFedTax(taxable: number, status: string): number {
      const b = brackets[status] || brackets.single;
      let tax = 0, prev = 0;
      for (const bracket of b) {
        const inBracket = Math.min(Math.max(0, taxable - prev), bracket.limit - prev);
        tax += inBracket * bracket.rate / 100;
        prev = bracket.limit;
        if (taxable <= bracket.limit) break;
      }
      return tax;
    }

    function calcPaycheck() {
      const salary = parseFloat((document.getElementById('pc-salary') as HTMLInputElement).value) || 0;
      const status = (document.getElementById('pc-status') as HTMLSelectElement).value;
      const stateRate = (parseFloat((document.getElementById('pc-state') as HTMLInputElement).value) || 0) / 100;
      const preTax = parseFloat((document.getElementById('pc-pretax') as HTMLInputElement).value) || 0;
      const periods = freqPeriods[pcFreq];

      // Pre-tax deductions reduce taxable income
      const taxableForFederal = Math.max(0, salary - preTax - stdDed[status]);
      const taxableForFica = Math.max(0, salary - preTax);

      // Federal income tax
      const fedTax = calcFedTax(taxableForFederal, status);

      // FICA
      const ssLimit = 176100;
      const ssTax = Math.min(taxableForFica, ssLimit) * 0.062;
      const medicareTax = taxableForFica * 0.0145 + Math.max(0, taxableForFica - 200000) * 0.009;
      const fica = ssTax + medicareTax;

      // State
      const stateTax = (salary - preTax) * stateRate;

      const totalDeductions = fedTax + fica + stateTax + preTax;
      const annualNet = salary - totalDeductions;
      const perPeriod = annualNet / periods;

      document.getElementById('pc-freq-label')!.textContent = `${freqLabels[pcFreq]} Take-Home`;
      document.getElementById('pc-net')!.textContent = fmt(perPeriod);
      document.getElementById('pc-annual-net')!.textContent = fmt(annualNet);
      document.getElementById('pc-monthly-net')!.textContent = fmt(annualNet / 12);
      document.getElementById('pc-tax-rate')!.textContent = salary > 0 ? ((totalDeductions / salary) * 100).toFixed(1) + '%' : '0%';
      document.getElementById('pc-total-ded')!.textContent = fmt(totalDeductions);

      // Breakdown per paycheck
      const items = [
        { label: 'Gross Pay', value: salary / periods, color: 'text-text' },
        { label: 'Federal Tax', value: -(fedTax / periods), color: 'text-danger' },
        { label: 'Social Security', value: -(ssTax / periods), color: 'text-danger' },
        { label: 'Medicare', value: -(medicareTax / periods), color: 'text-danger' },
        { label: 'State Tax', value: -(stateTax / periods), color: 'text-danger' },
      ];
      if (preTax > 0) items.push({ label: 'Pre-Tax Deductions', value: -(preTax / periods), color: 'text-yellow-600' });

      document.getElementById('pc-breakdown')!.innerHTML = items.map(i =>
        `<div class="flex justify-between items-center ${i.label === 'Gross Pay' ? 'font-semibold pb-2 border-b border-border/30' : ''}">
          <span class="text-text-secondary">${i.label}</span>
          <span class="font-bold ${i.color}">${i.value >= 0 ? '' : '−'}$${Math.abs(Math.round(i.value)).toLocaleString()}</span>
        </div>`
      ).join('') + `<div class="flex justify-between items-center pt-2 border-t border-border font-bold text-lg">
        <span>Net Pay</span><span class="text-secondary">${fmt(perPeriod)}</span>
      </div>`;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.pc-freq-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.pc-freq-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          pcFreq = (btn as HTMLElement).dataset.freq || 'biweekly';
          calcPaycheck();
        });
      });

      document.querySelectorAll('.pc-state-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          (document.getElementById('pc-state') as HTMLInputElement).value = (btn as HTMLElement).dataset.rate || '0';
          calcPaycheck();
        });
      });

      ['pc-salary', 'pc-state', 'pc-pretax'].forEach(id => document.getElementById(id)!.addEventListener('input', calcPaycheck));
      document.getElementById('pc-status')!.addEventListener('change', calcPaycheck);

      calcPaycheck();
    }, 50);
  </script>
</CalculatorLayout>
