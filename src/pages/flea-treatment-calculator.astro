---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Flea Treatment Calculator - Schedule, Dosage & Prevention Cost";
const description = "Calculate flea treatment schedule, dosage by weight, yard treatment area, and annual prevention cost for your pets.";
const relatedCalcs = [
  { name: "Pet Medication Calculator", url: "/pet-medication-calculator", description: "Medication dosage calculator." },
  { name: "Dog Food Calculator", url: "/dog-food-calculator", description: "Daily food portions for dogs." },
  { name: "Cat Food Calculator", url: "/cat-food-calculator", description: "Daily calories for cats." },
  { name: "Pet Cost Calculator", url: "/pet-cost-calculator", description: "Annual pet ownership costs." },
  { name: "Pet Insurance Calculator", url: "/pet-insurance-calculator", description: "Estimate insurance premiums." },
  { name: "Dog BMI Calculator", url: "/dog-bmi-calculator", description: "Body condition score for dogs." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Flea Treatment Calculator" keywords="flea treatment calculator, flea prevention, flea dosage, yard treatment, flea cost, pet flea control" breadcrumbs={[{ name: "Flea Treatment", url: "/flea-treatment-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Flea Treatment Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate flea treatment schedules, proper dosage, yard treatment area, and annual prevention costs.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Pet Type</label>
            <select id="ft-type" class="ft-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="dog" selected>Dog</option>
              <option value="cat">Cat</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Pet Weight (lbs)</label>
            <input type="number" id="ft-weight" class="ft-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="35" min="2" max="200" step="1">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Number of Pets</label>
            <input type="number" id="ft-count" class="ft-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="1" max="20" step="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Treatment Type</label>
            <select id="ft-treatment" class="ft-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="topical" selected>Topical (monthly)</option>
              <option value="oral">Oral Chewable (monthly)</option>
              <option value="collar">Flea Collar (8 months)</option>
              <option value="oral3">Oral (every 3 months)</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Yard Size (sq ft) - for outdoor treatment</label>
          <input type="number" id="ft-yard" class="ft-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5000" min="0" step="500">
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Weight Category / Dosage</div>
          <div class="text-5xl font-extrabold font-mono" id="ft-result">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Treatments / Year</div><div class="text-xl font-bold font-mono" id="ft-peryear">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Cost / Treatment</div><div class="text-xl font-bold font-mono" id="ft-pertx">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Annual Cost</div><div class="text-xl font-bold font-mono" id="ft-annual">--</div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Next Treatment</div><div class="text-xl font-bold font-mono" id="ft-next">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Yard Spray (gal)</div><div class="text-xl font-bold font-mono" id="ft-spray">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">All Pets / Year</div><div class="text-xl font-bold font-mono" id="ft-total">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="flea-treatment" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcFT() {
      const type = (document.getElementById('ft-type') as HTMLSelectElement).value;
      const weight = parseFloat((document.getElementById('ft-weight') as HTMLInputElement).value) || 0;
      const count = parseInt((document.getElementById('ft-count') as HTMLInputElement).value) || 1;
      const treatment = (document.getElementById('ft-treatment') as HTMLSelectElement).value;
      const yard = parseFloat((document.getElementById('ft-yard') as HTMLInputElement).value) || 0;

      // Weight categories
      let category = '';
      if (type === 'dog') {
        if (weight <= 10) category = '5-10 lbs';
        else if (weight <= 22) category = '11-22 lbs';
        else if (weight <= 44) category = '23-44 lbs';
        else if (weight <= 88) category = '45-88 lbs';
        else category = '89-132 lbs';
      } else {
        if (weight <= 5) category = '2-5 lbs';
        else if (weight <= 9) category = '5.1-9 lbs';
        else category = '9.1-18 lbs';
      }

      // Treatments per year and cost per treatment
      const txData: Record<string, { perYear: number; cost: number; interval: string }> = {
        topical:  { perYear: 12, cost: type === 'dog' ? 18 : 15, interval: '30 days' },
        oral:     { perYear: 12, cost: type === 'dog' ? 22 : 18, interval: '30 days' },
        collar:   { perYear: 1.5, cost: type === 'dog' ? 55 : 45, interval: '8 months' },
        oral3:    { perYear: 4, cost: type === 'dog' ? 45 : 35, interval: '3 months' },
      };

      const data = txData[treatment] || txData['topical'];
      const annualPerPet = data.perYear * data.cost;
      const totalAnnual = annualPerPet * count;

      // Yard treatment: 1 gallon covers ~1000 sq ft, treat every 2-3 months
      const sprayGallons = yard > 0 ? (yard / 1000) : 0;

      document.getElementById('ft-result')!.textContent = category;
      document.getElementById('ft-peryear')!.textContent = data.perYear.toString();
      document.getElementById('ft-pertx')!.textContent = '$' + data.cost.toFixed(0);
      document.getElementById('ft-annual')!.textContent = '$' + annualPerPet.toFixed(0);
      document.getElementById('ft-next')!.textContent = data.interval;
      document.getElementById('ft-spray')!.textContent = sprayGallons > 0 ? sprayGallons.toFixed(1) : 'N/A';
      document.getElementById('ft-total')!.textContent = '$' + totalAnnual.toFixed(0);
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ft-in').forEach(el => { el.addEventListener('input', calcFT); el.addEventListener('change', calcFT); });
      calcFT();
    }, 50);
  </script>
</CalculatorLayout>
