---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "One Rep Max Calculator (1RM) - Strength Standards 2026";
const description = "Calculate your one-rep max for any lift. Multiple formulas: Epley, Brzycki, Lander, Lombardi. See percentage-based training loads.";

const relatedCalcs = [
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body Mass Index." },
  { name: "Body Fat Calculator", url: "/body-fat-calculator", description: "Body fat %." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calories." },
  { name: "Macro Calculator", url: "/macro-calculator", description: "Macros." },
  { name: "Calories Burned", url: "/calories-burned-calculator", description: "Exercise calories." },
  { name: "Ideal Weight", url: "/ideal-weight-calculator", description: "Ideal weight." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="One Rep Max Calculator"
  keywords="one rep max calculator, 1RM calculator, max bench press, max squat, strength calculator, weight lifting calculator"
  breadcrumbs={[{ name: "One Rep Max Calculator", url: "/one-rep-max-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">One Rep Max (1RM) Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your one-rep max and get percentage-based training loads for any lift.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-1">Weight Lifted</label>
        <div class="flex gap-2">
          <input type="number" id="orm-weight" class="flex-1 px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="225" min="1" step="5">
          <select id="orm-unit" class="px-3 py-3 border border-border rounded-xl text-lg">
            <option value="lbs">lbs</option>
            <option value="kg">kg</option>
          </select>
        </div>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Reps Performed</label>
        <div class="flex gap-2 flex-wrap" id="orm-reps-btns">
          <button class="orm-rep-btn px-4 py-2.5 rounded-xl font-bold border border-border hover:bg-surface-alt" data-reps="2">2</button>
          <button class="orm-rep-btn px-4 py-2.5 rounded-xl font-bold border border-border hover:bg-surface-alt" data-reps="3">3</button>
          <button class="orm-rep-btn px-4 py-2.5 rounded-xl font-bold border border-primary bg-blue-50 text-primary" data-reps="5">5</button>
          <button class="orm-rep-btn px-4 py-2.5 rounded-xl font-bold border border-border hover:bg-surface-alt" data-reps="6">6</button>
          <button class="orm-rep-btn px-4 py-2.5 rounded-xl font-bold border border-border hover:bg-surface-alt" data-reps="8">8</button>
          <button class="orm-rep-btn px-4 py-2.5 rounded-xl font-bold border border-border hover:bg-surface-alt" data-reps="10">10</button>
          <button class="orm-rep-btn px-4 py-2.5 rounded-xl font-bold border border-border hover:bg-surface-alt" data-reps="12">12</button>
          <button class="orm-rep-btn px-4 py-2.5 rounded-xl font-bold border border-border hover:bg-surface-alt" data-reps="15">15</button>
        </div>
        <div class="mt-2">
          <input type="number" id="orm-reps" class="w-full px-4 py-2 border border-border rounded-xl text-lg" value="5" min="1" max="30" placeholder="Or enter custom reps">
        </div>
      </div>

      <!-- Results -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated 1RM</div>
        <div class="text-5xl font-extrabold" id="orm-result">0</div>
        <div class="text-sm text-blue-200 mt-1" id="orm-unit-label">lbs</div>
      </div>

      <!-- Formula results -->
      <div class="p-4 bg-surface-alt rounded-xl mb-4">
        <h3 class="font-semibold text-sm text-text mb-2">By Formula</h3>
        <div class="grid grid-cols-2 gap-2 text-sm">
          <div class="flex justify-between"><span class="text-text-secondary">Epley</span><span class="font-bold" id="orm-epley">0</span></div>
          <div class="flex justify-between"><span class="text-text-secondary">Brzycki</span><span class="font-bold" id="orm-brzycki">0</span></div>
          <div class="flex justify-between"><span class="text-text-secondary">Lander</span><span class="font-bold" id="orm-lander">0</span></div>
          <div class="flex justify-between"><span class="text-text-secondary">Lombardi</span><span class="font-bold" id="orm-lombardi">0</span></div>
          <div class="flex justify-between"><span class="text-text-secondary">Mayhew</span><span class="font-bold" id="orm-mayhew">0</span></div>
          <div class="flex justify-between"><span class="text-text-secondary">O'Conner</span><span class="font-bold" id="orm-oconner">0</span></div>
        </div>
      </div>

      <!-- Percentage chart -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-3">Training Load Chart</h3>
        <div class="grid grid-cols-1 gap-1 text-sm" id="orm-chart"></div>
      </div>

      <ShareButton calculatorId="one-rep-max" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">How 1RM Is Calculated</h2>
      <p>Your one-rep max (1RM) is the maximum weight you can lift for a single repetition. Rather than testing this directly (which can be risky), you can estimate it from submaximal sets.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Formulas</h3>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Epley:</strong> 1RM = Weight × (1 + Reps / 30)</p>
        <p><strong>Brzycki:</strong> 1RM = Weight × 36 / (37 − Reps)</p>
        <p><strong>Lander:</strong> 1RM = 100 × Weight / (101.3 − 2.67123 × Reps)</p>
        <p><strong>Lombardi:</strong> 1RM = Weight × Reps^0.10</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Using Percentages for Training</h3>
      <ul>
        <li><strong>90-100% 1RM (1-3 reps):</strong> Maximum strength / neural adaptations</li>
        <li><strong>75-85% 1RM (5-8 reps):</strong> Strength and some hypertrophy</li>
        <li><strong>65-75% 1RM (8-12 reps):</strong> Hypertrophy (muscle building)</li>
        <li><strong>50-65% 1RM (12-20 reps):</strong> Muscular endurance</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How accurate are 1RM calculators?</strong> Most accurate with 3-10 reps. Above 10 reps, accuracy decreases. The Epley and Brzycki formulas are most widely used.</p>
      <p><strong>Should I test my actual 1RM?</strong> Only if experienced and with a spotter. Estimated 1RM from a 3-5 rep set is safer and nearly as accurate.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let ormReps = 5;

    function round5(n: number): number { return Math.round(n / 5) * 5; }

    function calcORM() {
      const weight = parseFloat((document.getElementById('orm-weight') as HTMLInputElement).value) || 0;
      const reps = parseInt((document.getElementById('orm-reps') as HTMLInputElement).value) || 1;
      const unit = (document.getElementById('orm-unit') as HTMLSelectElement).value;

      if (reps <= 0 || weight <= 0) return;

      // Formulas (reps=1 means weight IS the 1RM)
      const epley = reps === 1 ? weight : weight * (1 + reps / 30);
      const brzycki = reps === 1 ? weight : weight * 36 / (37 - reps);
      const lander = reps === 1 ? weight : 100 * weight / (101.3 - 2.67123 * reps);
      const lombardi = reps === 1 ? weight : weight * Math.pow(reps, 0.10);
      const mayhew = reps === 1 ? weight : 100 * weight / (52.2 + 41.9 * Math.exp(-0.055 * reps));
      const oconner = reps === 1 ? weight : weight * (1 + reps * 0.025);

      const avg = (epley + brzycki + lander + lombardi + mayhew + oconner) / 6;

      const fmt = (n: number) => Math.round(n).toLocaleString();

      document.getElementById('orm-result')!.textContent = fmt(avg);
      document.getElementById('orm-unit-label')!.textContent = unit;
      document.getElementById('orm-epley')!.textContent = fmt(epley) + ' ' + unit;
      document.getElementById('orm-brzycki')!.textContent = fmt(brzycki) + ' ' + unit;
      document.getElementById('orm-lander')!.textContent = fmt(lander) + ' ' + unit;
      document.getElementById('orm-lombardi')!.textContent = fmt(lombardi) + ' ' + unit;
      document.getElementById('orm-mayhew')!.textContent = fmt(mayhew) + ' ' + unit;
      document.getElementById('orm-oconner')!.textContent = fmt(oconner) + ' ' + unit;

      // Training load chart
      const percentages = [100, 95, 90, 85, 80, 75, 70, 65, 60, 55, 50];
      const repRanges: Record<number, string> = { 100: '1', 95: '2', 90: '3-4', 85: '5-6', 80: '7-8', 75: '8-10', 70: '10-12', 65: '12-15', 60: '15-18', 55: '18-20', 50: '20+' };
      const zones: Record<number, string> = { 100: 'Max', 95: 'Strength', 90: 'Strength', 85: 'Strength', 80: 'Hypertrophy', 75: 'Hypertrophy', 70: 'Hypertrophy', 65: 'Endurance', 60: 'Endurance', 55: 'Endurance', 50: 'Endurance' };
      const colors: Record<string, string> = { 'Max': 'bg-red-100 text-red-700', 'Strength': 'bg-orange-100 text-orange-700', 'Hypertrophy': 'bg-blue-100 text-blue-700', 'Endurance': 'bg-green-100 text-green-700' };

      document.getElementById('orm-chart')!.innerHTML = percentages.map(p => {
        const w = round5(avg * p / 100);
        const zone = zones[p];
        return `<div class="flex items-center justify-between py-1.5 px-3 rounded-lg ${p === 100 ? 'bg-primary/10 font-bold' : 'hover:bg-surface-alt/80'}">
          <span class="w-12 font-semibold">${p}%</span>
          <span class="text-lg font-bold">${w} ${unit}</span>
          <span class="text-xs">${repRanges[p]} reps</span>
          <span class="text-xs px-2 py-0.5 rounded-full ${colors[zone]}">${zone}</span>
        </div>`;
      }).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.orm-rep-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.orm-rep-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          (document.getElementById('orm-reps') as HTMLInputElement).value = (btn as HTMLElement).dataset.reps || '5';
          calcORM();
        });
      });

      document.getElementById('orm-weight')!.addEventListener('input', calcORM);
      document.getElementById('orm-reps')!.addEventListener('input', calcORM);
      document.getElementById('orm-unit')!.addEventListener('change', calcORM);

      calcORM();
    }, 50);
  </script>
</CalculatorLayout>
