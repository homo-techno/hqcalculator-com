---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Body Fat Calculator - Estimate Body Fat Percentage 2026";
const description = "Calculate your body fat percentage using the US Navy method, BMI method, and more. Free body fat estimator with visual chart and health categories.";

const relatedCalcs = [
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body Mass Index." },
  { name: "BMR Calculator", url: "/bmr-calculator", description: "Basal metabolic rate." },
  { name: "TDEE Calculator", url: "/tdee-calculator", description: "Total daily energy." },
  { name: "Ideal Weight Calculator", url: "/ideal-weight-calculator", description: "Healthy weight range." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calorie needs." },
  { name: "Macro Calculator", url: "/macro-calculator", description: "Macro split calculator." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Body Fat Calculator"
  keywords="body fat calculator, body fat percentage, us navy body fat, body composition, fat percentage calculator, lean body mass"
  breadcrumbs={[{ name: "Body Fat Calculator", url: "/body-fat-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Body Fat Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your body fat percentage using the US Navy method. Enter your measurements below.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <!-- Gender -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Gender</label>
            <div class="flex gap-2">
              <button class="bf-gender-btn flex-1 py-3 rounded-xl font-semibold bg-primary text-white border border-primary" data-gender="male">Male</button>
              <button class="bf-gender-btn flex-1 py-3 rounded-xl font-semibold bg-surface-alt text-text-secondary border border-border" data-gender="female">Female</button>
            </div>
          </div>

          <!-- Units -->
          <div class="mb-5">
            <div class="flex gap-2">
              <button class="bf-unit-btn flex-1 py-2 rounded-lg text-sm font-semibold bg-primary text-white" data-unit="imperial">Imperial (in/lbs)</button>
              <button class="bf-unit-btn flex-1 py-2 rounded-lg text-sm font-semibold bg-surface-alt text-text-secondary" data-unit="metric">Metric (cm/kg)</button>
            </div>
          </div>

          <!-- Height -->
          <div class="mb-5" id="bf-height-imp">
            <label class="block text-sm font-medium text-text mb-1">Height</label>
            <div class="flex gap-3">
              <div class="flex-1"><input type="number" id="bf-h-ft" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="5" min="3" max="8"><span class="text-xs text-text-muted">ft</span></div>
              <div class="flex-1"><input type="number" id="bf-h-in" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="10" min="0" max="11"><span class="text-xs text-text-muted">in</span></div>
            </div>
          </div>
          <div class="mb-5 hidden" id="bf-height-met">
            <label class="block text-sm font-medium text-text mb-1">Height (cm)</label>
            <input type="number" id="bf-h-cm" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="178" min="100" max="250">
          </div>

          <!-- Weight -->
          <div class="mb-5" id="bf-weight-imp">
            <label class="block text-sm font-medium text-text mb-1">Weight (lbs)</label>
            <input type="number" id="bf-w-lbs" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="180" min="60" max="700">
          </div>
          <div class="mb-5 hidden" id="bf-weight-met">
            <label class="block text-sm font-medium text-text mb-1">Weight (kg)</label>
            <input type="number" id="bf-w-kg" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="82" min="30" max="300">
          </div>

          <!-- Neck -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-1">Neck Circumference <span class="bf-unit-label">(inches)</span></label>
            <input type="number" id="bf-neck" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="15" min="5" max="30" step="0.1">
          </div>

          <!-- Waist -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-1">Waist Circumference <span class="bf-unit-label">(inches)</span></label>
            <input type="number" id="bf-waist" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="34" min="15" max="80" step="0.1">
            <span class="text-xs text-text-muted">Measured at navel level</span>
          </div>

          <!-- Hip (female only) -->
          <div class="mb-5" id="bf-hip-row">
            <label class="block text-sm font-medium text-text mb-1">Hip Circumference <span class="bf-unit-label">(inches)</span></label>
            <input type="number" id="bf-hip" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="38" min="20" max="80" step="0.1">
            <span class="text-xs text-text-muted">Measured at widest point</span>
          </div>
        </div>

        <div class="space-y-4">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Body Fat Percentage</div>
            <div class="text-5xl font-extrabold" id="bf-result">0%</div>
            <div class="text-sm text-blue-200 mt-1" id="bf-category">—</div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Fat Mass</div>
              <div class="text-xl font-bold text-danger" id="bf-fat-mass">0 lbs</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Lean Mass</div>
              <div class="text-xl font-bold text-secondary" id="bf-lean-mass">0 lbs</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">BMI Method</div>
              <div class="text-xl font-bold" id="bf-bmi-method">0%</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">BMI</div>
              <div class="text-xl font-bold" id="bf-bmi">0</div>
            </div>
          </div>

          <!-- Visual bar -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <div class="text-sm font-semibold text-text mb-2">Body Fat Scale</div>
            <div class="relative h-6 rounded-full overflow-hidden flex">
              <div class="h-full bg-blue-400" style="width:14%"></div>
              <div class="h-full bg-green-400" style="width:12%"></div>
              <div class="h-full bg-yellow-400" style="width:12%"></div>
              <div class="h-full bg-orange-400" style="width:12%"></div>
              <div class="h-full bg-red-400" style="width:50%"></div>
            </div>
            <div class="relative h-4">
              <div class="absolute top-0 w-0 h-0 border-l-[6px] border-r-[6px] border-b-[8px] border-transparent border-b-text transition-all" id="bf-marker" style="left:20%"></div>
            </div>
            <div class="flex justify-between text-[10px] text-text-muted mt-1">
              <span>Essential</span>
              <span>Athletes</span>
              <span>Fitness</span>
              <span>Average</span>
              <span>Obese</span>
            </div>
          </div>

          <!-- Category Table -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="text-sm font-semibold text-text mb-2">Body Fat Categories</h3>
            <div class="text-xs space-y-1" id="bf-categories-table"></div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="body-fat" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Body Fat Is Calculated</h2>
      <p>This calculator uses the <strong>US Navy method</strong>, which estimates body fat based on circumference measurements. It was developed by Hodgdon and Beckett at the Naval Health Research Center.</p>

      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm">
        <p><strong>Men:</strong> BF% = 86.010 × log10(waist − neck) − 70.041 × log10(height) + 36.76</p>
        <p><strong>Women:</strong> BF% = 163.205 × log10(waist + hip − neck) − 97.684 × log10(height) − 78.387</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">How to Measure</h3>
      <ul>
        <li><strong>Neck:</strong> Measure just below the larynx (Adam's apple), tape sloping slightly downward to the front</li>
        <li><strong>Waist:</strong> Men: at navel level. Women: at the narrowest point</li>
        <li><strong>Hips (women only):</strong> At the widest point of the buttocks</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Healthy Body Fat Ranges</h3>
      <ul>
        <li><strong>Essential fat:</strong> Men 2-5%, Women 10-13% (minimum for survival)</li>
        <li><strong>Athletes:</strong> Men 6-13%, Women 14-20%</li>
        <li><strong>Fitness:</strong> Men 14-17%, Women 21-24%</li>
        <li><strong>Average:</strong> Men 18-24%, Women 25-31%</li>
        <li><strong>Obese:</strong> Men 25%+, Women 32%+</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How accurate is the Navy method?</strong> The US Navy method has a typical accuracy of ±3-4%. For more precise measurements, consider DEXA scans, hydrostatic weighing, or Bod Pod.</p>
      <p><strong>Why is body fat better than BMI?</strong> BMI doesn't distinguish between muscle and fat. A muscular person may have a high BMI but low body fat. Body fat percentage gives a more complete picture of health.</p>
      <p><strong>How can I lower my body fat?</strong> Combine strength training (preserves muscle), cardio (burns calories), and a moderate caloric deficit (500 cal/day). Aim for 0.5-1% body fat reduction per month.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let bfGender = 'male';
    let bfUnit = 'imperial';

    const maleCategories = [
      { label: 'Essential Fat', min: 2, max: 5, color: 'text-blue-600' },
      { label: 'Athletes', min: 6, max: 13, color: 'text-green-600' },
      { label: 'Fitness', min: 14, max: 17, color: 'text-green-500' },
      { label: 'Average', min: 18, max: 24, color: 'text-yellow-600' },
      { label: 'Obese', min: 25, max: 100, color: 'text-red-600' },
    ];
    const femaleCategories = [
      { label: 'Essential Fat', min: 10, max: 13, color: 'text-blue-600' },
      { label: 'Athletes', min: 14, max: 20, color: 'text-green-600' },
      { label: 'Fitness', min: 21, max: 24, color: 'text-green-500' },
      { label: 'Average', min: 25, max: 31, color: 'text-yellow-600' },
      { label: 'Obese', min: 32, max: 100, color: 'text-red-600' },
    ];

    function getHeight(): number {
      if (bfUnit === 'imperial') {
        const ft = parseFloat((document.getElementById('bf-h-ft') as HTMLInputElement).value) || 0;
        const inch = parseFloat((document.getElementById('bf-h-in') as HTMLInputElement).value) || 0;
        return ft * 12 + inch; // inches
      }
      return (parseFloat((document.getElementById('bf-h-cm') as HTMLInputElement).value) || 0) / 2.54; // to inches
    }

    function getWeight(): number {
      if (bfUnit === 'imperial') return parseFloat((document.getElementById('bf-w-lbs') as HTMLInputElement).value) || 0;
      return (parseFloat((document.getElementById('bf-w-kg') as HTMLInputElement).value) || 0) * 2.2046;
    }

    function getMeasurement(id: string): number {
      let val = parseFloat((document.getElementById(id) as HTMLInputElement).value) || 0;
      if (bfUnit === 'metric') val /= 2.54; // cm to inches
      return val;
    }

    function calcBodyFat() {
      const height = getHeight();
      const weight = getWeight();
      const neck = getMeasurement('bf-neck');
      const waist = getMeasurement('bf-waist');
      const hip = getMeasurement('bf-hip');

      let bf: number;
      if (bfGender === 'male') {
        bf = 86.010 * Math.log10(waist - neck) - 70.041 * Math.log10(height) + 36.76;
      } else {
        bf = 163.205 * Math.log10(waist + hip - neck) - 97.684 * Math.log10(height) - 78.387;
      }
      bf = Math.max(0, Math.min(60, bf));

      const fatMass = weight * bf / 100;
      const leanMass = weight - fatMass;

      // BMI method
      const heightM = height * 0.0254;
      const weightKg = weight * 0.453592;
      const bmi = heightM > 0 ? weightKg / (heightM * heightM) : 0;
      const age = 30; // default for BMI method
      let bmiBf: number;
      if (bfGender === 'male') {
        bmiBf = 1.20 * bmi + 0.23 * age - 16.2;
      } else {
        bmiBf = 1.20 * bmi + 0.23 * age - 5.4;
      }

      const categories = bfGender === 'male' ? maleCategories : femaleCategories;
      let category = 'Unknown';
      for (const cat of categories) {
        if (bf >= cat.min && bf <= cat.max) { category = cat.label; break; }
      }

      const weightUnit = bfUnit === 'imperial' ? 'lbs' : 'kg';
      const displayFat = bfUnit === 'imperial' ? fatMass : fatMass * 0.453592;
      const displayLean = bfUnit === 'imperial' ? leanMass : leanMass * 0.453592;

      document.getElementById('bf-result')!.textContent = bf.toFixed(1) + '%';
      document.getElementById('bf-category')!.textContent = category;
      document.getElementById('bf-fat-mass')!.textContent = Math.round(displayFat) + ' ' + weightUnit;
      document.getElementById('bf-lean-mass')!.textContent = Math.round(displayLean) + ' ' + weightUnit;
      document.getElementById('bf-bmi-method')!.textContent = Math.max(0, bmiBf).toFixed(1) + '%';
      document.getElementById('bf-bmi')!.textContent = bmi.toFixed(1);

      // Marker position (0-50% maps to 0-100%)
      const markerPct = Math.min(100, Math.max(0, (bf / 50) * 100));
      document.getElementById('bf-marker')!.style.left = markerPct + '%';

      // Categories table
      const tableEl = document.getElementById('bf-categories-table')!;
      tableEl.innerHTML = categories.filter(c => c.max <= 60).map(cat => {
        const active = bf >= cat.min && bf <= cat.max;
        return `<div class="flex justify-between py-0.5 ${active ? 'font-bold ' + cat.color : 'text-text-muted'}">
          <span>${active ? '▸ ' : ''}${cat.label}</span>
          <span>${cat.min}-${cat.max === 100 ? '+' : cat.max}%</span>
        </div>`;
      }).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      // Gender
      document.querySelectorAll('.bf-gender-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.bf-gender-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white', 'border-primary');
            b.classList.add('bg-surface-alt', 'text-text-secondary', 'border-border');
          });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary', 'border-border');
          btn.classList.add('bg-primary', 'text-white', 'border-primary');
          bfGender = (btn as HTMLElement).dataset.gender || 'male';
          document.getElementById('bf-hip-row')!.style.display = bfGender === 'female' ? '' : 'none';
          calcBodyFat();
        });
      });

      // Units
      document.querySelectorAll('.bf-unit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.bf-unit-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-surface-alt', 'text-text-secondary');
          });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary');
          btn.classList.add('bg-primary', 'text-white');
          bfUnit = (btn as HTMLElement).dataset.unit || 'imperial';
          const isImp = bfUnit === 'imperial';
          document.getElementById('bf-height-imp')!.classList.toggle('hidden', !isImp);
          document.getElementById('bf-height-met')!.classList.toggle('hidden', isImp);
          document.getElementById('bf-weight-imp')!.classList.toggle('hidden', !isImp);
          document.getElementById('bf-weight-met')!.classList.toggle('hidden', isImp);
          document.querySelectorAll('.bf-unit-label').forEach(el => {
            el.textContent = isImp ? '(inches)' : '(cm)';
          });
          calcBodyFat();
        });
      });

      // Hide hip for male
      document.getElementById('bf-hip-row')!.style.display = 'none';

      ['bf-h-ft', 'bf-h-in', 'bf-h-cm', 'bf-w-lbs', 'bf-w-kg', 'bf-neck', 'bf-waist', 'bf-hip'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcBodyFat);
      });

      calcBodyFat();
    }, 50);
  </script>
</CalculatorLayout>
