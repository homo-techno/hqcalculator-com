---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Hearing Aid Calculator";
const description = "Estimate hearing aid cost by technology level (basic, mid, premium), bilateral pricing, battery or rechargeable, and insurance coverage.";
const relatedCalcs = [
  { name: "Hearing Loss Calculator", url: "/hearing-loss-calculator", description: "Classify hearing loss level." },
  { name: "Tinnitus Frequency Calculator", url: "/tinnitus-frequency-calculator", description: "Tinnitus frequency matching." },
  { name: "Health Insurance Calculator", url: "/health-insurance-calculator", description: "Health plan cost comparison." },
  { name: "Eye Exam Calculator", url: "/eye-exam-calculator", description: "Eye exam cost by type." },
  { name: "Snoring Risk Calculator", url: "/snoring-risk-calculator", description: "Snoring and OSA risk score." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Plan your monthly budget." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Hearing Aid Calculator" keywords="hearing aid cost, hearing aid price, bilateral hearing aids, rechargeable hearing aid, hearing aid insurance" breadcrumbs={[{ name: "Hearing Aid", url: "/hearing-aid-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Hearing Aid Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate hearing aid costs including technology level, batteries, and insurance.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Technology Level</label>
            <select id="ha2-tech" class="ha2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="otc">OTC (Over-the-Counter)</option>
              <option value="basic">Basic / Entry-Level</option>
              <option value="mid" selected>Mid-Range</option>
              <option value="premium">Premium</option>
              <option value="elite">Elite / Top-Tier</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Style</label>
            <select id="ha2-style" class="ha2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="bte" selected>Behind-the-Ear (BTE)</option>
              <option value="rite">Receiver-in-Canal (RIC)</option>
              <option value="ite">In-the-Ear (ITE)</option>
              <option value="cic">Completely-in-Canal (CIC)</option>
              <option value="iic">Invisible-in-Canal (IIC)</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Ears</label>
            <select id="ha2-ears" class="ha2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="1">One Ear (Monaural)</option>
              <option value="2" selected>Both Ears (Bilateral)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Power Source</label>
            <select id="ha2-power" class="ha2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="disposable">Disposable Batteries</option>
              <option value="rechargeable" selected>Rechargeable</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Insurance / Benefit ($)</label><input type="number" id="ha2-ins" class="ha2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0" min="0" max="5000" step="100"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Expected Lifespan (years)</label><input type="number" id="ha2-life" class="ha2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="3" max="8" step="1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Hearing Aid Cost</div>
          <div class="text-5xl font-extrabold font-mono" id="ha2-total">$0</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Per Aid</div><div class="text-xl font-bold font-mono" id="ha2-each">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Bilateral Discount</div><div class="text-xl font-bold font-mono" id="ha2-disc">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Out of Pocket</div><div class="text-xl font-bold font-mono" id="ha2-oop">$0</div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Battery / Year</div><div class="text-xl font-bold font-mono" id="ha2-batt">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Cost per Day</div><div class="text-xl font-bold font-mono" id="ha2-daily">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Lifetime Cost</div><div class="text-xl font-bold font-mono" id="ha2-lifetime">$0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="hearing-aid" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcHA2() {
      const tech = (document.getElementById('ha2-tech') as HTMLSelectElement).value;
      const style = (document.getElementById('ha2-style') as HTMLSelectElement).value;
      const ears = parseInt((document.getElementById('ha2-ears') as HTMLSelectElement).value) || 2;
      const power = (document.getElementById('ha2-power') as HTMLSelectElement).value;
      const ins = parseFloat((document.getElementById('ha2-ins') as HTMLInputElement).value) || 0;
      const lifespan = parseFloat((document.getElementById('ha2-life') as HTMLInputElement).value) || 5;

      const techCosts: Record<string, number> = { otc: 800, basic: 1500, mid: 2500, premium: 4000, elite: 5500 };
      const styleMult: Record<string, number> = { bte: 0.9, rite: 1.0, ite: 1.05, cic: 1.15, iic: 1.25 };

      const perAid = Math.round(techCosts[tech] * (styleMult[style] || 1.0));
      const bilateralDiscount = ears === 2 ? Math.round(perAid * 0.10) : 0;
      const totalDevice = ears === 2 ? (perAid * 2 - bilateralDiscount) : perAid;

      // Battery costs
      let annualBattery = 0;
      if (power === 'disposable') {
        // ~1 battery per 5 days per ear, ~$1 each
        annualBattery = Math.round((365 / 5) * ears * 1);
      } else {
        annualBattery = 0; // Rechargeable - no ongoing battery cost
      }

      const oop = Math.max(0, totalDevice - ins);
      const lifetimeCost = oop + annualBattery * lifespan;
      const dailyCost = (lifetimeCost / (lifespan * 365));

      document.getElementById('ha2-total')!.textContent = '$' + totalDevice.toLocaleString();
      document.getElementById('ha2-each')!.textContent = '$' + perAid.toLocaleString();
      document.getElementById('ha2-disc')!.textContent = ears === 2 ? '-$' + bilateralDiscount.toLocaleString() : 'N/A';
      document.getElementById('ha2-oop')!.textContent = '$' + oop.toLocaleString();
      document.getElementById('ha2-batt')!.textContent = '$' + annualBattery.toLocaleString() + '/yr';
      document.getElementById('ha2-daily')!.textContent = '$' + dailyCost.toFixed(2);
      document.getElementById('ha2-lifetime')!.textContent = '$' + lifetimeCost.toLocaleString();

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ha2-in').forEach(el => { el.addEventListener('input', calcHA2); el.addEventListener('change', calcHA2); });
      calcHA2();
    }, 50);
  </script>
</CalculatorLayout>
