---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Carbon Footprint Calculator - Estimate Your CO₂ Emissions";
const description = "Estimate your annual carbon footprint from transportation, home energy, and lifestyle choices.";
const relatedCalcs = [
  { name: "Solar Panel", url: "/solar-panel-calculator", description: "Solar." },
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Electricity." },
  { name: "Fuel Economy", url: "/gas-mileage-calculator", description: "Gas mileage." },
  { name: "EV Calculator", url: "/electric-vehicle-calculator", description: "EV costs." },
  { name: "BTU Calculator", url: "/btu-calculator", description: "BTU." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Carbon Footprint Calculator" keywords="carbon footprint, co2 emissions, carbon calculator, greenhouse gas, environmental impact" breadcrumbs={[{ name: "Carbon Footprint", url: "/carbon-footprint-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Carbon Footprint Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your annual CO₂ emissions from daily activities.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <h3 class="font-semibold text-text">Transportation</h3>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Miles Driven/Year</label><input type="number" id="cf-miles" class="cf-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12000" min="0" step="500"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Car MPG</label><input type="number" id="cf-mpg" class="cf-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="28" min="5" step="1"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Flights per Year (round-trip)</label><input type="number" id="cf-flights" class="cf-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="0" max="50" step="1"></div>
        <h3 class="font-semibold text-text">Home Energy</h3>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Monthly Electric (kWh)</label><input type="number" id="cf-elec" class="cf-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="900" min="0" step="50"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Monthly Gas (therms)</label><input type="number" id="cf-gas" class="cf-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="50" min="0" step="5"></div>
        </div>
        <h3 class="font-semibold text-text">Diet</h3>
        <div>
          <select id="cf-diet" class="cf-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="heavy">Heavy Meat Eater (3.3 tons/yr)</option>
            <option value="medium" selected>Average Omnivore (2.5 tons/yr)</option>
            <option value="light">Low Meat (1.7 tons/yr)</option>
            <option value="veg">Vegetarian (1.4 tons/yr)</option>
            <option value="vegan">Vegan (1.0 tons/yr)</option>
          </select>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Annual Carbon Footprint</div>
          <div class="text-4xl font-extrabold" id="cf-total">0</div>
          <div class="text-sm text-blue-200 mt-1">metric tons CO₂/year</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">US Average</div><div class="text-xl font-bold">16.0 tons</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">World Average</div><div class="text-xl font-bold">4.8 tons</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Breakdown</h3>
          <div class="space-y-2" id="cf-breakdown"></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Trees Needed to Offset</div>
          <div class="text-2xl font-bold" id="cf-trees">0 trees</div>
        </div>
      </div>
      <ShareButton calculatorId="carbon-footprint" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Understanding Carbon Footprint</h2>
      <p>The average American produces about 16 metric tons of CO₂ per year. The global average is 4.8 tons. Reducing to under 2 tons by 2050 is needed to limit warming to 1.5°C.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    const dietTons: Record<string, number> = { heavy: 3.3, medium: 2.5, light: 1.7, veg: 1.4, vegan: 1.0 };
    function calcCF() {
      const miles = parseFloat((document.getElementById('cf-miles') as HTMLInputElement).value) || 0;
      const mpg = parseFloat((document.getElementById('cf-mpg') as HTMLInputElement).value) || 28;
      const flights = parseFloat((document.getElementById('cf-flights') as HTMLInputElement).value) || 0;
      const elec = parseFloat((document.getElementById('cf-elec') as HTMLInputElement).value) || 0;
      const gas = parseFloat((document.getElementById('cf-gas') as HTMLInputElement).value) || 0;
      const diet = (document.getElementById('cf-diet') as HTMLSelectElement).value;
      const carCO2 = (miles / mpg) * 8.887 / 1000; // kg CO2 per gallon = 8.887
      const flightCO2 = flights * 1.6; // avg round trip ~1.6 tons
      const elecCO2 = elec * 12 * 0.000417; // tons per kWh
      const gasCO2 = gas * 12 * 0.005; // therms to tons
      const dietCO2 = dietTons[diet];
      const total = carCO2 + flightCO2 + elecCO2 + gasCO2 + dietCO2;
      document.getElementById('cf-total')!.textContent = total.toFixed(1);
      document.getElementById('cf-trees')!.textContent = Math.ceil(total / 0.022) + ' trees';
      const items = [
        { label: 'Driving', val: carCO2 },
        { label: 'Flights', val: flightCO2 },
        { label: 'Electricity', val: elecCO2 },
        { label: 'Natural Gas', val: gasCO2 },
        { label: 'Diet', val: dietCO2 },
      ];
      const maxVal = Math.max(...items.map(i => i.val), 0.1);
      document.getElementById('cf-breakdown')!.innerHTML = items.map(i =>
        `<div class="flex justify-between items-center"><span class="text-sm">${i.label}</span><div class="flex items-center gap-2"><div class="w-24 bg-gray-200 rounded-full h-2"><div class="bg-primary rounded-full h-2" style="width:${(i.val/total*100).toFixed(0)}%"></div></div><span class="text-sm font-bold">${i.val.toFixed(1)}t</span></div></div>`
      ).join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => { document.querySelectorAll('.cf-in').forEach(el => { el.addEventListener('input', calcCF); el.addEventListener('change', calcCF); }); calcCF(); }, 50);
  </script>
</CalculatorLayout>
