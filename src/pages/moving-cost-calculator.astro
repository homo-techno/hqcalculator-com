---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Moving Cost Calculator - Estimate Your Moving Expenses";
const description = "Estimate the cost of your move based on distance, home size, and services needed. Compare DIY vs professional movers.";

const relatedCalcs = [
  { name: "Rent vs Buy", url: "/rent-vs-buy-calculator", description: "Rent or buy?" },
  { name: "Mortgage Calculator", url: "/mortgage-calculator", description: "Home loans." },
  { name: "Down Payment", url: "/down-payment-calculator", description: "Down payments." },
  { name: "Gas Mileage", url: "/gas-mileage-calculator", description: "Fuel economy." },
  { name: "Savings Calculator", url: "/savings-calculator", description: "Savings growth." },
  { name: "Tip Calculator", url: "/tip-calculator", description: "Tips." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Moving Cost Calculator"
  keywords="moving cost calculator, moving expenses, moving estimate, professional movers cost, DIY moving, relocation cost"
  breadcrumbs={[{ name: "Moving Cost", url: "/moving-cost-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Moving Cost Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate the total cost of your move and compare DIY vs hiring professionals.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-text mb-1">Move Type</label>
              <div class="grid grid-cols-2 gap-2">
                <button class="mv-type-btn px-3 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary text-center" data-val="local">Local (< 100 mi)</button>
                <button class="mv-type-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="long">Long Distance</button>
              </div>
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Home Size</label>
              <select id="mv-size" class="w-full px-4 py-3 border border-border rounded-xl text-lg">
                <option value="studio">Studio / 1 Room</option>
                <option value="1br">1 Bedroom</option>
                <option value="2br" selected>2 Bedrooms</option>
                <option value="3br">3 Bedrooms</option>
                <option value="4br">4 Bedrooms</option>
                <option value="5br">5+ Bedrooms</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Distance (miles)</label>
              <input type="number" id="mv-distance" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="30" min="1" step="10">
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-2">Additional Services</label>
              <div class="space-y-2">
                <label class="flex items-center gap-2 text-sm">
                  <input type="checkbox" id="mv-packing" class="mv-service rounded">
                  <span>Professional Packing</span>
                </label>
                <label class="flex items-center gap-2 text-sm">
                  <input type="checkbox" id="mv-storage" class="mv-service rounded">
                  <span>Storage (1 month)</span>
                </label>
                <label class="flex items-center gap-2 text-sm">
                  <input type="checkbox" id="mv-piano" class="mv-service rounded">
                  <span>Piano / Heavy Items</span>
                </label>
                <label class="flex items-center gap-2 text-sm">
                  <input type="checkbox" id="mv-stairs" class="mv-service rounded">
                  <span>Stairs / No Elevator</span>
                </label>
              </div>
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Mover Tip (%)</label>
              <input type="number" id="mv-tip" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="15" min="0" max="30" step="5">
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Moving Cost</div>
            <div class="text-4xl sm:text-5xl font-extrabold" id="mv-total">$0</div>
            <div class="text-sm text-blue-200 mt-1" id="mv-range">Range: $0 - $0</div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Base Cost</div>
              <div class="text-xl font-bold" id="mv-base">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Extras & Services</div>
              <div class="text-xl font-bold" id="mv-extras">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Tip</div>
              <div class="text-xl font-bold" id="mv-tip-amount">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Est. Weight</div>
              <div class="text-xl font-bold" id="mv-weight">0 lbs</div>
            </div>
          </div>

          <!-- DIY comparison -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-3">DIY Comparison</h3>
            <div class="space-y-1 text-sm" id="mv-diy"></div>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-3">Cost Breakdown</h3>
            <div class="space-y-1 text-sm" id="mv-breakdown"></div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="moving-cost" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Moving Costs Are Calculated</h2>
      <p>Moving costs depend on the distance, amount of stuff (measured by weight or rooms), and additional services. Local moves are typically charged by the hour, while long-distance moves are priced by weight and distance.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-sm space-y-1">
        <p><strong>Local moves:</strong> $80-$120/hour for 2 movers + truck, 4-8 hours typical</p>
        <p><strong>Long distance:</strong> $0.50-$0.80 per pound per 1,000 miles</p>
        <p><strong>Average costs:</strong> $1,700 local / $4,800 long distance</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How much should I tip movers?</strong> Standard tip is 15-20% of the total moving cost, or $20-$40 per mover for a local move.</p>
      <p><strong>Is DIY moving cheaper?</strong> Usually yes â€” a rental truck costs $50-$2,000 depending on distance. But factor in your time, physical effort, and risk of injury or damage.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const fmt = (n: number) => '$' + Math.round(n).toLocaleString();

    let moveType = 'local';

    // Weight estimates by home size (lbs)
    const sizeData: Record<string, { weight: number; hours: number; label: string }> = {
      studio: { weight: 1500, hours: 3, label: 'Studio' },
      '1br': { weight: 2500, hours: 4, label: '1 Bedroom' },
      '2br': { weight: 5000, hours: 6, label: '2 Bedrooms' },
      '3br': { weight: 7500, hours: 8, label: '3 Bedrooms' },
      '4br': { weight: 10000, hours: 10, label: '4 Bedrooms' },
      '5br': { weight: 13000, hours: 12, label: '5+ Bedrooms' },
    };

    function calcMoving() {
      const size = (document.getElementById('mv-size') as HTMLSelectElement).value;
      const distance = parseFloat((document.getElementById('mv-distance') as HTMLInputElement).value) || 0;
      const tipPct = (parseFloat((document.getElementById('mv-tip') as HTMLInputElement).value) || 0) / 100;
      const packing = (document.getElementById('mv-packing') as HTMLInputElement).checked;
      const storage = (document.getElementById('mv-storage') as HTMLInputElement).checked;
      const piano = (document.getElementById('mv-piano') as HTMLInputElement).checked;
      const stairs = (document.getElementById('mv-stairs') as HTMLInputElement).checked;

      const info = sizeData[size] || sizeData['2br'];
      const weight = info.weight;
      let baseCost: number;

      if (moveType === 'local') {
        const hourlyRate = 100; // ~$100/hr for 2 movers + truck
        baseCost = info.hours * hourlyRate;
        if (distance > 50) baseCost += (distance - 50) * 2;
      } else {
        // Long distance: per-pound rate scales with distance
        const ratePerLb = 0.50 + (distance / 5000) * 0.30; // $0.50-$0.80/lb
        baseCost = weight * ratePerLb;
        baseCost = Math.max(baseCost, 2000); // Minimum for long distance
      }

      let extras = 0;
      const breakdownItems: [string, number][] = [['Base moving cost', baseCost]];

      if (packing) {
        const packCost = weight * 0.10;
        extras += packCost;
        breakdownItems.push(['Professional packing', packCost]);
      }
      if (storage) {
        const storageCost = weight <= 3000 ? 150 : weight <= 7000 ? 250 : 400;
        extras += storageCost;
        breakdownItems.push(['Storage (1 month)', storageCost]);
      }
      if (piano) {
        extras += 350;
        breakdownItems.push(['Piano/heavy items', 350]);
      }
      if (stairs) {
        extras += 150;
        breakdownItems.push(['Stairs surcharge', 150]);
      }

      const subtotal = baseCost + extras;
      const tip = subtotal * tipPct;
      const total = subtotal + tip;

      breakdownItems.push(['Tip (' + Math.round(tipPct * 100) + '%)', tip]);
      breakdownItems.push(['Total', total]);

      document.getElementById('mv-total')!.textContent = fmt(total);
      document.getElementById('mv-range')!.textContent = `Range: ${fmt(total * 0.8)} - ${fmt(total * 1.3)}`;
      document.getElementById('mv-base')!.textContent = fmt(baseCost);
      document.getElementById('mv-extras')!.textContent = fmt(extras);
      document.getElementById('mv-tip-amount')!.textContent = fmt(tip);
      document.getElementById('mv-weight')!.textContent = weight.toLocaleString() + ' lbs';

      // DIY comparison
      let diyTruck: number;
      if (moveType === 'local') {
        diyTruck = weight <= 3000 ? 50 : weight <= 7000 ? 80 : 120;
      } else {
        diyTruck = 500 + distance * 0.7;
      }
      const diyGas = distance * 0.30; // ~$0.30/mi for truck
      const diyTotal = diyTruck + diyGas + (packing ? weight * 0.05 : 0);
      const savings = total - diyTotal;

      document.getElementById('mv-diy')!.innerHTML = [
        ['Truck rental', fmt(diyTruck)],
        ['Gas estimate', fmt(diyGas)],
        ['DIY Total', fmt(diyTotal)],
        ['You Save', fmt(savings)],
      ].map(([label, val]) =>
        `<div class="flex justify-between ${label === 'You Save' ? 'pt-1 border-t border-border font-bold text-green-600' : ''}">
          <span class="text-text-secondary">${label}</span><span class="font-semibold">${val}</span>
        </div>`
      ).join('');

      // Breakdown
      document.getElementById('mv-breakdown')!.innerHTML = breakdownItems.map(([label, val]) =>
        `<div class="flex justify-between ${label === 'Total' ? 'pt-1 border-t border-border font-bold' : ''}">
          <span class="text-text-secondary">${label}</span><span class="font-semibold">${fmt(val)}</span>
        </div>`
      ).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      // Move type toggle
      document.querySelectorAll('.mv-type-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.mv-type-btn').forEach(b => {
            b.classList.remove('border-primary', 'bg-blue-50', 'text-primary');
            b.classList.add('border-border');
          });
          btn.classList.remove('border-border');
          btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          moveType = (btn as HTMLElement).dataset.val || 'local';
          calcMoving();
        });
      });

      ['mv-size'].forEach(id => {
        document.getElementById(id)?.addEventListener('change', calcMoving);
      });
      ['mv-distance', 'mv-tip'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcMoving);
      });
      document.querySelectorAll('.mv-service').forEach(el => {
        el.addEventListener('change', calcMoving);
      });

      calcMoving();
    }, 50);
  </script>
</CalculatorLayout>
