---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Freelance Rate Calculator - Set Your Hourly & Day Rates";
const description = "Calculate the right freelance hourly rate based on your desired salary, billable hours, overhead, and profit margin.";

const relatedCalcs = [
  { name: "Side Hustle", url: "/side-hustle-calculator", description: "Side income calc." },
  { name: "Hourly to Salary", url: "/hourly-to-salary-calculator", description: "Salary conversion." },
  { name: "Income Tax", url: "/income-tax-calculator", description: "Tax estimate." },
  { name: "Paycheck Calculator", url: "/paycheck-calculator", description: "Take-home pay." },
  { name: "Profit Margin", url: "/profit-margin-calculator", description: "Profit margins." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Budget planning." },
];
---

<CalculatorLayout title={title} description={description} calculatorName="Freelance Rate Calculator" keywords="freelance rate calculator, hourly rate, day rate, project rate, freelance pricing, consulting rate" breadcrumbs={[{ name: "Freelance Rate", url: "/freelance-rate-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Freelance Rate Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find the right hourly, day, and project rates for your freelance work.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Desired Annual Salary (equivalent)</label>
            <div class="relative"><span class="absolute left-4 top-1/2 -translate-y-1/2 text-text-muted font-bold">$</span>
              <input type="number" id="fr-salary" class="w-full pl-8 pr-4 py-3 border border-border rounded-xl text-2xl font-bold" value="85000" min="0" step="5000">
            </div>
            <p class="text-xs text-text-muted mt-1">What you'd want to earn as a full-time employee</p>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Billable Hours per Year</label>
            <input type="number" id="fr-hours" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="1200" min="100" max="2500" step="50">
            <p class="text-xs text-text-muted mt-1">Typical: 1000-1500 (accounts for admin, marketing, vacation)</p>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Overhead / Benefits Cost (%)</label>
            <div class="relative">
              <input type="number" id="fr-overhead" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="25" min="0" max="100" step="5">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-text-muted">%</span>
            </div>
            <p class="text-xs text-text-muted mt-1">Health insurance, retirement, software, equipment</p>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Profit Margin (%)</label>
            <div class="relative">
              <input type="number" id="fr-profit" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="15" min="0" max="50" step="5">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-text-muted">%</span>
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Typical Project Hours</label>
            <input type="number" id="fr-project-hours" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="40" min="1" max="1000" step="5">
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Hourly Rate</div>
            <div class="text-5xl font-extrabold font-mono" id="fr-hourly">$0</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Day Rate (8hr)</div>
              <div class="text-xl font-bold text-secondary" id="fr-day">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Project Rate</div>
              <div class="text-xl font-bold" id="fr-project">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Monthly Revenue Needed</div>
              <div class="text-xl font-bold text-green-600" id="fr-monthly">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Annual Revenue</div>
              <div class="text-xl font-bold" id="fr-annual">$0</div>
            </div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Overhead + Benefits Cost</div>
            <div class="text-xl font-bold text-orange-600" id="fr-overhead-cost">$0/yr</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="freelance-rate" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Set Your Freelance Rate</h2>
      <p>Your freelance rate must cover not just your salary equivalent, but also overhead (health insurance, retirement, equipment, software), self-employment taxes, non-billable hours (marketing, admin), and a profit margin for business growth.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Billable vs Total Hours</h3>
      <p>Most freelancers can only bill 60-70% of their working hours. The rest goes to finding clients, admin work, invoicing, and professional development. A common mistake is using 2,080 hours (full-time) when most freelancers bill 1,000-1,500.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const fmt = (n: number) => '$' + Math.round(n).toLocaleString();

    function calcFR() {
      const salary = parseFloat((document.getElementById('fr-salary') as HTMLInputElement).value) || 0;
      const hours = parseFloat((document.getElementById('fr-hours') as HTMLInputElement).value) || 1;
      const overheadPct = (parseFloat((document.getElementById('fr-overhead') as HTMLInputElement).value) || 0) / 100;
      const profitPct = (parseFloat((document.getElementById('fr-profit') as HTMLInputElement).value) || 0) / 100;
      const projectHours = parseFloat((document.getElementById('fr-project-hours') as HTMLInputElement).value) || 1;

      const overheadCost = salary * overheadPct;
      const baseCost = salary + overheadCost;
      const withProfit = baseCost * (1 + profitPct);
      const hourlyRate = withProfit / hours;
      const dayRate = hourlyRate * 8;
      const projectRate = hourlyRate * projectHours;
      const monthlyRevenue = withProfit / 12;

      document.getElementById('fr-hourly')!.textContent = '$' + hourlyRate.toFixed(0);
      document.getElementById('fr-day')!.textContent = fmt(dayRate);
      document.getElementById('fr-project')!.textContent = fmt(projectRate);
      document.getElementById('fr-monthly')!.textContent = fmt(monthlyRevenue);
      document.getElementById('fr-annual')!.textContent = fmt(withProfit);
      document.getElementById('fr-overhead-cost')!.textContent = fmt(overheadCost) + '/yr';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      ['fr-salary', 'fr-hours', 'fr-overhead', 'fr-profit', 'fr-project-hours'].forEach(id => {
        const el = document.getElementById(id);
        if (el) { el.addEventListener('input', calcFR); el.addEventListener('change', calcFR); }
      });
      calcFR();
    }, 50);
  </script>
</CalculatorLayout>
