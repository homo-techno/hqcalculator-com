---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Project Timeline Calculator - Estimate Duration & End Date";
const description = "Calculate project duration, end date, critical path hours, and buffer recommendations based on tasks, team size, and work hours.";
const relatedCalcs = [
  { name: "Productivity", url: "/productivity-calculator", description: "Productivity." },
  { name: "Meeting Cost", url: "/meeting-cost-calculator", description: "Meeting costs." },
  { name: "Employee Turnover", url: "/employee-turnover-calculator", description: "Turnover." },
  { name: "Break Schedule", url: "/break-schedule-calculator", description: "Breaks." },
  { name: "Time Calculator", url: "/time-calculator", description: "Time math." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Project Timeline Calculator" keywords="project timeline, project duration, project planning, end date calculator, critical path, project buffer" breadcrumbs={[{ name: "Project Timeline", url: "/project-timeline-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Project Timeline Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate how long your project will take and when it will finish.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Total Task Hours</label><input type="number" id="pt2-hours" class="pt2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="200" min="1" step="10"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Team Size</label><input type="number" id="pt2-team" class="pt2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3" min="1" max="50" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Work Hours/Day/Person</label><input type="number" id="pt2-hpd" class="pt2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="1" max="12" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Efficiency Factor (%)</label><input type="number" id="pt2-eff" class="pt2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="75" min="25" max="100" step="5"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Critical Path Hours</label><input type="number" id="pt2-critical" class="pt2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="80" min="0" step="10"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Work Days/Week</label><input type="number" id="pt2-days" class="pt2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="1" max="7" step="1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Duration</div>
          <div class="text-5xl font-extrabold font-mono" id="pt2-dur">0</div>
          <div class="text-sm text-blue-200 mt-1">working days</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Calendar Weeks</div><div class="text-xl font-bold" id="pt2-weeks">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">End Date</div><div class="text-xl font-bold" id="pt2-end">-</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Critical Path Days</div><div class="text-xl font-bold" id="pt2-cpd">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Buffer Recommendation</div><div class="text-xl font-bold" id="pt2-buffer">0 days</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">With Buffer End Date</div>
          <div class="text-xl font-bold" id="pt2-buffend">-</div>
        </div>
      </div>
      <ShareButton calculatorId="project-timeline" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Project Estimation Tips</h2>
      <p>Software projects typically run 1.5-2x over initial estimates. A 75% efficiency factor accounts for meetings, code reviews, and context switching. Adding 20-30% buffer helps manage unexpected issues.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcTimeline() {
      const totalHrs = parseFloat((document.getElementById('pt2-hours') as HTMLInputElement).value) || 200;
      const team = parseFloat((document.getElementById('pt2-team') as HTMLInputElement).value) || 1;
      const hpd = parseFloat((document.getElementById('pt2-hpd') as HTMLInputElement).value) || 6;
      const eff = parseFloat((document.getElementById('pt2-eff') as HTMLInputElement).value) / 100 || 0.75;
      const criticalHrs = parseFloat((document.getElementById('pt2-critical') as HTMLInputElement).value) || 0;
      const workDays = parseFloat((document.getElementById('pt2-days') as HTMLInputElement).value) || 5;
      const effectiveHpd = hpd * eff;
      const teamDailyHrs = effectiveHpd * team;
      const parallelDays = Math.ceil(totalHrs / teamDailyHrs);
      const criticalDays = Math.ceil(criticalHrs / effectiveHpd);
      const projectDays = Math.max(parallelDays, criticalDays);
      const calendarWeeks = Math.ceil(projectDays / workDays);
      const bufferDays = Math.ceil(projectDays * 0.25);
      const endDate = new Date();
      let daysAdded = 0;
      let current = new Date();
      while (daysAdded < projectDays) {
        current.setDate(current.getDate() + 1);
        const dow = current.getDay();
        if (workDays >= 7 || (dow !== 0 && dow !== 6)) daysAdded++;
      }
      const endStr = current.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      const buffEnd = new Date(current);
      let buffAdded = 0;
      while (buffAdded < bufferDays) {
        buffEnd.setDate(buffEnd.getDate() + 1);
        const dow = buffEnd.getDay();
        if (workDays >= 7 || (dow !== 0 && dow !== 6)) buffAdded++;
      }
      const buffStr = buffEnd.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      document.getElementById('pt2-dur')!.textContent = projectDays.toString();
      document.getElementById('pt2-weeks')!.textContent = calendarWeeks.toString();
      document.getElementById('pt2-end')!.textContent = endStr;
      document.getElementById('pt2-cpd')!.textContent = criticalDays.toString();
      document.getElementById('pt2-buffer')!.textContent = bufferDays + ' days';
      document.getElementById('pt2-buffend')!.textContent = buffStr;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => { document.querySelectorAll('.pt2-in').forEach(el => { el.addEventListener('input', calcTimeline); el.addEventListener('change', calcTimeline); }); calcTimeline(); }, 50);
  </script>
</CalculatorLayout>
