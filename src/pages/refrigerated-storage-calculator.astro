---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Refrigerated Storage Calculator - Walk-in Cooler/Freezer Load";
const description = "Calculate refrigeration load for walk-in coolers and freezers. Includes transmission, product, infiltration, and equipment heat loads.";

const relatedCalcs = [
  { name: "Refrigeration Cycle Calculator", url: "/refrigeration-cycle-calculator", description: "COP / EER." },
  { name: "Compressor Calculator", url: "/compressor-calculator", description: "Compressor sizing." },
  { name: "Refrigerant Charge Calculator", url: "/refrigerant-charge-calculator", description: "Charge amounts." },
  { name: "Thermal Resistance Calculator", url: "/thermal-resistance-calculator", description: "R/U values." },
  { name: "Heat Exchanger Calculator", url: "/heat-exchanger-calculator", description: "Heat transfer." },
  { name: "Cooling Load Calculator", url: "/cooling-load-calculator", description: "Building cooling." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Refrigerated Storage Calculator"
  keywords="walk-in cooler, walk-in freezer, refrigeration load, cold storage, cooler sizing, freezer sizing, product load"
  breadcrumbs={[{ name: "Refrigerated Storage Calculator", url: "/refrigerated-storage-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Refrigerated Storage Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate refrigeration load for walk-in coolers and freezers.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-5">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Storage Type</label>
          <select id="rs2-type" class="rs2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="cooler" selected>Walk-in Cooler (35°F)</option>
            <option value="freezer">Walk-in Freezer (0°F)</option>
            <option value="blast">Blast Freezer (-20°F)</option>
          </select>
        </div>

        <h3 class="text-lg font-bold text-text">Box Dimensions (exterior)</h3>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Length (ft)</label>
            <input type="number" id="rs2-length" class="rs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="4" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Width (ft)</label>
            <input type="number" id="rs2-width" class="rs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="4" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Height (ft)</label>
            <input type="number" id="rs2-height" class="rs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="6" step="0.5">
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Ambient Temp (°F)</label>
            <input type="number" id="rs2-ambient" class="rs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="90" step="5">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Wall Insulation (R-value)</label>
            <select id="rs2-insul" class="rs2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="18">3" Polyurethane (R-18)</option>
              <option value="24" selected>4" Polyurethane (R-24)</option>
              <option value="32">5" Polyurethane (R-32)</option>
              <option value="40">6" Polyurethane (R-40)</option>
            </select>
          </div>
        </div>

        <h3 class="text-lg font-bold text-text">Product Load</h3>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Product Weight (lbs/day)</label>
            <input type="number" id="rs2-product" class="rs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="500" min="0" step="50">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Product Entry Temp (°F)</label>
            <input type="number" id="rs2-prodtemp" class="rs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="60" step="5">
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-text mb-1">Door Openings (per day)</label>
          <input type="number" id="rs2-doors" class="rs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="0" step="5">
        </div>

        <!-- Results -->
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Refrigeration Load</div>
          <div class="text-4xl font-extrabold" id="rs2-total">--</div>
          <div class="text-sm text-blue-200 mt-1">BTU/hr</div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Transmission Load</div>
            <div class="text-xl font-bold" id="rs2-trans">--</div>
            <div class="text-xs text-text-muted">BTU/hr</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Product Load</div>
            <div class="text-xl font-bold" id="rs2-prodload">--</div>
            <div class="text-xs text-text-muted">BTU/hr</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Infiltration Load</div>
            <div class="text-xl font-bold" id="rs2-infil">--</div>
            <div class="text-xs text-text-muted">BTU/hr</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Internal Load (lights/fans)</div>
            <div class="text-xl font-bold" id="rs2-internal">--</div>
            <div class="text-xs text-text-muted">BTU/hr</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Compressor Sizing (at 16hr run time)</div>
          <div class="text-xl font-bold" id="rs2-compressor">--</div>
        </div>
      </div>

      <ShareButton calculatorId="refrigerated-storage" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl mx-auto prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Walk-in Cooler/Freezer Load Calculation</h2>
      <p>The total refrigeration load consists of four main components:</p>
      <ul>
        <li><strong>Transmission load:</strong> Heat gain through walls, ceiling, and floor (Q = U x A x delta-T)</li>
        <li><strong>Product load:</strong> Heat removed from product to bring it to storage temperature</li>
        <li><strong>Infiltration load:</strong> Warm air entering through door openings</li>
        <li><strong>Internal loads:</strong> Lights, fan motors, people, and equipment</li>
      </ul>
      <p>Compressor is typically sized for 16-18 hours of run time per day to allow for defrost cycles and capacity margin.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcRS2() {
      const storageType = (document.getElementById('rs2-type') as HTMLSelectElement).value;
      const length = parseFloat((document.getElementById('rs2-length') as HTMLInputElement).value) || 0;
      const width = parseFloat((document.getElementById('rs2-width') as HTMLInputElement).value) || 0;
      const height = parseFloat((document.getElementById('rs2-height') as HTMLInputElement).value) || 0;
      const ambient = parseFloat((document.getElementById('rs2-ambient') as HTMLInputElement).value) || 90;
      const rValue = parseFloat((document.getElementById('rs2-insul') as HTMLSelectElement).value) || 24;
      const productLbs = parseFloat((document.getElementById('rs2-product') as HTMLInputElement).value) || 0;
      const prodTemp = parseFloat((document.getElementById('rs2-prodtemp') as HTMLInputElement).value) || 60;
      const doorOpenings = parseFloat((document.getElementById('rs2-doors') as HTMLInputElement).value) || 0;

      // Storage temperatures
      const storageTemps: Record<string, number> = { cooler: 35, freezer: 0, blast: -20 };
      const boxTemp = storageTemps[storageType] || 35;
      const deltaT = ambient - boxTemp;

      // Surface areas
      const floorArea = length * width;
      const wallArea = 2 * (length * height + width * height);
      const ceilingArea = floorArea;
      const totalSurface = wallArea + ceilingArea + floorArea;

      // Transmission load (BTU/hr) = Surface Area * deltaT / R-value
      const transLoad = totalSurface * deltaT / rValue;

      // Product load (BTU/24hr converted to BTU/hr)
      // Specific heat: ~0.8 BTU/lb-°F above freezing, 0.4 below
      // Latent heat of freezing: ~144 BTU/lb (if freezing)
      const prodDeltaT = prodTemp - boxTemp;
      let prodLoadDay = 0;
      if (storageType === 'cooler') {
        prodLoadDay = productLbs * 0.8 * prodDeltaT;
      } else {
        // Above freezing + latent + below freezing
        const aboveFreezing = productLbs * 0.8 * Math.max(0, prodTemp - 32);
        const latent = productLbs * 144;
        const belowFreezing = productLbs * 0.4 * Math.max(0, 32 - boxTemp);
        prodLoadDay = aboveFreezing + latent + belowFreezing;
      }
      const prodLoadHr = prodLoadDay / 24;

      // Infiltration load (BTU/hr)
      // Simplified: volume x air changes x enthalpy difference / 24
      const volume = length * width * height;
      // Door opening infiltration: ~15 CFM per opening minute, ~2 min per opening
      const infiltrationCFM = doorOpenings * 2 * 15 / 60; // average over an hour
      const infiltBTU = infiltrationCFM * 1.08 * deltaT; // sensible only approximation

      // Internal load: lights (~1 W/sq ft) + evaporator fans (~1000 BTU/hr per 1000 sq ft)
      const lightLoad = floorArea * 1.0 * 3.412; // 1 W/sqft to BTU/hr
      const fanLoad = (floorArea / 1000) * 1000;
      const internalLoad = lightLoad + fanLoad;

      const totalLoad = transLoad + prodLoadHr + infiltBTU + internalLoad;

      // Safety factor 10%
      const totalWithSafety = totalLoad * 1.1;

      // Compressor sizing for 16hr runtime
      const compressorLoad = totalWithSafety * 24 / 16;
      const compTons = compressorLoad / 12000;
      const compStr = compTons.toFixed(2) + ' tons (' + Math.round(compressorLoad).toLocaleString() + ' BTU/hr capacity)';

      document.getElementById('rs2-total')!.textContent = Math.round(totalWithSafety).toLocaleString();
      document.getElementById('rs2-trans')!.textContent = Math.round(transLoad).toLocaleString();
      document.getElementById('rs2-prodload')!.textContent = Math.round(prodLoadHr).toLocaleString();
      document.getElementById('rs2-infil')!.textContent = Math.round(infiltBTU).toLocaleString();
      document.getElementById('rs2-internal')!.textContent = Math.round(internalLoad).toLocaleString();
      document.getElementById('rs2-compressor')!.textContent = compStr;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.rs2-in').forEach(el => {
        el.addEventListener('input', calcRS2);
        el.addEventListener('change', calcRS2);
      });
      calcRS2();
    }, 50);
  </script>
</CalculatorLayout>
