---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Propeller Pitch Calculator - Efficiency, Advance Ratio & Slip";
const description = "Calculate propeller efficiency, advance ratio, slip percentage, and RPM-to-speed conversion. Compare fine vs coarse pitch performance.";
const relatedCalcs = [
  { name: "Speed Calculator", url: "/speed-calculator", description: "Speed computations." },
  { name: "Gear Ratio", url: "/gear-ratio-calculator", description: "Gear ratios." },
  { name: "Force Calculator", url: "/force-calculator", description: "Force calculations." },
  { name: "Hull Speed", url: "/hull-speed-calculator", description: "Boat hull speed." },
  { name: "Kinetic Energy", url: "/kinetic-energy-calculator", description: "Energy math." },
  { name: "Acceleration", url: "/acceleration-calculator", description: "Acceleration math." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Propeller Pitch Calculator" keywords="propeller pitch, prop efficiency, advance ratio, propeller slip, RPM speed, fine pitch, coarse pitch, constant speed prop" breadcrumbs={[{ name: "Propeller Pitch", url: "/propeller-pitch-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Propeller Pitch Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Analyze propeller performance including efficiency, advance ratio, slip, and pitch effects.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label for="pp3-dia" class="block text-sm font-medium text-text mb-1">Propeller Diameter (inches)</label>
          <input type="number" id="pp3-dia" class="pp3-in w-full border border-border rounded-lg px-3 py-2" min="0" step="1" />
        </div>
        <div>
          <label for="pp3-pitch" class="block text-sm font-medium text-text mb-1">Geometric Pitch (inches)</label>
          <input type="number" id="pp3-pitch" class="pp3-in w-full border border-border rounded-lg px-3 py-2" min="0" step="1" />
        </div>
        <div>
          <label for="pp3-rpm" class="block text-sm font-medium text-text mb-1">Engine RPM</label>
          <input type="number" id="pp3-rpm" class="pp3-in w-full border border-border rounded-lg px-3 py-2" min="0" step="100" />
        </div>
        <div>
          <label for="pp3-gearr" class="block text-sm font-medium text-text mb-1">Gear Reduction Ratio (1.0 = direct drive)</label>
          <input type="number" id="pp3-gearr" class="pp3-in w-full border border-border rounded-lg px-3 py-2" min="0.1" max="3" step="0.01" />
        </div>
        <div>
          <label for="pp3-tas" class="block text-sm font-medium text-text mb-1">True Airspeed (kts)</label>
          <input type="number" id="pp3-tas" class="pp3-in w-full border border-border rounded-lg px-3 py-2" min="0" step="5" />
        </div>
        <div>
          <label for="pp3-hp" class="block text-sm font-medium text-text mb-1">Engine Horsepower (BHP)</label>
          <input type="number" id="pp3-hp" class="pp3-in w-full border border-border rounded-lg px-3 py-2" min="0" step="5" />
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Propeller Efficiency</div>
          <div class="text-5xl font-extrabold font-mono" id="pp3-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Advance Ratio (J)</div>
            <div class="text-xl font-bold font-mono" id="pp3-j">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Propeller Slip</div>
            <div class="text-xl font-bold font-mono" id="pp3-slip">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Prop RPM</div>
            <div class="text-xl font-bold font-mono" id="pp3-prpm">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Tip Speed</div>
            <div class="text-xl font-bold font-mono" id="pp3-tip">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Theoretical Speed</div>
            <div class="text-xl font-bold font-mono" id="pp3-thspd">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Thrust HP (est.)</div>
            <div class="text-xl font-bold font-mono" id="pp3-thp">--</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Pitch Advisory</div>
          <div class="text-lg font-bold font-mono" id="pp3-adv">--</div>
        </div>
      </div>
      <ShareButton calculatorId="propeller-pitch" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcPP3() {
      const dia = parseFloat((document.getElementById('pp3-dia') as HTMLInputElement).value) || 74;
      const pitch = parseFloat((document.getElementById('pp3-pitch') as HTMLInputElement).value) || 64;
      const rpm = parseFloat((document.getElementById('pp3-rpm') as HTMLInputElement).value) || 2500;
      const gearR = parseFloat((document.getElementById('pp3-gearr') as HTMLInputElement).value) || 1.0;
      const tas = parseFloat((document.getElementById('pp3-tas') as HTMLInputElement).value) || 120;
      const hp = parseFloat((document.getElementById('pp3-hp') as HTMLInputElement).value) || 180;

      // Prop RPM
      const propRPM = rpm / gearR;

      // Diameter in feet
      const diaFt = dia / 12;

      // Revolutions per second
      const rps = propRPM / 60;

      // Advance ratio J = V / (n * D) where V is in ft/s
      const tasFtS = tas * 1.68781; // kts to ft/s
      const J = rps > 0 ? tasFtS / (rps * diaFt) : 0;

      // Theoretical speed (no slip) = pitch * RPM / (12 * 5280 / 6076.12) in knots
      const thSpeedFtMin = (pitch / 12) * propRPM;
      const thSpeedKts = thSpeedFtMin / 6076.12 * 60;

      // Slip percentage
      const slip = thSpeedKts > 0 ? ((thSpeedKts - tas) / thSpeedKts) * 100 : 0;

      // Propeller efficiency estimate (simplified)
      // eta ~ 1 - slip/100 (rough approximation, typical range 0.7-0.85)
      const efficiency = Math.max(0, Math.min(1 - slip / 100, 0.95));

      // Tip speed (ft/s)
      const tipSpeedFtS = Math.PI * diaFt * rps;
      const tipSpeedMach = tipSpeedFtS / 1116; // speed of sound at SL ~1116 ft/s
      // Helical tip speed including forward motion
      const helicalTip = Math.sqrt(tipSpeedFtS * tipSpeedFtS + tasFtS * tasFtS);

      // Thrust HP
      const thp = hp * efficiency;

      document.getElementById('pp3-result')!.textContent = (efficiency * 100).toFixed(1) + '%';
      document.getElementById('pp3-j')!.textContent = J.toFixed(3);
      document.getElementById('pp3-slip')!.textContent = slip.toFixed(1) + '%';
      document.getElementById('pp3-prpm')!.textContent = Math.round(propRPM).toLocaleString();
      document.getElementById('pp3-tip')!.textContent = Math.round(tipSpeedFtS) + ' ft/s (M' + tipSpeedMach.toFixed(2) + ')';
      document.getElementById('pp3-thspd')!.textContent = thSpeedKts.toFixed(0) + ' kts';
      document.getElementById('pp3-thp')!.textContent = thp.toFixed(0) + ' THP';

      let adv = '';
      if (tipSpeedMach > 0.85) adv = 'WARNING: Tip speed near/exceeding Mach - noise and efficiency loss';
      else if (slip < 10) adv = 'Low slip - consider finer pitch for takeoff';
      else if (slip > 35) adv = 'High slip - consider coarser pitch for cruise';
      else adv = 'Normal operating range';
      document.getElementById('pp3-adv')!.textContent = adv;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      (document.getElementById('pp3-dia') as HTMLInputElement).value = '74';
      (document.getElementById('pp3-pitch') as HTMLInputElement).value = '64';
      (document.getElementById('pp3-rpm') as HTMLInputElement).value = '2500';
      (document.getElementById('pp3-gearr') as HTMLInputElement).value = '1.0';
      (document.getElementById('pp3-tas') as HTMLInputElement).value = '120';
      (document.getElementById('pp3-hp') as HTMLInputElement).value = '180';
      document.querySelectorAll('.pp3-in').forEach(el => { el.addEventListener('input', calcPP3); el.addEventListener('change', calcPP3); });
      calcPP3();
    }, 50);
  </script>
</CalculatorLayout>
