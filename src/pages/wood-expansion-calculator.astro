---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Wood Expansion Calculator - Seasonal Movement Estimator";
const description = "Calculate wood expansion and contraction due to moisture content changes. Estimate seasonal movement for furniture, flooring, and cabinet design.";

const relatedCalcs = [
  { name: "Wood Moisture Calculator", url: "/wood-moisture-calculator", description: "MC and EMC calculator." },
  { name: "Board Foot Calculator", url: "/board-foot-calculator", description: "Board feet calculator." },
  { name: "Wood Weight Calculator", url: "/wood-weight-calculator", description: "Wood weight estimator." },
  { name: "Wood Drying Calculator", url: "/wood-drying-calculator", description: "Drying time estimation." },
  { name: "Dovetail Joint Calculator", url: "/dovetail-joint-calculator", description: "Dovetail layout." },
  { name: "Mortise & Tenon Calculator", url: "/mortise-tenon-calculator", description: "M&T joint sizing." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Wood Expansion Calculator"
  keywords="wood expansion calculator, wood movement, wood shrinkage, seasonal movement, tangential expansion, radial expansion, wood moisture"
  breadcrumbs={[{ name: "Wood Expansion Calculator", url: "/wood-expansion-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Wood Expansion Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate wood dimensional change from moisture content fluctuations.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Wood Species</label>
        <select id="we2-species" class="we2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="oak-red" selected>Red Oak</option>
          <option value="oak-white">White Oak</option>
          <option value="maple-hard">Hard Maple</option>
          <option value="maple-soft">Soft Maple</option>
          <option value="walnut">Black Walnut</option>
          <option value="cherry">Cherry</option>
          <option value="pine-white">White Pine</option>
          <option value="pine-yellow">Yellow Pine</option>
          <option value="poplar">Poplar</option>
          <option value="ash">White Ash</option>
          <option value="birch">Yellow Birch</option>
          <option value="mahogany">Mahogany</option>
          <option value="cedar">Western Red Cedar</option>
          <option value="douglas-fir">Douglas Fir</option>
          <option value="teak">Teak</option>
        </select>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Board Width (inches)</label>
        <input type="number" id="we2-width" class="we2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="1" step="0.25">
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Grain Orientation</label>
        <select id="we2-grain" class="we2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="flat" selected>Flat Sawn (Tangential)</option>
          <option value="quarter">Quarter Sawn (Radial)</option>
        </select>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Initial MC (%)</label>
          <input type="number" id="we2-mc1" class="we2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="0" max="30" step="0.5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Final MC (%)</label>
          <input type="number" id="we2-mc2" class="we2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="14" min="0" max="30" step="0.5">
        </div>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Width Change</div>
        <div class="text-4xl font-extrabold" id="we2-change">--</div>
        <div class="text-sm text-blue-200 mt-1" id="we2-direction">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">New Width</div>
          <div class="text-xl font-bold" id="we2-new-width">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">% Change</div>
          <div class="text-xl font-bold" id="we2-pct">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Tangential Coeff.</div>
          <div class="text-xl font-bold" id="we2-tang">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Radial Coeff.</div>
          <div class="text-xl font-bold" id="we2-rad">--</div>
        </div>
      </div>

      <ShareButton calculatorId="wood-expansion" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Wood Movement Works</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Change = Width x Coefficient x MC Change / 100</strong></p>
        <p>Movement occurs below fiber saturation point (~30% MC)</p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">Design Tips</h3>
      <ul>
        <li><strong>Allow for movement:</strong> Use expansion gaps in tabletops, panels, and flooring</li>
        <li><strong>Quarter-sawn is more stable:</strong> About half the movement of flat-sawn</li>
        <li><strong>Grain direction matters:</strong> Wood barely moves along the grain (longitudinal)</li>
        <li><strong>Seasonal range:</strong> Indoor MC typically varies 4-5% between winter and summer</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcWE2() {
      // Shrinkage coefficients: [tangential%, radial%] (green to oven-dry)
      const species: Record<string, [number, number]> = {
        'oak-red': [8.6, 4.0],
        'oak-white': [10.5, 5.6],
        'maple-hard': [9.9, 4.8],
        'maple-soft': [8.2, 4.0],
        'walnut': [7.8, 5.5],
        'cherry': [7.1, 3.7],
        'pine-white': [6.1, 2.1],
        'pine-yellow': [7.7, 4.3],
        'poplar': [8.2, 4.6],
        'ash': [7.8, 4.9],
        'birch': [9.2, 6.3],
        'mahogany': [5.1, 3.7],
        'cedar': [5.0, 2.4],
        'douglas-fir': [7.6, 4.8],
        'teak': [4.0, 2.2],
      };

      const sp = (document.getElementById('we2-species') as HTMLSelectElement).value;
      const width = parseFloat((document.getElementById('we2-width') as HTMLInputElement).value) || 12;
      const grain = (document.getElementById('we2-grain') as HTMLSelectElement).value;
      const mc1 = parseFloat((document.getElementById('we2-mc1') as HTMLInputElement).value) || 0;
      const mc2 = parseFloat((document.getElementById('we2-mc2') as HTMLInputElement).value) || 0;

      const coeffs = species[sp] || [7.0, 4.0];
      const tangCoeff = coeffs[0];
      const radCoeff = coeffs[1];

      // Coefficient per 1% MC change (total shrinkage is green-to-oven-dry, ~30% MC range)
      const coeff = grain === 'flat' ? tangCoeff : radCoeff;
      const coeffPerPct = coeff / 30; // Approximate: fiber saturation ~30%

      const mcChange = mc2 - mc1;
      const pctChange = coeffPerPct * mcChange;
      const dimensionChange = width * (pctChange / 100);
      const newWidth = width + dimensionChange;

      const direction = mcChange > 0 ? 'expansion (gaining moisture)' : mcChange < 0 ? 'contraction (losing moisture)' : 'no change';

      document.getElementById('we2-change')!.textContent = (mcChange >= 0 ? '+' : '') + dimensionChange.toFixed(4) + '"';
      document.getElementById('we2-direction')!.textContent = direction;
      document.getElementById('we2-new-width')!.textContent = newWidth.toFixed(4) + '"';
      document.getElementById('we2-pct')!.textContent = (mcChange >= 0 ? '+' : '') + pctChange.toFixed(2) + '%';
      document.getElementById('we2-tang')!.textContent = tangCoeff.toFixed(1) + '%';
      document.getElementById('we2-rad')!.textContent = radCoeff.toFixed(1) + '%';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.we2-in').forEach(el => {
        el.addEventListener('input', calcWE2);
        el.addEventListener('change', calcWE2);
      });
      calcWE2();
    }, 50);
  </script>
</CalculatorLayout>
