---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Router Bit Speed Calculator - RPM & Feed Rate by Bit Diameter";
const description = "Calculate optimal router RPM and feed rate based on bit diameter and material. Get safe speed recommendations for straight, spiral, and profile bits.";

const relatedCalcs = [
  { name: "Saw Blade Calculator", url: "/saw-blade-calculator", description: "Saw blade specs." },
  { name: "Wood Turning Speed Calculator", url: "/wood-turning-speed-calculator", description: "Lathe RPM." },
  { name: "Dado Joint Calculator", url: "/dado-joint-calculator", description: "Dado joint sizing." },
  { name: "Board Foot Calculator", url: "/board-foot-calculator", description: "Board feet calculator." },
  { name: "Wood Finish Calculator", url: "/wood-finish-calculator", description: "Finish coverage." },
  { name: "Plywood Cut Calculator", url: "/plywood-cut-calculator", description: "Plywood optimizer." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Router Bit Speed Calculator"
  keywords="router bit speed, router RPM, feed rate, bit diameter, router table, plunge router, profile bit speed"
  breadcrumbs={[{ name: "Router Bit Speed Calculator", url: "/router-bit-speed-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Router Bit Speed Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find the optimal router RPM and feed rate for your bit diameter and material.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Bit Diameter (inches)</label>
        <select id="rbs-diam" class="rbs-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="0.125">1/8"</option>
          <option value="0.25">1/4"</option>
          <option value="0.375">3/8"</option>
          <option value="0.5" selected>1/2"</option>
          <option value="0.75">3/4"</option>
          <option value="1">1"</option>
          <option value="1.25">1-1/4"</option>
          <option value="1.5">1-1/2"</option>
          <option value="2">2"</option>
          <option value="2.5">2-1/2"</option>
          <option value="3">3" (raised panel)</option>
          <option value="3.5">3-1/2" (raised panel)</option>
        </select>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Number of Flutes</label>
          <select id="rbs-flutes" class="rbs-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="1">1 Flute</option>
            <option value="2" selected>2 Flutes</option>
            <option value="3">3 Flutes</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Material</label>
          <select id="rbs-matl" class="rbs-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="soft">Softwood (Pine, Cedar)</option>
            <option value="hard" selected>Hardwood (Oak, Maple)</option>
            <option value="ply">Plywood / MDF</option>
            <option value="plastic">Plastic / Acrylic</option>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Depth of Cut (inches)</label>
          <input type="number" id="rbs-depth" class="rbs-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.25" min="0.0625" max="2" step="0.0625">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Collet Size</label>
          <select id="rbs-collet" class="rbs-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="0.25">1/4"</option>
            <option value="0.5" selected>1/2"</option>
          </select>
        </div>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended RPM</div>
        <div class="text-4xl font-extrabold" id="rbs-rpm">--</div>
        <div class="text-sm text-blue-200 mt-1" id="rbs-rpm-sub">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Feed Rate</div>
          <div class="text-xl font-bold" id="rbs-feed">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Chip Load</div>
          <div class="text-xl font-bold" id="rbs-chip">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Rim Speed</div>
          <div class="text-xl font-bold" id="rbs-rim">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Max Depth/Pass</div>
          <div class="text-xl font-bold" id="rbs-maxd">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h4 class="font-semibold text-sm text-text mb-1">Notes</h4>
        <p class="text-sm text-text-secondary" id="rbs-notes">--</p>
      </div>

      <ShareButton calculatorId="router-bit-speed" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Router Speed Guide</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Larger bits = lower RPM</strong></p>
        <p><strong>Ideal chip load: 0.003" - 0.005" per tooth</strong></p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">General RPM Guidelines by Bit Diameter</h3>
      <ul>
        <li><strong>Up to 1":</strong> 22,000 - 24,000 RPM</li>
        <li><strong>1" to 2":</strong> 18,000 - 22,000 RPM</li>
        <li><strong>2" to 2-1/2":</strong> 12,000 - 16,000 RPM</li>
        <li><strong>3" to 3-1/2":</strong> 8,000 - 12,000 RPM (raised panel bits)</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcRBS() {
      const diam = parseFloat((document.getElementById('rbs-diam') as HTMLSelectElement).value) || 0.5;
      const flutes = parseInt((document.getElementById('rbs-flutes') as HTMLSelectElement).value) || 2;
      const matl = (document.getElementById('rbs-matl') as HTMLSelectElement).value;
      const depth = parseFloat((document.getElementById('rbs-depth') as HTMLInputElement).value) || 0.25;
      const collet = parseFloat((document.getElementById('rbs-collet') as HTMLSelectElement).value) || 0.5;

      // Max RPM by bit diameter (safety guidelines)
      let maxRPM = 24000;
      if (diam <= 1) maxRPM = 24000;
      else if (diam <= 1.5) maxRPM = 22000;
      else if (diam <= 2) maxRPM = 18000;
      else if (diam <= 2.5) maxRPM = 16000;
      else if (diam <= 3) maxRPM = 12000;
      else maxRPM = 10000;

      // Material adjustment
      const matlFactor: Record<string, number> = {
        'soft': 1.0, 'hard': 0.9, 'ply': 0.95, 'plastic': 0.7
      };
      const rpm = Math.round(maxRPM * (matlFactor[matl] || 0.9) / 100) * 100;

      // Chip load target by material
      const chipTargets: Record<string, number> = {
        'soft': 0.005, 'hard': 0.004, 'ply': 0.004, 'plastic': 0.003
      };
      const chipLoad = chipTargets[matl] || 0.004;

      // Feed rate = chip load x flutes x RPM (inches per minute)
      const feedIPM = chipLoad * flutes * rpm;
      const feedFPM = feedIPM / 12;

      // Rim speed (SFM)
      const rimSFM = Math.PI * diam * rpm / 12;

      // Max depth per pass: 1/2 bit diameter for straight bits, 1/4 for large profile bits
      const maxDepthPerPass = diam > 1.5 ? diam / 4 : diam / 2;
      const passesNeeded = Math.ceil(depth / maxDepthPerPass);

      document.getElementById('rbs-rpm')!.textContent = rpm.toLocaleString();
      document.getElementById('rbs-rpm-sub')!.textContent = 'for ' + diam + '" diameter bit in ' + matl + ' material';
      document.getElementById('rbs-feed')!.textContent = feedFPM.toFixed(1) + ' ft/min';
      document.getElementById('rbs-chip')!.textContent = chipLoad.toFixed(4) + '" per tooth';
      document.getElementById('rbs-rim')!.textContent = Math.round(rimSFM).toLocaleString() + ' SFM';
      document.getElementById('rbs-maxd')!.textContent = maxDepthPerPass.toFixed(3) + '" (' + passesNeeded + ' pass' + (passesNeeded > 1 ? 'es' : '') + ')';

      let notes = '';
      if (diam > collet * 4) {
        notes += 'Use in a router table only for bits this large. ';
      }
      if (diam > 2) {
        notes += 'Large profile bit - use reduced speed and take light passes. ';
      }
      if (depth > maxDepthPerPass) {
        notes += 'Take multiple passes at ' + maxDepthPerPass.toFixed(3) + '" per pass. ';
      }
      if (matl === 'plastic') {
        notes += 'Use single-flute O-flute bits for best results in plastic. ';
      }
      if (!notes) {
        notes = 'Standard routing operation. Ensure workpiece is securely clamped.';
      }
      document.getElementById('rbs-notes')!.textContent = notes;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.rbs-in').forEach(el => {
        el.addEventListener('input', calcRBS);
        el.addEventListener('change', calcRBS);
      });
      calcRBS();
    }, 50);
  </script>
</CalculatorLayout>
