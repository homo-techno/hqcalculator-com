---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Glaze Recipe Calculator - Batch Scaling & Seger Formula";
const description = "Scale glaze batch recipes from unity formula (Seger formula). Convert between percentage and gram weights for any batch size.";
const relatedCalcs = [
  { name: "Kiln Temperature Calculator", url: "/kiln-temperature-calculator", description: "Firing schedules & cone charts." },
  { name: "Glaze Chemistry Calculator", url: "/glaze-chemistry-calculator", description: "Analyze glaze oxide ratios." },
  { name: "Clay Shrinkage Calculator", url: "/clay-shrinkage-calculator", description: "Predict clay shrinkage rates." },
  { name: "Kiln Energy Calculator", url: "/kiln-energy-calculator", description: "Estimate kiln firing costs." },
  { name: "Ceramic Mold Calculator", url: "/ceramic-mold-calculator", description: "Plaster mold mixing ratios." },
  { name: "Pottery Pricing Calculator", url: "/pottery-pricing-calculator", description: "Price your pottery pieces." },
];
---
<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Glaze Recipe Calculator"
  keywords="glaze recipe, batch recipe, seger formula, unity formula, glaze scaling, glaze calculation, pottery glaze, ceramic glaze"
  breadcrumbs={[{ name: "Glaze Recipe Calculator", url: "/glaze-recipe-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Glaze Recipe Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Scale glaze batch recipes to any size. Enter your recipe percentages and desired total batch weight.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Desired Batch Size (grams)</label>
        <input type="number" id="gr2-batch" class="gr2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1000" min="1" step="50">
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Base Glaze Recipe (percentage recipe)</label>
        <div class="space-y-2" id="gr2-ingredients">
          <div class="grid grid-cols-12 gap-2 items-center">
            <div class="col-span-6"><input type="text" class="gr2-name w-full px-3 py-2 border border-border rounded-lg text-sm" value="Feldspar (Custer)" placeholder="Material name"></div>
            <div class="col-span-4"><input type="number" class="gr2-pct gr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="40" min="0" max="100" step="0.1" placeholder="%"></div>
            <div class="col-span-2 text-right"><span class="gr2-grams text-sm font-mono font-bold">--</span></div>
          </div>
          <div class="grid grid-cols-12 gap-2 items-center">
            <div class="col-span-6"><input type="text" class="gr2-name w-full px-3 py-2 border border-border rounded-lg text-sm" value="Silica (Flint)" placeholder="Material name"></div>
            <div class="col-span-4"><input type="number" class="gr2-pct gr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="25" min="0" max="100" step="0.1" placeholder="%"></div>
            <div class="col-span-2 text-right"><span class="gr2-grams text-sm font-mono font-bold">--</span></div>
          </div>
          <div class="grid grid-cols-12 gap-2 items-center">
            <div class="col-span-6"><input type="text" class="gr2-name w-full px-3 py-2 border border-border rounded-lg text-sm" value="Whiting" placeholder="Material name"></div>
            <div class="col-span-4"><input type="number" class="gr2-pct gr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="20" min="0" max="100" step="0.1" placeholder="%"></div>
            <div class="col-span-2 text-right"><span class="gr2-grams text-sm font-mono font-bold">--</span></div>
          </div>
          <div class="grid grid-cols-12 gap-2 items-center">
            <div class="col-span-6"><input type="text" class="gr2-name w-full px-3 py-2 border border-border rounded-lg text-sm" value="EPK Kaolin" placeholder="Material name"></div>
            <div class="col-span-4"><input type="number" class="gr2-pct gr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="15" min="0" max="100" step="0.1" placeholder="%"></div>
            <div class="col-span-2 text-right"><span class="gr2-grams text-sm font-mono font-bold">--</span></div>
          </div>
          <div class="grid grid-cols-12 gap-2 items-center">
            <div class="col-span-6"><input type="text" class="gr2-name w-full px-3 py-2 border border-border rounded-lg text-sm" value="" placeholder="Material name"></div>
            <div class="col-span-4"><input type="number" class="gr2-pct gr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="" min="0" max="100" step="0.1" placeholder="%"></div>
            <div class="col-span-2 text-right"><span class="gr2-grams text-sm font-mono font-bold">--</span></div>
          </div>
          <div class="grid grid-cols-12 gap-2 items-center">
            <div class="col-span-6"><input type="text" class="gr2-name w-full px-3 py-2 border border-border rounded-lg text-sm" value="" placeholder="Material name"></div>
            <div class="col-span-4"><input type="number" class="gr2-pct gr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="" min="0" max="100" step="0.1" placeholder="%"></div>
            <div class="col-span-2 text-right"><span class="gr2-grams text-sm font-mono font-bold">--</span></div>
          </div>
        </div>
        <div class="text-xs text-text-muted mt-1">Enter material names and percentages. Grams are calculated automatically.</div>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Colorant / Additive (% of base, added on top)</label>
        <div class="grid grid-cols-12 gap-2 items-center">
          <div class="col-span-6"><input type="text" id="gr2-add-name" class="w-full px-3 py-2 border border-border rounded-lg text-sm" value="" placeholder="e.g. Iron Oxide"></div>
          <div class="col-span-4"><input type="number" id="gr2-add-pct" class="gr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="" min="0" max="50" step="0.1" placeholder="%"></div>
          <div class="col-span-2 text-right"><span id="gr2-add-grams" class="text-sm font-mono font-bold">--</span></div>
        </div>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Batch Weight</div>
        <div class="text-4xl font-extrabold" id="gr2-total">--</div>
        <div class="text-sm text-blue-200 mt-1">grams</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Recipe Total %</div>
          <div class="text-xl font-bold" id="gr2-pct-total">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Water to Add (~)</div>
          <div class="text-xl font-bold" id="gr2-water">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-4">
        <p class="text-xs text-text-muted" id="gr2-note">--</p>
      </div>

      <ShareButton calculatorId="glaze-recipe" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Scale Glaze Recipes</h2>
      <p>A glaze recipe is typically expressed as percentages that total 100%. To scale to a batch size, multiply each percentage by the desired total grams and divide by 100. Colorants and additives are added on top of the 100% base.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Glaze Mixing Tips</h3>
      <ul>
        <li>Always weigh materials on a gram scale (do not measure by volume)</li>
        <li>Add water gradually - typically 50-70% water by weight of dry materials</li>
        <li>Screen glaze through an 80-mesh sieve at least twice</li>
        <li>Test new glazes on test tiles before applying to finished work</li>
        <li>Record specific gravity with a hydrometer for consistency</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcGR2() {
      const batch = parseFloat((document.getElementById('gr2-batch') as HTMLInputElement).value) || 0;
      const pctInputs = document.querySelectorAll('.gr2-pct');
      const gramSpans = document.querySelectorAll('.gr2-grams');

      let totalPct = 0;
      let totalGrams = 0;

      pctInputs.forEach((input, i) => {
        const pct = parseFloat((input as HTMLInputElement).value) || 0;
        totalPct += pct;
        const grams = (pct / 100) * batch;
        totalGrams += grams;
        if (gramSpans[i]) {
          (gramSpans[i] as HTMLElement).textContent = grams > 0 ? grams.toFixed(1) + 'g' : '--';
        }
      });

      // Additive
      const addPct = parseFloat((document.getElementById('gr2-add-pct') as HTMLInputElement).value) || 0;
      const addGrams = (addPct / 100) * batch;
      document.getElementById('gr2-add-grams')!.textContent = addGrams > 0 ? addGrams.toFixed(1) + 'g' : '--';

      const grandTotal = totalGrams + addGrams;
      document.getElementById('gr2-total')!.textContent = grandTotal.toFixed(0);
      document.getElementById('gr2-pct-total')!.textContent = totalPct.toFixed(1) + '%';

      // Water estimate (about 55% of dry weight for dipping consistency)
      const water = Math.round(grandTotal * 0.55);
      document.getElementById('gr2-water')!.textContent = water + 'g';

      // Note
      let note = '';
      if (totalPct < 99.5) note = 'Warning: Recipe percentages total less than 100%. Check your recipe.';
      else if (totalPct > 100.5) note = 'Warning: Recipe percentages total more than 100%. Check your recipe.';
      else note = 'Recipe looks balanced. Add water gradually and sieve through 80-mesh.';
      document.getElementById('gr2-note')!.textContent = note;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.gr2-in').forEach(el => {
        el.addEventListener('input', calcGR2);
        el.addEventListener('change', calcGR2);
      });
      calcGR2();
    }, 50);
  </script>
</CalculatorLayout>
