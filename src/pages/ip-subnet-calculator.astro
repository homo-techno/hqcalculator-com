---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "IP Subnet Calculator - CIDR & Subnet Mask Tool 2026";
const description = "Free IP subnet calculator. Calculate network address, broadcast address, usable hosts, wildcard mask, and CIDR notation from any IPv4 address and subnet mask.";

const relatedCalcs = [
  { name: "Bandwidth Calculator", url: "/bandwidth-calculator", description: "Network bandwidth requirements." },
  { name: "Network Throughput Calculator", url: "/network-throughput-calculator", description: "TCP throughput estimation." },
  { name: "Network Availability Calculator", url: "/network-availability-calculator", description: "Uptime/downtime from availability." },
  { name: "Data Transfer Calculator", url: "/data-transfer-calculator", description: "File transfer time estimation." },
  { name: "Binary Calculator", url: "/binary-calculator", description: "Binary number operations." },
  { name: "Hex Calculator", url: "/hex-calculator", description: "Hexadecimal operations." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="IP Subnet Calculator"
  keywords="IP subnet calculator, CIDR calculator, subnet mask, network address, broadcast address, usable hosts, wildcard mask, IPv4 subnetting"
  breadcrumbs={[{ name: "IP Subnet Calculator", url: "/ip-subnet-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">IP Subnet Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Enter an IPv4 address and CIDR prefix length to calculate network details including usable host range, broadcast address, and wildcard mask.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">IP Address</label>
        <input type="text" id="ips-ip" class="ips-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold font-mono" value="192.168.1.100" placeholder="e.g. 192.168.1.100">
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-text mb-1">CIDR Prefix Length (/ notation)</label>
        <div class="flex items-center gap-3">
          <span class="text-lg font-bold text-text-muted">/</span>
          <input type="number" id="ips-cidr" class="ips-in w-24 px-4 py-3 border border-border rounded-xl text-lg font-bold text-center" value="24" min="0" max="32" step="1">
          <input type="range" id="ips-slider" class="ips-in flex-1" min="0" max="32" value="24" step="1">
        </div>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm font-medium text-blue-100 mb-1">Usable Hosts</div>
        <div class="text-4xl font-extrabold" id="ips-hosts">--</div>
      </div>

      <!-- Detail Results -->
      <div class="space-y-2 mb-6">
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Network Address</span>
          <span class="font-bold font-mono text-text" id="ips-network">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Broadcast Address</span>
          <span class="font-bold font-mono text-text" id="ips-broadcast">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">First Usable Host</span>
          <span class="font-bold font-mono text-text" id="ips-first">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Last Usable Host</span>
          <span class="font-bold font-mono text-text" id="ips-last">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Subnet Mask</span>
          <span class="font-bold font-mono text-text" id="ips-mask">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Wildcard Mask</span>
          <span class="font-bold font-mono text-text" id="ips-wildcard">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Total Addresses</span>
          <span class="font-bold font-mono text-text" id="ips-total">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">IP Class</span>
          <span class="font-bold text-text" id="ips-class">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">IP Type</span>
          <span class="font-bold text-text" id="ips-type">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Binary Subnet Mask</span>
          <span class="font-bold font-mono text-text text-xs" id="ips-binary">--</span>
        </div>
      </div>

      <ShareButton calculatorId="ip-subnet" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Understanding IP Subnetting</h2>
      <p>IP subnetting divides a network into smaller subnetworks. The CIDR prefix length defines how many bits are used for the network portion of the address, with the remaining bits used for host addresses.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono text-sm">
        Usable Hosts = 2^(32 - prefix) - 2
      </div>
      <p>The two subtracted addresses are the network address (all host bits 0) and the broadcast address (all host bits 1). For /31 and /32 subnets, special rules apply per RFC 3021.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcIPS() {
      const ipStr = (document.getElementById('ips-ip') as HTMLInputElement).value.trim();
      const cidr = parseInt((document.getElementById('ips-cidr') as HTMLInputElement).value) || 24;

      // Sync slider and input
      (document.getElementById('ips-slider') as HTMLInputElement).value = String(cidr);
      (document.getElementById('ips-cidr') as HTMLInputElement).value = String(cidr);

      const parts = ipStr.split('.').map(p => parseInt(p));
      if (parts.length !== 4 || parts.some(p => isNaN(p) || p < 0 || p > 255)) {
        document.getElementById('ips-hosts')!.textContent = 'Invalid IP';
        return;
      }

      const ipNum = ((parts[0] << 24) | (parts[1] << 16) | (parts[2] << 8) | parts[3]) >>> 0;
      const maskNum = cidr === 0 ? 0 : (0xFFFFFFFF << (32 - cidr)) >>> 0;
      const wildcardNum = (~maskNum) >>> 0;
      const networkNum = (ipNum & maskNum) >>> 0;
      const broadcastNum = (networkNum | wildcardNum) >>> 0;

      const toIP = (n: number) => [(n >>> 24) & 255, (n >>> 16) & 255, (n >>> 8) & 255, n & 255].join('.');

      const totalAddresses = Math.pow(2, 32 - cidr);
      let usableHosts = totalAddresses - 2;
      let firstHost = networkNum + 1;
      let lastHost = broadcastNum - 1;

      if (cidr === 32) { usableHosts = 1; firstHost = networkNum; lastHost = networkNum; }
      else if (cidr === 31) { usableHosts = 2; firstHost = networkNum; lastHost = broadcastNum; }
      else if (usableHosts < 0) { usableHosts = 0; }

      // Subnet mask binary
      const maskBin = maskNum.toString(2).padStart(32, '0');
      const maskBinFormatted = maskBin.substring(0,8) + '.' + maskBin.substring(8,16) + '.' + maskBin.substring(16,24) + '.' + maskBin.substring(24,32);

      // IP class
      let ipClass = 'A';
      if (parts[0] >= 128 && parts[0] <= 191) ipClass = 'B';
      else if (parts[0] >= 192 && parts[0] <= 223) ipClass = 'C';
      else if (parts[0] >= 224 && parts[0] <= 239) ipClass = 'D (Multicast)';
      else if (parts[0] >= 240) ipClass = 'E (Reserved)';

      // Private or Public
      let ipType = 'Public';
      if (parts[0] === 10) ipType = 'Private (RFC 1918)';
      else if (parts[0] === 172 && parts[1] >= 16 && parts[1] <= 31) ipType = 'Private (RFC 1918)';
      else if (parts[0] === 192 && parts[1] === 168) ipType = 'Private (RFC 1918)';
      else if (parts[0] === 127) ipType = 'Loopback';
      else if (parts[0] === 169 && parts[1] === 254) ipType = 'Link-Local';

      document.getElementById('ips-hosts')!.textContent = usableHosts.toLocaleString();
      document.getElementById('ips-network')!.textContent = toIP(networkNum) + '/' + cidr;
      document.getElementById('ips-broadcast')!.textContent = toIP(broadcastNum);
      document.getElementById('ips-first')!.textContent = toIP(firstHost);
      document.getElementById('ips-last')!.textContent = toIP(lastHost);
      document.getElementById('ips-mask')!.textContent = toIP(maskNum);
      document.getElementById('ips-wildcard')!.textContent = toIP(wildcardNum);
      document.getElementById('ips-total')!.textContent = totalAddresses.toLocaleString();
      document.getElementById('ips-class')!.textContent = 'Class ' + ipClass;
      document.getElementById('ips-type')!.textContent = ipType;
      document.getElementById('ips-binary')!.textContent = maskBinFormatted;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ips-in').forEach(el => { el.addEventListener('input', calcIPS); el.addEventListener('change', calcIPS); });
      calcIPS();
    }, 50);
  </script>
</CalculatorLayout>
