---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Ideal Gas Law Calculator";
const description = "Calculate pressure, volume, temperature, or moles using the ideal gas law PV = nRT.";
const relatedCalcs = [
  { name: "Molarity", url: "/molarity-calculator", description: "Molarity." },
  { name: "Mole Calculator", url: "/mole-calculator", description: "Moles." },
  { name: "pH Calculator", url: "/ph-calculator", description: "pH." },
  { name: "Dilution", url: "/dilution-calculator", description: "Dilution." },
  { name: "Scientific Notation", url: "/scientific-notation-calculator", description: "Notation." },
  { name: "Temperature", url: "/temperature-converter", description: "Temperature." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Ideal Gas Law Calculator" keywords="ideal gas law, PV=nRT, gas pressure, gas volume, gas temperature, moles of gas" breadcrumbs={[{ name: "Ideal Gas Law", url: "/ideal-gas-law-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Ideal Gas Law Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">PV = nRT — solve for any variable.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="flex gap-2 flex-wrap">
          <button class="ig-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 border-primary bg-blue-50 text-primary" data-mode="P">Find P</button>
          <button class="ig-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-mode="V">Find V</button>
          <button class="ig-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-mode="n">Find n</button>
          <button class="ig-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-mode="T">Find T</button>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Pressure (atm)</label><input type="number" id="ig-p" class="ig-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="0" step="0.1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Volume (L)</label><input type="number" id="ig-v" class="ig-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="22.414" min="0" step="0.1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Moles (n)</label><input type="number" id="ig-n" class="ig-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="0" step="0.01"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Temperature (K)</label><input type="number" id="ig-t" class="ig-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="273.15" min="0" step="1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="ig-label">Pressure</div>
          <div class="text-5xl font-extrabold font-mono" id="ig-result">0</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">P in kPa</div><div class="text-xl font-bold font-mono" id="ig-kpa">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">T in °C</div><div class="text-xl font-bold font-mono" id="ig-celsius">0</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Formula</h3>
          <div class="text-xs font-mono" id="ig-formula">PV = nRT, R = 0.08206 L·atm/(mol·K)</div>
        </div>
      </div>
      <ShareButton calculatorId="ideal-gas-law" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    let igMode = 'P';
    const R = 0.08206;
    function calcIG() {
      const p = parseFloat((document.getElementById('ig-p') as HTMLInputElement).value) || 0;
      const v = parseFloat((document.getElementById('ig-v') as HTMLInputElement).value) || 0;
      const n = parseFloat((document.getElementById('ig-n') as HTMLInputElement).value) || 0;
      const t = parseFloat((document.getElementById('ig-t') as HTMLInputElement).value) || 0;
      let result = 0, label = '';
      if (igMode === 'P') {
        result = v > 0 ? (n * R * t) / v : 0;
        label = result.toFixed(4) + ' atm';
        document.getElementById('ig-label')!.textContent = 'Pressure';
      } else if (igMode === 'V') {
        result = p > 0 ? (n * R * t) / p : 0;
        label = result.toFixed(4) + ' L';
        document.getElementById('ig-label')!.textContent = 'Volume';
      } else if (igMode === 'n') {
        result = (R * t) > 0 ? (p * v) / (R * t) : 0;
        label = result.toFixed(4) + ' mol';
        document.getElementById('ig-label')!.textContent = 'Moles';
      } else {
        result = (n * R) > 0 ? (p * v) / (n * R) : 0;
        label = result.toFixed(2) + ' K';
        document.getElementById('ig-label')!.textContent = 'Temperature';
      }
      document.getElementById('ig-result')!.textContent = label;
      const pAtm = igMode === 'P' ? result : p;
      const tK = igMode === 'T' ? result : t;
      document.getElementById('ig-kpa')!.textContent = (pAtm * 101.325).toFixed(2);
      document.getElementById('ig-celsius')!.textContent = (tK - 273.15).toFixed(2) + '°C';
      document.getElementById('ig-formula')!.textContent = `PV = nRT → ${igMode} = ${label}`;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ig-mode').forEach(b => b.addEventListener('click', () => {
        igMode = (b as HTMLButtonElement).dataset.mode!;
        document.querySelectorAll('.ig-mode').forEach(btn => {
          const active = (btn as HTMLButtonElement).dataset.mode === igMode;
          (btn as HTMLButtonElement).className = `ig-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 ${active ? 'border-primary bg-blue-50 text-primary' : 'border-border text-text-muted'}`;
        });
        calcIG();
      }));
      document.querySelectorAll('.ig-in').forEach(el => { el.addEventListener('input', calcIG); el.addEventListener('change', calcIG); });
      calcIG();
    }, 50);
  </script>
</CalculatorLayout>
