---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Sound System Calculator - Speaker Wattage for Events";
const description = "Calculate the PA system and speaker wattage needed for your venue size and event type. Get recommendations for indoor and outdoor sound setups.";
const relatedCalcs = [
  { name: "DJ Playlist Calculator", url: "/dj-playlist-calculator", description: "Playlist planning for events." },
  { name: "Event Budget Calculator", url: "/event-budget-calculator", description: "Total event cost breakdown." },
  { name: "Tent Size Calculator", url: "/tent-size-calculator", description: "Tent dimensions needed." },
  { name: "Banquet Room Calculator", url: "/banquet-room-calculator", description: "Room size for events." },
  { name: "Event Lighting Calculator", url: "/event-lighting-calculator", description: "Venue lighting plan." },
  { name: "Conference Calculator", url: "/conference-calculator", description: "Conference AV needs." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Sound System Calculator"
  keywords="sound system calculator, speaker wattage, PA system, event audio, venue speakers, event sound"
  breadcrumbs={[{ name: "Sound System", url: "/sound-system-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Sound System Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find the right speaker wattage and PA system for your venue and event.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4 mb-6">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Venue Area (sq ft)</label>
          <input type="number" id="ssy-area" class="ssy-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2000" min="100" step="100">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Number of Guests</label>
          <input type="number" id="ssy-guests" class="ssy-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="150" min="10" step="10">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Event Type</label>
          <select id="ssy-type" class="ssy-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="speech">Speech / Presentation</option>
            <option value="ceremony">Ceremony (quiet music + speech)</option>
            <option value="reception" selected>Reception / Dinner with Music</option>
            <option value="dance">Dance Party / Club</option>
            <option value="concert">Live Band / Concert</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Venue Type</label>
          <select id="ssy-venue" class="ssy-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="indoor">Indoor (enclosed room)</option>
            <option value="outdoor">Outdoor (open air)</option>
            <option value="tent">Tent / Marquee</option>
            <option value="gymnasium">Gymnasium / Large Hall</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Ceiling Height (ft)</label>
          <input type="number" id="ssy-ceiling" class="ssy-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="8" max="40" step="1">
        </div>
      </div>

      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Wattage (RMS)</div>
        <div class="text-5xl font-extrabold" id="ssy-watts">--</div>
        <div class="text-sm mt-1" id="ssy-desc">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Target dB Level</div>
          <div class="text-xl font-bold" id="ssy-db">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Speakers Needed</div>
          <div class="text-xl font-bold" id="ssy-speakers">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Subwoofers</div>
          <div class="text-xl font-bold" id="ssy-subs">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Microphones</div>
          <div class="text-xl font-bold" id="ssy-mics">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-4" id="ssy-details"></div>

      <ShareButton calculatorId="sound-system" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Sound System Guide for Events</h2>
      <p>For speeches, 70-80 dB is sufficient. Background dinner music: 75-85 dB. Dance music: 90-100 dB. Outdoor events need 2-3x the power of indoor events due to sound dispersion.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcSSY() {
      const area = parseInt((document.getElementById('ssy-area') as HTMLInputElement).value) || 2000;
      const guests = parseInt((document.getElementById('ssy-guests') as HTMLInputElement).value) || 100;
      const eventType = (document.getElementById('ssy-type') as HTMLSelectElement).value;
      const venue = (document.getElementById('ssy-venue') as HTMLSelectElement).value;
      const ceiling = parseInt((document.getElementById('ssy-ceiling') as HTMLInputElement).value) || 12;

      let targetDB = 85;
      if (eventType === 'speech') targetDB = 78;
      else if (eventType === 'ceremony') targetDB = 80;
      else if (eventType === 'reception') targetDB = 88;
      else if (eventType === 'dance') targetDB = 96;
      else if (eventType === 'concert') targetDB = 102;

      const volume = area * ceiling;
      let basePower = volume * 0.5;

      if (eventType === 'speech') basePower = volume * 0.2;
      else if (eventType === 'ceremony') basePower = volume * 0.25;
      else if (eventType === 'dance') basePower = volume * 0.8;
      else if (eventType === 'concert') basePower = volume * 1.2;

      let venueMult = 1;
      if (venue === 'outdoor') venueMult = 2.5;
      else if (venue === 'tent') venueMult = 1.5;
      else if (venue === 'gymnasium') venueMult = 1.3;

      const watts = Math.ceil(basePower * venueMult / 100) * 100;
      const speakers = Math.max(2, Math.ceil(watts / 500));
      const subs = eventType === 'dance' || eventType === 'concert' ? Math.max(1, Math.ceil(watts / 1000)) : 0;
      const mics = eventType === 'speech' || eventType === 'ceremony' ? 2 : (eventType === 'concert' ? 4 : 1);

      const desc = eventType === 'speech' ? 'Speech-level PA' : (eventType === 'dance' ? 'Dance floor level' : 'Background/ambient music level');

      document.getElementById('ssy-watts')!.textContent = watts.toLocaleString() + 'W';
      document.getElementById('ssy-desc')!.textContent = desc;
      document.getElementById('ssy-db')!.textContent = targetDB + ' dB';
      document.getElementById('ssy-speakers')!.textContent = speakers + ' tops';
      document.getElementById('ssy-subs')!.textContent = subs > 0 ? subs.toString() : 'Not needed';
      document.getElementById('ssy-mics')!.textContent = mics.toString();

      let details = '<h3 class="font-semibold text-sm text-text mb-2">Equipment Recommendations</h3><ul class="text-sm text-text-secondary space-y-1">';
      details += '<li>Main speakers: ' + speakers + ' x ' + Math.ceil(watts / speakers) + 'W powered tops</li>';
      if (subs > 0) details += '<li>Subwoofers: ' + subs + ' x 18" powered subs</li>';
      details += '<li>Wireless microphones: ' + mics + '</li>';
      details += '<li>Mixer: ' + (eventType === 'concert' ? '16+' : '8') + ' channel</li>';
      details += '<li>Room volume: ' + volume.toLocaleString() + ' cubic ft</li>';
      if (venue === 'outdoor') details += '<li>Note: Outdoor setup needs significantly more power due to sound dispersion</li>';
      details += '<li>Monitor speakers: ' + (eventType === 'concert' ? '2-4' : '0-1') + '</li>';
      details += '</ul>';
      document.getElementById('ssy-details')!.innerHTML = details;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ssy-in').forEach(el => { el.addEventListener('input', calcSSY); el.addEventListener('change', calcSSY); });
      calcSSY();
    }, 50);
  </script>
</CalculatorLayout>
