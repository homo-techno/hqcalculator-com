---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Dehumidifier Calculator - Sizing in Pints/Day by Room Size";
const description = "Calculate dehumidifier capacity needed in pints per day based on room size, current humidity level, moisture sources, and climate conditions.";

const relatedCalcs = [
  { name: "Psychrometric Calculator", url: "/psychrometric-calculator", description: "Air properties." },
  { name: "Air Changes Calculator", url: "/air-changes-calculator", description: "ACH rates." },
  { name: "Cooling Load Calculator", url: "/cooling-load-calculator", description: "Cooling load." },
  { name: "Ventilation Rate Calculator", url: "/ventilation-rate-calculator", description: "ASHRAE rates." },
  { name: "Cooling Tower Calculator", url: "/cooling-tower-calculator", description: "Tower sizing." },
  { name: "Heat Loss Calculator", url: "/heat-loss-calculator", description: "Heat loss." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Dehumidifier Calculator"
  keywords="dehumidifier calculator, dehumidifier sizing, pints per day, humidity control, moisture removal, basement dehumidifier"
  breadcrumbs={[{ name: "Dehumidifier Calculator", url: "/dehumidifier-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Dehumidifier Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate the right dehumidifier size for your space based on room conditions and moisture levels.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-5">
        <h3 class="text-lg font-bold text-text">Room Size</h3>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Length (ft)</label>
            <input type="number" id="dh2-length" class="dh2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="30" min="5" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Width (ft)</label>
            <input type="number" id="dh2-width" class="dh2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="5" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Height (ft)</label>
            <input type="number" id="dh2-height" class="dh2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="6" step="0.5">
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Current Humidity (%RH)</label>
            <input type="number" id="dh2-current" class="dh2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="70" min="30" max="100" step="5">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Target Humidity (%RH)</label>
            <input type="number" id="dh2-target" class="dh2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="50" min="30" max="60" step="5">
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Room Temperature (°F)</label>
            <input type="number" id="dh2-temp" class="dh2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="75" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Moisture Condition</label>
            <select id="dh2-condition" class="dh2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="moderate">Moderately Damp</option>
              <option value="damp" selected>Damp (musty smell)</option>
              <option value="wet">Wet (visible moisture)</option>
              <option value="extreme">Extremely Wet (flooding)</option>
            </select>
          </div>
        </div>

        <!-- Results -->
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Capacity</div>
          <div class="text-4xl font-extrabold" id="dh2-pints">--</div>
          <div class="text-sm text-blue-200 mt-1">pints per day</div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Room Area</div>
            <div class="text-xl font-bold" id="dh2-area">--</div>
            <div class="text-xs text-text-muted">sq ft</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Room Volume</div>
            <div class="text-xl font-bold" id="dh2-volume">--</div>
            <div class="text-xs text-text-muted">cu ft</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Moisture to Remove</div>
            <div class="text-xl font-bold" id="dh2-moisture">--</div>
            <div class="text-xs text-text-muted">grains/lb difference</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Liters per Day</div>
            <div class="text-xl font-bold" id="dh2-liters">--</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-muted uppercase mb-1">Suggested Unit Size</div>
          <div class="text-lg font-bold" id="dh2-rec">--</div>
        </div>
      </div>

      <ShareButton calculatorId="dehumidifier" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl mx-auto prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Dehumidifier Sizing Guide</h2>
      <p>Dehumidifier capacity is rated in pints of water removed per day. Sizing depends on room size, dampness level, and desired humidity.</p>
      <ul>
        <li><strong>Moderate:</strong> Space feels damp and musty only in humid weather</li>
        <li><strong>Damp:</strong> Always feels damp, musty odor present</li>
        <li><strong>Wet:</strong> Walls sweat, seepage visible</li>
        <li><strong>Extremely Wet:</strong> Standing water or flooding</li>
        <li>Target 30-50% RH for comfort; below 60% to prevent mold</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcDH2() {
      const length = parseFloat((document.getElementById('dh2-length') as HTMLInputElement).value) || 0;
      const width = parseFloat((document.getElementById('dh2-width') as HTMLInputElement).value) || 0;
      const height = parseFloat((document.getElementById('dh2-height') as HTMLInputElement).value) || 0;
      const currentRH = parseFloat((document.getElementById('dh2-current') as HTMLInputElement).value) || 70;
      const targetRH = parseFloat((document.getElementById('dh2-target') as HTMLInputElement).value) || 50;
      const temp = parseFloat((document.getElementById('dh2-temp') as HTMLInputElement).value) || 75;
      const condition = (document.getElementById('dh2-condition') as HTMLSelectElement).value;

      const area = length * width;
      const volume = area * height;

      // Condition multipliers for pints/day per 500 sq ft
      // Based on Energy Star / AHAM guidelines
      const condFactors: Record<string, number> = {
        moderate: 10,
        damp: 14,
        wet: 18,
        extreme: 22,
      };
      const basePints = condFactors[condition] || 14;

      // Scale by area (base is per 500 sq ft)
      let pints = basePints * (area / 500);

      // Adjust for humidity difference (more removal needed for bigger gap)
      const humidityDiff = currentRH - targetRH;
      const humidityFactor = humidityDiff > 20 ? 1.0 + (humidityDiff - 20) * 0.02 : 1.0;
      pints *= humidityFactor;

      // Adjust for temperature (dehumidifiers less effective in cold)
      if (temp < 65) pints *= 1.2;
      else if (temp > 85) pints *= 0.9;

      // Adjust for ceiling height (standard is 8ft)
      pints *= height / 8;

      // Approximate moisture difference in grains/lb
      // Simplified: at 75°F, each 10% RH change ~15 grains/lb
      const moistureDiff = (humidityDiff / 10) * 15;

      const liters = pints * 0.473176;

      // Recommendation (standard commercial sizes)
      let rec = '';
      if (pints <= 22) rec = '22-pint unit (small room portable)';
      else if (pints <= 35) rec = '30-35 pint unit (standard portable)';
      else if (pints <= 50) rec = '50-pint unit (large portable)';
      else if (pints <= 70) rec = '70-pint unit (whole basement)';
      else rec = Math.ceil(pints / 70) + ' x 70-pint units or commercial unit';

      document.getElementById('dh2-pints')!.textContent = Math.round(pints).toString();
      document.getElementById('dh2-area')!.textContent = area.toLocaleString();
      document.getElementById('dh2-volume')!.textContent = volume.toLocaleString();
      document.getElementById('dh2-moisture')!.textContent = moistureDiff.toFixed(0);
      document.getElementById('dh2-liters')!.textContent = liters.toFixed(1);
      document.getElementById('dh2-rec')!.textContent = rec;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.dh2-in').forEach(el => {
        el.addEventListener('input', calcDH2);
        el.addEventListener('change', calcDH2);
      });
      calcDH2();
    }, 50);
  </script>
</CalculatorLayout>
