---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Facial Proportion Calculator - Golden Ratio & Symmetry Analysis";
const description = "Analyze facial proportions using the golden ratio (phi = 1.618). Measure facial thirds, eye spacing, and symmetry for aesthetic analysis.";
const relatedCalcs = [
  { name: "Botox Unit Calculator", url: "/botox-unit-calculator", description: "Botox units by treatment area." },
  { name: "Dermal Filler Calculator", url: "/dermal-filler-calculator", description: "Filler volume by area." },
  { name: "Permanent Makeup Calculator", url: "/permanent-makeup-calculator", description: "PMU cost and timeline." },
  { name: "Chemical Peel Calculator", url: "/chemical-peel-calculator", description: "Peel depth and recovery." },
  { name: "Skin Type Calculator", url: "/skin-type-calculator", description: "Determine your skin type." },
  { name: "Eyelash Extension Calculator", url: "/eyelash-extension-calculator", description: "Lash extension selection." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Facial Proportion Calculator" keywords="facial proportions, golden ratio, phi, facial symmetry, facial thirds, beauty ratio, face analysis" breadcrumbs={[{ name: "Facial Proportion", url: "/facial-proportion-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Facial Proportion Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Analyze your facial proportions against the golden ratio and ideal facial thirds.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <p class="text-xs text-text-muted">Enter measurements in centimeters. Use a ruler or measuring tape against a front-facing photo for best accuracy.</p>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Face Length (hairline to chin)</label><input type="number" id="fpc-length" class="fpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="18" min="5" max="35" step="0.1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Face Width (widest point)</label><input type="number" id="fpc-width" class="fpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="13" min="5" max="25" step="0.1"></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Upper Third (hairline to brows)</label><input type="number" id="fpc-upper" class="fpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="1" max="15" step="0.1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Middle Third (brows to nose base)</label><input type="number" id="fpc-middle" class="fpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="1" max="15" step="0.1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Lower Third (nose base to chin)</label><input type="number" id="fpc-lower" class="fpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="1" max="15" step="0.1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Eye Width (one eye)</label><input type="number" id="fpc-eye" class="fpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2.8" min="0.5" max="6" step="0.1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Inter-Eye Distance</label><input type="number" id="fpc-intereye" class="fpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3" min="0.5" max="6" step="0.1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Nose Width</label><input type="number" id="fpc-nose" class="fpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3.2" min="0.5" max="8" step="0.1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Mouth Width</label><input type="number" id="fpc-mouth" class="fpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="1" max="10" step="0.1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Golden Ratio Score</div>
          <div class="text-5xl font-extrabold font-mono" id="fpc-score">0%</div>
          <div class="text-sm text-blue-200 mt-1">closeness to phi (1.618)</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Face Ratio (L/W)</div><div class="text-xl font-bold" id="fpc-faceratio">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Ideal Face Ratio</div><div class="text-xl font-bold">1.618</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Thirds Balance</div><div class="text-xl font-bold" id="fpc-thirds">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Eye Spacing</div><div class="text-xl font-bold" id="fpc-eyespace">--</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Proportion Analysis</h3>
          <div class="text-sm space-y-1" id="fpc-analysis"></div>
        </div>
      </div>
      <ShareButton calculatorId="facial-proportion" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">The Golden Ratio in Facial Aesthetics</h2>
      <p>The golden ratio (phi = 1.618) has long been associated with facial beauty. Ideally, the face length to width ratio approximates 1.618. The face should divide into three equal vertical thirds (hairline to brows, brows to nose base, nose base to chin). The inter-eye distance should equal one eye width, and the nose width should roughly match the inter-eye distance. These are guidelines, not absolutes - beauty is diverse and subjective.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcFPC() {
      const PHI = 1.618;
      const length = parseFloat((document.getElementById('fpc-length') as HTMLInputElement).value) || 1;
      const width = parseFloat((document.getElementById('fpc-width') as HTMLInputElement).value) || 1;
      const upper = parseFloat((document.getElementById('fpc-upper') as HTMLInputElement).value) || 1;
      const middle = parseFloat((document.getElementById('fpc-middle') as HTMLInputElement).value) || 1;
      const lower = parseFloat((document.getElementById('fpc-lower') as HTMLInputElement).value) || 1;
      const eyeW = parseFloat((document.getElementById('fpc-eye') as HTMLInputElement).value) || 1;
      const interEye = parseFloat((document.getElementById('fpc-intereye') as HTMLInputElement).value) || 1;
      const noseW = parseFloat((document.getElementById('fpc-nose') as HTMLInputElement).value) || 1;
      const mouthW = parseFloat((document.getElementById('fpc-mouth') as HTMLInputElement).value) || 1;

      const faceRatio = length / width;
      const faceRatioDev = Math.abs(faceRatio - PHI) / PHI;

      const avgThird = (upper + middle + lower) / 3;
      const thirdsDev = (Math.abs(upper - avgThird) + Math.abs(middle - avgThird) + Math.abs(lower - avgThird)) / (3 * avgThird);

      const eyeSpacingDev = Math.abs(interEye - eyeW) / eyeW;

      const noseEyeDev = Math.abs(noseW - interEye) / interEye;

      const mouthEyeRatio = mouthW / (eyeW * 2);
      const mouthDev = Math.abs(mouthEyeRatio - 1.0);

      const avgDev = (faceRatioDev + thirdsDev + eyeSpacingDev * 0.5 + noseEyeDev * 0.3 + mouthDev * 0.3) / 2.1;
      const score = Math.max(0, Math.min(100, (1 - avgDev) * 100));

      let thirdsLabel = 'Balanced';
      if (thirdsDev > 0.15) thirdsLabel = 'Unbalanced';
      else if (thirdsDev > 0.08) thirdsLabel = 'Slightly Off';

      let eyeSpaceLabel = 'Ideal';
      if (eyeSpacingDev > 0.2) eyeSpaceLabel = interEye > eyeW ? 'Wide Set' : 'Close Set';
      else if (eyeSpacingDev > 0.1) eyeSpaceLabel = interEye > eyeW ? 'Slightly Wide' : 'Slightly Close';

      const analysis: string[] = [];
      analysis.push('Face length:width ratio = ' + faceRatio.toFixed(3) + ' (ideal: 1.618)');
      if (faceRatio > PHI) analysis.push('Face is slightly longer than golden ratio ideal.');
      else if (faceRatio < PHI) analysis.push('Face is slightly wider than golden ratio ideal.');
      else analysis.push('Face ratio matches the golden ratio closely.');

      analysis.push('Upper third: ' + upper.toFixed(1) + ' cm | Middle: ' + middle.toFixed(1) + ' cm | Lower: ' + lower.toFixed(1) + ' cm');
      if (upper > middle && upper > lower) analysis.push('Upper third is longest - high forehead.');
      else if (lower > upper && lower > middle) analysis.push('Lower third is longest - prominent chin area.');

      analysis.push('Nose width (' + noseW.toFixed(1) + ') vs inter-eye distance (' + interEye.toFixed(1) + '): ' + (Math.abs(noseW - interEye) < 0.5 ? 'well matched' : 'some difference'));
      analysis.push('Mouth width (' + mouthW.toFixed(1) + ') is ' + (mouthW > eyeW * 2 ? 'wider' : 'narrower') + ' than two eye widths (' + (eyeW * 2).toFixed(1) + ')');

      document.getElementById('fpc-score')!.textContent = score.toFixed(1) + '%';
      document.getElementById('fpc-faceratio')!.textContent = faceRatio.toFixed(3);
      document.getElementById('fpc-thirds')!.textContent = thirdsLabel;
      document.getElementById('fpc-eyespace')!.textContent = eyeSpaceLabel;
      document.getElementById('fpc-analysis')!.innerHTML = analysis.map(a => '<p>' + a + '</p>').join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.fpc-in').forEach(el => { el.addEventListener('input', calcFPC); el.addEventListener('change', calcFPC); });
      calcFPC();
    }, 50);
  </script>
</CalculatorLayout>
