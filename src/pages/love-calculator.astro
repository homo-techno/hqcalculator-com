---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Love Calculator - Name Compatibility Test | Free Online";
const description = "Fun love calculator! Enter two names and see your compatibility percentage. Based on numerology and name analysis. Share results with friends!";

const relatedCalcs = [
  { name: "Age Calculator", url: "/age-calculator", description: "Find your exact age." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Calculate percentages." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body Mass Index calculator." },
  { name: "Date Calculator", url: "/date-calculator", description: "Days between dates." },
  { name: "Pregnancy Calculator", url: "/pregnancy-calculator", description: "Due date calculator." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calorie needs." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Love Calculator"
  keywords="love calculator, compatibility test, name compatibility, love test, relationship calculator, love percentage"
  breadcrumbs={[{ name: "Love Calculator", url: "/love-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Love Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Enter two names and discover your love compatibility! A fun tool based on name numerology.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Name Inputs -->
      <div class="space-y-4 mb-6">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Your Name</label>
          <input type="text" id="love-name1" class="w-full px-4 py-3 border border-border rounded-xl text-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all" placeholder="Enter your name" maxlength="50">
        </div>
        <div class="text-center">
          <span class="text-3xl">+</span>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Partner's Name</label>
          <input type="text" id="love-name2" class="w-full px-4 py-3 border border-border rounded-xl text-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all" placeholder="Enter partner's name" maxlength="50">
        </div>
      </div>

      <button id="love-calc-btn" class="w-full py-3 bg-gradient-to-r from-pink-500 to-red-500 text-white rounded-xl text-lg font-bold hover:from-pink-600 hover:to-red-600 transition-all shadow-md">
        Calculate Love
      </button>

      <!-- Result Section -->
      <div id="love-result" class="mt-8 hidden">
        <div class="text-center mb-6">
          <div class="text-6xl mb-4" id="love-emoji"></div>
          <div class="text-5xl sm:text-6xl font-extrabold mb-2" id="love-score" style="background: linear-gradient(135deg, #ec4899, #ef4444); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></div>
          <div class="text-lg font-semibold text-text" id="love-label"></div>
          <div class="text-sm text-text-secondary mt-1" id="love-names-display"></div>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-surface-alt rounded-full h-4 mb-6 overflow-hidden">
          <div class="h-full rounded-full transition-all duration-1000 ease-out" id="love-bar" style="width: 0%; background: linear-gradient(90deg, #ec4899, #ef4444);"></div>
        </div>

        <!-- Fun Details -->
        <div class="grid grid-cols-2 gap-3 mb-6">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Chemistry</div>
            <div class="text-xl font-bold" id="love-chemistry">0%</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Trust</div>
            <div class="text-xl font-bold" id="love-trust">0%</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Communication</div>
            <div class="text-xl font-bold" id="love-communication">0%</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Passion</div>
            <div class="text-xl font-bold" id="love-passion">0%</div>
          </div>
        </div>

        <!-- Message -->
        <div class="bg-surface-alt rounded-xl p-5 text-center">
          <p class="text-text-secondary" id="love-message"></p>
        </div>
      </div>

      <div class="mt-6">
        <ShareButton calculatorId="love" />
        <FeedbackWidget />
      </div>
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">About the Love Calculator</h2>
      <p>Our love calculator uses name numerology to calculate a fun compatibility score between two people. While this is meant for entertainment purposes only, numerology has been used for centuries to explore personality traits and compatibility.</p>

      <h3 class="text-xl font-semibold text-text mt-8">How It Works</h3>
      <p>The calculator analyzes the letters in both names using a numerology-based algorithm. Each letter is assigned a numerical value, and the combined values are processed to generate a compatibility percentage. The algorithm considers:</p>
      <ul>
        <li><strong>Letter values:</strong> Each letter has a specific numerical weight</li>
        <li><strong>Name harmony:</strong> How well the letter patterns complement each other</li>
        <li><strong>Vowel/consonant balance:</strong> The mix of vowels and consonants in both names</li>
        <li><strong>Name length:</strong> How the lengths of the names relate to each other</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Is This Accurate?</h3>
      <p>This love calculator is designed for <strong>entertainment purposes only</strong>. Real relationships are built on communication, trust, shared values, and mutual respect â€” not name calculations! Use this as a fun conversation starter or party game.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Tips for a Great Relationship</h3>
      <ul>
        <li><strong>Communication is key:</strong> Talk openly and honestly with your partner</li>
        <li><strong>Show appreciation:</strong> Express gratitude for the little things</li>
        <li><strong>Quality time:</strong> Spend meaningful time together regularly</li>
        <li><strong>Respect boundaries:</strong> Everyone needs personal space and independence</li>
        <li><strong>Grow together:</strong> Support each other's goals and personal development</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>Can a love calculator predict my relationship?</strong> No. Love calculators are purely for fun. Real compatibility depends on personality, values, communication, and effort from both partners.</p>
      <p><strong>Why do different names give different scores?</strong> Each name generates a unique numerical signature based on its letters. Different letter combinations produce different compatibility values.</p>
      <p><strong>Should I use full names or nicknames?</strong> Try both! Many people test with first names, full names, and even nicknames to see different results. It's all part of the fun.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function hashNames(name1: string, name2: string): number {
      const combined = (name1 + 'loves' + name2).toLowerCase().replace(/[^a-z]/g, '');
      let hash = 0;
      for (let i = 0; i < combined.length; i++) {
        const char = combined.charCodeAt(i) - 96;
        hash = ((hash << 5) - hash + char * (i + 1)) | 0;
      }
      return Math.abs(hash);
    }

    function seededRandom(seed: number): () => number {
      return () => {
        seed = (seed * 16807 + 12345) & 0x7fffffff;
        return (seed % 100) + 1;
      };
    }

    function getCompatibility(name1: string, name2: string) {
      const n1 = name1.trim().toLowerCase();
      const n2 = name2.trim().toLowerCase();

      // Deterministic hash-based scoring
      const hash1 = hashNames(n1, n2);
      const hash2 = hashNames(n2, n1);
      const mainHash = hash1 + hash2;

      const rng = seededRandom(mainHash);
      const score = Math.min(99, Math.max(15, rng()));
      const chemistry = Math.min(99, Math.max(10, rng()));
      const trust = Math.min(99, Math.max(10, rng()));
      const communication = Math.min(99, Math.max(10, rng()));
      const passion = Math.min(99, Math.max(10, rng()));

      return { score, chemistry, trust, communication, passion };
    }

    function getLoveMessage(score: number): { emoji: string; label: string; message: string } {
      if (score >= 90) return {
        emoji: 'ðŸ’–âœ¨',
        label: 'Soulmates!',
        message: 'Incredible compatibility! You two are a perfect match. The stars are aligned for an amazing relationship!'
      };
      if (score >= 75) return {
        emoji: 'â¤ï¸',
        label: 'Great Match!',
        message: 'You have strong compatibility! There\'s great potential for a wonderful relationship full of love and joy.'
      };
      if (score >= 60) return {
        emoji: 'ðŸ’•',
        label: 'Good Compatibility',
        message: 'You two have good chemistry! With effort and understanding, this could be a beautiful connection.'
      };
      if (score >= 45) return {
        emoji: 'ðŸ’›',
        label: 'Moderate Match',
        message: 'There\'s a spark between you! While you may have differences, opposites can attract. Give it a chance!'
      };
      if (score >= 30) return {
        emoji: 'ðŸ¤”',
        label: 'Interesting Pairing',
        message: 'You\'re quite different, which can be exciting! Great relationships sometimes come from unexpected connections.'
      };
      return {
        emoji: 'ðŸ’«',
        label: 'Opposites Attract?',
        message: 'You may be very different, but remember â€” the best love stories often start with unlikely matches. Never say never!'
      };
    }

    function calculateLove() {
      const name1 = (document.getElementById('love-name1') as HTMLInputElement).value.trim();
      const name2 = (document.getElementById('love-name2') as HTMLInputElement).value.trim();

      if (!name1 || !name2) return;

      const result = getCompatibility(name1, name2);
      const msg = getLoveMessage(result.score);

      const resultDiv = document.getElementById('love-result')!;
      resultDiv.classList.remove('hidden');

      document.getElementById('love-emoji')!.textContent = msg.emoji;
      document.getElementById('love-score')!.textContent = result.score + '%';
      document.getElementById('love-label')!.textContent = msg.label;
      document.getElementById('love-names-display')!.textContent = `${name1} & ${name2}`;
      document.getElementById('love-message')!.textContent = msg.message;

      document.getElementById('love-chemistry')!.textContent = result.chemistry + '%';
      document.getElementById('love-trust')!.textContent = result.trust + '%';
      document.getElementById('love-communication')!.textContent = result.communication + '%';
      document.getElementById('love-passion')!.textContent = result.passion + '%';

      // Animate bar
      const bar = document.getElementById('love-bar')!;
      bar.style.width = '0%';
      setTimeout(() => { bar.style.width = result.score + '%'; }, 100);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.getElementById('love-calc-btn')!.addEventListener('click', calculateLove);

      // Also calculate on Enter
      ['love-name1', 'love-name2'].forEach(id => {
        document.getElementById(id)!.addEventListener('keydown', (e: KeyboardEvent) => {
          if (e.key === 'Enter') calculateLove();
        });
      });
    }, 50);
  </script>
</CalculatorLayout>
