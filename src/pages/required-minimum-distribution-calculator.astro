---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Required Minimum Distribution Calculator";
const description = "Calculate your Required Minimum Distribution (RMD) based on account balance, age, and IRS life expectancy tables.";
const relatedCalcs = [
  { name: "401k", url: "/401k-calculator", description: "Retirement savings." },
  { name: "Estate Tax", url: "/estate-tax-calculator", description: "Estate tax estimates." },
  { name: "Asset Allocation", url: "/asset-allocation-calculator", description: "Portfolio allocation." },
  { name: "Tax-Equivalent Yield", url: "/tax-equivalent-yield-calculator", description: "Tax-free yields." },
  { name: "Annuity", url: "/annuity-calculator", description: "Annuity payments." },
  { name: "Amortization", url: "/amortization-calculator", description: "Loan amortization." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Required Minimum Distribution Calculator" keywords="RMD calculator, required minimum distribution, IRS RMD, retirement withdrawal, life expectancy table" breadcrumbs={[{ name: "RMD", url: "/required-minimum-distribution-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Required Minimum Distribution Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Determine your annual RMD amount based on IRS Uniform Lifetime Table.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div><label class="block text-xs font-medium text-text mb-1">Account Balance ($)</label><input type="number" id="rm-balance" class="rm-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="500000" min="0" step="1000"></div>
        <div><label class="block text-xs font-medium text-text mb-1">Your Age</label><input type="number" id="rm-age" class="rm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="73" min="72" max="120" step="1"></div>
        <div><label class="block text-xs font-medium text-text mb-1">Account Type</label>
          <select id="rm-type" class="rm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="traditional" selected>Traditional IRA</option>
            <option value="401k">401(k)</option>
            <option value="403b">403(b)</option>
          </select>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Annual RMD Amount</div>
          <div class="text-5xl font-extrabold font-mono" id="rm-result">$0</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Monthly Equivalent</div><div class="text-xl font-bold font-mono" id="rm-monthly">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Life Expectancy Divisor</div><div class="text-xl font-bold font-mono" id="rm-divisor">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">% of Balance</div><div class="text-xl font-bold font-mono" id="rm-pct">0%</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Remaining After RMD</div><div class="text-xl font-bold font-mono" id="rm-remaining">$0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="required-minimum-distribution" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcRM() {
      const balance = parseFloat((document.getElementById('rm-balance') as HTMLInputElement).value) || 0;
      const age = parseFloat((document.getElementById('rm-age') as HTMLInputElement).value) || 73;

      // IRS Uniform Lifetime Table (2024) divisors
      const divisors: Record<number, number> = {
        72: 27.4, 73: 26.5, 74: 25.5, 75: 24.6, 76: 23.7, 77: 22.9, 78: 22.0, 79: 21.1,
        80: 20.2, 81: 19.4, 82: 18.5, 83: 17.7, 84: 16.8, 85: 16.0, 86: 15.2, 87: 14.4,
        88: 13.7, 89: 12.9, 90: 12.2, 91: 11.5, 92: 10.8, 93: 10.1, 94: 9.5, 95: 8.9,
        96: 8.4, 97: 7.8, 98: 7.3, 99: 6.8, 100: 6.4, 101: 6.0, 102: 5.6, 103: 5.2,
        104: 4.9, 105: 4.6, 106: 4.3, 107: 4.1, 108: 3.9, 109: 3.7, 110: 3.5,
        111: 3.4, 112: 3.3, 113: 3.1, 114: 3.0, 115: 2.9, 116: 2.8, 117: 2.7,
        118: 2.5, 119: 2.3, 120: 2.0
      };

      const divisor = divisors[Math.min(Math.max(Math.round(age), 72), 120)] || 27.4;
      const rmd = balance / divisor;
      const monthly = rmd / 12;
      const pct = balance > 0 ? (rmd / balance) * 100 : 0;
      const remaining = balance - rmd;

      const fmt = (v: number) => '$' + v.toLocaleString(undefined, { maximumFractionDigits: 0 });
      document.getElementById('rm-result')!.textContent = fmt(rmd);
      document.getElementById('rm-monthly')!.textContent = fmt(monthly);
      document.getElementById('rm-divisor')!.textContent = divisor.toFixed(1);
      document.getElementById('rm-pct')!.textContent = pct.toFixed(2) + '%';
      document.getElementById('rm-remaining')!.textContent = fmt(remaining);
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.rm-in').forEach(el => { el.addEventListener('input', calcRM); el.addEventListener('change', calcRM); });
      calcRM();
    }, 50);
  </script>
</CalculatorLayout>
