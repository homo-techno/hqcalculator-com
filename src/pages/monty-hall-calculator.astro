---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Monty Hall Calculator - Switch vs Stay Probability";
const description = "Explore the Monty Hall problem with probability analysis. Compare switch vs stay strategies, simulate results, and understand the Bayesian explanation with multiple doors.";
const relatedCalcs = [
  { name: "Probability Calculator", url: "/probability-calculator", description: "General probability." },
  { name: "Bayes Theorem", url: "/bayes-theorem-calculator", description: "Bayesian analysis." },
  { name: "Coin Flip", url: "/coin-flip", description: "Coin simulation." },
  { name: "Dice Roller", url: "/dice-roller", description: "Dice simulation." },
  { name: "Statistics Calculator", url: "/statistics-calculator", description: "Statistical tools." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage math." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Monty Hall Calculator" keywords="monty hall problem, switch vs stay, game show probability, bayesian probability, door problem" breadcrumbs={[{ name: "Monty Hall", url: "/monty-hall-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Monty Hall Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Analyze the famous Monty Hall problem: should you switch doors after the host reveals a goat?</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Total Number of Doors</label>
          <input type="number" class="mh-in w-full px-4 py-3 border border-border rounded-xl text-xl font-bold text-center" id="mh-doors" min="3" max="100" value="3">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Doors Revealed by Host (goats)</label>
          <input type="number" class="mh-in w-full px-4 py-3 border border-border rounded-xl text-xl font-bold text-center" id="mh-revealed" min="1" max="98" value="1">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Simulation Rounds</label>
          <input type="number" class="mh-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" id="mh-sims" min="100" max="100000" value="10000">
        </div>
        <button id="mh-run" class="w-full py-3 bg-primary text-white font-bold rounded-xl hover:bg-blue-700 transition">Run Simulation</button>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">P(Win if Switch)</div>
            <div class="text-4xl font-extrabold font-mono" id="mh-switch">--</div>
          </div>
          <div class="p-6 bg-surface-alt rounded-2xl text-center">
            <div class="text-sm text-text-muted uppercase tracking-wide mb-1">P(Win if Stay)</div>
            <div class="text-4xl font-extrabold font-mono" id="mh-stay">--</div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Switch Advantage</div>
            <div class="text-xl font-bold font-mono" id="mh-advantage">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Switch / Stay Ratio</div>
            <div class="text-xl font-bold font-mono" id="mh-ratio">--</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Simulation Results</h3>
          <div class="text-xs font-mono space-y-1" id="mh-simresults"></div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Bayesian Explanation</h3>
          <div class="text-sm text-text-secondary" id="mh-bayes"></div>
        </div>
      </div>
      <ShareButton calculatorId="monty-hall" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">The Monty Hall Problem</h2>
      <p>You pick a door. The host, who knows what's behind each door, opens another door revealing a goat. Should you switch? Yes -- switching wins 2/3 of the time in the classic 3-door version.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>P(Stay wins):</strong> 1/N</p>
        <p><strong>P(Switch wins):</strong> (N-1) / (N x (N-1-R)) where R = doors revealed</p>
        <p><strong>Classic (N=3, R=1):</strong> Stay = 1/3, Switch = 2/3</p>
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcMH() {
      const doors = parseInt((document.getElementById('mh-doors') as HTMLInputElement).value) || 3;
      const revealed = parseInt((document.getElementById('mh-revealed') as HTMLInputElement).value) || 1;

      if (revealed >= doors - 1) {
        document.getElementById('mh-switch')!.textContent = 'Invalid';
        document.getElementById('mh-stay')!.textContent = 'Invalid';
        document.getElementById('mh-advantage')!.textContent = '--';
        document.getElementById('mh-ratio')!.textContent = '--';
        document.getElementById('mh-bayes')!.textContent = 'Revealed doors must be less than total doors minus 1.';
        return;
      }

      const pStay = 1 / doors;
      const remaining = doors - 1 - revealed;
      const pSwitch = (doors - 1) / (doors * remaining);

      document.getElementById('mh-switch')!.textContent = (pSwitch * 100).toFixed(2) + '%';
      document.getElementById('mh-stay')!.textContent = (pStay * 100).toFixed(2) + '%';
      document.getElementById('mh-advantage')!.textContent = ((pSwitch - pStay) * 100).toFixed(2) + ' pp';
      document.getElementById('mh-ratio')!.textContent = (pSwitch / pStay).toFixed(2) + 'x';

      const bayesText = 'Prior: Your door has a 1/' + doors + ' (' + (pStay * 100).toFixed(1) + '%) chance. ' +
        'After the host reveals ' + revealed + ' goat door(s), the probability concentrates on the remaining ' +
        remaining + ' door(s). Each remaining door now has a ' + (pSwitch * 100).toFixed(2) + '% chance. ' +
        'Switching is ' + (pSwitch / pStay).toFixed(2) + 'x better than staying.';
      document.getElementById('mh-bayes')!.textContent = bayesText;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    function simMH() {
      const doors = parseInt((document.getElementById('mh-doors') as HTMLInputElement).value) || 3;
      const revealed = parseInt((document.getElementById('mh-revealed') as HTMLInputElement).value) || 1;
      const sims = parseInt((document.getElementById('mh-sims') as HTMLInputElement).value) || 10000;

      if (revealed >= doors - 1) return;

      let stayWins = 0;
      let switchWins = 0;
      const remaining = doors - 1 - revealed;

      for (let i = 0; i < sims; i++) {
        const prize = Math.floor(Math.random() * doors);
        const pick = Math.floor(Math.random() * doors);
        if (pick === prize) {
          stayWins++;
        } else {
          // When switching, probability of winning among remaining doors
          if (Math.random() < 1 / remaining) {
            switchWins++;
          }
        }
      }

      const html = '<div class="flex justify-between py-0.5 border-b border-border"><span>Simulations</span><span>' + sims.toLocaleString() + '</span></div>' +
        '<div class="flex justify-between py-0.5 border-b border-border"><span>Stay Wins</span><span>' + stayWins.toLocaleString() + ' (' + (stayWins / sims * 100).toFixed(2) + '%)</span></div>' +
        '<div class="flex justify-between py-0.5 border-b border-border"><span>Switch Wins</span><span>' + switchWins.toLocaleString() + ' (' + (switchWins / sims * 100).toFixed(2) + '%)</span></div>' +
        '<div class="flex justify-between py-0.5 font-bold"><span>Verdict</span><span>' + (switchWins > stayWins ? 'Switch is better!' : 'Stay is better (unusual)') + '</span></div>';
      document.getElementById('mh-simresults')!.innerHTML = html;
    }

    setTimeout(() => {
      document.querySelectorAll('.mh-in').forEach(el => { el.addEventListener('input', calcMH); el.addEventListener('change', calcMH); });
      document.getElementById('mh-run')!.addEventListener('click', simMH);
      calcMH();
    }, 50);
  </script>
</CalculatorLayout>
