---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Currency Converter - Exchange Rate Calculator";
const description = "Convert between major world currencies with approximate exchange rates. Quick and simple currency conversion tool.";

const relatedCalcs = [
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Tip Calculator", url: "/tip-calculator", description: "Tips." },
  { name: "Discount Calculator", url: "/discount-calculator", description: "Discounts." },
  { name: "Inflation Calculator", url: "/inflation-calculator", description: "Inflation." },
  { name: "Unit Price", url: "/unit-price-calculator", description: "Unit pricing." },
  { name: "Sales Tax", url: "/sales-tax-calculator", description: "Sales tax." },
];
---

<CalculatorLayout title={title} description={description} calculatorName="Currency Converter" keywords="currency converter, exchange rate, money converter, USD EUR GBP, forex calculator" breadcrumbs={[{ name: "Currency Converter", url: "/currency-converter" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Currency Converter</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert between major currencies using approximate exchange rates.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Amount</label>
          <input type="number" id="cc-amount" class="w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="1000" min="0" step="1">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-medium text-text mb-1">From</label>
            <select id="cc-from" class="w-full px-4 py-3 border border-border rounded-xl text-lg"></select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">To</label>
            <select id="cc-to" class="w-full px-4 py-3 border border-border rounded-xl text-lg"></select>
          </div>
        </div>
        <button id="cc-swap" class="w-full py-2 text-sm font-semibold text-primary hover:bg-blue-50 rounded-xl border border-border">Swap Currencies</button>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="cc-label">Result</div>
          <div class="text-4xl sm:text-5xl font-extrabold" id="cc-result">0</div>
          <div class="text-sm text-blue-200 mt-2" id="cc-rate">1 USD = 1.00 USD</div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Common Conversions</h3>
          <div class="space-y-1 text-sm" id="cc-table"></div>
        </div>

        <p class="text-xs text-text-muted text-center">Rates are approximate and for reference only. Check a live source for current rates.</p>
      </div>
      <ShareButton calculatorId="currency" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">About Currency Conversion</h2>
      <p>Exchange rates fluctuate constantly based on market conditions. The rates used here are approximate reference rates. For actual transactions, check with your bank or a live forex service.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    // Approximate rates vs USD
    const rates: Record<string, { name: string; symbol: string; rate: number }> = {
      USD: { name: 'US Dollar', symbol: '$', rate: 1 },
      EUR: { name: 'Euro', symbol: '€', rate: 0.92 },
      GBP: { name: 'British Pound', symbol: '£', rate: 0.79 },
      JPY: { name: 'Japanese Yen', symbol: '¥', rate: 149.5 },
      CAD: { name: 'Canadian Dollar', symbol: 'C$', rate: 1.36 },
      AUD: { name: 'Australian Dollar', symbol: 'A$', rate: 1.53 },
      CHF: { name: 'Swiss Franc', symbol: 'Fr', rate: 0.88 },
      CNY: { name: 'Chinese Yuan', symbol: '¥', rate: 7.24 },
      INR: { name: 'Indian Rupee', symbol: '₹', rate: 83.1 },
      MXN: { name: 'Mexican Peso', symbol: '$', rate: 17.15 },
      BRL: { name: 'Brazilian Real', symbol: 'R$', rate: 4.97 },
      KRW: { name: 'South Korean Won', symbol: '₩', rate: 1330 },
      SEK: { name: 'Swedish Krona', symbol: 'kr', rate: 10.45 },
      NOK: { name: 'Norwegian Krone', symbol: 'kr', rate: 10.55 },
      NZD: { name: 'New Zealand Dollar', symbol: 'NZ$', rate: 1.63 },
      SGD: { name: 'Singapore Dollar', symbol: 'S$', rate: 1.34 },
      HKD: { name: 'Hong Kong Dollar', symbol: 'HK$', rate: 7.82 },
      TRY: { name: 'Turkish Lira', symbol: '₺', rate: 30.2 },
      ZAR: { name: 'South African Rand', symbol: 'R', rate: 18.7 },
      PLN: { name: 'Polish Zloty', symbol: 'zł', rate: 4.02 },
    };

    function populateSelects() {
      const opts = Object.entries(rates).map(([code, d]) => `<option value="${code}">${code} - ${d.name}</option>`).join('');
      document.getElementById('cc-from')!.innerHTML = opts;
      document.getElementById('cc-to')!.innerHTML = opts;
      (document.getElementById('cc-from') as HTMLSelectElement).value = 'USD';
      (document.getElementById('cc-to') as HTMLSelectElement).value = 'EUR';
    }

    function convert() {
      const amount = parseFloat((document.getElementById('cc-amount') as HTMLInputElement).value) || 0;
      const from = (document.getElementById('cc-from') as HTMLSelectElement).value;
      const to = (document.getElementById('cc-to') as HTMLSelectElement).value;

      const fromRate = rates[from]?.rate || 1;
      const toRate = rates[to]?.rate || 1;
      const exchangeRate = toRate / fromRate;
      const result = amount * exchangeRate;

      const toInfo = rates[to];
      const decimals = result > 100 ? 0 : result > 1 ? 2 : 4;

      document.getElementById('cc-result')!.textContent = toInfo.symbol + ' ' + result.toFixed(decimals).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      document.getElementById('cc-label')!.textContent = `${amount.toLocaleString()} ${from} =`;
      document.getElementById('cc-rate')!.textContent = `1 ${from} = ${exchangeRate.toFixed(4)} ${to}`;

      // Common amounts table
      const amounts = [1, 10, 100, 500, 1000, 5000, 10000];
      document.getElementById('cc-table')!.innerHTML =
        amounts.map(a => {
          const r = a * exchangeRate;
          const d = r > 100 ? 0 : 2;
          return `<div class="flex justify-between"><span class="text-text-secondary">${a.toLocaleString()} ${from}</span><span class="font-semibold">${r.toFixed(d).replace(/\B(?=(\d{3})+(?!\d))/g, ',')} ${to}</span></div>`;
        }).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      populateSelects();
      document.getElementById('cc-amount')!.addEventListener('input', convert);
      document.getElementById('cc-from')!.addEventListener('change', convert);
      document.getElementById('cc-to')!.addEventListener('change', convert);
      document.getElementById('cc-swap')!.addEventListener('click', () => {
        const f = document.getElementById('cc-from') as HTMLSelectElement;
        const t = document.getElementById('cc-to') as HTMLSelectElement;
        [f.value, t.value] = [t.value, f.value];
        convert();
      });
      convert();
    }, 50);
  </script>
</CalculatorLayout>
