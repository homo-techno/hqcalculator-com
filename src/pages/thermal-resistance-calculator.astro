---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Thermal Resistance Calculator - R-Value & U-Value for Wall Assemblies";
const description = "Calculate total R-value and U-value for multi-layer wall, roof, and floor assemblies. Add layers of different materials to find overall thermal resistance.";

const relatedCalcs = [
  { name: "Heat Loss Calculator", url: "/heat-loss-calculator", description: "Building heat loss." },
  { name: "Cooling Load Calculator", url: "/cooling-load-calculator", description: "Cooling loads." },
  { name: "Heat Exchanger Calculator", url: "/heat-exchanger-calculator", description: "Heat transfer." },
  { name: "Radiant Floor Calculator", url: "/radiant-floor-calculator", description: "Radiant heating." },
  { name: "Economizer Calculator", url: "/economizer-calculator", description: "Free cooling." },
  { name: "Refrigerated Storage Calculator", url: "/refrigerated-storage-calculator", description: "Walk-in sizing." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Thermal Resistance Calculator"
  keywords="R-value calculator, U-value calculator, thermal resistance, wall assembly, insulation value, building envelope, heat transfer coefficient"
  breadcrumbs={[{ name: "Thermal Resistance Calculator", url: "/thermal-resistance-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Thermal Resistance Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate R-value and U-value for multi-layer wall assemblies.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-5">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Assembly Preset</label>
          <select id="tr2-preset" class="tr2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="custom">Custom Assembly</option>
            <option value="2x4" selected>2x4 Wall with R-13</option>
            <option value="2x6">2x6 Wall with R-19</option>
            <option value="brick">Brick Veneer Wall</option>
            <option value="roof">Attic with R-38</option>
            <option value="slab">Slab on Grade</option>
          </select>
        </div>

        <h3 class="text-lg font-bold text-text">Assembly Layers</h3>
        <div class="p-4 bg-surface-alt rounded-xl text-xs text-text-muted mb-2">Add R-values for each layer. Include air films for accurate results.</div>

        <div class="space-y-2" id="tr2-layers">
          <div class="grid grid-cols-3 gap-2 items-end">
            <div class="col-span-2">
              <label class="block text-xs font-medium text-text mb-1">Layer 1</label>
              <input type="text" id="tr2-name1" class="w-full px-3 py-2 border border-border rounded-lg text-sm" value="Outside Air Film">
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">R-Value</label>
              <input type="number" id="tr2-r1" class="tr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="0.17" min="0" step="0.01">
            </div>
          </div>
          <div class="grid grid-cols-3 gap-2 items-end">
            <div class="col-span-2">
              <label class="block text-xs font-medium text-text mb-1">Layer 2</label>
              <input type="text" id="tr2-name2" class="w-full px-3 py-2 border border-border rounded-lg text-sm" value="Vinyl Siding">
            </div>
            <div>
              <input type="number" id="tr2-r2" class="tr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="0.61" min="0" step="0.01">
            </div>
          </div>
          <div class="grid grid-cols-3 gap-2 items-end">
            <div class="col-span-2">
              <label class="block text-xs font-medium text-text mb-1">Layer 3</label>
              <input type="text" id="tr2-name3" class="w-full px-3 py-2 border border-border rounded-lg text-sm" value="1/2\" Plywood Sheathing">
            </div>
            <div>
              <input type="number" id="tr2-r3" class="tr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="0.63" min="0" step="0.01">
            </div>
          </div>
          <div class="grid grid-cols-3 gap-2 items-end">
            <div class="col-span-2">
              <label class="block text-xs font-medium text-text mb-1">Layer 4</label>
              <input type="text" id="tr2-name4" class="w-full px-3 py-2 border border-border rounded-lg text-sm" value="R-13 Fiberglass Batt">
            </div>
            <div>
              <input type="number" id="tr2-r4" class="tr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="13" min="0" step="0.5">
            </div>
          </div>
          <div class="grid grid-cols-3 gap-2 items-end">
            <div class="col-span-2">
              <label class="block text-xs font-medium text-text mb-1">Layer 5</label>
              <input type="text" id="tr2-name5" class="w-full px-3 py-2 border border-border rounded-lg text-sm" value="1/2\" Drywall">
            </div>
            <div>
              <input type="number" id="tr2-r5" class="tr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="0.45" min="0" step="0.01">
            </div>
          </div>
          <div class="grid grid-cols-3 gap-2 items-end">
            <div class="col-span-2">
              <label class="block text-xs font-medium text-text mb-1">Layer 6</label>
              <input type="text" id="tr2-name6" class="w-full px-3 py-2 border border-border rounded-lg text-sm" value="Inside Air Film">
            </div>
            <div>
              <input type="number" id="tr2-r6" class="tr2-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="0.68" min="0" step="0.01">
            </div>
          </div>
        </div>

        <!-- Results -->
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total R-Value</div>
          <div class="text-4xl font-extrabold" id="tr2-rtotal">--</div>
          <div class="text-sm text-blue-200 mt-1">hr-ft2-째F/BTU</div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">U-Value</div>
            <div class="text-xl font-bold" id="tr2-u">--</div>
            <div class="text-xs text-text-muted">BTU/hr-ft2-째F</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">U-Value (SI)</div>
            <div class="text-xl font-bold" id="tr2-usi">--</div>
            <div class="text-xs text-text-muted">W/m2-K</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">R-Value (SI)</div>
            <div class="text-xl font-bold" id="tr2-rsi">--</div>
            <div class="text-xs text-text-muted">m2-K/W</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Heat Loss per sq ft</div>
            <div class="text-xl font-bold" id="tr2-loss">--</div>
            <div class="text-xs text-text-muted">BTU/hr (at 65째F delta-T)</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="thermal-resistance" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl mx-auto prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Understanding R-Value and U-Value</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p>R_total = R1 + R2 + R3 + ... (add all layers)</p>
        <p>U = 1 / R_total</p>
        <p>Heat Loss = U x Area x Delta-T</p>
      </div>
      <ul>
        <li><strong>R-value</strong> measures thermal resistance (higher = better insulation)</li>
        <li><strong>U-value</strong> measures thermal conductance (lower = better insulation)</li>
        <li>Always include air film resistances for accurate results</li>
        <li>Outside air film: R-0.17 (winter), Inside: R-0.68 (still air)</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcTR2() {
      // Sum all R-values
      let totalR = 0;
      for (let i = 1; i <= 6; i++) {
        const val = parseFloat((document.getElementById('tr2-r' + i) as HTMLInputElement).value) || 0;
        totalR += val;
      }

      const uValue = totalR > 0 ? 1 / totalR : 0;
      const rSI = totalR * 0.176110; // convert to m2-K/W
      const uSI = uValue * 5.678263; // convert to W/m2-K
      const heatLoss = uValue * 65; // at 65째F deltaT, per sq ft

      document.getElementById('tr2-rtotal')!.textContent = totalR.toFixed(2);
      document.getElementById('tr2-u')!.textContent = uValue.toFixed(4);
      document.getElementById('tr2-usi')!.textContent = uSI.toFixed(3);
      document.getElementById('tr2-rsi')!.textContent = rSI.toFixed(2);
      document.getElementById('tr2-loss')!.textContent = heatLoss.toFixed(2);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    function loadPreset(preset: string) {
      const presets: Record<string, { names: string[]; rvals: number[] }> = {
        '2x4': {
          names: ['Outside Air Film', 'Vinyl Siding', '1/2" Plywood Sheathing', 'R-13 Fiberglass Batt', '1/2" Drywall', 'Inside Air Film'],
          rvals: [0.17, 0.61, 0.63, 13, 0.45, 0.68]
        },
        '2x6': {
          names: ['Outside Air Film', 'Vinyl Siding', '1/2" OSB Sheathing', 'R-19 Fiberglass Batt', '1/2" Drywall', 'Inside Air Film'],
          rvals: [0.17, 0.61, 0.63, 19, 0.45, 0.68]
        },
        'brick': {
          names: ['Outside Air Film', '4" Brick', '1" Air Gap', '1/2" Plywood', 'R-13 Batt', 'Inside Air Film + Drywall'],
          rvals: [0.17, 0.44, 0.97, 0.63, 13, 1.13]
        },
        'roof': {
          names: ['Outside Air Film', 'Asphalt Shingles', '1/2" Plywood', 'R-38 Blown Insulation', '1/2" Drywall', 'Inside Air Film'],
          rvals: [0.17, 0.44, 0.63, 38, 0.45, 0.61]
        },
        'slab': {
          names: ['Soil (effective)', 'Concrete Slab 4"', 'Rigid Foam R-10', 'Carpet + Pad', '', 'Inside Air Film'],
          rvals: [2.0, 0.32, 10, 2.0, 0, 0.68]
        }
      };

      if (presets[preset]) {
        const p = presets[preset];
        for (let i = 0; i < 6; i++) {
          (document.getElementById('tr2-name' + (i + 1)) as HTMLInputElement).value = p.names[i];
          (document.getElementById('tr2-r' + (i + 1)) as HTMLInputElement).value = String(p.rvals[i]);
        }
      }
    }

    setTimeout(() => {
      document.querySelectorAll('.tr2-in').forEach(el => {
        el.addEventListener('input', calcTR2);
        el.addEventListener('change', calcTR2);
      });

      document.getElementById('tr2-preset')!.addEventListener('change', () => {
        const preset = (document.getElementById('tr2-preset') as HTMLSelectElement).value;
        if (preset !== 'custom') loadPreset(preset);
        calcTR2();
      });

      calcTR2();
    }, 50);
  </script>
</CalculatorLayout>
