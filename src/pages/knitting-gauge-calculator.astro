---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Knitting Gauge Calculator - Stitches & Rows per Inch";
const description = "Calculate knitting gauge from swatch measurements, get needle size recommendations, yarn weight matching, and project math.";
const relatedCalcs = [
  { name: "Yarn Calculator", url: "/yarn-calculator", description: "Yarn yardage calculator." },
  { name: "Fabric Calculator", url: "/fabric-calculator", description: "Fabric yardage needs." },
  { name: "Quilt Calculator", url: "/quilt-calculator", description: "Quilt sizing math." },
  { name: "Area Calculator", url: "/area-calculator", description: "Area calculations." },
  { name: "Ratio Calculator", url: "/ratio-calculator", description: "Ratio calculations." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Knitting Gauge Calculator" keywords="knitting gauge calculator, stitches per inch, rows per inch, needle size, yarn weight, swatch calculator" breadcrumbs={[{ name: "Knitting Gauge", url: "/knitting-gauge-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Knitting Gauge Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate stitches/rows per inch from your swatch, match yarn weight, and project stitch counts.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Yarn Weight</label>
          <select id="kg-weight" class="kg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="0">Lace (#0)</option>
            <option value="1">Fingering (#1)</option>
            <option value="2">Sport (#2)</option>
            <option value="3">DK (#3)</option>
            <option value="4" selected>Worsted (#4)</option>
            <option value="5">Bulky (#5)</option>
            <option value="6">Super Bulky (#6)</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Swatch Stitches Count</label><input type="number" id="kg-sts" class="kg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="1" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Swatch Width (inches)</label><input type="number" id="kg-sw" class="kg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" min="1" step="0.25"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Swatch Row Count</label><input type="number" id="kg-rows" class="kg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="28" min="1" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Swatch Height (inches)</label><input type="number" id="kg-sh" class="kg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" min="1" step="0.25"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Project Width (inches)</label><input type="number" id="kg-pw" class="kg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="1" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Project Height (inches)</label><input type="number" id="kg-ph" class="kg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="24" min="1" step="0.5"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Your Gauge</div>
          <div class="text-4xl font-extrabold font-mono" id="kg-result">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Stitches/inch</div><div class="text-xl font-bold font-mono" id="kg-spi">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Rows/inch</div><div class="text-xl font-bold font-mono" id="kg-rpi">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Needle Size</div><div class="text-xl font-bold font-mono" id="kg-needle">--</div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Cast On</div><div class="text-xl font-bold font-mono" id="kg-cast">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Rows</div><div class="text-xl font-bold font-mono" id="kg-totalrows">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Stitches</div><div class="text-xl font-bold font-mono" id="kg-totalsts">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="knitting-gauge" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcKG() {
      const wt = parseInt((document.getElementById('kg-weight') as HTMLSelectElement).value);
      const sts = parseFloat((document.getElementById('kg-sts') as HTMLInputElement).value) || 20;
      const sw = parseFloat((document.getElementById('kg-sw') as HTMLInputElement).value) || 4;
      const rows = parseFloat((document.getElementById('kg-rows') as HTMLInputElement).value) || 28;
      const sh = parseFloat((document.getElementById('kg-sh') as HTMLInputElement).value) || 4;
      const pw = parseFloat((document.getElementById('kg-pw') as HTMLInputElement).value) || 20;
      const ph = parseFloat((document.getElementById('kg-ph') as HTMLInputElement).value) || 24;

      const spi = sts / sw;
      const rpi = rows / sh;

      const needleSizes: Record<number, string> = {
        0: 'US 000-1 (1.5-2.25mm)', 1: 'US 1-3 (2.25-3.25mm)',
        2: 'US 3-5 (3.25-3.75mm)', 3: 'US 5-7 (3.75-4.5mm)',
        4: 'US 7-9 (4.5-5.5mm)', 5: 'US 9-11 (5.5-8mm)',
        6: 'US 11-17 (8-12mm)'
      };

      // Standard gauge ranges per 4 inches
      const stdGauge: Record<number, number[]> = {
        0: [32, 34], 1: [27, 32], 2: [23, 26], 3: [21, 24],
        4: [16, 20], 5: [12, 15], 6: [6, 11]
      };
      const std = stdGauge[wt] || [16, 20];
      const stsPer4 = spi * 4;

      const castOn = Math.round(spi * pw);
      const totalRows = Math.round(rpi * ph);
      const totalStitches = castOn * totalRows;

      let gaugeNote = stsPer4.toFixed(1) + ' sts / 4 in';

      document.getElementById('kg-result')!.textContent = gaugeNote;
      document.getElementById('kg-spi')!.textContent = spi.toFixed(2);
      document.getElementById('kg-rpi')!.textContent = rpi.toFixed(2);
      document.getElementById('kg-needle')!.textContent = needleSizes[wt] || '--';
      document.getElementById('kg-cast')!.textContent = castOn + ' sts';
      document.getElementById('kg-totalrows')!.textContent = totalRows.toString();
      document.getElementById('kg-totalsts')!.textContent = totalStitches.toLocaleString();
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.kg-in').forEach(el => { el.addEventListener('input', calcKG); el.addEventListener('change', calcKG); });
      calcKG();
    }, 50);
  </script>
</CalculatorLayout>
