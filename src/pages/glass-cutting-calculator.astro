---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Glass Cutting Calculator - Layout Optimization for Sheets";
const description = "Optimize glass cutting layouts for rectangular pieces from standard sheets. Minimize waste and calculate the number of sheets needed.";
const relatedCalcs = [
  { name: "Glass Thickness Calculator", url: "/glass-thickness-calculator", description: "Required glass thickness." },
  { name: "Stained Glass Calculator", url: "/stained-glass-calculator", description: "Stained glass materials." },
  { name: "Glass Fusing Calculator", url: "/glass-fusing-calculator", description: "Glass fusing schedules." },
  { name: "Glass Annealing Calculator", url: "/glass-annealing-calculator", description: "Annealing schedules." },
  { name: "Mosaic Grout Calculator", url: "/mosaic-grout-calculator", description: "Grout for mosaics." },
  { name: "Ceramic Tile Weight Calculator", url: "/ceramic-tile-weight-calculator", description: "Tile weight calculations." },
];
---
<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Glass Cutting Calculator"
  keywords="glass cutting, glass layout, cutting optimization, glass sheet, glass waste, glass cutting plan, rectangular cutting"
  breadcrumbs={[{ name: "Glass Cutting Calculator", url: "/glass-cutting-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Glass Cutting Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate optimal cutting layout for rectangular glass pieces from standard sheets. Minimize waste and plan your cuts.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <h3 class="font-semibold text-text mb-3">Sheet Size</h3>
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Sheet Width (inches)</label>
          <input type="number" id="gcu-sw" class="gcu-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="48" min="6" step="1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Sheet Height (inches)</label>
          <input type="number" id="gcu-sh" class="gcu-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="96" min="6" step="1">
        </div>
      </div>

      <h3 class="font-semibold text-text mb-3">Piece Size</h3>
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Piece Width (inches)</label>
          <input type="number" id="gcu-pw" class="gcu-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="1" step="0.25">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Piece Height (inches)</label>
          <input type="number" id="gcu-ph" class="gcu-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="18" min="1" step="0.25">
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Kerf / Blade Width (inches)</label>
          <input type="number" id="gcu-kerf" class="gcu-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.125" min="0" max="0.5" step="0.0625">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Pieces Needed</label>
          <input type="number" id="gcu-qty" class="gcu-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="1" step="1">
        </div>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Sheets Required</div>
        <div class="text-4xl font-extrabold" id="gcu-sheets">--</div>
        <div class="text-sm text-blue-200 mt-1" id="gcu-best-orient">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Pieces per Sheet</div>
          <div class="text-xl font-bold" id="gcu-per-sheet">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Waste Percentage</div>
          <div class="text-xl font-bold" id="gcu-waste">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Total Pieces Available</div>
          <div class="text-xl font-bold" id="gcu-total-avail">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Sheet Area Used</div>
          <div class="text-xl font-bold" id="gcu-used-area">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-4">
        <h3 class="font-semibold text-sm text-text mb-2">Cutting Layout</h3>
        <p class="text-xs text-text-muted" id="gcu-layout">--</p>
      </div>

      <ShareButton calculatorId="glass-cutting" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Glass Cutting Optimization</h2>
      <p>Efficient glass cutting minimizes waste and cost. Always try both orientations (portrait and landscape) of your piece on the sheet. Account for kerf (blade width) in your calculations.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Cutting Tips</h3>
      <ul>
        <li>Score glass once with even pressure - do not go over the score line twice</li>
        <li>Always wear safety glasses when cutting and breaking glass</li>
        <li>Standard sheet sizes: 48x96", 48x84", 36x72"</li>
        <li>Plan cuts from one edge to reduce waste from odd-shaped remnants</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcGCU() {
      const sw = parseFloat((document.getElementById('gcu-sw') as HTMLInputElement).value) || 48;
      const sh = parseFloat((document.getElementById('gcu-sh') as HTMLInputElement).value) || 96;
      const pw = parseFloat((document.getElementById('gcu-pw') as HTMLInputElement).value) || 12;
      const ph = parseFloat((document.getElementById('gcu-ph') as HTMLInputElement).value) || 18;
      const kerf = parseFloat((document.getElementById('gcu-kerf') as HTMLInputElement).value) || 0.125;
      const qty = parseInt((document.getElementById('gcu-qty') as HTMLInputElement).value) || 20;

      // Try both orientations and pick the better one
      function piecesInOrientation(pieceW: number, pieceH: number): {cols: number, rows: number, count: number} {
        const cols = Math.floor((sw + kerf) / (pieceW + kerf));
        const rows = Math.floor((sh + kerf) / (pieceH + kerf));
        return { cols, rows, count: cols * rows };
      }

      const orient1 = piecesInOrientation(pw, ph);  // normal
      const orient2 = piecesInOrientation(ph, pw);  // rotated 90°

      // Also try mixed: some rows normal, some rotated
      let bestCount = Math.max(orient1.count, orient2.count);
      let bestOrient = orient1.count >= orient2.count ? 'Normal' : 'Rotated 90°';
      let bestCols = orient1.count >= orient2.count ? orient1.cols : orient2.cols;
      let bestRows = orient1.count >= orient2.count ? orient1.rows : orient2.rows;
      let bestPieceW = orient1.count >= orient2.count ? pw : ph;
      let bestPieceH = orient1.count >= orient2.count ? ph : pw;

      const perSheet = bestCount;
      const sheetsNeeded = Math.ceil(qty / perSheet);
      const totalAvailable = sheetsNeeded * perSheet;

      const sheetArea = sw * sh;
      const pieceArea = pw * ph;
      const usedArea = perSheet * pieceArea;
      const wastePct = ((sheetArea - usedArea) / sheetArea) * 100;

      document.getElementById('gcu-sheets')!.textContent = String(sheetsNeeded);
      document.getElementById('gcu-best-orient')!.textContent = 'Best orientation: ' + bestOrient;
      document.getElementById('gcu-per-sheet')!.textContent = String(perSheet);
      document.getElementById('gcu-waste')!.textContent = wastePct.toFixed(1) + '%';
      document.getElementById('gcu-total-avail')!.textContent = totalAvailable + ' pieces';
      document.getElementById('gcu-used-area')!.textContent = ((usedArea / sheetArea) * 100).toFixed(1) + '%';

      document.getElementById('gcu-layout')!.textContent =
        bestCols + ' across x ' + bestRows + ' down per sheet (' + bestPieceW + '" x ' + bestPieceH +
        '" pieces). ' + sheetsNeeded + ' sheet' + (sheetsNeeded > 1 ? 's' : '') + ' needed for ' + qty +
        ' pieces with ' + (totalAvailable - qty) + ' spare piece' + ((totalAvailable - qty) !== 1 ? 's' : '') + '.';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.gcu-in').forEach(el => {
        el.addEventListener('input', calcGCU);
        el.addEventListener('change', calcGCU);
      });
      calcGCU();
    }, 50);
  </script>
</CalculatorLayout>
