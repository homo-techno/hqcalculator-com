---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Flow State Calculator - Challenge/Skill Balance & Conditions";
const description = "Assess your conditions for entering flow state. Evaluate challenge/skill balance, flow channel position, and estimate time-in-flow potential.";
const relatedCalcs = [
  { name: "Productivity Calculator", url: "/productivity-calculator", description: "Productivity metrics." },
  { name: "Pomodoro Calculator", url: "/pomodoro-calculator", description: "Pomodoro timer." },
  { name: "Study Time", url: "/study-time-calculator", description: "Study planning." },
  { name: "Reading Time", url: "/reading-time-calculator", description: "Reading duration." },
  { name: "Sleep Calculator", url: "/sleep-calculator", description: "Optimize sleep cycles." },
  { name: "Caffeine Calculator", url: "/caffeine-calculator", description: "Caffeine intake." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Flow State Calculator" keywords="flow state, flow experience, Csikszentmihalyi, challenge skill balance, deep work, focus, optimal experience, zone" breadcrumbs={[{ name: "Flow State", url: "/flow-state-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Flow State Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Evaluate your conditions for achieving flow (Csikszentmihalyi's optimal experience theory).</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Task Challenge Level (1-10)</label>
          <input type="range" id="fw2-challenge" class="fw2-in w-full" min="1" max="10" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Very easy (1)</span><span>Extremely hard (10)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Your Skill Level for This Task (1-10)</label>
          <input type="range" id="fw2-skill" class="fw2-in w-full" min="1" max="10" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Beginner (1)</span><span>Expert (10)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Clear goals for the task?</label>
          <select id="fw2-goals" class="fw2-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center">
            <option value="3">Yes, very clear</option>
            <option value="2">Somewhat clear</option>
            <option value="1">Vague</option>
            <option value="0">No clear goals</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Immediate feedback available?</label>
          <select id="fw2-feedback" class="fw2-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center">
            <option value="3">Yes, instant feedback</option>
            <option value="2">Some feedback</option>
            <option value="1">Delayed feedback</option>
            <option value="0">No feedback</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Distraction level (1-10)</label>
          <input type="range" id="fw2-distract" class="fw2-in w-full" min="1" max="10" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>None (1)</span><span>Constant (10)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Intrinsic motivation for this task (1-10)</label>
          <input type="range" id="fw2-motiv" class="fw2-in w-full" min="1" max="10" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Forced/obligatory (1)</span><span>Deeply motivated (10)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Available uninterrupted time (minutes)</label>
          <input type="number" id="fw2-time" class="fw2-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="5" max="480" step="5">
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm opacity-80">Flow State Assessment</div>
          <div class="text-2xl font-extrabold mt-1" id="fw2-state">--</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Flow Channel Position</div>
            <div class="text-xl font-bold text-text mt-1" id="fw2-channel">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Est. Time in Flow</div>
            <div class="text-xl font-bold text-text mt-1" id="fw2-flowtime">--</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-secondary">Flow Readiness Score</div>
          <div class="text-xl font-bold text-text mt-1" id="fw2-ready">--</div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-secondary mb-2">Flow Conditions Checklist</div>
          <div class="text-sm text-text" id="fw2-check">--</div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-secondary mb-2">Adjustments to Reach Flow</div>
          <div class="text-sm text-text" id="fw2-adjust">--</div>
        </div>
      </div>

      <ShareButton calculatorId="flow-state" />
      <FeedbackWidget />
    </div>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcFW2() {
      const challenge = parseInt((document.getElementById('fw2-challenge') as HTMLInputElement).value) || 5;
      const skill = parseInt((document.getElementById('fw2-skill') as HTMLInputElement).value) || 5;
      const goals = parseInt((document.getElementById('fw2-goals') as HTMLSelectElement).value) || 2;
      const feedback = parseInt((document.getElementById('fw2-feedback') as HTMLSelectElement).value) || 2;
      const distract = parseInt((document.getElementById('fw2-distract') as HTMLInputElement).value) || 3;
      const motiv = parseInt((document.getElementById('fw2-motiv') as HTMLInputElement).value) || 5;
      const availTime = parseInt((document.getElementById('fw2-time') as HTMLInputElement).value) || 60;

      // Flow channel: challenge and skill should both be high and roughly matched
      const diff = challenge - skill;
      let channel = 'Flow';
      if (challenge < 4 && skill < 4) channel = 'Apathy';
      else if (diff > 2) channel = 'Anxiety';
      else if (diff > 1) channel = 'Arousal (near flow)';
      else if (diff < -2) channel = 'Boredom';
      else if (diff < -1) channel = 'Relaxation';
      else if (challenge >= 5 && skill >= 5) channel = 'Flow';
      else channel = 'Control';

      // Flow readiness (0-100)
      const balanceScore = Math.max(0, 10 - Math.abs(diff) * 2.5) * 10; // 0-100
      const conditionScore = (goals + feedback) / 6 * 100; // 0-100
      const envScore = (10 - distract) / 9 * 100;
      const motivScore = motiv / 10 * 100;
      const readiness = Math.round((balanceScore * 0.35 + conditionScore * 0.2 + envScore * 0.2 + motivScore * 0.25));

      // State label
      let stateLabel = '';
      if (readiness >= 75 && channel === 'Flow') stateLabel = 'Excellent Flow Conditions';
      else if (readiness >= 60) stateLabel = 'Good - Flow Possible';
      else if (readiness >= 40) stateLabel = 'Moderate - Adjustments Needed';
      else stateLabel = 'Poor - Flow Unlikely Right Now';

      // Estimated time in flow
      let flowMin = 0;
      if (readiness >= 60) {
        const rampUp = 15; // ~15 min to enter flow
        flowMin = Math.max(0, Math.min(availTime - rampUp, (readiness / 100) * (availTime - rampUp)));
      }

      document.getElementById('fw2-state')!.textContent = stateLabel;
      document.getElementById('fw2-channel')!.textContent = channel;
      document.getElementById('fw2-flowtime')!.textContent = flowMin > 0 ? Math.round(flowMin) + ' min' : 'Unlikely now';
      document.getElementById('fw2-ready')!.textContent = readiness + ' / 100';

      // Checklist
      const checks: string[] = [];
      checks.push((Math.abs(diff) <= 1 && challenge >= 5) ? 'Challenge/Skill balance: GOOD' : 'Challenge/Skill balance: NEEDS ADJUSTMENT');
      checks.push(goals >= 2 ? 'Clear goals: YES' : 'Clear goals: NO');
      checks.push(feedback >= 2 ? 'Immediate feedback: YES' : 'Immediate feedback: WEAK');
      checks.push(distract <= 3 ? 'Low distractions: YES' : 'Low distractions: NO');
      checks.push(motiv >= 6 ? 'Intrinsic motivation: HIGH' : 'Intrinsic motivation: LOW');
      checks.push(availTime >= 45 ? 'Sufficient time (45+ min): YES' : 'Sufficient time: NO (need 45+ min)');
      document.getElementById('fw2-check')!.innerHTML = checks.map(c => '<div>' + c + '</div>').join('');

      // Adjustments
      const adj: string[] = [];
      if (diff > 1) adj.push('Challenge exceeds skill. Break the task into smaller sub-tasks or get assistance to reduce difficulty.');
      if (diff < -1) adj.push('Task is too easy for your skill. Add constraints, increase speed goals, or tackle a harder variant.');
      if (goals < 2) adj.push('Define specific, measurable goals for this work session before starting.');
      if (feedback < 2) adj.push('Create feedback mechanisms: use tests, track metrics, or get peer review.');
      if (distract > 5) adj.push('Reduce distractions: silence phone, close email, use "Do Not Disturb" mode, find a quiet space.');
      if (motiv < 5) adj.push('Boost motivation: connect the task to personal meaning, or reward yourself after completion.');
      if (availTime < 45) adj.push('Block at least 45-90 minutes of uninterrupted time. Flow requires 15+ min ramp-up.');
      if (adj.length === 0) adj.push('Conditions look great for flow. Start immediately and protect this time block.');

      document.getElementById('fw2-adjust')!.textContent = adj.join(' ');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      (document.getElementById('fw2-challenge') as HTMLInputElement).value = '6';
      (document.getElementById('fw2-skill') as HTMLInputElement).value = '6';
      (document.getElementById('fw2-distract') as HTMLInputElement).value = '3';
      (document.getElementById('fw2-motiv') as HTMLInputElement).value = '7';
      (document.getElementById('fw2-time') as HTMLInputElement).value = '60';
      document.querySelectorAll('.fw2-in').forEach(el => {
        el.addEventListener('input', calcFW2);
        el.addEventListener('change', calcFW2);
      });
      calcFW2();
    }, 50);
  </script>
</CalculatorLayout>
