---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Thermal Shock Calculator - Ceramic Material Resistance Rating";
const description = "Calculate thermal shock resistance rating for ceramic materials based on thermal conductivity, tensile strength, elastic modulus, and expansion coefficient.";
const relatedCalcs = [
  { name: "Kiln Temperature Calculator", url: "/kiln-temperature-calculator", description: "Firing schedules." },
  { name: "Glaze Chemistry Calculator", url: "/glaze-chemistry-calculator", description: "Glaze oxide analysis." },
  { name: "Glass Annealing Calculator", url: "/glass-annealing-calculator", description: "Annealing schedules." },
  { name: "Glass Fusing Calculator", url: "/glass-fusing-calculator", description: "Glass fusing schedules." },
  { name: "Ceramic Fiber Calculator", url: "/ceramic-fiber-calculator", description: "Insulation calculations." },
  { name: "Raku Firing Calculator", url: "/raku-firing-calculator", description: "Raku firing planning." },
];
---
<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Thermal Shock Calculator"
  keywords="thermal shock, ceramic thermal shock, thermal shock resistance, thermal stress, ceramic cracking, thermal expansion, Hasselman parameter"
  breadcrumbs={[{ name: "Thermal Shock Calculator", url: "/thermal-shock-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Thermal Shock Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Evaluate thermal shock resistance of ceramic materials using material properties and the Hasselman thermal shock parameter.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Material Preset</label>
        <select id="tsh-preset" class="tsh-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="stoneware" selected>Stoneware</option>
          <option value="porcelain">Porcelain</option>
          <option value="earthenware">Earthenware</option>
          <option value="alumina">Alumina (Al2O3)</option>
          <option value="cordierite">Cordierite (kiln furniture)</option>
          <option value="silicon_carbide">Silicon Carbide</option>
          <option value="borosilicate">Borosilicate Glass</option>
          <option value="soda_lime">Soda-Lime Glass</option>
          <option value="custom">Custom Values</option>
        </select>
      </div>

      <div id="tsh-params" class="space-y-3 mb-5">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Tensile Strength (MPa)</label>
          <input type="number" id="tsh-strength" class="tsh-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="40" min="1" step="1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Elastic Modulus (GPa)</label>
          <input type="number" id="tsh-modulus" class="tsh-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="70" min="1" step="1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Thermal Expansion Coefficient (x10^-6 /°C)</label>
          <input type="number" id="tsh-cte" class="tsh-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6.0" min="0.1" max="30" step="0.1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Thermal Conductivity (W/m·K)</label>
          <input type="number" id="tsh-conduct" class="tsh-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2.0" min="0.1" max="200" step="0.1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Poisson's Ratio</label>
          <input type="number" id="tsh-poisson" class="tsh-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.20" min="0.05" max="0.50" step="0.01">
        </div>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Max Safe Temperature Change</div>
        <div class="text-4xl font-extrabold" id="tsh-delta-t">--</div>
        <div class="text-sm text-blue-200 mt-1" id="tsh-rating">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">R Parameter (°C)</div>
          <div class="text-xl font-bold" id="tsh-r1">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">R' Parameter (W/m)</div>
          <div class="text-xl font-bold" id="tsh-r2">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Thermal Stress Factor</div>
          <div class="text-xl font-bold" id="tsh-stress">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Resistance Rating</div>
          <div class="text-xl font-bold" id="tsh-grade">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-4">
        <h3 class="font-semibold text-sm text-text mb-2">Interpretation</h3>
        <p class="text-xs text-text-muted" id="tsh-notes">--</p>
      </div>

      <ShareButton calculatorId="thermal-shock" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Thermal Shock in Ceramics</h2>
      <p>Thermal shock occurs when rapid temperature changes create stress that exceeds the material's tensile strength. The first Hasselman parameter (R) gives the maximum temperature difference a material can withstand without fracture initiation.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Key Factors</h3>
      <ul>
        <li><strong>Higher tensile strength:</strong> Can withstand more thermal stress</li>
        <li><strong>Lower thermal expansion:</strong> Less stress for the same temperature change</li>
        <li><strong>Higher thermal conductivity:</strong> Heat distributes faster, reducing gradients</li>
        <li><strong>Lower elastic modulus:</strong> More flexibility to absorb thermal strain</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcTSH() {
      const preset = (document.getElementById('tsh-preset') as HTMLSelectElement).value;

      // Material presets: {strength MPa, modulus GPa, cte x10^-6, conductivity W/mK, poisson}
      const presets: Record<string, {s: number, e: number, a: number, k: number, v: number}> = {
        stoneware: { s: 40, e: 70, a: 6.0, k: 2.0, v: 0.20 },
        porcelain: { s: 50, e: 80, a: 5.5, k: 2.5, v: 0.22 },
        earthenware: { s: 25, e: 50, a: 7.5, k: 1.5, v: 0.18 },
        alumina: { s: 300, e: 380, a: 8.1, k: 30, v: 0.22 },
        cordierite: { s: 25, e: 35, a: 1.5, k: 3.0, v: 0.21 },
        silicon_carbide: { s: 400, e: 410, a: 4.5, k: 120, v: 0.17 },
        borosilicate: { s: 70, e: 64, a: 3.3, k: 1.1, v: 0.20 },
        soda_lime: { s: 45, e: 72, a: 9.0, k: 1.0, v: 0.22 },
      };

      if (preset !== 'custom' && presets[preset]) {
        const p = presets[preset];
        (document.getElementById('tsh-strength') as HTMLInputElement).value = String(p.s);
        (document.getElementById('tsh-modulus') as HTMLInputElement).value = String(p.e);
        (document.getElementById('tsh-cte') as HTMLInputElement).value = String(p.a);
        (document.getElementById('tsh-conduct') as HTMLInputElement).value = String(p.k);
        (document.getElementById('tsh-poisson') as HTMLInputElement).value = String(p.v);
      }

      const sigma = parseFloat((document.getElementById('tsh-strength') as HTMLInputElement).value) || 40;
      const E = parseFloat((document.getElementById('tsh-modulus') as HTMLInputElement).value) || 70;
      const alpha = parseFloat((document.getElementById('tsh-cte') as HTMLInputElement).value) || 6;
      const k = parseFloat((document.getElementById('tsh-conduct') as HTMLInputElement).value) || 2;
      const v = parseFloat((document.getElementById('tsh-poisson') as HTMLInputElement).value) || 0.20;

      // Hasselman first parameter: R = sigma(1-v) / (E * alpha)
      // sigma in MPa, E in GPa -> E*1000 in MPa, alpha in 10^-6
      const alphaReal = alpha * 1e-6;
      const E_MPa = E * 1000;
      const R = (sigma * (1 - v)) / (E_MPa * alphaReal); // in °C

      // R' = R * k (thermal conductivity included)
      const R_prime = R * k; // W/m

      // Max safe temperature change
      const deltaT = R;

      // Thermal stress factor
      const stressFactor = E_MPa * alphaReal / (1 - v);

      // Rating
      let grade = '';
      let rating = '';
      if (deltaT > 500) { grade = 'Excellent'; rating = 'Very high thermal shock resistance'; }
      else if (deltaT > 200) { grade = 'Good'; rating = 'Good thermal shock resistance'; }
      else if (deltaT > 100) { grade = 'Moderate'; rating = 'Moderate resistance - avoid rapid cooling'; }
      else if (deltaT > 50) { grade = 'Low'; rating = 'Low resistance - slow heating/cooling required'; }
      else { grade = 'Poor'; rating = 'Very susceptible to thermal shock'; }

      document.getElementById('tsh-delta-t')!.textContent = Math.round(deltaT) + '°C';
      document.getElementById('tsh-rating')!.textContent = rating;
      document.getElementById('tsh-r1')!.textContent = Math.round(R) + '°C';
      document.getElementById('tsh-r2')!.textContent = R_prime.toFixed(0) + ' W/m';
      document.getElementById('tsh-stress')!.textContent = stressFactor.toFixed(2) + ' MPa/°C';
      document.getElementById('tsh-grade')!.textContent = grade;

      const notes = [];
      if (alpha > 7) notes.push('High thermal expansion coefficient increases thermal shock risk.');
      if (k < 2) notes.push('Low thermal conductivity means heat distributes slowly, creating steep gradients.');
      if (sigma > 100) notes.push('High tensile strength helps resist fracture from thermal stress.');
      notes.push('For practical use, apply a safety factor of 2-3x on the calculated maximum temperature change.');
      document.getElementById('tsh-notes')!.textContent = notes.join(' ');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.tsh-in').forEach(el => {
        el.addEventListener('input', calcTSH);
        el.addEventListener('change', calcTSH);
      });
      calcTSH();
    }, 50);
  </script>
</CalculatorLayout>
