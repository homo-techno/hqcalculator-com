---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Fresnel Zone Calculator - Clearance Radius Tool 2026";
const description = "Calculate Fresnel zone radius at any point along a wireless link. Determine clearance requirements for reliable microwave and wireless point-to-point connections.";

const relatedCalcs = [
  { name: "Link Budget Calculator", url: "/link-budget-calculator", description: "Complete RF link budget analysis." },
  { name: "Tower Height Calculator", url: "/tower-height-calculator", description: "Radio tower line-of-sight height." },
  { name: "Free Space Path Loss Calculator", url: "/free-space-path-loss-calculator", description: "FSPL calculation." },
  { name: "Microwave Link Calculator", url: "/microwave-link-calculator", description: "Point-to-point microwave link." },
  { name: "Wireless Range Calculator", url: "/wireless-range-calculator", description: "WiFi/wireless range estimation." },
  { name: "Wavelength Frequency Calculator", url: "/wavelength-frequency-calculator", description: "Wavelength and frequency conversion." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Fresnel Zone Calculator"
  keywords="Fresnel zone calculator, Fresnel zone radius, clearance, wireless link, microwave link, line of sight, obstruction"
  breadcrumbs={[{ name: "Fresnel Zone Calculator", url: "/fresnel-zone-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Fresnel Zone Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate the Fresnel zone radius at any point along a wireless link to ensure proper clearance for reliable communication.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Total Link Distance</label>
        <div class="flex gap-2">
          <input type="number" id="frz-dist" class="frz-in flex-1 px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" step="0.1" min="0.01">
          <select id="frz-dist-unit" class="frz-in px-4 py-3 border border-border rounded-xl text-lg">
            <option value="km" selected>km</option>
            <option value="mi">miles</option>
            <option value="m">meters</option>
          </select>
        </div>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Frequency</label>
        <div class="flex gap-2">
          <input type="number" id="frz-freq" class="frz-in flex-1 px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5.8" step="0.1" min="0.001">
          <select id="frz-freq-unit" class="frz-in px-4 py-3 border border-border rounded-xl text-lg">
            <option value="GHz" selected>GHz</option>
            <option value="MHz">MHz</option>
          </select>
        </div>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Obstruction Distance from Transmitter (%)</label>
        <div class="flex items-center gap-3">
          <input type="range" id="frz-position-slider" class="frz-in flex-1" min="1" max="99" value="50" step="1">
          <input type="number" id="frz-position" class="frz-in w-20 px-3 py-2 border border-border rounded-lg text-center font-bold" value="50" min="1" max="99" step="1">
          <span class="text-text-muted">%</span>
        </div>
        <p class="text-xs text-text-muted mt-1">Maximum radius is at 50% (midpoint). Position of obstruction along the path.</p>
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-text mb-1">Fresnel Zone Number</label>
        <select id="frz-zone" class="frz-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="1" selected>1st Fresnel Zone (most important)</option>
          <option value="2">2nd Fresnel Zone</option>
          <option value="3">3rd Fresnel Zone</option>
        </select>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm font-medium text-blue-100 mb-1">Fresnel Zone Radius at Obstruction Point</div>
        <div class="text-4xl font-extrabold" id="frz-radius">--</div>
        <div class="text-sm text-blue-200 mt-1">meters</div>
      </div>

      <!-- Secondary Stats -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Max Radius (at midpoint)</div>
          <div class="text-xl font-bold text-text" id="frz-max">--</div>
          <div class="text-xs text-text-muted">meters</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">60% Clearance Required</div>
          <div class="text-xl font-bold text-text" id="frz-60pct">--</div>
          <div class="text-xs text-text-muted">meters</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Wavelength</div>
          <div class="text-xl font-bold text-text" id="frz-wavelength">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">d1 / d2 Distance</div>
          <div class="text-xl font-bold text-text" id="frz-d1d2">--</div>
        </div>
      </div>

      <ShareButton calculatorId="fresnel-zone" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Understanding Fresnel Zones</h2>
      <p>Fresnel zones are concentric ellipsoids of signal energy around the direct line-of-sight between transmitter and receiver. Obstructions within the first Fresnel zone cause significant signal degradation.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono text-sm">
        r_n = sqrt( n * lambda * d1 * d2 / (d1 + d2) )
      </div>
      <p>For reliable links, at least 60% of the first Fresnel zone should be clear of obstructions. At microwave frequencies, this can be several meters in radius even for short links.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcFRZ() {
      const distVal = parseFloat((document.getElementById('frz-dist') as HTMLInputElement).value) || 0.01;
      const distUnit = (document.getElementById('frz-dist-unit') as HTMLSelectElement).value;
      const freqVal = parseFloat((document.getElementById('frz-freq') as HTMLInputElement).value) || 0.001;
      const freqUnit = (document.getElementById('frz-freq-unit') as HTMLSelectElement).value;
      const position = (parseFloat((document.getElementById('frz-position') as HTMLInputElement).value) || 50) / 100;
      const zone = parseInt((document.getElementById('frz-zone') as HTMLSelectElement).value) || 1;

      // Sync slider
      (document.getElementById('frz-position-slider') as HTMLInputElement).value = String(position * 100);
      (document.getElementById('frz-position') as HTMLInputElement).value = String(Math.round(position * 100));

      let distM = distVal * 1000;
      if (distUnit === 'mi') distM = distVal * 1609.34;
      else if (distUnit === 'm') distM = distVal;

      let freqHz = freqVal * 1e9;
      if (freqUnit === 'MHz') freqHz = freqVal * 1e6;

      const wavelength = 299792458 / freqHz;
      const d1 = distM * position;
      const d2 = distM * (1 - position);

      // Fresnel zone radius: r_n = sqrt(n * lambda * d1 * d2 / D)
      const radius = Math.sqrt(zone * wavelength * d1 * d2 / distM);
      const maxRadius = Math.sqrt(zone * wavelength * (distM / 2) * (distM / 2) / distM);
      const clearance60 = radius * 0.6;

      document.getElementById('frz-radius')!.textContent = radius.toFixed(2);
      document.getElementById('frz-max')!.textContent = maxRadius.toFixed(2);
      document.getElementById('frz-60pct')!.textContent = clearance60.toFixed(2);

      if (wavelength >= 1) {
        document.getElementById('frz-wavelength')!.textContent = wavelength.toFixed(3) + ' m';
      } else if (wavelength >= 0.01) {
        document.getElementById('frz-wavelength')!.textContent = (wavelength * 100).toFixed(2) + ' cm';
      } else {
        document.getElementById('frz-wavelength')!.textContent = (wavelength * 1000).toFixed(2) + ' mm';
      }

      const d1Km = (d1 / 1000).toFixed(2);
      const d2Km = (d2 / 1000).toFixed(2);
      document.getElementById('frz-d1d2')!.textContent = d1Km + ' / ' + d2Km + ' km';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.frz-in').forEach(el => { el.addEventListener('input', calcFRZ); el.addEventListener('change', calcFRZ); });
      calcFRZ();
    }, 50);
  </script>
</CalculatorLayout>
