---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Ecological Footprint Calculator - Personal Global Hectares";
const description = "Calculate your personal ecological footprint in global hectares (gha), compare with biocapacity, and see how your lifestyle impacts the planet.";
const relatedCalcs = [
  { name: "Carbon Footprint", url: "/carbon-footprint-calculator", description: "Carbon emissions." },
  { name: "Carbon Offset", url: "/carbon-offset-calculator", description: "Carbon offsetting." },
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Energy costs." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body mass index." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Calorie needs." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Ecological Footprint Calculator" keywords="ecological footprint, global hectares, biocapacity, sustainability, environmental impact, earth overshoot" breadcrumbs={[{ name: "Ecological Footprint", url: "/ecological-footprint-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Ecological Footprint Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your personal ecological footprint in global hectares and compare with Earth's biocapacity.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <p class="text-xs font-semibold text-text-muted uppercase tracking-wide">Energy &amp; Housing</p>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Electricity (kWh/month)</label><input type="number" id="ef2-elec" class="ef2-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="10"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Natural Gas (therms/month)</label><input type="number" id="ef2-gas" class="ef2-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="1"></div>
        </div>

        <p class="text-xs font-semibold text-text-muted uppercase tracking-wide">Transportation</p>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Car Miles/Week</label><input type="number" id="ef2-car" class="ef2-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="10"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Flights/Year (hours)</label><input type="number" id="ef2-fly" class="ef2-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="1"></div>
        </div>

        <p class="text-xs font-semibold text-text-muted uppercase tracking-wide">Food</p>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Diet Type</label>
            <select id="ef2-diet" class="ef2-in w-full px-4 py-3 border border-border rounded-xl font-bold">
              <option value="1.7">Vegan</option>
              <option value="2.0">Vegetarian</option>
              <option value="2.5" selected>Average Omnivore</option>
              <option value="3.3">Heavy Meat Eater</option>
            </select>
          </div>
          <div><label class="block text-xs font-medium text-text mb-1">Local/Organic (%)</label><input type="number" id="ef2-local" class="ef2-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" max="100" step="5"></div>
        </div>

        <p class="text-xs font-semibold text-text-muted uppercase tracking-wide">Goods &amp; Services</p>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Monthly Spending ($)</label><input type="number" id="ef2-spend" class="ef2-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="0" step="100"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Household Size</label><input type="number" id="ef2-hh" class="ef2-in w-full px-4 py-3 border border-border rounded-xl font-bold" min="1" max="10" step="1"></div>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center" id="ef2-display">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Your Ecological Footprint</div>
          <div class="text-5xl font-extrabold font-mono" id="ef2-result">--</div>
          <div class="text-sm mt-1 opacity-80" id="ef2-sub">global hectares per year</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Earths Needed</div><div class="text-xl font-bold font-mono" id="ef2-s1">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Biocapacity Avail.</div><div class="text-xl font-bold font-mono" id="ef2-s2">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Deficit/Reserve</div><div class="text-xl font-bold font-mono" id="ef2-s3">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Carbon Component</div><div class="text-xl font-bold font-mono" id="ef2-s4">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Food Component</div><div class="text-xl font-bold font-mono" id="ef2-s5">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="ecological-footprint" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    const BIOCAPACITY_PER_PERSON = 1.63; // gha available per person on Earth

    function calcEF2() {
      const elec = parseFloat((document.getElementById('ef2-elec') as HTMLInputElement).value) || 0;
      const gas = parseFloat((document.getElementById('ef2-gas') as HTMLInputElement).value) || 0;
      const car = parseFloat((document.getElementById('ef2-car') as HTMLInputElement).value) || 0;
      const fly = parseFloat((document.getElementById('ef2-fly') as HTMLInputElement).value) || 0;
      const dietFactor = parseFloat((document.getElementById('ef2-diet') as HTMLSelectElement).value) || 2.5;
      const localPct = parseFloat((document.getElementById('ef2-local') as HTMLInputElement).value) || 0;
      const spend = parseFloat((document.getElementById('ef2-spend') as HTMLInputElement).value) || 0;
      const hh = parseFloat((document.getElementById('ef2-hh') as HTMLInputElement).value) || 1;

      // Energy footprint (gha): electricity ~0.0003 gha per kWh/year, gas ~0.005 gha per therm/year
      const elecAnnual = elec * 12;
      const gasAnnual = gas * 12;
      const energyFP = (elecAnnual * 0.0003 + gasAnnual * 0.005) / hh;

      // Transportation: car ~0.0004 gha per mile/year, flight ~0.05 gha per hour
      const carAnnual = car * 52;
      const transportFP = carAnnual * 0.0004 + fly * 0.05;

      // Food footprint adjusted for local sourcing
      const localDiscount = 1 - (localPct / 100) * 0.15;
      const foodFP = dietFactor * localDiscount;

      // Goods & services: ~0.0004 gha per $ spent annually
      const goodsFP = (spend * 12 * 0.0004) / hh;

      // Carbon component (energy + transport)
      const carbonFP = energyFP + transportFP;

      const totalFP = carbonFP + foodFP + goodsFP;
      const earthsNeeded = totalFP / BIOCAPACITY_PER_PERSON;
      const deficit = BIOCAPACITY_PER_PERSON - totalFP;

      let color: string;
      if (totalFP <= 1.63) color = 'bg-green-600';
      else if (totalFP <= 3) color = 'bg-yellow-500';
      else if (totalFP <= 5) color = 'bg-orange-500';
      else color = 'bg-red-600';

      document.getElementById('ef2-result')!.textContent = totalFP.toFixed(2) + ' gha';
      document.getElementById('ef2-display')!.className = 'p-6 rounded-2xl text-white text-center ' + color;
      document.getElementById('ef2-s1')!.textContent = earthsNeeded.toFixed(1);
      document.getElementById('ef2-s2')!.textContent = BIOCAPACITY_PER_PERSON.toFixed(2) + ' gha';
      document.getElementById('ef2-s3')!.textContent = (deficit >= 0 ? '+' : '') + deficit.toFixed(2) + ' gha';
      document.getElementById('ef2-s4')!.textContent = carbonFP.toFixed(2) + ' gha';
      document.getElementById('ef2-s5')!.textContent = foodFP.toFixed(2) + ' gha';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      (document.getElementById('ef2-elec') as HTMLInputElement).value = '900';
      (document.getElementById('ef2-gas') as HTMLInputElement).value = '30';
      (document.getElementById('ef2-car') as HTMLInputElement).value = '200';
      (document.getElementById('ef2-fly') as HTMLInputElement).value = '10';
      (document.getElementById('ef2-local') as HTMLInputElement).value = '20';
      (document.getElementById('ef2-spend') as HTMLInputElement).value = '2000';
      (document.getElementById('ef2-hh') as HTMLInputElement).value = '2';
      document.querySelectorAll('.ef2-in').forEach(el => { el.addEventListener('input', calcEF2); el.addEventListener('change', calcEF2); });
      calcEF2();
    }, 50);
  </script>
</CalculatorLayout>
