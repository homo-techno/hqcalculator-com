---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Bayes' Theorem Calculator - Posterior Probability";
const description = "Calculate posterior probability using Bayes' theorem. Enter P(A), P(B|A), and P(B|not A) to find P(A|B).";

const relatedCalcs = [
  { name: "Probability Calculator", url: "/probability-calculator", description: "General probability." },
  { name: "T-Test Calculator", url: "/t-test-calculator", description: "Statistical significance." },
  { name: "Chi-Square Calculator", url: "/chi-square-calculator", description: "Chi-square test." },
  { name: "Average Calculator", url: "/average-calculator", description: "Mean, median, mode." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage calculations." },
  { name: "Correlation Calculator", url: "/correlation-calculator", description: "Pearson correlation." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Bayes' Theorem Calculator"
  keywords="bayes theorem calculator, posterior probability, prior probability, conditional probability, bayesian"
  breadcrumbs={[{ name: "Bayes' Theorem Calculator", url: "/bayes-theorem-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Bayes' Theorem Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Compute the posterior probability P(A|B) using Bayes' theorem from prior and likelihood values.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">P(A) &mdash; Prior Probability <span class="text-text-muted">(0 to 1)</span></label>
          <input type="number" id="bt-pa" class="bt-in w-full px-4 py-2 border border-border rounded-xl text-lg" value="0.01" step="0.01" min="0" max="1" />
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">P(B|A) &mdash; Likelihood <span class="text-text-muted">(probability of B given A)</span></label>
          <input type="number" id="bt-pba" class="bt-in w-full px-4 py-2 border border-border rounded-xl text-lg" value="0.90" step="0.01" min="0" max="1" />
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">P(B|&not;A) &mdash; False Positive Rate <span class="text-text-muted">(probability of B given not A)</span></label>
          <input type="number" id="bt-pbna" class="bt-in w-full px-4 py-2 border border-border rounded-xl text-lg" value="0.05" step="0.01" min="0" max="1" />
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">P(A|B) &mdash; Posterior Probability</div>
          <div class="text-5xl font-extrabold font-mono" id="bt-result">0</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">P(B) &mdash; Total Probability</div>
            <div class="text-xl font-bold" id="bt-pb">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">P(&not;A|B)</div>
            <div class="text-xl font-bold" id="bt-pnab">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Prior P(A)</div>
            <div class="text-xl font-bold" id="bt-prior">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Update Factor</div>
            <div class="text-xl font-bold" id="bt-factor">0</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Step-by-Step</h3>
          <div class="text-sm text-text-secondary font-mono whitespace-pre-wrap" id="bt-steps"></div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Interpretation</h3>
          <div class="text-sm text-text-secondary" id="bt-interpret"></div>
        </div>
      </div>

      <ShareButton calculatorId="bayes-theorem" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Bayes' Theorem</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm">
        <p>P(A|B) = P(B|A) &times; P(A) / P(B)</p>
        <p>P(B) = P(B|A) &times; P(A) + P(B|&not;A) &times; P(&not;A)</p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">Common Applications</h3>
      <ul>
        <li>Medical diagnostic testing (sensitivity/specificity)</li>
        <li>Spam email filtering</li>
        <li>Machine learning classification</li>
        <li>Risk assessment</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcBT() {
      const pA = parseFloat((document.getElementById('bt-pa') as HTMLInputElement).value) || 0;
      const pBA = parseFloat((document.getElementById('bt-pba') as HTMLInputElement).value) || 0;
      const pBnA = parseFloat((document.getElementById('bt-pbna') as HTMLInputElement).value) || 0;
      const fmt = (v: number) => v.toFixed(6);
      const pct = (v: number) => (v * 100).toFixed(2) + '%';

      const pNotA = 1 - pA;
      const pB = pBA * pA + pBnA * pNotA;

      let pAB = 0;
      if (pB > 0) {
        pAB = (pBA * pA) / pB;
      }

      const pNotAB = 1 - pAB;
      const updateFactor = pA > 0 ? pAB / pA : 0;

      document.getElementById('bt-result')!.textContent = fmt(pAB);
      document.getElementById('bt-pb')!.textContent = fmt(pB);
      document.getElementById('bt-pnab')!.textContent = fmt(pNotAB);
      document.getElementById('bt-prior')!.textContent = fmt(pA);
      document.getElementById('bt-factor')!.textContent = updateFactor.toFixed(2) + 'x';

      let steps = `1. P(B) = P(B|A)×P(A) + P(B|¬A)×P(¬A)\n`;
      steps += `       = ${pBA}×${pA} + ${pBnA}×${pNotA.toFixed(4)}\n`;
      steps += `       = ${fmt(pBA * pA)} + ${fmt(pBnA * pNotA)}\n`;
      steps += `       = ${fmt(pB)}\n\n`;
      steps += `2. P(A|B) = P(B|A)×P(A) / P(B)\n`;
      steps += `          = ${pBA}×${pA} / ${fmt(pB)}\n`;
      steps += `          = ${fmt(pBA * pA)} / ${fmt(pB)}\n`;
      steps += `          = ${fmt(pAB)}`;

      document.getElementById('bt-steps')!.textContent = steps;

      let interpret = `Starting with a prior probability of ${pct(pA)}, `;
      interpret += `after observing event B, the posterior probability updates to ${pct(pAB)}. `;
      if (pAB > pA) {
        interpret += `This is a ${updateFactor.toFixed(1)}x increase from the prior, meaning the evidence strongly supports hypothesis A.`;
      } else if (pAB < pA) {
        interpret += `The posterior is lower than the prior, meaning the evidence actually weakens hypothesis A.`;
      } else {
        interpret += `The posterior equals the prior, meaning the evidence has no effect on hypothesis A.`;
      }

      document.getElementById('bt-interpret')!.textContent = interpret;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.bt-in').forEach(el => {
        el.addEventListener('input', calcBT);
        el.addEventListener('change', calcBT);
      });
      calcBT();
    }, 50);
  </script>
</CalculatorLayout>
