---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Pet Insurance Calculator - Monthly Premium & Break-Even Analysis";
const description = "Estimate monthly pet insurance premiums by species, breed, and age. Calculate annual costs and break-even analysis for your pet's coverage.";
const relatedCalcs = [
  { name: "Pet Cost Calculator", url: "/pet-cost-calculator", description: "Total annual pet ownership costs." },
  { name: "Dog Food Calculator", url: "/dog-food-calculator", description: "Daily food portions for dogs." },
  { name: "Cat Food Calculator", url: "/cat-food-calculator", description: "Daily calories for cats." },
  { name: "Pet Medication Calculator", url: "/pet-medication-calculator", description: "Medication dosage calculator." },
  { name: "Dog BMI Calculator", url: "/dog-bmi-calculator", description: "Body condition score for dogs." },
  { name: "Flea Treatment Calculator", url: "/flea-treatment-calculator", description: "Flea treatment costs." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Pet Insurance Calculator" keywords="pet insurance calculator, dog insurance cost, cat insurance, pet insurance premium, break-even, annual cost" breadcrumbs={[{ name: "Pet Insurance", url: "/pet-insurance-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Pet Insurance Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate monthly premiums, annual costs, and see when insurance pays for itself with break-even analysis.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Pet Species</label>
            <select id="pi-species" class="pi-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="dog" selected>Dog</option>
              <option value="cat">Cat</option>
              <option value="rabbit">Rabbit</option>
              <option value="bird">Bird</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Breed Risk</label>
            <select id="pi-breed" class="pi-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="low">Low Risk (mixed breed)</option>
              <option value="moderate" selected>Moderate Risk</option>
              <option value="high">High Risk (brachycephalic, large)</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Pet Age (years)</label>
            <input type="number" id="pi-age" class="pi-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3" min="0" max="20" step="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Coverage Level</label>
            <select id="pi-coverage" class="pi-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="accident">Accident Only</option>
              <option value="basic" selected>Accident + Illness</option>
              <option value="comprehensive">Comprehensive</option>
              <option value="wellness">Comprehensive + Wellness</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Deductible ($)</label>
            <select id="pi-deductible" class="pi-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="100">$100</option>
              <option value="250" selected>$250</option>
              <option value="500">$500</option>
              <option value="1000">$1,000</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Reimbursement %</label>
            <select id="pi-reimburse" class="pi-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="70">70%</option>
              <option value="80" selected>80%</option>
              <option value="90">90%</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Monthly Premium</div>
          <div class="text-5xl font-extrabold font-mono" id="pi-result">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Annual Cost</div><div class="text-xl font-bold font-mono" id="pi-annual">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Break-Even Vet Bill</div><div class="text-xl font-bold font-mono" id="pi-breakeven">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Lifetime Cost</div><div class="text-xl font-bold font-mono" id="pi-lifetime">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">5-Year Cost</div><div class="text-xl font-bold font-mono" id="pi-5yr">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Avg Vet Visit / Yr</div><div class="text-xl font-bold font-mono" id="pi-avgvet">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="pet-insurance" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcPI() {
      const species = (document.getElementById('pi-species') as HTMLSelectElement).value;
      const breed = (document.getElementById('pi-breed') as HTMLSelectElement).value;
      const age = parseInt((document.getElementById('pi-age') as HTMLInputElement).value) || 3;
      const coverage = (document.getElementById('pi-coverage') as HTMLSelectElement).value;
      const deductible = parseInt((document.getElementById('pi-deductible') as HTMLSelectElement).value) || 250;
      const reimburse = parseInt((document.getElementById('pi-reimburse') as HTMLSelectElement).value) || 80;

      // Base monthly premium by species
      const basePremium: Record<string, number> = { dog: 45, cat: 28, rabbit: 18, bird: 12 };
      let premium = basePremium[species] || 35;

      // Breed risk multiplier
      const breedMult: Record<string, number> = { low: 0.85, moderate: 1.0, high: 1.4 };
      premium *= breedMult[breed] || 1.0;

      // Age multiplier (increases with age)
      const ageMult = 1 + Math.max(0, age - 2) * 0.08;
      premium *= ageMult;

      // Coverage multiplier
      const coverageMult: Record<string, number> = { accident: 0.5, basic: 1.0, comprehensive: 1.4, wellness: 1.8 };
      premium *= coverageMult[coverage] || 1.0;

      // Deductible adjustment (higher deductible = lower premium)
      const deductMult: Record<number, number> = { 100: 1.3, 250: 1.0, 500: 0.8, 1000: 0.6 };
      premium *= deductMult[deductible] || 1.0;

      // Reimbursement adjustment
      const reimbMult: Record<number, number> = { 70: 0.85, 80: 1.0, 90: 1.2 };
      premium *= reimbMult[reimburse] || 1.0;

      const annualCost = premium * 12;
      const breakEven = deductible + (annualCost / (reimburse / 100));

      // Lifetime estimate (avg remaining years)
      const lifespans: Record<string, number> = { dog: 12, cat: 15, rabbit: 10, bird: 20 };
      const remaining = Math.max(1, (lifespans[species] || 12) - age);
      const lifetimeCost = annualCost * remaining;
      const fiveYearCost = annualCost * Math.min(5, remaining);

      // Average vet cost per year
      const avgVet: Record<string, number> = { dog: 700, cat: 500, rabbit: 350, bird: 300 };

      document.getElementById('pi-result')!.textContent = '$' + premium.toFixed(0);
      document.getElementById('pi-annual')!.textContent = '$' + annualCost.toFixed(0);
      document.getElementById('pi-breakeven')!.textContent = '$' + breakEven.toFixed(0);
      document.getElementById('pi-lifetime')!.textContent = '$' + Math.round(lifetimeCost).toLocaleString();
      document.getElementById('pi-5yr')!.textContent = '$' + Math.round(fiveYearCost).toLocaleString();
      document.getElementById('pi-avgvet')!.textContent = '$' + (avgVet[species] || 500);
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.pi-in').forEach(el => { el.addEventListener('input', calcPI); el.addEventListener('change', calcPI); });
      calcPI();
    }, 50);
  </script>
</CalculatorLayout>
