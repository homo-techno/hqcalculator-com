---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Stoichiometry Calculator";
const description = "Calculate reactant and product amounts using molar ratios in chemical reactions.";
const relatedCalcs = [
  { name: "Mole Calculator", url: "/mole-calculator", description: "Moles." },
  { name: "Molarity", url: "/molarity-calculator", description: "Molarity." },
  { name: "Dilution", url: "/dilution-calculator", description: "Dilution." },
  { name: "Ideal Gas Law", url: "/ideal-gas-law-calculator", description: "Gas." },
  { name: "pH Calculator", url: "/ph-calculator", description: "pH." },
  { name: "Percentage", url: "/percentage-calculator", description: "Percentage." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Stoichiometry Calculator" keywords="stoichiometry, molar ratio, chemical reaction, limiting reagent, reactants, products" breadcrumbs={[{ name: "Stoichiometry", url: "/stoichiometry-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Stoichiometry Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate amounts using molar ratios.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Substance A (known)</h3>
          <div class="grid grid-cols-3 gap-2">
            <div><label class="block text-xs text-text-muted">Mass (g)</label><input type="number" id="sc-massA" class="sc-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="36" step="0.1"></div>
            <div><label class="block text-xs text-text-muted">Molar Mass (g/mol)</label><input type="number" id="sc-mmA" class="sc-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="18.015" step="0.001"></div>
            <div><label class="block text-xs text-text-muted">Coefficient</label><input type="number" id="sc-coefA" class="sc-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="2" min="1" step="1"></div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Substance B (find)</h3>
          <div class="grid grid-cols-2 gap-2">
            <div><label class="block text-xs text-text-muted">Molar Mass (g/mol)</label><input type="number" id="sc-mmB" class="sc-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="32" step="0.001"></div>
            <div><label class="block text-xs text-text-muted">Coefficient</label><input type="number" id="sc-coefB" class="sc-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="1" min="1" step="1"></div>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Mass of B</div>
          <div class="text-5xl font-extrabold font-mono" id="sc-result">0 g</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Moles A</div><div class="text-lg font-bold font-mono" id="sc-molesA">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Moles B</div><div class="text-lg font-bold font-mono" id="sc-molesB">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Molar Ratio</div><div class="text-lg font-bold font-mono" id="sc-ratio">0</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Steps</h3>
          <div class="text-xs space-y-1" id="sc-steps"></div>
        </div>
      </div>
      <ShareButton calculatorId="stoichiometry" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcSC() {
      const massA = parseFloat((document.getElementById('sc-massA') as HTMLInputElement).value) || 0;
      const mmA = parseFloat((document.getElementById('sc-mmA') as HTMLInputElement).value) || 1;
      const coefA = parseInt((document.getElementById('sc-coefA') as HTMLInputElement).value) || 1;
      const mmB = parseFloat((document.getElementById('sc-mmB') as HTMLInputElement).value) || 1;
      const coefB = parseInt((document.getElementById('sc-coefB') as HTMLInputElement).value) || 1;
      const molesA = massA / mmA;
      const molesB = molesA * (coefB / coefA);
      const massB = molesB * mmB;
      document.getElementById('sc-result')!.textContent = massB.toFixed(4) + ' g';
      document.getElementById('sc-molesA')!.textContent = molesA.toFixed(4) + ' mol';
      document.getElementById('sc-molesB')!.textContent = molesB.toFixed(4) + ' mol';
      document.getElementById('sc-ratio')!.textContent = `${coefA}:${coefB}`;
      const steps = [
        `<div>1. Moles A = ${massA}g / ${mmA} g/mol = ${molesA.toFixed(4)} mol</div>`,
        `<div>2. Moles B = ${molesA.toFixed(4)} × (${coefB}/${coefA}) = ${molesB.toFixed(4)} mol</div>`,
        `<div>3. Mass B = ${molesB.toFixed(4)} × ${mmB} g/mol = <strong>${massB.toFixed(4)} g</strong></div>`,
      ];
      document.getElementById('sc-steps')!.innerHTML = steps.join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.sc-in').forEach(el => { el.addEventListener('input', calcSC); el.addEventListener('change', calcSC); });
      calcSC();
    }, 50);
  </script>
</CalculatorLayout>
