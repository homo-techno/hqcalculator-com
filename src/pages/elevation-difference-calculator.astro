---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Elevation Difference Calculator - Trigonometric Leveling";
const description = "Calculate elevation difference using trigonometric leveling with vertical angle, slope distance, instrument height, and target height.";
const relatedCalcs = [
  { name: "Leveling Calculator", url: "/leveling-calculator", description: "Differential leveling." },
  { name: "Total Station", url: "/total-station-calculator", description: "Total station calculations." },
  { name: "Slope Grade", url: "/slope-grade-calculator", description: "Slope conversions." },
  { name: "Topographic Profile", url: "/topographic-profile-calculator", description: "Profile generation." },
  { name: "Vertical Curve", url: "/vertical-curve-calculator", description: "Vertical curve design." },
  { name: "Cut & Fill", url: "/cut-fill-calculator", description: "Earthwork volumes." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Elevation Difference Calculator" keywords="elevation difference, trigonometric leveling, stadia, vertical angle, slope distance, survey elevation" breadcrumbs={[{ name: "Elevation Difference Calculator", url: "/elevation-difference-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Elevation Difference Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Compute elevation difference from trigonometric leveling observations.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Slope Distance (ft)</label>
          <input type="number" id="ed2-sd" class="ed2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="500" step="0.1">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Vertical Angle (degrees, + up / - down)</label>
          <input type="number" id="ed2-va" class="ed2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5.5" step="0.01">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-text mb-1">Instrument Height (ft)</label>
            <input type="number" id="ed2-hi" class="ed2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5.2" step="0.01">
          </div>
          <div>
            <label class="block text-sm font-semibold text-text mb-1">Target/Prism Height (ft)</label>
            <input type="number" id="ed2-ht" class="ed2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5.2" step="0.01">
          </div>
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Known Elevation of Instrument Point (ft)</label>
          <input type="number" id="ed2-elev" class="ed2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="100" step="0.01">
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Elevation Difference</div>
          <div class="text-5xl font-extrabold font-mono" id="ed2-diff">--</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Target Elevation</div>
            <div class="text-xl font-bold" id="ed2-target">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Horizontal Distance</div>
            <div class="text-xl font-bold" id="ed2-hd">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Vertical Component</div>
            <div class="text-xl font-bold" id="ed2-vc">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Earth Curvature + Refraction</div>
            <div class="text-xl font-bold" id="ed2-cr">--</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="elevation-difference" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Trigonometric Leveling Formula</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p>dElev = SD * sin(VA) + HI - HT + C&R</p>
        <p>HD = SD * cos(VA)</p>
        <p>C&R = 0.0206 * (HD/1000)^2 (in feet, for miles: 0.574 * M^2)</p>
      </div>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcED2() {
      const sd = parseFloat((document.getElementById('ed2-sd') as HTMLInputElement).value) || 0;
      const va = parseFloat((document.getElementById('ed2-va') as HTMLInputElement).value) || 0;
      const hi = parseFloat((document.getElementById('ed2-hi') as HTMLInputElement).value) || 0;
      const ht = parseFloat((document.getElementById('ed2-ht') as HTMLInputElement).value) || 0;
      const elev = parseFloat((document.getElementById('ed2-elev') as HTMLInputElement).value) || 0;
      const vaRad = va * Math.PI / 180;
      const hd = sd * Math.cos(vaRad);
      const vc = sd * Math.sin(vaRad);
      const miles = hd / 5280;
      const cr = 0.574 * miles * miles * 0.07;
      const diff = vc + hi - ht + cr;
      const targetElev = elev + diff;
      document.getElementById('ed2-diff')!.textContent = diff.toFixed(3) + ' ft';
      document.getElementById('ed2-target')!.textContent = targetElev.toFixed(3) + ' ft';
      document.getElementById('ed2-hd')!.textContent = hd.toFixed(3) + ' ft';
      document.getElementById('ed2-vc')!.textContent = vc.toFixed(3) + ' ft';
      document.getElementById('ed2-cr')!.textContent = cr.toFixed(4) + ' ft';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ed2-in').forEach(el => { el.addEventListener('input', calcED2); el.addEventListener('change', calcED2); });
      calcED2();
    }, 50);
  </script>
</CalculatorLayout>
