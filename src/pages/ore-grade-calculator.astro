---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Ore Grade Calculator - Metal Content & Cutoff Grade";
const description = "Calculate ore grade percentage, metal content per ton, cutoff grade, in-situ value, and recovery rate for mining operations.";
const relatedCalcs = [
  { name: "Density Calculator", url: "/density-calculator", description: "Calculate material density." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage math." },
  { name: "Excavation Calculator", url: "/excavation-calculator", description: "Earthwork volumes." },
  { name: "Gravel Calculator", url: "/gravel-calculator", description: "Material tonnage." },
  { name: "Weight Converter", url: "/weight-converter", description: "Weight unit conversion." },
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Ore Grade Calculator" keywords="ore grade calculator, metal content, cutoff grade, in-situ value, mining calculator, recovery rate" breadcrumbs={[{ name: "Ore Grade", url: "/ore-grade-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Ore Grade Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate ore grade, metal content per ton, cutoff grade, in-situ value, and expected recovery for mining evaluations.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Metal Type</label>
          <select id="og-metal" class="og-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="gold">Gold (Au)</option>
            <option value="silver">Silver (Ag)</option>
            <option value="copper">Copper (Cu)</option>
            <option value="iron">Iron (Fe)</option>
            <option value="zinc">Zinc (Zn)</option>
            <option value="nickel">Nickel (Ni)</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Ore Tonnage (tonnes)</label>
            <input type="number" id="og-tonnage" class="og-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="100000" min="0" step="1000">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Grade (g/t or %)</label>
            <input type="number" id="og-grade" class="og-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="2.5" min="0" step="0.01">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Recovery Rate (%)</label>
            <input type="number" id="og-recovery" class="og-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="90" min="0" max="100" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Metal Price ($/unit)</label>
            <input type="number" id="og-price" class="og-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="60" min="0" step="0.01">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Processing Cost ($/tonne)</label>
            <input type="number" id="og-process" class="og-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="25" min="0" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Mining Cost ($/tonne)</label>
            <input type="number" id="og-miningcost" class="og-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="15" min="0" step="1">
          </div>
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Contained Metal</div>
          <div class="text-4xl font-extrabold" id="og-contained">0</div>
          <div class="text-sm text-blue-200 mt-1" id="og-unit-label">grams</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Recoverable Metal</div>
            <div class="text-xl font-bold" id="og-recoverable">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">In-Situ Value</div>
            <div class="text-xl font-bold text-secondary" id="og-insitu">$0</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Net Value</div>
            <div class="text-xl font-bold" id="og-netvalue">$0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Cutoff Grade</div>
            <div class="text-xl font-bold" id="og-cutoff">0</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Revenue per Tonne</div>
          <div class="text-xl font-bold" id="og-pertonne">$0</div>
        </div>
      </div>

      <ShareButton calculatorId="ore-grade" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Ore Grade Is Calculated</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Contained Metal</strong> = Tonnage x Grade</p>
        <p><strong>Recoverable Metal</strong> = Contained Metal x Recovery Rate</p>
        <p><strong>In-Situ Value</strong> = Recoverable Metal x Metal Price</p>
        <p><strong>Cutoff Grade</strong> = Total Costs / (Metal Price x Recovery)</p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">Understanding Ore Grade</h3>
      <p>Ore grade measures the concentration of a valuable mineral in rock. For precious metals like gold and silver, grades are expressed in grams per tonne (g/t). For base metals like copper and iron, grades are expressed as a percentage of the ore weight.</p>
      <p>The cutoff grade is the minimum grade that can be mined economically, below which the cost of extraction exceeds the value of the metal recovered.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcOG() {
      const metal = (document.getElementById('og-metal') as HTMLSelectElement).value;
      const tonnage = parseFloat((document.getElementById('og-tonnage') as HTMLInputElement).value) || 0;
      const grade = parseFloat((document.getElementById('og-grade') as HTMLInputElement).value) || 0;
      const recovery = (parseFloat((document.getElementById('og-recovery') as HTMLInputElement).value) || 0) / 100;
      const price = parseFloat((document.getElementById('og-price') as HTMLInputElement).value) || 0;
      const processCost = parseFloat((document.getElementById('og-process') as HTMLInputElement).value) || 0;
      const miningCost = parseFloat((document.getElementById('og-miningcost') as HTMLInputElement).value) || 0;

      const preciousMetals = ['gold', 'silver'];
      const isPrecious = preciousMetals.includes(metal);

      let contained: number;
      let unitLabel: string;
      if (isPrecious) {
        contained = tonnage * grade;
        unitLabel = 'grams';
      } else {
        contained = tonnage * (grade / 100);
        unitLabel = 'tonnes';
      }

      const recoverable = contained * recovery;
      let insitu: number;
      if (isPrecious) {
        insitu = (recoverable / 31.1035) * price;
      } else {
        insitu = recoverable * price;
      }

      const totalCosts = (processCost + miningCost) * tonnage;
      const netValue = insitu - totalCosts;
      const revenuePerTonne = tonnage > 0 ? insitu / tonnage : 0;

      let cutoff: number;
      if (isPrecious) {
        cutoff = recovery > 0 && price > 0 ? ((processCost + miningCost) * 31.1035) / (price * recovery) : 0;
      } else {
        cutoff = recovery > 0 && price > 0 ? ((processCost + miningCost) / (price * recovery)) * 100 : 0;
      }

      const fmt = (n: number) => n.toLocaleString('en-US', { maximumFractionDigits: 2 });

      document.getElementById('og-contained')!.textContent = fmt(contained);
      document.getElementById('og-unit-label')!.textContent = unitLabel;
      document.getElementById('og-recoverable')!.textContent = fmt(recoverable) + ' ' + unitLabel;
      document.getElementById('og-insitu')!.textContent = '$' + fmt(insitu);
      document.getElementById('og-netvalue')!.textContent = (netValue >= 0 ? '$' : '-$') + fmt(Math.abs(netValue));
      document.getElementById('og-cutoff')!.textContent = isPrecious ? fmt(cutoff) + ' g/t' : fmt(cutoff) + '%';
      document.getElementById('og-pertonne')!.textContent = '$' + fmt(revenuePerTonne);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.og-in').forEach(el => { el.addEventListener('input', calcOG); el.addEventListener('change', calcOG); });
      calcOG();
    }, 50);
  </script>
</CalculatorLayout>
