---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Sports Betting Odds Calculator";
const description = "Convert between American, decimal, and fractional odds. Calculate implied probability, payouts, and expected value.";
const relatedCalcs = [
  { name: "Probability", url: "/probability-calculator", description: "Probability." },
  { name: "Percentage", url: "/percentage-calculator", description: "Percentage." },
  { name: "ROI Calculator", url: "/roi-calculator", description: "ROI." },
  { name: "Profit Margin", url: "/profit-margin-calculator", description: "Margin." },
  { name: "Dice Roller", url: "/dice-roller", description: "Dice." },
  { name: "Random Number", url: "/random-number-generator", description: "Random." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Sports Betting Calculator" keywords="betting odds calculator, American odds, decimal odds, fractional odds, implied probability, payout" breadcrumbs={[{ name: "Betting Odds", url: "/sports-betting-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Sports Betting Odds Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert odds formats and calculate payouts.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="flex gap-2">
          <button class="sb-fmt flex-1 py-2 rounded-xl font-bold text-sm border-2 border-primary bg-blue-50 text-primary" data-fmt="american">American</button>
          <button class="sb-fmt flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-fmt="decimal">Decimal</button>
          <button class="sb-fmt flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-fmt="fractional">Fractional</button>
        </div>
        <div id="sb-american-wrap">
          <label class="block text-xs font-medium text-text mb-1">American Odds (e.g. -110, +250)</label>
          <input type="number" id="sb-american" class="sb-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="-110">
        </div>
        <div id="sb-decimal-wrap" class="hidden">
          <label class="block text-xs font-medium text-text mb-1">Decimal Odds</label>
          <input type="number" id="sb-decimal" class="sb-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="1.91" min="1" step="0.01">
        </div>
        <div id="sb-frac-wrap" class="hidden">
          <label class="block text-xs font-medium text-text mb-1">Fractional Odds (e.g. 5/2)</label>
          <div class="flex gap-2 items-center">
            <input type="number" id="sb-fn" class="sb-in flex-1 px-3 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="5" min="1" step="1">
            <span class="text-2xl font-bold">/</span>
            <input type="number" id="sb-fd" class="sb-in flex-1 px-3 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="2" min="1" step="1">
          </div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Bet Amount ($)</label><input type="number" id="sb-bet" class="sb-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="100" min="1" step="10"></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Payout</div>
          <div class="text-5xl font-extrabold font-mono" id="sb-result">$0</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Profit</div><div class="text-xl font-bold font-mono" id="sb-profit">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Implied Prob</div><div class="text-xl font-bold font-mono" id="sb-prob">0%</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Decimal Odds</div><div class="text-xl font-bold font-mono" id="sb-dec">0</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">American</div><div class="text-xl font-bold font-mono" id="sb-amer">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Fractional</div><div class="text-xl font-bold font-mono" id="sb-frac">0/1</div></div>
        </div>
      </div>
      <ShareButton calculatorId="sports-betting" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    let sbFmt = 'american';
    function gcd(a: number, b: number): number { return b === 0 ? a : gcd(b, a % b); }
    function calcSB() {
      const bet = parseFloat((document.getElementById('sb-bet') as HTMLInputElement).value) || 100;
      let decimal = 1;
      if (sbFmt === 'american') {
        const amer = parseFloat((document.getElementById('sb-american') as HTMLInputElement).value) || 0;
        if (amer > 0) decimal = amer / 100 + 1;
        else if (amer < 0) decimal = 100 / Math.abs(amer) + 1;
      } else if (sbFmt === 'decimal') {
        decimal = parseFloat((document.getElementById('sb-decimal') as HTMLInputElement).value) || 1;
      } else {
        const fn = parseFloat((document.getElementById('sb-fn') as HTMLInputElement).value) || 1;
        const fd = parseFloat((document.getElementById('sb-fd') as HTMLInputElement).value) || 1;
        decimal = fn / fd + 1;
      }
      const payout = bet * decimal;
      const profit = payout - bet;
      const impliedProb = decimal > 0 ? (1 / decimal) * 100 : 0;
      let american: string;
      if (decimal >= 2) american = '+' + Math.round((decimal - 1) * 100);
      else american = '-' + Math.round(100 / (decimal - 1));
      const fracVal = decimal - 1;
      const fracMult = 100;
      const fn = Math.round(fracVal * fracMult);
      const g = gcd(fn, fracMult);
      const fracStr = `${fn / g}/${fracMult / g}`;
      document.getElementById('sb-result')!.textContent = '$' + payout.toFixed(2);
      document.getElementById('sb-profit')!.textContent = '$' + profit.toFixed(2);
      document.getElementById('sb-prob')!.textContent = impliedProb.toFixed(1) + '%';
      document.getElementById('sb-dec')!.textContent = decimal.toFixed(2);
      document.getElementById('sb-amer')!.textContent = american;
      document.getElementById('sb-frac')!.textContent = fracStr;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.sb-fmt').forEach(b => b.addEventListener('click', () => {
        sbFmt = (b as HTMLButtonElement).dataset.fmt!;
        document.querySelectorAll('.sb-fmt').forEach(btn => {
          const active = (btn as HTMLButtonElement).dataset.fmt === sbFmt;
          (btn as HTMLButtonElement).className = `sb-fmt flex-1 py-2 rounded-xl font-bold text-sm border-2 ${active ? 'border-primary bg-blue-50 text-primary' : 'border-border text-text-muted'}`;
        });
        document.getElementById('sb-american-wrap')!.classList.toggle('hidden', sbFmt !== 'american');
        document.getElementById('sb-decimal-wrap')!.classList.toggle('hidden', sbFmt !== 'decimal');
        document.getElementById('sb-frac-wrap')!.classList.toggle('hidden', sbFmt !== 'fractional');
        calcSB();
      }));
      document.querySelectorAll('.sb-in').forEach(el => { el.addEventListener('input', calcSB); el.addEventListener('change', calcSB); });
      calcSB();
    }, 50);
  </script>
</CalculatorLayout>
