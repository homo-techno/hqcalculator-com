---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Bandwidth Calculator - Network Bandwidth Requirements 2026";
const description = "Calculate network bandwidth requirements based on number of users, applications, and usage patterns. Plan your network capacity for optimal performance.";

const relatedCalcs = [
  { name: "Data Transfer Calculator", url: "/data-transfer-calculator", description: "File transfer time estimation." },
  { name: "Network Throughput Calculator", url: "/network-throughput-calculator", description: "TCP throughput calculation." },
  { name: "VoIP Bandwidth Calculator", url: "/voip-bandwidth-calculator", description: "VoIP call bandwidth needs." },
  { name: "Network Latency Calculator", url: "/network-latency-calculator", description: "Round-trip latency estimation." },
  { name: "Ethernet Cable Calculator", url: "/ethernet-cable-calculator", description: "Ethernet cable specifications." },
  { name: "Network Availability Calculator", url: "/network-availability-calculator", description: "Uptime/downtime calculation." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Bandwidth Calculator"
  keywords="bandwidth calculator, network bandwidth, bandwidth requirements, internet speed, network planning, capacity planning"
  breadcrumbs={[{ name: "Bandwidth Calculator", url: "/bandwidth-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Bandwidth Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate the total bandwidth your network needs based on users, applications, and concurrent usage.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Number of Users</label>
        <input type="number" id="bwc-users" class="bwc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="50" step="1" min="1">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Concurrency Ratio (%)</label>
        <input type="number" id="bwc-concurrency" class="bwc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="70" step="1" min="1" max="100">
        <p class="text-xs text-text-muted mt-1">Percentage of users active at the same time</p>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Usage Profile</label>
        <select id="bwc-profile" class="bwc-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="light">Light (email, web) - 1 Mbps/user</option>
          <option value="medium" selected>Medium (streaming, video calls) - 5 Mbps/user</option>
          <option value="heavy">Heavy (HD video, large files) - 15 Mbps/user</option>
          <option value="ultra">Ultra (4K video, cloud gaming) - 50 Mbps/user</option>
          <option value="custom">Custom (specify below)</option>
        </select>
      </div>

      <div class="mb-4" id="bwc-custom-wrap" style="display:none;">
        <label class="block text-sm font-medium text-text mb-1">Bandwidth per User (Mbps)</label>
        <input type="number" id="bwc-custom-bw" class="bwc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" step="0.1" min="0.1">
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-text mb-1">Overhead Factor (%)</label>
        <input type="number" id="bwc-overhead" class="bwc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" step="1" min="0" max="100">
        <p class="text-xs text-text-muted mt-1">Protocol overhead, management traffic, headroom</p>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm font-medium text-blue-100 mb-1">Recommended Bandwidth</div>
        <div class="text-4xl font-extrabold" id="bwc-result">--</div>
        <div class="text-sm text-blue-200 mt-1" id="bwc-result-unit">Mbps</div>
      </div>

      <!-- Secondary Stats -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Active Users</div>
          <div class="text-xl font-bold text-text" id="bwc-active">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Per-User Rate</div>
          <div class="text-xl font-bold text-text" id="bwc-per-user">--</div>
          <div class="text-xs text-text-muted">Mbps</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Base Bandwidth</div>
          <div class="text-xl font-bold text-text" id="bwc-base">--</div>
          <div class="text-xs text-text-muted">Mbps</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Overhead Added</div>
          <div class="text-xl font-bold text-text" id="bwc-overhead-val">--</div>
          <div class="text-xs text-text-muted">Mbps</div>
        </div>
      </div>

      <ShareButton calculatorId="bandwidth" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">How to Estimate Network Bandwidth</h2>
      <p>Network bandwidth planning requires understanding how many users will be active simultaneously and what applications they will use.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono text-sm">
        Required BW = Users x Concurrency x BW_per_user x (1 + Overhead)
      </div>
      <p>A concurrency ratio of 60-80% is typical for office environments. Add 20-30% overhead for protocol efficiency, management traffic, and growth headroom.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcBWC() {
      const users = parseFloat((document.getElementById('bwc-users') as HTMLInputElement).value) || 1;
      const concurrency = (parseFloat((document.getElementById('bwc-concurrency') as HTMLInputElement).value) || 70) / 100;
      const profile = (document.getElementById('bwc-profile') as HTMLSelectElement).value;
      const overhead = (parseFloat((document.getElementById('bwc-overhead') as HTMLInputElement).value) || 20) / 100;

      const profileBW: Record<string, number> = { light: 1, medium: 5, heavy: 15, ultra: 50 };
      let bwPerUser = profileBW[profile] || 5;
      if (profile === 'custom') {
        bwPerUser = parseFloat((document.getElementById('bwc-custom-bw') as HTMLInputElement).value) || 10;
      }
      document.getElementById('bwc-custom-wrap')!.style.display = profile === 'custom' ? '' : 'none';

      const activeUsers = Math.ceil(users * concurrency);
      const baseBW = activeUsers * bwPerUser;
      const overheadBW = baseBW * overhead;
      const totalBW = baseBW + overheadBW;

      let displayBW = totalBW.toFixed(1);
      let unit = 'Mbps';
      if (totalBW >= 1000) {
        displayBW = (totalBW / 1000).toFixed(2);
        unit = 'Gbps';
      }

      document.getElementById('bwc-result')!.textContent = displayBW;
      document.getElementById('bwc-result-unit')!.textContent = unit;
      document.getElementById('bwc-active')!.textContent = activeUsers.toString();
      document.getElementById('bwc-per-user')!.textContent = bwPerUser.toFixed(1);
      document.getElementById('bwc-base')!.textContent = baseBW.toFixed(1);
      document.getElementById('bwc-overhead-val')!.textContent = overheadBW.toFixed(1);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.bwc-in').forEach(el => { el.addEventListener('input', calcBWC); el.addEventListener('change', calcBWC); });
      calcBWC();
    }, 50);
  </script>
</CalculatorLayout>
