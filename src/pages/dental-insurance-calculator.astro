---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Dental Insurance Calculator";
const description = "Analyze dental insurance value: compare annual premiums vs expected usage, procedure coverage levels, waiting periods, and ROI.";
const relatedCalcs = [
  { name: "Dental Implant Cost Calculator", url: "/dental-implant-cost-calculator", description: "Implant cost estimates." },
  { name: "Dental Crown Calculator", url: "/dental-crown-calculator", description: "Crown cost by material." },
  { name: "Root Canal Calculator", url: "/root-canal-calculator", description: "Root canal treatment cost." },
  { name: "Braces Cost Calculator", url: "/braces-cost-calculator", description: "Orthodontic treatment costs." },
  { name: "Health Insurance Calculator", url: "/health-insurance-calculator", description: "Health plan cost comparison." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Plan your monthly budget." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Dental Insurance Calculator" keywords="dental insurance calculator, dental plan ROI, dental insurance worth it, dental coverage analysis, annual maximum benefit" breadcrumbs={[{ name: "Dental Insurance", url: "/dental-insurance-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Dental Insurance Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Determine if dental insurance is worth it by comparing premiums to expected treatment costs.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Monthly Premium ($)</label><input type="number" id="ds2-prem" class="ds2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="35" min="0" max="200" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Annual Maximum Benefit ($)</label><input type="number" id="ds2-max" class="ds2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1500" min="500" max="5000" step="100"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Deductible ($)</label><input type="number" id="ds2-ded" class="ds2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="50" min="0" max="500" step="10"></div>
        <div class="p-3 bg-blue-50 rounded-xl text-center text-xs font-semibold text-blue-900 uppercase tracking-wide">Expected Annual Procedures</div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Cleanings (covered at %)</label><input type="number" id="ds2-clean" class="ds2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="0" max="4" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">X-Rays (sets)</label><input type="number" id="ds2-xray" class="ds2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="0" max="4" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Fillings Expected</label><input type="number" id="ds2-fill" class="ds2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="0" max="10" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Crowns Expected</label><input type="number" id="ds2-crown" class="ds2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0" min="0" max="5" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Root Canals Expected</label><input type="number" id="ds2-rct" class="ds2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0" min="0" max="3" step="1"></div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Waiting Period Status</label>
            <select id="ds2-wait" class="ds2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="none" selected>No Waiting Period</option>
              <option value="basic">6-mo Wait (Basic)</option>
              <option value="major">12-mo Wait (Major)</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Annual ROI (Savings vs Premium)</div>
          <div class="text-5xl font-extrabold font-mono" id="ds2-roi">$0</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Annual Premium</div><div class="text-xl font-bold font-mono" id="ds2-annual">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Treatment</div><div class="text-xl font-bold font-mono" id="ds2-treat">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Insurance Pays</div><div class="text-xl font-bold font-mono" id="ds2-pays">$0</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">With Insurance OOP</div><div class="text-xl font-bold font-mono" id="ds2-woop">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Verdict</div><div class="text-xl font-bold font-mono" id="ds2-verdict">-</div></div>
        </div>
      </div>
      <ShareButton calculatorId="dental-insurance" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcDS2() {
      const premium = parseFloat((document.getElementById('ds2-prem') as HTMLInputElement).value) || 0;
      const maxBenefit = parseFloat((document.getElementById('ds2-max') as HTMLInputElement).value) || 1500;
      const deductible = parseFloat((document.getElementById('ds2-ded') as HTMLInputElement).value) || 0;
      const cleanings = parseFloat((document.getElementById('ds2-clean') as HTMLInputElement).value) || 0;
      const xrays = parseFloat((document.getElementById('ds2-xray') as HTMLInputElement).value) || 0;
      const fillings = parseFloat((document.getElementById('ds2-fill') as HTMLInputElement).value) || 0;
      const crowns = parseFloat((document.getElementById('ds2-crown') as HTMLInputElement).value) || 0;
      const rcts = parseFloat((document.getElementById('ds2-rct') as HTMLInputElement).value) || 0;
      const waitPeriod = (document.getElementById('ds2-wait') as HTMLSelectElement).value;

      const annualPremium = premium * 12;

      // Typical procedure costs (without insurance)
      const cleaningCost = 150; // per cleaning
      const xrayCost = 75; // per set
      const fillingCost = 225; // composite
      const crownCost = 1100;
      const rctCost = 1000;

      // Coverage percentages (typical 100/80/50)
      const preventiveCov = 1.0; // 100%
      const basicCov = 0.80;     // 80%
      const majorCov = 0.50;     // 50%

      const totalTreatment = (cleanings * cleaningCost) + (xrays * xrayCost) +
                             (fillings * fillingCost) + (crowns * crownCost) + (rcts * rctCost);

      // Insurance pays
      let preventivePay = (cleanings * cleaningCost + xrays * xrayCost) * preventiveCov;
      let basicPay = (fillings * fillingCost) * basicCov;
      let majorPay = (crowns * crownCost + rcts * rctCost) * majorCov;

      // Waiting period adjustments
      if (waitPeriod === 'basic') basicPay = 0;
      if (waitPeriod === 'basic' || waitPeriod === 'major') majorPay = 0;

      let totalInsPays = preventivePay + basicPay + majorPay;
      // Subtract deductible
      totalInsPays = Math.max(0, totalInsPays - deductible);
      // Cap at annual max
      totalInsPays = Math.min(totalInsPays, maxBenefit);

      const withInsOOP = annualPremium + (totalTreatment - totalInsPays);
      const roi = totalInsPays - annualPremium;

      let verdict: string;
      if (roi > 200) verdict = 'Worth It';
      else if (roi > 0) verdict = 'Marginal Benefit';
      else if (roi > -100) verdict = 'Break Even';
      else verdict = 'Not Worth It';

      document.getElementById('ds2-roi')!.textContent = (roi >= 0 ? '+$' : '-$') + Math.abs(Math.round(roi)).toLocaleString();
      document.getElementById('ds2-annual')!.textContent = '$' + annualPremium.toLocaleString();
      document.getElementById('ds2-treat')!.textContent = '$' + Math.round(totalTreatment).toLocaleString();
      document.getElementById('ds2-pays')!.textContent = '$' + Math.round(totalInsPays).toLocaleString();
      document.getElementById('ds2-woop')!.textContent = '$' + Math.round(withInsOOP).toLocaleString();
      document.getElementById('ds2-verdict')!.textContent = verdict;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ds2-in').forEach(el => { el.addEventListener('input', calcDS2); el.addEventListener('change', calcDS2); });
      calcDS2();
    }, 50);
  </script>
</CalculatorLayout>
