---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Slot Machine Calculator - RTP, Volatility & Bankroll";
const description = "Calculate slot machine RTP, expected loss per session, volatility index, and how long your bankroll will last at different bet levels.";
const relatedCalcs = [
  { name: "Probability Calculator", url: "/probability-calculator", description: "Event probability." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage math." },
  { name: "Average Calculator", url: "/average-calculator", description: "Calculate averages." },
  { name: "Statistics Calculator", url: "/statistics-calculator", description: "Statistical tools." },
  { name: "Break Even Calculator", url: "/break-even-calculator", description: "Break-even point." },
  { name: "Compound Interest", url: "/compound-interest-calculator", description: "Growth analysis." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Slot Machine Calculator" keywords="slot machine calculator, RTP, return to player, slot volatility, bankroll duration, expected loss slots" breadcrumbs={[{ name: "Slot Machine", url: "/slot-machine-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Slot Machine Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Analyze slot machine economics: RTP, expected loss, volatility, and bankroll duration.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-text mb-1">RTP (Return to Player %)</label>
          <input type="number" class="sm3-in w-full px-4 py-3 border border-border rounded-xl text-xl font-bold text-center" id="sm3-rtp" min="50" max="100" step="0.1" value="96">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-text mb-1">Bet per Spin ($)</label>
            <input type="number" class="sm3-in w-full px-4 py-3 border border-border rounded-xl text-xl font-bold text-center" id="sm3-bet" min="0.01" step="0.01" value="1.00">
          </div>
          <div>
            <label class="block text-sm font-semibold text-text mb-1">Spins per Hour</label>
            <input type="number" class="sm3-in w-full px-4 py-3 border border-border rounded-xl text-xl font-bold text-center" id="sm3-spins" min="1" max="1200" value="600">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-text mb-1">Session Hours</label>
            <input type="number" class="sm3-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" id="sm3-hours" min="0.5" step="0.5" value="2">
          </div>
          <div>
            <label class="block text-sm font-semibold text-text mb-1">Bankroll ($)</label>
            <input type="number" class="sm3-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" id="sm3-bank" min="1" value="200">
          </div>
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Volatility</label>
          <select class="sm3-in w-full px-4 py-2 border border-border rounded-xl" id="sm3-vol">
            <option value="low">Low (frequent small wins)</option>
            <option value="medium" selected>Medium (balanced)</option>
            <option value="high">High (rare large wins)</option>
          </select>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Expected Loss per Session</div>
          <div class="text-5xl font-extrabold font-mono" id="sm3-loss">--</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">House Edge</div>
            <div class="text-xl font-bold font-mono" id="sm3-edge">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Expected Loss / Hour</div>
            <div class="text-xl font-bold font-mono" id="sm3-hour">--</div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Wagered / Session</div>
            <div class="text-xl font-bold font-mono" id="sm3-wagered">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Bankroll Duration (approx)</div>
            <div class="text-xl font-bold font-mono" id="sm3-duration">--</div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Volatility Index</div>
            <div class="text-xl font-bold font-mono" id="sm3-volindex">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Cost per Spin</div>
            <div class="text-xl font-bold font-mono" id="sm3-costspin">--</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">RTP Comparison</h3>
          <div class="text-xs font-mono space-y-1" id="sm3-table"></div>
        </div>
      </div>
      <ShareButton calculatorId="slot-machine" />
      <FeedbackWidget />
    </div>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcSM3() {
      const rtp = parseFloat((document.getElementById('sm3-rtp') as HTMLInputElement).value) || 96;
      const bet = parseFloat((document.getElementById('sm3-bet') as HTMLInputElement).value) || 1;
      const spinsHr = parseInt((document.getElementById('sm3-spins') as HTMLInputElement).value) || 600;
      const hours = parseFloat((document.getElementById('sm3-hours') as HTMLInputElement).value) || 2;
      const bankroll = parseFloat((document.getElementById('sm3-bank') as HTMLInputElement).value) || 200;
      const vol = (document.getElementById('sm3-vol') as HTMLSelectElement).value;

      const houseEdge = (100 - rtp) / 100;
      const costPerSpin = bet * houseEdge;
      const lossPerHour = costPerSpin * spinsHr;
      const totalSpins = spinsHr * hours;
      const totalWagered = bet * totalSpins;
      const sessionLoss = totalWagered * houseEdge;

      // Volatility standard deviation per spin (approximate)
      const volMultipliers: Record<string, number> = { 'low': 3, 'medium': 6, 'high': 12 };
      const sdPerSpin = bet * (volMultipliers[vol] || 6);
      const volIndex = sdPerSpin / bet;

      // Bankroll duration: approximate using expected loss rate
      const durationHours = lossPerHour > 0 ? bankroll / lossPerHour : Infinity;
      const durationStr = durationHours > 100 ? '100+ hours' : durationHours.toFixed(1) + ' hours';

      document.getElementById('sm3-loss')!.textContent = '-$' + sessionLoss.toFixed(2);
      document.getElementById('sm3-edge')!.textContent = (houseEdge * 100).toFixed(2) + '%';
      document.getElementById('sm3-hour')!.textContent = '-$' + lossPerHour.toFixed(2);
      document.getElementById('sm3-wagered')!.textContent = '$' + totalWagered.toFixed(2);
      document.getElementById('sm3-duration')!.textContent = durationStr;
      document.getElementById('sm3-volindex')!.textContent = volIndex.toFixed(1) + 'x';
      document.getElementById('sm3-costspin')!.textContent = '-$' + costPerSpin.toFixed(4);

      // RTP comparison
      const rtps = [85, 88, 90, 92, 94, 95, 96, 97, 98, 99];
      let html = '';
      for (const r of rtps) {
        const edge = (100 - r) / 100;
        const loss = bet * spinsHr * hours * edge;
        const marker = Math.abs(r - rtp) < 0.5 ? ' font-bold text-primary' : '';
        html += '<div class="flex justify-between py-0.5 border-b border-border' + marker + '"><span>RTP ' + r + '%</span><span>Loss/session: $' + loss.toFixed(2) + ' | Edge: ' + (edge * 100).toFixed(1) + '%</span></div>';
      }
      document.getElementById('sm3-table')!.innerHTML = html;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.sm3-in').forEach(el => { el.addEventListener('input', calcSM3); el.addEventListener('change', calcSM3); });
      calcSM3();
    }, 50);
  </script>
</CalculatorLayout>
