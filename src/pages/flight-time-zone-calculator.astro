---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Flight Time Zone Calculator - Arrival Times & UTC Offset";
const description = "Calculate departure and arrival times across time zones. Handle date line crossing, UTC offsets, and estimate jet lag severity for flight planning.";
const relatedCalcs = [
  { name: "Time Zone", url: "/time-zone-calculator", description: "Time zone converter." },
  { name: "Timezone Converter", url: "/timezone-converter", description: "Convert timezones." },
  { name: "Flight Time", url: "/flight-time-calculator", description: "Flight duration." },
  { name: "Event Countdown", url: "/event-countdown-calculator", description: "Count down events." },
  { name: "Speed Calculator", url: "/speed-calculator", description: "Speed computations." },
  { name: "Bearing Calculator", url: "/bearing-calculator", description: "Bearing angles." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Flight Time Zone Calculator" keywords="flight time zone, arrival time, departure time, UTC offset, date line crossing, jet lag, time zone difference" breadcrumbs={[{ name: "Flight Time Zone", url: "/flight-time-zone-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Flight Time Zone Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Plan departure and arrival times across time zones with jet lag estimation.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label for="fz-deptime" class="block text-sm font-medium text-text mb-1">Departure Time (local, 24hr)</label>
          <input type="time" id="fz-deptime" class="fz-in w-full border border-border rounded-lg px-3 py-2" />
        </div>
        <div>
          <label for="fz-depoff" class="block text-sm font-medium text-text mb-1">Departure UTC Offset (hours)</label>
          <select id="fz-depoff" class="fz-in w-full border border-border rounded-lg px-3 py-2">
            <option value="-12">UTC-12</option>
            <option value="-11">UTC-11</option>
            <option value="-10">UTC-10 (Hawaii)</option>
            <option value="-9">UTC-9 (Alaska)</option>
            <option value="-8">UTC-8 (Pacific)</option>
            <option value="-7">UTC-7 (Mountain)</option>
            <option value="-6">UTC-6 (Central)</option>
            <option value="-5" selected>UTC-5 (Eastern)</option>
            <option value="-4">UTC-4 (Atlantic)</option>
            <option value="-3">UTC-3 (Brazil)</option>
            <option value="-2">UTC-2</option>
            <option value="-1">UTC-1</option>
            <option value="0">UTC+0 (London)</option>
            <option value="1">UTC+1 (Paris)</option>
            <option value="2">UTC+2 (Athens)</option>
            <option value="3">UTC+3 (Moscow)</option>
            <option value="3.5">UTC+3:30 (Tehran)</option>
            <option value="4">UTC+4 (Dubai)</option>
            <option value="4.5">UTC+4:30 (Kabul)</option>
            <option value="5">UTC+5 (Pakistan)</option>
            <option value="5.5">UTC+5:30 (India)</option>
            <option value="5.75">UTC+5:45 (Nepal)</option>
            <option value="6">UTC+6 (Bangladesh)</option>
            <option value="7">UTC+7 (Bangkok)</option>
            <option value="8">UTC+8 (Singapore/Beijing)</option>
            <option value="9">UTC+9 (Tokyo)</option>
            <option value="9.5">UTC+9:30 (Adelaide)</option>
            <option value="10">UTC+10 (Sydney)</option>
            <option value="11">UTC+11</option>
            <option value="12">UTC+12 (Auckland)</option>
            <option value="13">UTC+13 (Samoa)</option>
          </select>
        </div>
        <div>
          <label for="fz-arroff" class="block text-sm font-medium text-text mb-1">Arrival UTC Offset (hours)</label>
          <select id="fz-arroff" class="fz-in w-full border border-border rounded-lg px-3 py-2">
            <option value="-12">UTC-12</option>
            <option value="-11">UTC-11</option>
            <option value="-10">UTC-10 (Hawaii)</option>
            <option value="-9">UTC-9 (Alaska)</option>
            <option value="-8">UTC-8 (Pacific)</option>
            <option value="-7">UTC-7 (Mountain)</option>
            <option value="-6">UTC-6 (Central)</option>
            <option value="-5">UTC-5 (Eastern)</option>
            <option value="-4">UTC-4 (Atlantic)</option>
            <option value="-3">UTC-3 (Brazil)</option>
            <option value="-2">UTC-2</option>
            <option value="-1">UTC-1</option>
            <option value="0" selected>UTC+0 (London)</option>
            <option value="1">UTC+1 (Paris)</option>
            <option value="2">UTC+2 (Athens)</option>
            <option value="3">UTC+3 (Moscow)</option>
            <option value="3.5">UTC+3:30 (Tehran)</option>
            <option value="4">UTC+4 (Dubai)</option>
            <option value="4.5">UTC+4:30 (Kabul)</option>
            <option value="5">UTC+5 (Pakistan)</option>
            <option value="5.5">UTC+5:30 (India)</option>
            <option value="5.75">UTC+5:45 (Nepal)</option>
            <option value="6">UTC+6 (Bangladesh)</option>
            <option value="7">UTC+7 (Bangkok)</option>
            <option value="8">UTC+8 (Singapore/Beijing)</option>
            <option value="9">UTC+9 (Tokyo)</option>
            <option value="9.5">UTC+9:30 (Adelaide)</option>
            <option value="10">UTC+10 (Sydney)</option>
            <option value="11">UTC+11</option>
            <option value="12">UTC+12 (Auckland)</option>
            <option value="13">UTC+13 (Samoa)</option>
          </select>
        </div>
        <div>
          <label for="fz-dur" class="block text-sm font-medium text-text mb-1">Flight Duration (hours)</label>
          <input type="number" id="fz-dur" class="fz-in w-full border border-border rounded-lg px-3 py-2" min="0" max="24" step="0.25" />
        </div>
        <div>
          <label for="fz-durm" class="block text-sm font-medium text-text mb-1">Flight Duration (minutes)</label>
          <input type="number" id="fz-durm" class="fz-in w-full border border-border rounded-lg px-3 py-2" min="0" max="59" step="5" />
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Arrival Time (Local)</div>
          <div class="text-5xl font-extrabold font-mono" id="fz-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Departure UTC (Zulu)</div>
            <div class="text-xl font-bold font-mono" id="fz-depz">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Arrival UTC (Zulu)</div>
            <div class="text-xl font-bold font-mono" id="fz-arrz">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Time Zone Difference</div>
            <div class="text-xl font-bold font-mono" id="fz-diff">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Day Change</div>
            <div class="text-xl font-bold font-mono" id="fz-day">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Jet Lag Severity</div>
            <div class="text-xl font-bold font-mono" id="fz-jetlag">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Recovery Days (est.)</div>
            <div class="text-xl font-bold font-mono" id="fz-recovery">--</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Direction</div>
          <div class="text-lg font-bold font-mono" id="fz-direction">--</div>
        </div>
      </div>
      <ShareButton calculatorId="flight-time-zone" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcFZ() {
      const depTimeStr = (document.getElementById('fz-deptime') as HTMLInputElement).value || '08:00';
      const depOff = parseFloat((document.getElementById('fz-depoff') as HTMLSelectElement).value);
      const arrOff = parseFloat((document.getElementById('fz-arroff') as HTMLSelectElement).value);
      const durH = parseFloat((document.getElementById('fz-dur') as HTMLInputElement).value) || 0;
      const durM = parseFloat((document.getElementById('fz-durm') as HTMLInputElement).value) || 0;

      const parts = depTimeStr.split(':');
      const depHour = parseInt(parts[0]) || 0;
      const depMin = parseInt(parts[1]) || 0;

      // Convert departure to UTC (minutes from midnight)
      const depLocalMins = depHour * 60 + depMin;
      const depUTCMins = depLocalMins - depOff * 60;

      // Flight duration in minutes
      const flightMins = durH * 60 + durM;

      // Arrival in UTC
      const arrUTCMins = depUTCMins + flightMins;

      // Arrival in local time
      const arrLocalMins = arrUTCMins + arrOff * 60;

      // Handle day rollover
      let arrDays = Math.floor(arrLocalMins / (24 * 60));
      let arrMinsOfDay = ((arrLocalMins % (24 * 60)) + (24 * 60)) % (24 * 60);

      // Compare to departure day
      let depDays = Math.floor(depLocalMins / (24 * 60));
      let dayChange = arrDays - depDays;

      const arrH = Math.floor(arrMinsOfDay / 60);
      const arrM = Math.round(arrMinsOfDay % 60);

      // Format times
      const pad = (n: number) => n.toString().padStart(2, '0');

      // UTC times
      let depUTCNorm = ((depUTCMins % (24 * 60)) + (24 * 60)) % (24 * 60);
      let arrUTCNorm = ((arrUTCMins % (24 * 60)) + (24 * 60)) % (24 * 60);

      const depZH = Math.floor(depUTCNorm / 60);
      const depZM = Math.round(depUTCNorm % 60);
      const arrZH = Math.floor(arrUTCNorm / 60);
      const arrZM = Math.round(arrUTCNorm % 60);

      // Time zone difference
      const tzDiff = arrOff - depOff;

      // Jet lag estimate
      const absZoneDiff = Math.abs(tzDiff);
      let jetlag = '';
      let recovery = 0;
      if (absZoneDiff <= 2) { jetlag = 'Minimal'; recovery = 0; }
      else if (absZoneDiff <= 5) { jetlag = 'Mild'; recovery = Math.ceil(absZoneDiff * 0.5); }
      else if (absZoneDiff <= 8) { jetlag = 'Moderate'; recovery = Math.ceil(absZoneDiff * 0.66); }
      else { jetlag = 'Severe'; recovery = Math.ceil(absZoneDiff * 0.75); }

      // Direction
      let direction = '';
      if (tzDiff > 0) direction = 'Eastbound (losing time, harder jet lag)';
      else if (tzDiff < 0) direction = 'Westbound (gaining time, easier jet lag)';
      else direction = 'Same time zone';

      document.getElementById('fz-result')!.textContent = pad(arrH) + ':' + pad(arrM);
      document.getElementById('fz-depz')!.textContent = pad(depZH) + ':' + pad(depZM) + 'Z';
      document.getElementById('fz-arrz')!.textContent = pad(arrZH) + ':' + pad(arrZM) + 'Z';
      document.getElementById('fz-diff')!.textContent = (tzDiff >= 0 ? '+' : '') + tzDiff + ' hours';

      if (dayChange === 0) document.getElementById('fz-day')!.textContent = 'Same day';
      else if (dayChange === 1) document.getElementById('fz-day')!.textContent = 'Next day (+1)';
      else if (dayChange === -1) document.getElementById('fz-day')!.textContent = 'Previous day (-1)';
      else document.getElementById('fz-day')!.textContent = (dayChange > 0 ? '+' : '') + dayChange + ' days';

      document.getElementById('fz-jetlag')!.textContent = jetlag + ' (' + absZoneDiff + ' zones)';
      document.getElementById('fz-recovery')!.textContent = recovery > 0 ? '~' + recovery + ' days' : 'None needed';
      document.getElementById('fz-direction')!.textContent = direction;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      (document.getElementById('fz-deptime') as HTMLInputElement).value = '14:00';
      (document.getElementById('fz-dur') as HTMLInputElement).value = '7';
      (document.getElementById('fz-durm') as HTMLInputElement).value = '30';
      document.querySelectorAll('.fz-in').forEach(el => { el.addEventListener('input', calcFZ); el.addEventListener('change', calcFZ); });
      calcFZ();
    }, 50);
  </script>
</CalculatorLayout>
