---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Stock Profit Calculator - Calculate Investment Returns";
const description = "Calculate your stock trading profit or loss. Enter buy and sell prices, shares, and commissions to see total return.";

const relatedCalcs = [
  { name: "ROI Calculator", url: "/roi-calculator", description: "Return on investment." },
  { name: "Investment Calculator", url: "/investment-calculator", description: "Investment growth." },
  { name: "Dividend Calculator", url: "/dividend-calculator", description: "Dividend income." },
  { name: "Capital Gains", url: "/capital-gains-calculator", description: "Capital gains tax." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Compound Interest", url: "/compound-interest-calculator", description: "Compound interest." },
];
---

<CalculatorLayout title={title} description={description} calculatorName="Stock Profit Calculator" keywords="stock profit calculator, stock return, investment profit, stock gain loss, share trading calculator" breadcrumbs={[{ name: "Stock Profit", url: "/stock-profit-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Stock Profit Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate your profit or loss from a stock trade.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Number of Shares</label>
            <input type="number" id="sp-shares" class="w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="100" min="1" step="1">
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Buy Price per Share</label>
              <div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
                <input type="number" id="sp-buy" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="50" min="0" step="0.01">
              </div>
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Sell Price per Share</label>
              <div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
                <input type="number" id="sp-sell" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="72" min="0" step="0.01">
              </div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Buy Commission</label>
              <div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
                <input type="number" id="sp-buy-comm" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="0" min="0" step="1">
              </div>
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Sell Commission</label>
              <div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
                <input type="number" id="sp-sell-comm" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="0" min="0" step="1">
              </div>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 rounded-2xl text-white text-center" id="sp-result-box" style="background:#22c55e;">
            <div class="text-sm uppercase tracking-wide mb-1 opacity-80">Net Profit / Loss</div>
            <div class="text-5xl font-extrabold" id="sp-profit">$0</div>
            <div class="text-sm mt-1 opacity-80" id="sp-pct">0% return</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Cost</div>
              <div class="text-xl font-bold" id="sp-cost">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Revenue</div>
              <div class="text-xl font-bold text-secondary" id="sp-revenue">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Break-Even Price</div>
              <div class="text-xl font-bold" id="sp-breakeven">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Commissions</div>
              <div class="text-xl font-bold" id="sp-comms">$0</div>
            </div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-3">Breakdown</h3>
            <div class="space-y-1 text-sm" id="sp-breakdown"></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="stock-profit" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Stock Profit</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Total Cost</strong> = (Buy Price × Shares) + Buy Commission</p>
        <p><strong>Total Revenue</strong> = (Sell Price × Shares) − Sell Commission</p>
        <p><strong>Profit</strong> = Revenue − Cost</p>
        <p><strong>Return %</strong> = (Profit ÷ Cost) × 100</p>
      </div>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const fmt = (n: number) => (n < 0 ? '-$' : '$') + Math.abs(n).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');

    function calcStock() {
      const shares = parseFloat((document.getElementById('sp-shares') as HTMLInputElement).value) || 0;
      const buy = parseFloat((document.getElementById('sp-buy') as HTMLInputElement).value) || 0;
      const sell = parseFloat((document.getElementById('sp-sell') as HTMLInputElement).value) || 0;
      const buyComm = parseFloat((document.getElementById('sp-buy-comm') as HTMLInputElement).value) || 0;
      const sellComm = parseFloat((document.getElementById('sp-sell-comm') as HTMLInputElement).value) || 0;

      const totalCost = shares * buy + buyComm;
      const totalRevenue = shares * sell - sellComm;
      const profit = totalRevenue - totalCost;
      const pct = totalCost > 0 ? (profit / totalCost) * 100 : 0;
      const breakeven = shares > 0 ? (totalCost + sellComm) / shares : 0;

      document.getElementById('sp-profit')!.textContent = fmt(profit);
      document.getElementById('sp-pct')!.textContent = pct.toFixed(2) + '% return';
      document.getElementById('sp-cost')!.textContent = fmt(totalCost);
      document.getElementById('sp-revenue')!.textContent = fmt(totalRevenue);
      document.getElementById('sp-breakeven')!.textContent = '$' + breakeven.toFixed(2);
      document.getElementById('sp-comms')!.textContent = fmt(buyComm + sellComm);
      document.getElementById('sp-result-box')!.style.backgroundColor = profit >= 0 ? '#22c55e' : '#ef4444';

      document.getElementById('sp-breakdown')!.innerHTML = [
        ['Shares × Buy Price', fmt(shares * buy)],
        ['+ Buy Commission', fmt(buyComm)],
        ['= Total Cost', fmt(totalCost)],
        ['Shares × Sell Price', fmt(shares * sell)],
        ['− Sell Commission', fmt(sellComm)],
        ['= Total Revenue', fmt(totalRevenue)],
        ['Net Profit/Loss', fmt(profit)],
      ].map(([l, v]) => `<div class="flex justify-between ${l.startsWith('Net') ? 'pt-1 border-t border-border font-bold' : ''}"><span class="text-text-secondary">${l}</span><span class="font-semibold">${v}</span></div>`).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      ['sp-shares', 'sp-buy', 'sp-sell', 'sp-buy-comm', 'sp-sell-comm'].forEach(id => {
        document.getElementById(id)!.addEventListener('input', calcStock);
      });
      calcStock();
    }, 50);
  </script>
</CalculatorLayout>
