---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Shoe Size Converter - US, UK, EU & CM Size Charts";
const description = "Convert shoe sizes between US, UK, EU, and centimeters for men, women, and kids. Includes international shoe size charts.";

const relatedCalcs = [
  { name: "Length Converter", url: "/length-converter", description: "Length units." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body Mass Index." },
  { name: "Age Calculator", url: "/age-calculator", description: "Exact age." },
  { name: "Unit Price", url: "/unit-price-calculator", description: "Best deal." },
  { name: "Weight Converter", url: "/weight-converter", description: "Weight units." },
  { name: "Temperature Converter", url: "/temperature-converter", description: "Temperature." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Shoe Size Converter"
  keywords="shoe size converter, shoe size chart, US to EU shoe size, UK shoe size, shoe size in cm"
  breadcrumbs={[{ name: "Shoe Size Converter", url: "/shoe-size-converter" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Shoe Size Converter</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert shoe sizes between US, UK, EU, and centimeters.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Gender</label>
        <div class="flex gap-2">
          <button class="sh-gender-btn px-4 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary" data-g="men">Men</button>
          <button class="sh-gender-btn px-4 py-2 rounded-xl text-sm font-semibold border border-border" data-g="women">Women</button>
          <button class="sh-gender-btn px-4 py-2 rounded-xl text-sm font-semibold border border-border" data-g="kids">Kids</button>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-3 mb-6">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Your Size</label>
          <input type="number" id="sh-size" class="w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="10" min="1" max="20" step="0.5">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">System</label>
          <select id="sh-system" class="w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="us">US</option>
            <option value="uk">UK</option>
            <option value="eu">EU</option>
            <option value="cm">CM (Foot Length)</option>
          </select>
        </div>
      </div>

      <div class="p-4 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-2">Converted Sizes</div>
        <div class="grid grid-cols-4 gap-3">
          <div><div class="text-xs text-blue-200">US</div><div class="text-2xl font-extrabold" id="sh-us">10</div></div>
          <div><div class="text-xs text-blue-200">UK</div><div class="text-2xl font-extrabold" id="sh-uk">9.5</div></div>
          <div><div class="text-xs text-blue-200">EU</div><div class="text-2xl font-extrabold" id="sh-eu">44</div></div>
          <div><div class="text-xs text-blue-200">CM</div><div class="text-2xl font-extrabold" id="sh-cm">28</div></div>
        </div>
      </div>

      <!-- Size chart -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-3" id="sh-chart-title">Men's Shoe Size Chart</h3>
        <div class="overflow-x-auto">
          <div class="text-xs" id="sh-chart"></div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-2">How to Measure Your Foot</h3>
        <ol class="text-sm text-text-secondary space-y-1 list-decimal list-inside">
          <li>Stand on a piece of paper with your heel against a wall</li>
          <li>Mark the tip of your longest toe</li>
          <li>Measure from the wall to the mark in cm</li>
          <li>Use the CM value above to find your size</li>
        </ol>
      </div>

      <ShareButton calculatorId="shoe-size" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Shoe Size Conversion Guide</h2>
      <p>Shoe sizes vary significantly between countries. US, UK, and EU systems use different scales. The most reliable method is measuring foot length in centimeters and converting from there.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>Are men's and women's sizes different?</strong> Yes. Women's US sizes are approximately 1.5 sizes larger than men's (e.g., Women's 9 ≈ Men's 7.5).</p>
      <p><strong>Do EU sizes differ by gender?</strong> EU sizes are unisex — the same EU size means the same foot length regardless of gender.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let shGender = 'men';

    // Size tables: [US Men, US Women, UK, EU, CM]
    const menSizes: number[][] = [
      [6, 7.5, 5.5, 39, 24], [6.5, 8, 6, 39.5, 24.5], [7, 8.5, 6.5, 40, 25],
      [7.5, 9, 7, 40.5, 25.5], [8, 9.5, 7.5, 41, 26], [8.5, 10, 8, 42, 26.5],
      [9, 10.5, 8.5, 42.5, 27], [9.5, 11, 9, 43, 27.5], [10, 11.5, 9.5, 44, 28],
      [10.5, 12, 10, 44.5, 28.5], [11, 12.5, 10.5, 45, 29], [11.5, 13, 11, 45.5, 29.5],
      [12, 13.5, 11.5, 46, 30], [13, 14.5, 12.5, 47, 31], [14, 15.5, 13.5, 48.5, 32],
    ];

    const kidsSizes: number[][] = [
      [1, 0, 0.5, 16, 8.3], [2, 0, 1, 17, 9.1], [3, 0, 2, 18, 9.9],
      [4, 0, 3, 19, 10.8], [5, 0, 4, 20, 11.6], [6, 0, 5, 22, 12.5],
      [7, 0, 6, 23, 13.3], [8, 0, 7, 24, 14.2], [9, 0, 8, 25, 15],
      [10, 0, 9, 27, 15.9], [11, 0, 10, 28, 16.7], [12, 0, 11, 30, 17.5],
      [13, 0, 12, 31, 18.4],
    ];

    function findClosest(val: number, system: string): number[] | null {
      const table = shGender === 'kids' ? kidsSizes : menSizes;
      let sysIdx: number;
      if (system === 'us') sysIdx = shGender === 'women' ? 1 : 0;
      else if (system === 'uk') sysIdx = 2;
      else if (system === 'eu') sysIdx = 3;
      else sysIdx = 4; // cm

      let closest = table[0];
      let minDist = Infinity;
      for (const row of table) {
        const dist = Math.abs(row[sysIdx] - val);
        if (dist < minDist) { minDist = dist; closest = row; }
      }
      return closest;
    }

    function calcShoe() {
      const size = parseFloat((document.getElementById('sh-size') as HTMLInputElement).value) || 0;
      const system = (document.getElementById('sh-system') as HTMLSelectElement).value;

      const row = findClosest(size, system);
      if (!row) return;

      const usVal = shGender === 'women' ? row[1] : row[0];
      document.getElementById('sh-us')!.textContent = String(usVal);
      document.getElementById('sh-uk')!.textContent = String(row[2]);
      document.getElementById('sh-eu')!.textContent = String(row[3]);
      document.getElementById('sh-cm')!.textContent = String(row[4]);

      // Build chart
      const table = shGender === 'kids' ? kidsSizes : menSizes;
      const genderLabel = shGender === 'men' ? "Men's" : shGender === 'women' ? "Women's" : "Kids'";
      document.getElementById('sh-chart-title')!.textContent = `${genderLabel} Shoe Size Chart`;

      const headers = shGender === 'kids'
        ? ['US Kids', 'UK', 'EU', 'CM']
        : ['US Men', 'US Women', 'UK', 'EU', 'CM'];

      document.getElementById('sh-chart')!.innerHTML =
        `<div class="grid grid-cols-${shGender === 'kids' ? 4 : 5} gap-1 font-semibold text-text-muted mb-1">` +
        headers.map(h => `<span>${h}</span>`).join('') + '</div>' +
        table.map(r => {
          const isHighlighted = row === r;
          const cols = shGender === 'kids'
            ? [r[0], r[2], r[3], r[4]]
            : [r[0], r[1], r[2], r[3], r[4]];
          return `<div class="grid grid-cols-${shGender === 'kids' ? 4 : 5} gap-1 ${isHighlighted ? 'bg-blue-50 rounded font-bold' : ''}">`
            + cols.map(v => `<span>${v}</span>`).join('') + '</div>';
        }).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.sh-gender-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.sh-gender-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          shGender = (btn as HTMLElement).dataset.g || 'men';
          calcShoe();
        });
      });

      document.getElementById('sh-size')!.addEventListener('input', calcShoe);
      document.getElementById('sh-system')!.addEventListener('change', calcShoe);
      calcShoe();
    }, 50);
  </script>
</CalculatorLayout>
