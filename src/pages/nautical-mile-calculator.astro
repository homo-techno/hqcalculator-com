---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Nautical Mile Calculator";
const description = "Convert nautical miles to kilometers and miles, knots to km/h and mph, and calculate great circle distance.";
const relatedCalcs = [
  { name: "Length Converter", url: "/length-converter-calculator", description: "Distances." },
  { name: "Speed Calculator", url: "/speed-calculator", description: "Speed." },
  { name: "Fuel Efficiency", url: "/fuel-efficiency-converter-calculator", description: "Fuel efficiency." },
  { name: "Road Trip", url: "/road-trip-calculator", description: "Road trips." },
  { name: "Flight Time", url: "/flight-time-calculator", description: "Flights." },
  { name: "Gas Mileage", url: "/gas-mileage-calculator", description: "Gas mileage." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Nautical Mile Calculator" keywords="nautical mile, knots, maritime distance, nm to km, knots to mph, great circle distance" breadcrumbs={[{ name: "Nautical Mile", url: "/nautical-mile-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Nautical Mile Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">1 nautical mile = 1.852 km = 1 minute of latitude. Convert distances and speeds for maritime/aviation use.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div><label class="block text-xs font-medium text-text mb-1">Mode</label>
          <select id="nm-mode" class="nm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="dist" selected>Distance Conversion</option>
            <option value="speed">Speed Conversion (Knots)</option>
            <option value="gc">Great Circle Distance</option>
          </select>
        </div>
        <div id="nm-dist-panel">
          <div class="grid grid-cols-2 gap-3">
            <div><label class="block text-xs font-medium text-text mb-1">Value</label><input type="number" id="nm-val" class="nm-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="100" step="0.1" min="0"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Input Unit</label>
              <select id="nm-unit" class="nm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
                <option value="nm" selected>Nautical Miles</option>
                <option value="km">Kilometers</option>
                <option value="mi">Statute Miles</option>
              </select>
            </div>
          </div>
        </div>
        <div id="nm-speed-panel" style="display:none;">
          <div class="grid grid-cols-2 gap-3">
            <div><label class="block text-xs font-medium text-text mb-1">Speed Value</label><input type="number" id="nm-spd" class="nm-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="25" step="0.1" min="0"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Input Unit</label>
              <select id="nm-sunit" class="nm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
                <option value="kn" selected>Knots</option>
                <option value="kmh">km/h</option>
                <option value="mph">mph</option>
              </select>
            </div>
          </div>
        </div>
        <div id="nm-gc-panel" style="display:none;">
          <div class="grid grid-cols-2 gap-3">
            <div><label class="block text-xs font-medium text-text mb-1">Lat 1</label><input type="number" id="nm-lat1" class="nm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="40.7128" step="0.01"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Lon 1</label><input type="number" id="nm-lon1" class="nm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="-74.006" step="0.01"></div>
          </div>
          <div class="grid grid-cols-2 gap-3 mt-3">
            <div><label class="block text-xs font-medium text-text mb-1">Lat 2</label><input type="number" id="nm-lat2" class="nm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="51.5074" step="0.01"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Lon 2</label><input type="number" id="nm-lon2" class="nm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="-0.1278" step="0.01"></div>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="nm-label">Nautical Miles</div>
          <div class="text-5xl font-extrabold font-mono" id="nm-result">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase" id="nm-c1l">Nautical Miles</div><div class="text-xl font-bold font-mono" id="nm-c1">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase" id="nm-c2l">Kilometers</div><div class="text-xl font-bold font-mono" id="nm-c2">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase" id="nm-c3l">Statute Miles</div><div class="text-xl font-bold font-mono" id="nm-c3">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="nautical-mile" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcNM() {
      const mode = (document.getElementById('nm-mode') as HTMLSelectElement).value;
      document.getElementById('nm-dist-panel')!.style.display = mode === 'dist' ? 'block' : 'none';
      document.getElementById('nm-speed-panel')!.style.display = mode === 'speed' ? 'block' : 'none';
      document.getElementById('nm-gc-panel')!.style.display = mode === 'gc' ? 'block' : 'none';

      if (mode === 'dist') {
        const val = parseFloat((document.getElementById('nm-val') as HTMLInputElement).value) || 0;
        const unit = (document.getElementById('nm-unit') as HTMLSelectElement).value;
        let nm = 0, km = 0, mi = 0;
        if (unit === 'nm') { nm = val; km = val * 1.852; mi = val * 1.15078; }
        else if (unit === 'km') { km = val; nm = val / 1.852; mi = val / 1.60934; }
        else { mi = val; km = val * 1.60934; nm = val / 1.15078; }
        document.getElementById('nm-label')!.textContent = 'Distance';
        document.getElementById('nm-result')!.textContent = nm.toFixed(2) + ' NM';
        document.getElementById('nm-c1l')!.textContent = 'Nautical Miles';
        document.getElementById('nm-c2l')!.textContent = 'Kilometers';
        document.getElementById('nm-c3l')!.textContent = 'Statute Miles';
        document.getElementById('nm-c1')!.textContent = nm.toFixed(2);
        document.getElementById('nm-c2')!.textContent = km.toFixed(2);
        document.getElementById('nm-c3')!.textContent = mi.toFixed(2);
      } else if (mode === 'speed') {
        const val = parseFloat((document.getElementById('nm-spd') as HTMLInputElement).value) || 0;
        const unit = (document.getElementById('nm-sunit') as HTMLSelectElement).value;
        let kn = 0, kmh = 0, mph = 0;
        if (unit === 'kn') { kn = val; kmh = val * 1.852; mph = val * 1.15078; }
        else if (unit === 'kmh') { kmh = val; kn = val / 1.852; mph = val / 1.60934; }
        else { mph = val; kmh = val * 1.60934; kn = val / 1.15078; }
        document.getElementById('nm-label')!.textContent = 'Speed';
        document.getElementById('nm-result')!.textContent = kn.toFixed(2) + ' knots';
        document.getElementById('nm-c1l')!.textContent = 'Knots';
        document.getElementById('nm-c2l')!.textContent = 'km/h';
        document.getElementById('nm-c3l')!.textContent = 'mph';
        document.getElementById('nm-c1')!.textContent = kn.toFixed(2);
        document.getElementById('nm-c2')!.textContent = kmh.toFixed(2);
        document.getElementById('nm-c3')!.textContent = mph.toFixed(2);
      } else {
        const lat1 = parseFloat((document.getElementById('nm-lat1') as HTMLInputElement).value) * Math.PI / 180;
        const lon1 = parseFloat((document.getElementById('nm-lon1') as HTMLInputElement).value) * Math.PI / 180;
        const lat2 = parseFloat((document.getElementById('nm-lat2') as HTMLInputElement).value) * Math.PI / 180;
        const lon2 = parseFloat((document.getElementById('nm-lon2') as HTMLInputElement).value) * Math.PI / 180;
        const dlat = lat2 - lat1;
        const dlon = lon2 - lon1;
        const a = Math.sin(dlat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dlon/2)**2;
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        const km = 6371 * c;
        const nm = km / 1.852;
        const mi = km / 1.60934;
        document.getElementById('nm-label')!.textContent = 'Great Circle Distance';
        document.getElementById('nm-result')!.textContent = nm.toFixed(1) + ' NM';
        document.getElementById('nm-c1l')!.textContent = 'Nautical Miles';
        document.getElementById('nm-c2l')!.textContent = 'Kilometers';
        document.getElementById('nm-c3l')!.textContent = 'Statute Miles';
        document.getElementById('nm-c1')!.textContent = nm.toFixed(1);
        document.getElementById('nm-c2')!.textContent = km.toFixed(1);
        document.getElementById('nm-c3')!.textContent = mi.toFixed(1);
      }
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.nm-in').forEach(el => { el.addEventListener('input', calcNM); el.addEventListener('change', calcNM); });
      calcNM();
    }, 50);
  </script>
</CalculatorLayout>
