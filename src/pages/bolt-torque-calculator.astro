---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Bolt Torque Calculator - Recommended Torque Values";
const description = "Calculate recommended torque values for bolts by size, grade, and lubrication condition. Covers SAE, metric, and stainless steel fasteners.";

const relatedCalcs = [
  { name: "Thread Pitch Calculator", url: "/thread-pitch-calculator", description: "Thread dimensions." },
  { name: "Drill Bit Calculator", url: "/drill-bit-calculator", description: "Drill bit sizes." },
  { name: "Rivet Calculator", url: "/rivet-calculator", description: "Rivet sizing." },
  { name: "Metal Weight Calculator", url: "/metal-weight-calculator", description: "Metal weight." },
  { name: "Structural Steel Calculator", url: "/structural-steel-calculator", description: "Steel section properties." },
  { name: "Metal Fatigue Calculator", url: "/metal-fatigue-calculator", description: "Fatigue life estimation." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Bolt Torque Calculator"
  keywords="bolt torque, torque values, bolt tightening, torque chart, SAE grade, metric grade, fastener torque, clamping force"
  breadcrumbs={[{ name: "Bolt Torque Calculator", url: "/bolt-torque-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Bolt Torque Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate recommended torque values for bolts by size, grade, and lubrication.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Thread System -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Fastener System</label>
        <select id="bt2-system" class="bt2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="sae">SAE (Imperial)</option>
          <option value="metric">Metric (ISO)</option>
        </select>
      </div>

      <!-- Bolt Size -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Bolt Size</label>
        <select id="bt2-size" class="bt2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="0.25">1/4"</option>
        </select>
      </div>

      <!-- Grade -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Grade / Class</label>
        <select id="bt2-grade" class="bt2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="5">Grade 5</option>
        </select>
      </div>

      <!-- Lubrication -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Lubrication Condition</label>
        <select id="bt2-lube" class="bt2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="0.20">Dry / As-Received (K=0.20)</option>
          <option value="0.18">Zinc Plated (K=0.18)</option>
          <option value="0.15">Lightly Oiled (K=0.15)</option>
          <option value="0.12">Anti-Seize Compound (K=0.12)</option>
          <option value="0.10">Moly Paste (K=0.10)</option>
        </select>
      </div>

      <!-- Target Preload % -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Target Preload (% of Proof Load)</label>
        <input type="number" id="bt2-preload" class="bt2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="75" min="50" max="90" step="5">
        <p class="text-xs text-text-muted mt-1">Typically 70-80% for reusable joints</p>
      </div>

      <!-- Results -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Torque</div>
        <div class="text-4xl font-extrabold" id="bt2-torque">--</div>
        <div class="text-sm text-blue-200 mt-1" id="bt2-torqueunit">ft-lbs</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Torque (Nm)</div>
          <div class="text-xl font-bold" id="bt2-nm">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Torque (in-lbs)</div>
          <div class="text-xl font-bold" id="bt2-inlbs">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Clamp Force</div>
          <div class="text-xl font-bold" id="bt2-clamp">--</div>
          <div class="text-xs text-text-muted">lbf</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Proof Load</div>
          <div class="text-xl font-bold" id="bt2-proof">--</div>
          <div class="text-xs text-text-muted">lbf</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl text-center mb-6">
        <div class="text-xs text-text-muted uppercase">Tensile Strength</div>
        <div class="text-xl font-bold" id="bt2-tensile">--</div>
      </div>

      <ShareButton calculatorId="bolt-torque" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Bolt Torque Formula</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm">
        <p><strong>T</strong> = K x D x F</p>
        <p>T = Torque, K = Nut Factor, D = Nominal Bolt Diameter, F = Desired Clamp Force</p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">SAE Bolt Grades</h3>
      <ul>
        <li><strong>Grade 2:</strong> Low carbon steel. 74,000 PSI tensile. General purpose.</li>
        <li><strong>Grade 5:</strong> Medium carbon, quenched/tempered. 120,000 PSI. Most common structural grade.</li>
        <li><strong>Grade 8:</strong> Alloy steel, Q&T. 150,000 PSI. High-strength applications.</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    // SAE bolt data: {size_in, tsa_in2 (tensile stress area)}
    const bt2SAE = [
      {label:'#6 (0.138")', dia:0.138, tsa:0.00909},
      {label:'#8 (0.164")', dia:0.164, tsa:0.01400},
      {label:'#10 (0.190")', dia:0.190, tsa:0.01750},
      {label:'1/4"', dia:0.250, tsa:0.0318},
      {label:'5/16"', dia:0.3125, tsa:0.0524},
      {label:'3/8"', dia:0.375, tsa:0.0775},
      {label:'7/16"', dia:0.4375, tsa:0.1063},
      {label:'1/2"', dia:0.500, tsa:0.1419},
      {label:'9/16"', dia:0.5625, tsa:0.182},
      {label:'5/8"', dia:0.625, tsa:0.226},
      {label:'3/4"', dia:0.750, tsa:0.334},
      {label:'7/8"', dia:0.875, tsa:0.462},
      {label:'1"', dia:1.000, tsa:0.606},
      {label:'1-1/8"', dia:1.125, tsa:0.763},
      {label:'1-1/4"', dia:1.250, tsa:0.969}
    ];

    const bt2Metric = [
      {label:'M3', dia:3, tsa:5.03},
      {label:'M4', dia:4, tsa:8.78},
      {label:'M5', dia:5, tsa:14.2},
      {label:'M6', dia:6, tsa:20.1},
      {label:'M8', dia:8, tsa:36.6},
      {label:'M10', dia:10, tsa:58.0},
      {label:'M12', dia:12, tsa:84.3},
      {label:'M14', dia:14, tsa:115},
      {label:'M16', dia:16, tsa:157},
      {label:'M18', dia:18, tsa:192},
      {label:'M20', dia:20, tsa:245},
      {label:'M24', dia:24, tsa:353},
      {label:'M30', dia:30, tsa:561}
    ];

    // Proof stress PSI by grade (SAE)
    const bt2SAEGrades: Record<string, {label:string, proofPSI:number, tensilePSI:number}> = {
      '2': {label:'Grade 2 (SAE)', proofPSI:55000, tensilePSI:74000},
      '5': {label:'Grade 5 (SAE)', proofPSI:85000, tensilePSI:120000},
      '8': {label:'Grade 8 (SAE)', proofPSI:120000, tensilePSI:150000}
    };

    // Proof stress MPa by class (Metric)
    const bt2MetricGrades: Record<string, {label:string, proofMPa:number, tensileMPa:number}> = {
      '4.6': {label:'Class 4.6', proofMPa:225, tensileMPa:400},
      '8.8': {label:'Class 8.8', proofMPa:580, tensileMPa:800},
      '10.9': {label:'Class 10.9', proofMPa:830, tensileMPa:1040},
      '12.9': {label:'Class 12.9', proofMPa:970, tensileMPa:1220}
    };

    function updateBT2Options() {
      const system = (document.getElementById('bt2-system') as HTMLSelectElement).value;
      const sizeSelect = document.getElementById('bt2-size') as HTMLSelectElement;
      const gradeSelect = document.getElementById('bt2-grade') as HTMLSelectElement;

      sizeSelect.innerHTML = '';
      gradeSelect.innerHTML = '';

      if (system === 'sae') {
        bt2SAE.forEach((s, i) => {
          const opt = document.createElement('option');
          opt.value = String(i);
          opt.textContent = s.label;
          if (s.dia === 0.5) opt.selected = true;
          sizeSelect.appendChild(opt);
        });
        for (const [k, v] of Object.entries(bt2SAEGrades)) {
          const opt = document.createElement('option');
          opt.value = k;
          opt.textContent = v.label;
          if (k === '5') opt.selected = true;
          gradeSelect.appendChild(opt);
        }
      } else {
        bt2Metric.forEach((s, i) => {
          const opt = document.createElement('option');
          opt.value = String(i);
          opt.textContent = s.label;
          if (s.dia === 10) opt.selected = true;
          sizeSelect.appendChild(opt);
        });
        for (const [k, v] of Object.entries(bt2MetricGrades)) {
          const opt = document.createElement('option');
          opt.value = k;
          opt.textContent = v.label;
          if (k === '8.8') opt.selected = true;
          gradeSelect.appendChild(opt);
        }
      }
    }

    function calcBT2() {
      const system = (document.getElementById('bt2-system') as HTMLSelectElement).value;
      const sizeIdx = parseInt((document.getElementById('bt2-size') as HTMLSelectElement).value) || 0;
      const grade = (document.getElementById('bt2-grade') as HTMLSelectElement).value;
      const K = parseFloat((document.getElementById('bt2-lube') as HTMLSelectElement).value) || 0.20;
      const preloadPct = (parseFloat((document.getElementById('bt2-preload') as HTMLInputElement).value) || 75) / 100;

      let torque_ftlbs = 0;
      let clampForce_lbf = 0;
      let proofLoad_lbf = 0;
      let tensileStr = '';

      if (system === 'sae') {
        const bolt = bt2SAE[sizeIdx];
        const gr = bt2SAEGrades[grade];
        if (!bolt || !gr) return;

        proofLoad_lbf = gr.proofPSI * bolt.tsa;
        clampForce_lbf = proofLoad_lbf * preloadPct;
        // T = K * D * F (in-lbs), convert to ft-lbs
        torque_ftlbs = (K * bolt.dia * clampForce_lbf) / 12;
        tensileStr = gr.tensilePSI.toLocaleString() + ' PSI';
      } else {
        const bolt = bt2Metric[sizeIdx];
        const gr = bt2MetricGrades[grade];
        if (!bolt || !gr) return;

        // TSA in mmÂ², proof in MPa -> proof load in N
        const proofLoad_N = gr.proofMPa * bolt.tsa;
        const clampForce_N = proofLoad_N * preloadPct;
        proofLoad_lbf = proofLoad_N * 0.2248;
        clampForce_lbf = clampForce_N * 0.2248;

        // T = K * D(m) * F(N) -> Nm, then to ft-lbs
        const torque_Nm = K * (bolt.dia / 1000) * clampForce_N;
        torque_ftlbs = torque_Nm * 0.7376;
        tensileStr = gr.tensileMPa + ' MPa';
      }

      const torque_inlbs = torque_ftlbs * 12;
      const torque_Nm = torque_ftlbs * 1.3558;

      document.getElementById('bt2-torque')!.textContent = torque_ftlbs.toFixed(1);
      document.getElementById('bt2-nm')!.textContent = torque_Nm.toFixed(1);
      document.getElementById('bt2-inlbs')!.textContent = torque_inlbs.toFixed(0);
      document.getElementById('bt2-clamp')!.textContent = Math.round(clampForce_lbf).toLocaleString();
      document.getElementById('bt2-proof')!.textContent = Math.round(proofLoad_lbf).toLocaleString();
      document.getElementById('bt2-tensile')!.textContent = tensileStr;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.getElementById('bt2-system')!.addEventListener('change', () => { updateBT2Options(); calcBT2(); });

      document.querySelectorAll('.bt2-in').forEach(el => {
        el.addEventListener('input', calcBT2);
        el.addEventListener('change', calcBT2);
      });

      updateBT2Options();
      calcBT2();
    }, 50);
  </script>
</CalculatorLayout>
