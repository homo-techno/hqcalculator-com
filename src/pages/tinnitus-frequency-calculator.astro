---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Tinnitus Frequency Calculator";
const description = "Match your tinnitus frequency, assess loudness level, get masking sound recommendations, and calculate a severity score.";
const relatedCalcs = [
  { name: "Hearing Loss Calculator", url: "/hearing-loss-calculator", description: "Classify hearing loss level." },
  { name: "Hearing Aid Calculator", url: "/hearing-aid-calculator", description: "Hearing aid cost estimate." },
  { name: "Snoring Risk Calculator", url: "/snoring-risk-calculator", description: "Snoring and OSA risk score." },
  { name: "Blood Pressure Calculator", url: "/blood-pressure-calculator", description: "Blood pressure classification." },
  { name: "Sleep Calculator", url: "/sleep-calculator", description: "Optimal sleep time calculator." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body mass index calculator." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Tinnitus Frequency Calculator" keywords="tinnitus frequency, tinnitus matching, tinnitus masking, tinnitus severity, tinnitus loudness, ringing in ears" breadcrumbs={[{ name: "Tinnitus Frequency", url: "/tinnitus-frequency-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Tinnitus Frequency Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Identify your tinnitus characteristics, severity score, and get masking recommendations.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Perceived Frequency</label>
            <select id="tn-freq" class="tn-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="250">250 Hz (Low hum)</option>
              <option value="500">500 Hz (Low tone)</option>
              <option value="1000">1000 Hz (Mid tone)</option>
              <option value="2000">2000 Hz (Mid-high)</option>
              <option value="4000" selected>4000 Hz (High pitch)</option>
              <option value="6000">6000 Hz (Very high)</option>
              <option value="8000">8000 Hz (Extremely high)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Tinnitus Type</label>
            <select id="tn-type" class="tn-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="tonal" selected>Tonal (steady pitch)</option>
              <option value="pulsatile">Pulsatile (rhythmic)</option>
              <option value="hissing">Hissing / Static</option>
              <option value="clicking">Clicking</option>
              <option value="roaring">Roaring / Rushing</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Perceived Loudness (dB SL)</label>
            <select id="tn-loud" class="tn-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="5">5 dB (barely noticeable)</option>
              <option value="10" selected>10 dB (soft)</option>
              <option value="15">15 dB (moderate)</option>
              <option value="20">20 dB (loud)</option>
              <option value="30">30 dB (very loud)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Duration</label>
            <select id="tn-dur" class="tn-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="intermittent">Intermittent</option>
              <option value="frequent" selected>Frequent</option>
              <option value="constant">Constant</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Impact on Sleep</label>
            <select id="tn-sleep" class="tn-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="0" selected>No impact</option>
              <option value="1">Mild - occasional difficulty</option>
              <option value="2">Moderate - regular difficulty</option>
              <option value="3">Severe - cannot sleep without masking</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Impact on Concentration</label>
            <select id="tn-focus" class="tn-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="0" selected>No impact</option>
              <option value="1">Mild distraction</option>
              <option value="2">Moderate impairment</option>
              <option value="3">Severe impairment</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Tinnitus Severity Score</div>
          <div class="text-5xl font-extrabold font-mono" id="tn-score">0 / 100</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Severity Level</div><div class="text-xl font-bold font-mono" id="tn-level">-</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Frequency Band</div><div class="text-xl font-bold font-mono" id="tn-band">-</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Masking Sound</div><div class="text-xl font-bold font-mono" id="tn-mask">-</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase mb-1">Recommended Action</div>
          <div class="text-lg font-bold font-mono" id="tn-rec">-</div>
        </div>
        <div class="p-3 bg-amber-50 rounded-xl text-center text-xs text-amber-800 font-semibold">
          If you experience sudden or pulsatile tinnitus, please see an ENT specialist promptly.
        </div>
      </div>
      <ShareButton calculatorId="tinnitus-frequency" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcTN() {
      const freq = parseInt((document.getElementById('tn-freq') as HTMLSelectElement).value) || 4000;
      const type = (document.getElementById('tn-type') as HTMLSelectElement).value;
      const loud = parseInt((document.getElementById('tn-loud') as HTMLSelectElement).value) || 10;
      const dur = (document.getElementById('tn-dur') as HTMLSelectElement).value;
      const sleepImpact = parseInt((document.getElementById('tn-sleep') as HTMLSelectElement).value) || 0;
      const focusImpact = parseInt((document.getElementById('tn-focus') as HTMLSelectElement).value) || 0;

      // Severity score (0-100) based on multiple factors
      const loudScore = Math.min(30, loud * 1.5); // 0-30
      const durScore: Record<string, number> = { intermittent: 5, frequent: 15, constant: 25 };
      const impactScore = (sleepImpact + focusImpact) * 7.5; // 0-45
      const totalScore = Math.round(loudScore + (durScore[dur] || 15) + impactScore);

      let level: string;
      if (totalScore <= 20) level = 'Slight';
      else if (totalScore <= 40) level = 'Mild';
      else if (totalScore <= 60) level = 'Moderate';
      else if (totalScore <= 80) level = 'Severe';
      else level = 'Catastrophic';

      // Frequency band
      let band: string;
      if (freq <= 500) band = 'Low Frequency';
      else if (freq <= 2000) band = 'Mid Frequency';
      else band = 'High Frequency';

      // Masking recommendations
      let mask: string;
      if (freq <= 500) mask = 'Fan / Brown noise';
      else if (freq <= 2000) mask = 'Pink noise / Rain';
      else if (freq <= 4000) mask = 'White noise / Stream';
      else mask = 'Notched white noise';

      // Recommendation
      let rec: string;
      if (type === 'pulsatile') {
        rec = 'See ENT - pulsatile tinnitus needs medical evaluation';
      } else if (totalScore <= 20) {
        rec = 'Monitor - use sound enrichment as needed';
      } else if (totalScore <= 40) {
        rec = 'Sound therapy, consider audiologist evaluation';
      } else if (totalScore <= 60) {
        rec = 'ENT and audiologist recommended, TRT therapy';
      } else {
        rec = 'Urgent ENT referral, CBT for tinnitus, sound therapy';
      }

      document.getElementById('tn-score')!.textContent = totalScore + ' / 100';
      document.getElementById('tn-level')!.textContent = level;
      document.getElementById('tn-band')!.textContent = band;
      document.getElementById('tn-mask')!.textContent = mask;
      document.getElementById('tn-rec')!.textContent = rec;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.tn-in').forEach(el => { el.addEventListener('input', calcTN); el.addEventListener('change', calcTN); });
      calcTN();
    }, 50);
  </script>
</CalculatorLayout>
