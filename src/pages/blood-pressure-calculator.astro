---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Blood Pressure Calculator - Check Your BP Category";
const description = "Check your blood pressure category based on AHA guidelines. Track readings, understand systolic and diastolic numbers, and get health recommendations.";

const relatedCalcs = [
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body Mass Index." },
  { name: "Heart Rate Calculator", url: "/heart-rate-calculator", description: "Heart rate zones." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calories." },
  { name: "Body Fat Calculator", url: "/body-fat-calculator", description: "Body fat %." },
  { name: "BMR Calculator", url: "/bmr-calculator", description: "Basal metabolic rate." },
  { name: "Age Calculator", url: "/age-calculator", description: "Exact age." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Blood Pressure Calculator"
  keywords="blood pressure calculator, bp chart, blood pressure categories, hypertension, systolic diastolic, blood pressure range"
  breadcrumbs={[{ name: "Blood Pressure", url: "/blood-pressure-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Blood Pressure Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Enter your reading to see your blood pressure category and health guidance.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <h3 class="font-semibold text-text mb-3">Your Blood Pressure Reading</h3>
      <div class="flex items-center gap-3 mb-6">
        <div class="flex-1">
          <label class="block text-xs font-medium text-text mb-1">Systolic (top number)</label>
          <input type="number" id="bp-sys" class="w-full px-4 py-3 border border-border rounded-xl text-3xl font-bold text-center" value="120" min="60" max="250" step="1">
        </div>
        <span class="text-3xl font-bold text-text-muted mt-5">/</span>
        <div class="flex-1">
          <label class="block text-xs font-medium text-text mb-1">Diastolic (bottom number)</label>
          <input type="number" id="bp-dia" class="w-full px-4 py-3 border border-border rounded-xl text-3xl font-bold text-center" value="80" min="30" max="150" step="1">
        </div>
        <span class="text-lg text-text-muted mt-5 font-semibold">mmHg</span>
      </div>

      <div class="p-6 rounded-2xl text-white text-center mb-4" id="bp-result-box" style="background: #22c55e;">
        <div class="text-sm uppercase tracking-wide mb-1 opacity-80">Blood Pressure Category</div>
        <div class="text-3xl font-extrabold" id="bp-category">Normal</div>
        <div class="text-sm mt-1 opacity-80" id="bp-range">Systolic &lt; 120 AND Diastolic &lt; 80</div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-2">Recommendation</h3>
        <p class="text-sm text-text-secondary" id="bp-advice">Your blood pressure is in the normal range. Maintain a healthy lifestyle with regular exercise and a balanced diet.</p>
      </div>

      <!-- BP Chart -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-3">Blood Pressure Categories (AHA)</h3>
        <div class="space-y-2 text-sm">
          <div class="flex items-center gap-3 p-2 rounded-lg bg-green-50">
            <div class="w-3 h-3 rounded-full bg-green-500"></div>
            <div class="flex-1"><strong>Normal</strong></div>
            <div class="text-text-muted">&lt; 120 / &lt; 80</div>
          </div>
          <div class="flex items-center gap-3 p-2 rounded-lg bg-yellow-50">
            <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
            <div class="flex-1"><strong>Elevated</strong></div>
            <div class="text-text-muted">120-129 / &lt; 80</div>
          </div>
          <div class="flex items-center gap-3 p-2 rounded-lg bg-orange-50">
            <div class="w-3 h-3 rounded-full bg-orange-500"></div>
            <div class="flex-1"><strong>High BP Stage 1</strong></div>
            <div class="text-text-muted">130-139 / 80-89</div>
          </div>
          <div class="flex items-center gap-3 p-2 rounded-lg bg-red-50">
            <div class="w-3 h-3 rounded-full bg-red-500"></div>
            <div class="flex-1"><strong>High BP Stage 2</strong></div>
            <div class="text-text-muted">≥ 140 / ≥ 90</div>
          </div>
          <div class="flex items-center gap-3 p-2 rounded-lg bg-red-100">
            <div class="w-3 h-3 rounded-full bg-red-700"></div>
            <div class="flex-1"><strong>Hypertensive Crisis</strong></div>
            <div class="text-text-muted">&gt; 180 / &gt; 120</div>
          </div>
        </div>
      </div>

      <!-- Reading tracker -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <div class="flex justify-between items-center mb-3">
          <h3 class="font-semibold text-sm text-text">Reading Log</h3>
          <button id="bp-log" class="px-3 py-1 text-xs rounded-lg bg-primary text-white font-semibold hover:bg-blue-700">Log Current Reading</button>
        </div>
        <div class="space-y-1 text-sm" id="bp-log-list">
          <div class="text-text-muted text-xs">No readings logged yet</div>
        </div>
      </div>

      <ShareButton calculatorId="blood-pressure" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Understanding Blood Pressure</h2>
      <p>Blood pressure is measured in millimeters of mercury (mmHg) with two numbers: <strong>systolic</strong> (pressure when the heart beats) over <strong>diastolic</strong> (pressure between beats). A reading of 120/80 mmHg is spoken as "120 over 80."</p>

      <h3 class="text-xl font-semibold text-text mt-8">How to Get Accurate Readings</h3>
      <ul>
        <li>Sit quietly for 5 minutes before measuring</li>
        <li>Don't smoke, drink caffeine, or exercise within 30 minutes</li>
        <li>Sit with your back supported, feet flat, arm supported at heart level</li>
        <li>Take 2-3 readings one minute apart and average them</li>
        <li>Measure at the same time each day</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What causes high blood pressure?</strong> Risk factors include excess sodium, lack of exercise, obesity, stress, age, family history, and certain medical conditions.</p>
      <p><strong>Can I lower blood pressure naturally?</strong> Yes — reduce sodium, exercise regularly, maintain healthy weight, limit alcohol, manage stress, and eat a DASH-style diet rich in fruits, vegetables, and whole grains.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    interface LogEntry { sys: number; dia: number; time: string; category: string; }
    const logEntries: LogEntry[] = [];

    function getCategory(sys: number, dia: number): { name: string; color: string; range: string; advice: string } {
      if (sys > 180 || dia > 120) return {
        name: 'Hypertensive Crisis',
        color: '#b91c1c',
        range: 'Systolic > 180 and/or Diastolic > 120',
        advice: 'SEEK EMERGENCY MEDICAL CARE IMMEDIATELY. This is a medical emergency. Call 911 or go to the nearest emergency room.'
      };
      if (sys >= 140 || dia >= 90) return {
        name: 'High Blood Pressure (Stage 2)',
        color: '#ef4444',
        range: 'Systolic ≥ 140 or Diastolic ≥ 90',
        advice: 'Consult your doctor promptly. You will likely need medication in addition to lifestyle changes. Regular monitoring is essential.'
      };
      if (sys >= 130 || dia >= 80) return {
        name: 'High Blood Pressure (Stage 1)',
        color: '#f97316',
        range: 'Systolic 130-139 or Diastolic 80-89',
        advice: 'Talk to your doctor about lifestyle changes and possibly medication. Reduce sodium, exercise regularly, and manage stress.'
      };
      if (sys >= 120 && dia < 80) return {
        name: 'Elevated',
        color: '#eab308',
        range: 'Systolic 120-129 and Diastolic < 80',
        advice: 'Your blood pressure is higher than normal but not yet high. Adopt healthy lifestyle changes now to prevent progression.'
      };
      if (sys < 90 || dia < 60) return {
        name: 'Low Blood Pressure',
        color: '#6366f1',
        range: 'Systolic < 90 or Diastolic < 60',
        advice: 'Low blood pressure can cause dizziness and fainting. If you experience symptoms, consult your doctor. Some people naturally have lower BP.'
      };
      return {
        name: 'Normal',
        color: '#22c55e',
        range: 'Systolic < 120 AND Diastolic < 80',
        advice: 'Your blood pressure is in the normal range. Maintain a healthy lifestyle with regular exercise and a balanced diet.'
      };
    }

    function calcBP() {
      const sys = parseInt((document.getElementById('bp-sys') as HTMLInputElement).value) || 0;
      const dia = parseInt((document.getElementById('bp-dia') as HTMLInputElement).value) || 0;

      const cat = getCategory(sys, dia);
      document.getElementById('bp-result-box')!.style.backgroundColor = cat.color;
      document.getElementById('bp-category')!.textContent = cat.name;
      document.getElementById('bp-range')!.textContent = cat.range;
      document.getElementById('bp-advice')!.textContent = cat.advice;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    function renderLog() {
      if (logEntries.length === 0) {
        document.getElementById('bp-log-list')!.innerHTML = '<div class="text-text-muted text-xs">No readings logged yet</div>';
        return;
      }
      document.getElementById('bp-log-list')!.innerHTML = logEntries.map((e, i) =>
        `<div class="flex justify-between items-center py-1 border-b border-border/30 last:border-0">
          <span class="font-mono font-bold">${e.sys}/${e.dia}</span>
          <span class="text-xs text-text-muted">${e.category}</span>
          <span class="text-xs text-text-muted">${e.time}</span>
        </div>`
      ).join('');
    }

    setTimeout(() => {
      ['bp-sys', 'bp-dia'].forEach(id => {
        document.getElementById(id)!.addEventListener('input', calcBP);
      });

      document.getElementById('bp-log')!.addEventListener('click', () => {
        const sys = parseInt((document.getElementById('bp-sys') as HTMLInputElement).value) || 0;
        const dia = parseInt((document.getElementById('bp-dia') as HTMLInputElement).value) || 0;
        const cat = getCategory(sys, dia);
        logEntries.unshift({
          sys, dia,
          category: cat.name,
          time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
        });
        renderLog();
      });

      calcBP();
    }, 50);
  </script>
</CalculatorLayout>
