---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Rebar Calculator - Linear Feet, Bars & Weight Estimator";
const description = "Calculate rebar needed for concrete slabs. Enter dimensions, bar size, and spacing to get total linear feet, number of bars, weight in pounds, and overlap count.";

const relatedCalcs = [
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Estimate concrete volume." },
  { name: "Foundation Calculator", url: "/foundation-calculator", description: "Foundation concrete needs." },
  { name: "Excavation Calculator", url: "/excavation-calculator", description: "Dig volume estimator." },
  { name: "Mortar Calculator", url: "/mortar-calculator", description: "Mortar and sand needs." },
  { name: "Asphalt Calculator", url: "/asphalt-calculator", description: "Asphalt tonnage." },
  { name: "Floor Joist Calculator", url: "/floor-joist-calculator", description: "Joist sizing and count." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Rebar Calculator"
  keywords="rebar calculator, rebar weight, rebar spacing, concrete reinforcement, rebar linear feet, rebar estimator"
  breadcrumbs={[{ name: "Rebar Calculator", url: "/rebar-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Rebar Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate rebar requirements for concrete slabs including total linear feet, bar count, weight, and overlaps.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="grid grid-cols-2 gap-3 mb-5">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Slab Length (ft)</label>
              <input type="number" id="rb-length" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="20" min="0" step="0.5">
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Slab Width (ft)</label>
              <input type="number" id="rb-width" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="20" min="0" step="0.5">
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Bar Size</label>
            <select id="rb-barsize" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
              <option value="3">#3 (3/8 in, 0.376 lb/ft)</option>
              <option value="4" selected>#4 (1/2 in, 0.668 lb/ft)</option>
              <option value="5">#5 (5/8 in, 1.043 lb/ft)</option>
              <option value="6">#6 (3/4 in, 1.502 lb/ft)</option>
              <option value="7">#7 (7/8 in, 2.044 lb/ft)</option>
              <option value="8">#8 (1 in, 2.670 lb/ft)</option>
            </select>
          </div>

          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Bar Spacing (inches on center)</label>
            <select id="rb-spacing" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
              <option value="6">6 inches OC</option>
              <option value="8">8 inches OC</option>
              <option value="10">10 inches OC</option>
              <option value="12" selected>12 inches OC</option>
              <option value="16">16 inches OC</option>
              <option value="18">18 inches OC</option>
              <option value="24">24 inches OC</option>
            </select>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Standard Bar Length (ft)</label>
                <input type="number" id="rb-barlength" class="w-full px-3 py-2 border border-border rounded-lg" value="20" min="1" step="1">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Overlap Length (inches)</label>
                <input type="number" id="rb-overlap" class="w-full px-3 py-2 border border-border rounded-lg" value="24" min="6" step="1">
              </div>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Linear Feet</div>
            <div class="text-5xl font-extrabold font-mono" id="rb-totalft">0</div>
            <div class="text-sm text-blue-200 mt-1">of rebar needed</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Bars (Length Dir)</div>
              <div class="text-xl font-bold" id="rb-bars-l">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Bars (Width Dir)</div>
              <div class="text-xl font-bold" id="rb-bars-w">0</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Weight</div>
              <div class="text-xl font-bold" id="rb-weight">0 lbs</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Overlap Splices</div>
              <div class="text-xl font-bold" id="rb-overlaps">0</div>
            </div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Bar Pieces</div>
            <div class="text-xl font-bold" id="rb-pieces">0</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="rebar" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Rebar for a Slab</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Bars per direction:</strong> (Slab dimension in inches / Spacing) + 1</p>
        <p><strong>Linear feet per direction:</strong> Bars x Slab dimension perpendicular</p>
        <p><strong>Weight:</strong> Total linear feet x Weight per foot for bar size</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Rebar Weight Per Foot by Size</h3>
      <ul>
        <li>#3 (3/8") - 0.376 lb/ft</li>
        <li>#4 (1/2") - 0.668 lb/ft</li>
        <li>#5 (5/8") - 1.043 lb/ft</li>
        <li>#6 (3/4") - 1.502 lb/ft</li>
        <li>#7 (7/8") - 2.044 lb/ft</li>
        <li>#8 (1") - 2.670 lb/ft</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What spacing should I use?</strong> 12" on center is standard for residential slabs. Use 6" for heavy-duty applications like driveways.</p>
      <p><strong>How much overlap is needed?</strong> Standard overlap (lap splice) is 24-30 bar diameters, typically 24" minimum for #4 bars.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const rbWeights: Record<string, number> = {
      '3': 0.376, '4': 0.668, '5': 1.043, '6': 1.502, '7': 2.044, '8': 2.670
    };

    function calcRebar() {
      const length = parseFloat((document.getElementById('rb-length') as HTMLInputElement).value) || 0;
      const width = parseFloat((document.getElementById('rb-width') as HTMLInputElement).value) || 0;
      const barSize = (document.getElementById('rb-barsize') as HTMLSelectElement).value;
      const spacing = parseFloat((document.getElementById('rb-spacing') as HTMLSelectElement).value) || 12;
      const barLength = parseFloat((document.getElementById('rb-barlength') as HTMLInputElement).value) || 20;
      const overlapIn = parseFloat((document.getElementById('rb-overlap') as HTMLInputElement).value) || 24;

      const barsAlongLength = Math.ceil((width * 12) / spacing) + 1;
      const barsAlongWidth = Math.ceil((length * 12) / spacing) + 1;

      const linearFtLength = barsAlongLength * length;
      const linearFtWidth = barsAlongWidth * width;
      const totalLinearFt = linearFtLength + linearFtWidth;

      const splicesPerBarL = length > barLength ? Math.ceil(length / barLength) - 1 : 0;
      const splicesPerBarW = width > barLength ? Math.ceil(width / barLength) - 1 : 0;
      const totalOverlaps = (barsAlongLength * splicesPerBarL) + (barsAlongWidth * splicesPerBarW);
      const overlapFt = totalOverlaps * (overlapIn / 12);

      const adjustedLinearFt = totalLinearFt + overlapFt;

      const piecesL = barsAlongLength * Math.max(1, Math.ceil(length / barLength));
      const piecesW = barsAlongWidth * Math.max(1, Math.ceil(width / barLength));
      const totalPieces = piecesL + piecesW;

      const weightPerFt = rbWeights[barSize] || 0.668;
      const totalWeight = adjustedLinearFt * weightPerFt;

      document.getElementById('rb-totalft')!.textContent = Math.ceil(adjustedLinearFt).toLocaleString();
      document.getElementById('rb-bars-l')!.textContent = String(barsAlongLength);
      document.getElementById('rb-bars-w')!.textContent = String(barsAlongWidth);
      document.getElementById('rb-weight')!.textContent = Math.round(totalWeight).toLocaleString() + ' lbs';
      document.getElementById('rb-overlaps')!.textContent = String(totalOverlaps);
      document.getElementById('rb-pieces')!.textContent = String(totalPieces);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('#rb-length, #rb-width, #rb-barlength, #rb-overlap').forEach(el => {
        el.addEventListener('input', calcRebar);
        el.addEventListener('change', calcRebar);
      });
      document.querySelectorAll('#rb-barsize, #rb-spacing').forEach(el => {
        el.addEventListener('input', calcRebar);
        el.addEventListener('change', calcRebar);
      });
      calcRebar();
    }, 50);
  </script>
</CalculatorLayout>
