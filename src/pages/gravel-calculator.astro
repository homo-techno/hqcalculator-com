---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Gravel Calculator - Tons, Yards & Cost Estimator";
const description = "Calculate how much gravel, sand, mulch, or topsoil you need. Get volume in cubic yards and weight in tons with cost estimates.";

const relatedCalcs = [
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume." },
  { name: "Square Footage", url: "/square-footage-calculator", description: "Area calculator." },
  { name: "Paint Calculator", url: "/paint-calculator", description: "Paint needed." },
  { name: "Length Converter", url: "/length-converter", description: "Length units." },
  { name: "Weight Converter", url: "/weight-converter", description: "Weight units." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Gravel Calculator"
  keywords="gravel calculator, how much gravel, cubic yards, gravel cost, landscaping calculator, mulch calculator, sand calculator"
  breadcrumbs={[{ name: "Gravel Calculator", url: "/gravel-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Gravel Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate how much gravel, sand, mulch, or soil you need for your project.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <!-- Material type -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Material</label>
            <div class="grid grid-cols-2 gap-2">
              <button class="gv-mat-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary" data-mat="gravel">Gravel</button>
              <button class="gv-mat-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-mat="sand">Sand</button>
              <button class="gv-mat-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-mat="mulch">Mulch</button>
              <button class="gv-mat-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-mat="topsoil">Topsoil</button>
              <button class="gv-mat-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-mat="crushed_stone">Crushed Stone</button>
              <button class="gv-mat-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-mat="river_rock">River Rock</button>
            </div>
          </div>

          <!-- Shape selector -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Area Shape</label>
            <div class="flex gap-2">
              <button class="gv-shape-btn px-4 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary" data-shape="rect">Rectangle</button>
              <button class="gv-shape-btn px-4 py-2 rounded-xl text-sm font-semibold border border-border" data-shape="circle">Circle</button>
              <button class="gv-shape-btn px-4 py-2 rounded-xl text-sm font-semibold border border-border" data-shape="triangle">Triangle</button>
            </div>
          </div>

          <!-- Rectangle -->
          <div id="gv-rect" class="mb-5">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Length (ft)</label>
                <input type="number" id="gv-length" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="20" min="0" step="0.5">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Width (ft)</label>
                <input type="number" id="gv-width" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="10" min="0" step="0.5">
              </div>
            </div>
          </div>

          <!-- Circle -->
          <div id="gv-circle" class="mb-5 hidden">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Diameter (ft)</label>
              <input type="number" id="gv-diameter" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="12" min="0" step="0.5">
            </div>
          </div>

          <!-- Triangle -->
          <div id="gv-triangle" class="mb-5 hidden">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Base (ft)</label>
                <input type="number" id="gv-base" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="15" min="0" step="0.5">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Height (ft)</label>
                <input type="number" id="gv-height" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="10" min="0" step="0.5">
              </div>
            </div>
          </div>

          <!-- Depth -->
          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Depth (inches)</label>
            <input type="number" id="gv-depth" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="3" min="0" step="0.5">
            <div class="flex gap-2 mt-2">
              <button class="gv-depth-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-d="2">2"</button>
              <button class="gv-depth-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-d="3">3"</button>
              <button class="gv-depth-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-d="4">4"</button>
              <button class="gv-depth-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-d="6">6"</button>
              <button class="gv-depth-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-d="12">12"</button>
            </div>
          </div>

          <!-- Cost -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <label class="block text-xs font-medium text-text mb-1">Price per Cubic Yard</label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
              <input type="number" id="gv-cost" class="w-full pl-7 pr-3 py-2 border border-border rounded-lg" value="50" min="0" step="5">
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="gv-mat-label">Gravel Needed</div>
            <div class="text-4xl font-extrabold" id="gv-yards">0</div>
            <div class="text-sm text-blue-200 mt-1">cubic yards</div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Cubic Feet</div>
              <div class="text-xl font-bold" id="gv-cuft">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Weight (tons)</div>
              <div class="text-xl font-bold" id="gv-tons">0</div>
            </div>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Estimated Cost</div>
            <div class="text-3xl font-bold text-secondary" id="gv-total-cost">$0</div>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Coverage Area</div>
            <div class="text-xl font-bold" id="gv-area">0 sq ft</div>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-2">Material Weight Reference</h3>
            <div class="grid grid-cols-2 gap-1 text-xs">
              <div class="flex justify-between p-1"><span>Gravel</span><span class="font-bold">2,700 lb/yd³</span></div>
              <div class="flex justify-between p-1"><span>Sand</span><span class="font-bold">2,700 lb/yd³</span></div>
              <div class="flex justify-between p-1"><span>Mulch</span><span class="font-bold">800 lb/yd³</span></div>
              <div class="flex justify-between p-1"><span>Topsoil</span><span class="font-bold">2,200 lb/yd³</span></div>
              <div class="flex justify-between p-1"><span>Crushed Stone</span><span class="font-bold">2,700 lb/yd³</span></div>
              <div class="flex justify-between p-1"><span>River Rock</span><span class="font-bold">2,600 lb/yd³</span></div>
            </div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="gravel" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Gravel Needed</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Volume (ft³)</strong> = Area (ft²) × Depth (ft)</p>
        <p><strong>Cubic Yards</strong> = Volume (ft³) ÷ 27</p>
        <p><strong>Tons</strong> = Cubic Yards × Material Density ÷ 2000</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Recommended Depths</h3>
      <ul>
        <li><strong>Driveway:</strong> 3-4 inches of gravel</li>
        <li><strong>Walkway:</strong> 2-3 inches</li>
        <li><strong>Mulch beds:</strong> 2-3 inches</li>
        <li><strong>Drainage:</strong> 6-12 inches</li>
        <li><strong>Foundation base:</strong> 4-6 inches of crushed stone</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How much does a cubic yard of gravel weigh?</strong> About 2,700 pounds (1.35 tons). Exact weight varies by gravel type and moisture content.</p>
      <p><strong>How much area does a cubic yard cover?</strong> At 3" deep, one cubic yard covers about 108 square feet. At 2" deep, it covers about 162 sq ft.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let gvShape = 'rect';
    let gvMat = 'gravel';

    // Density in lbs per cubic yard
    const density: Record<string, number> = {
      gravel: 2700, sand: 2700, mulch: 800, topsoil: 2200, crushed_stone: 2700, river_rock: 2600
    };
    const matNames: Record<string, string> = {
      gravel: 'Gravel', sand: 'Sand', mulch: 'Mulch', topsoil: 'Topsoil', crushed_stone: 'Crushed Stone', river_rock: 'River Rock'
    };

    function calcGravel() {
      const depth = (parseFloat((document.getElementById('gv-depth') as HTMLInputElement).value) || 0) / 12; // convert to feet
      const costPerYard = parseFloat((document.getElementById('gv-cost') as HTMLInputElement).value) || 0;

      let areaSqFt = 0;
      if (gvShape === 'rect') {
        const l = parseFloat((document.getElementById('gv-length') as HTMLInputElement).value) || 0;
        const w = parseFloat((document.getElementById('gv-width') as HTMLInputElement).value) || 0;
        areaSqFt = l * w;
      } else if (gvShape === 'circle') {
        const d = parseFloat((document.getElementById('gv-diameter') as HTMLInputElement).value) || 0;
        areaSqFt = Math.PI * (d / 2) ** 2;
      } else if (gvShape === 'triangle') {
        const b = parseFloat((document.getElementById('gv-base') as HTMLInputElement).value) || 0;
        const h = parseFloat((document.getElementById('gv-height') as HTMLInputElement).value) || 0;
        areaSqFt = 0.5 * b * h;
      }

      const cuFt = areaSqFt * depth;
      const cuYards = cuFt / 27;
      const tons = cuYards * density[gvMat] / 2000;
      const cost = cuYards * costPerYard;

      const fmt = (n: number) => n.toLocaleString('en-US', { maximumFractionDigits: 2 });

      document.getElementById('gv-mat-label')!.textContent = matNames[gvMat] + ' Needed';
      document.getElementById('gv-yards')!.textContent = cuYards.toFixed(2);
      document.getElementById('gv-cuft')!.textContent = fmt(cuFt);
      document.getElementById('gv-tons')!.textContent = tons.toFixed(2);
      document.getElementById('gv-total-cost')!.textContent = '$' + Math.round(cost).toLocaleString();
      document.getElementById('gv-area')!.textContent = fmt(areaSqFt) + ' sq ft';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.gv-mat-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.gv-mat-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          gvMat = (btn as HTMLElement).dataset.mat || 'gravel';
          calcGravel();
        });
      });

      document.querySelectorAll('.gv-shape-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.gv-shape-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          gvShape = (btn as HTMLElement).dataset.shape || 'rect';
          document.getElementById('gv-rect')!.classList.toggle('hidden', gvShape !== 'rect');
          document.getElementById('gv-circle')!.classList.toggle('hidden', gvShape !== 'circle');
          document.getElementById('gv-triangle')!.classList.toggle('hidden', gvShape !== 'triangle');
          calcGravel();
        });
      });

      document.querySelectorAll('.gv-depth-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          (document.getElementById('gv-depth') as HTMLInputElement).value = (btn as HTMLElement).dataset.d || '3';
          calcGravel();
        });
      });

      ['gv-length', 'gv-width', 'gv-diameter', 'gv-base', 'gv-height', 'gv-depth', 'gv-cost'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcGravel);
      });

      calcGravel();
    }, 50);
  </script>
</CalculatorLayout>
