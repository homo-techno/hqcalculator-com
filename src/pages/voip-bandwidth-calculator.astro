---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "VoIP Bandwidth Calculator - Call Bandwidth Estimator 2026";
const description = "Calculate VoIP bandwidth requirements based on codec, protocol overhead, and number of concurrent calls. Supports G.711, G.729, G.722, Opus, and more.";

const relatedCalcs = [
  { name: "Bandwidth Calculator", url: "/bandwidth-calculator", description: "Network bandwidth requirements." },
  { name: "Network Throughput Calculator", url: "/network-throughput-calculator", description: "TCP throughput estimation." },
  { name: "Network Latency Calculator", url: "/network-latency-calculator", description: "Round-trip latency estimation." },
  { name: "Data Transfer Calculator", url: "/data-transfer-calculator", description: "File transfer time estimation." },
  { name: "Network Availability Calculator", url: "/network-availability-calculator", description: "Uptime/downtime calculation." },
  { name: "IP Subnet Calculator", url: "/ip-subnet-calculator", description: "IP subnetting and CIDR." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="VoIP Bandwidth Calculator"
  keywords="VoIP bandwidth calculator, voice over IP, codec bandwidth, G.711, G.729, concurrent calls, VoIP overhead"
  breadcrumbs={[{ name: "VoIP Bandwidth Calculator", url: "/voip-bandwidth-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">VoIP Bandwidth Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate the network bandwidth needed for VoIP calls based on codec selection, protocol headers, and number of concurrent calls.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Codec</label>
        <select id="vob-codec" class="vob-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="g711" selected>G.711 (64 kbps, highest quality)</option>
          <option value="g729">G.729 (8 kbps, good compression)</option>
          <option value="g722">G.722 (64 kbps, HD voice)</option>
          <option value="g726_32">G.726 (32 kbps)</option>
          <option value="opus_16">Opus (16 kbps, low BW)</option>
          <option value="opus_32">Opus (32 kbps, balanced)</option>
          <option value="opus_64">Opus (64 kbps, high quality)</option>
          <option value="ilbc">iLBC (13.3 kbps)</option>
          <option value="custom">Custom codec bitrate</option>
        </select>
      </div>

      <div class="mb-4" id="vob-custom-wrap" style="display:none;">
        <label class="block text-sm font-medium text-text mb-1">Custom Codec Bitrate (kbps)</label>
        <input type="number" id="vob-custom-rate" class="vob-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="64" step="1" min="1">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Layer 2 Protocol</label>
        <select id="vob-l2" class="vob-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="ethernet" selected>Ethernet (18 bytes)</option>
          <option value="pppoe">PPPoE (26 bytes)</option>
          <option value="mpls">MPLS (22 bytes)</option>
          <option value="none">None (IP only)</option>
        </select>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Packetization Interval (ms)</label>
        <select id="vob-ptime" class="vob-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="10">10 ms</option>
          <option value="20" selected>20 ms (standard)</option>
          <option value="30">30 ms</option>
          <option value="40">40 ms</option>
          <option value="60">60 ms</option>
        </select>
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-text mb-1">Number of Concurrent Calls</label>
        <input type="number" id="vob-calls" class="vob-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" step="1" min="1">
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm font-medium text-blue-100 mb-1">Total Bandwidth Required</div>
        <div class="text-4xl font-extrabold" id="vob-total">--</div>
        <div class="text-sm text-blue-200 mt-1">Mbps</div>
      </div>

      <!-- Secondary Stats -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Per Call Bandwidth</div>
          <div class="text-xl font-bold text-text" id="vob-per-call">--</div>
          <div class="text-xs text-text-muted">kbps</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Codec Bitrate</div>
          <div class="text-xl font-bold text-text" id="vob-codec-rate">--</div>
          <div class="text-xs text-text-muted">kbps</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Overhead per Packet</div>
          <div class="text-xl font-bold text-text" id="vob-overhead">--</div>
          <div class="text-xs text-text-muted">bytes</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Packets per Second</div>
          <div class="text-xl font-bold text-text" id="vob-pps">--</div>
          <div class="text-xs text-text-muted">per call</div>
        </div>
      </div>

      <ShareButton calculatorId="voip-bandwidth" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">VoIP Bandwidth Calculation</h2>
      <p>VoIP bandwidth includes the codec payload plus protocol headers (IP, UDP, RTP, and Layer 2). The actual bandwidth is significantly higher than the codec bitrate due to header overhead.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono text-sm">
        Total per packet = L2 header + IP(20) + UDP(8) + RTP(12) + Payload
        <br>BW per call = Total_bytes * 8 * packets_per_second
      </div>
      <p>Shorter packetization intervals improve voice quality and reduce latency but increase bandwidth usage due to more frequent headers.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcVOB() {
      const codec = (document.getElementById('vob-codec') as HTMLSelectElement).value;
      const l2 = (document.getElementById('vob-l2') as HTMLSelectElement).value;
      const ptime = parseFloat((document.getElementById('vob-ptime') as HTMLSelectElement).value) || 20;
      const calls = parseFloat((document.getElementById('vob-calls') as HTMLInputElement).value) || 1;

      document.getElementById('vob-custom-wrap')!.style.display = codec === 'custom' ? '' : 'none';

      const codecRates: Record<string, number> = {
        g711: 64, g729: 8, g722: 64, g726_32: 32,
        opus_16: 16, opus_32: 32, opus_64: 64, ilbc: 13.3
      };

      let codecKbps = codecRates[codec] || 64;
      if (codec === 'custom') {
        codecKbps = parseFloat((document.getElementById('vob-custom-rate') as HTMLInputElement).value) || 64;
      }

      // Header sizes
      const l2Headers: Record<string, number> = { ethernet: 18, pppoe: 26, mpls: 22, none: 0 };
      const l2Header = l2Headers[l2] || 18;
      const ipHeader = 20;
      const udpHeader = 8;
      const rtpHeader = 12;
      const totalHeader = l2Header + ipHeader + udpHeader + rtpHeader;

      // Payload per packet
      const payloadBytes = (codecKbps * 1000 / 8) * (ptime / 1000);
      const totalPacketBytes = totalHeader + payloadBytes;

      // Packets per second
      const pps = 1000 / ptime;

      // Bandwidth per call in kbps
      const bwPerCallKbps = totalPacketBytes * 8 * pps / 1000;
      const totalBWMbps = bwPerCallKbps * calls / 1000;

      document.getElementById('vob-total')!.textContent = totalBWMbps.toFixed(2);
      document.getElementById('vob-per-call')!.textContent = bwPerCallKbps.toFixed(1);
      document.getElementById('vob-codec-rate')!.textContent = codecKbps.toFixed(1);
      document.getElementById('vob-overhead')!.textContent = totalHeader.toString();
      document.getElementById('vob-pps')!.textContent = pps.toFixed(0);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.vob-in').forEach(el => { el.addEventListener('input', calcVOB); el.addEventListener('change', calcVOB); });
      calcVOB();
    }, 50);
  </script>
</CalculatorLayout>
