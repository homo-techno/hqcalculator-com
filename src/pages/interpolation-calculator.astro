---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Interpolation Calculator - Linear Interpolation (Lerp)";
const description = "Perform linear interpolation between two known data points. Find the y value for any given x using the interpolation formula.";

const relatedCalcs = [
  { name: "Regression Calculator", url: "/regression-calculator", description: "Linear regression analysis." },
  { name: "Correlation Calculator", url: "/correlation-calculator", description: "Pearson correlation." },
  { name: "Average Calculator", url: "/average-calculator", description: "Mean, median, mode." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage calculations." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math operations." },
  { name: "Number Sequence", url: "/number-sequence-calculator", description: "Sequence pattern detection." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Interpolation Calculator"
  keywords="interpolation calculator, linear interpolation, lerp, data interpolation, find y value, two point formula"
  breadcrumbs={[{ name: "Interpolation Calculator", url: "/interpolation-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Interpolation Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find the interpolated y value between two known data points using linear interpolation.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <h3 class="font-semibold text-text">Point 1 (x<sub>1</sub>, y<sub>1</sub>)</h3>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">x<sub>1</sub></label>
            <input type="number" id="ip-x1" class="ip-in w-full px-4 py-2 border border-border rounded-xl text-lg" value="1" />
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">y<sub>1</sub></label>
            <input type="number" id="ip-y1" class="ip-in w-full px-4 py-2 border border-border rounded-xl text-lg" value="10" />
          </div>
        </div>

        <h3 class="font-semibold text-text">Point 2 (x<sub>2</sub>, y<sub>2</sub>)</h3>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">x<sub>2</sub></label>
            <input type="number" id="ip-x2" class="ip-in w-full px-4 py-2 border border-border rounded-xl text-lg" value="5" />
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">y<sub>2</sub></label>
            <input type="number" id="ip-y2" class="ip-in w-full px-4 py-2 border border-border rounded-xl text-lg" value="30" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-text mb-1">Find y for x =</label>
          <input type="number" id="ip-x" class="ip-in w-full px-4 py-2 border border-border rounded-xl text-lg" value="3" />
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Interpolated y</div>
          <div class="text-5xl font-extrabold font-mono" id="ip-result">0</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Slope (m)</div>
            <div class="text-xl font-bold" id="ip-slope">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Y-Intercept (b)</div>
            <div class="text-xl font-bold" id="ip-intercept">0</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Formula Step</h3>
          <div class="text-sm text-text-secondary font-mono whitespace-pre-wrap" id="ip-formula"></div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Line Equation</h3>
          <div class="text-sm text-text-secondary font-mono" id="ip-equation"></div>
        </div>
      </div>

      <ShareButton calculatorId="interpolation" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Linear Interpolation Formula</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm">
        <p>y = y<sub>1</sub> + (x - x<sub>1</sub>) &times; (y<sub>2</sub> - y<sub>1</sub>) / (x<sub>2</sub> - x<sub>1</sub>)</p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">When to Use</h3>
      <ul>
        <li>Estimating values between known data points</li>
        <li>Filling gaps in tables or charts</li>
        <li>Animation tweening and smooth transitions</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcIP() {
      const x1 = parseFloat((document.getElementById('ip-x1') as HTMLInputElement).value) || 0;
      const y1 = parseFloat((document.getElementById('ip-y1') as HTMLInputElement).value) || 0;
      const x2 = parseFloat((document.getElementById('ip-x2') as HTMLInputElement).value) || 0;
      const y2 = parseFloat((document.getElementById('ip-y2') as HTMLInputElement).value) || 0;
      const x = parseFloat((document.getElementById('ip-x') as HTMLInputElement).value) || 0;

      const fmt = (n: number) => Number.isInteger(n) ? String(n) : n.toFixed(4);

      if (x2 === x1) {
        document.getElementById('ip-result')!.textContent = 'Undefined';
        document.getElementById('ip-slope')!.textContent = 'Undefined';
        document.getElementById('ip-intercept')!.textContent = '—';
        document.getElementById('ip-formula')!.textContent = 'x1 and x2 cannot be equal.';
        document.getElementById('ip-equation')!.textContent = '—';
        document.dispatchEvent(new CustomEvent('calc-update'));
        return;
      }

      const slope = (y2 - y1) / (x2 - x1);
      const intercept = y1 - slope * x1;
      const y = y1 + (x - x1) * slope;

      document.getElementById('ip-result')!.textContent = fmt(y);
      document.getElementById('ip-slope')!.textContent = fmt(slope);
      document.getElementById('ip-intercept')!.textContent = fmt(intercept);

      const formula = `y = y1 + (x - x1) × (y2 - y1) / (x2 - x1)\ny = ${y1} + (${x} - ${x1}) × (${y2} - ${y1}) / (${x2} - ${x1})\ny = ${y1} + ${fmt(x - x1)} × ${fmt(y2 - y1)} / ${fmt(x2 - x1)}\ny = ${y1} + ${fmt((x - x1) * slope)}\ny = ${fmt(y)}`;

      document.getElementById('ip-formula')!.textContent = formula;
      document.getElementById('ip-equation')!.textContent = `y = ${fmt(slope)}x + ${fmt(intercept)}`;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.ip-in').forEach(el => {
        el.addEventListener('input', calcIP);
        el.addEventListener('change', calcIP);
      });
      calcIP();
    }, 50);
  </script>
</CalculatorLayout>
