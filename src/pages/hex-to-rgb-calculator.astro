---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Hex to RGB Calculator - Color Converter with HSL";
const description = "Convert hex color codes to RGB and HSL values. Includes a live color preview swatch.";

const relatedCalcs = [
  { name: "Binary to Text", url: "/binary-to-text-calculator", description: "Binary/text converter." },
  { name: "Boolean Algebra", url: "/boolean-algebra-calculator", description: "Boolean logic operations." },
  { name: "Base64 Calculator", url: "/base64-calculator", description: "Base64 encode/decode." },
  { name: "JSON Formatter", url: "/json-formatter-calculator", description: "JSON format/validate." },
  { name: "Hash Generator", url: "/hash-generator-calculator", description: "Text hash generator." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage calculations." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Hex to RGB Calculator"
  keywords="hex to rgb, color converter, hex color, rgb values, hsl converter, color preview, css colors"
  breadcrumbs={[{ name: "Hex to RGB Calculator", url: "/hex-to-rgb-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Hex to RGB Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Enter a hex color code to get RGB and HSL values with a live color preview.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Hex Color Code</label>
          <input type="text" id="hr-hex" class="hr-in w-full px-4 py-2 border border-border rounded-xl text-lg font-mono" value="#3B82F6" placeholder="#3B82F6" />
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Color Preview</div>
          <div id="hr-swatch" class="w-32 h-32 rounded-xl mx-auto border-4 border-white/30 shadow-lg" style="background-color: #3B82F6;"></div>
          <div class="text-2xl font-extrabold font-mono mt-3" id="hr-result">#3B82F6</div>
        </div>

        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Red (R)</div>
            <div class="text-xl font-bold" id="hr-r">59</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Green (G)</div>
            <div class="text-xl font-bold" id="hr-g">130</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Blue (B)</div>
            <div class="text-xl font-bold" id="hr-b">246</div>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Hue (H)</div>
            <div class="text-xl font-bold" id="hr-h">217&deg;</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Saturation (S)</div>
            <div class="text-xl font-bold" id="hr-s">91%</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Lightness (L)</div>
            <div class="text-xl font-bold" id="hr-l">60%</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">CSS Values</h3>
          <div class="text-sm text-text-secondary font-mono whitespace-pre-wrap" id="hr-css"></div>
        </div>
      </div>

      <ShareButton calculatorId="hex-to-rgb" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Color Code Formats</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Hex:</strong> #RRGGBB (e.g., #FF5733)</p>
        <p><strong>RGB:</strong> rgb(R, G, B) where each is 0-255</p>
        <p><strong>HSL:</strong> hsl(H, S%, L%) where H is 0-360</p>
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcHR() {
      let hex = (document.getElementById('hr-hex') as HTMLInputElement).value.trim();
      hex = hex.replace(/^#/, '');

      // Handle 3-char shorthand
      if (/^[0-9A-Fa-f]{3}$/.test(hex)) {
        hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
      }

      if (!/^[0-9A-Fa-f]{6}$/.test(hex)) {
        document.getElementById('hr-result')!.textContent = 'Invalid hex';
        document.getElementById('hr-r')!.textContent = '—';
        document.getElementById('hr-g')!.textContent = '—';
        document.getElementById('hr-b')!.textContent = '—';
        document.getElementById('hr-h')!.textContent = '—';
        document.getElementById('hr-s')!.textContent = '—';
        document.getElementById('hr-l')!.textContent = '—';
        document.getElementById('hr-css')!.textContent = '';
        document.dispatchEvent(new CustomEvent('calc-update'));
        return;
      }

      const r = parseInt(hex.substring(0, 2), 16);
      const g = parseInt(hex.substring(2, 4), 16);
      const b = parseInt(hex.substring(4, 6), 16);

      // RGB to HSL
      const rN = r / 255, gN = g / 255, bN = b / 255;
      const max = Math.max(rN, gN, bN);
      const min = Math.min(rN, gN, bN);
      const l = (max + min) / 2;
      let h = 0, s = 0;

      if (max !== min) {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        if (max === rN) h = ((gN - bN) / d + (gN < bN ? 6 : 0)) / 6;
        else if (max === gN) h = ((bN - rN) / d + 2) / 6;
        else h = ((rN - gN) / d + 4) / 6;
      }

      const hDeg = Math.round(h * 360);
      const sPct = Math.round(s * 100);
      const lPct = Math.round(l * 100);

      const fullHex = '#' + hex.toUpperCase();

      document.getElementById('hr-result')!.textContent = fullHex;
      (document.getElementById('hr-swatch') as HTMLElement).style.backgroundColor = fullHex;
      document.getElementById('hr-r')!.textContent = String(r);
      document.getElementById('hr-g')!.textContent = String(g);
      document.getElementById('hr-b')!.textContent = String(b);
      document.getElementById('hr-h')!.innerHTML = hDeg + '&deg;';
      document.getElementById('hr-s')!.textContent = sPct + '%';
      document.getElementById('hr-l')!.textContent = lPct + '%';

      let css = `Hex:  ${fullHex}\n`;
      css += `RGB:  rgb(${r}, ${g}, ${b})\n`;
      css += `RGBA: rgba(${r}, ${g}, ${b}, 1.0)\n`;
      css += `HSL:  hsl(${hDeg}, ${sPct}%, ${lPct}%)\n`;
      css += `HSLA: hsla(${hDeg}, ${sPct}%, ${lPct}%, 1.0)`;
      document.getElementById('hr-css')!.textContent = css;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.hr-in').forEach(el => {
        el.addEventListener('input', calcHR);
        el.addEventListener('change', calcHR);
      });
      calcHR();
    }, 50);
  </script>
</CalculatorLayout>
