---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Quilt Calculator - Size, Fabric & Batting";
const description = "Calculate quilt size from block count and size, fabric yardage, batting needed, and binding length for your quilting project.";
const relatedCalcs = [
  { name: "Fabric Calculator", url: "/fabric-calculator", description: "Fabric yardage for sewing." },
  { name: "Area Calculator", url: "/area-calculator", description: "Calculate area." },
  { name: "Square Footage", url: "/square-footage-calculator", description: "Square footage." },
  { name: "Wallpaper Calculator", url: "/wallpaper-calculator", description: "Wallpaper yardage." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Budget planning." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Quilt Calculator" keywords="quilt calculator, quilt size, fabric yardage, batting calculator, binding length, quilting" breadcrumbs={[{ name: "Quilt Calculator", url: "/quilt-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Quilt Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate quilt dimensions, fabric yardage, batting, and binding from block count and size.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Blocks Across</label><input type="number" id="qc-ba" class="qc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="1" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Blocks Down</label><input type="number" id="qc-bd" class="qc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="1" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Block Size (inches)</label><input type="number" id="qc-bs" class="qc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="1" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Sashing Width (inches)</label><input type="number" id="qc-sw" class="qc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="0" step="0.25"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Border Width (inches)</label><input type="number" id="qc-bw" class="qc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" min="0" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Seam Allowance (inches)</label><input type="number" id="qc-sa" class="qc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.25" min="0" max="1" step="0.125"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Fabric Width (inches)</label><input type="number" id="qc-fw" class="qc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="44" min="36" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Fabric Price ($/yard)</label><input type="number" id="qc-fp" class="qc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="0" step="0.5"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Finished Quilt Size</div>
          <div class="text-4xl font-extrabold font-mono" id="qc-result">0 x 0 in</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Block Fabric</div><div class="text-xl font-bold font-mono" id="qc-block-yd">0 yd</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Sashing Fabric</div><div class="text-xl font-bold font-mono" id="qc-sash-yd">0 yd</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Border Fabric</div><div class="text-xl font-bold font-mono" id="qc-border-yd">0 yd</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Backing Fabric</div><div class="text-xl font-bold font-mono" id="qc-back-yd">0 yd</div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Batting</div><div class="text-xl font-bold font-mono" id="qc-batt">0 yd</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Binding</div><div class="text-xl font-bold font-mono" id="qc-bind">0 in</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Est. Cost</div><div class="text-xl font-bold font-mono" id="qc-cost">$0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="quilt" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcQC() {
      const ba = parseInt((document.getElementById('qc-ba') as HTMLInputElement).value) || 5;
      const bd = parseInt((document.getElementById('qc-bd') as HTMLInputElement).value) || 6;
      const bs = parseFloat((document.getElementById('qc-bs') as HTMLInputElement).value) || 12;
      const sw = parseFloat((document.getElementById('qc-sw') as HTMLInputElement).value) || 0;
      const bw = parseFloat((document.getElementById('qc-bw') as HTMLInputElement).value) || 0;
      const sa = parseFloat((document.getElementById('qc-sa') as HTMLInputElement).value) || 0.25;
      const fw = parseFloat((document.getElementById('qc-fw') as HTMLInputElement).value) || 44;
      const fp = parseFloat((document.getElementById('qc-fp') as HTMLInputElement).value) || 0;

      // Quilt center dimensions (blocks + sashing)
      const centerW = ba * bs + (ba - 1) * sw;
      const centerH = bd * bs + (bd - 1) * sw;
      const finW = centerW + 2 * bw;
      const finH = centerH + 2 * bw;

      document.getElementById('qc-result')!.textContent = finW.toFixed(1) + ' x ' + finH.toFixed(1) + ' in';

      // Block fabric: each block cut size = block size + 2*seam allowance
      const totalBlocks = ba * bd;
      const cutSize = bs + 2 * sa;
      const blocksPerRow = Math.floor(fw / cutSize);
      const rowsNeeded = Math.ceil(totalBlocks / blocksPerRow);
      const blockFabricIn = rowsNeeded * cutSize;
      const blockFabricYd = Math.ceil(blockFabricIn / 36 * 8) / 8;

      // Sashing fabric
      const hSashes = ba * (bd - 1); // horizontal
      const vSashes = (ba - 1) * bd; // vertical
      const sashCutLen = bs + 2 * sa;
      const sashCutW = sw + 2 * sa;
      const sashPerRow = sw > 0 ? Math.floor(fw / sashCutW) : 0;
      const totalSashes = hSashes + vSashes;
      const sashRows = sashPerRow > 0 ? Math.ceil(totalSashes / sashPerRow) : 0;
      const sashFabricIn = sashRows * sashCutLen;
      const sashFabricYd = Math.ceil(sashFabricIn / 36 * 8) / 8;

      // Border fabric: need 2 strips of finW + 2 strips of finH, each bw wide
      const borderStripsIn = bw > 0 ? (2 * (finW + 2 * sa) + 2 * (finH + 2 * sa)) : 0;
      const borderCutW = bw + 2 * sa;
      const borderStripsPerWidth = bw > 0 ? Math.floor(fw / borderCutW) : 0;
      const borderSets = borderStripsPerWidth > 0 ? Math.ceil(4 / borderStripsPerWidth) : 0;
      const longerSide = Math.max(finW, finH) + 4;
      const borderFabricIn = borderSets * longerSide;
      const borderFabricYd = bw > 0 ? Math.ceil(borderFabricIn / 36 * 8) / 8 : 0;

      // Backing fabric: quilt size + 4 inches each side
      const backW = finW + 8;
      const backH = finH + 8;
      const backPanels = Math.ceil(backW / fw);
      const backFabricIn = backPanels * backH;
      const backFabricYd = Math.ceil(backFabricIn / 36 * 8) / 8;

      // Batting
      const battW = finW + 4;
      const battH = finH + 4;
      const battSqIn = battW * battH;
      const battYd = Math.ceil(battSqIn / (36 * 36) * 4) / 4;

      // Binding: perimeter + 12 inches extra
      const bindingLen = 2 * (finW + finH) + 12;
      const bindingYd = Math.ceil(bindingLen / 36 * 4) / 4;

      // Total cost estimate
      const totalYd = blockFabricYd + sashFabricYd + borderFabricYd + backFabricYd + bindingYd;
      const totalCost = totalYd * fp;

      document.getElementById('qc-block-yd')!.textContent = blockFabricYd.toFixed(2) + ' yd';
      document.getElementById('qc-sash-yd')!.textContent = sashFabricYd.toFixed(2) + ' yd';
      document.getElementById('qc-border-yd')!.textContent = borderFabricYd.toFixed(2) + ' yd';
      document.getElementById('qc-back-yd')!.textContent = backFabricYd.toFixed(2) + ' yd';
      document.getElementById('qc-batt')!.textContent = battYd.toFixed(2) + ' yd\u00B2';
      document.getElementById('qc-bind')!.textContent = bindingLen.toFixed(0) + ' in';
      document.getElementById('qc-cost')!.textContent = '$' + totalCost.toFixed(2);
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.qc-in').forEach(el => { el.addEventListener('input', calcQC); el.addEventListener('change', calcQC); });
      calcQC();
    }, 50);
  </script>
</CalculatorLayout>
