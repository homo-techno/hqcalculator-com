---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Weight Converter - Convert Between Weight & Mass Units";
const description = "Convert between pounds, kilograms, ounces, grams, stones, and more. Instant weight and mass unit conversion calculator.";

const relatedCalcs = [
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body Mass Index." },
  { name: "Temperature Converter", url: "/temperature-converter", description: "Temperature units." },
  { name: "Length Converter", url: "/length-converter", description: "Length units." },
  { name: "Ideal Weight", url: "/ideal-weight-calculator", description: "Ideal weight." },
  { name: "Macro Calculator", url: "/macro-calculator", description: "Macros." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calories." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Weight Converter"
  keywords="weight converter, kg to lbs, pounds to kilograms, ounces to grams, stone converter, mass converter"
  breadcrumbs={[{ name: "Weight Converter", url: "/weight-converter" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Weight Converter</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert between any weight and mass units instantly.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="flex items-end gap-3 mb-6">
        <div class="flex-1">
          <label class="block text-sm font-medium text-text mb-1">Value</label>
          <input type="number" id="wt-val" class="w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="1" step="any">
        </div>
        <div class="flex-1">
          <label class="block text-sm font-medium text-text mb-1">From</label>
          <select id="wt-from" class="w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="kg" selected>Kilograms (kg)</option>
            <option value="g">Grams (g)</option>
            <option value="mg">Milligrams (mg)</option>
            <option value="lb">Pounds (lb)</option>
            <option value="oz">Ounces (oz)</option>
            <option value="st">Stones (st)</option>
            <option value="t">Metric Tons (t)</option>
            <option value="ton">US Tons (short)</option>
            <option value="ug">Micrograms (μg)</option>
          </select>
        </div>
      </div>

      <div class="text-center text-text-muted text-2xl mb-4">↓ converts to ↓</div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-6" id="wt-results"></div>

      <div class="flex flex-wrap gap-2 mb-6">
        <button class="wt-swap px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-from="lb" data-val="1">1 lb</button>
        <button class="wt-swap px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-from="kg" data-val="1">1 kg</button>
        <button class="wt-swap px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-from="oz" data-val="1">1 oz</button>
        <button class="wt-swap px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-from="st" data-val="1">1 stone</button>
        <button class="wt-swap px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-from="lb" data-val="150">150 lbs</button>
        <button class="wt-swap px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-from="g" data-val="100">100 g</button>
      </div>

      <ShareButton calculatorId="weight" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Weight Conversion Reference</h2>
      <ul>
        <li>1 pound (lb) = 0.45359 kilograms = 16 ounces</li>
        <li>1 kilogram (kg) = 2.20462 pounds = 35.274 ounces</li>
        <li>1 ounce (oz) = 28.3495 grams</li>
        <li>1 stone = 14 pounds = 6.35029 kg</li>
        <li>1 metric ton = 1,000 kg = 2,204.62 lbs</li>
        <li>1 US ton (short ton) = 2,000 lbs = 907.185 kg</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How many kg in a pound?</strong> 1 pound = 0.453592 kg. To convert lbs to kg, multiply by 0.4536 (or divide by 2.2046).</p>
      <p><strong>What's the difference between mass and weight?</strong> Mass is the amount of matter (measured in kg), while weight is the force of gravity on that mass (measured in Newtons). On Earth's surface, they're proportional.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const units: Record<string, { name: string; toKg: number; abbr: string }> = {
      ug: { name: 'Micrograms', toKg: 1e-9, abbr: 'μg' },
      mg: { name: 'Milligrams', toKg: 1e-6, abbr: 'mg' },
      g: { name: 'Grams', toKg: 0.001, abbr: 'g' },
      kg: { name: 'Kilograms', toKg: 1, abbr: 'kg' },
      t: { name: 'Metric Tons', toKg: 1000, abbr: 't' },
      oz: { name: 'Ounces', toKg: 0.0283495, abbr: 'oz' },
      lb: { name: 'Pounds', toKg: 0.453592, abbr: 'lb' },
      st: { name: 'Stones', toKg: 6.35029, abbr: 'st' },
      ton: { name: 'US Tons', toKg: 907.185, abbr: 'ton' },
    };

    function formatNum(n: number): string {
      if (n === 0) return '0';
      if (Math.abs(n) >= 1e6 || (Math.abs(n) < 0.001 && n !== 0)) return n.toExponential(4);
      if (Number.isInteger(n)) return n.toLocaleString();
      return n.toLocaleString('en-US', { maximumSignificantDigits: 8 });
    }

    function calcWeight() {
      const val = parseFloat((document.getElementById('wt-val') as HTMLInputElement).value) || 0;
      const from = (document.getElementById('wt-from') as HTMLSelectElement).value;
      const kg = val * units[from].toKg;

      document.getElementById('wt-results')!.innerHTML = Object.entries(units).map(([key, u]) => {
        const converted = kg / u.toKg;
        const isSource = key === from;
        return `<div class="p-4 rounded-xl text-center ${isSource ? 'bg-primary text-white' : 'bg-surface-alt'}">
          <div class="text-xs ${isSource ? 'text-blue-200' : 'text-text-muted'} uppercase">${u.name} (${u.abbr})</div>
          <div class="text-xl font-bold">${formatNum(converted)}</div>
        </div>`;
      }).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.getElementById('wt-val')!.addEventListener('input', calcWeight);
      document.getElementById('wt-from')!.addEventListener('change', calcWeight);

      document.querySelectorAll('.wt-swap').forEach(btn => {
        btn.addEventListener('click', () => {
          (document.getElementById('wt-val') as HTMLInputElement).value = (btn as HTMLElement).dataset.val || '1';
          (document.getElementById('wt-from') as HTMLSelectElement).value = (btn as HTMLElement).dataset.from || 'kg';
          calcWeight();
        });
      });

      calcWeight();
    }, 50);
  </script>
</CalculatorLayout>
