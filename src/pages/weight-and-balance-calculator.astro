---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Weight and Balance Calculator - Aircraft CG & Moment";
const description = "Calculate aircraft weight and balance with CG position, moment, and envelope check. Enter item weights and arms for accurate loading.";
const relatedCalcs = [
  { name: "Force Calculator", url: "/force-calculator", description: "Force calculations." },
  { name: "Momentum Calculator", url: "/momentum-calculator", description: "Momentum physics." },
  { name: "Luggage Weight", url: "/luggage-weight-calculator", description: "Check luggage limits." },
  { name: "Fuel Efficiency", url: "/fuel-efficiency-converter", description: "Fuel conversions." },
  { name: "Speed Calculator", url: "/speed-calculator", description: "Speed computations." },
  { name: "Bearing Calculator", url: "/bearing-calculator", description: "Bearing angles." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Weight and Balance Calculator" keywords="weight and balance, aircraft CG, center of gravity, moment calculation, loading envelope, aviation safety" breadcrumbs={[{ name: "Weight & Balance", url: "/weight-and-balance-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Weight and Balance Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate aircraft center of gravity and total moment from item weights and arm stations.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-3 gap-3">
          <div class="text-xs font-bold text-text-muted uppercase">Item</div>
          <div class="text-xs font-bold text-text-muted uppercase">Weight (lbs)</div>
          <div class="text-xs font-bold text-text-muted uppercase">Arm (in)</div>
        </div>
        <div class="grid grid-cols-3 gap-3 items-center">
          <div class="text-sm font-medium text-text">Empty Aircraft</div>
          <input type="number" id="wb3-w1" class="wb3-in w-full border border-border rounded-lg px-3 py-2" min="0" step="1" />
          <input type="number" id="wb3-a1" class="wb3-in w-full border border-border rounded-lg px-3 py-2" step="0.1" />
        </div>
        <div class="grid grid-cols-3 gap-3 items-center">
          <div class="text-sm font-medium text-text">Pilot + Front Pax</div>
          <input type="number" id="wb3-w2" class="wb3-in w-full border border-border rounded-lg px-3 py-2" min="0" step="1" />
          <input type="number" id="wb3-a2" class="wb3-in w-full border border-border rounded-lg px-3 py-2" step="0.1" />
        </div>
        <div class="grid grid-cols-3 gap-3 items-center">
          <div class="text-sm font-medium text-text">Rear Passengers</div>
          <input type="number" id="wb3-w3" class="wb3-in w-full border border-border rounded-lg px-3 py-2" min="0" step="1" />
          <input type="number" id="wb3-a3" class="wb3-in w-full border border-border rounded-lg px-3 py-2" step="0.1" />
        </div>
        <div class="grid grid-cols-3 gap-3 items-center">
          <div class="text-sm font-medium text-text">Fuel</div>
          <input type="number" id="wb3-w4" class="wb3-in w-full border border-border rounded-lg px-3 py-2" min="0" step="1" />
          <input type="number" id="wb3-a4" class="wb3-in w-full border border-border rounded-lg px-3 py-2" step="0.1" />
        </div>
        <div class="grid grid-cols-3 gap-3 items-center">
          <div class="text-sm font-medium text-text">Baggage</div>
          <input type="number" id="wb3-w5" class="wb3-in w-full border border-border rounded-lg px-3 py-2" min="0" step="1" />
          <input type="number" id="wb3-a5" class="wb3-in w-full border border-border rounded-lg px-3 py-2" step="0.1" />
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label for="wb3-fwd" class="block text-sm font-medium text-text mb-1">Fwd CG Limit (in)</label>
            <input type="number" id="wb3-fwd" class="wb3-in w-full border border-border rounded-lg px-3 py-2" step="0.1" />
          </div>
          <div>
            <label for="wb3-aft" class="block text-sm font-medium text-text mb-1">Aft CG Limit (in)</label>
            <input type="number" id="wb3-aft" class="wb3-in w-full border border-border rounded-lg px-3 py-2" step="0.1" />
          </div>
        </div>
        <div>
          <label for="wb3-mgw" class="block text-sm font-medium text-text mb-1">Max Gross Weight (lbs)</label>
          <input type="number" id="wb3-mgw" class="wb3-in w-full border border-border rounded-lg px-3 py-2" min="0" step="1" />
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Center of Gravity</div>
          <div class="text-5xl font-extrabold font-mono" id="wb3-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Weight</div>
            <div class="text-xl font-bold font-mono" id="wb3-tw">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Moment</div>
            <div class="text-xl font-bold font-mono" id="wb3-tm">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Weight Status</div>
            <div class="text-xl font-bold font-mono" id="wb3-ws">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">CG Envelope</div>
            <div class="text-xl font-bold font-mono" id="wb3-env">--</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="weight-and-balance" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcWB3() {
      const ids = [1,2,3,4,5];
      let totalWeight = 0;
      let totalMoment = 0;
      ids.forEach(i => {
        const w = parseFloat((document.getElementById('wb3-w' + i) as HTMLInputElement).value) || 0;
        const a = parseFloat((document.getElementById('wb3-a' + i) as HTMLInputElement).value) || 0;
        totalWeight += w;
        totalMoment += w * a;
      });
      const cg = totalWeight > 0 ? totalMoment / totalWeight : 0;
      const fwd = parseFloat((document.getElementById('wb3-fwd') as HTMLInputElement).value) || 35;
      const aft = parseFloat((document.getElementById('wb3-aft') as HTMLInputElement).value) || 47.3;
      const mgw = parseFloat((document.getElementById('wb3-mgw') as HTMLInputElement).value) || 2550;

      document.getElementById('wb3-result')!.textContent = cg.toFixed(2) + ' in';
      document.getElementById('wb3-tw')!.textContent = totalWeight.toLocaleString() + ' lbs';
      document.getElementById('wb3-tm')!.textContent = totalMoment.toLocaleString(undefined, {maximumFractionDigits:0}) + ' in-lbs';

      const overweight = totalWeight > mgw;
      document.getElementById('wb3-ws')!.textContent = overweight ? 'OVER MAX (' + (totalWeight - mgw) + ' lbs)' : 'Within Limits';
      (document.getElementById('wb3-ws')! as HTMLElement).style.color = overweight ? '#dc2626' : '#16a34a';

      let envStatus = 'N/A';
      let envColor = '#6b7280';
      if (totalWeight > 0) {
        if (cg < fwd) { envStatus = 'FWD of Limit'; envColor = '#dc2626'; }
        else if (cg > aft) { envStatus = 'AFT of Limit'; envColor = '#dc2626'; }
        else { envStatus = 'Within Envelope'; envColor = '#16a34a'; }
      }
      document.getElementById('wb3-env')!.textContent = envStatus;
      (document.getElementById('wb3-env')! as HTMLElement).style.color = envColor;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      (document.getElementById('wb3-w1') as HTMLInputElement).value = '1500';
      (document.getElementById('wb3-a1') as HTMLInputElement).value = '38.5';
      (document.getElementById('wb3-w2') as HTMLInputElement).value = '340';
      (document.getElementById('wb3-a2') as HTMLInputElement).value = '37.0';
      (document.getElementById('wb3-w3') as HTMLInputElement).value = '170';
      (document.getElementById('wb3-a3') as HTMLInputElement).value = '73.0';
      (document.getElementById('wb3-w4') as HTMLInputElement).value = '336';
      (document.getElementById('wb3-a4') as HTMLInputElement).value = '48.0';
      (document.getElementById('wb3-w5') as HTMLInputElement).value = '50';
      (document.getElementById('wb3-a5') as HTMLInputElement).value = '95.0';
      (document.getElementById('wb3-fwd') as HTMLInputElement).value = '35.0';
      (document.getElementById('wb3-aft') as HTMLInputElement).value = '47.3';
      (document.getElementById('wb3-mgw') as HTMLInputElement).value = '2550';
      document.querySelectorAll('.wb3-in').forEach(el => { el.addEventListener('input', calcWB3); el.addEventListener('change', calcWB3); });
      calcWB3();
    }, 50);
  </script>
</CalculatorLayout>
