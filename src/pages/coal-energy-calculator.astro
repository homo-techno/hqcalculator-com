---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Coal Energy Calculator - BTU, Electricity & CO2 Emissions";
const description = "Calculate BTU per ton by coal rank, electricity generation potential, and CO2 emissions for anthracite, bituminous, sub-bituminous, and lignite coal.";
const relatedCalcs = [
  { name: "Energy Converter", url: "/energy-converter", description: "Energy units." },
  { name: "Carbon Footprint", url: "/carbon-footprint-calculator", description: "Carbon emissions." },
  { name: "Carbon Offset", url: "/carbon-offset-calculator", description: "Offset carbon." },
  { name: "Kinetic Energy", url: "/kinetic-energy-calculator", description: "Energy of motion." },
  { name: "Heat Transfer", url: "/heat-transfer-calculator", description: "Heat transfer." },
  { name: "Weight Converter", url: "/weight-converter", description: "Weight units." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Coal Energy Calculator" keywords="coal energy, BTU, coal rank, anthracite, bituminous, lignite, electricity generation, CO2 emissions" breadcrumbs={[{ name: "Coal Energy", url: "/coal-energy-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Coal Energy Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate energy content (BTU), electricity generation potential, and CO2 emissions by coal type and quantity.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Coal Rank</label>
          <select id="ce2-rank" class="ce2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="anthracite">Anthracite (highest grade)</option>
            <option value="bituminous" selected>Bituminous (most common)</option>
            <option value="subbituminous">Sub-bituminous</option>
            <option value="lignite">Lignite (brown coal)</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Coal Quantity (tonnes)</label>
            <input type="number" id="ce2-tons" class="ce2-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="1000" min="0" step="100">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Plant Efficiency (%)</label>
            <input type="number" id="ce2-eff" class="ce2-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="33" min="1" max="60" step="1">
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Moisture Content (%)</label>
          <input type="number" id="ce2-moisture" class="ce2-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="5" min="0" max="60" step="1">
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Energy Content</div>
          <div class="text-4xl font-extrabold" id="ce2-btu">0</div>
          <div class="text-sm text-blue-200 mt-1">million BTU</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">BTU per Ton</div>
            <div class="text-xl font-bold" id="ce2-pertan">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Energy (GJ)</div>
            <div class="text-xl font-bold" id="ce2-gj">0</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Electricity (MWh)</div>
            <div class="text-xl font-bold" id="ce2-mwh">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Homes Powered (1 yr)</div>
            <div class="text-xl font-bold" id="ce2-homes">0</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">CO2 Emissions</div>
            <div class="text-xl font-bold" id="ce2-co2">0 tonnes</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">CO2 per MWh</div>
            <div class="text-xl font-bold" id="ce2-co2mwh">0 kg</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-muted uppercase mb-2">Coal Rank Comparison</div>
          <div class="space-y-1 text-xs">
            <div class="flex justify-between"><span>Anthracite</span><span class="font-bold">25-26 million BTU/ton</span></div>
            <div class="flex justify-between"><span>Bituminous</span><span class="font-bold">21-24 million BTU/ton</span></div>
            <div class="flex justify-between"><span>Sub-bituminous</span><span class="font-bold">17-20 million BTU/ton</span></div>
            <div class="flex justify-between"><span>Lignite</span><span class="font-bold">9-14 million BTU/ton</span></div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="coal-energy" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Coal Energy Calculations</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Total BTU</strong> = Tonnes x BTU/ton x (1 - Moisture%)</p>
        <p><strong>Electricity (kWh)</strong> = BTU x 0.000293071 x Efficiency</p>
        <p><strong>CO2</strong> = Tonnes x Emission Factor (by rank)</p>
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcCE2() {
      const rankData: Record<string, { btu: number; co2: number; carbon: number }> = {
        anthracite:    { btu: 25500000, co2: 2.86, carbon: 93 },
        bituminous:    { btu: 22500000, co2: 2.42, carbon: 80 },
        subbituminous: { btu: 18500000, co2: 1.86, carbon: 60 },
        lignite:       { btu: 12500000, co2: 1.29, carbon: 40 },
      };

      const rank = (document.getElementById('ce2-rank') as HTMLSelectElement).value;
      const tons = parseFloat((document.getElementById('ce2-tons') as HTMLInputElement).value) || 0;
      const eff = (parseFloat((document.getElementById('ce2-eff') as HTMLInputElement).value) || 0) / 100;
      const moisture = (parseFloat((document.getElementById('ce2-moisture') as HTMLInputElement).value) || 0) / 100;

      const data = rankData[rank] || rankData.bituminous;
      const effectiveBtu = data.btu * (1 - moisture);
      const totalBtu = tons * effectiveBtu;
      const totalBtuMillion = totalBtu / 1e6;
      const totalGJ = totalBtu * 0.00000105506;
      const totalMWh = totalBtu * 0.000000293071 * eff;
      const homes = totalMWh / 10.5;
      const co2Total = tons * data.co2;
      const co2PerMwh = totalMWh > 0 ? (co2Total * 1000) / totalMWh : 0;

      const fmt = (n: number) => n.toLocaleString('en-US', { maximumFractionDigits: 1 });

      document.getElementById('ce2-btu')!.textContent = fmt(totalBtuMillion);
      document.getElementById('ce2-pertan')!.textContent = fmt(effectiveBtu / 1e6) + ' M BTU/ton';
      document.getElementById('ce2-gj')!.textContent = fmt(totalGJ);
      document.getElementById('ce2-mwh')!.textContent = fmt(totalMWh);
      document.getElementById('ce2-homes')!.textContent = fmt(homes);
      document.getElementById('ce2-co2')!.textContent = fmt(co2Total) + ' tonnes';
      document.getElementById('ce2-co2mwh')!.textContent = fmt(co2PerMwh) + ' kg';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ce2-in').forEach(el => { el.addEventListener('input', calcCE2); el.addEventListener('change', calcCE2); });
      calcCE2();
    }, 50);
  </script>
</CalculatorLayout>
