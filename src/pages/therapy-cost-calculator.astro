---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Therapy Cost Calculator - Session Cost, Insurance & Annual Investment";
const description = "Calculate therapy costs by type and frequency. Compare in-person vs online, factor in insurance copays, and see your total annual investment.";
const relatedCalcs = [
  { name: "Health Insurance", url: "/health-insurance-calculator", description: "Insurance costs." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calorie needs." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body mass index." },
  { name: "Sleep Calculator", url: "/sleep-calculator", description: "Optimize sleep cycles." },
  { name: "Mortgage Calculator", url: "/mortgage-calculator", description: "Mortgage payments." },
  { name: "Age Calculator", url: "/age-calculator", description: "Calculate exact age." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Therapy Cost Calculator" keywords="therapy cost, therapist cost, counseling cost, insurance copay, therapy session, online therapy, CBT cost, therapy investment" breadcrumbs={[{ name: "Therapy Cost", url: "/therapy-cost-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Therapy Cost Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your therapy costs and compare options to plan your mental health investment.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Therapy Type</label>
          <select id="th-type" class="th-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center">
            <option value="individual">Individual Therapy (Psychologist)</option>
            <option value="psychiatrist">Psychiatrist (MD, can prescribe)</option>
            <option value="counselor">Licensed Counselor (LMHC/LPC)</option>
            <option value="social">Social Worker (LCSW)</option>
            <option value="couples">Couples / Marriage Therapy</option>
            <option value="group">Group Therapy</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Session Format</label>
          <select id="th-format" class="th-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center">
            <option value="inperson">In-person</option>
            <option value="online">Online / Telehealth</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Sessions Per Month</label>
          <input type="number" id="th-freq" class="th-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="1" max="16" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Do You Have Insurance Coverage?</label>
          <select id="th-insurance" class="th-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center">
            <option value="none">No insurance / Out of pocket</option>
            <option value="copay">Yes - Copay per session</option>
            <option value="percent">Yes - Coinsurance (%)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Copay Amount ($) or Coinsurance (%)</label>
          <input type="number" id="th-copay" class="th-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="0" max="500" step="5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Planned Duration (months)</label>
          <input type="number" id="th-months" class="th-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="1" max="60" step="1">
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm opacity-80">Your Cost Per Session</div>
          <div class="text-2xl font-extrabold mt-1" id="th-persession">--</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Monthly Cost</div>
            <div class="text-xl font-bold text-text mt-1" id="th-monthly">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Annual Cost</div>
            <div class="text-xl font-bold text-text mt-1" id="th-annual">--</div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Total Investment (full plan)</div>
            <div class="text-xl font-bold text-text mt-1" id="th-total">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Total Sessions</div>
            <div class="text-xl font-bold text-text mt-1" id="th-sessions">--</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-secondary mb-2">Average Market Rates (without insurance)</div>
          <div class="text-sm text-text space-y-1" id="th-rates">
            <div class="flex justify-between"><span>Psychologist (in-person)</span><span>$150 - $250/session</span></div>
            <div class="flex justify-between"><span>Psychiatrist</span><span>$200 - $350/session</span></div>
            <div class="flex justify-between"><span>Counselor (LMHC)</span><span>$100 - $175/session</span></div>
            <div class="flex justify-between"><span>Social Worker (LCSW)</span><span>$80 - $150/session</span></div>
            <div class="flex justify-between"><span>Couples Therapy</span><span>$150 - $300/session</span></div>
            <div class="flex justify-between"><span>Group Therapy</span><span>$40 - $80/session</span></div>
            <div class="flex justify-between"><span>Online platforms</span><span>~15-25% less than in-person</span></div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-secondary mb-2">Cost-Saving Tips</div>
          <div class="text-sm text-text" id="th-tips">--</div>
        </div>
      </div>

      <ShareButton calculatorId="therapy-cost" />
      <FeedbackWidget />
    </div>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcTH() {
      const type = (document.getElementById('th-type') as HTMLSelectElement).value;
      const format = (document.getElementById('th-format') as HTMLSelectElement).value;
      const freq = parseInt((document.getElementById('th-freq') as HTMLInputElement).value) || 4;
      const insurance = (document.getElementById('th-insurance') as HTMLSelectElement).value;
      const copayVal = parseFloat((document.getElementById('th-copay') as HTMLInputElement).value) || 30;
      const months = parseInt((document.getElementById('th-months') as HTMLInputElement).value) || 6;

      // Average base rates
      const baseRates: Record<string, number> = {
        individual: 180, psychiatrist: 275, counselor: 130, social: 110, couples: 200, group: 55,
      };
      let baseRate = baseRates[type] || 180;

      // Online discount ~20%
      if (format === 'online') baseRate *= 0.8;

      // Calculate out-of-pocket per session
      let perSession = baseRate;
      if (insurance === 'copay') {
        perSession = copayVal;
      } else if (insurance === 'percent') {
        perSession = baseRate * (copayVal / 100);
      }

      const monthly = perSession * freq;
      const annual = monthly * 12;
      const totalSessions = freq * months;
      const totalCost = perSession * totalSessions;

      document.getElementById('th-persession')!.textContent = '$' + perSession.toFixed(0) + ' / session';
      document.getElementById('th-monthly')!.textContent = '$' + monthly.toFixed(0);
      document.getElementById('th-annual')!.textContent = '$' + annual.toFixed(0);
      document.getElementById('th-total')!.textContent = '$' + totalCost.toFixed(0);
      document.getElementById('th-sessions')!.textContent = totalSessions + ' sessions over ' + months + ' months';

      let tips: string[] = [];
      if (insurance === 'none') {
        tips.push('Ask about sliding-scale fees based on income. Many therapists offer reduced rates.');
        tips.push('Consider community mental health centers, which often provide services on a sliding scale.');
        tips.push('Online platforms (BetterHelp, Talkspace) can be 30-50% cheaper than in-person.');
      }
      if (type === 'psychiatrist') {
        tips.push('Consider seeing a psychiatrist for medication management only (shorter/cheaper sessions) and a therapist for talk therapy.');
      }
      if (freq > 4) {
        tips.push('High frequency may be needed initially but can often be reduced to biweekly after stabilization.');
      }
      tips.push('Check if your employer offers an Employee Assistance Program (EAP) - typically 3-8 free sessions.');
      tips.push('Many training clinics at universities offer therapy at reduced rates with supervised graduate students.');

      document.getElementById('th-tips')!.textContent = tips.join(' ');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      (document.getElementById('th-freq') as HTMLInputElement).value = '4';
      (document.getElementById('th-copay') as HTMLInputElement).value = '30';
      (document.getElementById('th-months') as HTMLInputElement).value = '6';
      document.querySelectorAll('.th-in').forEach(el => {
        el.addEventListener('input', calcTH);
        el.addEventListener('change', calcTH);
      });
      calcTH();
    }, 50);
  </script>
</CalculatorLayout>
