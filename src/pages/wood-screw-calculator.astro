---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Wood Screw Calculator - Size, Pilot Hole & Clearance Hole Guide";
const description = "Calculate wood screw size, pilot hole diameter, clearance hole diameter, and penetration depth for hardwood and softwood. Get drill bit recommendations.";

const relatedCalcs = [
  { name: "Dowel Joint Calculator", url: "/dowel-joint-calculator", description: "Dowel joint spacing." },
  { name: "Mortise & Tenon Calculator", url: "/mortise-tenon-calculator", description: "M&T joint dimensions." },
  { name: "Board Foot Calculator", url: "/board-foot-calculator", description: "Board feet calculator." },
  { name: "Wood Glue Calculator", url: "/wood-glue-calculator", description: "Glue coverage." },
  { name: "Wood Weight Calculator", url: "/wood-weight-calculator", description: "Wood weight estimator." },
  { name: "Timber Span Calculator", url: "/timber-span-calculator", description: "Beam span calculator." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Wood Screw Calculator"
  keywords="wood screw calculator, pilot hole size, clearance hole, screw gauge, screw length, drill bit size, countersink"
  breadcrumbs={[{ name: "Wood Screw Calculator", url: "/wood-screw-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Wood Screw Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find the right screw size, pilot hole, and clearance hole for your wood project.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Screw Gauge (#)</label>
        <select id="wsc-gauge" class="wsc-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="2">#2</option>
          <option value="3">#3</option>
          <option value="4">#4</option>
          <option value="5">#5</option>
          <option value="6">#6</option>
          <option value="7">#7</option>
          <option value="8" selected>#8</option>
          <option value="9">#9</option>
          <option value="10">#10</option>
          <option value="12">#12</option>
          <option value="14">#14</option>
        </select>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Screw Length (inches)</label>
          <select id="wsc-len" class="wsc-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="0.5">1/2"</option>
            <option value="0.625">5/8"</option>
            <option value="0.75">3/4"</option>
            <option value="1">1"</option>
            <option value="1.25">1-1/4"</option>
            <option value="1.5" selected>1-1/2"</option>
            <option value="2">2"</option>
            <option value="2.5">2-1/2"</option>
            <option value="3">3"</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Wood Type</label>
          <select id="wsc-wood" class="wsc-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="hard" selected>Hardwood (Oak, Maple, etc.)</option>
            <option value="soft">Softwood (Pine, Cedar, etc.)</option>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Top Board Thickness (in)</label>
          <input type="number" id="wsc-top" class="wsc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.75" min="0.25" step="0.125">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Countersink?</label>
          <select id="wsc-cs" class="wsc-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="yes" selected>Yes</option>
            <option value="no">No (flat head flush)</option>
          </select>
        </div>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Pilot Hole Diameter</div>
        <div class="text-4xl font-extrabold" id="wsc-pilot">--</div>
        <div class="text-sm text-blue-200 mt-1" id="wsc-pilot-bit">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Clearance Hole</div>
          <div class="text-xl font-bold" id="wsc-clear">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Countersink Dia.</div>
          <div class="text-xl font-bold" id="wsc-csink">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Screw Shank Dia.</div>
          <div class="text-xl font-bold" id="wsc-shank">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Thread Penetration</div>
          <div class="text-xl font-bold" id="wsc-pen">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h4 class="font-semibold text-sm text-text mb-1">Recommendations</h4>
        <p class="text-sm text-text-secondary" id="wsc-rec">--</p>
      </div>

      <ShareButton calculatorId="wood-screw" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Wood Screw Sizing Guide</h2>
      <ul>
        <li><strong>Always pre-drill pilot holes in hardwood</strong> to prevent splitting</li>
        <li><strong>Screw penetration:</strong> At least 1" into the receiving piece, or 2/3 of screw length</li>
        <li><strong>Clearance hole:</strong> Drill through the top piece so only threads grip the bottom piece</li>
        <li><strong>The Rule of Thirds:</strong> 1/3 in top piece, 2/3 in bottom piece</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcWSC() {
      const gauge = parseInt((document.getElementById('wsc-gauge') as HTMLSelectElement).value) || 8;
      const screwLen = parseFloat((document.getElementById('wsc-len') as HTMLSelectElement).value) || 1.5;
      const woodType = (document.getElementById('wsc-wood') as HTMLSelectElement).value;
      const topThick = parseFloat((document.getElementById('wsc-top') as HTMLInputElement).value) || 0.75;
      const countersink = (document.getElementById('wsc-cs') as HTMLSelectElement).value === 'yes';

      // Screw gauge to shank diameter: diameter = gauge * 0.013 + 0.060
      const shankDia = gauge * 0.013 + 0.060;

      // Pilot hole: hardwood = ~85% of shank, softwood = ~70% of shank (root diameter)
      const rootDia = shankDia * 0.7; // approximate root diameter
      const pilotHard = rootDia * 1.0; // full root for hardwood
      const pilotSoft = rootDia * 0.85; // slightly smaller for softwood
      const pilotDia = woodType === 'hard' ? pilotHard : pilotSoft;

      // Clearance hole = shank diameter (or slightly larger)
      const clearDia = shankDia + 0.005;

      // Countersink diameter: head is approximately 2x shank
      const headDia = shankDia * 2;

      // Thread penetration into bottom piece
      const threadPen = screwLen - topThick;

      // Nearest drill bit (fractional inches in 64ths)
      const nearestBit = (d: number) => {
        const sixty4ths = Math.round(d * 64);
        const inches = sixty4ths / 64;
        // Find common fraction
        let num = sixty4ths;
        let den = 64;
        while (num % 2 === 0 && den > 1) { num /= 2; den /= 2; }
        return num + '/' + den + '"';
      };

      document.getElementById('wsc-pilot')!.textContent = pilotDia.toFixed(3) + '"';
      document.getElementById('wsc-pilot-bit')!.textContent = 'Use ' + nearestBit(pilotDia) + ' drill bit';
      document.getElementById('wsc-clear')!.textContent = nearestBit(clearDia) + ' (' + clearDia.toFixed(3) + '")';
      document.getElementById('wsc-csink')!.textContent = countersink ? nearestBit(headDia) + ' (' + headDia.toFixed(3) + '")' : 'N/A';
      document.getElementById('wsc-shank')!.textContent = shankDia.toFixed(3) + '"';
      document.getElementById('wsc-pen')!.textContent = threadPen.toFixed(3) + '"';

      let rec = '';
      if (threadPen < 0.5) {
        rec = 'Warning: Thread penetration is less than 1/2". Use a longer screw or thinner top board. ';
      } else if (threadPen >= 1.0) {
        rec = 'Good penetration depth for a strong joint. ';
      } else {
        rec = 'Adequate penetration. ';
      }
      rec += woodType === 'hard'
        ? 'Always pre-drill in hardwood to prevent splitting. Use wax on screw threads for easier driving.'
        : 'Pre-drilling recommended even in softwood near edges and end grain.';
      document.getElementById('wsc-rec')!.textContent = rec;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.wsc-in').forEach(el => {
        el.addEventListener('input', calcWSC);
        el.addEventListener('change', calcWSC);
      });
      calcWSC();
    }, 50);
  </script>
</CalculatorLayout>
