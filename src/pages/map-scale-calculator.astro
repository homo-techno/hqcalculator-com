---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Map Scale Calculator";
const description = "Convert map distance to real-world distance, calculate scale ratio, area scaling, and representative fraction.";
const relatedCalcs = [
  { name: "Length Converter", url: "/length-converter-calculator", description: "Distances." },
  { name: "Ratio Calculator", url: "/ratio-calculator", description: "Ratios." },
  { name: "Area Calculator", url: "/area-calculator", description: "Areas." },
  { name: "Proportions", url: "/proportions-calculator", description: "Proportions." },
  { name: "Square Footage", url: "/square-footage-calculator", description: "Sq footage." },
  { name: "Unit Price", url: "/unit-price-calculator", description: "Unit price." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Map Scale Calculator" keywords="map scale, scale ratio, representative fraction, map distance, real distance, area scaling" breadcrumbs={[{ name: "Map Scale", url: "/map-scale-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Map Scale Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert between map distances and real-world distances using scale ratios (e.g., 1:50,000).</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div><label class="block text-xs font-medium text-text mb-1">Mode</label>
          <select id="ms-mode" class="ms-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="mapToReal" selected>Map Distance to Real Distance</option>
            <option value="realToMap">Real Distance to Map Distance</option>
            <option value="findScale">Find Scale from Distances</option>
          </select>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Map Scale (1 : X)</label><input type="number" id="ms-scale" class="ms-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="50000" step="1000" min="1"></div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1" id="ms-map-label">Map Distance</label><input type="number" id="ms-map" class="ms-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" step="0.1" min="0"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Map Unit</label>
            <select id="ms-mapunit" class="ms-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="cm" selected>Centimeters</option>
              <option value="mm">Millimeters</option>
              <option value="in">Inches</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1" id="ms-real-label">Real Distance</label><input type="number" id="ms-real" class="ms-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2.5" step="0.1" min="0"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Real Unit</label>
            <select id="ms-realunit" class="ms-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="km" selected>Kilometers</option>
              <option value="m">Meters</option>
              <option value="mi">Miles</option>
              <option value="ft">Feet</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="ms-label">Real Distance</div>
          <div class="text-5xl font-extrabold font-mono" id="ms-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Scale</div><div class="text-xl font-bold font-mono" id="ms-scaleout">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Area Scale Factor</div><div class="text-xl font-bold font-mono" id="ms-area">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">1 cm on map =</div><div class="text-xl font-bold font-mono" id="ms-1cm">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">1 inch on map =</div><div class="text-xl font-bold font-mono" id="ms-1in">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="map-scale" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function toCm(val: number, unit: string): number {
      if (unit === 'cm') return val;
      if (unit === 'mm') return val / 10;
      if (unit === 'in') return val * 2.54;
      return val;
    }
    function toCmReal(val: number, unit: string): number {
      if (unit === 'km') return val * 100000;
      if (unit === 'm') return val * 100;
      if (unit === 'mi') return val * 160934;
      if (unit === 'ft') return val * 30.48;
      return val;
    }
    function fromCmReal(cm: number, unit: string): number {
      if (unit === 'km') return cm / 100000;
      if (unit === 'm') return cm / 100;
      if (unit === 'mi') return cm / 160934;
      if (unit === 'ft') return cm / 30.48;
      return cm;
    }
    function fromCmMap(cm: number, unit: string): number {
      if (unit === 'cm') return cm;
      if (unit === 'mm') return cm * 10;
      if (unit === 'in') return cm / 2.54;
      return cm;
    }
    function calcMS() {
      const mode = (document.getElementById('ms-mode') as HTMLSelectElement).value;
      const scale = parseFloat((document.getElementById('ms-scale') as HTMLInputElement).value) || 50000;
      const mapVal = parseFloat((document.getElementById('ms-map') as HTMLInputElement).value) || 0;
      const mapUnit = (document.getElementById('ms-mapunit') as HTMLSelectElement).value;
      const realVal = parseFloat((document.getElementById('ms-real') as HTMLInputElement).value) || 0;
      const realUnit = (document.getElementById('ms-realunit') as HTMLSelectElement).value;
      let resultScale = scale;

      if (mode === 'mapToReal') {
        const mapCm = toCm(mapVal, mapUnit);
        const realCm = mapCm * scale;
        const real = fromCmReal(realCm, realUnit);
        document.getElementById('ms-label')!.textContent = 'Real Distance';
        document.getElementById('ms-result')!.textContent = real.toFixed(4) + ' ' + realUnit;
      } else if (mode === 'realToMap') {
        const realCm = toCmReal(realVal, realUnit);
        const mapCm = realCm / scale;
        const map = fromCmMap(mapCm, mapUnit);
        document.getElementById('ms-label')!.textContent = 'Map Distance';
        document.getElementById('ms-result')!.textContent = map.toFixed(4) + ' ' + mapUnit;
      } else {
        const mapCm = toCm(mapVal, mapUnit);
        const realCm = toCmReal(realVal, realUnit);
        resultScale = mapCm > 0 ? realCm / mapCm : 0;
        document.getElementById('ms-label')!.textContent = 'Calculated Scale';
        document.getElementById('ms-result')!.textContent = '1 : ' + Math.round(resultScale).toLocaleString();
      }

      const areaFactor = resultScale * resultScale;
      const oneCmReal = resultScale / 100000;
      const oneInReal = resultScale * 2.54 / 100000;

      document.getElementById('ms-scaleout')!.textContent = '1 : ' + Math.round(resultScale).toLocaleString();
      document.getElementById('ms-area')!.textContent = '1 : ' + areaFactor.toExponential(2);
      document.getElementById('ms-1cm')!.textContent = oneCmReal.toFixed(3) + ' km';
      document.getElementById('ms-1in')!.textContent = oneInReal.toFixed(3) + ' km';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ms-in').forEach(el => { el.addEventListener('input', calcMS); el.addEventListener('change', calcMS); });
      calcMS();
    }, 50);
  </script>
</CalculatorLayout>
