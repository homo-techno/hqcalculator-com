---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Mining Cost Calculator - All-In Sustaining Cost (AISC)";
const description = "Calculate mining cost per ton including drilling, blasting, hauling, processing, strip ratio, and all-in sustaining cost (AISC).";
const relatedCalcs = [
  { name: "Excavation Calculator", url: "/excavation-calculator", description: "Earthwork volumes." },
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume." },
  { name: "Gravel Calculator", url: "/gravel-calculator", description: "Material tonnage." },
  { name: "Density Calculator", url: "/density-calculator", description: "Material density." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage math." },
  { name: "Energy Converter", url: "/energy-converter", description: "Energy units." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Mining Cost Calculator" keywords="mining cost calculator, AISC, all-in sustaining cost, strip ratio, cost per ton, mining operations" breadcrumbs={[{ name: "Mining Cost", url: "/mining-cost-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Mining Cost Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate total mining cost per ton, strip ratio impact, and all-in sustaining cost for open-pit and underground operations.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Mine Type</label>
          <select id="mc4-type" class="mc4-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="openpit">Open Pit</option>
            <option value="underground">Underground</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Annual Ore (tonnes)</label>
            <input type="number" id="mc4-ore" class="mc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="500000" min="0" step="10000">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Strip Ratio (waste:ore)</label>
            <input type="number" id="mc4-strip" class="mc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="3" min="0" step="0.1">
          </div>
        </div>
        <h3 class="text-sm font-semibold text-text pt-2">Cost Components ($/tonne ore)</h3>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Drilling</label>
            <input type="number" id="mc4-drill" class="mc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="3.50" min="0" step="0.1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Blasting</label>
            <input type="number" id="mc4-blast" class="mc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="2.00" min="0" step="0.1">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Loading</label>
            <input type="number" id="mc4-load" class="mc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="2.50" min="0" step="0.1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Hauling</label>
            <input type="number" id="mc4-haul" class="mc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="4.00" min="0" step="0.1">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Processing</label>
            <input type="number" id="mc4-process" class="mc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="12.00" min="0" step="0.5">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">G&A / Overhead</label>
            <input type="number" id="mc4-ga" class="mc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="5.00" min="0" step="0.5">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Sustaining Capital ($/t)</label>
            <input type="number" id="mc4-sustcap" class="mc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="4.00" min="0" step="0.5">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Royalties (%)</label>
            <input type="number" id="mc4-royalty" class="mc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="3" min="0" max="100" step="0.5">
          </div>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Revenue per Tonne ($/t ore)</label>
          <input type="number" id="mc4-revenue" class="mc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="80" min="0" step="1">
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">All-In Sustaining Cost (AISC)</div>
          <div class="text-4xl font-extrabold" id="mc4-aisc">$0</div>
          <div class="text-sm text-blue-200 mt-1">per tonne ore</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Mining Cost / Tonne</div>
            <div class="text-xl font-bold" id="mc4-mining">$0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Annual Cost</div>
            <div class="text-xl font-bold" id="mc4-annual">$0</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Waste Tonnes Moved</div>
            <div class="text-xl font-bold" id="mc4-waste">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Operating Margin</div>
            <div class="text-xl font-bold" id="mc4-margin">0%</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Profit per Tonne</div>
          <div class="text-xl font-bold" id="mc4-profit">$0</div>
        </div>
      </div>

      <ShareButton calculatorId="mining-cost" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Mining Cost Breakdown</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Mining Cost</strong> = Drill + Blast + Load + Haul (adjusted for strip ratio)</p>
        <p><strong>AISC</strong> = Mining + Processing + G&A + Sustaining Capital + Royalties</p>
        <p><strong>Waste Moved</strong> = Ore Tonnes x Strip Ratio</p>
        <p><strong>Operating Margin</strong> = (Revenue - AISC) / Revenue x 100</p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">Understanding Strip Ratio</h3>
      <p>The strip ratio is the amount of waste material that must be removed to access one tonne of ore. A strip ratio of 3:1 means 3 tonnes of waste must be moved for every tonne of ore extracted. Higher strip ratios significantly increase mining costs.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcMC4() {
      const ore = parseFloat((document.getElementById('mc4-ore') as HTMLInputElement).value) || 0;
      const strip = parseFloat((document.getElementById('mc4-strip') as HTMLInputElement).value) || 0;
      const drill = parseFloat((document.getElementById('mc4-drill') as HTMLInputElement).value) || 0;
      const blast = parseFloat((document.getElementById('mc4-blast') as HTMLInputElement).value) || 0;
      const load = parseFloat((document.getElementById('mc4-load') as HTMLInputElement).value) || 0;
      const haul = parseFloat((document.getElementById('mc4-haul') as HTMLInputElement).value) || 0;
      const process = parseFloat((document.getElementById('mc4-process') as HTMLInputElement).value) || 0;
      const ga = parseFloat((document.getElementById('mc4-ga') as HTMLInputElement).value) || 0;
      const sustCap = parseFloat((document.getElementById('mc4-sustcap') as HTMLInputElement).value) || 0;
      const royaltyPct = parseFloat((document.getElementById('mc4-royalty') as HTMLInputElement).value) || 0;
      const revenue = parseFloat((document.getElementById('mc4-revenue') as HTMLInputElement).value) || 0;

      const miningCostDirect = drill + blast + load + haul;
      const miningCostWithStrip = miningCostDirect * (1 + strip);
      const royaltyCost = revenue * (royaltyPct / 100);
      const aisc = miningCostWithStrip + process + ga + sustCap + royaltyCost;
      const annualCost = aisc * ore;
      const waste = ore * strip;
      const profit = revenue - aisc;
      const margin = revenue > 0 ? ((revenue - aisc) / revenue) * 100 : 0;

      const fmt = (n: number) => n.toLocaleString('en-US', { maximumFractionDigits: 2 });

      document.getElementById('mc4-aisc')!.textContent = '$' + fmt(aisc);
      document.getElementById('mc4-mining')!.textContent = '$' + fmt(miningCostWithStrip);
      document.getElementById('mc4-annual')!.textContent = '$' + fmt(annualCost);
      document.getElementById('mc4-waste')!.textContent = fmt(waste) + ' t';
      document.getElementById('mc4-margin')!.textContent = fmt(margin) + '%';
      document.getElementById('mc4-profit')!.textContent = (profit >= 0 ? '$' : '-$') + fmt(Math.abs(profit));

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.mc4-in').forEach(el => { el.addEventListener('input', calcMC4); el.addEventListener('change', calcMC4); });
      calcMC4();
    }, 50);
  </script>
</CalculatorLayout>
