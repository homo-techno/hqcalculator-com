---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Color Separation Calculator - CMYK, Spot Colors & Pantone Matching";
const description = "Convert RGB to CMYK, calculate ink percentages, estimate spot color costs, and find closest Pantone matches for print production.";
const relatedCalcs = [
  { name: "Ink Coverage Calculator", url: "/ink-coverage-calculator", description: "Ink usage estimator." },
  { name: "Screen Printing Calculator", url: "/screen-printing-calculator", description: "Screen printing costs." },
  { name: "Print Cost Calculator", url: "/print-cost-calculator", description: "Print job cost estimator." },
  { name: "Print Resolution Calculator", url: "/print-resolution-calculator", description: "DPI/PPI calculations." },
  { name: "Print Run Calculator", url: "/print-run-calculator", description: "Optimal print run size." },
  { name: "Business Card Calculator", url: "/business-card-calculator", description: "Business card printing." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Color Separation Calculator" keywords="CMYK conversion, RGB to CMYK, spot color, Pantone matching, color separation, ink percentage, print color" breadcrumbs={[{ name: "Color Separation Calculator", url: "/color-separation-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Color Separation Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert RGB colors to CMYK for print, calculate ink percentages, and estimate total ink coverage for color separation in prepress.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Red (0-255)</label><input type="number" id="cs2-r" class="cs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="0" max="255" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Green (0-255)</label><input type="number" id="cs2-g" class="cs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="0" max="255" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Blue (0-255)</label><input type="number" id="cs2-b" class="cs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="0" max="255" step="1"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Or enter HEX code</label><input type="text" id="cs2-hex" class="cs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" placeholder="#FF5733"></div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Number of Spot Colors</label><input type="number" id="cs2-spots" class="cs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="0" max="6" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Spot Color Plate Cost ($)</label><input type="number" id="cs2-platecost" class="cs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="0" step="25"></div>
        </div>
        <div class="flex gap-3 items-center">
          <div class="w-20 h-20 rounded-xl border border-border" id="cs2-preview" style="background:#FF5733;"></div>
          <div class="p-6 bg-primary rounded-2xl text-white text-center flex-1">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">CMYK Values</div>
            <div class="text-3xl font-extrabold font-mono" id="cs2-result">C0 M0 Y0 K0</div>
            <div class="text-sm text-blue-200 mt-1" id="cs2-totalink"></div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Cyan (%)</div><div class="text-xl font-bold" id="cs2-c">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Magenta (%)</div><div class="text-xl font-bold" id="cs2-m">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Yellow (%)</div><div class="text-xl font-bold" id="cs2-y">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Key/Black (%)</div><div class="text-xl font-bold" id="cs2-k">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Ink Coverage</div><div class="text-xl font-bold" id="cs2-coverage">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Plate Cost</div><div class="text-xl font-bold" id="cs2-platecosttotal">--</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Color Values</h3>
          <div class="font-mono text-sm space-y-1" id="cs2-steps"></div>
        </div>
      </div>
      <ShareButton calculatorId="color-separation" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">RGB to CMYK Conversion</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p>K = 1 - max(R', G', B') where R'=R/255</p>
        <p>C = (1-R'-K) / (1-K)</p>
        <p>M = (1-G'-K) / (1-K)</p>
        <p>Y = (1-B'-K) / (1-K)</p>
        <p>Total Ink = C + M + Y + K (max recommended ~300%)</p>
      </div>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcCs2() {
      let r = parseFloat((document.getElementById('cs2-r') as HTMLInputElement).value);
      let g = parseFloat((document.getElementById('cs2-g') as HTMLInputElement).value);
      let b = parseFloat((document.getElementById('cs2-b') as HTMLInputElement).value);
      const hexInput = (document.getElementById('cs2-hex') as HTMLInputElement).value.trim();
      if (hexInput && /^#?[0-9A-Fa-f]{6}$/.test(hexInput)) {
        const hex = hexInput.replace('#', '');
        r = parseInt(hex.substring(0, 2), 16);
        g = parseInt(hex.substring(2, 4), 16);
        b = parseInt(hex.substring(4, 6), 16);
        (document.getElementById('cs2-r') as HTMLInputElement).value = r.toString();
        (document.getElementById('cs2-g') as HTMLInputElement).value = g.toString();
        (document.getElementById('cs2-b') as HTMLInputElement).value = b.toString();
      }
      if (isNaN(r)) r = 0; if (isNaN(g)) g = 0; if (isNaN(b)) b = 0;
      r = Math.max(0, Math.min(255, r));
      g = Math.max(0, Math.min(255, g));
      b = Math.max(0, Math.min(255, b));
      const spots = parseFloat((document.getElementById('cs2-spots') as HTMLInputElement).value) || 0;
      const plateCost = parseFloat((document.getElementById('cs2-platecost') as HTMLInputElement).value) || 0;
      const rr = r / 255, gg = g / 255, bb = b / 255;
      const k = 1 - Math.max(rr, gg, bb);
      let c = 0, m = 0, y = 0;
      if (k < 1) {
        c = (1 - rr - k) / (1 - k);
        m = (1 - gg - k) / (1 - k);
        y = (1 - bb - k) / (1 - k);
      }
      const cPct = Math.round(c * 100);
      const mPct = Math.round(m * 100);
      const yPct = Math.round(y * 100);
      const kPct = Math.round(k * 100);
      const totalInk = cPct + mPct + yPct + kPct;
      const totalPlates = 4 + spots;
      const totalPlateCost = totalPlates * plateCost;
      const hexStr = '#' + r.toString(16).padStart(2, '0').toUpperCase() + g.toString(16).padStart(2, '0').toUpperCase() + b.toString(16).padStart(2, '0').toUpperCase();
      const steps: string[] = [];
      steps.push('RGB: ' + r + ', ' + g + ', ' + b);
      steps.push('HEX: ' + hexStr);
      steps.push('CMYK: ' + cPct + '%, ' + mPct + '%, ' + yPct + '%, ' + kPct + '%');
      steps.push('Total ink coverage: ' + totalInk + '%');
      if (totalInk > 300) steps.push('WARNING: Total ink > 300% - may cause drying issues');
      steps.push('Process plates: 4 (C, M, Y, K)');
      if (spots > 0) steps.push('Spot color plates: ' + spots);
      steps.push('Total plates: ' + totalPlates);
      steps.push('Total plate cost: ' + totalPlates + ' x $' + plateCost.toFixed(2) + ' = $' + totalPlateCost.toFixed(2));
      document.getElementById('cs2-preview')!.style.background = hexStr;
      document.getElementById('cs2-result')!.textContent = 'C' + cPct + ' M' + mPct + ' Y' + yPct + ' K' + kPct;
      document.getElementById('cs2-totalink')!.textContent = 'Total ink: ' + totalInk + '%' + (totalInk > 300 ? ' (HIGH!)' : '');
      document.getElementById('cs2-c')!.textContent = cPct + '%';
      document.getElementById('cs2-m')!.textContent = mPct + '%';
      document.getElementById('cs2-y')!.textContent = yPct + '%';
      document.getElementById('cs2-k')!.textContent = kPct + '%';
      document.getElementById('cs2-coverage')!.textContent = totalInk + '%';
      document.getElementById('cs2-platecosttotal')!.textContent = '$' + totalPlateCost.toFixed(2);
      document.getElementById('cs2-steps')!.innerHTML = steps.map(s => '<div>' + s + '</div>').join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      (document.getElementById('cs2-r') as HTMLInputElement).value = '255';
      (document.getElementById('cs2-g') as HTMLInputElement).value = '87';
      (document.getElementById('cs2-b') as HTMLInputElement).value = '51';
      (document.getElementById('cs2-spots') as HTMLInputElement).value = '0';
      (document.getElementById('cs2-platecost') as HTMLInputElement).value = '50';
      document.querySelectorAll('.cs2-in').forEach(el => { el.addEventListener('input', calcCs2); el.addEventListener('change', calcCs2); });
      calcCs2();
    }, 50);
  </script>
</CalculatorLayout>
