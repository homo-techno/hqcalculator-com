---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "3D Printer Cost Calculator - Material, Electricity & Total";
const description = "Calculate the total cost of a 3D print including filament material cost, electricity cost, and labor time. Enter weight, filament price, power, and print time.";
const relatedCalcs = [
  { name: "Stepper Motor Calculator", url: "/stepper-motor-calculator", description: "Motor steps." },
  { name: "Gear Calculator", url: "/gear-calculator", description: "Gear ratio." },
  { name: "Belt Length Calculator", url: "/belt-length-calculator", description: "Belt/pulley." },
  { name: "Stress & Strain Calculator", url: "/stress-strain-calculator", description: "Material stress." },
  { name: "Battery Life Calculator", url: "/battery-life-calculator", description: "Battery life." },
  { name: "Unit Converter", url: "/unit-converter", description: "Convert units." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="3D Printer Cost Calculator" keywords="3D printer cost, filament cost, printing cost, electricity cost, 3D printing, material cost" breadcrumbs={[{ name: "3D Printer Cost Calculator", url: "/3d-printer-cost-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">3D Printer Cost Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate the total cost of your 3D print by entering filament weight, cost per kg, printer power, print time, and hourly labor rate.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Filament Used (grams)</label><input type="number" id="3d-weight" class="td-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="1" min="0"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Filament Cost ($/kg)</label><input type="number" id="3d-fpcost" class="td-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="1" min="0"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Printer Power (watts)</label><input type="number" id="3d-watts" class="td-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="10" min="0"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Print Time (hours)</label><input type="number" id="3d-hours" class="td-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="0.1" min="0"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Electricity Rate ($/kWh)</label><input type="number" id="3d-rate" class="td-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="0.01" min="0"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Labor Rate ($/hr) — optional</label><input type="number" id="3d-labor" class="td-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="1" min="0"></div>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Markup / Profit Margin (%)</label>
          <input type="number" id="3d-markup" class="td-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="5" min="0">
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Cost</div>
          <div class="text-5xl font-extrabold font-mono" id="3d-result">$0.00</div>
          <div class="text-sm text-blue-200 mt-1" id="3d-with-markup"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Material Cost</div><div class="text-xl font-bold" id="3d-matcost">—</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Electricity Cost</div><div class="text-xl font-bold" id="3d-elcost">—</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Labor Cost</div><div class="text-xl font-bold" id="3d-laborcost">—</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Cost per Gram</div><div class="text-xl font-bold" id="3d-pergram">—</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Step-by-Step</h3>
          <div class="font-mono text-sm space-y-1" id="3d-steps"></div>
        </div>
      </div>
      <ShareButton calculatorId="3d-printer-cost" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">3D Print Cost Breakdown</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p>Material Cost = Weight(g) × Price($/kg) / 1000</p>
        <p>Electricity Cost = Watts × Hours / 1000 × Rate($/kWh)</p>
        <p>Labor Cost = Hours × Labor Rate($/hr)</p>
        <p>Total = Material + Electricity + Labor</p>
        <p>Selling Price = Total × (1 + Markup%/100)</p>
      </div>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcTd() {
      const weight = parseFloat((document.getElementById('3d-weight') as HTMLInputElement).value) || 0;
      const fpCost = parseFloat((document.getElementById('3d-fpcost') as HTMLInputElement).value) || 0;
      const watts = parseFloat((document.getElementById('3d-watts') as HTMLInputElement).value) || 0;
      const hours = parseFloat((document.getElementById('3d-hours') as HTMLInputElement).value) || 0;
      const elRate = parseFloat((document.getElementById('3d-rate') as HTMLInputElement).value) || 0;
      const laborRate = parseFloat((document.getElementById('3d-labor') as HTMLInputElement).value) || 0;
      const markup = parseFloat((document.getElementById('3d-markup') as HTMLInputElement).value) || 0;
      const steps: string[] = [];
      const matCost = (weight * fpCost) / 1000;
      steps.push(`Material = ${weight}g × $${fpCost}/kg / 1000 = $${matCost.toFixed(2)}`);
      const kWh = (watts * hours) / 1000;
      const elCost = kWh * elRate;
      steps.push(`Electricity = ${watts}W × ${hours}h / 1000 × $${elRate}/kWh`);
      steps.push(`= ${kWh.toFixed(3)} kWh × $${elRate} = $${elCost.toFixed(2)}`);
      const labCost = laborRate * hours;
      if (laborRate > 0) {
        steps.push(`Labor = $${laborRate}/hr × ${hours}h = $${labCost.toFixed(2)}`);
      }
      const total = matCost + elCost + labCost;
      steps.push(`Total Cost = $${matCost.toFixed(2)} + $${elCost.toFixed(2)} + $${labCost.toFixed(2)} = $${total.toFixed(2)}`);
      let withMarkup = total;
      if (markup > 0) {
        withMarkup = total * (1 + markup / 100);
        steps.push(`With ${markup}% markup: $${total.toFixed(2)} × ${(1 + markup/100).toFixed(2)} = $${withMarkup.toFixed(2)}`);
      }
      const perGram = weight > 0 ? total / weight : 0;
      document.getElementById('3d-result')!.textContent = '$' + total.toFixed(2);
      document.getElementById('3d-with-markup')!.textContent = markup > 0 ? `With ${markup}% markup: $${withMarkup.toFixed(2)}` : '';
      document.getElementById('3d-matcost')!.textContent = '$' + matCost.toFixed(2);
      document.getElementById('3d-elcost')!.textContent = '$' + elCost.toFixed(2);
      document.getElementById('3d-laborcost')!.textContent = laborRate > 0 ? '$' + labCost.toFixed(2) : '$0.00';
      document.getElementById('3d-pergram')!.textContent = perGram > 0 ? '$' + perGram.toFixed(4) + '/g' : '—';
      document.getElementById('3d-steps')!.innerHTML = steps.map(s => `<div>${s}</div>`).join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      (document.getElementById('3d-weight') as HTMLInputElement).value = '50';
      (document.getElementById('3d-fpcost') as HTMLInputElement).value = '25';
      (document.getElementById('3d-watts') as HTMLInputElement).value = '200';
      (document.getElementById('3d-hours') as HTMLInputElement).value = '4';
      (document.getElementById('3d-rate') as HTMLInputElement).value = '0.12';
      (document.getElementById('3d-labor') as HTMLInputElement).value = '0';
      (document.getElementById('3d-markup') as HTMLInputElement).value = '0';
      document.querySelectorAll('.td-in').forEach(el => { el.addEventListener('input', calcTd); el.addEventListener('change', calcTd); });
      calcTd();
    }, 50);
  </script>
</CalculatorLayout>
