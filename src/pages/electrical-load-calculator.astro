---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Electrical Load Calculator";
const description = "Calculate total electrical load for your home or panel. Determine breaker size and service requirements.";
const relatedCalcs = [
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Electric." },
  { name: "HVAC", url: "/hvac-calculator", description: "HVAC." },
  { name: "Lighting", url: "/lighting-calculator", description: "Lighting." },
  { name: "Voltage Divider", url: "/voltage-divider-calculator", description: "Voltage." },
  { name: "Solar Panel", url: "/solar-panel-calculator", description: "Solar." },
  { name: "Square Footage", url: "/square-footage-calculator", description: "Sq ft." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Electrical Load Calculator" keywords="electrical load calculator, panel load, breaker size, amps, watts, service sizing" breadcrumbs={[{ name: "Electrical Load", url: "/electrical-load-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Electrical Load Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate total electrical load and breaker requirements.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div><label class="block text-xs font-medium text-text mb-1">Voltage</label>
          <select id="el-volt" class="el-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="120">120V (standard US)</option>
            <option value="240" selected>240V (main panel)</option>
            <option value="208">208V (commercial)</option>
          </select>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Loads (watts)</h3>
          <div class="grid grid-cols-2 gap-2">
            <div><label class="block text-xs text-text-muted">General Lighting</label><input type="number" id="el-light" class="el-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="3000" step="100"></div>
            <div><label class="block text-xs text-text-muted">Small Appliances</label><input type="number" id="el-small" class="el-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="3000" step="100"></div>
            <div><label class="block text-xs text-text-muted">Kitchen</label><input type="number" id="el-kitchen" class="el-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="6000" step="100"></div>
            <div><label class="block text-xs text-text-muted">HVAC / Heat</label><input type="number" id="el-hvac" class="el-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="5000" step="100"></div>
            <div><label class="block text-xs text-text-muted">Water Heater</label><input type="number" id="el-water" class="el-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="4500" step="100"></div>
            <div><label class="block text-xs text-text-muted">Dryer</label><input type="number" id="el-dryer" class="el-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="5000" step="100"></div>
            <div><label class="block text-xs text-text-muted">EV Charger</label><input type="number" id="el-ev" class="el-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="0" step="100"></div>
            <div><label class="block text-xs text-text-muted">Other</label><input type="number" id="el-other" class="el-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="2000" step="100"></div>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Load</div>
          <div class="text-5xl font-extrabold font-mono" id="el-result">0 W</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Amperage</div><div class="text-xl font-bold font-mono" id="el-amps">0 A</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Min Panel</div><div class="text-xl font-bold font-mono" id="el-panel">0 A</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Safety (80%)</div><div class="text-xl font-bold font-mono" id="el-safe">0 A</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Breakdown</h3>
          <div class="text-xs space-y-1" id="el-breakdown"></div>
        </div>
      </div>
      <ShareButton calculatorId="electrical-load" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcEL() {
      const volt = parseFloat((document.getElementById('el-volt') as HTMLSelectElement).value);
      const loads = [
        { name: 'Lighting', val: parseFloat((document.getElementById('el-light') as HTMLInputElement).value) || 0 },
        { name: 'Small Appliances', val: parseFloat((document.getElementById('el-small') as HTMLInputElement).value) || 0 },
        { name: 'Kitchen', val: parseFloat((document.getElementById('el-kitchen') as HTMLInputElement).value) || 0 },
        { name: 'HVAC / Heat', val: parseFloat((document.getElementById('el-hvac') as HTMLInputElement).value) || 0 },
        { name: 'Water Heater', val: parseFloat((document.getElementById('el-water') as HTMLInputElement).value) || 0 },
        { name: 'Dryer', val: parseFloat((document.getElementById('el-dryer') as HTMLInputElement).value) || 0 },
        { name: 'EV Charger', val: parseFloat((document.getElementById('el-ev') as HTMLInputElement).value) || 0 },
        { name: 'Other', val: parseFloat((document.getElementById('el-other') as HTMLInputElement).value) || 0 },
      ];
      const totalW = loads.reduce((s, l) => s + l.val, 0);
      const amps = volt > 0 ? totalW / volt : 0;
      const panelSizes = [100, 125, 150, 200, 300, 400];
      const minPanel = panelSizes.find(p => p >= amps * 1.25) || 400;
      document.getElementById('el-result')!.textContent = totalW.toLocaleString() + ' W';
      document.getElementById('el-amps')!.textContent = amps.toFixed(1) + ' A';
      document.getElementById('el-panel')!.textContent = minPanel + ' A';
      document.getElementById('el-safe')!.textContent = (minPanel * 0.8).toFixed(0) + ' A';
      const breakdown = loads.filter(l => l.val > 0).map(l => {
        const pct = totalW > 0 ? (l.val / totalW * 100).toFixed(1) : '0';
        return `<div class="flex justify-between"><span>${l.name}</span><span>${l.val.toLocaleString()} W (${pct}%)</span></div>`;
      });
      document.getElementById('el-breakdown')!.innerHTML = breakdown.join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.el-in').forEach(el => { el.addEventListener('input', calcEL); el.addEventListener('change', calcEL); });
      calcEL();
    }, 50);
  </script>
</CalculatorLayout>
