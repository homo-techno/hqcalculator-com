---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Skincare Routine Calculator - Product Layering Order & Wait Times";
const description = "Calculate the optimal skincare product layering order and wait times between steps for maximum effectiveness of your routine.";
const relatedCalcs = [
  { name: "Skin Type Calculator", url: "/skin-type-calculator", description: "Determine your skin type." },
  { name: "SPF Calculator", url: "/spf-calculator", description: "SPF protection time calculation." },
  { name: "Chemical Peel Calculator", url: "/chemical-peel-calculator", description: "Peel depth and recovery time." },
  { name: "Cosmetic Expiration Calculator", url: "/cosmetic-expiration-calculator", description: "Product shelf life tracker." },
  { name: "Beauty Budget Calculator", url: "/beauty-budget-calculator", description: "Monthly beauty spending breakdown." },
  { name: "Botox Unit Calculator", url: "/botox-unit-calculator", description: "Botox units by treatment area." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Skincare Routine Calculator" keywords="skincare routine, product layering, skincare order, wait times, AM PM routine, skincare steps" breadcrumbs={[{ name: "Skincare Routine", url: "/skincare-routine-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Skincare Routine Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Build your optimal skincare routine with correct layering order and wait times.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Routine Type</label>
          <select id="skr-routine" class="skr-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="am">Morning (AM) Routine</option>
            <option value="pm">Evening (PM) Routine</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Skin Type</label>
          <select id="skr-skin" class="skr-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="normal">Normal</option>
            <option value="oily">Oily</option>
            <option value="dry">Dry</option>
            <option value="combo">Combination</option>
            <option value="sensitive">Sensitive</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-2">Select Your Products</label>
          <div class="space-y-2">
            <label class="flex items-center gap-2"><input type="checkbox" id="skr-cleanser" class="skr-in" checked><span class="text-sm">Cleanser</span></label>
            <label class="flex items-center gap-2"><input type="checkbox" id="skr-toner" class="skr-in" checked><span class="text-sm">Toner</span></label>
            <label class="flex items-center gap-2"><input type="checkbox" id="skr-vitc" class="skr-in"><span class="text-sm">Vitamin C Serum</span></label>
            <label class="flex items-center gap-2"><input type="checkbox" id="skr-hyaluronic" class="skr-in" checked><span class="text-sm">Hyaluronic Acid</span></label>
            <label class="flex items-center gap-2"><input type="checkbox" id="skr-niacinamide" class="skr-in"><span class="text-sm">Niacinamide</span></label>
            <label class="flex items-center gap-2"><input type="checkbox" id="skr-retinol" class="skr-in"><span class="text-sm">Retinol / Retinoid</span></label>
            <label class="flex items-center gap-2"><input type="checkbox" id="skr-aha" class="skr-in"><span class="text-sm">AHA / BHA Exfoliant</span></label>
            <label class="flex items-center gap-2"><input type="checkbox" id="skr-eyecream" class="skr-in"><span class="text-sm">Eye Cream</span></label>
            <label class="flex items-center gap-2"><input type="checkbox" id="skr-moisturizer" class="skr-in" checked><span class="text-sm">Moisturizer</span></label>
            <label class="flex items-center gap-2"><input type="checkbox" id="skr-oil" class="skr-in"><span class="text-sm">Face Oil</span></label>
            <label class="flex items-center gap-2"><input type="checkbox" id="skr-spf" class="skr-in"><span class="text-sm">SPF Sunscreen</span></label>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Routine Time</div>
          <div class="text-5xl font-extrabold font-mono" id="skr-total">0 min</div>
          <div class="text-sm text-blue-200 mt-1">including wait times</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Products</div><div class="text-xl font-bold" id="skr-count">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Steps</div><div class="text-xl font-bold" id="skr-steps">0</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Your Routine Order</h3>
          <div class="text-sm space-y-2" id="skr-order"></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl" id="skr-warnings-box" style="display:none;">
          <h3 class="font-semibold text-sm text-text mb-3">Warnings</h3>
          <div class="text-sm text-red-600 space-y-1" id="skr-warnings"></div>
        </div>
      </div>
      <ShareButton calculatorId="skincare-routine" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Skincare Layering Guide</h2>
      <p>The general rule for skincare layering is to apply products from thinnest to thickest consistency. Actives like Vitamin C and retinol need wait times to absorb and work at the correct pH. Never combine retinol with AHA/BHA in the same routine, and always finish with SPF in the morning. Consistency matters more than complexity - a simple routine done daily beats an elaborate one done sporadically.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcSKR() {
      const routine = (document.getElementById('skr-routine') as HTMLSelectElement).value;
      const skin = (document.getElementById('skr-skin') as HTMLSelectElement).value;

      const products: {name:string, wait:number, order:number, id:string}[] = [
        {name:'Cleanser', wait:0, order:1, id:'skr-cleanser'},
        {name:'Toner', wait:0, order:2, id:'skr-toner'},
        {name:'Vitamin C Serum', wait:2, order:3, id:'skr-vitc'},
        {name:'AHA / BHA Exfoliant', wait:3, order:4, id:'skr-aha'},
        {name:'Niacinamide', wait:1, order:5, id:'skr-niacinamide'},
        {name:'Hyaluronic Acid', wait:1, order:6, id:'skr-hyaluronic'},
        {name:'Retinol / Retinoid', wait:3, order:7, id:'skr-retinol'},
        {name:'Eye Cream', wait:1, order:8, id:'skr-eyecream'},
        {name:'Moisturizer', wait:1, order:9, id:'skr-moisturizer'},
        {name:'Face Oil', wait:1, order:10, id:'skr-oil'},
        {name:'SPF Sunscreen', wait:2, order:11, id:'skr-spf'},
      ];

      const selected = products.filter(p => (document.getElementById(p.id) as HTMLInputElement).checked);
      selected.sort((a, b) => a.order - b.order);

      let totalTime = 0;
      const steps: string[] = [];
      selected.forEach((p, i) => {
        const applyTime = 1;
        totalTime += applyTime;
        if (i < selected.length - 1) totalTime += p.wait;
        const waitText = (i < selected.length - 1 && p.wait > 0) ? ' (wait ' + p.wait + ' min before next step)' : '';
        steps.push('<div class="flex items-start gap-2"><span class="font-bold text-primary">' + (i+1) + '.</span><span>' + p.name + ' - ~' + applyTime + ' min' + waitText + '</span></div>');
      });

      const warnings: string[] = [];
      const hasRetinol = (document.getElementById('skr-retinol') as HTMLInputElement).checked;
      const hasAHA = (document.getElementById('skr-aha') as HTMLInputElement).checked;
      const hasVitC = (document.getElementById('skr-vitc') as HTMLInputElement).checked;

      if (hasRetinol && hasAHA) warnings.push('Do not use Retinol and AHA/BHA in the same routine - alternate nights instead.');
      if (hasRetinol && routine === 'am') warnings.push('Retinol should only be used in PM routines - it degrades in sunlight.');
      if (hasVitC && hasAHA) warnings.push('Vitamin C and AHA/BHA can be irritating together - use in separate routines.');
      if (routine === 'am' && !(document.getElementById('skr-spf') as HTMLInputElement).checked) warnings.push('Always use SPF in your morning routine to protect skin.');
      if (skin === 'sensitive' && hasAHA && hasRetinol) warnings.push('Sensitive skin should avoid multiple actives - simplify your routine.');

      document.getElementById('skr-total')!.textContent = totalTime + ' min';
      document.getElementById('skr-count')!.textContent = selected.length.toString();
      document.getElementById('skr-steps')!.textContent = selected.length.toString();
      document.getElementById('skr-order')!.innerHTML = steps.length > 0 ? steps.join('') : '<p class="text-text-muted">Select products above to build your routine.</p>';

      const warningsBox = document.getElementById('skr-warnings-box')!;
      const warningsEl = document.getElementById('skr-warnings')!;
      if (warnings.length > 0) {
        warningsBox.style.display = 'block';
        warningsEl.innerHTML = warnings.map(w => '<p>' + w + '</p>').join('');
      } else {
        warningsBox.style.display = 'none';
      }
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.skr-in').forEach(el => { el.addEventListener('input', calcSKR); el.addEventListener('change', calcSKR); });
      calcSKR();
    }, 50);
  </script>
</CalculatorLayout>
