---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Cake Serving Calculator - Cake Size & Tiers for Guest Count";
const description = "Calculate the right cake size and number of tiers for your event. Choose between wedding, party, and sheet cake styles with custom serving sizes.";
const relatedCalcs = [
  { name: "Catering Quantity Calculator", url: "/catering-quantity-calculator", description: "Food quantities per guest." },
  { name: "Event Budget Calculator", url: "/event-budget-calculator", description: "Total event cost breakdown." },
  { name: "Party Supplies Calculator", url: "/party-supplies-calculator", description: "Plates and utensils needed." },
  { name: "Wedding Timeline Calculator", url: "/wedding-timeline-calculator", description: "Wedding day schedule." },
  { name: "Bartender Calculator", url: "/bartender-calculator", description: "Bar service quantities." },
  { name: "Invitation Calculator", url: "/invitation-calculator", description: "Invitation quantities." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Cake Serving Calculator"
  keywords="cake serving calculator, cake size, wedding cake, cake tiers, cake portions, cake servings"
  breadcrumbs={[{ name: "Cake Serving", url: "/cake-serving-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Cake Serving Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find the right cake size and tiers for your guest count.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4 mb-6">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Number of Guests</label>
          <input type="number" id="ck2-guests" class="ck2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="100" min="1" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Serving Size</label>
          <select id="ck2-serving" class="ck2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="wedding">Wedding (1"x2"x4" slices)</option>
            <option value="party">Party (generous 2"x2"x4" slices)</option>
            <option value="dessert">Dessert bar (small portions, 75% served)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Cake Shape</label>
          <select id="ck2-shape" class="ck2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="round">Round</option>
            <option value="square">Square</option>
            <option value="sheet">Sheet Cake</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Cake Style</label>
          <select id="ck2-style" class="ck2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="tiered">Tiered (stacked)</option>
            <option value="single">Single Layer</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Price Per Serving ($)</label>
          <input type="number" id="ck2-price" class="ck2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="1" max="25" step="0.5">
        </div>
      </div>

      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Cake</div>
        <div class="text-4xl font-extrabold" id="ck2-recommend">--</div>
        <div class="text-sm mt-1" id="ck2-servings">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Total Servings</div>
          <div class="text-xl font-bold" id="ck2-totalserv">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Estimated Cost</div>
          <div class="text-xl font-bold" id="ck2-cost">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Number of Tiers</div>
          <div class="text-xl font-bold" id="ck2-tiers">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Height (approx)</div>
          <div class="text-xl font-bold" id="ck2-height">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-4" id="ck2-details"></div>

      <ShareButton calculatorId="cake-serving" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Cake Serving Guide</h2>
      <p>Wedding servings are typically 1"x2"x4" slices. A 3-tier cake (6", 9", 12" rounds) serves approximately 100 wedding-size slices. Sheet cakes are the most economical option for large events.</p>
      <h3 class="text-xl font-semibold text-text mt-6">Round Cake Servings</h3>
      <ul>
        <li>6" round: 12 wedding / 8 party slices</li>
        <li>8" round: 24 wedding / 14 party slices</li>
        <li>10" round: 38 wedding / 20 party slices</li>
        <li>12" round: 56 wedding / 30 party slices</li>
        <li>14" round: 78 wedding / 40 party slices</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcCK2() {
      const guests = parseInt((document.getElementById('ck2-guests') as HTMLInputElement).value) || 1;
      const serving = (document.getElementById('ck2-serving') as HTMLSelectElement).value;
      const shape = (document.getElementById('ck2-shape') as HTMLSelectElement).value;
      const style = (document.getElementById('ck2-style') as HTMLSelectElement).value;
      const price = parseFloat((document.getElementById('ck2-price') as HTMLInputElement).value) || 6;

      let servingsNeeded = guests;
      if (serving === 'dessert') servingsNeeded = Math.ceil(guests * 0.75);

      const roundWedding: Record<number, number> = { 6: 12, 8: 24, 9: 32, 10: 38, 12: 56, 14: 78, 16: 100 };
      const roundParty: Record<number, number> = { 6: 8, 8: 14, 9: 18, 10: 20, 12: 30, 14: 40, 16: 50 };
      const squareWedding: Record<number, number> = { 6: 18, 8: 32, 10: 50, 12: 72, 14: 98, 16: 128 };
      const squareParty: Record<number, number> = { 6: 12, 8: 20, 10: 32, 12: 45, 14: 63, 16: 80 };

      let tierSizes: number[] = [];
      let totalServings = 0;
      let rec = '';

      if (shape === 'sheet') {
        const quarterSheet = serving === 'party' ? 12 : 18;
        const halfSheet = serving === 'party' ? 24 : 36;
        const fullSheet = serving === 'party' ? 48 : 72;
        const sheetsNeeded = Math.ceil(servingsNeeded / fullSheet);
        totalServings = sheetsNeeded * fullSheet;
        rec = sheetsNeeded + ' full sheet cake' + (sheetsNeeded > 1 ? 's' : '') + ' (18x26")';
        tierSizes = [];
      } else if (style === 'single') {
        const servMap = shape === 'round' ? (serving === 'party' ? roundParty : roundWedding) : (serving === 'party' ? squareParty : squareWedding);
        const sizes = Object.keys(servMap).map(Number).sort((a, b) => a - b);
        let bestSize = sizes[sizes.length - 1];
        for (const s of sizes) {
          if (servMap[s] >= servingsNeeded) { bestSize = s; break; }
        }
        totalServings = servMap[bestSize];
        rec = bestSize + '" ' + shape + ' (single layer)';
        tierSizes = [bestSize];
      } else {
        const servMap = shape === 'round' ? (serving === 'party' ? roundParty : roundWedding) : (serving === 'party' ? squareParty : squareWedding);
        const sizes = Object.keys(servMap).map(Number).sort((a, b) => b - a);
        let remaining = servingsNeeded;
        tierSizes = [];
        let currentMax = sizes[0];

        while (remaining > 0 && tierSizes.length < 6) {
          let bestFit = sizes.find(s => s <= currentMax && servMap[s] <= remaining + 5) || sizes[sizes.length - 1];
          if (tierSizes.length === 0) {
            bestFit = sizes.find(s => servMap[s] >= remaining * 0.3) || sizes[0];
            if (servMap[bestFit] >= remaining) {
              tierSizes.push(bestFit);
              remaining -= servMap[bestFit];
              break;
            }
          }
          tierSizes.push(bestFit);
          remaining -= servMap[bestFit];
          currentMax = bestFit - 2;
          if (currentMax < sizes[sizes.length - 1]) break;
        }

        if (remaining > 0 && tierSizes.length < 6) {
          const smallest = sizes[sizes.length - 1];
          tierSizes.push(smallest);
        }

        tierSizes.sort((a, b) => b - a);
        totalServings = tierSizes.reduce((sum, s) => sum + (servMap[s] || 0), 0);
        rec = tierSizes.length + '-tier ' + shape + ' (' + tierSizes.join('", ') + '")';
      }

      const numTiers = tierSizes.length || 1;
      const heightInches = numTiers * 5 + (numTiers - 1) * 1;
      const cost = totalServings * price;

      document.getElementById('ck2-recommend')!.textContent = rec;
      document.getElementById('ck2-servings')!.textContent = 'Serves ' + totalServings + (totalServings >= servingsNeeded ? ' (enough)' : ' (may need supplemental)');
      document.getElementById('ck2-totalserv')!.textContent = totalServings.toString();
      document.getElementById('ck2-cost')!.textContent = '$' + Math.round(cost).toLocaleString();
      document.getElementById('ck2-tiers')!.textContent = shape === 'sheet' ? 'N/A' : numTiers.toString();
      document.getElementById('ck2-height')!.textContent = shape === 'sheet' ? '4"' : heightInches + '"';

      let details = '<h3 class="font-semibold text-sm text-text mb-2">Cake Details</h3><ul class="text-sm text-text-secondary space-y-1">';
      details += '<li>Servings needed: ' + servingsNeeded + '</li>';
      details += '<li>Servings provided: ' + totalServings + '</li>';
      details += '<li>Serving style: ' + (serving === 'wedding' ? 'Wedding (1"x2"x4")' : serving === 'party' ? 'Party (2"x2"x4")' : 'Dessert bar (small portions)') + '</li>';
      details += '<li>Estimated cost at $' + price + '/serving: $' + Math.round(cost).toLocaleString() + '</li>';
      if (totalServings < servingsNeeded) {
        details += '<li class="text-red-600 font-semibold">Consider adding a supplemental sheet cake for ' + (servingsNeeded - totalServings) + ' more servings</li>';
      }
      details += '</ul>';
      document.getElementById('ck2-details')!.innerHTML = details;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ck2-in').forEach(el => { el.addEventListener('input', calcCK2); el.addEventListener('change', calcCK2); });
      calcCK2();
    }, 50);
  </script>
</CalculatorLayout>
