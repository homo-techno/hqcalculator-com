---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Wave Height Calculator - Significant Wave Height & Beaufort Scale";
const description = "Calculate significant wave height from wind speed, fetch, and duration. Includes Beaufort scale correlation and sea state estimates.";
const relatedCalcs = [
  { name: "Wind Speed", url: "/wind-speed-converter", description: "Wind speed conversion." },
  { name: "Tide Calculator", url: "/tide-calculator", description: "Tidal predictions." },
  { name: "Nautical Mile", url: "/nautical-mile-calculator", description: "Nautical distance conversion." },
  { name: "Bearing", url: "/bearing-calculator", description: "Navigation bearings." },
  { name: "Great Circle", url: "/great-circle-calculator", description: "Great circle navigation." },
  { name: "Buoyancy", url: "/buoyancy-calculator", description: "Buoyancy force calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Wave Height Calculator" keywords="wave height calculator, significant wave height, Beaufort scale, sea state, wind waves, fetch, wave period" breadcrumbs={[{ name: "Wave Height", url: "/wave-height-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Wave Height Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate significant wave height from wind speed, fetch distance, and duration using oceanographic formulas.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Wind Speed (knots)</label><input type="number" id="wh-wind" class="wh-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Fetch (nautical miles)</label><input type="number" id="wh-fetch" class="wh-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="10"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Duration (hours)</label><input type="number" id="wh-dur" class="wh-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Water Depth (ft)</label><input type="number" id="wh-depth" class="wh-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="10"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Significant Wave Height</div>
          <div class="text-5xl font-extrabold font-mono" id="wh-hs">--</div>
          <div class="text-sm text-blue-200 mt-1">feet</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Wave Period</div><div class="text-xl font-bold" id="wh-period">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Wavelength</div><div class="text-xl font-bold" id="wh-wl">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Max Wave</div><div class="text-xl font-bold" id="wh-max">--</div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Beaufort</div><div class="text-xl font-bold" id="wh-bft">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Sea State</div><div class="text-xl font-bold" id="wh-sea">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Wave Steepness</div><div class="text-xl font-bold" id="wh-steep">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="wave-height" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcWH() {
      const windKts = parseFloat((document.getElementById('wh-wind') as HTMLInputElement).value) || 0;
      const fetchNM = parseFloat((document.getElementById('wh-fetch') as HTMLInputElement).value) || 0;
      const duration = parseFloat((document.getElementById('wh-dur') as HTMLInputElement).value) || 0;
      const depth = parseFloat((document.getElementById('wh-depth') as HTMLInputElement).value) || 1000;

      const windMs = windKts * 0.514444;
      const fetchM = fetchNM * 1852;
      const durationSec = duration * 3600;
      const g = 9.81;

      // SMB method (Sverdrup-Munk-Bretschneider)
      // Fetch-limited wave height: Hs = 0.283 * (U^2/g) * tanh(0.0125 * (g*F/U^2)^0.42)
      const fetchFactor = fetchM > 0 ? 0.0125 * Math.pow((g * fetchM) / (windMs * windMs), 0.42) : 0;
      const hsFetchM = windMs > 0 ? 0.283 * (windMs * windMs / g) * Math.tanh(fetchFactor) : 0;

      // Duration-limited wave height
      const durFactor = durationSec > 0 && windMs > 0 ? 0.00654 * Math.pow((g * durationSec) / windMs, 0.715) : 0;
      const hsDurM = windMs > 0 ? 0.283 * (windMs * windMs / g) * Math.tanh(durFactor) : 0;

      // Limiting factor is the smaller of fetch-limited and duration-limited
      const hsM = Math.min(hsFetchM, hsDurM);
      const hsFt = hsM * 3.28084;

      // Wave period: Ts = 7.54 * (Hs/g)^0.5 approximately
      const periodS = hsM > 0 ? 7.54 * Math.sqrt(hsM) : 0;

      // Deep-water wavelength: L = g * T^2 / (2*pi)
      const wavelengthM = periodS > 0 ? (g * periodS * periodS) / (2 * Math.PI) : 0;
      const wavelengthFt = wavelengthM * 3.28084;

      // Max wave ~ 1.86 * Hs
      const maxWaveFt = hsFt * 1.86;

      // Wave steepness = Hs / L
      const steepness = wavelengthM > 0 ? hsM / wavelengthM : 0;

      // Beaufort scale
      let beaufort = 0;
      const bftThresholds = [1, 4, 7, 11, 17, 22, 28, 34, 41, 48, 56, 64];
      for (let i = 0; i < bftThresholds.length; i++) {
        if (windKts >= bftThresholds[i]) beaufort = i + 1;
      }

      // Sea state description
      const seaStates = ['Calm', 'Calm', 'Smooth', 'Slight', 'Moderate', 'Rough', 'Very Rough', 'High', 'Very High', 'Phenomenal'];
      let seaIdx = 0;
      if (hsFt < 0.33) seaIdx = 0;
      else if (hsFt < 1.6) seaIdx = 1;
      else if (hsFt < 4) seaIdx = 2;
      else if (hsFt < 8) seaIdx = 3;
      else if (hsFt < 13) seaIdx = 4;
      else if (hsFt < 20) seaIdx = 5;
      else if (hsFt < 30) seaIdx = 6;
      else if (hsFt < 46) seaIdx = 7;
      else seaIdx = 8;

      document.getElementById('wh-hs')!.textContent = hsFt > 0 ? hsFt.toFixed(1) : '--';
      document.getElementById('wh-period')!.textContent = periodS > 0 ? periodS.toFixed(1) + ' s' : '--';
      document.getElementById('wh-wl')!.textContent = wavelengthFt > 0 ? Math.round(wavelengthFt) + ' ft' : '--';
      document.getElementById('wh-max')!.textContent = maxWaveFt > 0 ? maxWaveFt.toFixed(1) + ' ft' : '--';
      document.getElementById('wh-bft')!.textContent = 'Force ' + beaufort;
      document.getElementById('wh-sea')!.textContent = seaStates[seaIdx] || '--';
      document.getElementById('wh-steep')!.textContent = steepness > 0 ? (steepness * 100).toFixed(2) + '%' : '--';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      (document.getElementById('wh-wind') as HTMLInputElement).value = '20';
      (document.getElementById('wh-fetch') as HTMLInputElement).value = '100';
      (document.getElementById('wh-dur') as HTMLInputElement).value = '12';
      (document.getElementById('wh-depth') as HTMLInputElement).value = '200';
      document.querySelectorAll('.wh-in').forEach(el => { el.addEventListener('input', calcWH); el.addEventListener('change', calcWH); });
      calcWH();
    }, 50);
  </script>
</CalculatorLayout>
