---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Matrix Calculator - Matrix Operations Online";
const description = "Perform matrix addition, subtraction, multiplication, determinant, transpose, and inverse operations. Supports 2x2 and 3x3 matrices.";
const relatedCalcs = [
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Scientific math." },
  { name: "Fraction Calculator", url: "/fraction-calculator", description: "Fractions." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Standard Deviation", url: "/standard-deviation-calculator", description: "Statistics." },
  { name: "Quadratic Equation", url: "/quadratic-equation-calculator", description: "Quadratics." },
  { name: "Average Calculator", url: "/average-calculator", description: "Averages." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Matrix Calculator" keywords="matrix calculator, matrix multiplication, determinant, inverse matrix, matrix operations" breadcrumbs={[{ name: "Matrix Calculator", url: "/matrix-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Matrix Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Add, subtract, multiply matrices, and find determinants, transposes, and inverses.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="space-y-4">
        <div class="flex gap-3 items-center flex-wrap">
          <label class="text-xs font-medium text-text">Size:</label>
          <select id="mx-size" class="px-3 py-2 border border-border rounded-xl text-sm">
            <option value="2">2×2</option>
            <option value="3" selected>3×3</option>
          </select>
          <label class="text-xs font-medium text-text ml-4">Operation:</label>
          <select id="mx-op" class="px-3 py-2 border border-border rounded-xl text-sm">
            <option value="add">A + B</option>
            <option value="sub">A − B</option>
            <option value="mul">A × B</option>
            <option value="det">Determinant of A</option>
            <option value="trans">Transpose of A</option>
            <option value="inv">Inverse of A</option>
          </select>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div>
            <h3 class="font-semibold text-sm text-text mb-2">Matrix A</h3>
            <div id="mx-a"></div>
          </div>
          <div id="mx-b-wrap">
            <h3 class="font-semibold text-sm text-text mb-2">Matrix B</h3>
            <div id="mx-b"></div>
          </div>
        </div>
        <button id="mx-calc" class="w-full py-3 bg-primary text-white font-bold rounded-xl text-lg hover:opacity-90">Calculate</button>
        <div class="p-6 bg-surface-alt rounded-2xl">
          <h3 class="font-semibold text-sm text-text mb-3">Result</h3>
          <div id="mx-result" class="font-mono text-sm"></div>
        </div>
      </div>
      <ShareButton calculatorId="matrix" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Matrix Operations</h2>
      <p>Matrices are rectangular arrays of numbers used extensively in linear algebra, computer graphics, physics, and engineering.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    type Mat = number[][];
    function buildGrid(id: string, n: number, defaults?: number[][]) {
      const el = document.getElementById(id)!;
      el.innerHTML = '';
      const tbl = document.createElement('div');
      tbl.className = 'grid gap-1';
      tbl.style.gridTemplateColumns = `repeat(${n}, 1fr)`;
      for (let r = 0; r < n; r++) for (let c = 0; c < n; c++) {
        const inp = document.createElement('input');
        inp.type = 'number'; inp.className = `${id}-cell w-full px-2 py-2 border border-border rounded-lg text-center text-sm font-mono`;
        inp.dataset.r = String(r); inp.dataset.c = String(c);
        inp.value = defaults ? String(defaults[r][c]) : r === c ? '1' : '0';
        tbl.appendChild(inp);
      }
      el.appendChild(tbl);
    }
    function readMat(id: string, n: number): Mat {
      const m: Mat = [];
      for (let r = 0; r < n; r++) { m[r] = []; for (let c = 0; c < n; c++) m[r][c] = 0; }
      document.querySelectorAll(`.${id}-cell`).forEach((el) => {
        const inp = el as HTMLInputElement;
        m[parseInt(inp.dataset.r!)][parseInt(inp.dataset.c!)] = parseFloat(inp.value) || 0;
      });
      return m;
    }
    function det2(m: Mat): number { return m[0][0]*m[1][1] - m[0][1]*m[1][0]; }
    function det3(m: Mat): number {
      return m[0][0]*(m[1][1]*m[2][2]-m[1][2]*m[2][1]) - m[0][1]*(m[1][0]*m[2][2]-m[1][2]*m[2][0]) + m[0][2]*(m[1][0]*m[2][1]-m[1][1]*m[2][0]);
    }
    function transpose(m: Mat): Mat { const n = m.length; const r: Mat = []; for(let i=0;i<n;i++){r[i]=[];for(let j=0;j<n;j++)r[i][j]=m[j][i];} return r; }
    function inv2(m: Mat): Mat|null { const d=det2(m); if(Math.abs(d)<1e-10)return null; return [[m[1][1]/d,-m[0][1]/d],[-m[1][0]/d,m[0][0]/d]]; }
    function inv3(m: Mat): Mat|null {
      const d=det3(m); if(Math.abs(d)<1e-10)return null;
      const cf: Mat = [[0,0,0],[0,0,0],[0,0,0]];
      for(let i=0;i<3;i++)for(let j=0;j<3;j++){
        const sub: number[]=[]; for(let r=0;r<3;r++)for(let c=0;c<3;c++)if(r!==i&&c!==j)sub.push(m[r][c]);
        cf[i][j]=((i+j)%2===0?1:-1)*(sub[0]*sub[3]-sub[1]*sub[2]);
      }
      const adj=transpose(cf);
      return adj.map(row=>row.map(v=>v/d));
    }
    function matMul(a: Mat, b: Mat): Mat { const n=a.length; const r:Mat=[]; for(let i=0;i<n;i++){r[i]=[]; for(let j=0;j<n;j++){let s=0; for(let k=0;k<n;k++)s+=a[i][k]*b[k][j]; r[i][j]=s;}} return r; }
    function matAdd(a: Mat, b: Mat, sign: number): Mat { return a.map((row,i)=>row.map((v,j)=>v+sign*b[i][j])); }
    function fmtMat(m: Mat): string {
      return '<div class="grid gap-1 max-w-xs" style="grid-template-columns:repeat('+m.length+',1fr)">' +
        m.flat().map(v => `<div class="px-2 py-1 bg-white border border-border rounded text-center text-sm">${parseFloat(v.toFixed(4))}</div>`).join('') + '</div>';
    }
    function calc() {
      const n = parseInt((document.getElementById('mx-size') as HTMLSelectElement).value);
      const op = (document.getElementById('mx-op') as HTMLSelectElement).value;
      const a = readMat('mx-a', n);
      const b = readMat('mx-b', n);
      let html = '';
      if (op === 'add') html = fmtMat(matAdd(a, b, 1));
      else if (op === 'sub') html = fmtMat(matAdd(a, b, -1));
      else if (op === 'mul') html = fmtMat(matMul(a, b));
      else if (op === 'det') { const d = n===2?det2(a):det3(a); html = `<div class="text-3xl font-bold">${parseFloat(d.toFixed(6))}</div>`; }
      else if (op === 'trans') html = fmtMat(transpose(a));
      else if (op === 'inv') { const inv = n===2?inv2(a):inv3(a); html = inv ? fmtMat(inv) : '<div class="text-red-600 font-semibold">Matrix is singular (no inverse)</div>'; }
      document.getElementById('mx-result')!.innerHTML = html;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    function setup() {
      const n = parseInt((document.getElementById('mx-size') as HTMLSelectElement).value);
      buildGrid('mx-a', n); buildGrid('mx-b', n);
      const op = (document.getElementById('mx-op') as HTMLSelectElement).value;
      document.getElementById('mx-b-wrap')!.style.display = ['det','trans','inv'].includes(op) ? 'none' : '';
    }
    setTimeout(() => {
      setup();
      document.getElementById('mx-size')!.addEventListener('change', setup);
      document.getElementById('mx-op')!.addEventListener('change', () => {
        const op = (document.getElementById('mx-op') as HTMLSelectElement).value;
        document.getElementById('mx-b-wrap')!.style.display = ['det','trans','inv'].includes(op) ? 'none' : '';
      });
      document.getElementById('mx-calc')!.addEventListener('click', calc);
      calc();
    }, 50);
  </script>
</CalculatorLayout>
