---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Event Timeline Calculator - Event Schedule & Time Block Planner";
const description = "Create a detailed event schedule with setup, start, activities, and cleanup time blocks. Plan any corporate event, party, or ceremony with precise timing.";
const relatedCalcs = [
  { name: "Wedding Timeline Calculator", url: "/wedding-timeline-calculator", description: "Wedding day schedule." },
  { name: "Event Budget Calculator", url: "/event-budget-calculator", description: "Total event cost breakdown." },
  { name: "Event Staffing Calculator", url: "/event-staffing-calculator", description: "Staff needed for events." },
  { name: "DJ Playlist Calculator", url: "/dj-playlist-calculator", description: "Music for time slots." },
  { name: "Conference Calculator", url: "/conference-calculator", description: "Conference planning." },
  { name: "Sound System Calculator", url: "/sound-system-calculator", description: "Audio equipment needed." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Event Timeline Calculator"
  keywords="event timeline calculator, event schedule, event planner, time blocks, event agenda, event itinerary"
  breadcrumbs={[{ name: "Event Timeline", url: "/event-timeline-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Event Timeline Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Build a complete event schedule from setup through cleanup.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4 mb-6">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Event Start Time (doors open)</label>
          <input type="time" id="et2-start" class="et2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="18:00">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Event Type</label>
          <select id="et2-type" class="et2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="corporate">Corporate Event / Gala</option>
            <option value="party">Birthday / Celebration Party</option>
            <option value="ceremony">Ceremony (award, graduation)</option>
            <option value="fundraiser">Fundraiser / Charity Event</option>
            <option value="holiday">Holiday Party</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Setup Time Needed (hours before)</label>
          <input type="number" id="et2-setup" class="et2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="0.5" max="8" step="0.5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Event Duration (hours)</label>
          <input type="number" id="et2-duration" class="et2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" min="1" max="12" step="0.5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Include Meal Service?</label>
          <select id="et2-meal" class="et2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="full">Full dinner</option>
            <option value="buffet">Buffet</option>
            <option value="apps">Appetizers / Cocktails only</option>
            <option value="none">No food service</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Include Speeches / Presentations?</label>
          <input type="number" id="et2-speeches" class="et2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="0" max="10" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Cleanup Time (hours after)</label>
          <input type="number" id="et2-cleanup" class="et2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.5" min="0.5" max="4" step="0.5">
        </div>
      </div>

      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Venue Time Needed</div>
        <div class="text-5xl font-extrabold" id="et2-totaltime">--</div>
        <div class="text-sm mt-1" id="et2-range">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Venue Access</div>
          <div class="text-xl font-bold" id="et2-access">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Event End</div>
          <div class="text-xl font-bold" id="et2-end">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Venue Clear By</div>
          <div class="text-xl font-bold" id="et2-clear">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Time Blocks</div>
          <div class="text-xl font-bold" id="et2-blocks">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-4" id="et2-timeline"></div>

      <ShareButton calculatorId="event-timeline" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Event Timeline Planning Tips</h2>
      <p>Build 10-15 minute buffers between activities. Share the timeline with all vendors at least 2 weeks before. Assign a point person to keep the event on schedule. Venue access time is typically 2-3 hours before the event starts.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcET2() {
      const startStr = (document.getElementById('et2-start') as HTMLInputElement).value;
      const eventType = (document.getElementById('et2-type') as HTMLSelectElement).value;
      const setupHrs = parseFloat((document.getElementById('et2-setup') as HTMLInputElement).value) || 2;
      const duration = parseFloat((document.getElementById('et2-duration') as HTMLInputElement).value) || 4;
      const meal = (document.getElementById('et2-meal') as HTMLSelectElement).value;
      const speeches = parseInt((document.getElementById('et2-speeches') as HTMLInputElement).value) || 0;
      const cleanupHrs = parseFloat((document.getElementById('et2-cleanup') as HTMLInputElement).value) || 1.5;

      const parts = startStr.split(':');
      const startMin = parseInt(parts[0]) * 60 + parseInt(parts[1]);

      function fmtTime(m: number) {
        let h = Math.floor(m / 60) % 24;
        const min = m % 60;
        const ap = h >= 12 ? 'PM' : 'AM';
        if (h === 0) h = 12; else if (h > 12) h -= 12;
        return h + ':' + (min < 10 ? '0' : '') + min + ' ' + ap;
      }

      const setupStart = startMin - setupHrs * 60;
      const eventEnd = startMin + duration * 60;
      const clearBy = eventEnd + cleanupHrs * 60;
      const totalHrs = (clearBy - setupStart) / 60;

      const timeline: { time: number; label: string }[] = [];
      let t = setupStart;
      timeline.push({ time: t, label: 'Venue access / setup begins' });
      t += setupHrs * 60 - 30;
      timeline.push({ time: t, label: 'Vendor load-in complete, final checks' });
      t = startMin - 15;
      timeline.push({ time: t, label: 'Staff briefing & positions' });
      t = startMin;
      timeline.push({ time: t, label: 'Doors open / guests arrive' });
      t += 20;

      if (meal === 'apps') {
        timeline.push({ time: t, label: 'Cocktails & appetizers served' });
        t += 30;
      }

      if (eventType === 'corporate' || eventType === 'ceremony' || eventType === 'fundraiser') {
        timeline.push({ time: t, label: 'Welcome remarks' });
        t += 10;
      }

      if (meal === 'full') {
        timeline.push({ time: t, label: 'Guests seated for dinner' });
        t += 10;
        timeline.push({ time: t, label: 'First course served' });
        t += 30;
        timeline.push({ time: t, label: 'Main course served' });
        t += 35;
      } else if (meal === 'buffet') {
        timeline.push({ time: t, label: 'Buffet opens' });
        t += 45;
      }

      if (speeches > 0) {
        timeline.push({ time: t, label: 'Speeches / presentations begin (' + speeches + ')' });
        t += speeches * 7;
      }

      if (meal === 'full') {
        timeline.push({ time: t, label: 'Dessert served' });
        t += 20;
      }

      if (eventType === 'fundraiser') {
        timeline.push({ time: t, label: 'Auction / fundraising activity' });
        t += 30;
      }

      timeline.push({ time: t, label: 'Entertainment / open activities' });
      const endTime = startMin + duration * 60;
      timeline.push({ time: endTime - 15, label: 'Last call / closing remarks' });
      timeline.push({ time: endTime, label: 'Event ends / guest departure' });
      timeline.push({ time: endTime + 10, label: 'Cleanup & breakdown begins' });
      timeline.push({ time: clearBy, label: 'Venue cleared' });

      document.getElementById('et2-totaltime')!.textContent = totalHrs.toFixed(1) + ' hours';
      document.getElementById('et2-range')!.textContent = fmtTime(setupStart) + ' - ' + fmtTime(clearBy);
      document.getElementById('et2-access')!.textContent = fmtTime(setupStart);
      document.getElementById('et2-end')!.textContent = fmtTime(eventEnd);
      document.getElementById('et2-clear')!.textContent = fmtTime(clearBy);
      document.getElementById('et2-blocks')!.textContent = timeline.length.toString();

      let html = '<h3 class="font-semibold text-sm text-text mb-3">Event Schedule</h3>';
      timeline.sort((a, b) => a.time - b.time);
      timeline.forEach(item => {
        html += '<div class="flex items-start gap-3 py-1.5 border-b border-border last:border-0"><span class="text-sm font-bold text-primary whitespace-nowrap w-20">' + fmtTime(item.time) + '</span><span class="text-sm text-text-secondary">' + item.label + '</span></div>';
      });
      document.getElementById('et2-timeline')!.innerHTML = html;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.et2-in').forEach(el => { el.addEventListener('input', calcET2); el.addEventListener('change', calcET2); });
      calcET2();
    }, 50);
  </script>
</CalculatorLayout>
