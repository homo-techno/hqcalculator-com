---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Cooling Load Calculator - BTU/hr for AC Sizing";
const description = "Calculate building cooling load in BTU/hr from area, windows, occupants, equipment, and orientation. Size your air conditioning system accurately.";

const relatedCalcs = [
  { name: "Heat Loss Calculator", url: "/heat-loss-calculator", description: "Building heat loss." },
  { name: "Duct Sizing Calculator", url: "/duct-sizing-calculator", description: "Size ductwork." },
  { name: "Chiller Sizing Calculator", url: "/chiller-sizing-calculator", description: "Chiller tonnage." },
  { name: "Ventilation Rate Calculator", url: "/ventilation-rate-calculator", description: "ASHRAE ventilation." },
  { name: "Air Changes Calculator", url: "/air-changes-calculator", description: "ACH calculations." },
  { name: "Dehumidifier Calculator", url: "/dehumidifier-calculator", description: "Dehumidifier sizing." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Cooling Load Calculator"
  keywords="cooling load calculator, BTU calculator, AC sizing, air conditioning load, HVAC sizing, cooling capacity, heat gain"
  breadcrumbs={[{ name: "Cooling Load Calculator", url: "/cooling-load-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Cooling Load Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate building cooling load in BTU/hr to properly size your air conditioning system.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-5">
        <!-- Room Dimensions -->
        <h3 class="text-lg font-bold text-text">Room Dimensions</h3>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Length (ft)</label>
            <input type="number" id="cll-length" class="cll-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="1" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Width (ft)</label>
            <input type="number" id="cll-width" class="cll-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="15" min="1" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Height (ft)</label>
            <input type="number" id="cll-height" class="cll-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="9" min="1" step="1">
          </div>
        </div>

        <!-- Insulation & Climate -->
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Insulation Level</label>
            <select id="cll-insulation" class="cll-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="poor">Poor (Old Building)</option>
              <option value="average" selected>Average</option>
              <option value="good">Good (Well Insulated)</option>
              <option value="excellent">Excellent (New Build)</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Climate Zone</label>
            <select id="cll-climate" class="cll-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="hot">Hot (95+째F design)</option>
              <option value="warm" selected>Warm (85-95째F design)</option>
              <option value="moderate">Moderate (75-85째F)</option>
              <option value="cool">Cool (&lt;75째F)</option>
            </select>
          </div>
        </div>

        <!-- Windows -->
        <h3 class="text-lg font-bold text-text">Windows</h3>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Window Area (sq ft)</label>
            <input type="number" id="cll-windows" class="cll-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="40" min="0" step="5">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Sun Exposure</label>
            <select id="cll-sun" class="cll-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="north">North (shaded)</option>
              <option value="east">East</option>
              <option value="south" selected>South</option>
              <option value="west">West (maximum sun)</option>
            </select>
          </div>
        </div>

        <!-- Internal Loads -->
        <h3 class="text-lg font-bold text-text">Internal Loads</h3>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Occupants</label>
            <input type="number" id="cll-occupants" class="cll-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3" min="0" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Equipment (W)</label>
            <input type="number" id="cll-equipment" class="cll-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="500" min="0" step="100">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Lighting (W)</label>
            <input type="number" id="cll-lighting" class="cll-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="300" min="0" step="50">
          </div>
        </div>

        <!-- Results -->
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Cooling Load</div>
          <div class="text-4xl font-extrabold" id="cll-total">--</div>
          <div class="text-sm text-blue-200 mt-1">BTU/hr</div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Tons of Cooling</div>
            <div class="text-xl font-bold" id="cll-tons">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">kW Equivalent</div>
            <div class="text-xl font-bold" id="cll-kw">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Envelope Load</div>
            <div class="text-xl font-bold" id="cll-envelope">--</div>
            <div class="text-xs text-text-muted">BTU/hr</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Internal Load</div>
            <div class="text-xl font-bold" id="cll-internal">--</div>
            <div class="text-xs text-text-muted">BTU/hr</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-muted uppercase mb-1">Recommended AC Unit Size</div>
          <div class="text-xl font-bold" id="cll-rec">--</div>
        </div>
      </div>

      <ShareButton calculatorId="cooling-load" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl mx-auto prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Cooling Load Is Calculated</h2>
      <p>A cooling load calculation estimates the total heat gain in a space that the air conditioning system must remove. Key components include:</p>
      <ul>
        <li><strong>Envelope load:</strong> Heat gain through walls, roof, and windows based on area, insulation, and outdoor temperature</li>
        <li><strong>Solar gain:</strong> Heat from sunlight entering through windows, varying by orientation</li>
        <li><strong>Internal gains:</strong> Heat from people (~400 BTU/hr sensible per person), equipment, and lighting</li>
        <li><strong>Infiltration:</strong> Warm outside air entering through gaps and cracks</li>
      </ul>
      <p><strong>1 Ton of cooling = 12,000 BTU/hr.</strong> Residential systems typically range from 1.5 to 5 tons.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcCLL() {
      const length = parseFloat((document.getElementById('cll-length') as HTMLInputElement).value) || 0;
      const width = parseFloat((document.getElementById('cll-width') as HTMLInputElement).value) || 0;
      const height = parseFloat((document.getElementById('cll-height') as HTMLInputElement).value) || 0;
      const insulation = (document.getElementById('cll-insulation') as HTMLSelectElement).value;
      const climate = (document.getElementById('cll-climate') as HTMLSelectElement).value;
      const windowArea = parseFloat((document.getElementById('cll-windows') as HTMLInputElement).value) || 0;
      const sun = (document.getElementById('cll-sun') as HTMLSelectElement).value;
      const occupants = parseFloat((document.getElementById('cll-occupants') as HTMLInputElement).value) || 0;
      const equipment = parseFloat((document.getElementById('cll-equipment') as HTMLInputElement).value) || 0;
      const lighting = parseFloat((document.getElementById('cll-lighting') as HTMLInputElement).value) || 0;

      const area = length * width;
      const volume = area * height;

      // Insulation factor (BTU/hr per sq ft of floor area)
      const insulFactors: Record<string, number> = { poor: 35, average: 25, good: 18, excellent: 12 };
      const insulFactor = insulFactors[insulation] || 25;

      // Climate multiplier
      const climateMulti: Record<string, number> = { hot: 1.3, warm: 1.0, moderate: 0.8, cool: 0.6 };
      const climateFactor = climateMulti[climate] || 1.0;

      // Envelope load: floor area * insulation factor * climate
      const envelopeLoad = area * insulFactor * climateFactor;

      // Solar gain through windows (BTU/hr per sq ft of glass)
      const sunFactors: Record<string, number> = { north: 20, east: 80, south: 100, west: 150 };
      const solarGain = windowArea * (sunFactors[sun] || 100) * climateFactor;

      // Infiltration (0.5 ACH typical)
      const infiltration = volume * 0.5 * 0.018 * (climateFactor * 15); // ~0.018 BTU per ft3 per degree delta

      // Internal loads
      const peopleBTU = occupants * 400; // sensible + latent per person
      const equipBTU = equipment * 3.412; // watts to BTU/hr
      const lightBTU = lighting * 3.412;
      const internalLoad = peopleBTU + equipBTU + lightBTU;

      const totalEnvelope = envelopeLoad + solarGain + infiltration;
      const totalLoad = totalEnvelope + internalLoad;

      // Safety factor 10%
      const totalWithSafety = totalLoad * 1.1;

      const tons = totalWithSafety / 12000;
      const kw = totalWithSafety * 0.000293071;

      // Recommend standard sizes
      let rec = '';
      if (tons <= 1.5) rec = '1.5 Ton (18,000 BTU/hr)';
      else if (tons <= 2) rec = '2 Ton (24,000 BTU/hr)';
      else if (tons <= 2.5) rec = '2.5 Ton (30,000 BTU/hr)';
      else if (tons <= 3) rec = '3 Ton (36,000 BTU/hr)';
      else if (tons <= 3.5) rec = '3.5 Ton (42,000 BTU/hr)';
      else if (tons <= 4) rec = '4 Ton (48,000 BTU/hr)';
      else if (tons <= 5) rec = '5 Ton (60,000 BTU/hr)';
      else rec = Math.ceil(tons) + ' Ton (' + (Math.ceil(tons) * 12000).toLocaleString() + ' BTU/hr)';

      document.getElementById('cll-total')!.textContent = Math.round(totalWithSafety).toLocaleString();
      document.getElementById('cll-tons')!.textContent = tons.toFixed(2);
      document.getElementById('cll-kw')!.textContent = kw.toFixed(2);
      document.getElementById('cll-envelope')!.textContent = Math.round(totalEnvelope).toLocaleString();
      document.getElementById('cll-internal')!.textContent = Math.round(internalLoad).toLocaleString();
      document.getElementById('cll-rec')!.textContent = rec;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.cll-in').forEach(el => {
        el.addEventListener('input', calcCLL);
        el.addEventListener('change', calcCLL);
      });
      calcCLL();
    }, 50);
  </script>
</CalculatorLayout>
