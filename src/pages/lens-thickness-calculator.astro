---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Lens Thickness Calculator";
const description = "Calculate lens thickness from prescription (SPH, CYL), index of refraction (1.50-1.74), frame size, and compare edge vs center thickness.";
const relatedCalcs = [
  { name: "Glasses Cost Calculator", url: "/glasses-cost-calculator", description: "Total eyewear cost estimate." },
  { name: "Contact Lens Calculator", url: "/contact-lens-calculator", description: "Annual contact lens costs." },
  { name: "Pupillary Distance Calculator", url: "/pupillary-distance-calculator", description: "PD measurement guide." },
  { name: "Eye Exam Calculator", url: "/eye-exam-calculator", description: "Eye exam cost by type." },
  { name: "Vision Prescription Calculator", url: "/vision-prescription-calculator", description: "Understand your prescription." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body mass index calculator." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Lens Thickness Calculator" keywords="lens thickness calculator, high index lens, 1.67 lens, edge thickness, center thickness, prescription glasses thickness" breadcrumbs={[{ name: "Lens Thickness", url: "/lens-thickness-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Lens Thickness Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate lens thickness based on your prescription and lens index. Higher index = thinner, lighter lenses.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Sphere (SPH) Diopters</label><input type="number" id="lt3-sph" class="lt3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="-3.00" min="-20" max="20" step="0.25"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Cylinder (CYL) Diopters</label><input type="number" id="lt3-cyl" class="lt3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="-1.00" min="-6" max="0" step="0.25"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Lens Index</label>
            <select id="lt3-idx" class="lt3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="1.50">1.50 (Standard CR-39)</option>
              <option value="1.53">1.53 (Trivex)</option>
              <option value="1.59">1.59 (Polycarbonate)</option>
              <option value="1.60">1.60 (Mid-Index)</option>
              <option value="1.67" selected>1.67 (High-Index)</option>
              <option value="1.74">1.74 (Ultra High-Index)</option>
            </select>
          </div>
          <div><label class="block text-xs font-medium text-text mb-1">Frame Width (mm, eye size)</label><input type="number" id="lt3-frame" class="lt3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="52" min="40" max="70" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">PD - Pupillary Distance (mm)</label><input type="number" id="lt3-pd" class="lt3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="63" min="50" max="80" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Bridge Width (mm)</label><input type="number" id="lt3-bridge" class="lt3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="18" min="12" max="24" step="1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Edge Thickness (thickest point)</div>
          <div class="text-5xl font-extrabold font-mono" id="lt3-edge">0 mm</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Center Thickness</div><div class="text-xl font-bold font-mono" id="lt3-center">0 mm</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Weight (est.)</div><div class="text-xl font-bold font-mono" id="lt3-weight">0 g</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Lens Type</div><div class="text-xl font-bold font-mono" id="lt3-type">-</div></div>
        </div>
        <div class="p-3 bg-blue-50 rounded-xl text-center text-xs font-semibold text-blue-900 uppercase tracking-wide mb-1">Comparison by Index</div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">1.50 Edge</div><div class="text-xl font-bold font-mono" id="lt3-c150">0 mm</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">1.67 Edge</div><div class="text-xl font-bold font-mono" id="lt3-c167">0 mm</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">1.74 Edge</div><div class="text-xl font-bold font-mono" id="lt3-c174">0 mm</div></div>
        </div>
      </div>
      <ShareButton calculatorId="lens-thickness" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcLT3() {
      const sph = parseFloat((document.getElementById('lt3-sph') as HTMLInputElement).value) || 0;
      const cyl = parseFloat((document.getElementById('lt3-cyl') as HTMLInputElement).value) || 0;
      const idx = parseFloat((document.getElementById('lt3-idx') as HTMLSelectElement).value) || 1.5;
      const eyeSize = parseFloat((document.getElementById('lt3-frame') as HTMLInputElement).value) || 52;
      const pd = parseFloat((document.getElementById('lt3-pd') as HTMLInputElement).value) || 63;
      const bridge = parseFloat((document.getElementById('lt3-bridge') as HTMLInputElement).value) || 18;

      // Decentration: how far the optical center is from the geometric center
      const frameCenter = (eyeSize + bridge) / 2;
      const halfPD = pd / 2;
      const decentration = Math.max(0, frameCenter - halfPD);

      // Effective diameter at thickest point
      const effectiveDiam = eyeSize + 2 * decentration;
      const radius = effectiveDiam / 2;

      // Minimum center thickness based on index/material
      const minCenter: Record<string, number> = { '1.50': 2.0, '1.53': 1.5, '1.59': 1.5, '1.60': 1.3, '1.67': 1.2, '1.74': 1.0 };
      const ct = minCenter[idx.toFixed(2)] || 1.5;

      // For minus lenses: edge = center + (power * radius^2) / (2000 * (n-1))
      // For plus lenses: center = edge + (power * radius^2) / (2000 * (n-1))
      // Using sag formula: sag = r^2 * |D| / (2000 * (n-1))
      const power = Math.abs(sph);
      const maxPower = Math.abs(sph + cyl);

      function edgeThickness(n: number, minCT: number): number {
        if (sph < 0) {
          // Minus lens: thicker at edge
          const sag = (radius * radius * maxPower) / (2000 * (n - 1));
          return minCT + sag;
        } else {
          // Plus lens: thicker at center
          return minCT;
        }
      }

      function centerThickness(n: number, minCT: number): number {
        if (sph >= 0) {
          const sag = (radius * radius * power) / (2000 * (n - 1));
          return minCT + sag;
        } else {
          return minCT;
        }
      }

      const edge = edgeThickness(idx, ct);
      const center = centerThickness(idx, ct);

      // Weight estimation (density varies by index)
      const densities: Record<string, number> = { '1.50': 1.32, '1.53': 1.11, '1.59': 1.20, '1.60': 1.30, '1.67': 1.35, '1.74': 1.47 };
      const density = densities[idx.toFixed(2)] || 1.3;
      const avgThickness = (edge + center) / 2;
      const volume = Math.PI * (eyeSize / 2) * (eyeSize / 2) * avgThickness / 1000; // cm^3
      const weight = volume * density;

      // Lens type label
      const isMinus = sph < 0;
      const typeLabel = isMinus ? 'Minus (concave)' : sph > 0 ? 'Plus (convex)' : 'Plano';

      // Comparisons
      const edge150 = edgeThickness(1.50, 2.0);
      const edge167 = edgeThickness(1.67, 1.2);
      const edge174 = edgeThickness(1.74, 1.0);

      document.getElementById('lt3-edge')!.textContent = edge.toFixed(1) + ' mm';
      document.getElementById('lt3-center')!.textContent = center.toFixed(1) + ' mm';
      document.getElementById('lt3-weight')!.textContent = weight.toFixed(1) + ' g';
      document.getElementById('lt3-type')!.textContent = typeLabel;
      document.getElementById('lt3-c150')!.textContent = edge150.toFixed(1) + ' mm';
      document.getElementById('lt3-c167')!.textContent = edge167.toFixed(1) + ' mm';
      document.getElementById('lt3-c174')!.textContent = edge174.toFixed(1) + ' mm';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.lt3-in').forEach(el => { el.addEventListener('input', calcLT3); el.addEventListener('change', calcLT3); });
      calcLT3();
    }, 50);
  </script>
</CalculatorLayout>
