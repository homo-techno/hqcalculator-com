---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Depression Screening Calculator - PHQ-9 Score";
const description = "Screen for depression using the PHQ-9 (Patient Health Questionnaire-9). Get severity level, functional impact assessment, and monitoring guidance.";
const relatedCalcs = [
  { name: "Sleep Calculator", url: "/sleep-calculator", description: "Optimize sleep cycles." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calorie needs." },
  { name: "Heart Rate Calculator", url: "/heart-rate-calculator", description: "Heart rate zones." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body mass index." },
  { name: "Caffeine Calculator", url: "/caffeine-calculator", description: "Caffeine intake." },
  { name: "Water Intake", url: "/water-intake-calculator", description: "Daily hydration." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Depression Screening Calculator" keywords="depression screening, PHQ-9, patient health questionnaire, depression score, depression severity, mental health screening" breadcrumbs={[{ name: "Depression Screening", url: "/depression-screening-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Depression Screening Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Over the last 2 weeks, how often have you been bothered by the following problems? (PHQ-9)</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <p class="text-xs text-text-secondary mb-1 italic">This is a screening tool, not a diagnosis. Always consult a healthcare professional.</p>
      <p class="text-sm text-text-secondary mb-4">0 = Not at all, 1 = Several days, 2 = More than half the days, 3 = Nearly every day</p>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">1. Little interest or pleasure in doing things</label>
          <input type="range" id="dp2-q1" class="dp2-in w-full" min="0" max="3" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Not at all (0)</span><span>Nearly every day (3)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">2. Feeling down, depressed, or hopeless</label>
          <input type="range" id="dp2-q2" class="dp2-in w-full" min="0" max="3" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Not at all (0)</span><span>Nearly every day (3)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">3. Trouble falling/staying asleep, or sleeping too much</label>
          <input type="range" id="dp2-q3" class="dp2-in w-full" min="0" max="3" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Not at all (0)</span><span>Nearly every day (3)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">4. Feeling tired or having little energy</label>
          <input type="range" id="dp2-q4" class="dp2-in w-full" min="0" max="3" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Not at all (0)</span><span>Nearly every day (3)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">5. Poor appetite or overeating</label>
          <input type="range" id="dp2-q5" class="dp2-in w-full" min="0" max="3" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Not at all (0)</span><span>Nearly every day (3)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">6. Feeling bad about yourself or that you are a failure</label>
          <input type="range" id="dp2-q6" class="dp2-in w-full" min="0" max="3" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Not at all (0)</span><span>Nearly every day (3)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">7. Trouble concentrating on things like reading or TV</label>
          <input type="range" id="dp2-q7" class="dp2-in w-full" min="0" max="3" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Not at all (0)</span><span>Nearly every day (3)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">8. Moving or speaking slowly, or being fidgety/restless</label>
          <input type="range" id="dp2-q8" class="dp2-in w-full" min="0" max="3" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Not at all (0)</span><span>Nearly every day (3)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">9. Thoughts of self-harm or that you would be better off dead</label>
          <input type="range" id="dp2-q9" class="dp2-in w-full" min="0" max="3" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Not at all (0)</span><span>Nearly every day (3)</span></div>
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm opacity-80">Depression Severity</div>
          <div class="text-2xl font-extrabold mt-1" id="dp2-sev">--</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">PHQ-9 Score</div>
            <div class="text-xl font-bold text-text mt-1" id="dp2-score">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Functional Impact</div>
            <div class="text-xl font-bold text-text mt-1" id="dp2-impact">--</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-secondary mb-2">Recommended Action</div>
          <div class="text-sm text-text" id="dp2-action">--</div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-secondary mb-2">Monitoring</div>
          <div class="text-sm text-text" id="dp2-monitor">--</div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-secondary mb-2">PHQ-9 Severity Scale</div>
          <div class="space-y-1 text-sm">
            <div class="flex justify-between"><span>0 - 4</span><span>Minimal / None</span></div>
            <div class="flex justify-between"><span>5 - 9</span><span>Mild Depression</span></div>
            <div class="flex justify-between"><span>10 - 14</span><span>Moderate Depression</span></div>
            <div class="flex justify-between"><span>15 - 19</span><span>Moderately Severe</span></div>
            <div class="flex justify-between"><span>20 - 27</span><span>Severe Depression</span></div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="depression-screening" />
      <FeedbackWidget />
    </div>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcDP2() {
      let total = 0;
      for (let i = 1; i <= 9; i++) {
        total += parseInt((document.getElementById('dp2-q' + i) as HTMLInputElement).value) || 0;
      }
      const q9 = parseInt((document.getElementById('dp2-q9') as HTMLInputElement).value) || 0;

      let severity = 'Minimal';
      let impact = 'None to minimal';
      let action = '';
      let monitor = '';

      if (total <= 4) {
        severity = 'Minimal / None';
        impact = 'None to minimal';
        action = 'No treatment action needed. Continue healthy lifestyle habits including regular exercise, social engagement, and quality sleep.';
        monitor = 'Re-screen if symptoms emerge or during routine health visits.';
      } else if (total <= 9) {
        severity = 'Mild Depression';
        impact = 'Slight difficulty in daily functioning';
        action = 'Watchful waiting recommended. Consider lifestyle interventions: exercise (30 min/day), social activities, sleep hygiene. Repeat PHQ-9 in 2-4 weeks.';
        monitor = 'Track weekly. If score persists above 5 for 4+ weeks, consult a healthcare provider.';
      } else if (total <= 14) {
        severity = 'Moderate Depression';
        impact = 'Moderate difficulty in work, home, and social activities';
        action = 'Professional consultation recommended. Treatment options include psychotherapy (CBT, interpersonal therapy) and possibly antidepressant medication.';
        monitor = 'Track weekly during treatment. A 5-point drop indicates meaningful improvement. Target score below 5.';
      } else if (total <= 19) {
        severity = 'Moderately Severe';
        impact = 'Significant impairment in daily functioning';
        action = 'Active treatment strongly recommended. Combination of antidepressant medication plus psychotherapy is most effective at this severity level.';
        monitor = 'Track weekly. If no improvement after 4-6 weeks of treatment, discuss adjustment with provider.';
      } else {
        severity = 'Severe Depression';
        impact = 'Severe functional impairment';
        action = 'Urgent professional intervention recommended. Immediate combination treatment with medication and psychotherapy. If in crisis, contact 988 Suicide and Crisis Lifeline (call/text 988).';
        monitor = 'Frequent monitoring essential. Close follow-up with mental health professional.';
      }

      if (q9 > 0) {
        action += ' IMPORTANT: You indicated thoughts of self-harm. Please reach out to a crisis service: 988 Suicide and Crisis Lifeline (call/text 988) or go to your nearest emergency room.';
      }

      document.getElementById('dp2-score')!.textContent = total + ' / 27';
      document.getElementById('dp2-sev')!.textContent = severity;
      document.getElementById('dp2-impact')!.textContent = impact;
      document.getElementById('dp2-action')!.textContent = action;
      document.getElementById('dp2-monitor')!.textContent = monitor;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      for (let i = 1; i <= 9; i++) {
        (document.getElementById('dp2-q' + i) as HTMLInputElement).value = '0';
      }
      document.querySelectorAll('.dp2-in').forEach(el => {
        el.addEventListener('input', calcDP2);
        el.addEventListener('change', calcDP2);
      });
      calcDP2();
    }, 50);
  </script>
</CalculatorLayout>
