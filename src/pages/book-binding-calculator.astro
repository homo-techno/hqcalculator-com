---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Book Binding Calculator - Binding Method Cost Estimator";
const description = "Calculate book binding costs for perfect binding, saddle-stitch, spiral, and hardcover based on page count, quantity, and paper stock.";
const relatedCalcs = [
  { name: "Spine Width Calculator", url: "/spine-width-calculator", description: "Calculate book spine width." },
  { name: "Print Cost Calculator", url: "/print-cost-calculator", description: "Cost per page printing." },
  { name: "Booklet Imposition Calculator", url: "/booklet-imposition-calculator", description: "Page imposition layout." },
  { name: "Paper Weight Calculator", url: "/paper-weight-calculator", description: "Convert paper weights." },
  { name: "ISBN Calculator", url: "/isbn-calculator", description: "ISBN check digit validator." },
  { name: "Print Run Calculator", url: "/print-run-calculator", description: "Optimal print run size." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Book Binding Calculator" keywords="book binding cost, perfect binding, saddle stitch, spiral binding, hardcover cost, binding calculator, page count" breadcrumbs={[{ name: "Book Binding Calculator", url: "/book-binding-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Book Binding Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate binding costs by method, page count, and quantity. Compare perfect binding, saddle-stitch, spiral, and hardcover options.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Total Pages</label><input type="number" id="bb-pages" class="bb-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="4" step="2"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Quantity (copies)</label><input type="number" id="bb-qty" class="bb-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Binding Method</label>
            <select id="bb-method" class="bb-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="saddle">Saddle-Stitch</option>
              <option value="perfect">Perfect Binding</option>
              <option value="spiral">Spiral / Coil</option>
              <option value="hardcover">Hardcover (Case)</option>
            </select>
          </div>
          <div><label class="block text-xs font-medium text-text mb-1">Book Size</label>
            <select id="bb-size" class="bb-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="5.5x8.5">5.5 x 8.5 in (Digest)</option>
              <option value="6x9">6 x 9 in (Trade)</option>
              <option value="8.5x11">8.5 x 11 in (Letter)</option>
              <option value="a5">A5 (148 x 210 mm)</option>
              <option value="a4">A4 (210 x 297 mm)</option>
            </select>
          </div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Paper Stock</label>
          <select id="bb-stock" class="bb-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="standard">Standard 60lb Text</option>
            <option value="premium">Premium 80lb Text</option>
            <option value="heavy">Heavy 100lb Text</option>
          </select>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Binding Cost</div>
          <div class="text-5xl font-extrabold font-mono" id="bb-result">$0.00</div>
          <div class="text-sm text-blue-200 mt-1" id="bb-perunit"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Setup Cost</div><div class="text-xl font-bold" id="bb-setup">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Per-Unit Binding</div><div class="text-xl font-bold" id="bb-unitcost">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Max Pages for Method</div><div class="text-xl font-bold" id="bb-maxpages">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Recommendation</div><div class="text-xl font-bold text-sm" id="bb-rec">--</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Method Comparison</h3>
          <div class="font-mono text-sm space-y-1" id="bb-compare"></div>
        </div>
      </div>
      <ShareButton calculatorId="book-binding" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Book Binding Methods</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p>Saddle-Stitch: Best for 8-64 pages. Stapled through spine fold.</p>
        <p>Perfect Binding: Best for 48-800+ pages. Glued spine (paperback).</p>
        <p>Spiral/Coil: Best for 20-500 pages. Plastic or wire coil.</p>
        <p>Hardcover: Best for 48-1000+ pages. Case-bound, premium finish.</p>
      </div>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcBb() {
      const pages = parseFloat((document.getElementById('bb-pages') as HTMLInputElement).value) || 0;
      const qty = parseFloat((document.getElementById('bb-qty') as HTMLInputElement).value) || 0;
      const method = (document.getElementById('bb-method') as HTMLSelectElement).value;
      const stock = (document.getElementById('bb-stock') as HTMLSelectElement).value;
      const stockMult: Record<string, number> = { standard: 1, premium: 1.25, heavy: 1.5 };
      const sm = stockMult[stock] || 1;
      const methods: Record<string, { setup: number; perUnit: number; perPage: number; maxPages: number; name: string }> = {
        saddle: { setup: 25, perUnit: 0.50, perPage: 0.02, maxPages: 64, name: 'Saddle-Stitch' },
        perfect: { setup: 75, perUnit: 1.50, perPage: 0.015, maxPages: 800, name: 'Perfect Binding' },
        spiral: { setup: 15, perUnit: 2.00, perPage: 0.018, maxPages: 500, name: 'Spiral/Coil' },
        hardcover: { setup: 150, perUnit: 5.00, perPage: 0.02, maxPages: 1000, name: 'Hardcover' }
      };
      function calcMethod(m: string) {
        const cfg = methods[m];
        const unitCost = (cfg.perUnit + pages * cfg.perPage * sm);
        const total = cfg.setup + unitCost * qty;
        return { setup: cfg.setup, unitCost, total, name: cfg.name, maxPages: cfg.maxPages };
      }
      const selected = calcMethod(method);
      const warning = pages > methods[method].maxPages ? 'Warning: Exceeds recommended max pages!' : '';
      let bestMethod = '';
      let bestTotal = Infinity;
      const compareLines: string[] = [];
      for (const [key, cfg] of Object.entries(methods)) {
        const r = calcMethod(key);
        const flag = key === method ? ' <-- selected' : '';
        const pageOk = pages <= cfg.maxPages ? '' : ' (exceeds max)';
        compareLines.push(cfg.name + ': $' + r.total.toFixed(2) + ' ($' + r.unitCost.toFixed(2) + '/unit)' + pageOk + flag);
        if (pages <= cfg.maxPages && r.total < bestTotal) { bestTotal = r.total; bestMethod = cfg.name; }
      }
      const rec = warning ? warning : (bestMethod === methods[method].name ? 'Good choice!' : 'Consider: ' + bestMethod);
      document.getElementById('bb-result')!.textContent = '$' + selected.total.toFixed(2);
      document.getElementById('bb-perunit')!.textContent = '$' + selected.unitCost.toFixed(2) + ' per copy';
      document.getElementById('bb-setup')!.textContent = '$' + selected.setup.toFixed(2);
      document.getElementById('bb-unitcost')!.textContent = '$' + selected.unitCost.toFixed(2);
      document.getElementById('bb-maxpages')!.textContent = methods[method].maxPages.toString();
      document.getElementById('bb-rec')!.textContent = rec;
      document.getElementById('bb-compare')!.innerHTML = compareLines.map(s => '<div>' + s + '</div>').join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      (document.getElementById('bb-pages') as HTMLInputElement).value = '200';
      (document.getElementById('bb-qty') as HTMLInputElement).value = '100';
      document.querySelectorAll('.bb-in').forEach(el => { el.addEventListener('input', calcBb); el.addEventListener('change', calcBb); });
      calcBb();
    }, 50);
  </script>
</CalculatorLayout>
