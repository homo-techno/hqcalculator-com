---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Garage Door Calculator - Cost, R-Value & Spring Type";
const description = "Estimate garage door costs by size, material, and insulation. Get R-value, spring type recommendations, and opener sizing.";

const relatedCalcs = [
  { name: "Siding Calculator", url: "/siding-calculator", description: "Siding material." },
  { name: "Soffit Calculator", url: "/soffit-calculator", description: "Soffit and fascia." },
  { name: "Foundation Calculator", url: "/foundation-calculator", description: "Foundation concrete." },
  { name: "Structural Load Calculator", url: "/structural-load-calculator", description: "Load analysis." },
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume." },
  { name: "Pergola Calculator", url: "/pergola-calculator", description: "Pergola lumber." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Garage Door Calculator"
  keywords="garage door calculator, garage door cost, garage door R-value, torsion spring, garage door opener, insulated garage door"
  breadcrumbs={[{ name: "Garage Door Calculator", url: "/garage-door-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Garage Door Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate garage door costs, insulation value, spring type, and opener requirements.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="grid grid-cols-2 gap-3 mb-5">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Door Width (ft)</label>
              <select id="gd-width" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
                <option value="8">8 ft (single)</option>
                <option value="9" selected>9 ft (single wide)</option>
                <option value="10">10 ft (wide single)</option>
                <option value="16">16 ft (double)</option>
                <option value="18">18 ft (wide double)</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Door Height (ft)</label>
              <select id="gd-height" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
                <option value="7" selected>7 ft (standard)</option>
                <option value="8">8 ft (tall)</option>
                <option value="9">9 ft</option>
                <option value="10">10 ft (commercial)</option>
              </select>
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Door Material</label>
            <select id="gd-material" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
              <option value="steel" selected>Steel (most common)</option>
              <option value="wood">Real Wood (carriage style)</option>
              <option value="aluminum">Aluminum (modern/glass)</option>
              <option value="fiberglass">Fiberglass</option>
              <option value="vinyl">Vinyl</option>
            </select>
          </div>

          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Insulation</label>
            <select id="gd-insulation" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
              <option value="none">None (single layer)</option>
              <option value="polystyrene" selected>Polystyrene (R-6 to R-9)</option>
              <option value="polyurethane">Polyurethane Foam (R-12 to R-18)</option>
            </select>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Number of Doors</label>
              <input type="number" id="gd-qty" class="w-full px-3 py-2 border border-border rounded-lg" value="1" min="1" max="6" step="1">
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Cost Per Door</div>
            <div class="text-5xl font-extrabold font-mono" id="gd-cost">$0</div>
            <div class="text-sm text-blue-200 mt-1">installed with opener</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">R-Value</div>
              <div class="text-xl font-bold" id="gd-rvalue">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Door Area</div>
              <div class="text-xl font-bold" id="gd-area">0 sq ft</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Spring Type</div>
              <div class="text-xl font-bold" id="gd-spring">--</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Opener HP</div>
              <div class="text-xl font-bold" id="gd-opener">--</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Est. Weight</div>
              <div class="text-xl font-bold" id="gd-weight">0 lbs</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total (all doors)</div>
              <div class="text-2xl font-bold text-secondary" id="gd-totalcost">$0</div>
            </div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="garage-door" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Garage Door Cost Factors</h2>
      <ul>
        <li><strong>Material:</strong> Steel is most affordable; wood is premium</li>
        <li><strong>Size:</strong> Double doors cost 50-80% more than single</li>
        <li><strong>Insulation:</strong> Adds $200-$800 to door cost</li>
        <li><strong>Installation:</strong> Typically $200-$500 per door</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Spring Types</h3>
      <ul>
        <li><strong>Extension springs:</strong> Lighter doors, one spring per side</li>
        <li><strong>Torsion springs:</strong> Heavier doors, mounted above door, safer</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const gdBaseCost: Record<string, number> = {
      steel: 25,       // per sq ft
      wood: 55,
      aluminum: 45,
      fiberglass: 35,
      vinyl: 30,
    };

    const gdWeightPerSqFt: Record<string, number> = {
      steel: 4.5,
      wood: 7,
      aluminum: 3,
      fiberglass: 3.5,
      vinyl: 3.5,
    };

    function calcGarageDoor() {
      const width = parseFloat((document.getElementById('gd-width') as HTMLSelectElement).value) || 9;
      const height = parseFloat((document.getElementById('gd-height') as HTMLSelectElement).value) || 7;
      const material = (document.getElementById('gd-material') as HTMLSelectElement).value;
      const insulation = (document.getElementById('gd-insulation') as HTMLSelectElement).value;
      const qty = parseInt((document.getElementById('gd-qty') as HTMLInputElement).value) || 1;

      const area = width * height;

      // Base cost
      const baseCostSf = gdBaseCost[material] || 25;
      let doorCost = area * baseCostSf;

      // Insulation cost and R-value
      let rValue = 0;
      if (insulation === 'none') {
        rValue = 0;
      } else if (insulation === 'polystyrene') {
        rValue = 7.5;
        doorCost += area * 3;
      } else {
        rValue = 15;
        doorCost += area * 8;
      }

      // Opener cost ($250-$400)
      const openerCost = area > 100 ? 400 : 300;
      // Installation cost
      const installCost = area > 100 ? 450 : 300;

      const totalPerDoor = doorCost + openerCost + installCost;
      const totalAll = totalPerDoor * qty;

      // Weight
      const weightPerSf = gdWeightPerSqFt[material] || 4.5;
      let doorWeight = area * weightPerSf;
      if (insulation !== 'none') doorWeight += area * 0.5;

      // Spring type
      const springType = doorWeight > 150 ? 'Torsion' : 'Extension';

      // Opener HP
      let openerHP = '1/3 HP';
      if (doorWeight > 200) openerHP = '1/2 HP';
      if (doorWeight > 350) openerHP = '3/4 HP';
      if (doorWeight > 500) openerHP = '1 HP';

      document.getElementById('gd-cost')!.textContent = '$' + Math.round(totalPerDoor).toLocaleString();
      document.getElementById('gd-rvalue')!.textContent = rValue > 0 ? 'R-' + rValue : 'None';
      document.getElementById('gd-area')!.textContent = area + ' sq ft';
      document.getElementById('gd-spring')!.textContent = springType;
      document.getElementById('gd-opener')!.textContent = openerHP;
      document.getElementById('gd-weight')!.textContent = Math.round(doorWeight) + ' lbs';
      document.getElementById('gd-totalcost')!.textContent = '$' + Math.round(totalAll).toLocaleString();

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('#gd-qty').forEach(el => {
        el.addEventListener('input', calcGarageDoor);
        el.addEventListener('change', calcGarageDoor);
      });
      document.querySelectorAll('#gd-width, #gd-height, #gd-material, #gd-insulation').forEach(el => {
        el.addEventListener('input', calcGarageDoor);
        el.addEventListener('change', calcGarageDoor);
      });
      calcGarageDoor();
    }, 50);
  </script>
</CalculatorLayout>
