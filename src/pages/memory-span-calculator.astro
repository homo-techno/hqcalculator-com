---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Memory Span Calculator - Working Memory & Digit Span";
const description = "Estimate your working memory capacity based on digit span, Miller's 7 plus or minus 2 law, and chunking benefits for improved recall.";
const relatedCalcs = [
  { name: "IQ Score Calculator", url: "/iq-score-calculator", description: "IQ interpretation." },
  { name: "Reading Time", url: "/reading-time-calculator", description: "Reading duration." },
  { name: "Study Time", url: "/study-time-calculator", description: "Study planning." },
  { name: "Spaced Repetition", url: "/spaced-repetition-calculator", description: "Review scheduling." },
  { name: "Age Calculator", url: "/age-calculator", description: "Calculate exact age." },
  { name: "Average Calculator", url: "/average-calculator", description: "Compute averages." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Memory Span Calculator" keywords="memory span, digit span, working memory, Miller's law, chunking, short-term memory, cognitive capacity" breadcrumbs={[{ name: "Memory Span", url: "/memory-span-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Memory Span Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your working memory capacity using digit span, chunk size, and age-based norms.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Forward Digit Span (longest sequence recalled correctly)</label>
          <input type="number" id="ms5-fwd" class="ms5-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="1" max="15" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Backward Digit Span (longest reversed sequence)</label>
          <input type="number" id="ms5-bwd" class="ms5-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="1" max="12" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Your Age</label>
          <input type="number" id="ms5-age" class="ms5-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="5" max="100" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Chunk Size Used (items per group)</label>
          <input type="number" id="ms5-chunk" class="ms5-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="1" max="10" step="1">
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm opacity-80">Working Memory Estimate</div>
          <div class="text-2xl font-extrabold mt-1" id="ms5-wm">--</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Total Digit Span Score</div>
            <div class="text-xl font-bold text-text mt-1" id="ms5-total">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Effective Capacity (with chunking)</div>
            <div class="text-xl font-bold text-text mt-1" id="ms5-eff">--</div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Age-Based Percentile</div>
            <div class="text-xl font-bold text-text mt-1" id="ms5-pct">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Miller's Law Range</div>
            <div class="text-xl font-bold text-text mt-1" id="ms5-miller">5 - 9 items</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-secondary mb-2">Chunking Benefit</div>
          <div class="text-sm text-text" id="ms5-advice">--</div>
        </div>
      </div>

      <ShareButton calculatorId="memory-span" />
      <FeedbackWidget />
    </div>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcMS5() {
      const fwd = parseInt((document.getElementById('ms5-fwd') as HTMLInputElement).value) || 7;
      const bwd = parseInt((document.getElementById('ms5-bwd') as HTMLInputElement).value) || 5;
      const age = parseInt((document.getElementById('ms5-age') as HTMLInputElement).value) || 30;
      const chunk = parseInt((document.getElementById('ms5-chunk') as HTMLInputElement).value) || 1;

      const totalSpan = fwd + bwd;
      const effectiveCapacity = fwd * chunk;

      // Age-based norms for forward digit span (approximate means)
      let ageMean = 7;
      if (age < 10) ageMean = 5;
      else if (age < 16) ageMean = 6;
      else if (age < 30) ageMean = 7;
      else if (age < 50) ageMean = 6.8;
      else if (age < 65) ageMean = 6.5;
      else ageMean = 6;

      const zScore = (fwd - ageMean) / 1.2;
      const pct = Math.min(99.9, Math.max(0.1, 50 + zScore * 34));

      let wmLabel = 'Average';
      if (fwd >= 9) wmLabel = 'Excellent';
      else if (fwd >= 8) wmLabel = 'Above Average';
      else if (fwd >= 6) wmLabel = 'Average';
      else if (fwd >= 5) wmLabel = 'Below Average';
      else wmLabel = 'Low';

      document.getElementById('ms5-wm')!.textContent = wmLabel + ' (' + fwd + ' items)';
      document.getElementById('ms5-total')!.textContent = totalSpan + ' (fwd ' + fwd + ' + bwd ' + bwd + ')';
      document.getElementById('ms5-eff')!.textContent = effectiveCapacity + ' items';
      document.getElementById('ms5-pct')!.textContent = pct.toFixed(1) + 'th percentile';

      let advice = '';
      if (chunk <= 1) {
        advice = 'You are not using chunking. Grouping items into chunks of 3-4 could increase your effective capacity from ' + fwd + ' to ' + (fwd * 3) + '-' + (fwd * 4) + ' items.';
      } else {
        const benefit = ((effectiveCapacity / fwd - 1) * 100).toFixed(0);
        advice = 'Chunking by ' + chunk + ' gives you a ' + benefit + '% capacity boost (' + fwd + ' chunks x ' + chunk + ' = ' + effectiveCapacity + ' items stored).';
      }
      document.getElementById('ms5-advice')!.textContent = advice;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      (document.getElementById('ms5-fwd') as HTMLInputElement).value = '7';
      (document.getElementById('ms5-bwd') as HTMLInputElement).value = '5';
      (document.getElementById('ms5-age') as HTMLInputElement).value = '30';
      (document.getElementById('ms5-chunk') as HTMLInputElement).value = '1';
      document.querySelectorAll('.ms5-in').forEach(el => {
        el.addEventListener('input', calcMS5);
        el.addEventListener('change', calcMS5);
      });
      calcMS5();
    }, 50);
  </script>
</CalculatorLayout>
