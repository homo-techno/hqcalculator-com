---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "BTU Calculator - Heating & Cooling Size Estimator";
const description = "Calculate the BTU capacity needed for heating or cooling your room or home based on dimensions and conditions.";
const relatedCalcs = [
  { name: "Square Footage", url: "/square-footage-calculator", description: "Square footage." },
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Electricity." },
  { name: "Solar Panel", url: "/solar-panel-calculator", description: "Solar panels." },
  { name: "Area Calculator", url: "/area-calculator", description: "2D areas." },
  { name: "Volume Calculator", url: "/volume-calculator", description: "3D volumes." },
  { name: "Temperature Converter", url: "/temperature-converter", description: "Temperature." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="BTU Calculator" keywords="btu calculator, heating btu, cooling btu, air conditioner size, furnace size, hvac calculator" breadcrumbs={[{ name: "BTU Calculator", url: "/btu-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">BTU Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Determine the right heating/cooling capacity for your space.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="flex gap-2 mb-2">
          <button id="bt-cool" class="px-4 py-2 rounded-lg text-sm font-semibold border-2 border-primary bg-blue-50 text-primary">Cooling (AC)</button>
          <button id="bt-heat" class="px-4 py-2 rounded-lg text-sm font-semibold border-2 border-border text-text-muted">Heating</button>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Room Length (ft)</label><input type="number" id="bt-l" class="bt-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="1" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Room Width (ft)</label><input type="number" id="bt-w" class="bt-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="15" min="1" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Ceiling (ft)</label><input type="number" id="bt-h" class="bt-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="7" max="20" step="0.5"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Insulation</label>
            <select id="bt-insul" class="bt-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="poor">Poor</option><option value="average" selected>Average</option><option value="good">Good</option><option value="excellent">Excellent</option>
            </select>
          </div>
          <div><label class="block text-xs font-medium text-text mb-1">Sun Exposure</label>
            <select id="bt-sun" class="bt-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="shaded">Mostly Shaded</option><option value="average" selected>Average</option><option value="sunny">Very Sunny</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Occupants</label><input type="number" id="bt-occ" class="bt-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="1" max="20" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Climate Zone</label>
            <select id="bt-climate" class="bt-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="mild">Mild</option><option value="moderate" selected>Moderate</option><option value="hot">Hot / Very Cold</option><option value="extreme">Extreme</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended BTU</div>
          <div class="text-5xl font-extrabold" id="bt-btu">0</div>
          <div class="text-sm text-blue-200 mt-1" id="bt-tons">0 tons</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Room Area</div><div class="text-xl font-bold" id="bt-area">0 sq ft</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Watts Equivalent</div><div class="text-xl font-bold" id="bt-watts">0 W</div></div>
        </div>
      </div>
      <ShareButton calculatorId="btu" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">BTU Sizing Guide</h2>
      <p>General rule: 20 BTU per sq ft for cooling. Factors like insulation, sun exposure, climate, and occupancy affect the final number.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    let isCooling = true;
    function setMode(cool: boolean) {
      isCooling = cool;
      document.getElementById('bt-cool')!.className = `px-4 py-2 rounded-lg text-sm font-semibold border-2 ${cool ? 'border-primary bg-blue-50 text-primary' : 'border-border text-text-muted'}`;
      document.getElementById('bt-heat')!.className = `px-4 py-2 rounded-lg text-sm font-semibold border-2 ${!cool ? 'border-primary bg-blue-50 text-primary' : 'border-border text-text-muted'}`;
      calcBTU();
    }
    function calcBTU() {
      const l = parseFloat((document.getElementById('bt-l') as HTMLInputElement).value) || 0;
      const w = parseFloat((document.getElementById('bt-w') as HTMLInputElement).value) || 0;
      const h = parseFloat((document.getElementById('bt-h') as HTMLInputElement).value) || 8;
      const insul = (document.getElementById('bt-insul') as HTMLSelectElement).value;
      const sun = (document.getElementById('bt-sun') as HTMLSelectElement).value;
      const occ = parseInt((document.getElementById('bt-occ') as HTMLInputElement).value) || 2;
      const climate = (document.getElementById('bt-climate') as HTMLSelectElement).value;
      const area = l * w;
      let baseBTU = area * (isCooling ? 20 : 30);
      const heightFactor = h > 8 ? 1 + (h - 8) * 0.05 : 1;
      baseBTU *= heightFactor;
      const insulMul: Record<string, number> = { poor: 1.3, average: 1.0, good: 0.85, excellent: 0.7 };
      baseBTU *= insulMul[insul];
      const sunMul: Record<string, number> = { shaded: 0.9, average: 1.0, sunny: 1.15 };
      baseBTU *= sunMul[sun];
      if (occ > 2) baseBTU += (occ - 2) * 600;
      const climateMul: Record<string, number> = { mild: 0.85, moderate: 1.0, hot: 1.15, extreme: 1.3 };
      baseBTU *= climateMul[climate];
      const btu = Math.ceil(baseBTU / 1000) * 1000;
      document.getElementById('bt-btu')!.textContent = btu.toLocaleString();
      document.getElementById('bt-tons')!.textContent = (btu / 12000).toFixed(1) + ' tons';
      document.getElementById('bt-area')!.textContent = area.toFixed(0) + ' sq ft';
      document.getElementById('bt-watts')!.textContent = Math.round(btu * 0.293071).toLocaleString() + ' W';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.getElementById('bt-cool')!.addEventListener('click', () => setMode(true));
      document.getElementById('bt-heat')!.addEventListener('click', () => setMode(false));
      document.querySelectorAll('.bt-in').forEach(el => { el.addEventListener('input', calcBTU); el.addEventListener('change', calcBTU); });
      calcBTU();
    }, 50);
  </script>
</CalculatorLayout>
