---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Tenant Screening Calculator";
const description = "Evaluate tenant applications with income-to-rent ratio, credit score assessment, screening cost analysis, and risk scoring.";
const relatedCalcs = [
  { name: "Rental Property", url: "/rental-property-calculator", description: "Rental property ROI." },
  { name: "Rental Yield", url: "/rental-yield-calculator", description: "Rental yield analysis." },
  { name: "Rent vs Buy", url: "/rent-vs-buy-calculator", description: "Rent vs buy comparison." },
  { name: "Debt Service Coverage", url: "/debt-service-coverage-calculator", description: "DSCR ratio." },
  { name: "Income Tax", url: "/income-tax-calculator", description: "Income tax estimate." },
  { name: "Cap Rate", url: "/cap-rate-calculator", description: "Capitalization rate." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Tenant Screening Calculator" keywords="tenant screening, income to rent ratio, credit score, tenant risk, rental application, landlord screening" breadcrumbs={[{ name: "Tenant Screening", url: "/tenant-screening-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Tenant Screening Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Score tenant applications based on income ratio, credit, employment, and rental history.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Monthly Rent ($)</label><input type="number" id="ts4-rent" class="ts4-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="1800" min="0" step="50"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Gross Monthly Income ($)</label><input type="number" id="ts4-income" class="ts4-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="5400" min="0" step="100"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Credit Score</label><input type="number" id="ts4-credit" class="ts4-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="680" min="300" max="850" step="5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Employment Length (years)</label><input type="number" id="ts4-employ" class="ts4-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3" min="0" max="50" step="0.5"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Prior Evictions</label><input type="number" id="ts4-evictions" class="ts4-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0" min="0" max="10" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Rental History (years)</label><input type="number" id="ts4-history" class="ts4-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="0" max="40" step="1"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Screening Cost ($)</label><input type="number" id="ts4-cost" class="ts4-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="35" min="0" max="200" step="5"></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Tenant Risk Score</div>
          <div class="text-5xl font-extrabold font-mono" id="ts4-score">0/100</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Income-to-Rent</div><div class="text-xl font-bold font-mono" id="ts4-ratio">0x</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Credit Rating</div><div class="text-xl font-bold font-mono" id="ts4-creditrating">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Rent % of Income</div><div class="text-xl font-bold font-mono" id="ts4-rentpct">0%</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Cost Per Application</div><div class="text-xl font-bold font-mono" id="ts4-appcost">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Max Recommended Rent</div><div class="text-xl font-bold font-mono" id="ts4-maxrent">$0</div></div>
        </div>
        <div class="p-4 rounded-xl text-center" id="ts4-status-box"><div class="font-bold text-sm" id="ts4-status">-</div></div>
      </div>
      <ShareButton calculatorId="tenant-screening" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcTS4() {
      const rent = parseFloat((document.getElementById('ts4-rent') as HTMLInputElement).value) || 0;
      const income = parseFloat((document.getElementById('ts4-income') as HTMLInputElement).value) || 0;
      const credit = parseFloat((document.getElementById('ts4-credit') as HTMLInputElement).value) || 300;
      const employ = parseFloat((document.getElementById('ts4-employ') as HTMLInputElement).value) || 0;
      const evictions = parseFloat((document.getElementById('ts4-evictions') as HTMLInputElement).value) || 0;
      const history = parseFloat((document.getElementById('ts4-history') as HTMLInputElement).value) || 0;
      const cost = parseFloat((document.getElementById('ts4-cost') as HTMLInputElement).value) || 0;

      const incomeRatio = rent > 0 ? income / rent : 0;
      const rentPct = income > 0 ? (rent / income) * 100 : 0;
      const maxRent = income / 3;

      let score = 0;
      if (incomeRatio >= 3) score += 30;
      else if (incomeRatio >= 2.5) score += 20;
      else if (incomeRatio >= 2) score += 10;

      if (credit >= 750) score += 30;
      else if (credit >= 700) score += 25;
      else if (credit >= 650) score += 18;
      else if (credit >= 600) score += 10;
      else score += 3;

      if (employ >= 3) score += 15;
      else if (employ >= 1) score += 10;
      else score += 3;

      if (evictions === 0) score += 15;
      else if (evictions === 1) score += 5;

      if (history >= 5) score += 10;
      else if (history >= 2) score += 7;
      else if (history >= 1) score += 3;

      score = Math.min(100, Math.max(0, score));

      let creditRating = 'Poor';
      if (credit >= 750) creditRating = 'Excellent';
      else if (credit >= 700) creditRating = 'Good';
      else if (credit >= 650) creditRating = 'Fair';
      else if (credit >= 600) creditRating = 'Below Avg';

      document.getElementById('ts4-score')!.textContent = score + '/100';
      document.getElementById('ts4-ratio')!.textContent = incomeRatio.toFixed(1) + 'x';
      document.getElementById('ts4-creditrating')!.textContent = creditRating;
      document.getElementById('ts4-rentpct')!.textContent = rentPct.toFixed(1) + '%';
      document.getElementById('ts4-appcost')!.textContent = '$' + cost.toFixed(0);
      document.getElementById('ts4-maxrent')!.textContent = '$' + maxRent.toLocaleString(undefined, { maximumFractionDigits: 0 });

      let status: string, color: string;
      if (score >= 80) { status = 'Excellent candidate — low risk'; color = 'bg-green-50 text-green-800'; }
      else if (score >= 60) { status = 'Good candidate — moderate risk'; color = 'bg-blue-50 text-blue-800'; }
      else if (score >= 40) { status = 'Fair candidate — consider additional deposit'; color = 'bg-yellow-50 text-yellow-800'; }
      else { status = 'High risk — consider declining or co-signer'; color = 'bg-red-50 text-red-800'; }

      document.getElementById('ts4-status')!.textContent = status;
      document.getElementById('ts4-status-box')!.className = `p-4 rounded-xl text-center ${color}`;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ts4-in').forEach(el => { el.addEventListener('input', calcTS4); el.addEventListener('change', calcTS4); });
      calcTS4();
    }, 50);
  </script>
</CalculatorLayout>
