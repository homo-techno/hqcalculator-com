---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Craps Calculator - Bet Probabilities & House Edge";
const description = "Calculate craps bet probabilities, house edge, and expected value for every bet type including pass, don't pass, come, and odds bets.";
const relatedCalcs = [
  { name: "Probability Calculator", url: "/probability-calculator", description: "Event probability." },
  { name: "Dice Roller", url: "/dice-roller", description: "Dice simulation." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage math." },
  { name: "Statistics Calculator", url: "/statistics-calculator", description: "Statistical tools." },
  { name: "Average Calculator", url: "/average-calculator", description: "Calculate averages." },
  { name: "Random Number", url: "/random-number-generator", description: "Random numbers." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Craps Calculator" keywords="craps calculator, craps odds, pass line, don't pass, house edge, craps bets, expected value" breadcrumbs={[{ name: "Craps", url: "/craps-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Craps Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Analyze every craps bet type with exact probabilities, house edge, and expected value.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Bet Type</label>
          <select class="cp3-in w-full px-4 py-2 border border-border rounded-xl" id="cp3-bet">
            <option value="pass">Pass Line</option>
            <option value="dontpass">Don't Pass</option>
            <option value="come">Come</option>
            <option value="dontcome">Don't Come</option>
            <option value="field">Field</option>
            <option value="any7">Any 7</option>
            <option value="any11">Any Craps</option>
            <option value="hard6">Hard 6</option>
            <option value="hard8">Hard 8</option>
            <option value="hard4">Hard 4</option>
            <option value="hard10">Hard 10</option>
            <option value="place6">Place 6</option>
            <option value="place8">Place 8</option>
            <option value="place5">Place 5</option>
            <option value="place9">Place 9</option>
            <option value="place4">Place 4</option>
            <option value="place10">Place 10</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-text mb-1">Bet Amount ($)</label>
            <input type="number" class="cp3-in w-full px-4 py-3 border border-border rounded-xl text-xl font-bold text-center" id="cp3-amount" min="1" value="10">
          </div>
          <div>
            <label class="block text-sm font-semibold text-text mb-1">Odds Multiplier (0 = no odds)</label>
            <input type="number" class="cp3-in w-full px-4 py-3 border border-border rounded-xl text-xl font-bold text-center" id="cp3-odds" min="0" max="100" value="2">
          </div>
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Rolls per Hour</label>
          <input type="number" class="cp3-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" id="cp3-rolls" min="1" max="200" value="100">
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Win Probability</div>
          <div class="text-5xl font-extrabold font-mono" id="cp3-prob">--</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">House Edge</div>
            <div class="text-xl font-bold font-mono" id="cp3-edge">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Payout</div>
            <div class="text-xl font-bold font-mono" id="cp3-payout">--</div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">EV per Bet</div>
            <div class="text-xl font-bold font-mono" id="cp3-ev">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Expected Loss / Hour</div>
            <div class="text-xl font-bold font-mono" id="cp3-hour">--</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Best to Worst Bets (by House Edge)</h3>
          <div class="text-xs font-mono space-y-1" id="cp3-table"></div>
        </div>
      </div>
      <ShareButton calculatorId="craps" />
      <FeedbackWidget />
    </div>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcCP3() {
      const bet = (document.getElementById('cp3-bet') as HTMLSelectElement).value;
      const amount = parseFloat((document.getElementById('cp3-amount') as HTMLInputElement).value) || 10;
      const oddsMult = parseFloat((document.getElementById('cp3-odds') as HTMLInputElement).value) || 0;
      const rollsHr = parseInt((document.getElementById('cp3-rolls') as HTMLInputElement).value) || 100;

      interface BetInfo { winProb: number; edge: number; payout: string; name: string; }
      const bets: Record<string, BetInfo> = {
        'pass':     { winProb: 244/495, edge: 0.0141, payout: '1:1', name: 'Pass Line' },
        'dontpass': { winProb: 949/1980, edge: 0.0136, payout: '1:1', name: "Don't Pass" },
        'come':     { winProb: 244/495, edge: 0.0141, payout: '1:1', name: 'Come' },
        'dontcome': { winProb: 949/1980, edge: 0.0136, payout: '1:1', name: "Don't Come" },
        'field':    { winProb: 16/36, edge: 0.0556, payout: '1:1 (2:1 on 2,12)', name: 'Field' },
        'any7':     { winProb: 6/36, edge: 0.1667, payout: '4:1', name: 'Any 7' },
        'any11':    { winProb: 4/36, edge: 0.1111, payout: '7:1', name: 'Any Craps' },
        'hard6':    { winProb: 1/36, edge: 0.0909, payout: '9:1', name: 'Hard 6' },
        'hard8':    { winProb: 1/36, edge: 0.0909, payout: '9:1', name: 'Hard 8' },
        'hard4':    { winProb: 1/36, edge: 0.1111, payout: '7:1', name: 'Hard 4' },
        'hard10':   { winProb: 1/36, edge: 0.1111, payout: '7:1', name: 'Hard 10' },
        'place6':   { winProb: 5/11, edge: 0.0152, payout: '7:6', name: 'Place 6' },
        'place8':   { winProb: 5/11, edge: 0.0152, payout: '7:6', name: 'Place 8' },
        'place5':   { winProb: 4/10, edge: 0.0400, payout: '7:5', name: 'Place 5' },
        'place9':   { winProb: 4/10, edge: 0.0400, payout: '7:5', name: 'Place 9' },
        'place4':   { winProb: 3/9, edge: 0.0667, payout: '9:5', name: 'Place 4' },
        'place10':  { winProb: 3/9, edge: 0.0667, payout: '9:5', name: 'Place 10' },
      };

      const info = bets[bet];
      let effectiveEdge = info.edge;

      // Odds bets reduce effective house edge
      if ((bet === 'pass' || bet === 'dontpass' || bet === 'come' || bet === 'dontcome') && oddsMult > 0) {
        const totalBet = amount + amount * oddsMult;
        const houseEdgeTotal = (info.edge * amount) / totalBet;
        effectiveEdge = houseEdgeTotal;
      }

      const evPerBet = -amount * effectiveEdge;
      const betsPerHour = rollsHr * 0.35; // approximate decisions per roll
      const lossHour = Math.abs(evPerBet) * betsPerHour;

      document.getElementById('cp3-prob')!.textContent = (info.winProb * 100).toFixed(2) + '%';
      document.getElementById('cp3-edge')!.textContent = (effectiveEdge * 100).toFixed(2) + '%';
      document.getElementById('cp3-payout')!.textContent = info.payout;
      document.getElementById('cp3-ev')!.textContent = '-$' + Math.abs(evPerBet).toFixed(3);
      document.getElementById('cp3-hour')!.textContent = '-$' + lossHour.toFixed(2);

      // Ranking table
      const sorted = Object.entries(bets).sort((a, b) => a[1].edge - b[1].edge);
      let html = '';
      for (const [key, b] of sorted) {
        const marker = key === bet ? ' font-bold text-primary' : '';
        html += '<div class="flex justify-between py-0.5 border-b border-border' + marker + '"><span>' + b.name + '</span><span>Edge: ' + (b.edge * 100).toFixed(2) + '% | Win: ' + (b.winProb * 100).toFixed(1) + '%</span></div>';
      }
      document.getElementById('cp3-table')!.innerHTML = html;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.cp3-in').forEach(el => { el.addEventListener('input', calcCP3); el.addEventListener('change', calcCP3); });
      calcCP3();
    }, 50);
  </script>
</CalculatorLayout>
