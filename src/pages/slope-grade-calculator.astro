---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Slope & Grade Calculator - Rise Over Run Converter";
const description = "Convert between slope percentage, ratio, angle in degrees, and rise over run. Essential for grading, road design, and drainage calculations.";
const relatedCalcs = [
  { name: "Cut & Fill Calculator", url: "/cut-fill-calculator", description: "Earthwork volumes." },
  { name: "Elevation Difference", url: "/elevation-difference-calculator", description: "Trig leveling." },
  { name: "Vertical Curve", url: "/vertical-curve-calculator", description: "Crest & sag curves." },
  { name: "Topographic Profile", url: "/topographic-profile-calculator", description: "Profile & grade." },
  { name: "Slope Calculator", url: "/slope-calculator", description: "Slope from points." },
  { name: "Distance & Bearing", url: "/distance-bearing-calculator", description: "GPS calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Slope & Grade Calculator" keywords="slope grade calculator, rise over run, percent slope, slope ratio, grade conversion, road grade" breadcrumbs={[{ name: "Slope & Grade Calculator", url: "/slope-grade-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Slope & Grade Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Enter any one value to convert between slope percentage, angle, ratio, and rise/run.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Input Method</label>
          <select id="slg-mode" class="slg-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="riserun">Rise & Run</option>
            <option value="percent">Percent Grade</option>
            <option value="angle">Angle (degrees)</option>
            <option value="ratio">Ratio (1:N)</option>
          </select>
        </div>
        <div id="slg-riserun-inputs" class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-text mb-1">Rise (vertical)</label>
            <input type="number" id="slg-rise" class="slg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3" step="0.1">
          </div>
          <div>
            <label class="block text-sm font-semibold text-text mb-1">Run (horizontal)</label>
            <input type="number" id="slg-run" class="slg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" step="0.1">
          </div>
        </div>
        <div id="slg-percent-input" style="display:none">
          <label class="block text-sm font-semibold text-text mb-1">Slope (%)</label>
          <input type="number" id="slg-pct" class="slg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="25" step="0.1">
        </div>
        <div id="slg-angle-input" style="display:none">
          <label class="block text-sm font-semibold text-text mb-1">Angle (degrees)</label>
          <input type="number" id="slg-deg" class="slg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="14.04" step="0.01">
        </div>
        <div id="slg-ratio-input" style="display:none">
          <label class="block text-sm font-semibold text-text mb-1">Ratio 1:N (enter N)</label>
          <input type="number" id="slg-ratio" class="slg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" step="0.1">
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Slope Grade</div>
          <div class="text-5xl font-extrabold font-mono" id="slg-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Angle</div>
            <div class="text-xl font-bold" id="slg-out-angle">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Ratio</div>
            <div class="text-xl font-bold" id="slg-out-ratio">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Rise : Run</div>
            <div class="text-xl font-bold" id="slg-out-riserun">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Slope Length per 100</div>
            <div class="text-xl font-bold" id="slg-out-hyp">--</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="slope-grade" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Slope Conversion Formulas</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p>Percent Grade = (Rise / Run) x 100</p>
        <p>Angle = arctan(Rise / Run)</p>
        <p>Ratio 1:N = 1 : (Run / Rise)</p>
        <p>Slope Length = sqrt(Rise^2 + Run^2)</p>
      </div>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcSLG() {
      const mode = (document.getElementById('slg-mode') as HTMLSelectElement).value;
      document.getElementById('slg-riserun-inputs')!.style.display = mode === 'riserun' ? '' : 'none';
      document.getElementById('slg-percent-input')!.style.display = mode === 'percent' ? '' : 'none';
      document.getElementById('slg-angle-input')!.style.display = mode === 'angle' ? '' : 'none';
      document.getElementById('slg-ratio-input')!.style.display = mode === 'ratio' ? '' : 'none';
      let rise = 0, run = 1;
      if (mode === 'riserun') {
        rise = parseFloat((document.getElementById('slg-rise') as HTMLInputElement).value) || 0;
        run = parseFloat((document.getElementById('slg-run') as HTMLInputElement).value) || 1;
      } else if (mode === 'percent') {
        const pct = parseFloat((document.getElementById('slg-pct') as HTMLInputElement).value) || 0;
        rise = pct; run = 100;
      } else if (mode === 'angle') {
        const deg = parseFloat((document.getElementById('slg-deg') as HTMLInputElement).value) || 0;
        rise = Math.tan(deg * Math.PI / 180); run = 1;
      } else if (mode === 'ratio') {
        const n = parseFloat((document.getElementById('slg-ratio') as HTMLInputElement).value) || 1;
        rise = 1; run = n;
      }
      if (run === 0) run = 0.001;
      const pct = (rise / run) * 100;
      const angle = Math.atan2(rise, run) * 180 / Math.PI;
      const ratioN = run / (rise || 0.001);
      const hyp = Math.sqrt(rise * rise + run * run);
      const slopePer100 = Math.sqrt(100 * 100 + pct * pct);
      document.getElementById('slg-result')!.textContent = pct.toFixed(2) + '%';
      document.getElementById('slg-out-angle')!.textContent = angle.toFixed(2) + '\u00B0';
      document.getElementById('slg-out-ratio')!.textContent = '1 : ' + Math.abs(ratioN).toFixed(2);
      document.getElementById('slg-out-riserun')!.textContent = rise.toFixed(2) + ' : ' + run.toFixed(2);
      document.getElementById('slg-out-hyp')!.textContent = slopePer100.toFixed(2);
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.slg-in').forEach(el => { el.addEventListener('input', calcSLG); el.addEventListener('change', calcSLG); });
      calcSLG();
    }, 50);
  </script>
</CalculatorLayout>
