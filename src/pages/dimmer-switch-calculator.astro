---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Dimmer Switch Calculator - Load Rating & Energy Savings";
const description = "Calculate total wattage load for dimmer switch sizing, check bulb compatibility, and estimate energy savings from dimming your lights.";
const relatedCalcs = [
  { name: "Lighting", url: "/lighting-calculator", description: "Lighting design." },
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Energy costs." },
  { name: "LED Resistor", url: "/led-resistor-calculator", description: "LED circuits." },
  { name: "Electrical Load", url: "/electrical-load-calculator", description: "Panel loads." },
  { name: "Wire Gauge", url: "/wire-gauge-calculator", description: "Wire sizing." },
  { name: "Electricity Bill", url: "/electricity-bill-calculator", description: "Bill estimates." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Dimmer Switch Calculator" keywords="dimmer switch calculator, dimmer wattage, LED dimmer, dimmer load rating, energy savings dimming, bulb compatibility" breadcrumbs={[{ name: "Dimmer Switch", url: "/dimmer-switch-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Dimmer Switch Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Size your dimmer switch, verify bulb compatibility, and estimate energy savings from dimming.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Bulb Type</label>
            <select id="dm2-bulb" class="dm2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="led" selected>LED (dimmable)</option>
              <option value="cfl">CFL (dimmable)</option>
              <option value="incandescent">Incandescent</option>
              <option value="halogen">Halogen</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Watts Per Bulb</label>
            <input type="number" id="dm2-watts" class="dm2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="1" step="1">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Number of Bulbs</label>
            <input type="number" id="dm2-count" class="dm2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="1" step="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Dim Level (%)</label>
            <input type="number" id="dm2-dim" class="dm2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="50" min="0" max="100" step="5">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Hours Used Per Day</label>
            <input type="number" id="dm2-hrs" class="dm2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="0" step="0.5">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Electricity Rate ($/kWh)</label>
            <input type="number" id="dm2-rate" class="dm2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.14" min="0.01" step="0.01">
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Minimum Dimmer Rating</div>
          <div class="text-5xl font-extrabold font-mono" id="dm2-result">0 W</div>
          <div class="text-sm text-blue-200 mt-1" id="dm2-note">-</div>
        </div>
        <div class="p-4 rounded-xl text-center" id="dm2-status-box">
          <div class="font-bold text-sm" id="dm2-status">-</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Load</div>
            <div class="text-xl font-bold font-mono" id="dm2-load">0 W</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Dimmed Watts</div>
            <div class="text-xl font-bold font-mono" id="dm2-dimmed">0 W</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Watts Saved</div>
            <div class="text-xl font-bold font-mono" id="dm2-saved">0 W</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Annual Savings</div>
            <div class="text-xl font-bold font-mono" id="dm2-annual">$0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Annual Energy at 100%</div>
            <div class="text-xl font-bold font-mono" id="dm2-fullcost">$0</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="dimmer-switch" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcDM2() {
      const bulbType = (document.getElementById('dm2-bulb') as HTMLSelectElement).value;
      const wattsPerBulb = parseFloat((document.getElementById('dm2-watts') as HTMLInputElement).value) || 0;
      const count = parseInt((document.getElementById('dm2-count') as HTMLInputElement).value) || 1;
      const dimPct = parseFloat((document.getElementById('dm2-dim') as HTMLInputElement).value) || 100;
      const hrs = parseFloat((document.getElementById('dm2-hrs') as HTMLInputElement).value) || 0;
      const rate = parseFloat((document.getElementById('dm2-rate') as HTMLInputElement).value) || 0.14;

      const totalLoad = wattsPerBulb * count;

      // LED/CFL dimmers have derating: rated wattage for LED is ~1/10 of incandescent rating
      // Standard dimmer: 600W incandescent = ~150W LED/CFL
      let dimmerDerateFactor: number;
      if (bulbType === 'led') dimmerDerateFactor = 10;
      else if (bulbType === 'cfl') dimmerDerateFactor = 8;
      else dimmerDerateFactor = 1;

      const equivalentLoad = totalLoad * dimmerDerateFactor;
      // Standard dimmer ratings
      const dimmerRatings = [150, 300, 450, 600, 1000, 1500, 2000];
      const recDimmer = dimmerRatings.find(r => r >= equivalentLoad) || 2000;
      const actualDimmerRating = Math.ceil(recDimmer / dimmerDerateFactor);

      // Energy savings from dimming — LED power reduction approximation
      let powerFactor: number;
      if (bulbType === 'led' || bulbType === 'cfl') {
        // LEDs: power roughly proportional to dim level
        powerFactor = dimPct / 100;
      } else {
        // Incandescent: power roughly proportional to (dim)^1.6 due to filament physics
        powerFactor = Math.pow(dimPct / 100, 1.6);
      }

      const dimmedWatts = totalLoad * powerFactor;
      const wattsSaved = totalLoad - dimmedWatts;
      const annualFull = totalLoad * hrs * 365 / 1000 * rate;
      const annualDimmed = dimmedWatts * hrs * 365 / 1000 * rate;
      const annualSavings = annualFull - annualDimmed;

      document.getElementById('dm2-result')!.textContent = actualDimmerRating + ' W';
      document.getElementById('dm2-note')!.textContent = recDimmer + 'W rated dimmer (' + bulbType.toUpperCase() + ' compatible)';
      document.getElementById('dm2-load')!.textContent = totalLoad + ' W';
      document.getElementById('dm2-dimmed')!.textContent = dimmedWatts.toFixed(0) + ' W';
      document.getElementById('dm2-saved')!.textContent = wattsSaved.toFixed(0) + ' W';
      document.getElementById('dm2-annual')!.textContent = '$' + annualSavings.toFixed(2);
      document.getElementById('dm2-fullcost')!.textContent = '$' + annualFull.toFixed(2);

      let status: string, color: string;
      if (bulbType === 'cfl' && dimPct < 20) {
        status = 'CFL bulbs may flicker below 20% — use LED for deep dimming';
        color = 'bg-yellow-50 text-yellow-800';
      } else if (totalLoad > actualDimmerRating) {
        status = 'Total load exceeds dimmer capacity — use higher rated dimmer';
        color = 'bg-red-50 text-red-800';
      } else {
        status = recDimmer + 'W dimmer handles ' + count + ' x ' + wattsPerBulb + 'W ' + bulbType.toUpperCase() + ' bulbs';
        color = 'bg-green-50 text-green-800';
      }
      document.getElementById('dm2-status')!.textContent = status;
      document.getElementById('dm2-status-box')!.className = 'p-4 rounded-xl text-center ' + color;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.dm2-in').forEach(el => {
        el.addEventListener('input', calcDM2);
        el.addEventListener('change', calcDM2);
      });
      calcDM2();
    }, 50);
  </script>
</CalculatorLayout>
