---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Clay Shrinkage Calculator - Wet to Bisque to Glaze Firing";
const description = "Calculate clay shrinkage percentage from wet to bisque to glaze firing. Determine original size needed for a target finished dimension.";
const relatedCalcs = [
  { name: "Kiln Temperature Calculator", url: "/kiln-temperature-calculator", description: "Firing schedules & cone charts." },
  { name: "Clay Weight Calculator", url: "/clay-weight-calculator", description: "Clay weight for pottery forms." },
  { name: "Glaze Recipe Calculator", url: "/glaze-recipe-calculator", description: "Scale glaze batch recipes." },
  { name: "Pottery Wheel Speed Calculator", url: "/pottery-wheel-speed-calculator", description: "Optimal wheel RPM." },
  { name: "Ceramic Tile Weight Calculator", url: "/ceramic-tile-weight-calculator", description: "Tile weight calculations." },
  { name: "Slip Casting Calculator", url: "/slip-casting-calculator", description: "Slip casting volumes." },
];
---
<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Clay Shrinkage Calculator"
  keywords="clay shrinkage, pottery shrinkage, clay body shrinkage, bisque shrinkage, firing shrinkage, wet to dry shrinkage, ceramic shrinkage rate"
  breadcrumbs={[{ name: "Clay Shrinkage Calculator", url: "/clay-shrinkage-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Clay Shrinkage Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate how much clay shrinks from wet to bone-dry to bisque to glaze-fired. Plan your starting dimensions for a target finished size.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Clay Body Type</label>
        <select id="cls-type" class="cls-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="earthenware">Earthenware (Cone 06-02)</option>
          <option value="stoneware" selected>Stoneware (Cone 6)</option>
          <option value="stoneware_high">Stoneware (Cone 10)</option>
          <option value="porcelain">Porcelain (Cone 6-10)</option>
          <option value="custom">Custom Shrinkage Rates</option>
        </select>
      </div>

      <div id="cls-custom-fields" class="hidden mb-5 p-4 bg-surface-alt rounded-xl">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Wet to Dry Shrinkage (%)</label>
            <input type="number" id="cls-custom-wd" class="cls-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="6" min="0" max="20" step="0.5">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Dry to Bisque Shrinkage (%)</label>
            <input type="number" id="cls-custom-db" class="cls-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="1" min="0" max="10" step="0.5">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Bisque to Glaze Shrinkage (%)</label>
            <input type="number" id="cls-custom-bg" class="cls-in w-full px-3 py-2 border border-border rounded-lg text-sm font-bold" value="5" min="0" max="15" step="0.5">
          </div>
        </div>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Calculation Direction</label>
        <select id="cls-dir" class="cls-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="forward" selected>Wet size to finished size</option>
          <option value="reverse">Target finished size to required wet size</option>
        </select>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2" id="cls-dim-label">Wet Dimension (inches)</label>
        <input type="number" id="cls-dim" class="cls-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="0" step="0.25">
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="cls-result-label">Finished Size</div>
        <div class="text-4xl font-extrabold" id="cls-result">--</div>
        <div class="text-sm text-blue-200 mt-1" id="cls-total-shrink">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Bone Dry Size</div>
          <div class="text-xl font-bold" id="cls-dry">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Bisque Size</div>
          <div class="text-xl font-bold" id="cls-bisque">--</div>
        </div>
      </div>

      <div class="grid grid-cols-3 gap-3 mb-4">
        <div class="p-3 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted">Wet to Dry</div>
          <div class="text-lg font-bold" id="cls-wd-pct">--</div>
        </div>
        <div class="p-3 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted">Dry to Bisque</div>
          <div class="text-lg font-bold" id="cls-db-pct">--</div>
        </div>
        <div class="p-3 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted">Bisque to Glaze</div>
          <div class="text-lg font-bold" id="cls-bg-pct">--</div>
        </div>
      </div>

      <ShareButton calculatorId="clay-shrinkage" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Understanding Clay Shrinkage</h2>
      <p>Clay shrinks in three stages: wet to bone-dry (water evaporation), bone-dry to bisque (chemical water loss), and bisque to glaze firing (vitrification). Total shrinkage typically ranges from 10% to 15% depending on the clay body and firing temperature.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Typical Shrinkage Rates</h3>
      <ul>
        <li><strong>Earthenware:</strong> 4-7% wet to dry, 0-1% bisque, 1-3% glaze = 5-11% total</li>
        <li><strong>Stoneware (Cone 6):</strong> 5-7% wet to dry, 1% bisque, 4-6% glaze = 10-14% total</li>
        <li><strong>Porcelain:</strong> 6-8% wet to dry, 1-2% bisque, 5-7% glaze = 12-17% total</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcCLS() {
      const type = (document.getElementById('cls-type') as HTMLSelectElement).value;
      const dir = (document.getElementById('cls-dir') as HTMLSelectElement).value;
      const dim = parseFloat((document.getElementById('cls-dim') as HTMLInputElement).value) || 0;

      document.getElementById('cls-custom-fields')!.classList.toggle('hidden', type !== 'custom');

      // Shrinkage rates as decimals
      const rates: Record<string, {wd: number, db: number, bg: number}> = {
        'earthenware': { wd: 0.05, db: 0.005, bg: 0.02 },
        'stoneware': { wd: 0.06, db: 0.01, bg: 0.05 },
        'stoneware_high': { wd: 0.06, db: 0.01, bg: 0.06 },
        'porcelain': { wd: 0.07, db: 0.015, bg: 0.06 },
        'custom': {
          wd: (parseFloat((document.getElementById('cls-custom-wd') as HTMLInputElement).value) || 0) / 100,
          db: (parseFloat((document.getElementById('cls-custom-db') as HTMLInputElement).value) || 0) / 100,
          bg: (parseFloat((document.getElementById('cls-custom-bg') as HTMLInputElement).value) || 0) / 100
        }
      };

      const r = rates[type] || rates['stoneware'];
      const totalShrink = 1 - (1 - r.wd) * (1 - r.db) * (1 - r.bg);

      let wet, dry, bisque, glazed;

      if (dir === 'forward') {
        wet = dim;
        dry = wet * (1 - r.wd);
        bisque = dry * (1 - r.db);
        glazed = bisque * (1 - r.bg);
        document.getElementById('cls-dim-label')!.textContent = 'Wet Dimension (inches)';
        document.getElementById('cls-result-label')!.textContent = 'Finished Glaze-Fired Size';
        document.getElementById('cls-result')!.textContent = glazed.toFixed(3) + '"';
      } else {
        glazed = dim;
        bisque = glazed / (1 - r.bg);
        dry = bisque / (1 - r.db);
        wet = dry / (1 - r.wd);
        document.getElementById('cls-dim-label')!.textContent = 'Target Finished Size (inches)';
        document.getElementById('cls-result-label')!.textContent = 'Required Wet Size';
        document.getElementById('cls-result')!.textContent = wet.toFixed(3) + '"';
      }

      document.getElementById('cls-total-shrink')!.textContent = 'Total shrinkage: ' + (totalShrink * 100).toFixed(1) + '%';
      document.getElementById('cls-dry')!.textContent = dry.toFixed(3) + '"';
      document.getElementById('cls-bisque')!.textContent = bisque.toFixed(3) + '"';
      document.getElementById('cls-wd-pct')!.textContent = (r.wd * 100).toFixed(1) + '%';
      document.getElementById('cls-db-pct')!.textContent = (r.db * 100).toFixed(1) + '%';
      document.getElementById('cls-bg-pct')!.textContent = (r.bg * 100).toFixed(1) + '%';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.cls-in').forEach(el => {
        el.addEventListener('input', calcCLS);
        el.addEventListener('change', calcCLS);
      });
      calcCLS();
    }, 50);
  </script>
</CalculatorLayout>
