---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Macro Calculator - Free Macronutrient Calculator 2026";
const description = "Calculate your daily protein, carbs, and fat needs based on your goals. Custom macro splits for weight loss, muscle gain, and maintenance.";

const relatedCalcs = [
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calorie needs." },
  { name: "TDEE Calculator", url: "/tdee-calculator", description: "Total daily energy." },
  { name: "BMR Calculator", url: "/bmr-calculator", description: "Basal metabolic rate." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body Mass Index." },
  { name: "Body Fat Calculator", url: "/body-fat-calculator", description: "Body fat percentage." },
  { name: "Weight Loss Calculator", url: "/weight-loss-calculator", description: "Calorie deficit plan." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Macro Calculator"
  keywords="macro calculator, macronutrient calculator, protein calculator, carbs calculator, fat calculator, iifym calculator, flexible dieting"
  breadcrumbs={[{ name: "Macro Calculator", url: "/macro-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Macro Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate your ideal daily intake of protein, carbohydrates, and fats based on your body and goals.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <!-- Gender -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Gender</label>
            <div class="flex gap-2">
              <button class="mac-gender-btn flex-1 py-2.5 rounded-xl font-semibold bg-primary text-white border border-primary" data-gender="male">Male</button>
              <button class="mac-gender-btn flex-1 py-2.5 rounded-xl font-semibold bg-surface-alt text-text-secondary border border-border" data-gender="female">Female</button>
            </div>
          </div>

          <!-- Age, Weight, Height -->
          <div class="grid grid-cols-3 gap-3 mb-5">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Age</label>
              <input type="number" id="mac-age" class="w-full px-3 py-2.5 border border-border rounded-xl text-lg" value="28" min="15" max="120">
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Weight (kg)</label>
              <input type="number" id="mac-weight" class="w-full px-3 py-2.5 border border-border rounded-xl text-lg" value="80" min="30" max="300">
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Height (cm)</label>
              <input type="number" id="mac-height" class="w-full px-3 py-2.5 border border-border rounded-xl text-lg" value="178" min="100" max="250">
            </div>
          </div>

          <!-- Activity -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-1">Activity Level</label>
            <select id="mac-activity" class="w-full px-3 py-2.5 border border-border rounded-xl">
              <option value="1.2">Sedentary (office job)</option>
              <option value="1.375">Light Exercise (1-3 days/week)</option>
              <option value="1.55" selected>Moderate Exercise (3-5 days/week)</option>
              <option value="1.725">Heavy Exercise (6-7 days/week)</option>
              <option value="1.9">Athlete (2x daily)</option>
            </select>
          </div>

          <!-- Goal -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Goal</label>
            <div class="space-y-2">
              <label class="flex items-center gap-3 p-3 border border-border rounded-xl cursor-pointer hover:border-primary/30 mac-goal-opt">
                <input type="radio" name="mac-goal" value="lose-fast" class="text-primary">
                <div><div class="font-semibold text-sm">Aggressive Fat Loss</div><div class="text-xs text-text-muted">−750 cal (≈0.75 kg/week)</div></div>
              </label>
              <label class="flex items-center gap-3 p-3 border border-border rounded-xl cursor-pointer hover:border-primary/30 mac-goal-opt">
                <input type="radio" name="mac-goal" value="lose" checked class="text-primary">
                <div><div class="font-semibold text-sm">Fat Loss</div><div class="text-xs text-text-muted">−500 cal (≈0.5 kg/week)</div></div>
              </label>
              <label class="flex items-center gap-3 p-3 border border-border rounded-xl cursor-pointer hover:border-primary/30 mac-goal-opt">
                <input type="radio" name="mac-goal" value="maintain" class="text-primary">
                <div><div class="font-semibold text-sm">Maintain Weight</div><div class="text-xs text-text-muted">Eat at maintenance</div></div>
              </label>
              <label class="flex items-center gap-3 p-3 border border-border rounded-xl cursor-pointer hover:border-primary/30 mac-goal-opt">
                <input type="radio" name="mac-goal" value="gain" class="text-primary">
                <div><div class="font-semibold text-sm">Lean Bulk</div><div class="text-xs text-text-muted">+300 cal (lean muscle gain)</div></div>
              </label>
            </div>
          </div>

          <!-- Diet Type -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-1">Diet Type</label>
            <select id="mac-diet" class="w-full px-3 py-2.5 border border-border rounded-xl">
              <option value="balanced">Balanced (30/35/35)</option>
              <option value="high-protein">High Protein (40/30/30)</option>
              <option value="low-carb">Low Carb (35/20/45)</option>
              <option value="keto">Keto (25/5/70)</option>
              <option value="zone">Zone Diet (30/40/30)</option>
            </select>
          </div>
        </div>

        <div class="space-y-4">
          <div class="p-5 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Daily Calories</div>
            <div class="text-4xl font-extrabold" id="mac-calories">0</div>
          </div>

          <!-- Macro Cards -->
          <div class="grid grid-cols-3 gap-3">
            <div class="p-4 rounded-xl text-center bg-blue-50 border border-blue-200">
              <div class="text-xs text-blue-600 uppercase font-bold">Protein</div>
              <div class="text-2xl font-extrabold text-blue-700" id="mac-protein-g">0g</div>
              <div class="text-xs text-blue-500" id="mac-protein-cal">0 cal</div>
              <div class="text-xs text-blue-500" id="mac-protein-pct">0%</div>
            </div>
            <div class="p-4 rounded-xl text-center bg-amber-50 border border-amber-200">
              <div class="text-xs text-amber-600 uppercase font-bold">Carbs</div>
              <div class="text-2xl font-extrabold text-amber-700" id="mac-carbs-g">0g</div>
              <div class="text-xs text-amber-500" id="mac-carbs-cal">0 cal</div>
              <div class="text-xs text-amber-500" id="mac-carbs-pct">0%</div>
            </div>
            <div class="p-4 rounded-xl text-center bg-rose-50 border border-rose-200">
              <div class="text-xs text-rose-600 uppercase font-bold">Fat</div>
              <div class="text-2xl font-extrabold text-rose-700" id="mac-fat-g">0g</div>
              <div class="text-xs text-rose-500" id="mac-fat-cal">0 cal</div>
              <div class="text-xs text-rose-500" id="mac-fat-pct">0%</div>
            </div>
          </div>

          <!-- Visual bar -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <div class="flex h-6 rounded-full overflow-hidden">
              <div class="bg-blue-500 transition-all" id="mac-bar-protein" style="width:30%"></div>
              <div class="bg-amber-400 transition-all" id="mac-bar-carbs" style="width:35%"></div>
              <div class="bg-rose-400 transition-all" id="mac-bar-fat" style="width:35%"></div>
            </div>
            <div class="flex justify-between text-xs mt-1 text-text-muted">
              <span>Protein</span><span>Carbs</span><span>Fat</span>
            </div>
          </div>

          <!-- Per meal -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-text text-sm mb-3">Per Meal (3 meals/day)</h3>
            <div class="grid grid-cols-4 gap-2 text-center text-sm">
              <div><div class="text-xs text-text-muted">Calories</div><div class="font-bold" id="mac-meal-cal">0</div></div>
              <div><div class="text-xs text-text-muted">Protein</div><div class="font-bold" id="mac-meal-p">0g</div></div>
              <div><div class="text-xs text-text-muted">Carbs</div><div class="font-bold" id="mac-meal-c">0g</div></div>
              <div><div class="text-xs text-text-muted">Fat</div><div class="font-bold" id="mac-meal-f">0g</div></div>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">TDEE</div>
              <div class="text-xl font-bold" id="mac-tdee">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">BMR</div>
              <div class="text-xl font-bold" id="mac-bmr">0</div>
            </div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="macro" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Understanding Macronutrients</h2>
      <p>Macronutrients ("macros") are the three main nutrients your body needs in large amounts: protein, carbohydrates, and fat. Each serves a specific purpose and provides a different amount of energy per gram.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Calorie Content per Gram</h3>
      <ul>
        <li><strong>Protein:</strong> 4 calories per gram — builds and repairs muscle, essential for enzymes and hormones</li>
        <li><strong>Carbohydrates:</strong> 4 calories per gram — primary energy source, fuels brain and muscles</li>
        <li><strong>Fat:</strong> 9 calories per gram — hormone production, vitamin absorption, cell structure</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">How Much Protein Do I Need?</h3>
      <ul>
        <li><strong>Sedentary:</strong> 0.8g per kg bodyweight (minimum)</li>
        <li><strong>Active/Weight loss:</strong> 1.6-2.0g per kg bodyweight</li>
        <li><strong>Muscle building:</strong> 1.8-2.2g per kg bodyweight</li>
        <li><strong>Athletes:</strong> 2.0-2.5g per kg bodyweight</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Popular Diet Splits</h3>
      <ul>
        <li><strong>Balanced:</strong> 30% protein, 35% carbs, 35% fat — good all-around split</li>
        <li><strong>High Protein:</strong> 40% protein, 30% carbs, 30% fat — for muscle building and fat loss</li>
        <li><strong>Low Carb:</strong> 35% protein, 20% carbs, 45% fat — for steady energy and fat loss</li>
        <li><strong>Keto:</strong> 25% protein, 5% carbs, 70% fat — induces ketosis for fat burning</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>Do I need to track macros exactly?</strong> Not necessarily. Being within ±5-10% of your targets is good enough for most people. Focus on hitting your protein target first, then fill in carbs and fat.</p>
      <p><strong>What is IIFYM?</strong> "If It Fits Your Macros" is a flexible dieting approach where you can eat any food as long as it fits your daily macro targets. It prioritizes overall intake over food quality.</p>
      <p><strong>When should I eat my macros?</strong> For most people, total daily intake matters more than timing. However, having protein every 3-4 hours can optimize muscle protein synthesis.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let macGender = 'male';

    const dietSplits: Record<string, [number, number, number]> = {
      'balanced': [30, 35, 35],
      'high-protein': [40, 30, 30],
      'low-carb': [35, 20, 45],
      'keto': [25, 5, 70],
      'zone': [30, 40, 30],
    };

    function calcMacros() {
      const age = parseFloat((document.getElementById('mac-age') as HTMLInputElement).value) || 0;
      const weight = parseFloat((document.getElementById('mac-weight') as HTMLInputElement).value) || 0;
      const height = parseFloat((document.getElementById('mac-height') as HTMLInputElement).value) || 0;
      const activity = parseFloat((document.getElementById('mac-activity') as HTMLSelectElement).value);
      const goal = (document.querySelector('input[name="mac-goal"]:checked') as HTMLInputElement)?.value || 'lose';
      const diet = (document.getElementById('mac-diet') as HTMLSelectElement).value;

      // BMR (Mifflin-St Jeor)
      let bmr: number;
      if (macGender === 'male') {
        bmr = 10 * weight + 6.25 * height - 5 * age + 5;
      } else {
        bmr = 10 * weight + 6.25 * height - 5 * age - 161;
      }

      const tdee = Math.round(bmr * activity);

      // Goal adjustment
      const goalOffsets: Record<string, number> = {
        'lose-fast': -750,
        'lose': -500,
        'maintain': 0,
        'gain': 300,
      };
      const calories = Math.max(1200, tdee + (goalOffsets[goal] || 0));

      // Diet split
      const [protPct, carbPct, fatPct] = dietSplits[diet] || [30, 35, 35];
      const proteinCal = calories * protPct / 100;
      const carbsCal = calories * carbPct / 100;
      const fatCal = calories * fatPct / 100;
      const proteinG = Math.round(proteinCal / 4);
      const carbsG = Math.round(carbsCal / 4);
      const fatG = Math.round(fatCal / 9);

      document.getElementById('mac-calories')!.textContent = calories.toLocaleString();
      document.getElementById('mac-protein-g')!.textContent = proteinG + 'g';
      document.getElementById('mac-protein-cal')!.textContent = Math.round(proteinCal) + ' cal';
      document.getElementById('mac-protein-pct')!.textContent = protPct + '%';
      document.getElementById('mac-carbs-g')!.textContent = carbsG + 'g';
      document.getElementById('mac-carbs-cal')!.textContent = Math.round(carbsCal) + ' cal';
      document.getElementById('mac-carbs-pct')!.textContent = carbPct + '%';
      document.getElementById('mac-fat-g')!.textContent = fatG + 'g';
      document.getElementById('mac-fat-cal')!.textContent = Math.round(fatCal) + ' cal';
      document.getElementById('mac-fat-pct')!.textContent = fatPct + '%';

      document.getElementById('mac-bar-protein')!.style.width = protPct + '%';
      document.getElementById('mac-bar-carbs')!.style.width = carbPct + '%';
      document.getElementById('mac-bar-fat')!.style.width = fatPct + '%';

      // Per meal
      document.getElementById('mac-meal-cal')!.textContent = Math.round(calories / 3).toString();
      document.getElementById('mac-meal-p')!.textContent = Math.round(proteinG / 3) + 'g';
      document.getElementById('mac-meal-c')!.textContent = Math.round(carbsG / 3) + 'g';
      document.getElementById('mac-meal-f')!.textContent = Math.round(fatG / 3) + 'g';

      document.getElementById('mac-tdee')!.textContent = tdee.toLocaleString() + ' cal';
      document.getElementById('mac-bmr')!.textContent = Math.round(bmr).toLocaleString() + ' cal';

      // Highlight selected goal
      document.querySelectorAll('.mac-goal-opt').forEach(opt => {
        const radio = opt.querySelector('input[type="radio"]') as HTMLInputElement;
        if (radio.checked) {
          opt.classList.add('border-primary', 'bg-primary/5');
          opt.classList.remove('border-border');
        } else {
          opt.classList.remove('border-primary', 'bg-primary/5');
          opt.classList.add('border-border');
        }
      });

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.mac-gender-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.mac-gender-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white', 'border-primary');
            b.classList.add('bg-surface-alt', 'text-text-secondary', 'border-border');
          });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary', 'border-border');
          btn.classList.add('bg-primary', 'text-white', 'border-primary');
          macGender = (btn as HTMLElement).dataset.gender || 'male';
          calcMacros();
        });
      });

      ['mac-age', 'mac-weight', 'mac-height'].forEach(id => {
        document.getElementById(id)!.addEventListener('input', calcMacros);
      });
      document.getElementById('mac-activity')!.addEventListener('change', calcMacros);
      document.getElementById('mac-diet')!.addEventListener('change', calcMacros);
      document.querySelectorAll('input[name="mac-goal"]').forEach(r => r.addEventListener('change', calcMacros));

      calcMacros();
    }, 50);
  </script>
</CalculatorLayout>
