---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Health Insurance Calculator - Compare Plan Costs";
const description = "Compare health insurance plans by analyzing premiums, deductibles, copays, and out-of-pocket maximums at different usage levels.";

const relatedCalcs = [
  { name: "Life Insurance", url: "/life-insurance-calculator", description: "Life coverage needs." },
  { name: "Car Insurance", url: "/car-insurance-calculator", description: "Auto insurance estimate." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body mass index." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Budget planning." },
  { name: "Paycheck Calculator", url: "/paycheck-calculator", description: "Take-home pay." },
  { name: "Emergency Fund", url: "/emergency-fund-calculator", description: "Emergency savings." },
];
---

<CalculatorLayout title={title} description={description} calculatorName="Health Insurance Calculator" keywords="health insurance calculator, plan comparison, premium, deductible, copay, coinsurance, out-of-pocket max" breadcrumbs={[{ name: "Health Insurance", url: "/health-insurance-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Health Insurance Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Compare health plans by estimating total annual costs at low, medium, and high healthcare usage levels.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Monthly Premium</label>
            <div class="relative"><span class="absolute left-4 top-1/2 -translate-y-1/2 text-text-muted font-bold">$</span>
              <input type="number" id="hi-premium" class="w-full pl-8 pr-4 py-3 border border-border rounded-xl text-2xl font-bold" value="450" min="0" step="10">
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Annual Deductible</label>
            <div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
              <input type="number" id="hi-deductible" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="1500" min="0" step="100">
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Copay per Visit</label>
            <div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
              <input type="number" id="hi-copay" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="30" min="0" step="5">
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Coinsurance (you pay %)</label>
            <div class="relative">
              <input type="number" id="hi-coinsurance" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="20" min="0" max="100" step="5">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-text-muted">%</span>
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Out-of-Pocket Maximum</label>
            <div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
              <input type="number" id="hi-oopmax" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="6000" min="0" step="500">
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Annual Cost (Medium Usage)</div>
            <div class="text-5xl font-extrabold font-mono" id="hi-medium">$0</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Low Usage</div>
              <div class="text-xl font-bold text-green-600" id="hi-low">$0</div>
              <div class="text-xs text-text-muted">2 visits, no major claims</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">High Usage</div>
              <div class="text-xl font-bold text-red-600" id="hi-high">$0</div>
              <div class="text-xs text-text-muted">Frequent visits + surgery</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Annual Premiums</div>
              <div class="text-xl font-bold" id="hi-annual-premium">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Max Possible Cost</div>
              <div class="text-xl font-bold text-orange-600" id="hi-worst">$0</div>
            </div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="health-insurance" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Compare Health Insurance Plans</h2>
      <p>Lower premiums often mean higher deductibles and out-of-pocket costs. Consider your expected healthcare usage: healthy individuals may prefer high-deductible plans, while those with chronic conditions benefit from lower deductibles.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Understanding Coinsurance</h3>
      <p>After meeting your deductible, coinsurance is the percentage you pay for covered services. A 20% coinsurance means the plan pays 80% and you pay 20% until you hit the out-of-pocket maximum.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const fmt = (n: number) => '$' + Math.round(n).toLocaleString();

    function calcHI() {
      const premium = parseFloat((document.getElementById('hi-premium') as HTMLInputElement).value) || 0;
      const deductible = parseFloat((document.getElementById('hi-deductible') as HTMLInputElement).value) || 0;
      const copay = parseFloat((document.getElementById('hi-copay') as HTMLInputElement).value) || 0;
      const coinsurance = (parseFloat((document.getElementById('hi-coinsurance') as HTMLInputElement).value) || 0) / 100;
      const oopMax = parseFloat((document.getElementById('hi-oopmax') as HTMLInputElement).value) || 0;

      const annualPremium = premium * 12;

      // Low usage: 2 doctor visits, $500 in services
      const lowServices = 500;
      const lowCopays = 2 * copay;
      const lowAfterDed = Math.max(0, lowServices - deductible);
      const lowCoins = lowAfterDed * coinsurance;
      const lowOOP = Math.min(oopMax, lowCopays + Math.min(deductible, lowServices) + lowCoins);
      const lowTotal = annualPremium + lowOOP;

      // Medium usage: 6 visits, $5000 in services
      const medServices = 5000;
      const medCopays = 6 * copay;
      const medAfterDed = Math.max(0, medServices - deductible);
      const medCoins = medAfterDed * coinsurance;
      const medOOP = Math.min(oopMax, medCopays + Math.min(deductible, medServices) + medCoins);
      const medTotal = annualPremium + medOOP;

      // High usage: 15 visits, $30000 in services (surgery etc)
      const highServices = 30000;
      const highCopays = 15 * copay;
      const highAfterDed = Math.max(0, highServices - deductible);
      const highCoins = highAfterDed * coinsurance;
      const highOOP = Math.min(oopMax, highCopays + Math.min(deductible, highServices) + highCoins);
      const highTotal = annualPremium + highOOP;

      const worstCase = annualPremium + oopMax;

      document.getElementById('hi-medium')!.textContent = fmt(medTotal);
      document.getElementById('hi-low')!.textContent = fmt(lowTotal);
      document.getElementById('hi-high')!.textContent = fmt(highTotal);
      document.getElementById('hi-annual-premium')!.textContent = fmt(annualPremium);
      document.getElementById('hi-worst')!.textContent = fmt(worstCase);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      ['hi-premium', 'hi-deductible', 'hi-copay', 'hi-coinsurance', 'hi-oopmax'].forEach(id => {
        const el = document.getElementById(id);
        if (el) { el.addEventListener('input', calcHI); el.addEventListener('change', calcHI); }
      });
      calcHI();
    }, 50);
  </script>
</CalculatorLayout>
