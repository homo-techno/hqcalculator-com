---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Volcanic Explosivity Calculator - VEI Scale & Classification";
const description = "Calculate Volcanic Explosivity Index (VEI) from eruption volume and column height. Compare historical eruptions, classification, and frequency.";
const relatedCalcs = [
  { name: "Earthquake Magnitude", url: "/earthquake-magnitude-calculator", description: "Earthquake scale." },
  { name: "Energy Converter", url: "/energy-converter", description: "Energy units." },
  { name: "Erosion Calculator", url: "/erosion-calculator", description: "Erosion rates." },
  { name: "Carbon Footprint", url: "/carbon-footprint-calculator", description: "Carbon emissions." },
  { name: "Volume Calculator", url: "/volume-calculator", description: "Volume shapes." },
  { name: "Force Calculator", url: "/force-calculator", description: "Force calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Volcanic Explosivity Calculator" keywords="VEI, volcanic explosivity index, eruption volume, column height, volcano classification, eruption frequency" breadcrumbs={[{ name: "Volcanic Explosivity", url: "/volcanic-explosivity-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Volcanic Explosivity Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Determine the Volcanic Explosivity Index (VEI) from eruption volume and plume height, with historical comparisons and frequency data.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Input Method</label>
          <select id="ve-method" class="ve-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="volume" selected>From Ejecta Volume</option>
            <option value="select">Select Historical Eruption</option>
          </select>
        </div>
        <div id="ve-vol-inputs">
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm font-medium text-text mb-1">Ejecta Volume (m³)</label>
              <input type="number" id="ve-volume" class="ve-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="1000000000" min="0" step="1000000">
            </div>
            <div>
              <label class="block text-sm font-medium text-text mb-1">Column Height (km)</label>
              <input type="number" id="ve-height" class="ve-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="25" min="0" step="1">
            </div>
          </div>
        </div>
        <div id="ve-hist-inputs" class="hidden">
          <label class="block text-sm font-medium text-text mb-1">Historical Eruption</label>
          <select id="ve-historical" class="ve-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="0|1e4|0.1">Kilauea (ongoing) - VEI 0</option>
            <option value="1|1e6|1">Stromboli (typical) - VEI 1</option>
            <option value="2|1e7|5">Galeras 1993 - VEI 2</option>
            <option value="3|1e8|15">Nevado del Ruiz 1985 - VEI 3</option>
            <option value="4|1e9|25" selected>Eyjafjallajokull 2010 - VEI 4</option>
            <option value="5|1e10|35">Mt. St. Helens 1980 - VEI 5</option>
            <option value="6|1e11|40">Pinatubo 1991 - VEI 6</option>
            <option value="7|1e12|45">Tambora 1815 - VEI 7</option>
            <option value="8|1e13|50">Yellowstone (640,000 yr) - VEI 8</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Quick VEI Presets</label>
          <div class="flex flex-wrap gap-2">
            <button class="ve-btn px-3 py-1.5 text-xs rounded-lg border border-border hover:bg-surface-alt" data-vol="10000" data-ht="0.1">VEI 0</button>
            <button class="ve-btn px-3 py-1.5 text-xs rounded-lg border border-border hover:bg-surface-alt" data-vol="1000000" data-ht="1">VEI 1</button>
            <button class="ve-btn px-3 py-1.5 text-xs rounded-lg border border-border hover:bg-surface-alt" data-vol="10000000" data-ht="5">VEI 2</button>
            <button class="ve-btn px-3 py-1.5 text-xs rounded-lg border border-border hover:bg-surface-alt" data-vol="100000000" data-ht="15">VEI 3</button>
            <button class="ve-btn px-3 py-1.5 text-xs rounded-lg border border-border hover:bg-surface-alt" data-vol="1000000000" data-ht="25">VEI 4</button>
            <button class="ve-btn px-3 py-1.5 text-xs rounded-lg border border-border hover:bg-surface-alt" data-vol="10000000000" data-ht="35">VEI 5</button>
            <button class="ve-btn px-3 py-1.5 text-xs rounded-lg border border-border hover:bg-surface-alt" data-vol="100000000000" data-ht="40">VEI 6</button>
            <button class="ve-btn px-3 py-1.5 text-xs rounded-lg border border-border hover:bg-surface-alt" data-vol="1000000000000" data-ht="45">VEI 7</button>
            <button class="ve-btn px-3 py-1.5 text-xs rounded-lg border border-border hover:bg-surface-alt" data-vol="10000000000000" data-ht="50">VEI 8</button>
          </div>
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Volcanic Explosivity Index</div>
          <div class="text-4xl font-extrabold" id="ve-vei">0</div>
          <div class="text-sm text-blue-200 mt-1" id="ve-class">--</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Volume (km³)</div>
            <div class="text-xl font-bold" id="ve-km3">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Column Height</div>
            <div class="text-xl font-bold" id="ve-col">0 km</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Average Frequency</div>
            <div class="text-xl font-bold" id="ve-freq">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Energy (Megatons TNT)</div>
            <div class="text-xl font-bold" id="ve-energy">0</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Description</div>
          <div class="text-sm font-bold" id="ve-desc">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Example Eruptions</div>
          <div class="text-sm" id="ve-examples">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-muted uppercase mb-2">VEI Scale</div>
          <div class="space-y-1 text-xs" id="ve-scale"></div>
        </div>
      </div>

      <ShareButton calculatorId="volcanic-explosivity" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Volcanic Explosivity Index (VEI)</h2>
      <p>The VEI is a logarithmic scale from 0 to 8 that classifies volcanic eruptions based on the volume of material ejected. Each step represents a roughly 10x increase in ejecta volume. VEI 0 represents non-explosive effusive eruptions while VEI 8 represents the largest known explosive eruptions.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>VEI</strong> = log10(Ejecta Volume in m³) - 4 (for VEI 2+)</p>
        <p><strong>Energy</strong> increases ~10x per VEI level</p>
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcVE() {
      const method = (document.getElementById('ve-method') as HTMLSelectElement).value;
      let volume = 0;
      let height = 0;

      document.getElementById('ve-vol-inputs')!.classList.toggle('hidden', method !== 'volume');
      document.getElementById('ve-hist-inputs')!.classList.toggle('hidden', method !== 'select');

      if (method === 'volume') {
        volume = parseFloat((document.getElementById('ve-volume') as HTMLInputElement).value) || 0;
        height = parseFloat((document.getElementById('ve-height') as HTMLInputElement).value) || 0;
      } else {
        const val = (document.getElementById('ve-historical') as HTMLSelectElement).value.split('|');
        volume = parseFloat(val[1]) || 0;
        height = parseFloat(val[2]) || 0;
        (document.getElementById('ve-volume') as HTMLInputElement).value = volume.toString();
        (document.getElementById('ve-height') as HTMLInputElement).value = height.toString();
      }

      const veiData = [
        { vei: 0, minVol: 0, cls: 'Non-explosive', freq: 'Daily', desc: 'Effusive lava flows, gentle eruptions', examples: 'Kilauea (Hawaii), Stromboli', energy: 0.001 },
        { vei: 1, minVol: 1e4, cls: 'Gentle', freq: 'Daily', desc: 'Small eruption, minor tephra', examples: 'Stromboli, Nyiragongo', energy: 0.01 },
        { vei: 2, minVol: 1e6, cls: 'Explosive', freq: 'Weekly', desc: 'Moderate eruption, ash clouds to ~5 km', examples: 'Galeras 1993, Sinabung 2014', energy: 0.1 },
        { vei: 3, minVol: 1e7, cls: 'Severe', freq: 'Yearly', desc: 'Significant eruption, ash column 3-15 km', examples: 'Nevado del Ruiz 1985, Soufriere Hills', energy: 1 },
        { vei: 4, minVol: 1e8, cls: 'Cataclysmic', freq: 'Every ~18 years', desc: 'Large eruption, column 10-25 km, widespread ash', examples: 'Eyjafjallajokull 2010, Pelée 1902', energy: 10 },
        { vei: 5, minVol: 1e9, cls: 'Paroxysmal', freq: 'Every ~12 years', desc: 'Very large eruption, column >25 km, pyroclastic flows', examples: 'Mt. St. Helens 1980, Vesuvius 79 AD', energy: 100 },
        { vei: 6, minVol: 1e10, cls: 'Colossal', freq: 'Every ~50 years', desc: 'Massive eruption with global effects, climate cooling', examples: 'Pinatubo 1991, Krakatoa 1883', energy: 1000 },
        { vei: 7, minVol: 1e11, cls: 'Super-colossal', freq: 'Every ~500 years', desc: 'Enormous eruption, years of climate impact', examples: 'Tambora 1815, Thera ~1600 BC', energy: 10000 },
        { vei: 8, minVol: 1e12, cls: 'Mega-colossal', freq: 'Every ~50,000 years', desc: 'Supervolcano, catastrophic global impact', examples: 'Yellowstone 640ka, Toba 74ka', energy: 100000 },
      ];

      let match = veiData[0];
      for (let i = veiData.length - 1; i >= 0; i--) {
        if (volume >= veiData[i].minVol) {
          match = veiData[i];
          break;
        }
      }

      const km3 = volume / 1e9;
      const fmt = (n: number) => {
        if (n >= 1e12) return (n / 1e12).toFixed(1) + 'T';
        if (n >= 1e9) return (n / 1e9).toFixed(1) + 'B';
        if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
        if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
        return n.toFixed(2);
      };

      document.getElementById('ve-vei')!.textContent = 'VEI ' + match.vei;
      document.getElementById('ve-class')!.textContent = match.cls;
      document.getElementById('ve-km3')!.textContent = km3 < 0.001 ? km3.toExponential(2) + ' km\u00B3' : km3.toFixed(3) + ' km\u00B3';
      document.getElementById('ve-col')!.textContent = height.toFixed(1) + ' km';
      document.getElementById('ve-freq')!.textContent = match.freq;
      document.getElementById('ve-energy')!.textContent = fmt(match.energy) + ' MT TNT';
      document.getElementById('ve-desc')!.textContent = match.desc;
      document.getElementById('ve-examples')!.textContent = match.examples;

      const scaleEl = document.getElementById('ve-scale')!;
      let html = '';
      veiData.forEach(d => {
        const isActive = d.vei === match.vei;
        const barW = ((d.vei + 1) / 9 * 100).toFixed(0);
        html += '<div class="flex items-center gap-2' + (isActive ? ' font-bold text-primary' : '') + '">';
        html += '<span class="w-8">VEI ' + d.vei + '</span>';
        html += '<div class="flex-1 bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full ' + (isActive ? 'bg-primary' : 'bg-gray-400') + '" style="width:' + barW + '%"></div></div>';
        html += '<span class="w-24 truncate text-right">' + d.cls + '</span>';
        html += '</div>';
      });
      scaleEl.innerHTML = html;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ve-in').forEach(el => { el.addEventListener('input', calcVE); el.addEventListener('change', calcVE); });
      document.querySelectorAll('.ve-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          (document.getElementById('ve-volume') as HTMLInputElement).value = (btn as HTMLElement).dataset.vol || '0';
          (document.getElementById('ve-height') as HTMLInputElement).value = (btn as HTMLElement).dataset.ht || '0';
          (document.getElementById('ve-method') as HTMLSelectElement).value = 'volume';
          calcVE();
        });
      });
      calcVE();
    }, 50);
  </script>
</CalculatorLayout>
