---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "TDEE Calculator - Total Daily Energy Expenditure Calculator";
const description = "Calculate your Total Daily Energy Expenditure (TDEE). Find out exactly how many calories you burn per day based on your activity level. Free TDEE calculator with macros.";

const relatedCalcs = [
  { name: "BMR Calculator", url: "/bmr-calculator", description: "Basal metabolic rate." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calorie needs." },
  { name: "Macro Calculator", url: "/macro-calculator", description: "Protein, carbs, fat split." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body Mass Index." },
  { name: "Body Fat Calculator", url: "/body-fat-calculator", description: "Estimate body fat %." },
  { name: "Weight Loss Calculator", url: "/weight-loss-calculator", description: "Calorie deficit planning." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="TDEE Calculator"
  keywords="tdee calculator, total daily energy expenditure, daily calorie burn, calories burned per day, maintenance calories, tdee formula"
  breadcrumbs={[{ name: "TDEE Calculator", url: "/tdee-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">TDEE Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find out your Total Daily Energy Expenditure — the total calories you burn each day including activity.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <!-- Gender -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Gender</label>
            <div class="flex gap-2">
              <button class="tdee-gender-btn flex-1 py-3 rounded-xl font-semibold bg-primary text-white border border-primary" data-gender="male">Male</button>
              <button class="tdee-gender-btn flex-1 py-3 rounded-xl font-semibold bg-surface-alt text-text-secondary border border-border" data-gender="female">Female</button>
            </div>
          </div>

          <!-- Age -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-1">Age</label>
            <input type="number" id="tdee-age" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="28" min="15" max="120">
          </div>

          <!-- Units -->
          <div class="mb-5">
            <div class="flex gap-2">
              <button class="tdee-unit-btn flex-1 py-2 rounded-lg text-sm font-semibold bg-primary text-white" data-unit="metric">Metric</button>
              <button class="tdee-unit-btn flex-1 py-2 rounded-lg text-sm font-semibold bg-surface-alt text-text-secondary" data-unit="imperial">Imperial</button>
            </div>
          </div>

          <!-- Height metric -->
          <div class="mb-5" id="tdee-h-metric">
            <label class="block text-sm font-medium text-text mb-1">Height (cm)</label>
            <input type="number" id="tdee-h-cm" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="178" min="100" max="250">
          </div>
          <div class="mb-5 hidden" id="tdee-h-imperial">
            <label class="block text-sm font-medium text-text mb-1">Height</label>
            <div class="flex gap-3">
              <div class="flex-1"><input type="number" id="tdee-h-ft" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="5" min="3" max="8"><span class="text-xs text-text-muted">ft</span></div>
              <div class="flex-1"><input type="number" id="tdee-h-in" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="10" min="0" max="11"><span class="text-xs text-text-muted">in</span></div>
            </div>
          </div>

          <!-- Weight -->
          <div class="mb-5" id="tdee-w-metric">
            <label class="block text-sm font-medium text-text mb-1">Weight (kg)</label>
            <input type="number" id="tdee-w-kg" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="80" min="30" max="300">
          </div>
          <div class="mb-5 hidden" id="tdee-w-imperial">
            <label class="block text-sm font-medium text-text mb-1">Weight (lbs)</label>
            <input type="number" id="tdee-w-lbs" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="176" min="66" max="660">
          </div>

          <!-- Activity Level -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Activity Level</label>
            <div class="space-y-2" id="tdee-activity-radios">
              <label class="flex items-start gap-3 p-3 border border-border rounded-xl cursor-pointer hover:border-primary/30 transition-colors tdee-activity-option" data-mult="1.2">
                <input type="radio" name="tdee-activity" value="1.2" class="mt-1">
                <div><div class="font-semibold text-sm">Sedentary</div><div class="text-xs text-text-muted">Little or no exercise, desk job</div></div>
              </label>
              <label class="flex items-start gap-3 p-3 border border-border rounded-xl cursor-pointer hover:border-primary/30 transition-colors tdee-activity-option" data-mult="1.375">
                <input type="radio" name="tdee-activity" value="1.375" class="mt-1">
                <div><div class="font-semibold text-sm">Lightly Active</div><div class="text-xs text-text-muted">Light exercise 1-3 days/week</div></div>
              </label>
              <label class="flex items-start gap-3 p-3 border border-border rounded-xl cursor-pointer hover:border-primary/30 transition-colors tdee-activity-option" data-mult="1.55">
                <input type="radio" name="tdee-activity" value="1.55" checked class="mt-1">
                <div><div class="font-semibold text-sm">Moderately Active</div><div class="text-xs text-text-muted">Moderate exercise 3-5 days/week</div></div>
              </label>
              <label class="flex items-start gap-3 p-3 border border-border rounded-xl cursor-pointer hover:border-primary/30 transition-colors tdee-activity-option" data-mult="1.725">
                <input type="radio" name="tdee-activity" value="1.725" class="mt-1">
                <div><div class="font-semibold text-sm">Very Active</div><div class="text-xs text-text-muted">Hard exercise 6-7 days/week</div></div>
              </label>
              <label class="flex items-start gap-3 p-3 border border-border rounded-xl cursor-pointer hover:border-primary/30 transition-colors tdee-activity-option" data-mult="1.9">
                <input type="radio" name="tdee-activity" value="1.9" class="mt-1">
                <div><div class="font-semibold text-sm">Extremely Active</div><div class="text-xs text-text-muted">Very hard exercise, physical job, training 2x/day</div></div>
              </label>
            </div>
          </div>
        </div>

        <!-- Results -->
        <div class="space-y-4">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Your TDEE</div>
            <div class="text-4xl sm:text-5xl font-extrabold" id="tdee-result">0</div>
            <div class="text-sm text-blue-200 mt-1">calories/day</div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">BMR</div>
              <div class="text-xl font-bold" id="tdee-bmr">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Activity Burn</div>
              <div class="text-xl font-bold" id="tdee-activity-burn">0</div>
            </div>
          </div>

          <!-- Calorie Goals -->
          <div class="space-y-3">
            <h3 class="font-semibold text-text text-sm">Calorie Goals</h3>
            <div class="p-4 bg-red-50 rounded-xl border border-red-100">
              <div class="flex justify-between items-center">
                <div><div class="font-semibold text-sm text-danger">Extreme Weight Loss</div><div class="text-xs text-text-muted">−1000 cal/day (~1 kg/week)</div></div>
                <div class="text-xl font-bold text-danger" id="tdee-extreme-loss">0</div>
              </div>
            </div>
            <div class="p-4 bg-orange-50 rounded-xl border border-orange-100">
              <div class="flex justify-between items-center">
                <div><div class="font-semibold text-sm text-orange-600">Weight Loss</div><div class="text-xs text-text-muted">−500 cal/day (~0.5 kg/week)</div></div>
                <div class="text-xl font-bold text-orange-600" id="tdee-loss">0</div>
              </div>
            </div>
            <div class="p-4 bg-green-50 rounded-xl border border-green-100">
              <div class="flex justify-between items-center">
                <div><div class="font-semibold text-sm text-secondary">Maintain Weight</div><div class="text-xs text-text-muted">TDEE maintenance</div></div>
                <div class="text-xl font-bold text-secondary" id="tdee-maintain">0</div>
              </div>
            </div>
            <div class="p-4 bg-blue-50 rounded-xl border border-blue-100">
              <div class="flex justify-between items-center">
                <div><div class="font-semibold text-sm text-primary">Weight Gain</div><div class="text-xs text-text-muted">+500 cal/day (~0.5 kg/week)</div></div>
                <div class="text-xl font-bold text-primary" id="tdee-gain">0</div>
              </div>
            </div>
          </div>

          <!-- Macro Split -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-text text-sm mb-3">Suggested Macros (Maintenance)</h3>
            <div class="grid grid-cols-3 gap-3 text-center">
              <div>
                <div class="text-xs text-text-muted">Protein (30%)</div>
                <div class="text-lg font-bold text-primary" id="tdee-protein">0g</div>
              </div>
              <div>
                <div class="text-xs text-text-muted">Carbs (40%)</div>
                <div class="text-lg font-bold text-secondary" id="tdee-carbs">0g</div>
              </div>
              <div>
                <div class="text-xs text-text-muted">Fat (30%)</div>
                <div class="text-lg font-bold text-accent" id="tdee-fat">0g</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="tdee" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">What Is TDEE?</h2>
      <p>Total Daily Energy Expenditure (TDEE) is the total number of calories your body burns in a day. It includes your Basal Metabolic Rate (BMR) plus the energy used for physical activity, digestion (thermic effect of food), and non-exercise activity thermogenesis (NEAT).</p>

      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">
        TDEE = BMR × Activity Multiplier
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">TDEE Components</h3>
      <ul>
        <li><strong>BMR (60-70%):</strong> Calories burned at complete rest for basic body functions</li>
        <li><strong>Physical Activity (15-30%):</strong> Exercise, sports, and intentional movement</li>
        <li><strong>Thermic Effect of Food (10%):</strong> Energy used to digest and process food</li>
        <li><strong>NEAT (5-15%):</strong> Fidgeting, walking, standing, and other non-exercise movement</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">How to Use TDEE for Weight Goals</h3>
      <ul>
        <li><strong>Lose weight:</strong> Eat 500-1000 calories below your TDEE for 0.5-1 kg (1-2 lbs) loss per week</li>
        <li><strong>Maintain weight:</strong> Eat at your TDEE level</li>
        <li><strong>Gain weight:</strong> Eat 300-500 calories above your TDEE for lean muscle gain</li>
      </ul>
      <p>Never eat below your BMR for extended periods, as this can slow your metabolism and lead to muscle loss.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How accurate is TDEE?</strong> TDEE calculations are estimates based on population averages. Individual results can vary by 10-15%. Track your weight and calorie intake for 2-3 weeks to fine-tune your personal TDEE.</p>
      <p><strong>Should I eat back exercise calories?</strong> If you selected an activity level that includes exercise, your TDEE already accounts for it. Don't double-count exercise calories.</p>
      <p><strong>Why am I not losing weight at my TDEE deficit?</strong> Common reasons: underestimating food intake, overestimating activity level, water retention, or metabolic adaptation. Try tracking more precisely or adjust your activity level selection.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let tdeeGender = 'male';
    let tdeeUnit = 'metric';

    function getWeight(): number {
      if (tdeeUnit === 'metric') return parseFloat((document.getElementById('tdee-w-kg') as HTMLInputElement).value) || 0;
      return (parseFloat((document.getElementById('tdee-w-lbs') as HTMLInputElement).value) || 0) * 0.453592;
    }

    function getHeight(): number {
      if (tdeeUnit === 'metric') return parseFloat((document.getElementById('tdee-h-cm') as HTMLInputElement).value) || 0;
      const ft = parseFloat((document.getElementById('tdee-h-ft') as HTMLInputElement).value) || 0;
      const inch = parseFloat((document.getElementById('tdee-h-in') as HTMLInputElement).value) || 0;
      return (ft * 12 + inch) * 2.54;
    }

    function calcTDEE() {
      const weight = getWeight();
      const height = getHeight();
      const age = parseFloat((document.getElementById('tdee-age') as HTMLInputElement).value) || 0;
      const activityRadio = document.querySelector('input[name="tdee-activity"]:checked') as HTMLInputElement;
      const multiplier = parseFloat(activityRadio?.value || '1.55');

      // Mifflin-St Jeor BMR
      let bmr: number;
      if (tdeeGender === 'male') {
        bmr = 10 * weight + 6.25 * height - 5 * age + 5;
      } else {
        bmr = 10 * weight + 6.25 * height - 5 * age - 161;
      }

      const tdee = Math.round(bmr * multiplier);
      const activityBurn = Math.round(tdee - bmr);

      document.getElementById('tdee-result')!.textContent = tdee.toLocaleString();
      document.getElementById('tdee-bmr')!.textContent = Math.round(bmr).toLocaleString() + ' cal';
      document.getElementById('tdee-activity-burn')!.textContent = activityBurn.toLocaleString() + ' cal';

      document.getElementById('tdee-extreme-loss')!.textContent = Math.max(1200, tdee - 1000).toLocaleString() + ' cal';
      document.getElementById('tdee-loss')!.textContent = Math.max(1200, tdee - 500).toLocaleString() + ' cal';
      document.getElementById('tdee-maintain')!.textContent = tdee.toLocaleString() + ' cal';
      document.getElementById('tdee-gain')!.textContent = (tdee + 500).toLocaleString() + ' cal';

      // Macros (30/40/30 split at maintenance)
      document.getElementById('tdee-protein')!.textContent = Math.round(tdee * 0.30 / 4) + 'g';
      document.getElementById('tdee-carbs')!.textContent = Math.round(tdee * 0.40 / 4) + 'g';
      document.getElementById('tdee-fat')!.textContent = Math.round(tdee * 0.30 / 9) + 'g';

      // Highlight selected activity
      document.querySelectorAll('.tdee-activity-option').forEach(opt => {
        const radio = opt.querySelector('input[type="radio"]') as HTMLInputElement;
        if (radio.checked) {
          opt.classList.add('border-primary', 'bg-primary/5');
          opt.classList.remove('border-border');
        } else {
          opt.classList.remove('border-primary', 'bg-primary/5');
          opt.classList.add('border-border');
        }
      });

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      // Gender
      document.querySelectorAll('.tdee-gender-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tdee-gender-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white', 'border-primary');
            b.classList.add('bg-surface-alt', 'text-text-secondary', 'border-border');
          });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary', 'border-border');
          btn.classList.add('bg-primary', 'text-white', 'border-primary');
          tdeeGender = (btn as HTMLElement).dataset.gender || 'male';
          calcTDEE();
        });
      });

      // Units
      document.querySelectorAll('.tdee-unit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tdee-unit-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-surface-alt', 'text-text-secondary');
          });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary');
          btn.classList.add('bg-primary', 'text-white');
          tdeeUnit = (btn as HTMLElement).dataset.unit || 'metric';
          const isMetric = tdeeUnit === 'metric';
          document.getElementById('tdee-h-metric')!.classList.toggle('hidden', !isMetric);
          document.getElementById('tdee-h-imperial')!.classList.toggle('hidden', isMetric);
          document.getElementById('tdee-w-metric')!.classList.toggle('hidden', !isMetric);
          document.getElementById('tdee-w-imperial')!.classList.toggle('hidden', isMetric);
          calcTDEE();
        });
      });

      // Activity radios
      document.querySelectorAll('input[name="tdee-activity"]').forEach(radio => {
        radio.addEventListener('change', calcTDEE);
      });

      // Inputs
      ['tdee-age', 'tdee-h-cm', 'tdee-h-ft', 'tdee-h-in', 'tdee-w-kg', 'tdee-w-lbs'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcTDEE);
      });

      calcTDEE();
    }, 50);
  </script>
</CalculatorLayout>
