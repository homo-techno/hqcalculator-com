---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Immigration Fee Calculator - USCIS Application Fees by Visa Type";
const description = "Calculate USCIS immigration application fees by visa type, petition category, and additional services including biometrics, premium processing, and attorney costs.";
const relatedCalcs = [
  { name: "Legal Fee Calculator", url: "/legal-fee-calculator", description: "Immigration attorney fees." },
  { name: "Court Fee Calculator", url: "/court-fee-calculator", description: "Immigration court fees." },
  { name: "Compliance Cost Calculator", url: "/compliance-cost-calculator", description: "Employer compliance." },
  { name: "Incorporation Calculator", url: "/incorporation-calculator", description: "Business formation." },
  { name: "Tax Penalty Calculator", url: "/tax-penalty-calculator", description: "Tax obligations." },
  { name: "Notary Fee Calculator", url: "/notary-fee-calculator", description: "Document notarization." },
];
---

<CalculatorLayout title={title} description={description} calculatorName="Immigration Fee Calculator" keywords="immigration fee calculator, USCIS fees, visa application, green card cost, H1B fee, citizenship, naturalization, premium processing" breadcrumbs={[{ name: "Immigration Fee", url: "/immigration-fee-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Immigration Fee Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate total USCIS immigration application fees by visa or petition type.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Application Type</label>
          <select id="imf-type" class="imf-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="h1b" selected>H-1B Specialty Worker</option>
            <option value="l1">L-1 Intracompany Transfer</option>
            <option value="o1">O-1 Extraordinary Ability</option>
            <option value="eb1">EB-1 Green Card (priority worker)</option>
            <option value="eb2">EB-2/EB-3 Green Card (employment)</option>
            <option value="family">Family-Based Green Card</option>
            <option value="k1">K-1 Fiance Visa</option>
            <option value="naturalization">Naturalization (N-400)</option>
            <option value="daca">DACA Renewal</option>
            <option value="asylum">Asylum Application</option>
            <option value="ead">Employment Authorization (EAD)</option>
            <option value="advance-parole">Advance Parole (I-131)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Premium Processing?</label>
          <select id="imf-premium" class="imf-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="no" selected>No - Standard processing</option>
            <option value="yes">Yes - Premium processing (15 business days)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Employer Size (for H-1B)</label>
          <select id="imf-employer" class="imf-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="small">Small employer (under 25 employees)</option>
            <option value="large" selected>Large employer (25+ employees)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Number of Applicants / Dependents</label>
          <input type="number" id="imf-dependents" class="imf-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0" min="0" max="10" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Attorney Assistance</label>
          <select id="imf-attorney" class="imf-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="none">No attorney (self-filing)</option>
            <option value="basic" selected>Basic legal service ($1,500-$3,000)</option>
            <option value="full">Full representation ($3,000-$8,000+)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Medical Exam Required?</label>
          <select id="imf-medical" class="imf-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="no" selected>No</option>
            <option value="yes">Yes (green card applicants)</option>
          </select>
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Total Cost</div>
          <div class="text-5xl font-extrabold font-mono" id="imf-total"></div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">USCIS Filing Fees</div>
            <div class="text-xl font-bold text-secondary" id="imf-uscis"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Premium Processing</div>
            <div class="text-xl font-bold" id="imf-premium-cost"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Attorney Fees</div>
            <div class="text-xl font-bold text-orange-600" id="imf-atty"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Other Costs</div>
            <div class="text-xl font-bold" id="imf-other"></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="immigration-fee" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Understanding Immigration Fees</h2>
      <p>USCIS immigration fees vary significantly by application type. H-1B petitions cost $1,710-$4,000+ in government fees alone. Green card applications (employment-based) typically total $1,200-$2,000 in filing fees plus biometrics. Premium processing ($2,805 for most petitions) guarantees a response within 15 business days.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Fee Waivers and Exemptions</h3>
      <p>Fee waivers are available for certain humanitarian applications (asylum, VAWA, T-visa). Some applicants may qualify based on income. Always check the current USCIS fee schedule as fees are updated periodically. The USCIS fee rule effective April 2024 significantly changed many fee amounts.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const fmt = (n: number) => '$' + Math.round(n).toLocaleString();

    function calcIMF() {
      const appType = (document.getElementById('imf-type') as HTMLSelectElement).value;
      const premium = (document.getElementById('imf-premium') as HTMLSelectElement).value;
      const employerSize = (document.getElementById('imf-employer') as HTMLSelectElement).value;
      const dependents = parseInt((document.getElementById('imf-dependents') as HTMLInputElement).value) || 0;
      const attorney = (document.getElementById('imf-attorney') as HTMLSelectElement).value;
      const medical = (document.getElementById('imf-medical') as HTMLSelectElement).value;

      // USCIS filing fees by application type
      const baseFees: Record<string, number> = {
        h1b: 1710, l1: 1710, o1: 1710, eb1: 700, eb2: 700,
        family: 535, k1: 535, naturalization: 760,
        daca: 410, asylum: 0, ead: 410, 'advance-parole': 575
      };

      let uscisFee = baseFees[appType] || 500;

      // H-1B additional fees
      if (appType === 'h1b') {
        uscisFee += 500; // fraud prevention fee
        uscisFee += employerSize === 'large' ? 1500 : 750; // ACWIA fee
        uscisFee += 460; // asylum/refugee fee (required supplement)
      }

      // L-1 fraud prevention
      if (appType === 'l1') uscisFee += 500;

      // Green card adjustment of status (I-485)
      if (['eb1', 'eb2', 'family'].includes(appType)) {
        uscisFee += 1140; // I-485 adjustment fee
        uscisFee += 85; // biometrics
      }

      // Dependent fees
      let dependentFee = 0;
      if (dependents > 0) {
        if (['h1b', 'l1', 'o1'].includes(appType)) {
          dependentFee = dependents * 460; // H-4, L-2 fees
        } else if (['eb1', 'eb2', 'family'].includes(appType)) {
          dependentFee = dependents * 1225; // I-485 for dependents
        }
      }

      // Premium processing
      let premiumFee = 0;
      if (premium === 'yes' && ['h1b', 'l1', 'o1', 'eb1', 'eb2'].includes(appType)) {
        premiumFee = 2805;
      }

      // Attorney fees
      const attyFees: Record<string, Record<string, number>> = {
        h1b: { none: 0, basic: 2500, full: 5000 },
        l1: { none: 0, basic: 3000, full: 6000 },
        o1: { none: 0, basic: 4000, full: 8000 },
        eb1: { none: 0, basic: 3500, full: 7000 },
        eb2: { none: 0, basic: 3000, full: 6000 },
        family: { none: 0, basic: 2000, full: 4000 },
        k1: { none: 0, basic: 1500, full: 3500 },
        naturalization: { none: 0, basic: 1000, full: 2500 },
        daca: { none: 0, basic: 800, full: 1500 },
        asylum: { none: 0, basic: 3000, full: 7000 },
        ead: { none: 0, basic: 500, full: 1200 },
        'advance-parole': { none: 0, basic: 500, full: 1000 }
      };
      const attyFee = (attyFees[appType] && attyFees[appType][attorney]) || 0;

      // Other costs (medical, photos, translations)
      let otherCost = 50; // passport photos, copies
      if (medical === 'yes') otherCost += 400; // immigration medical exam
      otherCost += dependentFee;

      const total = uscisFee + premiumFee + attyFee + otherCost;

      document.getElementById('imf-total')!.textContent = fmt(total);
      document.getElementById('imf-uscis')!.textContent = fmt(uscisFee);
      document.getElementById('imf-premium-cost')!.textContent = fmt(premiumFee);
      document.getElementById('imf-atty')!.textContent = fmt(attyFee);
      document.getElementById('imf-other')!.textContent = fmt(otherCost);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.imf-in').forEach(el => {
        el.addEventListener('input', calcIMF);
        el.addEventListener('change', calcIMF);
      });
      calcIMF();
    }, 50);
  </script>
</CalculatorLayout>
