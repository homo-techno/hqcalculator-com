---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Aquaponics Calculator - Fish, Plants & Flow";
const description = "Calculate fish-to-plant ratio, tank volume, grow bed sizing, feeding rate, and water flow for aquaponics systems.";
const relatedCalcs = [
  { name: "Aquarium Calculator", url: "/aquarium-calculator", description: "Aquarium volume." },
  { name: "Garden Spacing", url: "/garden-spacing-calculator", description: "Plant spacing." },
  { name: "Volume Calculator", url: "/volume-calculator", description: "Volume calculations." },
  { name: "Water Intake", url: "/hydration-calculator", description: "Water intake." },
  { name: "Area Calculator", url: "/area-calculator", description: "Area calculations." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Budget planning." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Aquaponics Calculator" keywords="aquaponics calculator, fish to plant ratio, grow bed, tank volume, water flow, feeding rate" breadcrumbs={[{ name: "Aquaponics", url: "/aquaponics-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Aquaponics Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate fish-to-plant ratios, tank sizing, grow bed area, and water flow for aquaponics systems.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Fish Tank Volume (gallons)</label><input type="number" id="aq-tank" class="aq-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="100" min="10" step="10"></div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Fish Type</label>
            <select id="aq-fish" class="aq-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="tilapia" selected>Tilapia</option>
              <option value="goldfish">Goldfish</option>
              <option value="trout">Trout</option>
              <option value="catfish">Catfish</option>
              <option value="koi">Koi</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Grow Bed Type</label>
            <select id="aq-bed" class="aq-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="media" selected>Media Bed (Gravel)</option>
              <option value="raft">Deep Water Culture (Raft)</option>
              <option value="nft">NFT (Nutrient Film)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Plant Type</label>
            <select id="aq-plant" class="aq-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="lettuce" selected>Leafy Greens / Lettuce</option>
              <option value="herbs">Herbs</option>
              <option value="tomato">Tomatoes / Peppers</option>
              <option value="strawberry">Strawberries</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Water Temperature (Â°F)</label><input type="number" id="aq-temp" class="aq-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="75" min="50" max="90" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Fish Stocking Density (fish/gal)</label><input type="number" id="aq-dens" class="aq-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.5" min="0.1" max="2" step="0.1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Fish Count</div>
          <div class="text-4xl font-extrabold font-mono" id="aq-result">0 fish</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Grow Bed Area</div><div class="text-xl font-bold font-mono" id="aq-area">0 sq ft</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Plant Sites</div><div class="text-xl font-bold font-mono" id="aq-plants">0</div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Feed/Day</div><div class="text-xl font-bold font-mono" id="aq-feed">0 oz</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Water Flow</div><div class="text-xl font-bold font-mono" id="aq-flow">0 GPH</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">System Vol.</div><div class="text-xl font-bold font-mono" id="aq-sys">0 gal</div></div>
        </div>
      </div>
      <ShareButton calculatorId="aquaponics" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcAQ() {
      const tank = parseFloat((document.getElementById('aq-tank') as HTMLInputElement).value) || 100;
      const fishType = (document.getElementById('aq-fish') as HTMLSelectElement).value;
      const bedType = (document.getElementById('aq-bed') as HTMLSelectElement).value;
      const plantType = (document.getElementById('aq-plant') as HTMLSelectElement).value;
      const temp = parseFloat((document.getElementById('aq-temp') as HTMLInputElement).value) || 75;
      const density = parseFloat((document.getElementById('aq-dens') as HTMLInputElement).value) || 0.5;

      // Fish count
      const fishCount = Math.floor(tank * density);

      // Fish avg weight at maturity (lbs)
      const avgWeight: Record<string, number> = { tilapia: 1.5, goldfish: 0.3, trout: 2, catfish: 2.5, koi: 3 };
      const totalFishLbs = fishCount * (avgWeight[fishType] || 1);

      // Feed rate: ~1.5-2% of body weight per day
      const feedRate = temp > 65 ? 0.02 : 0.015;
      const feedOzPerDay = totalFishLbs * feedRate * 16;

      // Grow bed ratio: 1:1 to 2:1 grow bed to tank ratio (gallons)
      // Media bed: 1:1, Raft: 1:1.5, NFT: 1:2
      const bedRatios: Record<string, number> = { media: 1, raft: 1.5, nft: 2 };
      const bedRatio = bedRatios[bedType] || 1;
      const growBedGallons = tank * bedRatio;
      // Approximate grow bed area: assuming 12" deep media bed = 7.48 gal/cu ft
      const growBedSqFt = growBedGallons / 7.48;

      // Plant sites per sq ft
      const plantsPerSqFt: Record<string, number> = { lettuce: 4, herbs: 6, tomato: 1, strawberry: 3 };
      const plantSites = Math.floor(growBedSqFt * (plantsPerSqFt[plantType] || 4));

      // Water flow: cycle tank volume once per hour
      const flowGPH = Math.round(tank);

      // Total system volume
      const sysVolume = tank + growBedGallons * 0.4; // grow bed ~40% water

      document.getElementById('aq-result')!.textContent = fishCount + ' fish';
      document.getElementById('aq-area')!.textContent = growBedSqFt.toFixed(1) + ' sq ft';
      document.getElementById('aq-plants')!.textContent = plantSites.toString();
      document.getElementById('aq-feed')!.textContent = feedOzPerDay.toFixed(1) + ' oz';
      document.getElementById('aq-flow')!.textContent = flowGPH + ' GPH';
      document.getElementById('aq-sys')!.textContent = Math.round(sysVolume) + ' gal';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.aq-in').forEach(el => { el.addEventListener('input', calcAQ); el.addEventListener('change', calcAQ); });
      calcAQ();
    }, 50);
  </script>
</CalculatorLayout>
