---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Ideal Weight Calculator - Healthy Weight for Your Height 2026";
const description = "Calculate your ideal body weight based on height, gender, and frame size. Multiple formulas: Devine, Robinson, Miller, Hamwi, and BMI range.";

const relatedCalcs = [
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body Mass Index." },
  { name: "Body Fat Calculator", url: "/body-fat-calculator", description: "Body fat percentage." },
  { name: "BMR Calculator", url: "/bmr-calculator", description: "Basal metabolic rate." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calorie needs." },
  { name: "TDEE Calculator", url: "/tdee-calculator", description: "Total daily energy." },
  { name: "Weight Loss Calculator", url: "/weight-loss-calculator", description: "Calorie deficit plan." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Ideal Weight Calculator"
  keywords="ideal weight calculator, ideal body weight, healthy weight, IBW calculator, weight for height, target weight"
  breadcrumbs={[{ name: "Ideal Weight Calculator", url: "/ideal-weight-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Ideal Weight Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find your ideal body weight based on multiple scientific formulas and your height.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Gender</label>
            <div class="flex gap-2">
              <button class="iw-gender-btn flex-1 py-3 rounded-xl font-semibold bg-primary text-white border border-primary" data-gender="male">Male</button>
              <button class="iw-gender-btn flex-1 py-3 rounded-xl font-semibold bg-surface-alt text-text-secondary border border-border" data-gender="female">Female</button>
            </div>
          </div>

          <div class="mb-5">
            <div class="flex gap-2">
              <button class="iw-unit-btn flex-1 py-2 rounded-lg text-sm font-semibold bg-primary text-white" data-unit="imperial">Imperial</button>
              <button class="iw-unit-btn flex-1 py-2 rounded-lg text-sm font-semibold bg-surface-alt text-text-secondary" data-unit="metric">Metric</button>
            </div>
          </div>

          <div class="mb-5" id="iw-h-imp">
            <label class="block text-sm font-medium text-text mb-1">Height</label>
            <div class="flex gap-3">
              <div class="flex-1"><input type="number" id="iw-ft" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="5" min="3" max="8"><span class="text-xs text-text-muted">ft</span></div>
              <div class="flex-1"><input type="number" id="iw-in" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="10" min="0" max="11"><span class="text-xs text-text-muted">in</span></div>
            </div>
          </div>
          <div class="mb-5 hidden" id="iw-h-met">
            <label class="block text-sm font-medium text-text mb-1">Height (cm)</label>
            <input type="number" id="iw-cm" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="178" min="120" max="230">
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-1">Current Weight <span class="text-text-muted">(optional)</span></label>
            <div class="flex gap-2">
              <input type="number" id="iw-current" class="flex-1 px-4 py-3 border border-border rounded-xl text-lg" placeholder="e.g. 180">
              <span class="self-center text-text-muted font-semibold" id="iw-weight-unit">lbs</span>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Ideal Weight Range</div>
            <div class="text-3xl sm:text-4xl font-extrabold" id="iw-range">0 - 0 lbs</div>
          </div>

          <!-- Formula results -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <div class="flex justify-between items-center py-1.5 border-b border-border/30">
              <div><span class="font-semibold text-sm">Devine (1974)</span><span class="text-xs text-text-muted ml-2">Most commonly used</span></div>
              <span class="font-bold" id="iw-devine">0</span>
            </div>
            <div class="flex justify-between items-center py-1.5 border-b border-border/30">
              <div><span class="font-semibold text-sm">Robinson (1983)</span></div>
              <span class="font-bold" id="iw-robinson">0</span>
            </div>
            <div class="flex justify-between items-center py-1.5 border-b border-border/30">
              <div><span class="font-semibold text-sm">Miller (1983)</span></div>
              <span class="font-bold" id="iw-miller">0</span>
            </div>
            <div class="flex justify-between items-center py-1.5 border-b border-border/30">
              <div><span class="font-semibold text-sm">Hamwi (1964)</span></div>
              <span class="font-bold" id="iw-hamwi">0</span>
            </div>
            <div class="flex justify-between items-center py-1.5">
              <div><span class="font-semibold text-sm text-primary">Healthy BMI Range</span><span class="text-xs text-text-muted ml-2">BMI 18.5-24.9</span></div>
              <span class="font-bold text-primary" id="iw-bmi-range">0</span>
            </div>
          </div>

          <!-- Current weight comparison -->
          <div class="p-4 bg-surface-alt rounded-xl hidden" id="iw-comparison">
            <h3 class="font-semibold text-sm text-text mb-2">Your Status</h3>
            <div class="text-sm text-text-secondary" id="iw-status"></div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="ideal-weight" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Ideal Weight Is Calculated</h2>
      <p>There's no single "ideal weight" — it depends on many factors. This calculator uses multiple established formulas, each developed from different research populations. The results give a range that serves as a general guideline.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Formulas Used</h3>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-2">
        <p><strong>Devine:</strong> Male: 50 + 2.3 × (inches over 60) kg | Female: 45.5 + 2.3 × (inches over 60) kg</p>
        <p><strong>Robinson:</strong> Male: 52 + 1.9 × (inches over 60) kg | Female: 49 + 1.7 × (inches over 60) kg</p>
        <p><strong>Miller:</strong> Male: 56.2 + 1.41 × (inches over 60) kg | Female: 53.1 + 1.36 × (inches over 60) kg</p>
        <p><strong>Hamwi:</strong> Male: 48 + 2.7 × (inches over 60) kg | Female: 45.5 + 2.2 × (inches over 60) kg</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Limitations</h3>
      <ul>
        <li>These formulas don't account for muscle mass, bone density, or body composition</li>
        <li>Athletes and muscular people may weigh more than "ideal" and still be very healthy</li>
        <li>The formulas were developed primarily from Caucasian populations</li>
        <li>Individual factors like genetics, age, and frame size matter</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>Which formula is most accurate?</strong> The Devine formula is most widely used in clinical settings. However, the healthy BMI range (18.5-24.9) is generally considered the best overall reference.</p>
      <p><strong>Is BMI a good measure?</strong> BMI is a useful screening tool but has limitations. It doesn't distinguish muscle from fat. Use it alongside body fat percentage for a more complete picture.</p>
      <p><strong>What if I'm outside the range?</strong> These are guidelines, not absolute targets. Focus on overall health markers: blood pressure, blood sugar, cholesterol, and how you feel.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let iwGender = 'male';
    let iwUnit = 'imperial';

    function getHeightInches(): number {
      if (iwUnit === 'imperial') {
        const ft = parseFloat((document.getElementById('iw-ft') as HTMLInputElement).value) || 0;
        const inch = parseFloat((document.getElementById('iw-in') as HTMLInputElement).value) || 0;
        return ft * 12 + inch;
      }
      return (parseFloat((document.getElementById('iw-cm') as HTMLInputElement).value) || 0) / 2.54;
    }

    function kgToDisplay(kg: number): number {
      return iwUnit === 'imperial' ? kg * 2.2046 : kg;
    }

    function fmt(kg: number): string {
      const val = kgToDisplay(kg);
      return Math.round(val) + (iwUnit === 'imperial' ? ' lbs' : ' kg');
    }

    function calcIdealWeight() {
      const inches = getHeightInches();
      const over60 = Math.max(0, inches - 60);
      const heightM = inches * 0.0254;
      const unit = iwUnit === 'imperial' ? 'lbs' : 'kg';

      let devine: number, robinson: number, miller: number, hamwi: number;

      if (iwGender === 'male') {
        devine = 50 + 2.3 * over60;
        robinson = 52 + 1.9 * over60;
        miller = 56.2 + 1.41 * over60;
        hamwi = 48 + 2.7 * over60;
      } else {
        devine = 45.5 + 2.3 * over60;
        robinson = 49 + 1.7 * over60;
        miller = 53.1 + 1.36 * over60;
        hamwi = 45.5 + 2.2 * over60;
      }

      // BMI range (18.5-24.9)
      const bmiLow = 18.5 * heightM * heightM;
      const bmiHigh = 24.9 * heightM * heightM;

      const allValues = [devine, robinson, miller, hamwi, bmiLow, bmiHigh];
      const min = Math.min(...allValues);
      const max = Math.max(...allValues);

      document.getElementById('iw-range')!.textContent = `${fmt(min)} – ${fmt(max)}`;
      document.getElementById('iw-devine')!.textContent = fmt(devine);
      document.getElementById('iw-robinson')!.textContent = fmt(robinson);
      document.getElementById('iw-miller')!.textContent = fmt(miller);
      document.getElementById('iw-hamwi')!.textContent = fmt(hamwi);
      document.getElementById('iw-bmi-range')!.textContent = `${fmt(bmiLow)} – ${fmt(bmiHigh)}`;

      // Comparison with current weight
      const currentInput = parseFloat((document.getElementById('iw-current') as HTMLInputElement).value);
      const compDiv = document.getElementById('iw-comparison')!;
      if (currentInput > 0) {
        compDiv.classList.remove('hidden');
        const currentKg = iwUnit === 'imperial' ? currentInput / 2.2046 : currentInput;
        const avg = (devine + robinson + miller + hamwi) / 4;
        const diff = currentKg - avg;
        const diffDisplay = Math.abs(Math.round(kgToDisplay(diff)));

        let status: string;
        if (Math.abs(diff) < 2) {
          status = `<span class="text-secondary font-semibold">You're at your ideal weight!</span> Your current weight is very close to the formula average.`;
        } else if (diff > 0) {
          status = `You're approximately <span class="font-semibold text-danger">${diffDisplay} ${unit} above</span> the formula average of ${fmt(avg)}. The healthy BMI range for your height is ${fmt(bmiLow)} – ${fmt(bmiHigh)}.`;
        } else {
          status = `You're approximately <span class="font-semibold text-primary">${diffDisplay} ${unit} below</span> the formula average of ${fmt(avg)}. The healthy BMI range for your height is ${fmt(bmiLow)} – ${fmt(bmiHigh)}.`;
        }
        document.getElementById('iw-status')!.innerHTML = status;
      } else {
        compDiv.classList.add('hidden');
      }

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.iw-gender-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.iw-gender-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white', 'border-primary');
            b.classList.add('bg-surface-alt', 'text-text-secondary', 'border-border');
          });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary', 'border-border');
          btn.classList.add('bg-primary', 'text-white', 'border-primary');
          iwGender = (btn as HTMLElement).dataset.gender || 'male';
          calcIdealWeight();
        });
      });

      document.querySelectorAll('.iw-unit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.iw-unit-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-surface-alt', 'text-text-secondary');
          });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary');
          btn.classList.add('bg-primary', 'text-white');
          iwUnit = (btn as HTMLElement).dataset.unit || 'imperial';
          document.getElementById('iw-h-imp')!.classList.toggle('hidden', iwUnit !== 'imperial');
          document.getElementById('iw-h-met')!.classList.toggle('hidden', iwUnit !== 'metric');
          document.getElementById('iw-weight-unit')!.textContent = iwUnit === 'imperial' ? 'lbs' : 'kg';
          calcIdealWeight();
        });
      });

      ['iw-ft', 'iw-in', 'iw-cm', 'iw-current'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcIdealWeight);
      });

      calcIdealWeight();
    }, 50);
  </script>
</CalculatorLayout>
