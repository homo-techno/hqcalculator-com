---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Distance & Bearing Calculator - GPS Point to Point";
const description = "Calculate the distance and bearing between two GPS coordinate points using the Haversine formula and forward azimuth.";
const relatedCalcs = [
  { name: "Coordinate Converter", url: "/coordinate-converter-calculator", description: "DD/DMS/UTM conversion." },
  { name: "Bearing Calculator", url: "/bearing-calculator", description: "Bearing between points." },
  { name: "Great Circle", url: "/great-circle-calculator", description: "Great circle distance." },
  { name: "GPS Accuracy", url: "/gps-accuracy-calculator", description: "GPS error estimation." },
  { name: "Map Distance", url: "/map-distance-calculator", description: "Map to ground distance." },
  { name: "Solar Azimuth", url: "/solar-azimuth-calculator", description: "Sun position for surveys." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Distance & Bearing Calculator" keywords="distance bearing calculator, GPS distance, haversine formula, forward azimuth, coordinate distance" breadcrumbs={[{ name: "Distance & Bearing Calculator", url: "/distance-bearing-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Distance & Bearing Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Enter two GPS points (latitude/longitude) to find the distance and bearing between them.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <h3 class="font-semibold text-sm text-text mb-2">Point 1</h3>
          <div class="grid grid-cols-2 gap-4">
            <div><label class="block text-xs text-text mb-1">Latitude</label><input type="number" id="dbc-lat1" class="dbc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="40.7128" step="0.0001"></div>
            <div><label class="block text-xs text-text mb-1">Longitude</label><input type="number" id="dbc-lon1" class="dbc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="-74.0060" step="0.0001"></div>
          </div>
        </div>
        <div>
          <h3 class="font-semibold text-sm text-text mb-2">Point 2</h3>
          <div class="grid grid-cols-2 gap-4">
            <div><label class="block text-xs text-text mb-1">Latitude</label><input type="number" id="dbc-lat2" class="dbc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="51.5074" step="0.0001"></div>
            <div><label class="block text-xs text-text mb-1">Longitude</label><input type="number" id="dbc-lon2" class="dbc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="-0.1278" step="0.0001"></div>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Distance</div>
          <div class="text-4xl font-extrabold font-mono" id="dbc-dist">--</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Forward Bearing</div>
            <div class="text-xl font-bold" id="dbc-bearing">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Reverse Bearing</div>
            <div class="text-xl font-bold" id="dbc-reverse">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Miles</div>
            <div class="text-xl font-bold" id="dbc-miles">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Nautical Miles</div>
            <div class="text-xl font-bold" id="dbc-nm">--</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="distance-bearing" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Haversine Formula</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm">
        <p>a = sin^2(dlat/2) + cos(lat1) * cos(lat2) * sin^2(dlon/2)</p>
        <p>c = 2 * atan2(sqrt(a), sqrt(1-a))</p>
        <p>d = R * c (R = 6371 km)</p>
      </div>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcDBC() {
      const lat1 = parseFloat((document.getElementById('dbc-lat1') as HTMLInputElement).value) || 0;
      const lon1 = parseFloat((document.getElementById('dbc-lon1') as HTMLInputElement).value) || 0;
      const lat2 = parseFloat((document.getElementById('dbc-lat2') as HTMLInputElement).value) || 0;
      const lon2 = parseFloat((document.getElementById('dbc-lon2') as HTMLInputElement).value) || 0;
      const R = 6371;
      const toRad = (d: number) => d * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      const km = R * c;
      const miles = km * 0.621371;
      const nm = km * 0.539957;
      const y = Math.sin(dLon) * Math.cos(toRad(lat2));
      const x = Math.cos(toRad(lat1)) * Math.sin(toRad(lat2)) - Math.sin(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.cos(dLon);
      let bearing = Math.atan2(y, x) * 180 / Math.PI;
      bearing = (bearing + 360) % 360;
      let reverse = (bearing + 180) % 360;
      document.getElementById('dbc-dist')!.textContent = km.toFixed(2) + ' km';
      document.getElementById('dbc-bearing')!.textContent = bearing.toFixed(2) + '\u00B0';
      document.getElementById('dbc-reverse')!.textContent = reverse.toFixed(2) + '\u00B0';
      document.getElementById('dbc-miles')!.textContent = miles.toFixed(2);
      document.getElementById('dbc-nm')!.textContent = nm.toFixed(2);
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.dbc-in').forEach(el => { el.addEventListener('input', calcDBC); el.addEventListener('change', calcDBC); });
      calcDBC();
    }, 50);
  </script>
</CalculatorLayout>
