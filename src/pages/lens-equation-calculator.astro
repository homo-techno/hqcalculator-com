---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Lens Equation Calculator";
const description = "Calculate focal length, image distance, or object distance using the thin lens equation 1/f = 1/do + 1/di.";
const relatedCalcs = [
  { name: "Wavelength", url: "/wavelength-calculator", description: "Wavelength." },
  { name: "Frequency", url: "/frequency-calculator", description: "Frequency." },
  { name: "Snell's Law", url: "/snells-law-calculator", description: "Refraction." },
  { name: "Speed Calculator", url: "/speed-calculator", description: "Speed." },
  { name: "Unit Converter", url: "/unit-converter", description: "Units." },
  { name: "Scientific Notation", url: "/scientific-notation-calculator", description: "Notation." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Lens Equation Calculator" keywords="lens equation, thin lens formula, focal length, image distance, object distance, magnification" breadcrumbs={[{ name: "Lens Equation", url: "/lens-equation-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Lens Equation Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">1/f = 1/dₒ + 1/dᵢ — solve for any variable.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="flex gap-2 flex-wrap">
          <button class="le-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 border-primary bg-blue-50 text-primary" data-mode="di">Find dᵢ</button>
          <button class="le-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-mode="do">Find dₒ</button>
          <button class="le-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-mode="f">Find f</button>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Focal Length (cm)</label><input type="number" id="le-f" class="le-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" step="0.1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Object Dist (cm)</label><input type="number" id="le-do" class="le-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="30" step="0.1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Image Dist (cm)</label><input type="number" id="le-di" class="le-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0" step="0.1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="le-label">Image Distance</div>
          <div class="text-5xl font-extrabold font-mono" id="le-result">0</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Magnification</div><div class="text-xl font-bold font-mono" id="le-mag">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Image Type</div><div class="text-xl font-bold font-mono" id="le-type">—</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Orientation</div><div class="text-xl font-bold font-mono" id="le-orient">—</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Formula</h3>
          <div class="text-xs font-mono" id="le-formula">1/f = 1/dₒ + 1/dᵢ</div>
        </div>
      </div>
      <ShareButton calculatorId="lens-equation" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    let leMode = 'di';
    function calcLE() {
      const f = parseFloat((document.getElementById('le-f') as HTMLInputElement).value) || 0;
      const dObj = parseFloat((document.getElementById('le-do') as HTMLInputElement).value) || 0;
      const dImg = parseFloat((document.getElementById('le-di') as HTMLInputElement).value) || 0;
      let result = 0, label = '';
      if (leMode === 'di') {
        result = (f !== 0 && dObj !== 0 && dObj !== f) ? (f * dObj) / (dObj - f) : 0;
        label = result.toFixed(2) + ' cm';
        document.getElementById('le-label')!.textContent = 'Image Distance (dᵢ)';
      } else if (leMode === 'do') {
        result = (f !== 0 && dImg !== 0 && dImg !== f) ? (f * dImg) / (dImg - f) : 0;
        label = result.toFixed(2) + ' cm';
        document.getElementById('le-label')!.textContent = 'Object Distance (dₒ)';
      } else {
        result = (dObj + dImg) !== 0 ? (dObj * dImg) / (dObj + dImg) : 0;
        label = result.toFixed(2) + ' cm';
        document.getElementById('le-label')!.textContent = 'Focal Length (f)';
      }
      document.getElementById('le-result')!.textContent = label;
      const useDo = leMode === 'do' ? result : dObj;
      const useDi = leMode === 'di' ? result : dImg;
      const mag = useDo !== 0 ? -useDi / useDo : 0;
      document.getElementById('le-mag')!.textContent = mag.toFixed(2) + '×';
      document.getElementById('le-type')!.textContent = useDi > 0 ? 'Real' : useDi < 0 ? 'Virtual' : '—';
      document.getElementById('le-orient')!.textContent = mag > 0 ? 'Upright' : mag < 0 ? 'Inverted' : '—';
      document.getElementById('le-formula')!.textContent = `1/${f} = 1/${useDo.toFixed(1)} + 1/${useDi.toFixed(1)}`;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.le-mode').forEach(b => b.addEventListener('click', () => {
        leMode = (b as HTMLButtonElement).dataset.mode!;
        document.querySelectorAll('.le-mode').forEach(btn => {
          const active = (btn as HTMLButtonElement).dataset.mode === leMode;
          (btn as HTMLButtonElement).className = `le-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 ${active ? 'border-primary bg-blue-50 text-primary' : 'border-border text-text-muted'}`;
        });
        calcLE();
      }));
      document.querySelectorAll('.le-in').forEach(el => { el.addEventListener('input', calcLE); el.addEventListener('change', calcLE); });
      calcLE();
    }, 50);
  </script>
</CalculatorLayout>
