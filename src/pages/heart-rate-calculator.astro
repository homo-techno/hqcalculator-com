---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Heart Rate Calculator - Target Heart Rate Zones";
const description = "Calculate your maximum heart rate and target heart rate zones for exercise. Find your optimal fat-burning, cardio, and peak zones.";

const relatedCalcs = [
  { name: "Blood Pressure", url: "/blood-pressure-calculator", description: "Blood pressure." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body Mass Index." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calories." },
  { name: "Calories Burned", url: "/calories-burned-calculator", description: "Exercise calories." },
  { name: "Pace Calculator", url: "/pace-calculator", description: "Running pace." },
  { name: "Body Fat Calculator", url: "/body-fat-calculator", description: "Body fat %." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Heart Rate Calculator"
  keywords="heart rate calculator, target heart rate, max heart rate, heart rate zones, fat burning zone, cardio zone"
  breadcrumbs={[{ name: "Heart Rate", url: "/heart-rate-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Heart Rate Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find your target heart rate zones for optimal exercise intensity.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="space-y-4 mb-6">
            <div>
              <label class="block text-sm font-medium text-text mb-1">Age</label>
              <input type="number" id="hr-age" class="w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="30" min="10" max="100" step="1">
            </div>
            <div>
              <label class="block text-sm font-medium text-text mb-1">Resting Heart Rate (optional)</label>
              <input type="number" id="hr-resting" class="w-full px-4 py-3 border border-border rounded-xl text-lg text-center" value="70" min="30" max="120" step="1" placeholder="BPM at rest">
              <p class="text-xs text-text-muted mt-1">Measure first thing in the morning. Used for Karvonen formula.</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-text mb-2">Formula</label>
              <div class="flex gap-2">
                <button class="hr-formula-btn px-3 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary" data-formula="standard">Standard (220−age)</button>
                <button class="hr-formula-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border" data-formula="tanaka">Tanaka</button>
                <button class="hr-formula-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border" data-formula="karvonen">Karvonen</button>
              </div>
            </div>
          </div>

          <!-- Quick resting HR guide -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-2">Resting Heart Rate Guide</h3>
            <div class="grid grid-cols-2 gap-1 text-xs">
              <div class="flex justify-between p-1"><span>Athlete</span><span class="font-bold">40-59 BPM</span></div>
              <div class="flex justify-between p-1"><span>Excellent</span><span class="font-bold">60-64 BPM</span></div>
              <div class="flex justify-between p-1"><span>Good</span><span class="font-bold">65-72 BPM</span></div>
              <div class="flex justify-between p-1"><span>Average</span><span class="font-bold">73-80 BPM</span></div>
              <div class="flex justify-between p-1"><span>Below Avg</span><span class="font-bold">81-90 BPM</span></div>
              <div class="flex justify-between p-1"><span>Poor</span><span class="font-bold">91+ BPM</span></div>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Max Heart Rate</div>
            <div class="text-5xl font-extrabold" id="hr-max">190</div>
            <div class="text-sm text-blue-200 mt-1">BPM</div>
          </div>

          <!-- Zones -->
          <div class="space-y-2" id="hr-zones"></div>

          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Heart Rate Reserve</div>
            <div class="text-xl font-bold" id="hr-reserve">120 BPM</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="heart-rate" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Understanding Heart Rate Zones</h2>
      <p>Training in different heart rate zones produces different benefits. Lower zones build endurance and burn fat, while higher zones improve cardiovascular fitness and speed.</p>

      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Standard:</strong> Max HR = 220 − Age</p>
        <p><strong>Tanaka:</strong> Max HR = 208 − (0.7 × Age)</p>
        <p><strong>Karvonen:</strong> Target = ((Max HR − Resting HR) × %) + Resting HR</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What zone burns the most fat?</strong> Zone 2 (60-70% MHR) uses the highest percentage of fat for fuel. However, higher intensity zones burn more total calories.</p>
      <p><strong>Is it safe to exercise in Zone 5?</strong> Zone 5 should only be used for short intervals by healthy, fit individuals. Always consult a doctor before starting high-intensity exercise.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let hrFormula = 'standard';

    const zones = [
      { name: 'Zone 1 — Warm-Up', min: 50, max: 60, color: '#94a3b8', desc: 'Very light, recovery' },
      { name: 'Zone 2 — Fat Burn', min: 60, max: 70, color: '#22c55e', desc: 'Light, fat burning' },
      { name: 'Zone 3 — Cardio', min: 70, max: 80, color: '#3b82f6', desc: 'Moderate, aerobic' },
      { name: 'Zone 4 — Hard', min: 80, max: 90, color: '#f97316', desc: 'Vigorous, anaerobic' },
      { name: 'Zone 5 — Max', min: 90, max: 100, color: '#ef4444', desc: 'Maximum effort' },
    ];

    function calcHR() {
      const age = parseInt((document.getElementById('hr-age') as HTMLInputElement).value) || 30;
      const resting = parseInt((document.getElementById('hr-resting') as HTMLInputElement).value) || 70;

      let maxHR: number;
      if (hrFormula === 'tanaka') {
        maxHR = Math.round(208 - 0.7 * age);
      } else {
        maxHR = 220 - age;
      }

      const reserve = maxHR - resting;
      const useKarvonen = hrFormula === 'karvonen';

      document.getElementById('hr-max')!.textContent = String(maxHR);
      document.getElementById('hr-reserve')!.textContent = reserve + ' BPM';

      document.getElementById('hr-zones')!.innerHTML = zones.map(z => {
        let low: number, high: number;
        if (useKarvonen) {
          low = Math.round(reserve * z.min / 100 + resting);
          high = Math.round(reserve * z.max / 100 + resting);
        } else {
          low = Math.round(maxHR * z.min / 100);
          high = Math.round(maxHR * z.max / 100);
        }
        return `<div class="p-3 rounded-xl border-l-4" style="border-color: ${z.color}; background: ${z.color}11;">
          <div class="flex justify-between items-center">
            <div>
              <div class="font-semibold text-sm">${z.name}</div>
              <div class="text-xs text-text-muted">${z.desc} (${z.min}-${z.max}%)</div>
            </div>
            <div class="text-right">
              <div class="text-xl font-bold">${low}–${high}</div>
              <div class="text-xs text-text-muted">BPM</div>
            </div>
          </div>
          <div class="mt-2 h-2 bg-white/50 rounded-full overflow-hidden">
            <div class="h-full rounded-full" style="width: ${z.max}%; background: ${z.color};"></div>
          </div>
        </div>`;
      }).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      ['hr-age', 'hr-resting'].forEach(id => {
        document.getElementById(id)!.addEventListener('input', calcHR);
      });

      document.querySelectorAll('.hr-formula-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.hr-formula-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          hrFormula = (btn as HTMLElement).dataset.formula || 'standard';
          calcHR();
        });
      });

      calcHR();
    }, 50);
  </script>
</CalculatorLayout>
