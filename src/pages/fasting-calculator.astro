---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Fasting Calculator - Intermittent Fasting Timer";
const description = "Calculate intermittent fasting windows for 16:8, 18:6, 20:4, and OMAD protocols. Track fasting stages and timing.";
const relatedCalcs = [
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calorie needs." },
  { name: "Caloric Deficit Calculator", url: "/caloric-deficit-calculator", description: "Weight loss planning." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body mass index." },
  { name: "Macro Calculator", url: "/macro-calculator", description: "Macronutrients." },
  { name: "Hydration Calculator", url: "/hydration-calculator", description: "Water needs." },
  { name: "Metabolic Age Calculator", url: "/metabolic-age-calculator", description: "Metabolic age." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Fasting Calculator" keywords="intermittent fasting, 16:8, 18:6, 20:4, OMAD, fasting timer, eating window" breadcrumbs={[{ name: "Fasting Calculator", url: "/fasting-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Fasting Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Plan your intermittent fasting schedule and track fasting stages.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Fasting Protocol</label>
          <select id="fa-proto" class="fa-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="16" selected>16:8 (16h fast, 8h eat)</option>
            <option value="18">18:6 (18h fast, 6h eat)</option>
            <option value="20">20:4 (20h fast, 4h eat)</option>
            <option value="23">OMAD (23h fast, 1h eat)</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Fast Start Time</label><input type="time" id="fa-start" class="fa-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20:00"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Fasting Hours</label><input type="number" id="fa-hours" class="fa-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="16" min="1" max="72" step="1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Eating Window Opens</div>
          <div class="text-5xl font-extrabold font-mono" id="fa-end">--:--</div>
          <div class="text-sm text-blue-200 mt-1" id="fa-window"></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Eating Window</div><div class="text-xl font-bold" id="fa-eat">8h</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Fast Ends At</div><div class="text-xl font-bold" id="fa-endtime">--:--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Eat Window Closes</div><div class="text-xl font-bold" id="fa-close">--:--</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Fasting Stages</h3>
          <div class="space-y-2 text-sm" id="fa-stages"></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Protocol Comparison</h3>
          <div class="grid grid-cols-2 gap-2 text-sm">
            <div class="flex justify-between"><span>16:8</span><span class="font-bold">Beginner friendly</span></div>
            <div class="flex justify-between"><span>18:6</span><span class="font-bold">Moderate</span></div>
            <div class="flex justify-between"><span>20:4</span><span class="font-bold">Advanced</span></div>
            <div class="flex justify-between"><span>OMAD</span><span class="font-bold">Expert level</span></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="fasting" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Intermittent Fasting</h2>
      <p>Intermittent fasting alternates periods of eating with periods of fasting. During fasting, your body shifts from using glucose to burning stored fat. Key metabolic stages include blood sugar stabilization (4-8h), fat burning (12-14h), ketosis (16-18h), and autophagy (24h+). Always consult a healthcare provider before starting a fasting regimen.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function fmtTime(h: number, m: number): string {
      const hh = h % 24;
      const ampm = hh >= 12 ? 'PM' : 'AM';
      const h12 = hh === 0 ? 12 : hh > 12 ? hh - 12 : hh;
      return h12 + ':' + String(m).padStart(2, '0') + ' ' + ampm;
    }
    function setProto() {
      const proto = (document.getElementById('fa-proto') as HTMLSelectElement).value;
      if (proto !== 'custom') {
        (document.getElementById('fa-hours') as HTMLInputElement).value = proto;
      }
      calcFast();
    }
    function calcFast() {
      const startStr = (document.getElementById('fa-start') as HTMLInputElement).value;
      const fastHours = parseInt((document.getElementById('fa-hours') as HTMLInputElement).value) || 16;
      const parts = startStr.split(':');
      const startH = parseInt(parts[0]) || 0;
      const startM = parseInt(parts[1]) || 0;
      const eatHours = 24 - fastHours;
      const endH = (startH + fastHours) % 24;
      const closeH = (endH + eatHours) % 24;
      document.getElementById('fa-end')!.textContent = fmtTime(endH, startM);
      document.getElementById('fa-window')!.textContent = fmtTime(endH, startM) + ' - ' + fmtTime(closeH, startM);
      document.getElementById('fa-eat')!.textContent = eatHours + 'h';
      document.getElementById('fa-endtime')!.textContent = fmtTime(endH, startM);
      document.getElementById('fa-close')!.textContent = fmtTime(closeH, startM);
      const stages = [
        { hour: 0, name: 'Fed state', desc: 'Blood sugar rises, insulin released' },
        { hour: 4, name: 'Post-absorptive', desc: 'Blood sugar begins to fall' },
        { hour: 12, name: 'Fat burning', desc: 'Glycogen depleting, fat oxidation increases' },
        { hour: 16, name: 'Early ketosis', desc: 'Ketone production begins' },
        { hour: 18, name: 'Ketosis', desc: 'Fat is primary fuel source' },
        { hour: 24, name: 'Autophagy', desc: 'Cellular recycling and repair' },
        { hour: 48, name: 'Deep autophagy', desc: 'Enhanced cellular cleaning' },
      ];
      let html = '';
      for (const s of stages) {
        if (s.hour <= fastHours) {
          const active = s.hour <= fastHours ? 'font-bold text-primary' : 'text-text-muted';
          html += '<div class="flex justify-between ' + active + '"><span>' + s.hour + 'h - ' + s.name + '</span><span>' + s.desc + '</span></div>';
        }
      }
      document.getElementById('fa-stages')!.innerHTML = html;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.getElementById('fa-proto')!.addEventListener('change', setProto);
      document.querySelectorAll('.fa-in').forEach(el => { el.addEventListener('input', calcFast); el.addEventListener('change', calcFast); });
      calcFast();
    }, 50);
  </script>
</CalculatorLayout>
