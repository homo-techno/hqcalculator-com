---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Square Footage Calculator - Area & Room Size Calculator";
const description = "Calculate square footage for rooms, homes, and land. Supports rectangular, circular, triangular, and irregular shapes. Area conversion included.";

const relatedCalcs = [
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume." },
  { name: "Length Converter", url: "/length-converter", description: "Length units." },
  { name: "Mortgage Calculator", url: "/mortgage-calculator", description: "Home loans." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Energy costs." },
  { name: "Loan Calculator", url: "/loan-calculator", description: "Loan payments." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Square Footage Calculator"
  keywords="square footage calculator, area calculator, room size calculator, sq ft calculator, square feet, floor area"
  breadcrumbs={[{ name: "Square Footage", url: "/square-footage-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Square Footage Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate area in square feet for any shape. Add multiple rooms to get total square footage.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <!-- Shape selector -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Shape</label>
            <div class="flex gap-2 flex-wrap">
              <button class="sf-shape-btn px-4 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary" data-shape="rect">Rectangle</button>
              <button class="sf-shape-btn px-4 py-2 rounded-xl text-sm font-semibold border border-border" data-shape="circle">Circle</button>
              <button class="sf-shape-btn px-4 py-2 rounded-xl text-sm font-semibold border border-border" data-shape="triangle">Triangle</button>
              <button class="sf-shape-btn px-4 py-2 rounded-xl text-sm font-semibold border border-border" data-shape="trapezoid">Trapezoid</button>
            </div>
          </div>

          <!-- Unit selector -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Input Units</label>
            <div class="flex gap-2">
              <button class="sf-unit-btn px-3 py-2 rounded-lg text-sm font-semibold bg-primary text-white" data-unit="ft">Feet</button>
              <button class="sf-unit-btn px-3 py-2 rounded-lg text-sm font-semibold bg-surface-alt text-text-secondary" data-unit="in">Inches</button>
              <button class="sf-unit-btn px-3 py-2 rounded-lg text-sm font-semibold bg-surface-alt text-text-secondary" data-unit="m">Meters</button>
              <button class="sf-unit-btn px-3 py-2 rounded-lg text-sm font-semibold bg-surface-alt text-text-secondary" data-unit="yd">Yards</button>
            </div>
          </div>

          <!-- Rectangle inputs -->
          <div id="sf-rect" class="mb-5">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Length</label>
                <input type="number" id="sf-length" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="20" min="0" step="0.1">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Width</label>
                <input type="number" id="sf-width" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="15" min="0" step="0.1">
              </div>
            </div>
          </div>

          <!-- Circle inputs -->
          <div id="sf-circle" class="mb-5 hidden">
            <label class="block text-xs font-medium text-text mb-1">Radius</label>
            <input type="number" id="sf-radius" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="10" min="0" step="0.1">
          </div>

          <!-- Triangle inputs -->
          <div id="sf-triangle" class="mb-5 hidden">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Base</label>
                <input type="number" id="sf-base" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="20" min="0" step="0.1">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Height</label>
                <input type="number" id="sf-height" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="12" min="0" step="0.1">
              </div>
            </div>
          </div>

          <!-- Trapezoid inputs -->
          <div id="sf-trapezoid" class="mb-5 hidden">
            <div class="grid grid-cols-3 gap-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Side A</label>
                <input type="number" id="sf-sideA" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="20" min="0" step="0.1">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Side B</label>
                <input type="number" id="sf-sideB" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="10" min="0" step="0.1">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Height</label>
                <input type="number" id="sf-trapH" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="8" min="0" step="0.1">
              </div>
            </div>
          </div>

          <!-- Multi-room -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-2">Room List</h3>
            <div id="sf-rooms" class="space-y-1 text-sm mb-3"></div>
            <button id="sf-add-room" class="px-4 py-2 border border-border rounded-xl text-sm font-semibold hover:bg-white">+ Add Current Area as Room</button>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Area</div>
            <div class="text-4xl sm:text-5xl font-extrabold" id="sf-total">300 sq ft</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Square Feet</div>
              <div class="text-xl font-bold" id="sf-sqft">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Square Meters</div>
              <div class="text-xl font-bold" id="sf-sqm">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Square Yards</div>
              <div class="text-xl font-bold" id="sf-sqyd">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Acres</div>
              <div class="text-xl font-bold" id="sf-acres">0</div>
            </div>
          </div>

          <!-- Cost estimator -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-2">Cost Estimator</h3>
            <div class="flex gap-2 mb-3">
              <div class="relative flex-1">
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
                <input type="number" id="sf-cost" class="w-full pl-7 pr-3 py-2 border border-border rounded-lg" value="5" min="0" step="0.01">
              </div>
              <span class="self-center text-text-muted text-sm">per sq ft</span>
            </div>
            <div class="text-2xl font-bold text-secondary text-center" id="sf-total-cost">$0</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="square-footage" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Square Footage</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Rectangle:</strong> Area = Length × Width</p>
        <p><strong>Circle:</strong> Area = π × Radius²</p>
        <p><strong>Triangle:</strong> Area = ½ × Base × Height</p>
        <p><strong>Trapezoid:</strong> Area = ½ × (Side A + Side B) × Height</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Area Unit Conversions</h3>
      <ul>
        <li>1 sq ft = 0.0929 sq m = 144 sq inches</li>
        <li>1 sq m = 10.764 sq ft</li>
        <li>1 sq yd = 9 sq ft</li>
        <li>1 acre = 43,560 sq ft</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How do I measure an irregular room?</strong> Break it into rectangles and triangles, calculate each area separately, then add them together.</p>
      <p><strong>What is the average home size?</strong> The average new US home is about 2,300 sq ft. Apartments average 900-1,000 sq ft.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let sfShape = 'rect';
    let sfUnit = 'ft';
    const rooms: { name: string; sqft: number }[] = [];

    // Conversion to feet
    const toFeet: Record<string, number> = { ft: 1, in: 1/12, m: 3.28084, yd: 3 };

    function getV(id: string): number {
      return (parseFloat((document.getElementById(id) as HTMLInputElement).value) || 0) * toFeet[sfUnit];
    }

    function calcArea(): number {
      if (sfShape === 'rect') return getV('sf-length') * getV('sf-width');
      if (sfShape === 'circle') return Math.PI * getV('sf-radius') ** 2;
      if (sfShape === 'triangle') return 0.5 * getV('sf-base') * getV('sf-height');
      if (sfShape === 'trapezoid') return 0.5 * (getV('sf-sideA') + getV('sf-sideB')) * getV('sf-trapH');
      return 0;
    }

    function updateResults() {
      const currentSqft = calcArea();
      const roomTotal = rooms.reduce((sum, r) => sum + r.sqft, 0);
      const totalSqft = currentSqft + roomTotal;

      const fmt = (n: number) => n.toLocaleString('en-US', { maximumFractionDigits: 2 });

      document.getElementById('sf-total')!.textContent = fmt(totalSqft) + ' sq ft';
      document.getElementById('sf-sqft')!.textContent = fmt(totalSqft);
      document.getElementById('sf-sqm')!.textContent = fmt(totalSqft * 0.0929);
      document.getElementById('sf-sqyd')!.textContent = fmt(totalSqft / 9);
      document.getElementById('sf-acres')!.textContent = (totalSqft / 43560).toFixed(4);

      const cost = parseFloat((document.getElementById('sf-cost') as HTMLInputElement).value) || 0;
      document.getElementById('sf-total-cost')!.textContent = '$' + Math.round(totalSqft * cost).toLocaleString();

      // Room list
      document.getElementById('sf-rooms')!.innerHTML = rooms.length === 0
        ? '<div class="text-text-muted">No rooms added yet</div>'
        : rooms.map((r, i) => `<div class="flex justify-between items-center py-1">
            <span>${r.name}: ${fmt(r.sqft)} sq ft</span>
            <button class="sf-rm text-danger text-xs hover:underline" data-idx="${i}">Remove</button>
          </div>`).join('');

      document.querySelectorAll('.sf-rm').forEach(btn => {
        btn.addEventListener('click', () => {
          rooms.splice(parseInt((btn as HTMLElement).dataset.idx || '0'), 1);
          updateResults();
        });
      });

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.sf-shape-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.sf-shape-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          sfShape = (btn as HTMLElement).dataset.shape || 'rect';
          ['rect', 'circle', 'triangle', 'trapezoid'].forEach(s => document.getElementById(`sf-${s}`)!.classList.toggle('hidden', s !== sfShape));
          updateResults();
        });
      });

      document.querySelectorAll('.sf-unit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.sf-unit-btn').forEach(b => { b.classList.remove('bg-primary', 'text-white'); b.classList.add('bg-surface-alt', 'text-text-secondary'); });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary'); btn.classList.add('bg-primary', 'text-white');
          sfUnit = (btn as HTMLElement).dataset.unit || 'ft';
          updateResults();
        });
      });

      ['sf-length', 'sf-width', 'sf-radius', 'sf-base', 'sf-height', 'sf-sideA', 'sf-sideB', 'sf-trapH', 'sf-cost'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', updateResults);
      });

      document.getElementById('sf-add-room')!.addEventListener('click', () => {
        const sqft = calcArea();
        if (sqft > 0) {
          rooms.push({ name: `Room ${rooms.length + 1}`, sqft });
          updateResults();
        }
      });

      updateResults();
    }, 50);
  </script>
</CalculatorLayout>
