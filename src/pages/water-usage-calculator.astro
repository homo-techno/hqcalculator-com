---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Water Usage Calculator - Daily Water Consumption & Cost 2026";
const description = "Calculate your daily and monthly water usage from showers, toilets, laundry, and dishwashing. See costs and compare with conservation tips.";

const relatedCalcs = [
  { name: "Electricity Usage Calculator", url: "/electricity-usage-calculator", description: "Appliance electricity cost." },
  { name: "Electricity Bill Calculator", url: "/electricity-bill-calculator", description: "Monthly electricity bill." },
  { name: "Paper Calculator", url: "/paper-calculator", description: "Paper usage and savings." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Monthly budget planner." },
  { name: "Noise Reduction Calculator", url: "/noise-reduction-calculator", description: "Noise reduction estimates." },
  { name: "Screen Time Calculator", url: "/screen-time-calculator", description: "Track screen time." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Water Usage Calculator"
  keywords="water usage calculator, water consumption, water cost, water bill, conservation, daily water use, gallons per day"
  breadcrumbs={[{ name: "Water Usage Calculator", url: "/water-usage-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Water Usage Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Track your household water consumption and see where you can conserve.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <h3 class="text-lg font-bold text-text">Daily Habits</h3>
        <div>
          <label for="wu-showers" class="block text-sm font-medium text-text mb-1">Showers Per Day</label>
          <input type="number" id="wu-showers" class="wu-in w-full border border-border rounded-lg px-3 py-2" value="2" min="0" step="1" />
        </div>
        <div>
          <label for="wu-shower-min" class="block text-sm font-medium text-text mb-1">Avg. Shower Length (minutes)</label>
          <input type="number" id="wu-shower-min" class="wu-in w-full border border-border rounded-lg px-3 py-2" value="8" min="0" max="60" step="1" />
        </div>
        <div>
          <label for="wu-showerhead" class="block text-sm font-medium text-text mb-1">Showerhead Flow Rate</label>
          <select id="wu-showerhead" class="wu-in w-full border border-border rounded-lg px-3 py-2">
            <option value="2.5">Standard (2.5 gal/min)</option>
            <option value="2.0">Low-flow (2.0 gal/min)</option>
            <option value="1.5">Ultra low-flow (1.5 gal/min)</option>
          </select>
        </div>
        <div>
          <label for="wu-flushes" class="block text-sm font-medium text-text mb-1">Toilet Flushes Per Day</label>
          <input type="number" id="wu-flushes" class="wu-in w-full border border-border rounded-lg px-3 py-2" value="6" min="0" step="1" />
        </div>
        <div>
          <label for="wu-toilet" class="block text-sm font-medium text-text mb-1">Toilet Type</label>
          <select id="wu-toilet" class="wu-in w-full border border-border rounded-lg px-3 py-2">
            <option value="1.6">Standard (1.6 gal/flush)</option>
            <option value="1.28">High-efficiency (1.28 gal/flush)</option>
            <option value="0.8">Dual-flush low (0.8 gal/flush)</option>
            <option value="3.5">Older model (3.5 gal/flush)</option>
          </select>
        </div>

        <h3 class="text-lg font-bold text-text">Weekly Habits</h3>
        <div>
          <label for="wu-dishwasher" class="block text-sm font-medium text-text mb-1">Dishwasher Loads Per Week</label>
          <input type="number" id="wu-dishwasher" class="wu-in w-full border border-border rounded-lg px-3 py-2" value="4" min="0" step="1" />
        </div>
        <div>
          <label for="wu-laundry" class="block text-sm font-medium text-text mb-1">Laundry Loads Per Week</label>
          <input type="number" id="wu-laundry" class="wu-in w-full border border-border rounded-lg px-3 py-2" value="3" min="0" step="1" />
        </div>
        <div>
          <label for="wu-rate" class="block text-sm font-medium text-text mb-1">Water Rate ($/1,000 gallons)</label>
          <input type="number" id="wu-rate" class="wu-in w-full border border-border rounded-lg px-3 py-2" value="5.00" min="0" step="0.50" />
          <p class="text-xs text-text-muted mt-1">US average: ~$5 per 1,000 gallons</p>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Daily Water Usage</div>
          <div class="text-5xl font-extrabold font-mono" id="wu-result">0 gal</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Monthly Usage</div>
            <div class="text-xl font-bold" id="wu-monthly">0 gal</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Monthly Cost</div>
            <div class="text-xl font-bold" id="wu-cost">$0.00</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Annual Usage</div>
            <div class="text-xl font-bold" id="wu-annual-gal">0 gal</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Annual Cost</div>
            <div class="text-xl font-bold" id="wu-annual-cost">$0.00</div>
          </div>
        </div>

        <!-- Conservation comparison -->
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="text-sm font-bold text-text mb-2">Conservation Savings (if you switched to efficient fixtures)</h3>
          <div class="text-sm text-text-secondary space-y-1" id="wu-tips"></div>
        </div>
      </div>

      <ShareButton calculatorId="water-usage" />
      <FeedbackWidget />
    </div>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcWU() {
      const showers = parseInt((document.getElementById('wu-showers') as HTMLInputElement).value) || 0;
      const showerMin = parseFloat((document.getElementById('wu-shower-min') as HTMLInputElement).value) || 0;
      const showerFlow = parseFloat((document.getElementById('wu-showerhead') as HTMLSelectElement).value) || 2.5;
      const flushes = parseInt((document.getElementById('wu-flushes') as HTMLInputElement).value) || 0;
      const toiletGPF = parseFloat((document.getElementById('wu-toilet') as HTMLSelectElement).value) || 1.6;
      const dishwasherWeek = parseInt((document.getElementById('wu-dishwasher') as HTMLInputElement).value) || 0;
      const laundryWeek = parseInt((document.getElementById('wu-laundry') as HTMLInputElement).value) || 0;
      const rate = parseFloat((document.getElementById('wu-rate') as HTMLInputElement).value) || 0;

      // Daily calculations
      const showerGal = showers * showerMin * showerFlow;
      const toiletGal = flushes * toiletGPF;
      const dishwasherGalDay = (dishwasherWeek * 6) / 7; // 6 gal per load
      const laundryGalDay = (laundryWeek * 20) / 7; // 20 gal per load

      const dailyTotal = showerGal + toiletGal + dishwasherGalDay + laundryGalDay;
      const monthlyTotal = dailyTotal * 30.44;
      const annualTotal = dailyTotal * 365;
      const monthlyCost = (monthlyTotal / 1000) * rate;
      const annualCost = (annualTotal / 1000) * rate;

      // Conservation: low-flow shower 1.5, HE toilet 1.28
      const conserveShower = showers * showerMin * 1.5;
      const conserveToilet = flushes * 1.28;
      const conserveDaily = conserveShower + conserveToilet + dishwasherGalDay + laundryGalDay;
      const savingsGal = dailyTotal - conserveDaily;
      const savingsCost = ((savingsGal * 365) / 1000) * rate;

      const fmtG = (n: number) => Math.round(n).toLocaleString('en-US') + ' gal';

      (document.getElementById('wu-result') as HTMLElement).textContent = fmtG(dailyTotal);
      (document.getElementById('wu-monthly') as HTMLElement).textContent = fmtG(monthlyTotal);
      (document.getElementById('wu-cost') as HTMLElement).textContent = '$' + monthlyCost.toFixed(2);
      (document.getElementById('wu-annual-gal') as HTMLElement).textContent = fmtG(annualTotal);
      (document.getElementById('wu-annual-cost') as HTMLElement).textContent = '$' + annualCost.toFixed(2);

      const tips: string[] = [];
      if (showerFlow > 1.5) {
        tips.push(`Low-flow showerhead (1.5 gpm): save ${Math.round(showers * showerMin * (showerFlow - 1.5))} gal/day`);
      }
      if (toiletGPF > 1.28) {
        tips.push(`HE toilet (1.28 gpf): save ${Math.round(flushes * (toiletGPF - 1.28))} gal/day`);
      }
      tips.push(`With all efficient fixtures: save ~${Math.round(savingsGal)} gal/day ($${savingsCost.toFixed(0)}/year)`);
      tips.push('Shorter showers: each minute less saves ~2.5 gallons.');

      (document.getElementById('wu-tips') as HTMLElement).innerHTML = tips.map(t => `<p>-- ${t}</p>`).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.wu-in').forEach(el => {
        el.addEventListener('input', calcWU);
        el.addEventListener('change', calcWU);
      });
      calcWU();
    }, 50);
  </script>
</CalculatorLayout>
