---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Soldering Calculator - Solder Wire, Flux & Temperature";
const description = "Calculate solder wire consumption, flux needs, and tip temperature for electronic and plumbing soldering. Covers leaded, lead-free, and silver solder.";

const relatedCalcs = [
  { name: "Welding Rod Calculator", url: "/welding-rod-calculator", description: "Electrode consumption." },
  { name: "Welding Cost Calculator", url: "/welding-cost-calculator", description: "Welding job costs." },
  { name: "Metal Weight Calculator", url: "/metal-weight-calculator", description: "Metal weight." },
  { name: "Metal Expansion Calculator", url: "/metal-expansion-calculator", description: "Thermal expansion." },
  { name: "Welding Gas Calculator", url: "/welding-gas-calculator", description: "Shielding gas." },
  { name: "Drill Bit Calculator", url: "/drill-bit-calculator", description: "Drill sizes." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Soldering Calculator"
  keywords="soldering calculator, solder wire, flux, tip temperature, solder consumption, lead-free solder, silver solder, soldering iron"
  breadcrumbs={[{ name: "Soldering Calculator", url: "/soldering-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Soldering Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate solder wire consumption, flux needs, and recommended tip temperature for your soldering project.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Application Type -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Application</label>
        <select id="sol-app" class="sol-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="electronics">Electronics / PCB</option>
          <option value="plumbing">Plumbing (Pipe Joints)</option>
          <option value="jewelry">Jewelry / Silver Soldering</option>
          <option value="stained_glass">Stained Glass / Copper Foil</option>
        </select>
      </div>

      <!-- Solder Type -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Solder Alloy</label>
        <select id="sol-alloy" class="sol-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="sn63pb37">63/37 Sn-Pb (Eutectic, Leaded)</option>
          <option value="sn60pb40">60/40 Sn-Pb (Leaded)</option>
          <option value="sac305">SAC305 Sn-Ag-Cu (Lead-Free)</option>
          <option value="sn99ag1">Sn99/Ag0.3/Cu0.7 (Lead-Free)</option>
          <option value="silver5">5% Silver Solder</option>
          <option value="silver45">45% Silver Brazing</option>
          <option value="tin50lead50">50/50 Sn-Pb (Plumbing)</option>
        </select>
      </div>

      <!-- Wire Diameter -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Solder Wire Diameter</label>
        <select id="sol-dia" class="sol-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="0.5">0.5 mm (0.020") - Fine Electronics</option>
          <option value="0.8" selected>0.8 mm (0.031") - Standard Electronics</option>
          <option value="1.0">1.0 mm (0.040") - General Purpose</option>
          <option value="1.5">1.5 mm (0.060") - Larger Joints</option>
          <option value="2.0">2.0 mm (0.080") - Plumbing/Heavy</option>
          <option value="3.0">3.0 mm (0.125") - Plumbing</option>
        </select>
      </div>

      <!-- Number of Joints -->
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Number of Joints</label>
          <input type="number" id="sol-joints" class="sol-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="100" min="1" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Joint Type</label>
          <select id="sol-jtype" class="sol-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="smd">SMD Pad (tiny)</option>
            <option value="thru" selected>Through-Hole Pin</option>
            <option value="wire">Wire-to-Wire</option>
            <option value="connector">Connector Pin</option>
            <option value="pipe_half">Pipe 1/2" (plumbing)</option>
            <option value="pipe_three4">Pipe 3/4" (plumbing)</option>
            <option value="pipe_1">Pipe 1" (plumbing)</option>
          </select>
        </div>
      </div>

      <!-- Solder Cost -->
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Solder Cost ($/lb)</label>
          <input type="number" id="sol-cost" class="sol-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="25" min="0" step="5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Waste Factor (%)</label>
          <input type="number" id="sol-waste" class="sol-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="15" min="0" max="50" step="5">
        </div>
      </div>

      <!-- Results -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Solder Wire Needed</div>
        <div class="text-4xl font-extrabold" id="sol-amount">--</div>
        <div class="text-sm text-blue-200 mt-1">grams (with waste)</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Wire Length Needed</div>
          <div class="text-xl font-bold" id="sol-wirelen">--</div>
          <div class="text-xs text-text-muted">meters</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Estimated Cost</div>
          <div class="text-xl font-bold text-secondary" id="sol-totalcost">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Recommended Tip Temp</div>
          <div class="text-xl font-bold" id="sol-temp">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Melting Point</div>
          <div class="text-xl font-bold" id="sol-melt">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Flux Type</div>
          <div class="text-xl font-bold" id="sol-flux">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Solder per Joint</div>
          <div class="text-xl font-bold" id="sol-perjoint">--</div>
          <div class="text-xs text-text-muted">grams</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <div class="text-xs text-text-muted uppercase mb-2">Tips</div>
        <div class="text-sm" id="sol-tips">--</div>
      </div>

      <ShareButton calculatorId="soldering" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Soldering Reference Guide</h2>
      <h3 class="text-xl font-semibold text-text mt-8">Solder Alloy Comparison</h3>
      <ul>
        <li><strong>63/37 (Eutectic):</strong> Melts at 183C (361F). Sharp melting point, shiny joints. Industry standard for electronics.</li>
        <li><strong>SAC305 (Lead-Free):</strong> Melts at 217-220C (423-428F). RoHS compliant. Slightly higher tip temps needed.</li>
        <li><strong>Silver Solder:</strong> Much higher melting point (600-750C). Used for jewelry, HVAC, and high-strength joints.</li>
      </ul>
      <h3 class="text-xl font-semibold text-text mt-8">Flux Types</h3>
      <ul>
        <li><strong>Rosin (R/RMA):</strong> Mild, non-corrosive. Standard for electronics. No cleaning needed for RMA.</li>
        <li><strong>Water-Soluble (OA):</strong> More active. Must be cleaned after soldering. Good for oxidized surfaces.</li>
        <li><strong>No-Clean:</strong> Leaves benign residue. Most popular for production electronics.</li>
        <li><strong>Acid Flux:</strong> For plumbing and sheet metal. Never use on electronics.</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcSOL() {
      const app = (document.getElementById('sol-app') as HTMLSelectElement).value;
      const alloy = (document.getElementById('sol-alloy') as HTMLSelectElement).value;
      const dia = parseFloat((document.getElementById('sol-dia') as HTMLSelectElement).value) || 0.8;
      const joints = parseFloat((document.getElementById('sol-joints') as HTMLInputElement).value) || 0;
      const jtype = (document.getElementById('sol-jtype') as HTMLSelectElement).value;
      const costPerLb = parseFloat((document.getElementById('sol-cost') as HTMLInputElement).value) || 25;
      const wastePct = (parseFloat((document.getElementById('sol-waste') as HTMLInputElement).value) || 15) / 100;

      // Solder per joint in grams based on joint type
      const solderPerJoint: Record<string, number> = {
        smd: 0.005,
        thru: 0.03,
        wire: 0.08,
        connector: 0.05,
        pipe_half: 2.5,
        pipe_three4: 4.0,
        pipe_1: 6.0
      };
      const perJoint = solderPerJoint[jtype] || 0.03;

      // Total solder needed
      const totalGrams = perJoint * joints * (1 + wastePct);
      const totalLbs = totalGrams / 453.592;
      const totalCost = totalLbs * costPerLb;

      // Wire density (g/cm³) and length calculation
      let density = 8.5; // Sn-Pb
      if (alloy === 'sac305' || alloy === 'sn99ag1') density = 7.4;
      else if (alloy === 'silver5' || alloy === 'silver45') density = 9.0;
      else if (alloy === 'tin50lead50') density = 8.9;

      const wireArea = Math.PI * (dia / 20) ** 2; // cm² (dia is mm, /10 for cm, /2 for radius)
      const wireVolPerCm = wireArea; // cm³/cm
      const wireGramPerCm = wireVolPerCm * density;
      const wireLenCm = totalGrams / wireGramPerCm;
      const wireLenM = wireLenCm / 100;

      // Melting point and recommended temp
      interface AlloyInfo { meltC: number; tipC: number; flux: string; tips: string; }
      const alloyInfo: Record<string, AlloyInfo> = {
        sn63pb37: {meltC:183, tipC:315, flux:'Rosin (RMA) or No-Clean', tips:'Eutectic alloy with sharp melting point. Makes bright, shiny joints. Wet the pad before adding solder.'},
        sn60pb40: {meltC:188, tipC:320, flux:'Rosin (RMA) or No-Clean', tips:'Slightly pasty range. Good for hand soldering. Keep tip clean and tinned.'},
        sac305: {meltC:220, tipC:370, flux:'No-Clean or Water-Soluble', tips:'Lead-free: needs higher temperature. Joints appear matte/grainy (this is normal). Use active flux.'},
        sn99ag1: {meltC:217, tipC:365, flux:'No-Clean or Water-Soluble', tips:'Lead-free alternative. Slightly better wetting than SAC305. Reduce dwell time to prevent pad lifting.'},
        silver5: {meltC:650, tipC:700, flux:'Silver Brazing Flux (paste)', tips:'Use a torch, not an iron. Apply flux generously. Heat the joint, not the solder. Silver solder flows toward heat.'},
        silver45: {meltC:620, tipC:680, flux:'Silver Brazing Flux (paste)', tips:'High silver content flows easily. Used for HVAC, jewelry. Requires torch and proper ventilation.'},
        tin50lead50: {meltC:215, tipC:350, flux:'Acid Flux (plumbing)', tips:'Wide pasty range allows wiping for plumbing joints. Clean pipe and fitting with emery cloth first.'}
      };

      const info = alloyInfo[alloy] || alloyInfo.sn63pb37;
      const meltF = Math.round(info.meltC * 9 / 5 + 32);
      const tipF = Math.round(info.tipC * 9 / 5 + 32);

      document.getElementById('sol-amount')!.textContent = totalGrams.toFixed(1);
      document.getElementById('sol-wirelen')!.textContent = wireLenM.toFixed(1);
      document.getElementById('sol-totalcost')!.textContent = '$' + totalCost.toFixed(2);
      document.getElementById('sol-temp')!.textContent = info.tipC + '\u00B0C (' + tipF + '\u00B0F)';
      document.getElementById('sol-melt')!.textContent = info.meltC + '\u00B0C (' + meltF + '\u00B0F)';
      document.getElementById('sol-flux')!.textContent = info.flux;
      document.getElementById('sol-perjoint')!.textContent = perJoint.toFixed(3);
      document.getElementById('sol-tips')!.textContent = info.tips;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.sol-in').forEach(el => {
        el.addEventListener('input', calcSOL);
        el.addEventListener('change', calcSOL);
      });
      calcSOL();
    }, 50);
  </script>
</CalculatorLayout>
