---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Telescope Magnification Calculator";
const description = "Calculate telescope magnification, field of view, exit pupil, limiting magnitude, and resolving power from focal lengths.";
const relatedCalcs = [
  { name: "Lens Equation", url: "/lens-equation-calculator", description: "Optics." },
  { name: "Light Intensity", url: "/light-intensity-calculator", description: "Light." },
  { name: "Aspect Ratio", url: "/aspect-ratio-calculator", description: "Ratios." },
  { name: "Orbital Period", url: "/orbital-period-calculator", description: "Orbits." },
  { name: "Escape Velocity", url: "/escape-velocity-calculator", description: "Speed." },
  { name: "Pixel Calculator", url: "/pixel-calculator", description: "Pixels." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Telescope Magnification Calculator" keywords="telescope magnification, focal length, exit pupil, field of view, resolving power, limiting magnitude" breadcrumbs={[{ name: "Telescope Magnification", url: "/telescope-magnification-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Telescope Magnification Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Magnification = Objective Focal Length / Eyepiece Focal Length. Plus FOV, exit pupil, and more.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Objective Focal Length (mm)</label><input type="number" id="tm-obj" class="tm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1200" step="10" min="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Eyepiece Focal Length (mm)</label><input type="number" id="tm-eye" class="tm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="25" step="1" min="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Objective Aperture (mm)</label><input type="number" id="tm-aper" class="tm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="200" step="5" min="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Eyepiece AFOV (degrees)</label><input type="number" id="tm-afov" class="tm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="52" step="1" min="1" max="120"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Barlow/Reducer Factor</label><input type="number" id="tm-barlow" class="tm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" step="0.5" min="0.1"></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Magnification</div>
          <div class="text-5xl font-extrabold font-mono" id="tm-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">True FOV</div><div class="text-xl font-bold font-mono" id="tm-tfov">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Exit Pupil</div><div class="text-xl font-bold font-mono" id="tm-exit">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Limiting Magnitude</div><div class="text-xl font-bold font-mono" id="tm-lmag">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Resolving Power</div><div class="text-xl font-bold font-mono" id="tm-res">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Focal Ratio (f/)</div><div class="text-xl font-bold font-mono" id="tm-fratio">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Max Useful Mag</div><div class="text-xl font-bold font-mono" id="tm-max">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="telescope-magnification" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcTM() {
      const objFL = parseFloat((document.getElementById('tm-obj') as HTMLInputElement).value) || 1;
      const eyeFL = parseFloat((document.getElementById('tm-eye') as HTMLInputElement).value) || 1;
      const aper = parseFloat((document.getElementById('tm-aper') as HTMLInputElement).value) || 1;
      const afov = parseFloat((document.getElementById('tm-afov') as HTMLInputElement).value) || 52;
      const barlow = parseFloat((document.getElementById('tm-barlow') as HTMLInputElement).value) || 1;

      const effectiveFL = objFL * barlow;
      const mag = effectiveFL / eyeFL;
      const trueFOV = afov / mag;
      const exitPupil = aper / mag;
      const limitingMag = 2.7 + 5 * Math.log10(aper);
      const dawesLimit = 116 / aper;
      const focalRatio = effectiveFL / aper;
      const maxUsefulMag = 2 * aper;

      document.getElementById('tm-result')!.textContent = mag.toFixed(1) + '\u00d7';
      document.getElementById('tm-tfov')!.textContent = trueFOV.toFixed(2) + '\u00b0';
      document.getElementById('tm-exit')!.textContent = exitPupil.toFixed(2) + ' mm';
      document.getElementById('tm-lmag')!.textContent = limitingMag.toFixed(1) + ' mag';
      document.getElementById('tm-res')!.textContent = dawesLimit.toFixed(2) + ' arcsec';
      document.getElementById('tm-fratio')!.textContent = 'f/' + focalRatio.toFixed(1);
      document.getElementById('tm-max')!.textContent = maxUsefulMag.toFixed(0) + '\u00d7';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.tm-in').forEach(el => { el.addEventListener('input', calcTM); el.addEventListener('change', calcTM); });
      calcTM();
    }, 50);
  </script>
</CalculatorLayout>
