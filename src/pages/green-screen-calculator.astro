---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Green Screen Calculator - Screen Size, Lighting & Distance";
const description = "Calculate the required green screen size from subject distance and lens focal length. Determine lighting coverage area and minimum screen dimensions.";
const relatedCalcs = [
  { name: "Focal Length", url: "/focal-length-calculator", description: "Field of view and equivalents." },
  { name: "Photo Lighting", url: "/photo-lighting-calculator", description: "Lighting output calculations." },
  { name: "Depth of Field", url: "/depth-of-field-calculator", description: "Focus and blur calculations." },
  { name: "Screen Size", url: "/screen-size-calculator", description: "Display size calculations." },
  { name: "Area Calculator", url: "/area-calculator", description: "Surface area calculations." },
  { name: "Aspect Ratio", url: "/aspect-ratio-calculator", description: "Frame aspect ratios." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Green Screen Calculator" keywords="green screen calculator, chroma key size, green screen distance, lighting coverage, backdrop size, video production" breadcrumbs={[{ name: "Green Screen", url: "/green-screen-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Green Screen Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Determine the ideal green screen size and lighting setup for your camera and subject distance.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Focal Length (mm, 35mm equivalent)</label>
          <input type="number" id="gn-focal" class="gn-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="50" min="8" max="600" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Camera-to-Screen Distance</label>
          <div class="flex gap-2">
            <input type="number" id="gn-dist" class="gn-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="4" min="0.5" step="0.1">
            <select id="gn-unit" class="gn-in px-4 py-3 border border-border rounded-xl text-lg">
              <option value="m">meters</option>
              <option value="ft">feet</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Video Aspect Ratio</label>
          <select id="gn-aspect" class="gn-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="1.778" selected>16:9</option>
            <option value="1.333">4:3</option>
            <option value="2.333">21:9</option>
            <option value="2.39">2.39:1 (Anamorphic)</option>
            <option value="1.0">1:1 (Square)</option>
            <option value="0.5625">9:16 (Vertical)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Safety Margin (%)</label>
          <input type="number" id="gn-margin" class="gn-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="20" min="0" max="100" step="5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Subject-to-Screen Gap</label>
          <div class="flex gap-2">
            <input type="number" id="gn-gap" class="gn-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="1.5" min="0.3" step="0.1">
            <span class="flex items-center text-sm text-text-secondary" id="gn-gap-unit">m</span>
          </div>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Minimum Screen Size (with margin)</div>
          <div class="text-4xl font-extrabold" id="gn-size"></div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Screen Width</div>
            <div class="text-xl font-bold text-text" id="gn-width"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Screen Height</div>
            <div class="text-xl font-bold text-text" id="gn-height"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Screen Area</div>
            <div class="text-xl font-bold text-text" id="gn-area"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Horizontal FoV</div>
            <div class="text-xl font-bold text-text" id="gn-fov"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Lighting Coverage</div>
            <div class="text-xl font-bold text-text" id="gn-light"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Subject-Screen Distance</div>
            <div class="text-xl font-bold text-text" id="gn-subj-dist"></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="green-screen" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Green Screen Sizing Guide</h2>
      <p>The green screen must be large enough to fill the camera frame with margin for subject movement. Keep subjects at least 4-6 feet from the screen to avoid green spill.</p>
      <p><strong>Lighting tip:</strong> The green screen needs separate, even lighting at about 40% the intensity of your key light on the subject.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcGN() {
      const focal = parseFloat((document.getElementById('gn-focal') as HTMLInputElement).value) || 50;
      const unit = (document.getElementById('gn-unit') as HTMLSelectElement).value;
      let dist = parseFloat((document.getElementById('gn-dist') as HTMLInputElement).value) || 4;
      const aspect = parseFloat((document.getElementById('gn-aspect') as HTMLSelectElement).value);
      const margin = parseFloat((document.getElementById('gn-margin') as HTMLInputElement).value) || 20;
      let gap = parseFloat((document.getElementById('gn-gap') as HTMLInputElement).value) || 1.5;

      const distM = unit === 'ft' ? dist * 0.3048 : dist;
      const gapM = unit === 'ft' ? gap * 0.3048 : gap;
      const unitLabel = unit === 'ft' ? ' ft' : ' m';
      document.getElementById('gn-gap-unit')!.textContent = unit;

      const hFovRad = 2 * Math.atan(36 / (2 * focal));
      const hFovDeg = hFovRad * (180 / Math.PI);

      const screenWidth = 2 * distM * Math.tan(hFovRad / 2);
      const screenHeight = screenWidth / aspect;

      const marginMult = 1 + margin / 100;
      const finalW = screenWidth * marginMult;
      const finalH = screenHeight * marginMult;

      function fmt(m: number): string {
        if (unit === 'ft') return (m / 0.3048).toFixed(1) + ' ft';
        return m.toFixed(2) + ' m';
      }

      document.getElementById('gn-size')!.textContent = fmt(finalW) + ' x ' + fmt(finalH);
      document.getElementById('gn-width')!.textContent = fmt(finalW);
      document.getElementById('gn-height')!.textContent = fmt(finalH);

      const areaVal = finalW * finalH;
      if (unit === 'ft') {
        document.getElementById('gn-area')!.textContent = (areaVal / 0.0929).toFixed(1) + ' sq ft';
      } else {
        document.getElementById('gn-area')!.textContent = areaVal.toFixed(2) + ' m\u00B2';
      }

      document.getElementById('gn-fov')!.textContent = hFovDeg.toFixed(1) + '\u00B0';

      const lightArea = finalW * finalH * 1.1;
      if (unit === 'ft') {
        document.getElementById('gn-light')!.textContent = (lightArea / 0.0929).toFixed(1) + ' sq ft';
      } else {
        document.getElementById('gn-light')!.textContent = lightArea.toFixed(2) + ' m\u00B2';
      }

      document.getElementById('gn-subj-dist')!.textContent = fmt(gapM);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.gn-in').forEach(el => {
        el.addEventListener('input', calcGN);
        el.addEventListener('change', calcGN);
      });
      calcGN();
    }, 50);
  </script>
</CalculatorLayout>
