---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Hotel Block Calculator - Room Block Size & Attrition Guidance";
const description = "Calculate hotel room block size for your event. Estimate rooms needed, attrition rate risk, and get negotiation tips for group hotel rates.";
const relatedCalcs = [
  { name: "Event Budget Calculator", url: "/event-budget-calculator", description: "Total event cost breakdown." },
  { name: "Event Parking Calculator", url: "/event-parking-calculator", description: "Parking space planning." },
  { name: "Invitation Calculator", url: "/invitation-calculator", description: "Invitation planning." },
  { name: "Conference Calculator", url: "/conference-calculator", description: "Conference planning." },
  { name: "Event Insurance Calculator", url: "/event-insurance-calculator", description: "Event liability insurance." },
  { name: "Wedding Timeline Calculator", url: "/wedding-timeline-calculator", description: "Wedding day schedule." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Hotel Block Calculator"
  keywords="hotel block calculator, room block, group hotel rate, wedding hotel block, attrition rate, hotel negotiation"
  breadcrumbs={[{ name: "Hotel Block", url: "/hotel-block-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Hotel Block Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Plan your hotel room block size and understand attrition risk.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4 mb-6">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Total Out-of-Town Guests</label>
          <input type="number" id="hb2-oot" class="hb2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="80" min="1" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Average Guests per Room</label>
          <input type="number" id="hb2-perroom" class="hb2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.8" min="1" max="4" step="0.1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Expected Booking Rate (%)</label>
          <input type="number" id="hb2-bookrate" class="hb2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="70" min="20" max="100" step="5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Number of Nights</label>
          <input type="number" id="hb2-nights" class="hb2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="1" max="7" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Room Rate per Night ($)</label>
          <input type="number" id="hb2-rate" class="hb2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="149" min="50" step="10">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Attrition Clause (%)</label>
          <input type="number" id="hb2-attrition" class="hb2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="80" min="50" max="100" step="5">
        </div>
      </div>

      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Room Block</div>
        <div class="text-5xl font-extrabold" id="hb2-rooms">--</div>
        <div class="text-sm mt-1" id="hb2-note">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Room Nights (total)</div>
          <div class="text-xl font-bold" id="hb2-roomnights">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Total Block Revenue</div>
          <div class="text-xl font-bold" id="hb2-revenue">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Attrition Minimum</div>
          <div class="text-xl font-bold" id="hb2-attmin">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Penalty Risk</div>
          <div class="text-xl font-bold" id="hb2-risk">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-4" id="hb2-details"></div>

      <ShareButton calculatorId="hotel-block" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Hotel Block Planning Guide</h2>
      <p>A hotel room block guarantees rooms at a group rate. Most hotels require filling 80% of the block (attrition clause). If fewer rooms are booked, you may owe the difference. Book conservatively: it is better to add rooms than pay attrition penalties.</p>
      <h3 class="text-xl font-semibold text-text mt-6">Negotiation Tips</h3>
      <ul>
        <li>Ask for complimentary rooms (1 per 40-50 booked)</li>
        <li>Negotiate attrition down to 70-75%</li>
        <li>Request late checkout for the wedding party</li>
        <li>Ask for a hospitality suite or welcome bag delivery</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcHB2() {
      const ootGuests = parseInt((document.getElementById('hb2-oot') as HTMLInputElement).value) || 1;
      const perRoom = parseFloat((document.getElementById('hb2-perroom') as HTMLInputElement).value) || 1.8;
      const bookRate = parseFloat((document.getElementById('hb2-bookrate') as HTMLInputElement).value) || 70;
      const nights = parseInt((document.getElementById('hb2-nights') as HTMLInputElement).value) || 2;
      const rate = parseFloat((document.getElementById('hb2-rate') as HTMLInputElement).value) || 149;
      const attrPct = parseFloat((document.getElementById('hb2-attrition') as HTMLInputElement).value) || 80;

      const maxRooms = Math.ceil(ootGuests / perRoom);
      const expectedRooms = Math.ceil(maxRooms * bookRate / 100);
      const recommendedBlock = expectedRooms;
      const roomNights = recommendedBlock * nights;
      const revenue = roomNights * rate;
      const attrMin = Math.ceil(recommendedBlock * attrPct / 100);
      const attrMinNights = attrMin * nights;

      let riskLevel = 'Low';
      if (bookRate < 60) riskLevel = 'High';
      else if (bookRate < 75) riskLevel = 'Medium';

      const fmt = (n: number) => '$' + Math.round(n).toLocaleString();
      document.getElementById('hb2-rooms')!.textContent = recommendedBlock + ' rooms';
      document.getElementById('hb2-note')!.textContent = 'per night (' + maxRooms + ' max possible, ' + bookRate + '% expected booking)';
      document.getElementById('hb2-roomnights')!.textContent = roomNights.toString();
      document.getElementById('hb2-revenue')!.textContent = fmt(revenue);
      document.getElementById('hb2-attmin')!.textContent = attrMin + ' rooms/night';
      document.getElementById('hb2-risk')!.textContent = riskLevel;

      const penaltyPerUnfilled = rate * nights;
      const worstCasePenalty = (recommendedBlock - attrMin) * penaltyPerUnfilled;

      let details = '<h3 class="font-semibold text-sm text-text mb-2">Block Details & Guidance</h3><ul class="text-sm text-text-secondary space-y-1">';
      details += '<li>Out-of-town guests: ' + ootGuests + '</li>';
      details += '<li>Max rooms needed: ' + maxRooms + ' (at ' + perRoom + ' guests/room)</li>';
      details += '<li>Expected bookings: ' + expectedRooms + ' rooms (' + bookRate + '% rate)</li>';
      details += '<li>Room block: ' + recommendedBlock + ' rooms x ' + nights + ' nights = ' + roomNights + ' room-nights</li>';
      details += '<li>Group rate: ' + fmt(rate) + '/night</li>';
      details += '<li>Total revenue: ' + fmt(revenue) + '</li>';
      details += '<li>Attrition minimum (' + attrPct + '%): Must fill ' + attrMin + ' rooms/night</li>';
      if (riskLevel === 'High') {
        details += '<li class="text-red-600 font-semibold">High risk: Consider a smaller block or negotiate lower attrition</li>';
      }
      details += '<li>Ask for comp rooms: ' + Math.floor(recommendedBlock / 40) + ' complimentary (1 per 40 booked)</li>';
      details += '</ul>';
      document.getElementById('hb2-details')!.innerHTML = details;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.hb2-in').forEach(el => { el.addEventListener('input', calcHB2); el.addEventListener('change', calcHB2); });
      calcHB2();
    }, 50);
  </script>
</CalculatorLayout>
