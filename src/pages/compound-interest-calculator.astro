---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import SliderInput from '../components/SliderInput.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Compound Interest Calculator - Free Savings & Investment Calculator";
const description = "Calculate compound interest on savings and investments. See how your money grows over time with monthly contributions. Free compound interest chart and table.";

const relatedCalcs = [
  { name: "Savings Calculator", url: "/savings-calculator", description: "Plan your savings growth." },
  { name: "Investment Calculator", url: "/investment-calculator", description: "Future value of investments." },
  { name: "Retirement Calculator", url: "/retirement-calculator", description: "Plan for retirement." },
  { name: "Mortgage Calculator", url: "/mortgage-calculator", description: "Home loan payments." },
  { name: "Loan Calculator", url: "/loan-calculator", description: "Loan payment calculator." },
  { name: "Inflation Calculator", url: "/inflation-calculator", description: "Purchasing power over time." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Compound Interest Calculator"
  keywords="compound interest calculator, compound interest formula, savings calculator, investment growth, interest rate calculator, compound growth"
  breadcrumbs={[{ name: "Compound Interest Calculator", url: "/compound-interest-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Compound Interest Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">See how your savings or investments grow over time with the power of compound interest.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <SliderInput id="ci-principal" label="Initial Investment" min={0} max={1000000} step={1000} value={10000} prefix="$" tooltip="Starting amount" />
          <SliderInput id="ci-monthly" label="Monthly Contribution" min={0} max={10000} step={50} value={200} prefix="$" tooltip="Amount added each month" />
          <SliderInput id="ci-rate" label="Annual Interest Rate" min={0} max={20} step={0.1} value={7} suffix="%" tooltip="Expected annual rate of return" />
          <SliderInput id="ci-years" label="Time Period" min={1} max={50} step={1} value={20} suffix=" years" tooltip="Investment time horizon" />

          <div class="mt-4">
            <label class="block text-sm font-medium text-text mb-2">Compound Frequency</label>
            <select id="ci-frequency" class="w-full px-3 py-2 border border-border rounded-lg">
              <option value="1">Annually</option>
              <option value="2">Semi-Annually</option>
              <option value="4">Quarterly</option>
              <option value="12" selected>Monthly</option>
              <option value="365">Daily</option>
            </select>
          </div>
        </div>

        <div class="space-y-4">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Future Value</div>
            <div class="text-4xl sm:text-5xl font-extrabold" id="ci-future">$0</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Contributions</div>
              <div class="text-xl font-bold" id="ci-contributions">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Interest</div>
              <div class="text-xl font-bold text-secondary" id="ci-interest">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Interest Earned %</div>
              <div class="text-xl font-bold" id="ci-interest-pct">0%</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Effective Rate</div>
              <div class="text-xl font-bold" id="ci-effective">0%</div>
            </div>
          </div>
          <div class="chart-container p-4 bg-surface-alt rounded-xl">
            <canvas id="ci-chart" width="400" height="250"></canvas>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="compound-interest" />
      <FeedbackWidget />
    </div>

    <!-- Year-by-Year Table -->
    <div class="mt-12 bg-white border border-border rounded-2xl p-6 sm:p-8">
      <h2 class="text-2xl font-bold text-text mb-4">Year-by-Year Breakdown</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-border text-left">
              <th class="py-2 pr-3 font-semibold">Year</th>
              <th class="py-2 pr-3 font-semibold text-right">Contributions</th>
              <th class="py-2 pr-3 font-semibold text-right">Interest</th>
              <th class="py-2 font-semibold text-right">Balance</th>
            </tr>
          </thead>
          <tbody id="ci-tbody"></tbody>
        </table>
      </div>
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Compound Interest Works</h2>
      <p>Compound interest is interest calculated on both the initial principal and the accumulated interest from previous periods. This creates a snowball effect where your money grows faster over time — often called "the eighth wonder of the world."</p>

      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">
        A = P(1 + r/n)<sup>nt</sup> + PMT × [((1 + r/n)<sup>nt</sup> - 1) / (r/n)]
      </div>
      <p>Where A = final amount, P = principal, r = annual rate, n = compounds per year, t = years, PMT = periodic contribution.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Simple vs. Compound Interest</h3>
      <ul>
        <li><strong>Simple interest:</strong> Calculated only on the original principal. Formula: I = P × r × t</li>
        <li><strong>Compound interest:</strong> Calculated on principal + accumulated interest. Grows exponentially.</li>
      </ul>
      <p>For example, $10,000 at 7% for 20 years: Simple interest yields $24,000. Compound interest (monthly) yields $40,387 — that's 68% more!</p>

      <h3 class="text-xl font-semibold text-text mt-8">The Rule of 72</h3>
      <p>A quick way to estimate how long it takes to double your money: divide 72 by the interest rate. At 7%, your money doubles in approximately 72 ÷ 7 ≈ 10.3 years.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Compounding Frequency</h3>
      <p>The more frequently interest compounds, the more you earn. Daily compounding earns slightly more than monthly, which earns more than annually. The difference becomes more significant with higher rates and longer time periods.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What's a realistic return rate?</strong> The S&P 500 has historically returned about 10% annually (7% after inflation). Savings accounts offer 4-5% in high-yield accounts. Bonds typically return 3-5%.</p>
      <p><strong>How often should I contribute?</strong> Regular contributions (dollar-cost averaging) reduce risk and maximize compound growth. Monthly contributions are most common.</p>
      <p><strong>Does compound interest apply to debt?</strong> Yes — compound interest works against you on loans and credit cards. Credit card interest compounds daily on unpaid balances, which is why paying off debt quickly is so important.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    import Chart from 'chart.js/auto';
    let ciChart: Chart | null = null;

    function getVal(id: string): number {
      const s = document.getElementById(`${id}-slider`) as HTMLInputElement;
      return parseFloat(s?.value || '0');
    }
    const fmt = (n: number) => '$' + Math.round(n).toLocaleString('en-US');

    function calcCI() {
      const P = getVal('ci-principal');
      const PMT = getVal('ci-monthly');
      const rate = getVal('ci-rate') / 100;
      const years = getVal('ci-years');
      const n = parseInt((document.getElementById('ci-frequency') as HTMLSelectElement).value);

      const r = rate / n;
      const periodsPerYear = n;
      const totalPeriods = years * n;

      // Year-by-year calculation
      let balance = P;
      let totalContrib = P;
      const yearData: { year: number; contrib: number; interest: number; balance: number }[] = [];
      const balances: number[] = [P];
      const contribs: number[] = [P];

      for (let y = 1; y <= years; y++) {
        let yearInterest = 0;
        let yearContrib = 0;
        for (let p = 0; p < periodsPerYear; p++) {
          const interest = balance * r;
          yearInterest += interest;
          balance += interest;
          // Add monthly contributions proportionally
          const monthsPerPeriod = 12 / periodsPerYear;
          const contrib = PMT * monthsPerPeriod;
          balance += contrib;
          yearContrib += contrib;
        }
        totalContrib += yearContrib;
        yearData.push({ year: y, contrib: totalContrib, interest: balance - totalContrib, balance });
        balances.push(balance);
        contribs.push(totalContrib);
      }

      const totalInterest = balance - totalContrib;

      document.getElementById('ci-future')!.textContent = fmt(balance);
      document.getElementById('ci-contributions')!.textContent = fmt(totalContrib);
      document.getElementById('ci-interest')!.textContent = fmt(totalInterest);
      document.getElementById('ci-interest-pct')!.textContent = totalContrib > 0 ? (totalInterest / totalContrib * 100).toFixed(1) + '%' : '0%';

      // Effective annual rate
      const effectiveRate = (Math.pow(1 + rate / n, n) - 1) * 100;
      document.getElementById('ci-effective')!.textContent = effectiveRate.toFixed(2) + '%';

      // Chart
      const ctx = (document.getElementById('ci-chart') as HTMLCanvasElement).getContext('2d')!;
      if (ciChart) ciChart.destroy();

      const labels = Array.from({ length: years + 1 }, (_, i) => `Year ${i}`);
      ciChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [
            {
              label: 'Contributions',
              data: contribs,
              backgroundColor: '#3b82f6',
              borderRadius: 2,
            },
            {
              label: 'Interest',
              data: balances.map((b, i) => b - contribs[i]),
              backgroundColor: '#10b981',
              borderRadius: 2,
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            x: { stacked: true, grid: { display: false } },
            y: { stacked: true, ticks: { callback: (v) => '$' + Number(v).toLocaleString() } }
          },
          plugins: {
            legend: { position: 'bottom', labels: { padding: 12, usePointStyle: true, font: { size: 11 } } },
            tooltip: {
              callbacks: {
                label: (c) => `${c.dataset.label}: ${fmt(c.parsed.y)}`
              }
            }
          }
        }
      });

      // Table
      const tbody = document.getElementById('ci-tbody')!;
      tbody.innerHTML = yearData.map(d =>
        `<tr class="border-b border-border/30 hover:bg-surface-alt/50">
          <td class="py-2 pr-3 text-text-secondary">Year ${d.year}</td>
          <td class="py-2 pr-3 text-right text-primary">${fmt(d.contrib)}</td>
          <td class="py-2 pr-3 text-right text-secondary">${fmt(d.interest)}</td>
          <td class="py-2 text-right font-medium">${fmt(d.balance)}</td>
        </tr>`
      ).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      ['ci-principal-slider', 'ci-monthly-slider', 'ci-rate-slider', 'ci-years-slider'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcCI);
      });
      ['ci-principal-input', 'ci-monthly-input', 'ci-rate-input', 'ci-years-input'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', () => setTimeout(calcCI, 120));
      });
      document.getElementById('ci-frequency')!.addEventListener('change', calcCI);
      calcCI();
    }, 50);
  </script>
</CalculatorLayout>
