---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Binary Calculator - Binary to Decimal Converter & Math";
const description = "Convert between binary, decimal, hexadecimal, and octal. Perform binary arithmetic operations: add, subtract, multiply, divide.";

const relatedCalcs = [
  { name: "Hex Calculator", url: "/hex-calculator", description: "Hexadecimal." },
  { name: "Subnet Calculator", url: "/subnet-calculator", description: "IP subnets." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Exponent Calculator", url: "/exponent-calculator", description: "Powers." },
  { name: "Roman Numeral", url: "/roman-numeral-converter", description: "Roman numerals." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Binary Calculator"
  keywords="binary calculator, binary to decimal, decimal to binary, binary converter, binary arithmetic, base conversion"
  breadcrumbs={[{ name: "Binary Calculator", url: "/binary-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Binary Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert between number bases and perform binary arithmetic.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Converter -->
      <h3 class="font-semibold text-text mb-3">Number Base Converter</h3>
      <div class="space-y-3 mb-6">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Decimal (Base 10)</label>
          <input type="text" id="bin-dec" class="w-full px-4 py-3 border border-border rounded-xl text-lg font-mono" value="42">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Binary (Base 2)</label>
          <input type="text" id="bin-bin" class="w-full px-4 py-3 border border-border rounded-xl text-lg font-mono" value="101010">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Hexadecimal (Base 16)</label>
          <input type="text" id="bin-hex" class="w-full px-4 py-3 border border-border rounded-xl text-lg font-mono" value="2A">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Octal (Base 8)</label>
          <input type="text" id="bin-oct" class="w-full px-4 py-3 border border-border rounded-xl text-lg font-mono" value="52">
        </div>
      </div>

      <!-- Binary Arithmetic -->
      <h3 class="font-semibold text-text mb-3">Binary Arithmetic</h3>
      <div class="flex items-center gap-2 mb-4">
        <input type="text" id="bin-a" class="flex-1 px-4 py-3 border border-border rounded-xl text-lg font-mono" value="1010" placeholder="Binary A">
        <select id="bin-op" class="px-3 py-3 border border-border rounded-xl text-lg font-bold">
          <option value="+">+</option>
          <option value="-">−</option>
          <option value="*">×</option>
          <option value="/">/</option>
          <option value="&">&</option>
          <option value="|">|</option>
          <option value="^">XOR</option>
        </select>
        <input type="text" id="bin-b" class="flex-1 px-4 py-3 border border-border rounded-xl text-lg font-mono" value="0110" placeholder="Binary B">
      </div>

      <div class="p-4 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Result (Binary)</div>
        <div class="text-3xl font-extrabold font-mono" id="bin-result">0</div>
        <div class="text-sm text-blue-200 mt-1 font-mono" id="bin-result-dec">(= 0 decimal)</div>
      </div>

      <!-- Bit visualization -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-2">8-bit Visualization</h3>
        <div class="flex justify-center gap-1" id="bin-bits"></div>
        <div class="flex justify-center gap-1 mt-1" id="bin-powers"></div>
      </div>

      <ShareButton calculatorId="binary" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">How Binary Works</h2>
      <p>Binary is a base-2 number system using only 0 and 1. Each position represents a power of 2. Computers use binary because transistors have two states: on (1) and off (0).</p>

      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-center">
        101010₂ = 1×32 + 0×16 + 1×8 + 0×4 + 1×2 + 0×1 = 42₁₀
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How do I convert binary to decimal?</strong> Multiply each bit by its power of 2 (from right: 1, 2, 4, 8, 16...) and sum the results.</p>
      <p><strong>What are bitwise operations?</strong> AND (&), OR (|), and XOR (^) operate on individual bits. AND gives 1 only when both bits are 1. OR gives 1 when either bit is 1. XOR gives 1 when bits differ.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let updatingFrom = '';

    function updateFromDec(dec: number) {
      if (isNaN(dec) || dec < 0) return;
      const n = Math.floor(dec);
      if (updatingFrom !== 'bin') (document.getElementById('bin-bin') as HTMLInputElement).value = n.toString(2);
      if (updatingFrom !== 'hex') (document.getElementById('bin-hex') as HTMLInputElement).value = n.toString(16).toUpperCase();
      if (updatingFrom !== 'oct') (document.getElementById('bin-oct') as HTMLInputElement).value = n.toString(8);
      if (updatingFrom !== 'dec') (document.getElementById('bin-dec') as HTMLInputElement).value = String(n);
      updateBits(n);
    }

    function updateBits(n: number) {
      const bits = n.toString(2).padStart(8, '0').slice(-8);
      document.getElementById('bin-bits')!.innerHTML = bits.split('').map(b =>
        `<div class="w-10 h-10 flex items-center justify-center rounded-lg text-lg font-bold font-mono ${b === '1' ? 'bg-primary text-white' : 'bg-surface-alt text-text-muted'}">${b}</div>`
      ).join('');
      const powers = [128, 64, 32, 16, 8, 4, 2, 1];
      document.getElementById('bin-powers')!.innerHTML = powers.map(p =>
        `<div class="w-10 text-center text-xs text-text-muted">${p}</div>`
      ).join('');
    }

    function calcBinArith() {
      const aStr = (document.getElementById('bin-a') as HTMLInputElement).value.trim();
      const bStr = (document.getElementById('bin-b') as HTMLInputElement).value.trim();
      const op = (document.getElementById('bin-op') as HTMLSelectElement).value;

      const a = parseInt(aStr, 2);
      const b = parseInt(bStr, 2);
      if (isNaN(a) || isNaN(b)) return;

      let result: number;
      switch (op) {
        case '+': result = a + b; break;
        case '-': result = Math.max(0, a - b); break;
        case '*': result = a * b; break;
        case '/': result = b !== 0 ? Math.floor(a / b) : 0; break;
        case '&': result = a & b; break;
        case '|': result = a | b; break;
        case '^': result = a ^ b; break;
        default: result = 0;
      }

      document.getElementById('bin-result')!.textContent = result.toString(2);
      document.getElementById('bin-result-dec')!.textContent = `(= ${result} decimal)`;
    }

    setTimeout(() => {
      document.getElementById('bin-dec')!.addEventListener('input', () => {
        updatingFrom = 'dec';
        updateFromDec(parseInt((document.getElementById('bin-dec') as HTMLInputElement).value) || 0);
        updatingFrom = '';
      });
      document.getElementById('bin-bin')!.addEventListener('input', () => {
        updatingFrom = 'bin';
        updateFromDec(parseInt((document.getElementById('bin-bin') as HTMLInputElement).value, 2) || 0);
        updatingFrom = '';
      });
      document.getElementById('bin-hex')!.addEventListener('input', () => {
        updatingFrom = 'hex';
        updateFromDec(parseInt((document.getElementById('bin-hex') as HTMLInputElement).value, 16) || 0);
        updatingFrom = '';
      });
      document.getElementById('bin-oct')!.addEventListener('input', () => {
        updatingFrom = 'oct';
        updateFromDec(parseInt((document.getElementById('bin-oct') as HTMLInputElement).value, 8) || 0);
        updatingFrom = '';
      });

      ['bin-a', 'bin-b'].forEach(id => document.getElementById(id)!.addEventListener('input', calcBinArith));
      document.getElementById('bin-op')!.addEventListener('change', calcBinArith);

      updateBits(42);
      calcBinArith();
    }, 50);
  </script>
</CalculatorLayout>
