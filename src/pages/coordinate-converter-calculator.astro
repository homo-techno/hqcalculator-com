---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Coordinate Converter Calculator - DD, DMS, DDM & UTM";
const description = "Convert geographic coordinates between decimal degrees (DD), degrees-minutes-seconds (DMS), degrees-decimal minutes (DDM), and UTM formats.";
const relatedCalcs = [
  { name: "Distance & Bearing", url: "/distance-bearing-calculator", description: "GPS distance & bearing." },
  { name: "Datum Conversion", url: "/datum-conversion-calculator", description: "Datum shift calculator." },
  { name: "GPS Accuracy", url: "/gps-accuracy-calculator", description: "GPS error estimation." },
  { name: "Bearing Calculator", url: "/bearing-calculator", description: "Bearing between points." },
  { name: "Great Circle", url: "/great-circle-calculator", description: "Great circle distance." },
  { name: "Map Distance", url: "/map-distance-calculator", description: "Map to ground distance." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Coordinate Converter Calculator" keywords="coordinate converter, DD DMS DDM UTM, GPS coordinates, latitude longitude, coordinate conversion" breadcrumbs={[{ name: "Coordinate Converter Calculator", url: "/coordinate-converter-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Coordinate Converter Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Enter coordinates in any format and instantly convert to all others.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Input Format</label>
          <select id="coc-mode" class="coc-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="dd">Decimal Degrees (DD)</option>
            <option value="dms">Degrees Minutes Seconds (DMS)</option>
            <option value="ddm">Degrees Decimal Minutes (DDM)</option>
          </select>
        </div>
        <div id="coc-dd-inputs">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-semibold text-text mb-1">Latitude (DD)</label>
              <input type="number" id="coc-lat-dd" class="coc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="40.7128" step="0.0001" min="-90" max="90">
            </div>
            <div>
              <label class="block text-sm font-semibold text-text mb-1">Longitude (DD)</label>
              <input type="number" id="coc-lon-dd" class="coc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="-74.0060" step="0.0001" min="-180" max="180">
            </div>
          </div>
        </div>
        <div id="coc-dms-inputs" style="display:none">
          <p class="text-xs text-text-muted mb-2">Latitude</p>
          <div class="grid grid-cols-4 gap-2 mb-2">
            <div><label class="text-xs">Deg</label><input type="number" id="coc-lat-d" class="coc-in w-full px-3 py-2 border border-border rounded-xl font-bold" value="40"></div>
            <div><label class="text-xs">Min</label><input type="number" id="coc-lat-m" class="coc-in w-full px-3 py-2 border border-border rounded-xl font-bold" value="42"></div>
            <div><label class="text-xs">Sec</label><input type="number" id="coc-lat-s" class="coc-in w-full px-3 py-2 border border-border rounded-xl font-bold" value="46.08" step="0.01"></div>
            <div><label class="text-xs">Dir</label><select id="coc-lat-dir" class="coc-in w-full px-3 py-2 border border-border rounded-xl"><option value="N">N</option><option value="S">S</option></select></div>
          </div>
          <p class="text-xs text-text-muted mb-2">Longitude</p>
          <div class="grid grid-cols-4 gap-2">
            <div><label class="text-xs">Deg</label><input type="number" id="coc-lon-d" class="coc-in w-full px-3 py-2 border border-border rounded-xl font-bold" value="74"></div>
            <div><label class="text-xs">Min</label><input type="number" id="coc-lon-m" class="coc-in w-full px-3 py-2 border border-border rounded-xl font-bold" value="0"></div>
            <div><label class="text-xs">Sec</label><input type="number" id="coc-lon-s" class="coc-in w-full px-3 py-2 border border-border rounded-xl font-bold" value="21.6" step="0.01"></div>
            <div><label class="text-xs">Dir</label><select id="coc-lon-dir" class="coc-in w-full px-3 py-2 border border-border rounded-xl"><option value="E">E</option><option value="W" selected>W</option></select></div>
          </div>
        </div>
        <div id="coc-ddm-inputs" style="display:none">
          <p class="text-xs text-text-muted mb-2">Latitude</p>
          <div class="grid grid-cols-3 gap-2 mb-2">
            <div><label class="text-xs">Deg</label><input type="number" id="coc-lat-ddm-d" class="coc-in w-full px-3 py-2 border border-border rounded-xl font-bold" value="40"></div>
            <div><label class="text-xs">Min</label><input type="number" id="coc-lat-ddm-m" class="coc-in w-full px-3 py-2 border border-border rounded-xl font-bold" value="42.768" step="0.001"></div>
            <div><label class="text-xs">Dir</label><select id="coc-lat-ddm-dir" class="coc-in w-full px-3 py-2 border border-border rounded-xl"><option value="N">N</option><option value="S">S</option></select></div>
          </div>
          <p class="text-xs text-text-muted mb-2">Longitude</p>
          <div class="grid grid-cols-3 gap-2">
            <div><label class="text-xs">Deg</label><input type="number" id="coc-lon-ddm-d" class="coc-in w-full px-3 py-2 border border-border rounded-xl font-bold" value="74"></div>
            <div><label class="text-xs">Min</label><input type="number" id="coc-lon-ddm-m" class="coc-in w-full px-3 py-2 border border-border rounded-xl font-bold" value="0.36" step="0.001"></div>
            <div><label class="text-xs">Dir</label><select id="coc-lon-ddm-dir" class="coc-in w-full px-3 py-2 border border-border rounded-xl"><option value="E">E</option><option value="W" selected>W</option></select></div>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Decimal Degrees</div>
          <div class="text-3xl font-extrabold font-mono" id="coc-out-dd">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">DMS</div>
          <div class="text-lg font-bold font-mono" id="coc-out-dms">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">DDM</div>
          <div class="text-lg font-bold font-mono" id="coc-out-ddm">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">UTM</div>
          <div class="text-lg font-bold font-mono" id="coc-out-utm">--</div>
        </div>
      </div>
      <ShareButton calculatorId="coordinate-converter" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Coordinate Formats</h2>
      <p><strong>DD:</strong> Decimal degrees (e.g., 40.7128, -74.0060). <strong>DMS:</strong> Degrees, minutes, seconds (e.g., 40° 42' 46.08" N). <strong>DDM:</strong> Degrees and decimal minutes (e.g., 40° 42.768' N). <strong>UTM:</strong> Universal Transverse Mercator zone, easting, northing.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function ddToDms(dd: number) {
      const abs = Math.abs(dd);
      const d = Math.floor(abs);
      const mFull = (abs - d) * 60;
      const m = Math.floor(mFull);
      const s = (mFull - m) * 60;
      return { d, m, s };
    }
    function ddToUtm(lat: number, lon: number) {
      const zone = Math.floor((lon + 180) / 6) + 1;
      const letter = lat >= 0 ? 'N' : 'S';
      const latRad = lat * Math.PI / 180;
      const lonRad = lon * Math.PI / 180;
      const a = 6378137;
      const f = 1 / 298.257223563;
      const e = Math.sqrt(2 * f - f * f);
      const e2 = e * e / (1 - e * e);
      const n = a / Math.sqrt(1 - e * e * Math.sin(latRad) * Math.sin(latRad));
      const t = Math.tan(latRad);
      const c = e2 * Math.cos(latRad) * Math.cos(latRad);
      const lonOrigin = ((zone - 1) * 6 - 180 + 3) * Math.PI / 180;
      const A = Math.cos(latRad) * (lonRad - lonOrigin);
      const M = a * ((1 - e*e/4 - 3*e*e*e*e/64) * latRad - (3*e*e/8 + 3*e*e*e*e/32) * Math.sin(2*latRad) + (15*e*e*e*e/256) * Math.sin(4*latRad));
      const easting = 500000 + 0.9996 * n * (A + (1-t*t+c)*A*A*A/6 + (5-18*t*t+t*t*t*t)*A*A*A*A*A/120);
      let northing = 0.9996 * (M + n * Math.tan(latRad) * (A*A/2 + (5-t*t+9*c+4*c*c)*A*A*A*A/24));
      if (lat < 0) northing += 10000000;
      return { zone, letter, easting, northing };
    }
    function calcCOC() {
      const mode = (document.getElementById('coc-mode') as HTMLSelectElement).value;
      document.getElementById('coc-dd-inputs')!.style.display = mode === 'dd' ? '' : 'none';
      document.getElementById('coc-dms-inputs')!.style.display = mode === 'dms' ? '' : 'none';
      document.getElementById('coc-ddm-inputs')!.style.display = mode === 'ddm' ? '' : 'none';
      let lat = 0, lon = 0;
      if (mode === 'dd') {
        lat = parseFloat((document.getElementById('coc-lat-dd') as HTMLInputElement).value) || 0;
        lon = parseFloat((document.getElementById('coc-lon-dd') as HTMLInputElement).value) || 0;
      } else if (mode === 'dms') {
        const latD = parseFloat((document.getElementById('coc-lat-d') as HTMLInputElement).value) || 0;
        const latM = parseFloat((document.getElementById('coc-lat-m') as HTMLInputElement).value) || 0;
        const latS = parseFloat((document.getElementById('coc-lat-s') as HTMLInputElement).value) || 0;
        const latDir = (document.getElementById('coc-lat-dir') as HTMLSelectElement).value;
        const lonD = parseFloat((document.getElementById('coc-lon-d') as HTMLInputElement).value) || 0;
        const lonM = parseFloat((document.getElementById('coc-lon-m') as HTMLInputElement).value) || 0;
        const lonS = parseFloat((document.getElementById('coc-lon-s') as HTMLInputElement).value) || 0;
        const lonDir = (document.getElementById('coc-lon-dir') as HTMLSelectElement).value;
        lat = (latD + latM / 60 + latS / 3600) * (latDir === 'S' ? -1 : 1);
        lon = (lonD + lonM / 60 + lonS / 3600) * (lonDir === 'W' ? -1 : 1);
      } else if (mode === 'ddm') {
        const latD = parseFloat((document.getElementById('coc-lat-ddm-d') as HTMLInputElement).value) || 0;
        const latM = parseFloat((document.getElementById('coc-lat-ddm-m') as HTMLInputElement).value) || 0;
        const latDir = (document.getElementById('coc-lat-ddm-dir') as HTMLSelectElement).value;
        const lonD = parseFloat((document.getElementById('coc-lon-ddm-d') as HTMLInputElement).value) || 0;
        const lonM = parseFloat((document.getElementById('coc-lon-ddm-m') as HTMLInputElement).value) || 0;
        const lonDir = (document.getElementById('coc-lon-ddm-dir') as HTMLSelectElement).value;
        lat = (latD + latM / 60) * (latDir === 'S' ? -1 : 1);
        lon = (lonD + lonM / 60) * (lonDir === 'W' ? -1 : 1);
      }
      document.getElementById('coc-out-dd')!.textContent = lat.toFixed(6) + ', ' + lon.toFixed(6);
      const latDms = ddToDms(lat);
      const lonDms = ddToDms(lon);
      const latH = lat >= 0 ? 'N' : 'S';
      const lonH = lon >= 0 ? 'E' : 'W';
      document.getElementById('coc-out-dms')!.textContent = latDms.d + '\u00B0 ' + latDms.m + "' " + latDms.s.toFixed(2) + '" ' + latH + ', ' + lonDms.d + '\u00B0 ' + lonDms.m + "' " + lonDms.s.toFixed(2) + '" ' + lonH;
      const latMinDec = latDms.m + latDms.s / 60;
      const lonMinDec = lonDms.m + lonDms.s / 60;
      document.getElementById('coc-out-ddm')!.textContent = latDms.d + '\u00B0 ' + latMinDec.toFixed(4) + "' " + latH + ', ' + lonDms.d + '\u00B0 ' + lonMinDec.toFixed(4) + "' " + lonH;
      const utm = ddToUtm(lat, lon);
      document.getElementById('coc-out-utm')!.textContent = utm.zone + utm.letter + ' ' + utm.easting.toFixed(0) + 'E ' + utm.northing.toFixed(0) + 'N';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.coc-in').forEach(el => { el.addEventListener('input', calcCOC); el.addEventListener('change', calcCOC); });
      calcCOC();
    }, 50);
  </script>
</CalculatorLayout>
