---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Toilet Water Calculator - Flush Volume & Savings Comparison";
const description = "Compare old-style, low-flow, and dual-flush toilets for water usage, annual savings, and replacement ROI to make an informed upgrade decision.";
const relatedCalcs = [
  { name: "Water Usage", url: "/water-usage-calculator", description: "Daily water consumption." },
  { name: "Water Quality", url: "/water-quality-calculator", description: "Water quality analysis." },
  { name: "Septic Tank", url: "/septic-tank-calculator", description: "Septic system sizing." },
  { name: "Plumbing Pipe", url: "/plumbing-pipe-calculator", description: "Pipe sizing." },
  { name: "Electricity Bill", url: "/electricity-bill-calculator", description: "Utility bill estimates." },
  { name: "Pool Volume", url: "/pool-volume-calculator", description: "Water volume." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Toilet Water Calculator" keywords="toilet water calculator, flush volume, low flow toilet, dual flush, water savings, toilet replacement ROI" breadcrumbs={[{ name: "Toilet Water", url: "/toilet-water-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Toilet Water Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Compare water usage and savings between old, low-flow, and dual-flush toilets to evaluate upgrade ROI.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Current Toilet Type</label>
          <select id="tw3-current" class="tw3-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="7">Pre-1980 (7 GPF)</option>
            <option value="5">1980-1992 (5 GPF)</option>
            <option value="3.5" selected>1992-1994 (3.5 GPF)</option>
            <option value="1.6">1994+ Standard (1.6 GPF)</option>
            <option value="1.28">WaterSense (1.28 GPF)</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Number of People</label>
          <input type="number" id="tw3-people" class="tw3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" min="1" max="20" step="1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Flushes Per Person Per Day</label>
          <input type="number" id="tw3-flushes" class="tw3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="1" max="20" step="1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Number of Toilets to Upgrade</label>
          <input type="number" id="tw3-toilets" class="tw3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="1" max="10" step="1">
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Water Rate ($/1000 gal)</label>
            <input type="number" id="tw3-rate" class="tw3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="1" step="0.5">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">New Toilet Cost ($)</label>
            <input type="number" id="tw3-cost" class="tw3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="250" min="50" step="25">
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Annual Water Savings (vs Current)</div>
          <div class="text-4xl font-extrabold" id="tw3-savings">0 gallons</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Annual Usage Comparison</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between"><span>Current Toilet</span><span class="font-bold" id="tw3-curuse">0 gal/yr</span></div>
            <div class="flex justify-between"><span>Standard Low-Flow (1.6 GPF)</span><span class="font-bold" id="tw3-lf16">0 gal/yr</span></div>
            <div class="flex justify-between"><span>WaterSense (1.28 GPF)</span><span class="font-bold" id="tw3-ws128">0 gal/yr</span></div>
            <div class="flex justify-between"><span>Dual-Flush (0.8/1.6 GPF)</span><span class="font-bold" id="tw3-dual">0 gal/yr</span></div>
            <div class="flex justify-between"><span>Ultra HET (0.8 GPF)</span><span class="font-bold" id="tw3-ultra">0 gal/yr</span></div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Annual Cost Savings</div><div class="text-xl font-bold" id="tw3-costsave">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Payback Period</div><div class="text-xl font-bold" id="tw3-payback">0 yrs</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Daily Flush Volume</div><div class="text-xl font-bold" id="tw3-dailycur">0 gal</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">5-Year Net Savings</div><div class="text-xl font-bold" id="tw3-fiveyr">$0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="toilet-water" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcTW3() {
      const currentGPF = parseFloat((document.getElementById('tw3-current') as HTMLSelectElement).value) || 3.5;
      const people = parseInt((document.getElementById('tw3-people') as HTMLInputElement).value) || 4;
      const flushes = parseInt((document.getElementById('tw3-flushes') as HTMLInputElement).value) || 5;
      const toilets = parseInt((document.getElementById('tw3-toilets') as HTMLInputElement).value) || 2;
      const rate = parseFloat((document.getElementById('tw3-rate') as HTMLInputElement).value) || 10;
      const toiletCost = parseFloat((document.getElementById('tw3-cost') as HTMLInputElement).value) || 250;

      const totalFlushes = people * flushes * 365;

      const currentAnnual = totalFlushes * currentGPF;
      const lf16Annual = totalFlushes * 1.6;
      const ws128Annual = totalFlushes * 1.28;
      // Dual flush: assume 70% liquid (0.8) / 30% full (1.6)
      const dualAvg = 0.7 * 0.8 + 0.3 * 1.6;
      const dualAnnual = totalFlushes * dualAvg;
      const ultraAnnual = totalFlushes * 0.8;

      // Best upgrade option (WaterSense)
      const bestAnnual = ws128Annual;
      const waterSaved = currentAnnual - bestAnnual;
      const costSaved = waterSaved * rate / 1000;
      const totalCostToUpgrade = toiletCost * toilets;
      const payback = costSaved > 0 ? totalCostToUpgrade / costSaved : 99;
      const fiveYrNet = costSaved * 5 - totalCostToUpgrade;

      const dailyCurrent = people * flushes * currentGPF;

      document.getElementById('tw3-savings')!.textContent = Math.round(waterSaved).toLocaleString() + ' gallons';
      document.getElementById('tw3-curuse')!.textContent = Math.round(currentAnnual).toLocaleString() + ' gal/yr';
      document.getElementById('tw3-lf16')!.textContent = Math.round(lf16Annual).toLocaleString() + ' gal/yr';
      document.getElementById('tw3-ws128')!.textContent = Math.round(ws128Annual).toLocaleString() + ' gal/yr';
      document.getElementById('tw3-dual')!.textContent = Math.round(dualAnnual).toLocaleString() + ' gal/yr (avg ' + dualAvg.toFixed(2) + ' GPF)';
      document.getElementById('tw3-ultra')!.textContent = Math.round(ultraAnnual).toLocaleString() + ' gal/yr';
      document.getElementById('tw3-costsave')!.textContent = '$' + Math.round(costSaved);
      document.getElementById('tw3-payback')!.textContent = payback < 50 ? payback.toFixed(1) + ' yrs' : 'N/A';
      document.getElementById('tw3-dailycur')!.textContent = Math.round(dailyCurrent) + ' gal';
      document.getElementById('tw3-fiveyr')!.textContent = '$' + Math.round(fiveYrNet);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.tw3-in').forEach(el => { el.addEventListener('input', calcTW3); el.addEventListener('change', calcTW3); });
      calcTW3();
    }, 50);
  </script>
</CalculatorLayout>
