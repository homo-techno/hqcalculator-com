---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Air Quality Index Calculator - AQI & Health";
const description = "Calculate the Air Quality Index (AQI) from PM2.5, PM10, O3, and other pollutant concentrations.";
const relatedCalcs = [
  { name: "Carbon Footprint", url: "/carbon-footprint-calculator", description: "Carbon." },
  { name: "Dew Point", url: "/dew-point-calculator", description: "Dew point." },
  { name: "Heat Index", url: "/heat-index-calculator", description: "Heat index." },
  { name: "Wind Chill", url: "/wind-chill-calculator", description: "Wind chill." },
  { name: "pH Calculator", url: "/ph-calculator", description: "pH." },
  { name: "Temperature Converter", url: "/temperature-converter", description: "Temperature." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Air Quality Index Calculator" keywords="air quality index, AQI calculator, PM2.5, PM10, ozone, air pollution, health index" breadcrumbs={[{ name: "Air Quality Index", url: "/air-quality-index-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Air Quality Index Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate AQI from pollutant concentrations.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Pollutant</label>
          <select id="aq-poll" class="aq-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="pm25" selected>PM2.5 (µg/m³)</option>
            <option value="pm10">PM10 (µg/m³)</option>
            <option value="o3">Ozone - O₃ (ppb, 8hr avg)</option>
            <option value="co">CO (ppm, 8hr avg)</option>
            <option value="so2">SO₂ (ppb, 1hr avg)</option>
            <option value="no2">NO₂ (ppb, 1hr avg)</option>
          </select>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Concentration</label><input type="number" id="aq-conc" class="aq-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="35" min="0" step="0.1"></div>
        <div class="p-6 rounded-2xl text-white text-center" id="aq-display" style="background:#00e400">
          <div class="text-sm uppercase tracking-wide mb-1 opacity-80">Air Quality Index</div>
          <div class="text-5xl font-extrabold font-mono" id="aq-result">0</div>
          <div class="text-sm mt-1 opacity-80 font-bold" id="aq-cat">Good</div>
        </div>
        <div class="p-4 rounded-xl text-center" id="aq-health-box">
          <div class="font-bold text-sm" id="aq-health">-</div>
          <div class="text-xs mt-1" id="aq-advice">-</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">AQI Scale (EPA)</h3>
          <div class="text-xs space-y-1">
            <div class="flex gap-2"><span class="w-3 h-3 rounded flex-shrink-0 mt-0.5" style="background:#00e400"></span>0-50: Good</div>
            <div class="flex gap-2"><span class="w-3 h-3 rounded flex-shrink-0 mt-0.5" style="background:#ffff00"></span>51-100: Moderate</div>
            <div class="flex gap-2"><span class="w-3 h-3 rounded flex-shrink-0 mt-0.5" style="background:#ff7e00"></span>101-150: Unhealthy for Sensitive Groups</div>
            <div class="flex gap-2"><span class="w-3 h-3 rounded flex-shrink-0 mt-0.5" style="background:#ff0000"></span>151-200: Unhealthy</div>
            <div class="flex gap-2"><span class="w-3 h-3 rounded flex-shrink-0 mt-0.5" style="background:#8f3f97"></span>201-300: Very Unhealthy</div>
            <div class="flex gap-2"><span class="w-3 h-3 rounded flex-shrink-0 mt-0.5" style="background:#7e0023"></span>301-500: Hazardous</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="air-quality-index" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    type BP = { cLow: number; cHigh: number; iLow: number; iHigh: number };
    const BREAKPOINTS: Record<string, BP[]> = {
      pm25: [
        { cLow: 0, cHigh: 12, iLow: 0, iHigh: 50 },
        { cLow: 12.1, cHigh: 35.4, iLow: 51, iHigh: 100 },
        { cLow: 35.5, cHigh: 55.4, iLow: 101, iHigh: 150 },
        { cLow: 55.5, cHigh: 150.4, iLow: 151, iHigh: 200 },
        { cLow: 150.5, cHigh: 250.4, iLow: 201, iHigh: 300 },
        { cLow: 250.5, cHigh: 500.4, iLow: 301, iHigh: 500 },
      ],
      pm10: [
        { cLow: 0, cHigh: 54, iLow: 0, iHigh: 50 },
        { cLow: 55, cHigh: 154, iLow: 51, iHigh: 100 },
        { cLow: 155, cHigh: 254, iLow: 101, iHigh: 150 },
        { cLow: 255, cHigh: 354, iLow: 151, iHigh: 200 },
        { cLow: 355, cHigh: 424, iLow: 201, iHigh: 300 },
        { cLow: 425, cHigh: 604, iLow: 301, iHigh: 500 },
      ],
      o3: [
        { cLow: 0, cHigh: 54, iLow: 0, iHigh: 50 },
        { cLow: 55, cHigh: 70, iLow: 51, iHigh: 100 },
        { cLow: 71, cHigh: 85, iLow: 101, iHigh: 150 },
        { cLow: 86, cHigh: 105, iLow: 151, iHigh: 200 },
        { cLow: 106, cHigh: 200, iLow: 201, iHigh: 300 },
        { cLow: 201, cHigh: 604, iLow: 301, iHigh: 500 },
      ],
      co: [
        { cLow: 0, cHigh: 4.4, iLow: 0, iHigh: 50 },
        { cLow: 4.5, cHigh: 9.4, iLow: 51, iHigh: 100 },
        { cLow: 9.5, cHigh: 12.4, iLow: 101, iHigh: 150 },
        { cLow: 12.5, cHigh: 15.4, iLow: 151, iHigh: 200 },
        { cLow: 15.5, cHigh: 30.4, iLow: 201, iHigh: 300 },
        { cLow: 30.5, cHigh: 50.4, iLow: 301, iHigh: 500 },
      ],
      so2: [
        { cLow: 0, cHigh: 35, iLow: 0, iHigh: 50 },
        { cLow: 36, cHigh: 75, iLow: 51, iHigh: 100 },
        { cLow: 76, cHigh: 185, iLow: 101, iHigh: 150 },
        { cLow: 186, cHigh: 304, iLow: 151, iHigh: 200 },
        { cLow: 305, cHigh: 604, iLow: 201, iHigh: 300 },
        { cLow: 605, cHigh: 1004, iLow: 301, iHigh: 500 },
      ],
      no2: [
        { cLow: 0, cHigh: 53, iLow: 0, iHigh: 50 },
        { cLow: 54, cHigh: 100, iLow: 51, iHigh: 100 },
        { cLow: 101, cHigh: 360, iLow: 101, iHigh: 150 },
        { cLow: 361, cHigh: 649, iLow: 151, iHigh: 200 },
        { cLow: 650, cHigh: 1249, iLow: 201, iHigh: 300 },
        { cLow: 1250, cHigh: 2049, iLow: 301, iHigh: 500 },
      ],
    };
    function calcAQI() {
      const poll = (document.getElementById('aq-poll') as HTMLSelectElement).value;
      const conc = parseFloat((document.getElementById('aq-conc') as HTMLInputElement).value) || 0;
      const bps = BREAKPOINTS[poll];
      let aqi = 0;
      for (const bp of bps) {
        if (conc >= bp.cLow && conc <= bp.cHigh) {
          aqi = Math.round(((bp.iHigh - bp.iLow) / (bp.cHigh - bp.cLow)) * (conc - bp.cLow) + bp.iLow);
          break;
        }
      }
      if (conc > bps[bps.length - 1].cHigh) aqi = 500;
      document.getElementById('aq-result')!.textContent = String(aqi);
      let cat: string, color: string, health: string, advice: string, boxColor: string;
      if (aqi <= 50) { cat = 'Good'; color = '#00e400'; health = 'Air quality is satisfactory'; advice = 'No precautions needed'; boxColor = 'bg-green-50 text-green-800'; }
      else if (aqi <= 100) { cat = 'Moderate'; color = '#ffff00'; health = 'Acceptable air quality'; advice = 'Sensitive people should limit prolonged outdoor exertion'; boxColor = 'bg-yellow-50 text-yellow-800'; }
      else if (aqi <= 150) { cat = 'Unhealthy for Sensitive Groups'; color = '#ff7e00'; health = 'May affect sensitive groups'; advice = 'People with respiratory or heart disease should reduce outdoor activity'; boxColor = 'bg-orange-50 text-orange-800'; }
      else if (aqi <= 200) { cat = 'Unhealthy'; color = '#ff0000'; health = 'Health effects for everyone'; advice = 'Everyone should reduce prolonged outdoor exertion'; boxColor = 'bg-red-50 text-red-800'; }
      else if (aqi <= 300) { cat = 'Very Unhealthy'; color = '#8f3f97'; health = 'Health alert: serious effects'; advice = 'Avoid all outdoor exertion, keep windows closed'; boxColor = 'bg-purple-50 text-purple-800'; }
      else { cat = 'Hazardous'; color = '#7e0023'; health = 'Emergency conditions'; advice = 'Stay indoors, use air purifiers, seek medical attention if needed'; boxColor = 'bg-red-100 text-red-900'; }
      document.getElementById('aq-cat')!.textContent = cat;
      document.getElementById('aq-display')!.style.background = color;
      if (aqi <= 100) document.getElementById('aq-display')!.style.color = '#000'; else document.getElementById('aq-display')!.style.color = '#fff';
      document.getElementById('aq-health')!.textContent = health;
      document.getElementById('aq-advice')!.textContent = advice;
      document.getElementById('aq-health-box')!.className = `p-4 rounded-xl text-center ${boxColor}`;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.aq-in').forEach(el => { el.addEventListener('input', calcAQI); el.addEventListener('change', calcAQI); });
      calcAQI();
    }, 50);
  </script>
</CalculatorLayout>
