---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Annealing Temperature Calculator - Heat Treatment Guide";
const description = "Find annealing, normalizing, stress relief, and tempering temperatures for various metals and alloys. Complete heat treatment reference.";

const relatedCalcs = [
  { name: "Hardness Converter", url: "/hardness-converter-calculator", description: "Convert hardness scales." },
  { name: "Metal Expansion Calculator", url: "/metal-expansion-calculator", description: "Thermal expansion." },
  { name: "Welding Heat Input", url: "/welding-heat-input-calculator", description: "Weld heat input." },
  { name: "Metal Fatigue Calculator", url: "/metal-fatigue-calculator", description: "Fatigue life estimation." },
  { name: "Metal Weight Calculator", url: "/metal-weight-calculator", description: "Metal weight calculation." },
  { name: "Cutting Speed Calculator", url: "/cutting-speed-calculator", description: "Machining speeds." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Annealing Temperature Calculator"
  keywords="annealing temperature, heat treatment, tempering, normalizing, stress relief, quenching, hardening temperature, metal alloy"
  breadcrumbs={[{ name: "Annealing Temperature Calculator", url: "/annealing-temperature-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Annealing Temperature Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find annealing, tempering, normalizing, and stress-relief temperatures for metals and alloys.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Material Category -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Material Category</label>
        <select id="at2-category" class="at2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="carbon_steel">Carbon Steel</option>
          <option value="alloy_steel">Alloy Steel</option>
          <option value="stainless">Stainless Steel</option>
          <option value="tool_steel">Tool Steel</option>
          <option value="aluminum">Aluminum Alloys</option>
          <option value="copper">Copper Alloys</option>
          <option value="titanium">Titanium Alloys</option>
        </select>
      </div>

      <!-- Specific Alloy -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Specific Alloy</label>
        <select id="at2-alloy" class="at2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="1018">1018 Low Carbon</option>
        </select>
      </div>

      <!-- Temperature Unit -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Temperature Unit</label>
        <select id="at2-tunit" class="at2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="F">Fahrenheit</option>
          <option value="C">Celsius</option>
        </select>
      </div>

      <!-- Results -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Annealing Temperature</div>
        <div class="text-4xl font-extrabold" id="at2-anneal">--</div>
        <div class="text-sm text-blue-200 mt-1" id="at2-anneal-note">full anneal range</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Normalizing</div>
          <div class="text-xl font-bold" id="at2-normalize">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Stress Relief</div>
          <div class="text-xl font-bold" id="at2-stress">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Hardening</div>
          <div class="text-xl font-bold" id="at2-harden">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Tempering</div>
          <div class="text-xl font-bold" id="at2-temper">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-4">
        <div class="text-xs text-text-muted uppercase mb-2">Quench Medium</div>
        <div class="text-sm font-semibold" id="at2-quench">--</div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <div class="text-xs text-text-muted uppercase mb-2">Notes</div>
        <div class="text-sm" id="at2-notes">--</div>
      </div>

      <ShareButton calculatorId="annealing-temperature" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Heat Treatment Processes</h2>
      <ul>
        <li><strong>Annealing:</strong> Soften metal, relieve internal stresses, improve machinability. Heat to specified temp, slow cool in furnace.</li>
        <li><strong>Normalizing:</strong> Refine grain structure. Heat above critical, air cool.</li>
        <li><strong>Hardening:</strong> Increase hardness and strength. Heat to austenitizing temp, quench rapidly.</li>
        <li><strong>Tempering:</strong> Reduce brittleness after hardening. Heat to lower temp, air cool. Higher temp = more ductility, less hardness.</li>
        <li><strong>Stress Relief:</strong> Remove residual stresses from welding, machining, or forming without significant microstructural change.</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const at2Data: Record<string, Record<string, {anneal:[number,number], normalize:[number,number], stress:[number,number], harden:[number,number], temper:[number,number], quench:string, notes:string}>> = {
      carbon_steel: {
        '1018': {anneal:[1550,1650], normalize:[1650,1700], stress:[1000,1200], harden:[1575,1650], temper:[300,600], quench:'Water or oil', notes:'Low carbon, limited hardenability. Case hardening recommended for wear surfaces.'},
        '1045': {anneal:[1450,1550], normalize:[1550,1600], stress:[1000,1200], harden:[1475,1550], temper:[400,1000], quench:'Oil or water', notes:'Medium carbon. Good balance of strength and ductility after heat treatment.'},
        '1095': {anneal:[1400,1500], normalize:[1500,1600], stress:[1000,1200], harden:[1450,1525], temper:[350,800], quench:'Oil', notes:'High carbon spring/blade steel. Excellent edge retention. Risk of cracking with water quench.'},
        'A36': {anneal:[1550,1650], normalize:[1600,1700], stress:[1000,1200], harden:[0,0], temper:[0,0], quench:'N/A - not typically hardened', notes:'Structural steel. Welding preheat 50-400F depending on thickness.'}
      },
      alloy_steel: {
        '4130': {anneal:[1525,1600], normalize:[1600,1700], stress:[1000,1200], harden:[1525,1600], temper:[400,1300], quench:'Oil', notes:'Chromoly. Excellent for aircraft and race car chassis. Normalize after welding.'},
        '4140': {anneal:[1450,1550], normalize:[1600,1650], stress:[1000,1200], harden:[1500,1575], temper:[400,1300], quench:'Oil', notes:'Very versatile alloy steel. Widely used for shafts, gears, and tooling.'},
        '4340': {anneal:[1450,1550], normalize:[1600,1650], stress:[1000,1200], harden:[1475,1550], temper:[400,1200], quench:'Oil', notes:'High strength alloy. Used in landing gear, drive shafts, and heavy-duty applications.'},
        '8620': {anneal:[1525,1600], normalize:[1650,1700], stress:[1000,1200], harden:[1525,1575], temper:[300,600], quench:'Oil or water', notes:'Case hardening steel. Excellent for gears and bearings.'}
      },
      stainless: {
        '304': {anneal:[1900,2050], normalize:[0,0], stress:[700,900], harden:[0,0], temper:[0,0], quench:'Water quench from anneal temp', notes:'Austenitic. Cannot be hardened by heat treatment. Anneal to restore corrosion resistance after welding.'},
        '316': {anneal:[1900,2100], normalize:[0,0], stress:[700,900], harden:[0,0], temper:[0,0], quench:'Water quench from anneal temp', notes:'Austenitic with molybdenum. Superior corrosion resistance. Same heat treatment as 304.'},
        '410': {anneal:[1400,1500], normalize:[1700,1800], stress:[400,800], harden:[1700,1850], temper:[400,1400], quench:'Air or oil', notes:'Martensitic stainless. Can be hardened. Used for cutlery, valves, and pump shafts.'},
        '17-4PH': {anneal:[1900,1950], normalize:[0,0], stress:[0,0], harden:[1900,1950], temper:[900,1150], quench:'Air cool, then age harden', notes:'Precipitation hardening. Age at 900F for H900 (highest hardness) to 1150F for H1150 (best toughness).'}
      },
      tool_steel: {
        'O1': {anneal:[1400,1450], normalize:[0,0], stress:[1000,1200], harden:[1450,1500], temper:[350,500], quench:'Oil', notes:'Oil-hardening tool steel. Excellent for dies, punches, and cutting tools. Temper immediately after quench.'},
        'D2': {anneal:[1600,1650], normalize:[0,0], stress:[1000,1100], harden:[1800,1875], temper:[400,1000], quench:'Air', notes:'Air-hardening cold work steel. Excellent wear resistance. Double temper recommended.'},
        'A2': {anneal:[1525,1600], normalize:[0,0], stress:[1000,1200], harden:[1725,1800], temper:[350,800], quench:'Air', notes:'Air-hardening. Good toughness and wear resistance. Popular for punches and dies.'},
        'W1': {anneal:[1360,1450], normalize:[0,0], stress:[1000,1200], harden:[1425,1500], temper:[350,650], quench:'Water (brine)', notes:'Water-hardening. Traditional tool steel. Shallow hardening, tough core.'}
      },
      aluminum: {
        '6061': {anneal:[775,775], normalize:[0,0], stress:[500,550], harden:[985,1000], temper:[320,350], quench:'Water', notes:'Solution heat treat at 985F, water quench, then age (T6 temper) at 320F for 18 hrs. Anneal at 775F, slow cool.'},
        '7075': {anneal:[775,775], normalize:[0,0], stress:[500,550], harden:[870,890], temper:[250,325], quench:'Water', notes:'Aerospace aluminum. Solution treat at 870F, water quench, age at 250F for T6. Very high strength.'},
        '2024': {anneal:[775,775], normalize:[0,0], stress:[500,550], harden:[920,935], temper:[375,375], quench:'Water', notes:'Aircraft aluminum. Solution treat at 920F, water quench. Natural aging (T4) or artificial aging at 375F (T6).'},
        '5052': {anneal:[650,650], normalize:[0,0], stress:[400,450], harden:[0,0], temper:[0,0], quench:'N/A - non-heat-treatable', notes:'Work hardening only. Anneal at 650F to restore ductility after cold working. Good corrosion resistance.'}
      },
      copper: {
        'C110': {anneal:[700,1200], normalize:[0,0], stress:[400,600], harden:[0,0], temper:[0,0], quench:'Air or water', notes:'Pure copper. Anneal to soften after cold working. Cannot be hardened by heat treatment.'},
        'C260': {anneal:[800,1100], normalize:[0,0], stress:[500,700], harden:[0,0], temper:[0,0], quench:'Air or water', notes:'Cartridge brass (70/30). Stress relieve at 500F to prevent season cracking.'},
        'C510': {anneal:[900,1250], normalize:[0,0], stress:[400,600], harden:[0,0], temper:[0,0], quench:'Air', notes:'Phosphor bronze. Cold work for strength. Anneal between cold working operations.'},
        'C172': {anneal:[1425,1475], normalize:[0,0], stress:[0,0], harden:[1425,1475], temper:[600,700], quench:'Water', notes:'Beryllium copper. Solution treat, quench, age at 600F. Extremely hard and conductive.'}
      },
      titanium: {
        'Ti-6Al-4V': {anneal:[1300,1400], normalize:[0,0], stress:[900,1100], harden:[1700,1800], temper:[900,1100], quench:'Water or air', notes:'Most common titanium alloy. Mill anneal at 1300F. Solution treat + age for maximum strength.'},
        'CP-Ti-Gr2': {anneal:[1200,1350], normalize:[0,0], stress:[800,1000], harden:[0,0], temper:[0,0], quench:'Air', notes:'Commercially pure Grade 2. Anneal to restore ductility. Cannot be strengthened by heat treatment.'},
        'Ti-6Al-2Sn': {anneal:[1300,1500], normalize:[0,0], stress:[900,1100], harden:[1650,1750], temper:[1000,1100], quench:'Air', notes:'Near-alpha alloy for high-temperature service. Good creep resistance.'},
        'Ti-3Al-2.5V': {anneal:[1300,1400], normalize:[0,0], stress:[800,1000], harden:[1550,1650], temper:[900,1000], quench:'Water', notes:'Used for hydraulic tubing and bicycle frames. Solution treat + age for higher strength.'}
      }
    };

    function updateAlloys() {
      const cat = (document.getElementById('at2-category') as HTMLSelectElement).value;
      const alloySelect = document.getElementById('at2-alloy') as HTMLSelectElement;
      const alloys = at2Data[cat] || {};
      alloySelect.innerHTML = '';
      for (const key of Object.keys(alloys)) {
        const opt = document.createElement('option');
        opt.value = key;
        opt.textContent = key;
        alloySelect.appendChild(opt);
      }
    }

    function calcAT2() {
      const cat = (document.getElementById('at2-category') as HTMLSelectElement).value;
      const alloy = (document.getElementById('at2-alloy') as HTMLSelectElement).value;
      const tunit = (document.getElementById('at2-tunit') as HTMLSelectElement).value;

      const data = at2Data[cat]?.[alloy];
      if (!data) return;

      const conv = (f: number) => {
        if (tunit === 'C') return Math.round((f - 32) * 5 / 9);
        return f;
      };
      const suffix = tunit === 'C' ? ' C' : ' F';
      const deg = '\u00B0';

      const rangeStr = (r: [number, number]) => {
        if (r[0] === 0 && r[1] === 0) return 'N/A';
        if (r[0] === r[1]) return conv(r[0]) + deg + suffix;
        return conv(r[0]) + ' - ' + conv(r[1]) + deg + suffix;
      };

      document.getElementById('at2-anneal')!.textContent = rangeStr(data.anneal);
      document.getElementById('at2-normalize')!.textContent = rangeStr(data.normalize);
      document.getElementById('at2-stress')!.textContent = rangeStr(data.stress);
      document.getElementById('at2-harden')!.textContent = rangeStr(data.harden);
      document.getElementById('at2-temper')!.textContent = rangeStr(data.temper);
      document.getElementById('at2-quench')!.textContent = data.quench;
      document.getElementById('at2-notes')!.textContent = data.notes;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.getElementById('at2-category')!.addEventListener('change', () => { updateAlloys(); calcAT2(); });

      document.querySelectorAll('.at2-in').forEach(el => {
        el.addEventListener('input', calcAT2);
        el.addEventListener('change', calcAT2);
      });

      updateAlloys();
      calcAT2();
    }, 50);
  </script>
</CalculatorLayout>
