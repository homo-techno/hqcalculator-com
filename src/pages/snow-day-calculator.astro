---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Snow Day Calculator - Will School Be Cancelled?";
const description = "Predict the likelihood of a snow day based on weather conditions. A fun, educational tool that considers snowfall, temperature, wind, and timing.";

const relatedCalcs = [
  { name: "Temperature Converter", url: "/temperature-converter", description: "Temperature units." },
  { name: "Probability Calculator", url: "/probability-calculator", description: "Probability." },
  { name: "Random Number", url: "/random-number-generator", description: "Random numbers." },
  { name: "Date Calculator", url: "/date-calculator", description: "Date math." },
  { name: "Sleep Calculator", url: "/sleep-calculator", description: "Sleep cycles." },
  { name: "Love Calculator", url: "/love-calculator", description: "Fun calculator." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Snow Day Calculator"
  keywords="snow day calculator, will school be cancelled, snow day predictor, school closure, snow day chance"
  breadcrumbs={[{ name: "Snow Day Calculator", url: "/snow-day-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Snow Day Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Answer a few questions to predict the chance of a snow day tomorrow.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-5 mb-6">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Expected Snowfall</label>
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
            <button class="sd-snow-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="0">None</button>
            <button class="sd-snow-btn px-3 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary text-center" data-val="2">1-3 inches</button>
            <button class="sd-snow-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="5">4-6 inches</button>
            <button class="sd-snow-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="10">7+ inches</button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-text mb-2">Low Temperature</label>
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
            <button class="sd-temp-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="35">Above 32°F</button>
            <button class="sd-temp-btn px-3 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary text-center" data-val="25">25-32°F</button>
            <button class="sd-temp-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="15">15-24°F</button>
            <button class="sd-temp-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="0">Below 15°F</button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-text mb-2">Wind Conditions</label>
          <div class="grid grid-cols-3 gap-2">
            <button class="sd-wind-btn px-3 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary text-center" data-val="0">Calm</button>
            <button class="sd-wind-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="1">Moderate</button>
            <button class="sd-wind-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="2">High/Blizzard</button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-text mb-2">Ice Expected?</label>
          <div class="grid grid-cols-3 gap-2">
            <button class="sd-ice-btn px-3 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary text-center" data-val="0">No</button>
            <button class="sd-ice-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="1">Light</button>
            <button class="sd-ice-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="2">Heavy</button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-text mb-2">Your Area</label>
          <div class="grid grid-cols-3 gap-2">
            <button class="sd-area-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="north">Northern</button>
            <button class="sd-area-btn px-3 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary text-center" data-val="mid">Mid-Atlantic</button>
            <button class="sd-area-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="south">Southern</button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-text mb-2">When Does the Storm Hit?</label>
          <div class="grid grid-cols-3 gap-2">
            <button class="sd-timing-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="evening">Evening before</button>
            <button class="sd-timing-btn px-3 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary text-center" data-val="overnight">Overnight</button>
            <button class="sd-timing-btn px-3 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="morning">Early morning</button>
          </div>
        </div>
      </div>

      <!-- Result -->
      <div class="p-6 rounded-2xl text-white text-center mb-4" id="sd-result-box" style="background: #3b82f6;">
        <div class="text-sm uppercase tracking-wide mb-2 opacity-80">Snow Day Chance</div>
        <div class="text-6xl font-extrabold" id="sd-chance">45%</div>
        <div class="text-lg mt-2 font-semibold" id="sd-verdict">Maybe — Check Back Later!</div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-6 text-center">
        <div class="text-sm text-text-secondary" id="sd-tip">Tip: Wear your pajamas inside out and put a spoon under your pillow for good luck!</div>
      </div>

      <div class="text-xs text-text-muted text-center mb-6">
        This is for entertainment purposes only. Always check official announcements from your school district.
      </div>

      <ShareButton calculatorId="snow-day" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">How the Snow Day Calculator Works</h2>
      <p>This calculator estimates the probability of school cancellation based on several weather factors. It's a fun prediction tool — not a replacement for official school closure announcements.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Factors That Affect Snow Days</h3>
      <ul>
        <li><strong>Snowfall amount:</strong> More snow = higher chance. Even 2-3 inches can close schools in areas that rarely get snow.</li>
        <li><strong>Temperature:</strong> Extreme cold can cause closures even without snow due to dangerous wind chills.</li>
        <li><strong>Ice:</strong> Freezing rain and ice storms are more dangerous than snow and often lead to closures.</li>
        <li><strong>Timing:</strong> Overnight storms that end by morning give plows time to clear roads; early morning storms are worse.</li>
        <li><strong>Region:</strong> Southern states close with less snow since they have less snow removal infrastructure.</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let sdSnow = 2, sdTemp = 25, sdWind = 0, sdIce = 0, sdArea = 'mid', sdTiming = 'overnight';

    function setupToggle(cls: string, setter: (v: string) => void) {
      document.querySelectorAll(`.${cls}`).forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll(`.${cls}`).forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          setter(((btn as HTMLElement).dataset.val || (btn as HTMLElement).dataset.val) || '0');
          calcSnowDay();
        });
      });
    }

    function calcSnowDay() {
      let score = 0;

      // Snowfall (0-40 points)
      if (sdSnow >= 10) score += 40;
      else if (sdSnow >= 5) score += 30;
      else if (sdSnow >= 2) score += 15;

      // Temperature (0-15 points)
      if (sdTemp <= 0) score += 15;
      else if (sdTemp <= 15) score += 10;
      else if (sdTemp <= 25) score += 5;

      // Wind (0-15 points)
      score += sdWind * 7.5;

      // Ice (0-25 points)
      score += sdIce * 12.5;

      // Area modifier
      if (sdArea === 'south') score *= 1.5; // South closes easier
      else if (sdArea === 'north') score *= 0.7; // North is used to snow

      // Timing modifier
      if (sdTiming === 'morning') score *= 1.2;
      else if (sdTiming === 'evening') score *= 0.9;

      const chance = Math.min(99, Math.max(1, Math.round(score)));

      document.getElementById('sd-chance')!.textContent = chance + '%';

      let color: string, verdict: string, tip: string;
      if (chance >= 85) {
        color = '#22c55e'; verdict = 'Almost Certain Snow Day!'; tip = 'Start planning your snow fort now!';
      } else if (chance >= 65) {
        color = '#16a34a'; verdict = 'Very Likely!'; tip = 'Don\'t set your alarm too early — there\'s a good chance!';
      } else if (chance >= 45) {
        color = '#eab308'; verdict = 'Maybe — Check Back Later!'; tip = 'Wear your pajamas inside out and put a spoon under your pillow for good luck!';
      } else if (chance >= 25) {
        color = '#f97316'; verdict = 'Unlikely, But Possible'; tip = 'Better finish that homework just in case...';
      } else {
        color = '#ef4444'; verdict = 'Probably Going to School'; tip = 'Sorry! Maybe next time. Bundle up!';
      }

      document.getElementById('sd-result-box')!.style.backgroundColor = color;
      document.getElementById('sd-verdict')!.textContent = verdict;
      document.getElementById('sd-tip')!.textContent = tip;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      setupToggle('sd-snow-btn', v => sdSnow = parseInt(v));
      setupToggle('sd-temp-btn', v => sdTemp = parseInt(v));
      setupToggle('sd-wind-btn', v => sdWind = parseInt(v));
      setupToggle('sd-ice-btn', v => sdIce = parseInt(v));
      setupToggle('sd-area-btn', v => sdArea = v);
      setupToggle('sd-timing-btn', v => sdTiming = v);
      calcSnowDay();
    }, 50);
  </script>
</CalculatorLayout>
