---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Volume Calculator - Calculate 3D Shape Volumes";
const description = "Calculate the volume of cubes, spheres, cylinders, cones, pyramids, and more. Convert between volume units.";

const relatedCalcs = [
  { name: "Square Footage", url: "/square-footage-calculator", description: "Area calculator." },
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume." },
  { name: "Gravel Calculator", url: "/gravel-calculator", description: "Gravel volume." },
  { name: "Length Converter", url: "/length-converter", description: "Length units." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math." },
  { name: "Ratio Calculator", url: "/ratio-calculator", description: "Ratios." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Volume Calculator"
  keywords="volume calculator, sphere volume, cylinder volume, cone volume, cube volume, 3D shape calculator"
  breadcrumbs={[{ name: "Volume Calculator", url: "/volume-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Volume Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate the volume of any 3D shape with unit conversions.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Shape</label>
            <div class="grid grid-cols-3 gap-2">
              <button class="vc-shape-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary" data-shape="box">Box</button>
              <button class="vc-shape-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-shape="sphere">Sphere</button>
              <button class="vc-shape-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-shape="cylinder">Cylinder</button>
              <button class="vc-shape-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-shape="cone">Cone</button>
              <button class="vc-shape-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-shape="pyramid">Pyramid</button>
              <button class="vc-shape-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-shape="hemisphere">Hemisphere</button>
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Input Unit</label>
            <select id="vc-unit" class="w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="in">inches</option>
              <option value="ft" selected>feet</option>
              <option value="cm">centimeters</option>
              <option value="m">meters</option>
              <option value="yd">yards</option>
            </select>
          </div>

          <!-- Box inputs -->
          <div id="vc-box" class="mb-5">
            <div class="grid grid-cols-3 gap-3">
              <div><label class="block text-xs font-medium text-text mb-1">Length</label><input type="number" id="vc-length" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="10" min="0" step="any"></div>
              <div><label class="block text-xs font-medium text-text mb-1">Width</label><input type="number" id="vc-width" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="8" min="0" step="any"></div>
              <div><label class="block text-xs font-medium text-text mb-1">Height</label><input type="number" id="vc-height" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="6" min="0" step="any"></div>
            </div>
          </div>

          <!-- Sphere inputs -->
          <div id="vc-sphere" class="mb-5 hidden">
            <div><label class="block text-xs font-medium text-text mb-1">Radius</label><input type="number" id="vc-radius" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="5" min="0" step="any"></div>
          </div>

          <!-- Cylinder inputs -->
          <div id="vc-cylinder" class="mb-5 hidden">
            <div class="grid grid-cols-2 gap-3">
              <div><label class="block text-xs font-medium text-text mb-1">Radius</label><input type="number" id="vc-cyl-r" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="4" min="0" step="any"></div>
              <div><label class="block text-xs font-medium text-text mb-1">Height</label><input type="number" id="vc-cyl-h" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="10" min="0" step="any"></div>
            </div>
          </div>

          <!-- Cone inputs -->
          <div id="vc-cone" class="mb-5 hidden">
            <div class="grid grid-cols-2 gap-3">
              <div><label class="block text-xs font-medium text-text mb-1">Radius</label><input type="number" id="vc-cone-r" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="4" min="0" step="any"></div>
              <div><label class="block text-xs font-medium text-text mb-1">Height</label><input type="number" id="vc-cone-h" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="10" min="0" step="any"></div>
            </div>
          </div>

          <!-- Pyramid inputs -->
          <div id="vc-pyramid" class="mb-5 hidden">
            <div class="grid grid-cols-3 gap-3">
              <div><label class="block text-xs font-medium text-text mb-1">Base Length</label><input type="number" id="vc-pyr-l" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="6" min="0" step="any"></div>
              <div><label class="block text-xs font-medium text-text mb-1">Base Width</label><input type="number" id="vc-pyr-w" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="6" min="0" step="any"></div>
              <div><label class="block text-xs font-medium text-text mb-1">Height</label><input type="number" id="vc-pyr-h" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="10" min="0" step="any"></div>
            </div>
          </div>

          <!-- Hemisphere -->
          <div id="vc-hemisphere" class="mb-5 hidden">
            <div><label class="block text-xs font-medium text-text mb-1">Radius</label><input type="number" id="vc-hemi-r" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="5" min="0" step="any"></div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Volume</div>
            <div class="text-4xl font-extrabold" id="vc-result">0</div>
            <div class="text-sm text-blue-200 mt-1" id="vc-result-unit">ft³</div>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-2">Volume Conversions</h3>
            <div class="grid grid-cols-2 gap-2 text-sm" id="vc-conversions"></div>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Formula Used</div>
            <div class="text-lg font-bold font-mono" id="vc-formula">L × W × H</div>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-2">Surface Area</h3>
            <div class="text-xl font-bold text-center" id="vc-surface">0 ft²</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="volume" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Volume Formulas</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Box:</strong> V = L × W × H</p>
        <p><strong>Sphere:</strong> V = (4/3)πr³</p>
        <p><strong>Cylinder:</strong> V = πr²h</p>
        <p><strong>Cone:</strong> V = (1/3)πr²h</p>
        <p><strong>Pyramid:</strong> V = (1/3) × L × W × H</p>
        <p><strong>Hemisphere:</strong> V = (2/3)πr³</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How do I convert cubic feet to gallons?</strong> 1 cubic foot = 7.48052 gallons.</p>
      <p><strong>How many cubic feet in a cubic yard?</strong> 1 cubic yard = 27 cubic feet.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let vcShape = 'box';
    const shapes = ['box', 'sphere', 'cylinder', 'cone', 'pyramid', 'hemisphere'];
    // Unit to feet conversion
    const toFt: Record<string, number> = { in: 1/12, ft: 1, cm: 0.0328084, m: 3.28084, yd: 3 };
    const unitCubed: Record<string, string> = { in: 'in³', ft: 'ft³', cm: 'cm³', m: 'm³', yd: 'yd³' };

    function getVal(id: string): number {
      const unit = (document.getElementById('vc-unit') as HTMLSelectElement).value;
      return (parseFloat((document.getElementById(id) as HTMLInputElement).value) || 0) * toFt[unit];
    }

    function calcVolume() {
      const unit = (document.getElementById('vc-unit') as HTMLSelectElement).value;
      let volumeFt3 = 0;
      let surfaceAreaFt2 = 0;
      let formula = '';

      if (vcShape === 'box') {
        const l = getVal('vc-length'), w = getVal('vc-width'), h = getVal('vc-height');
        volumeFt3 = l * w * h;
        surfaceAreaFt2 = 2 * (l*w + l*h + w*h);
        formula = 'L × W × H';
      } else if (vcShape === 'sphere') {
        const r = getVal('vc-radius');
        volumeFt3 = (4/3) * Math.PI * r**3;
        surfaceAreaFt2 = 4 * Math.PI * r**2;
        formula = '(4/3)πr³';
      } else if (vcShape === 'cylinder') {
        const r = getVal('vc-cyl-r'), h = getVal('vc-cyl-h');
        volumeFt3 = Math.PI * r**2 * h;
        surfaceAreaFt2 = 2 * Math.PI * r * (r + h);
        formula = 'πr²h';
      } else if (vcShape === 'cone') {
        const r = getVal('vc-cone-r'), h = getVal('vc-cone-h');
        volumeFt3 = (1/3) * Math.PI * r**2 * h;
        const slant = Math.sqrt(r**2 + h**2);
        surfaceAreaFt2 = Math.PI * r * (r + slant);
        formula = '(1/3)πr²h';
      } else if (vcShape === 'pyramid') {
        const l = getVal('vc-pyr-l'), w = getVal('vc-pyr-w'), h = getVal('vc-pyr-h');
        volumeFt3 = (1/3) * l * w * h;
        surfaceAreaFt2 = l * w + l * Math.sqrt((w/2)**2 + h**2) + w * Math.sqrt((l/2)**2 + h**2);
        formula = '(1/3)LWH';
      } else if (vcShape === 'hemisphere') {
        const r = getVal('vc-hemi-r');
        volumeFt3 = (2/3) * Math.PI * r**3;
        surfaceAreaFt2 = 3 * Math.PI * r**2;
        formula = '(2/3)πr³';
      }

      // Convert back to input units for display
      const ftToUnit = 1 / toFt[unit];
      const volInUnit = volumeFt3 * ftToUnit**3;
      const saInUnit = surfaceAreaFt2 * ftToUnit**2;

      const fmt = (n: number) => n < 0.01 ? n.toExponential(4) : n.toLocaleString('en-US', { maximumFractionDigits: 4 });

      document.getElementById('vc-result')!.textContent = fmt(volInUnit);
      document.getElementById('vc-result-unit')!.textContent = unitCubed[unit];
      document.getElementById('vc-formula')!.textContent = formula;
      document.getElementById('vc-surface')!.textContent = fmt(saInUnit) + ' ' + unit + '²';

      // Conversions
      const conversions: [string, number][] = [
        ['in³', volumeFt3 * 1728],
        ['ft³', volumeFt3],
        ['yd³', volumeFt3 / 27],
        ['cm³', volumeFt3 * 28316.846],
        ['m³', volumeFt3 * 0.0283168],
        ['liters', volumeFt3 * 28.3168],
        ['gallons', volumeFt3 * 7.48052],
      ];
      document.getElementById('vc-conversions')!.innerHTML = conversions.map(([name, val]) =>
        `<div class="flex justify-between p-1"><span class="text-text-muted">${name}</span><span class="font-bold">${fmt(val)}</span></div>`
      ).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.vc-shape-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.vc-shape-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          vcShape = (btn as HTMLElement).dataset.shape || 'box';
          shapes.forEach(s => document.getElementById(`vc-${s}`)!.classList.toggle('hidden', s !== vcShape));
          calcVolume();
        });
      });

      ['vc-length', 'vc-width', 'vc-height', 'vc-radius', 'vc-cyl-r', 'vc-cyl-h', 'vc-cone-r', 'vc-cone-h', 'vc-pyr-l', 'vc-pyr-w', 'vc-pyr-h', 'vc-hemi-r'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcVolume);
      });
      document.getElementById('vc-unit')!.addEventListener('change', calcVolume);

      calcVolume();
    }, 50);
  </script>
</CalculatorLayout>
