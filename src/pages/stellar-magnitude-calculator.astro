---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Stellar Magnitude Calculator";
const description = "Calculate apparent and absolute magnitude, distance modulus, luminosity ratio, and flux comparison for stars and celestial objects.";
const relatedCalcs = [
  { name: "Orbital Period", url: "/orbital-period-calculator", description: "Orbital periods." },
  { name: "Escape Velocity", url: "/escape-velocity-calculator", description: "Escape speed." },
  { name: "Light Intensity", url: "/light-intensity-calculator", description: "Light levels." },
  { name: "Scientific Notation", url: "/scientific-notation-calculator", description: "Notation." },
  { name: "Logarithm", url: "/logarithm-calculator", description: "Log functions." },
  { name: "Distance Converter", url: "/length-converter-calculator", description: "Distances." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Stellar Magnitude Calculator" keywords="stellar magnitude, apparent magnitude, absolute magnitude, distance modulus, luminosity ratio, flux comparison" breadcrumbs={[{ name: "Stellar Magnitude", url: "/stellar-magnitude-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Stellar Magnitude Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate apparent/absolute magnitude, distance modulus, and luminosity ratios using the magnitude system.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div><label class="block text-xs font-medium text-text mb-1">Mode</label>
          <select id="sg-mode" class="sg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="dist" selected>Distance Modulus (m, M, d)</option>
            <option value="lum">Luminosity / Flux Ratio</option>
          </select>
        </div>
        <div id="sg-dist-panel">
          <div><label class="block text-xs font-medium text-text mb-1">Solve For</label>
            <select id="sg-solve" class="sg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="abs" selected>Absolute Magnitude (M)</option>
              <option value="app">Apparent Magnitude (m)</option>
              <option value="distance">Distance (parsecs)</option>
            </select>
          </div>
          <div class="grid grid-cols-2 gap-3 mt-3">
            <div><label class="block text-xs font-medium text-text mb-1">Apparent Magnitude (m)</label><input type="number" id="sg-app" class="sg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.46" step="0.01"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Absolute Magnitude (M)</label><input type="number" id="sg-abs" class="sg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.42" step="0.01"></div>
          </div>
          <div class="mt-3"><label class="block text-xs font-medium text-text mb-1">Distance (parsecs)</label><input type="number" id="sg-dist" class="sg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2.64" step="0.01" min="0.001"></div>
        </div>
        <div id="sg-lum-panel" style="display:none;">
          <div class="grid grid-cols-2 gap-3">
            <div><label class="block text-xs font-medium text-text mb-1">Magnitude Star 1</label><input type="number" id="sg-m1" class="sg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="-1.46" step="0.01"></div>
            <div><label class="block text-xs font-medium text-text mb-1">Magnitude Star 2</label><input type="number" id="sg-m2" class="sg-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.00" step="0.01"></div>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="sg-label">Result</div>
          <div class="text-5xl font-extrabold font-mono" id="sg-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Distance Modulus (m-M)</div><div class="text-xl font-bold font-mono" id="sg-dm">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Distance (light-years)</div><div class="text-xl font-bold font-mono" id="sg-ly">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Flux Ratio</div><div class="text-xl font-bold font-mono" id="sg-flux">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Luminosity vs Sun</div><div class="text-xl font-bold font-mono" id="sg-lumsun">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="stellar-magnitude" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcSG() {
      const mode = (document.getElementById('sg-mode') as HTMLSelectElement).value;
      const distPanel = document.getElementById('sg-dist-panel') as HTMLElement;
      const lumPanel = document.getElementById('sg-lum-panel') as HTMLElement;
      distPanel.style.display = mode === 'dist' ? 'block' : 'none';
      lumPanel.style.display = mode === 'lum' ? 'block' : 'none';

      if (mode === 'dist') {
        const solve = (document.getElementById('sg-solve') as HTMLSelectElement).value;
        let m = parseFloat((document.getElementById('sg-app') as HTMLInputElement).value);
        let M = parseFloat((document.getElementById('sg-abs') as HTMLInputElement).value);
        let d = parseFloat((document.getElementById('sg-dist') as HTMLInputElement).value);

        if (solve === 'abs') {
          M = m - 5 * (Math.log10(d) - 1);
          document.getElementById('sg-label')!.textContent = 'Absolute Magnitude (M)';
          document.getElementById('sg-result')!.textContent = M.toFixed(2);
        } else if (solve === 'app') {
          m = M + 5 * (Math.log10(d) - 1);
          document.getElementById('sg-label')!.textContent = 'Apparent Magnitude (m)';
          document.getElementById('sg-result')!.textContent = m.toFixed(2);
        } else {
          d = Math.pow(10, (m - M + 5) / 5);
          document.getElementById('sg-label')!.textContent = 'Distance (parsecs)';
          document.getElementById('sg-result')!.textContent = d.toFixed(2) + ' pc';
        }
        const dm = m - M;
        const ly = d * 3.26156;
        const fluxRatio = Math.pow(10, dm / -2.5);
        const sunAbsMag = 4.83;
        const lumSun = Math.pow(10, (sunAbsMag - M) / 2.5);
        document.getElementById('sg-dm')!.textContent = dm.toFixed(2);
        document.getElementById('sg-ly')!.textContent = ly.toFixed(2) + ' ly';
        document.getElementById('sg-flux')!.textContent = fluxRatio.toFixed(4);
        document.getElementById('sg-lumsun')!.textContent = lumSun.toFixed(2) + ' L\u2609';
      } else {
        const m1 = parseFloat((document.getElementById('sg-m1') as HTMLInputElement).value);
        const m2 = parseFloat((document.getElementById('sg-m2') as HTMLInputElement).value);
        const ratio = Math.pow(10, (m2 - m1) / 2.5);
        document.getElementById('sg-label')!.textContent = 'Flux Ratio (Star1 / Star2)';
        document.getElementById('sg-result')!.textContent = ratio.toFixed(4) + '\u00d7';
        const magDiff = m2 - m1;
        document.getElementById('sg-dm')!.textContent = magDiff.toFixed(2) + ' mag';
        document.getElementById('sg-ly')!.textContent = '--';
        document.getElementById('sg-flux')!.textContent = ratio.toFixed(4);
        document.getElementById('sg-lumsun')!.textContent = '--';
      }
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.sg-in').forEach(el => { el.addEventListener('input', calcSG); el.addEventListener('change', calcSG); });
      calcSG();
    }, 50);
  </script>
</CalculatorLayout>
