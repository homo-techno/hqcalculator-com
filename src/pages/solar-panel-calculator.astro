---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Solar Panel Calculator - System Size & Savings";
const description = "Calculate how many solar panels you need, system cost, and estimated savings based on your electricity usage.";
const relatedCalcs = [
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Electricity." },
  { name: "BTU Calculator", url: "/btu-calculator", description: "BTU sizing." },
  { name: "Carbon Footprint", url: "/carbon-footprint-calculator", description: "Carbon." },
  { name: "ROI Calculator", url: "/roi-calculator", description: "ROI." },
  { name: "Compound Interest", url: "/compound-interest-calculator", description: "Compound." },
  { name: "Square Footage", url: "/square-footage-calculator", description: "Sq ft." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Solar Panel Calculator" keywords="solar panel calculator, solar system size, solar savings, how many solar panels, solar cost" breadcrumbs={[{ name: "Solar Panel", url: "/solar-panel-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Solar Panel Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your solar panel system size, cost, and savings.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Monthly Electric Bill ($)</label><input type="number" id="sp-bill" class="sp-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="150" min="0" step="10"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Electricity Rate ($/kWh)</label><input type="number" id="sp-rate" class="sp-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.13" min="0.01" step="0.01"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Peak Sun Hours/Day</label><input type="number" id="sp-sun" class="sp-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="1" max="8" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Panel Wattage (W)</label><input type="number" id="sp-watt" class="sp-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="400" min="100" max="600" step="10"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">System Cost ($/Watt)</label><input type="number" id="sp-cost" class="sp-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2.75" min="0.5" step="0.25"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Energy Offset (%)</label><input type="number" id="sp-offset" class="sp-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="100" min="10" max="150" step="10"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">System Size</div>
          <div class="text-4xl font-extrabold" id="sp-size">0 kW</div>
          <div class="text-sm text-blue-200 mt-1" id="sp-panels">0 panels</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-5 bg-secondary rounded-2xl text-white text-center">
            <div class="text-xs uppercase tracking-wide mb-1 opacity-80">System Cost (before ITC)</div>
            <div class="text-2xl font-extrabold" id="sp-total">$0</div>
          </div>
          <div class="p-5 bg-green-600 rounded-2xl text-white text-center">
            <div class="text-xs uppercase tracking-wide mb-1 opacity-80">After 30% Tax Credit</div>
            <div class="text-2xl font-extrabold" id="sp-after">$0</div>
          </div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Annual Savings</div><div class="text-xl font-bold" id="sp-annual">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Payback Period</div><div class="text-xl font-bold" id="sp-payback">0 yrs</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">25-Year Savings</div><div class="text-xl font-bold" id="sp-lifetime">$0</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Monthly kWh Usage</div><div class="text-xl font-bold" id="sp-kwh">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Roof Area Needed</div><div class="text-xl font-bold" id="sp-roof">0 sq ft</div></div>
        </div>
      </div>
      <ShareButton calculatorId="solar-panel" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Solar Panel Sizing</h2>
      <p>System size (kW) = Monthly kWh ÷ (30 × peak sun hours × 0.8). The 30% federal Investment Tax Credit (ITC) significantly reduces costs.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcSolar() {
      const bill = parseFloat((document.getElementById('sp-bill') as HTMLInputElement).value) || 0;
      const rate = parseFloat((document.getElementById('sp-rate') as HTMLInputElement).value) || 0.13;
      const sunHours = parseFloat((document.getElementById('sp-sun') as HTMLInputElement).value) || 5;
      const panelW = parseFloat((document.getElementById('sp-watt') as HTMLInputElement).value) || 400;
      const costPerW = parseFloat((document.getElementById('sp-cost') as HTMLInputElement).value) || 2.75;
      const offset = parseFloat((document.getElementById('sp-offset') as HTMLInputElement).value) || 100;
      const monthlyKWh = bill / rate;
      const targetKWh = monthlyKWh * (offset / 100);
      const dailyKWh = targetKWh / 30;
      const systemKW = dailyKWh / (sunHours * 0.8);
      const panels = Math.ceil((systemKW * 1000) / panelW);
      const totalCost = Math.round(systemKW * 1000 * costPerW);
      const afterITC = Math.round(totalCost * 0.7);
      const annualSavings = Math.round(bill * 12 * (offset / 100));
      const payback = afterITC / annualSavings;
      const lifetime = annualSavings * 25 - afterITC;
      document.getElementById('sp-size')!.textContent = systemKW.toFixed(1) + ' kW';
      document.getElementById('sp-panels')!.textContent = panels + ' panels';
      document.getElementById('sp-total')!.textContent = '$' + totalCost.toLocaleString();
      document.getElementById('sp-after')!.textContent = '$' + afterITC.toLocaleString();
      document.getElementById('sp-annual')!.textContent = '$' + annualSavings.toLocaleString();
      document.getElementById('sp-payback')!.textContent = payback.toFixed(1) + ' yrs';
      document.getElementById('sp-lifetime')!.textContent = '$' + lifetime.toLocaleString();
      document.getElementById('sp-kwh')!.textContent = Math.round(monthlyKWh).toLocaleString();
      document.getElementById('sp-roof')!.textContent = Math.round(panels * 17.5) + ' sq ft';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => { document.querySelectorAll('.sp-in').forEach(el => el.addEventListener('input', calcSolar)); calcSolar(); }, 50);
  </script>
</CalculatorLayout>
