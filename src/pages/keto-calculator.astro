---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Keto Calculator - Ketogenic Diet Macro Calculator";
const description = "Calculate your ideal macronutrient ratios for a ketogenic diet based on your goals and body composition.";
const relatedCalcs = [
  { name: "Macro Calculator", url: "/macro-calculator", description: "Macros." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Calories." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body mass index." },
  { name: "Protein Calculator", url: "/protein-calculator", description: "Protein needs." },
  { name: "Body Fat Calculator", url: "/body-fat-calculator", description: "Body fat %." },
  { name: "TDEE Calculator", url: "/tdee-calculator", description: "Energy expenditure." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Keto Calculator" keywords="keto calculator, ketogenic diet, keto macros, low carb calculator, keto diet plan" breadcrumbs={[{ name: "Keto Calculator", url: "/keto-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Keto Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Get your personalized keto macros for the ketogenic diet.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Gender</label>
            <select id="ke-gender" class="ke-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="male" selected>Male</option><option value="female">Female</option>
            </select>
          </div>
          <div><label class="block text-xs font-medium text-text mb-1">Age</label><input type="number" id="ke-age" class="ke-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="30" min="15" max="100"></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Weight (kg)</label><input type="number" id="ke-weight" class="ke-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="80" min="30" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Height (cm)</label><input type="number" id="ke-height" class="ke-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="175" min="100" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Body Fat %</label><input type="number" id="ke-bf" class="ke-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="3" max="60" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Activity Level</label>
            <select id="ke-activity" class="ke-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="1.2">Sedentary</option><option value="1.375" selected>Light</option><option value="1.55">Moderate</option><option value="1.725">Active</option><option value="1.9">Very Active</option>
            </select>
          </div>
          <div><label class="block text-xs font-medium text-text mb-1">Goal</label>
            <select id="ke-goal" class="ke-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="0.8">Lose Fat (−20%)</option><option value="0.9">Mild Loss (−10%)</option><option value="1" selected>Maintain</option><option value="1.1">Gain (+ 10%)</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Daily Calories (Keto)</div>
          <div class="text-5xl font-extrabold" id="ke-cals">0</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-5 bg-green-600 rounded-2xl text-white text-center">
            <div class="text-xs uppercase tracking-wide mb-1 opacity-80">Fat (70-75%)</div>
            <div class="text-2xl font-extrabold" id="ke-fat">0g</div>
            <div class="text-xs opacity-80" id="ke-fat-cal">0 kcal</div>
          </div>
          <div class="p-5 bg-blue-600 rounded-2xl text-white text-center">
            <div class="text-xs uppercase tracking-wide mb-1 opacity-80">Protein (20-25%)</div>
            <div class="text-2xl font-extrabold" id="ke-protein">0g</div>
            <div class="text-xs opacity-80" id="ke-protein-cal">0 kcal</div>
          </div>
          <div class="p-5 bg-orange-500 rounded-2xl text-white text-center">
            <div class="text-xs uppercase tracking-wide mb-1 opacity-80">Net Carbs (5%)</div>
            <div class="text-2xl font-extrabold" id="ke-carbs">0g</div>
            <div class="text-xs opacity-80" id="ke-carbs-cal">0 kcal</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">BMR</div><div class="text-xl font-bold" id="ke-bmr">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Lean Body Mass</div><div class="text-xl font-bold" id="ke-lbm">0 kg</div></div>
        </div>
      </div>
      <ShareButton calculatorId="keto" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Keto Macros</h2>
      <p>A standard ketogenic diet typically consists of 70-75% fat, 20-25% protein, and 5% net carbs to maintain ketosis.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcKeto() {
      const gender = (document.getElementById('ke-gender') as HTMLSelectElement).value;
      const age = parseFloat((document.getElementById('ke-age') as HTMLInputElement).value) || 30;
      const weight = parseFloat((document.getElementById('ke-weight') as HTMLInputElement).value) || 80;
      const height = parseFloat((document.getElementById('ke-height') as HTMLInputElement).value) || 175;
      const bf = parseFloat((document.getElementById('ke-bf') as HTMLInputElement).value) || 20;
      const activity = parseFloat((document.getElementById('ke-activity') as HTMLSelectElement).value);
      const goalMul = parseFloat((document.getElementById('ke-goal') as HTMLSelectElement).value);
      const lbm = weight * (1 - bf / 100);
      const bmr = gender === 'male'
        ? 10 * weight + 6.25 * height - 5 * age + 5
        : 10 * weight + 6.25 * height - 5 * age - 161;
      const tdee = bmr * activity;
      const cals = Math.round(tdee * goalMul);
      const proteinG = Math.round(lbm * 1.8);
      const carbsG = Math.round(cals * 0.05 / 4);
      const proteinCal = proteinG * 4;
      const carbsCal = carbsG * 4;
      const fatCal = cals - proteinCal - carbsCal;
      const fatG = Math.round(fatCal / 9);
      document.getElementById('ke-cals')!.textContent = cals.toLocaleString();
      document.getElementById('ke-fat')!.textContent = fatG + 'g';
      document.getElementById('ke-fat-cal')!.textContent = fatCal + ' kcal';
      document.getElementById('ke-protein')!.textContent = proteinG + 'g';
      document.getElementById('ke-protein-cal')!.textContent = proteinCal + ' kcal';
      document.getElementById('ke-carbs')!.textContent = carbsG + 'g';
      document.getElementById('ke-carbs-cal')!.textContent = carbsCal + ' kcal';
      document.getElementById('ke-bmr')!.textContent = Math.round(bmr).toLocaleString();
      document.getElementById('ke-lbm')!.textContent = lbm.toFixed(1) + ' kg';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => { document.querySelectorAll('.ke-in').forEach(el => el.addEventListener('input', calcKeto)); document.querySelectorAll('.ke-in').forEach(el => el.addEventListener('change', calcKeto)); calcKeto(); }, 50);
  </script>
</CalculatorLayout>
