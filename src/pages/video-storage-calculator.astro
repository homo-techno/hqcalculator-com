---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Video Storage Calculator - Storage Requirements by Codec & Resolution";
const description = "Calculate storage requirements for video projects by codec, resolution, and duration. Find the minimum card speed needed for your recording settings.";
const relatedCalcs = [
  { name: "Video Bitrate", url: "/video-bitrate-calculator", description: "Bitrate and file size." },
  { name: "Video Frame Rate", url: "/video-frame-rate-calculator", description: "Frame rate calculations." },
  { name: "Data Storage", url: "/data-storage-converter", description: "Storage conversions." },
  { name: "Photo Resolution", url: "/photo-resolution-calculator", description: "Photo file sizes." },
  { name: "Timelapse", url: "/timelapse-calculator", description: "Timelapse storage." },
  { name: "Internet Speed", url: "/internet-speed-calculator", description: "Transfer speed." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Video Storage Calculator" keywords="video storage calculator, video file size, memory card capacity, codec storage, recording time, card speed requirement" breadcrumbs={[{ name: "Video Storage", url: "/video-storage-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Video Storage Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Plan storage for video projects: calculate space needed by codec, resolution, and duration.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Resolution</label>
          <select id="vs-res" class="vs-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="7680x4320">8K (7680x4320)</option>
            <option value="3840x2160" selected>4K UHD (3840x2160)</option>
            <option value="2560x1440">1440p QHD</option>
            <option value="1920x1080">1080p FHD</option>
            <option value="1280x720">720p HD</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Frame Rate</label>
          <select id="vs-fps" class="vs-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="24">24 fps</option>
            <option value="25">25 fps</option>
            <option value="30" selected>30 fps</option>
            <option value="50">50 fps</option>
            <option value="60">60 fps</option>
            <option value="120">120 fps</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Codec</label>
          <select id="vs-codec" class="vs-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="h264">H.264 / AVC</option>
            <option value="h265" selected>H.265 / HEVC</option>
            <option value="prores422">ProRes 422</option>
            <option value="prores4444">ProRes 4444</option>
            <option value="dnxhr">DNxHR</option>
            <option value="braw">Blackmagic RAW</option>
            <option value="redraw">RED RAW</option>
            <option value="craw">Cinema RAW Light</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Project Duration</label>
          <div class="grid grid-cols-3 gap-2">
            <div>
              <label class="block text-xs text-text-secondary">Hours</label>
              <input type="number" id="vs-hours" class="vs-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="1" min="0" step="1">
            </div>
            <div>
              <label class="block text-xs text-text-secondary">Minutes</label>
              <input type="number" id="vs-mins" class="vs-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="0" min="0" step="1">
            </div>
            <div>
              <label class="block text-xs text-text-secondary">Seconds</label>
              <input type="number" id="vs-secs" class="vs-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="0" min="0" step="1">
            </div>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Available Storage (GB)</label>
          <input type="number" id="vs-available" class="vs-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="256" min="1" step="1">
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Storage Required</div>
          <div class="text-4xl font-extrabold" id="vs-total"></div>
          <div class="text-sm text-blue-200 mt-1" id="vs-bitrate"></div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Per Minute</div>
            <div class="text-xl font-bold text-text" id="vs-permin"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Per Hour</div>
            <div class="text-xl font-bold text-text" id="vs-perhour"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Min Card Write Speed</div>
            <div class="text-xl font-bold text-text" id="vs-speed"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Recording Time Available</div>
            <div class="text-xl font-bold text-text" id="vs-rectime"></div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h4 class="font-semibold text-sm text-text mb-2">Card Capacity Guide</h4>
          <div class="text-sm text-text-secondary space-y-1" id="vs-cards"></div>
        </div>
      </div>
      <ShareButton calculatorId="video-storage" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Video Storage Planning</h2>
      <p>Storage needs vary dramatically by codec. H.265 at 4K/30fps uses about 30-50 Mbps, while ProRes 422 at the same settings requires 400+ Mbps. Always bring more storage than you think you need.</p>
      <p><strong>Card speed matters:</strong> Your memory card must sustain the write speed of your codec. V60 cards handle most consumer formats, but ProRes and RAW codecs need V90 or CFexpress.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcVS() {
      const resParts = (document.getElementById('vs-res') as HTMLSelectElement).value.split('x');
      const resW = parseInt(resParts[0]);
      const resH = parseInt(resParts[1]);
      const fps = parseInt((document.getElementById('vs-fps') as HTMLSelectElement).value);
      const codec = (document.getElementById('vs-codec') as HTMLSelectElement).value;
      const hours = parseInt((document.getElementById('vs-hours') as HTMLInputElement).value) || 0;
      const mins = parseInt((document.getElementById('vs-mins') as HTMLInputElement).value) || 0;
      const secs = parseInt((document.getElementById('vs-secs') as HTMLInputElement).value) || 0;
      const available = parseFloat((document.getElementById('vs-available') as HTMLInputElement).value) || 256;

      const totalSecs = hours * 3600 + mins * 60 + secs;
      const pixels = resW * resH;
      const basePixels = 1920 * 1080;
      const pixelRatio = pixels / basePixels;
      const fpsRatio = fps / 30;

      const codecBitrates: Record<string, number> = {
        'h264': 8, 'h265': 5, 'prores422': 147, 'prores4444': 220,
        'dnxhr': 145, 'braw': 80, 'redraw': 120, 'craw': 60,
      };

      const bitrateMbps = (codecBitrates[codec] || 8) * pixelRatio * fpsRatio;
      const bytesPerSec = (bitrateMbps * 1000000) / 8;
      const totalBytes = bytesPerSec * totalSecs;

      function fmtSize(bytes: number): string {
        if (bytes >= 1099511627776) return (bytes / 1099511627776).toFixed(2) + ' TB';
        if (bytes >= 1073741824) return (bytes / 1073741824).toFixed(1) + ' GB';
        return (bytes / 1048576).toFixed(0) + ' MB';
      }

      document.getElementById('vs-total')!.textContent = fmtSize(totalBytes);
      document.getElementById('vs-bitrate')!.textContent = bitrateMbps.toFixed(1) + ' Mbps';
      document.getElementById('vs-permin')!.textContent = fmtSize(bytesPerSec * 60);
      document.getElementById('vs-perhour')!.textContent = fmtSize(bytesPerSec * 3600);

      const writeMBs = bytesPerSec / 1048576;
      document.getElementById('vs-speed')!.textContent = writeMBs.toFixed(0) + ' MB/s';

      const availableBytes = available * 1073741824;
      const recTimeSecs = availableBytes / bytesPerSec;
      const recH = Math.floor(recTimeSecs / 3600);
      const recM = Math.floor((recTimeSecs % 3600) / 60);
      document.getElementById('vs-rectime')!.textContent = recH + 'h ' + recM + 'm';

      const cardSizes = [32, 64, 128, 256, 512, 1024, 2048];
      let html = '';
      cardSizes.forEach(gb => {
        const cardBytes = gb * 1073741824;
        const cardTimeSecs = cardBytes / bytesPerSec;
        const cH = Math.floor(cardTimeSecs / 3600);
        const cM = Math.floor((cardTimeSecs % 3600) / 60);
        const label = gb >= 1024 ? (gb / 1024) + ' TB' : gb + ' GB';
        html += '<div class="flex justify-between"><span>' + label + '</span><span class="font-bold">' + cH + 'h ' + cM + 'm recording</span></div>';
      });
      document.getElementById('vs-cards')!.innerHTML = html;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.vs-in').forEach(el => {
        el.addEventListener('input', calcVS);
        el.addEventListener('change', calcVS);
      });
      calcVS();
    }, 50);
  </script>
</CalculatorLayout>
