---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Noise Level Calculator - Decibel (dB) Calculator";
const description = "Calculate combined decibel levels, convert between sound intensity units, and check noise exposure limits.";
const relatedCalcs = [
  { name: "Wavelength Calculator", url: "/wavelength-calculator", description: "Waves." },
  { name: "Logarithm Calculator", url: "/logarithm-calculator", description: "Logarithms." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Scientific." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Ohm's Law", url: "/ohms-law-calculator", description: "Electrical." },
  { name: "Unit Converter", url: "/length-converter", description: "Units." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Noise Level Calculator" keywords="decibel calculator, noise level, dB calculator, sound intensity, noise exposure" breadcrumbs={[{ name: "Noise Level", url: "/noise-level-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Noise Level Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate combined decibel levels and check noise exposure safety.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Sound Sources (dB levels, comma-separated)</label>
          <input type="text" id="nl-sources" class="w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold font-mono" value="70, 75, 80" placeholder="70, 75, 80">
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Distance from Source (ft)</label><input type="number" id="nl-dist" class="nl-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3" min="0.1" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Exposure Duration (hrs)</label><input type="number" id="nl-hours" class="nl-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="0.25" step="0.5"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Combined Level</div>
          <div class="text-5xl font-extrabold" id="nl-combined">0 dB</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Sound Category</div><div class="text-xl font-bold" id="nl-cat">-</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Safe Exposure</div><div class="text-xl font-bold" id="nl-safe">-</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Risk Level</div><div class="text-2xl font-bold" id="nl-risk">-</div></div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Common Noise Levels</h3>
          <div class="grid grid-cols-2 gap-2 text-sm">
            <div class="flex justify-between"><span>Whisper</span><span class="font-bold">30 dB</span></div>
            <div class="flex justify-between"><span>Normal Conversation</span><span class="font-bold">60 dB</span></div>
            <div class="flex justify-between"><span>Vacuum Cleaner</span><span class="font-bold">70 dB</span></div>
            <div class="flex justify-between"><span>City Traffic</span><span class="font-bold">85 dB</span></div>
            <div class="flex justify-between"><span>Lawn Mower</span><span class="font-bold">90 dB</span></div>
            <div class="flex justify-between"><span>Rock Concert</span><span class="font-bold">110 dB</span></div>
            <div class="flex justify-between"><span>Jet Engine (100ft)</span><span class="font-bold">130 dB</span></div>
            <div class="flex justify-between"><span>Pain Threshold</span><span class="font-bold">140 dB</span></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="noise-level" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Decibel Calculations</h2>
      <p>Decibels use a logarithmic scale. Combining sounds: dB_total = 10 √ó log‚ÇÅ‚ÇÄ(10^(dB‚ÇÅ/10) + 10^(dB‚ÇÇ/10) + ...). Every +10 dB sounds roughly twice as loud.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function classify(dB: number): [string, string, string] {
      if (dB < 30) return ['Very Quiet', 'Unlimited', 'üü¢ Safe'];
      if (dB < 60) return ['Quiet', 'Unlimited', 'üü¢ Safe'];
      if (dB < 70) return ['Moderate', 'Unlimited', 'üü¢ Safe'];
      if (dB < 80) return ['Loud', 'Unlimited', 'üü° Caution'];
      if (dB < 85) return ['Very Loud', '8 hours', 'üü° Caution'];
      if (dB < 90) return ['Dangerous', '8 hours', 'üü† Risk'];
      if (dB < 95) return ['Very Dangerous', '4 hours', 'üü† High Risk'];
      if (dB < 100) return ['Extremely Loud', '2 hours', 'üî¥ Danger'];
      if (dB < 110) return ['Extremely Loud', '30 min', 'üî¥ Danger'];
      if (dB < 120) return ['Threshold of Pain', '15 min', 'üî¥ Severe'];
      return ['Painful', 'Avoid', 'üî¥ Immediate Danger'];
    }
    function calcNL() {
      const input = (document.getElementById('nl-sources') as HTMLInputElement).value;
      const dbs = input.split(/[,\s]+/).map(s => parseFloat(s)).filter(n => !isNaN(n) && n >= 0);
      if (dbs.length === 0) {
        document.getElementById('nl-combined')!.textContent = '-';
        return;
      }
      let sum = 0;
      for (const db of dbs) sum += Math.pow(10, db / 10);
      const combined = 10 * Math.log10(sum);
      const [cat, safe, risk] = classify(combined);
      document.getElementById('nl-combined')!.textContent = combined.toFixed(1) + ' dB';
      document.getElementById('nl-cat')!.textContent = cat;
      document.getElementById('nl-safe')!.textContent = safe;
      document.getElementById('nl-risk')!.textContent = risk;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.getElementById('nl-sources')!.addEventListener('input', calcNL);
      document.querySelectorAll('.nl-in').forEach(el => el.addEventListener('input', calcNL));
      calcNL();
    }, 50);
  </script>
</CalculatorLayout>
