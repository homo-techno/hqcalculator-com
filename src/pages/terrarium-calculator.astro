---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Terrarium Calculator - Substrate, Charcoal & Plants";
const description = "Calculate substrate layer depths, activated charcoal amount, and plant count by container size for terrariums.";
const relatedCalcs = [
  { name: "Aquarium Calculator", url: "/aquarium-calculator", description: "Aquarium sizing." },
  { name: "Garden Spacing", url: "/garden-spacing-calculator", description: "Plant spacing." },
  { name: "Mulch Calculator", url: "/mulch-calculator", description: "Mulch volume." },
  { name: "Volume Calculator", url: "/volume-calculator", description: "Volume calculations." },
  { name: "Area Calculator", url: "/area-calculator", description: "Area calculations." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Budget planning." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Terrarium Calculator" keywords="terrarium calculator, substrate layers, activated charcoal, terrarium plants, container size" breadcrumbs={[{ name: "Terrarium", url: "/terrarium-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Terrarium Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate substrate layers, charcoal, drainage, and plant count for your terrarium build.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Container Shape</label>
          <select id="tr-shape" class="tr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="round" selected>Round / Cylinder</option>
            <option value="rect">Rectangular</option>
            <option value="bowl">Bowl / Sphere</option>
          </select>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Diameter/Width (in)</label><input type="number" id="tr-w" class="tr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="3" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Depth/Length (in)</label><input type="number" id="tr-d" class="tr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="3" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Height (in)</label><input type="number" id="tr-h" class="tr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="4" step="0.5"></div>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Terrarium Type</label>
          <select id="tr-type" class="tr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="closed" selected>Closed (Tropical)</option>
            <option value="open">Open (Succulents)</option>
          </select>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Container Volume</div>
          <div class="text-4xl font-extrabold font-mono" id="tr-result">0 cu in</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Drainage Gravel</div><div class="text-xl font-bold font-mono" id="tr-gravel">0 cups</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Charcoal Layer</div><div class="text-xl font-bold font-mono" id="tr-char">0 tbsp</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Sphagnum Moss</div><div class="text-xl font-bold font-mono" id="tr-moss">0 cups</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Potting Soil</div><div class="text-xl font-bold font-mono" id="tr-soil">0 cups</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Plant Count</div><div class="text-xl font-bold font-mono" id="tr-plants">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Decorative Moss</div><div class="text-xl font-bold font-mono" id="tr-deco">0 cups</div></div>
        </div>
      </div>
      <ShareButton calculatorId="terrarium" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcTR() {
      const shape = (document.getElementById('tr-shape') as HTMLSelectElement).value;
      const w = parseFloat((document.getElementById('tr-w') as HTMLInputElement).value) || 8;
      const d = parseFloat((document.getElementById('tr-d') as HTMLInputElement).value) || 8;
      const h = parseFloat((document.getElementById('tr-h') as HTMLInputElement).value) || 10;
      const tType = (document.getElementById('tr-type') as HTMLSelectElement).value;

      // Container base area (sq inches)
      let baseArea = 0;
      let volume = 0;
      if (shape === 'round') {
        const r = w / 2;
        baseArea = Math.PI * r * r;
        volume = baseArea * h;
      } else if (shape === 'rect') {
        baseArea = w * d;
        volume = baseArea * h;
      } else { // bowl/sphere
        const r = w / 2;
        volume = (4 / 3) * Math.PI * r * r * r * 0.5; // half sphere
        baseArea = Math.PI * r * r;
      }

      // Layer depths (proportion of container height used for layers: ~40% of height)
      const layerHeight = h * 0.4;

      // Drainage gravel: ~20% of layer height
      const gravelDepth = layerHeight * 0.25;
      const gravelVolCuIn = baseArea * gravelDepth;
      const gravelCups = gravelVolCuIn / 14.4; // 1 cup = ~14.4 cu in

      // Charcoal: thin layer ~0.25-0.5 inches
      const charDepth = 0.375;
      const charVolCuIn = baseArea * charDepth;
      const charTbsp = charVolCuIn / 0.9; // 1 tbsp = ~0.9 cu in

      // Sphagnum moss separator: ~0.5 inches
      const mossDepth = 0.5;
      const mossVolCuIn = baseArea * mossDepth;
      const mossCups = mossVolCuIn / 14.4;

      // Potting soil: remaining layer height
      const soilDepth = layerHeight - gravelDepth - charDepth - mossDepth;
      const soilVolCuIn = baseArea * Math.max(soilDepth, 1);
      const soilCups = soilVolCuIn / 14.4;

      // Plant count: 1 small plant per ~8-12 sq inches of surface area
      const plantSpacing = tType === 'closed' ? 10 : 12; // tropical plants closer together
      const plantCount = Math.max(1, Math.floor(baseArea / plantSpacing));

      // Decorative moss for top
      const decoMossCups = (baseArea * 0.25) / 14.4;

      document.getElementById('tr-result')!.textContent = volume.toFixed(0) + ' cu in';
      document.getElementById('tr-gravel')!.textContent = gravelCups.toFixed(1) + ' cups';
      document.getElementById('tr-char')!.textContent = Math.round(charTbsp) + ' tbsp';
      document.getElementById('tr-moss')!.textContent = mossCups.toFixed(1) + ' cups';
      document.getElementById('tr-soil')!.textContent = soilCups.toFixed(1) + ' cups';
      document.getElementById('tr-plants')!.textContent = plantCount + ' plants';
      document.getElementById('tr-deco')!.textContent = decoMossCups.toFixed(1) + ' cups';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.tr-in').forEach(el => { el.addEventListener('input', calcTR); el.addEventListener('change', calcTR); });
      calcTR();
    }, 50);
  </script>
</CalculatorLayout>
