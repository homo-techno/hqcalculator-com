---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Network Latency Calculator - Round-Trip Time Estimator 2026";
const description = "Estimate network round-trip latency from distance, medium type, and network hops. Calculate propagation delay for fiber, copper, and wireless links.";

const relatedCalcs = [
  { name: "Network Throughput Calculator", url: "/network-throughput-calculator", description: "TCP throughput estimation." },
  { name: "Data Transfer Calculator", url: "/data-transfer-calculator", description: "File transfer time estimation." },
  { name: "Bandwidth Calculator", url: "/bandwidth-calculator", description: "Network bandwidth requirements." },
  { name: "Fiber Optic Loss Calculator", url: "/fiber-optic-loss-calculator", description: "Fiber optic link loss budget." },
  { name: "Wireless Range Calculator", url: "/wireless-range-calculator", description: "WiFi/wireless range estimation." },
  { name: "VoIP Bandwidth Calculator", url: "/voip-bandwidth-calculator", description: "VoIP call bandwidth needs." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Network Latency Calculator"
  keywords="network latency calculator, round trip time, RTT, propagation delay, ping time, network delay, latency estimation"
  breadcrumbs={[{ name: "Network Latency Calculator", url: "/network-latency-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Network Latency Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate round-trip latency based on physical distance, transmission medium, and network equipment delays.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Distance</label>
        <div class="flex gap-2">
          <input type="number" id="nlc-dist" class="nlc-in flex-1 px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1000" step="1" min="0">
          <select id="nlc-dist-unit" class="nlc-in px-4 py-3 border border-border rounded-xl text-lg">
            <option value="km" selected>km</option>
            <option value="mi">miles</option>
            <option value="m">meters</option>
          </select>
        </div>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Transmission Medium</label>
        <select id="nlc-medium" class="nlc-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="fiber" selected>Fiber Optic (~200,000 km/s)</option>
          <option value="copper">Copper Cable (~230,000 km/s)</option>
          <option value="wireless">Wireless/Free Space (~300,000 km/s)</option>
          <option value="satellite">Satellite (GEO ~35,786 km altitude)</option>
        </select>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Number of Router/Switch Hops</label>
        <input type="number" id="nlc-hops" class="nlc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" step="1" min="0">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Delay per Hop (ms)</label>
        <input type="number" id="nlc-hop-delay" class="nlc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.5" step="0.1" min="0">
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-text mb-1">Additional Processing Delay (ms)</label>
        <input type="number" id="nlc-extra" class="nlc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" step="0.1" min="0">
        <p class="text-xs text-text-muted mt-1">Server processing, serialization, DNS, TLS handshake, etc.</p>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm font-medium text-blue-100 mb-1">Estimated Round-Trip Time</div>
        <div class="text-4xl font-extrabold" id="nlc-rtt">--</div>
        <div class="text-sm text-blue-200 mt-1">milliseconds</div>
      </div>

      <!-- Secondary Stats -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Propagation Delay (one-way)</div>
          <div class="text-xl font-bold text-text" id="nlc-prop">--</div>
          <div class="text-xs text-text-muted">ms</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Hop Delay (total)</div>
          <div class="text-xl font-bold text-text" id="nlc-hop-total">--</div>
          <div class="text-xs text-text-muted">ms</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">One-Way Latency</div>
          <div class="text-xl font-bold text-text" id="nlc-oneway">--</div>
          <div class="text-xs text-text-muted">ms</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Speed of Light Limit</div>
          <div class="text-xl font-bold text-text" id="nlc-sol">--</div>
          <div class="text-xs text-text-muted">ms RTT</div>
        </div>
      </div>

      <ShareButton calculatorId="network-latency" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Understanding Network Latency</h2>
      <p>Network latency is the time it takes for data to travel between two points. Round-trip time (RTT) includes the time for a packet to reach the destination and for the response to come back.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono text-sm">
        RTT = 2 x (Distance / Speed_in_medium) + Hop_delays + Processing_delay
      </div>
      <p>Light travels through fiber optic cable at approximately two-thirds the speed of light in vacuum due to the refractive index of glass. This sets a physical lower bound on latency.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcNLC() {
      const distVal = parseFloat((document.getElementById('nlc-dist') as HTMLInputElement).value) || 0;
      const distUnit = (document.getElementById('nlc-dist-unit') as HTMLSelectElement).value;
      const medium = (document.getElementById('nlc-medium') as HTMLSelectElement).value;
      const hops = parseFloat((document.getElementById('nlc-hops') as HTMLInputElement).value) || 0;
      const hopDelay = parseFloat((document.getElementById('nlc-hop-delay') as HTMLInputElement).value) || 0;
      const extra = parseFloat((document.getElementById('nlc-extra') as HTMLInputElement).value) || 0;

      let distKm = distVal;
      if (distUnit === 'mi') distKm = distVal * 1.60934;
      else if (distUnit === 'm') distKm = distVal / 1000;

      const speeds: Record<string, number> = { fiber: 200000, copper: 230000, wireless: 299792, satellite: 299792 };
      const speedKmS = speeds[medium] || 200000;

      let oneWayDist = distKm;
      if (medium === 'satellite') {
        // GEO satellite: signal goes up 35786 km and back down, plus ground distance
        oneWayDist = 2 * 35786 + distKm * 0.1; // simplified
      }

      const propDelay = (oneWayDist / speedKmS) * 1000; // ms one-way
      const hopTotal = hops * hopDelay;
      const oneWay = propDelay + hopTotal / 2 + extra / 2;
      const rtt = 2 * propDelay + hopTotal + extra;
      const solRTT = (2 * distKm / 299792) * 1000;

      document.getElementById('nlc-rtt')!.textContent = rtt.toFixed(2);
      document.getElementById('nlc-prop')!.textContent = propDelay.toFixed(2);
      document.getElementById('nlc-hop-total')!.textContent = hopTotal.toFixed(2);
      document.getElementById('nlc-oneway')!.textContent = oneWay.toFixed(2);
      document.getElementById('nlc-sol')!.textContent = solRTT.toFixed(2);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.nlc-in').forEach(el => { el.addEventListener('input', calcNLC); el.addEventListener('change', calcNLC); });
      calcNLC();
    }, 50);
  </script>
</CalculatorLayout>
