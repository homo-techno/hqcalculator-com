---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Cutting Speed Calculator - SFM, RPM & Feed Rate";
const description = "Calculate lathe and mill cutting speed (SFM), spindle RPM, and feed rate for various materials and tool diameters. Optimize machining parameters.";

const relatedCalcs = [
  { name: "Drill Bit Calculator", url: "/drill-bit-calculator", description: "Drill sizes for taps." },
  { name: "Thread Pitch Calculator", url: "/thread-pitch-calculator", description: "Thread dimensions." },
  { name: "Metal Weight Calculator", url: "/metal-weight-calculator", description: "Metal weight." },
  { name: "Hardness Converter", url: "/hardness-converter-calculator", description: "Hardness conversion." },
  { name: "Metal Fatigue Calculator", url: "/metal-fatigue-calculator", description: "Fatigue life." },
  { name: "Plasma Cutting Calculator", url: "/plasma-cutting-calculator", description: "Plasma settings." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Cutting Speed Calculator"
  keywords="cutting speed, SFM, RPM, feed rate, lathe speed, mill speed, machining, surface feet per minute, spindle speed"
  breadcrumbs={[{ name: "Cutting Speed Calculator", url: "/cutting-speed-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Cutting Speed Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate spindle RPM, surface speed, and feed rate for lathe and milling operations.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Calculation Mode -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Calculate</label>
        <select id="cu2-mode" class="cu2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="rpm">RPM from SFM and Diameter</option>
          <option value="sfm">SFM from RPM and Diameter</option>
        </select>
      </div>

      <!-- Material -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Workpiece Material</label>
        <select id="cu2-material" class="cu2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="100">Mild Steel / 1018 (80-120 SFM)</option>
          <option value="80">Medium Carbon Steel (60-100 SFM)</option>
          <option value="60">Alloy Steel / 4140 (40-80 SFM)</option>
          <option value="40">Tool Steel / Hardened (30-50 SFM)</option>
          <option value="60">Stainless Steel 304 (40-80 SFM)</option>
          <option value="300">Aluminum 6061 (200-400 SFM)</option>
          <option value="200">Brass / Bronze (150-300 SFM)</option>
          <option value="100">Copper (80-120 SFM)</option>
          <option value="500">Plastic / Nylon (300-800 SFM)</option>
          <option value="50">Cast Iron (40-80 SFM)</option>
          <option value="50">Titanium (30-70 SFM)</option>
        </select>
      </div>

      <!-- Tool Type -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Tool Material</label>
        <select id="cu2-tool" class="cu2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="1.0">HSS (High Speed Steel)</option>
          <option value="2.5" selected>Carbide</option>
          <option value="4.0">Ceramic</option>
          <option value="5.0">CBN / Diamond</option>
        </select>
      </div>

      <!-- Cutting Speed (SFM) or RPM -->
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Surface Speed (SFM)</label>
          <input type="number" id="cu2-sfm" class="cu2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="250" min="1" step="10">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Spindle RPM</label>
          <input type="number" id="cu2-rpm" class="cu2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="955" min="1" step="10">
        </div>
      </div>

      <!-- Diameter -->
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Diameter</label>
          <input type="number" id="cu2-dia" class="cu2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="0.01" step="0.01">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Unit</label>
          <select id="cu2-dunit" class="cu2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="in">inches</option>
            <option value="mm">mm</option>
          </select>
        </div>
      </div>

      <!-- Feed per tooth/rev -->
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Feed per Rev/Tooth</label>
          <input type="number" id="cu2-fpt" class="cu2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.005" min="0.001" step="0.001">
          <p class="text-xs text-text-muted mt-1">inches (IPR for lathe, IPT for mill)</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Number of Flutes</label>
          <input type="number" id="cu2-flutes" class="cu2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" min="1" max="12" step="1">
          <p class="text-xs text-text-muted mt-1">for milling (1 for lathe)</p>
        </div>
      </div>

      <!-- Results -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="cu2-resultlabel">Spindle Speed</div>
        <div class="text-4xl font-extrabold" id="cu2-result">--</div>
        <div class="text-sm text-blue-200 mt-1" id="cu2-resultunit">RPM</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Surface Speed</div>
          <div class="text-xl font-bold" id="cu2-sfmout">--</div>
          <div class="text-xs text-text-muted">SFM (m/min)</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Feed Rate</div>
          <div class="text-xl font-bold" id="cu2-feed">--</div>
          <div class="text-xs text-text-muted">IPM (in/min)</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">MRR (approx)</div>
          <div class="text-xl font-bold" id="cu2-mrr">--</div>
          <div class="text-xs text-text-muted">inÂ³/min</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Recommended SFM</div>
          <div class="text-xl font-bold" id="cu2-recsfm">--</div>
          <div class="text-xs text-text-muted">for this material + tool</div>
        </div>
      </div>

      <ShareButton calculatorId="cutting-speed" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Cutting Speed Formulas</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>RPM</strong> = (SFM x 12) / (pi x D)</p>
        <p><strong>SFM</strong> = (pi x D x RPM) / 12</p>
        <p><strong>Feed Rate (IPM)</strong> = RPM x FPT x Flutes</p>
      </div>
      <p>Where D = diameter in inches, SFM = surface feet per minute, FPT = feed per tooth.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcCU2() {
      const mode = (document.getElementById('cu2-mode') as HTMLSelectElement).value;
      const baseSFM = parseFloat((document.getElementById('cu2-material') as HTMLSelectElement).value) || 100;
      const toolFactor = parseFloat((document.getElementById('cu2-tool') as HTMLSelectElement).value) || 1.0;
      let sfm = parseFloat((document.getElementById('cu2-sfm') as HTMLInputElement).value) || 0;
      let rpm = parseFloat((document.getElementById('cu2-rpm') as HTMLInputElement).value) || 0;
      let dia = parseFloat((document.getElementById('cu2-dia') as HTMLInputElement).value) || 1;
      const dUnit = (document.getElementById('cu2-dunit') as HTMLSelectElement).value;
      const fpt = parseFloat((document.getElementById('cu2-fpt') as HTMLInputElement).value) || 0.005;
      const flutes = parseFloat((document.getElementById('cu2-flutes') as HTMLInputElement).value) || 4;

      // Convert dia to inches
      const dia_in = dUnit === 'mm' ? dia / 25.4 : dia;

      // Recommended SFM
      const recSFM = Math.round(baseSFM * toolFactor);

      if (mode === 'rpm') {
        // Calculate RPM from SFM
        rpm = (sfm * 12) / (Math.PI * dia_in);
        document.getElementById('cu2-resultlabel')!.textContent = 'Spindle Speed';
        document.getElementById('cu2-result')!.textContent = Math.round(rpm).toLocaleString();
        document.getElementById('cu2-resultunit')!.textContent = 'RPM';
      } else {
        // Calculate SFM from RPM
        sfm = (Math.PI * dia_in * rpm) / 12;
        document.getElementById('cu2-resultlabel')!.textContent = 'Surface Speed';
        document.getElementById('cu2-result')!.textContent = Math.round(sfm).toLocaleString();
        document.getElementById('cu2-resultunit')!.textContent = 'SFM';
      }

      const sfm_mpm = sfm * 0.3048;
      const feedIPM = rpm * fpt * flutes;
      // Approximate MRR: feed * depth * width (assume depth = 0.1" and width = dia/2)
      const mrr = feedIPM * 0.1 * (dia_in / 2);

      document.getElementById('cu2-sfmout')!.textContent = Math.round(sfm) + ' (' + sfm_mpm.toFixed(1) + ')';
      document.getElementById('cu2-feed')!.textContent = feedIPM.toFixed(1);
      document.getElementById('cu2-mrr')!.textContent = mrr.toFixed(2);
      document.getElementById('cu2-recsfm')!.textContent = String(recSFM);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      // Auto-fill SFM when material/tool changes
      const updateSFM = () => {
        const baseSFM = parseFloat((document.getElementById('cu2-material') as HTMLSelectElement).value) || 100;
        const toolFactor = parseFloat((document.getElementById('cu2-tool') as HTMLSelectElement).value) || 1.0;
        (document.getElementById('cu2-sfm') as HTMLInputElement).value = String(Math.round(baseSFM * toolFactor));
        calcCU2();
      };
      document.getElementById('cu2-material')!.addEventListener('change', updateSFM);
      document.getElementById('cu2-tool')!.addEventListener('change', updateSFM);

      document.querySelectorAll('.cu2-in').forEach(el => {
        el.addEventListener('input', calcCU2);
        el.addEventListener('change', calcCU2);
      });
      calcCU2();
    }, 50);
  </script>
</CalculatorLayout>
