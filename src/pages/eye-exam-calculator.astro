---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Eye Exam Calculator";
const description = "Estimate eye exam cost by type (routine, comprehensive, contact lens fitting), frequency recommendations, and insurance coverage.";
const relatedCalcs = [
  { name: "Glasses Cost Calculator", url: "/glasses-cost-calculator", description: "Total eyeglasses cost estimate." },
  { name: "Contact Lens Calculator", url: "/contact-lens-calculator", description: "Annual contact lens costs." },
  { name: "Lens Thickness Calculator", url: "/lens-thickness-calculator", description: "Lens thickness by index." },
  { name: "Pupillary Distance Calculator", url: "/pupillary-distance-calculator", description: "PD measurement guide." },
  { name: "Health Insurance Calculator", url: "/health-insurance-calculator", description: "Health plan cost comparison." },
  { name: "Vision Prescription Calculator", url: "/vision-prescription-calculator", description: "Understand your prescription." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Eye Exam Calculator" keywords="eye exam cost, comprehensive eye exam, contact lens fitting, eye exam frequency, vision insurance exam" breadcrumbs={[{ name: "Eye Exam", url: "/eye-exam-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Eye Exam Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate eye exam costs, recommended frequency, and insurance savings.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Exam Type</label>
            <select id="ee2-type" class="ee2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="routine" selected>Routine Vision Exam</option>
              <option value="comprehensive">Comprehensive (dilated)</option>
              <option value="contact">Contact Lens Fitting</option>
              <option value="medical">Medical Eye Exam</option>
              <option value="pediatric">Pediatric Eye Exam</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Provider Type</label>
            <select id="ee2-prov" class="ee2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="chain">Retail Chain (LensCrafters, etc.)</option>
              <option value="private" selected>Private Practice</option>
              <option value="hospital">Hospital / Medical Center</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Patient Age</label><input type="number" id="ee2-age" class="ee2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="35" min="1" max="100" step="1"></div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Risk Factors</label>
            <select id="ee2-risk" class="ee2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="none" selected>None</option>
              <option value="diabetes">Diabetes</option>
              <option value="family">Family History (Glaucoma/AMD)</option>
              <option value="high_rx">High Prescription (over -6.00)</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Vision Insurance?</label>
            <select id="ee2-ins" class="ee2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="none">No Insurance</option>
              <option value="basic" selected>Basic Vision Plan</option>
              <option value="premium">Premium Vision Plan</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Additional Tests</label>
            <select id="ee2-extra" class="ee2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="none" selected>None</option>
              <option value="retinal">Retinal Imaging ($30-$50)</option>
              <option value="oct">OCT Scan ($50-$100)</option>
              <option value="visual">Visual Field Test ($50-$75)</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Exam Cost</div>
          <div class="text-5xl font-extrabold font-mono" id="ee2-cost">$0</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Copay / OOP</div><div class="text-xl font-bold font-mono" id="ee2-oop">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Recommended Frequency</div><div class="text-xl font-bold font-mono" id="ee2-freq">-</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Annual Cost</div><div class="text-xl font-bold font-mono" id="ee2-annual">$0</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase mb-1">Next Exam Recommendation</div>
          <div class="text-xl font-bold font-mono" id="ee2-next">-</div>
        </div>
      </div>
      <ShareButton calculatorId="eye-exam" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcEE2() {
      const type = (document.getElementById('ee2-type') as HTMLSelectElement).value;
      const prov = (document.getElementById('ee2-prov') as HTMLSelectElement).value;
      const age = parseFloat((document.getElementById('ee2-age') as HTMLInputElement).value) || 35;
      const risk = (document.getElementById('ee2-risk') as HTMLSelectElement).value;
      const ins = (document.getElementById('ee2-ins') as HTMLSelectElement).value;
      const extra = (document.getElementById('ee2-extra') as HTMLSelectElement).value;

      const baseCosts: Record<string, Record<string, number>> = {
        routine:       { chain: 75, private: 120, hospital: 175 },
        comprehensive: { chain: 125, private: 200, hospital: 275 },
        contact:       { chain: 120, private: 175, hospital: 225 },
        medical:       { chain: 150, private: 250, hospital: 350 },
        pediatric:     { chain: 80, private: 130, hospital: 200 }
      };

      const extraCosts: Record<string, number> = { none: 0, retinal: 40, oct: 75, visual: 60 };
      const totalCost = baseCosts[type][prov] + extraCosts[extra];

      // Insurance
      let copay = totalCost;
      if (ins === 'basic') copay = Math.max(10, totalCost - 100);
      else if (ins === 'premium') copay = Math.max(0, totalCost - 175);

      // Frequency recommendation (months between exams)
      let freqMonths: number;
      if (risk !== 'none' || age >= 65) {
        freqMonths = 12;
      } else if (age >= 40) {
        freqMonths = 12;
      } else if (age >= 18) {
        freqMonths = 24;
      } else {
        freqMonths = 12;
      }

      const freqText = freqMonths === 12 ? 'Every 12 months' : 'Every 24 months';
      const annualCost = Math.round(copay * (12 / freqMonths));

      let nextText: string;
      if (age < 5) nextText = 'Ages 3, 5, then annually';
      else if (age < 18) nextText = 'Annually for children';
      else if (risk !== 'none') nextText = 'Annually (risk factors)';
      else if (age >= 65) nextText = 'Annually (age 65+)';
      else if (age >= 40) nextText = 'Annually (age 40+)';
      else nextText = 'Every 2 years (low risk)';

      document.getElementById('ee2-cost')!.textContent = '$' + totalCost.toLocaleString();
      document.getElementById('ee2-oop')!.textContent = '$' + copay.toLocaleString();
      document.getElementById('ee2-freq')!.textContent = freqText;
      document.getElementById('ee2-annual')!.textContent = '$' + annualCost.toLocaleString() + '/yr';
      document.getElementById('ee2-next')!.textContent = nextText;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ee2-in').forEach(el => { el.addEventListener('input', calcEE2); el.addEventListener('change', calcEE2); });
      calcEE2();
    }, 50);
  </script>
</CalculatorLayout>
