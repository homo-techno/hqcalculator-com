---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Average Calculator - Mean, Median, Mode & Range";
const description = "Calculate mean, median, mode, and range from any set of numbers. Includes weighted average, geometric mean, and statistics summary.";

const relatedCalcs = [
  { name: "Standard Deviation", url: "/standard-deviation-calculator", description: "Spread of data." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "GPA Calculator", url: "/gpa-calculator", description: "Grade point average." },
  { name: "Grade Calculator", url: "/grade-calculator", description: "Final grade." },
  { name: "Probability Calculator", url: "/probability-calculator", description: "Probability." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Average Calculator"
  keywords="average calculator, mean calculator, median calculator, mode calculator, weighted average, statistics calculator"
  breadcrumbs={[{ name: "Average Calculator", url: "/average-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Average Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find the mean, median, mode, and range of any data set.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-1">Enter Numbers <span class="text-text-muted">(separated by commas, spaces, or newlines)</span></label>
        <textarea id="avg-input" class="w-full px-4 py-3 border border-border rounded-xl text-lg font-mono" rows="4" placeholder="10, 20, 30, 40, 50">85, 90, 78, 92, 88, 76, 95, 82, 91, 87</textarea>
      </div>

      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Mean (Average)</div>
        <div class="text-5xl font-extrabold" id="avg-mean">0</div>
      </div>

      <div class="grid grid-cols-2 gap-3 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Median</div>
          <div class="text-xl font-bold" id="avg-median">0</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Mode</div>
          <div class="text-xl font-bold" id="avg-mode">—</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Range</div>
          <div class="text-xl font-bold" id="avg-range">0</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Count</div>
          <div class="text-xl font-bold" id="avg-count">0</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Sum</div>
          <div class="text-xl font-bold" id="avg-sum">0</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Min / Max</div>
          <div class="text-xl font-bold" id="avg-minmax">0 / 0</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Std Deviation</div>
          <div class="text-xl font-bold" id="avg-std">0</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Geometric Mean</div>
          <div class="text-xl font-bold" id="avg-geo">0</div>
        </div>
      </div>

      <!-- Sorted data -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-2">Sorted Data</h3>
        <div class="text-sm text-text-secondary font-mono" id="avg-sorted"></div>
      </div>

      <ShareButton calculatorId="average" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Types of Averages</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Mean:</strong> Sum of all values ÷ Count</p>
        <p><strong>Median:</strong> Middle value when sorted (average of two middle if even count)</p>
        <p><strong>Mode:</strong> Most frequently occurring value(s)</p>
        <p><strong>Geometric Mean:</strong> Nth root of the product of N values</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">When to Use Each</h3>
      <ul>
        <li><strong>Mean:</strong> Best for symmetric data without outliers (e.g., test scores)</li>
        <li><strong>Median:</strong> Better when data has outliers (e.g., income, house prices)</li>
        <li><strong>Mode:</strong> Best for categorical data or finding the most common value</li>
        <li><strong>Geometric Mean:</strong> Best for rates, ratios, and percentages (e.g., investment returns)</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What's the difference between mean and average?</strong> They're the same thing. "Average" in everyday language refers to the arithmetic mean.</p>
      <p><strong>Why is median often better than mean?</strong> The median is resistant to outliers. A few extreme values can skew the mean but won't affect the median.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function parseNumbers(input: string): number[] {
      return input.split(/[\s,;\n]+/).map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
    }

    function calcAvg() {
      const nums = parseNumbers((document.getElementById('avg-input') as HTMLTextAreaElement).value);
      if (nums.length === 0) return;

      const sorted = [...nums].sort((a, b) => a - b);
      const count = nums.length;
      const sum = nums.reduce((a, b) => a + b, 0);
      const mean = sum / count;

      // Median
      const mid = Math.floor(count / 2);
      const median = count % 2 === 0 ? (sorted[mid - 1] + sorted[mid]) / 2 : sorted[mid];

      // Mode
      const freq: Record<number, number> = {};
      nums.forEach(n => freq[n] = (freq[n] || 0) + 1);
      const maxFreq = Math.max(...Object.values(freq));
      const modes = Object.keys(freq).filter(k => freq[Number(k)] === maxFreq).map(Number);
      const modeStr = maxFreq === 1 ? 'None' : modes.join(', ');

      // Range
      const min = sorted[0];
      const max = sorted[count - 1];
      const range = max - min;

      // Std deviation (population)
      const variance = nums.reduce((s, n) => s + (n - mean) ** 2, 0) / count;
      const stdDev = Math.sqrt(variance);

      // Geometric mean
      const allPositive = nums.every(n => n > 0);
      const geoMean = allPositive ? Math.pow(nums.reduce((p, n) => p * n, 1), 1 / count) : NaN;

      const fmt = (n: number) => isNaN(n) ? '—' : Number.isInteger(n) ? String(n) : n.toFixed(4);

      document.getElementById('avg-mean')!.textContent = fmt(mean);
      document.getElementById('avg-median')!.textContent = fmt(median);
      document.getElementById('avg-mode')!.textContent = modeStr;
      document.getElementById('avg-range')!.textContent = fmt(range);
      document.getElementById('avg-count')!.textContent = String(count);
      document.getElementById('avg-sum')!.textContent = fmt(sum);
      document.getElementById('avg-minmax')!.textContent = `${fmt(min)} / ${fmt(max)}`;
      document.getElementById('avg-std')!.textContent = fmt(stdDev);
      document.getElementById('avg-geo')!.textContent = fmt(geoMean);
      document.getElementById('avg-sorted')!.textContent = sorted.join(', ');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.getElementById('avg-input')!.addEventListener('input', calcAvg);
      calcAvg();
    }, 50);
  </script>
</CalculatorLayout>
