---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Gem Carat Calculator - Weight from Dimensions & Value";
const description = "Estimate gemstone carat weight from dimensions by shape, approximate value by type and quality, and price per carat for jewelry and gemology.";
const relatedCalcs = [
  { name: "Weight Converter", url: "/weight-converter", description: "Weight units." },
  { name: "Volume Calculator", url: "/volume-calculator", description: "Volume shapes." },
  { name: "Density Calculator", url: "/density-calculator", description: "Material density." },
  { name: "Golden Ratio", url: "/golden-ratio-calculator", description: "Golden proportions." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage math." },
  { name: "Area Calculator", url: "/area-calculator", description: "Area calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Gem Carat Calculator" keywords="gem carat, gemstone weight, carat from dimensions, gem value, price per carat, gemology calculator" breadcrumbs={[{ name: "Gem Carat", url: "/gem-carat-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Gem Carat Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate gemstone carat weight from physical dimensions and shape, with approximate value by gem type and quality grade.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Gem Type</label>
            <select id="gc4-type" class="gc4-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="diamond">Diamond</option>
              <option value="ruby">Ruby</option>
              <option value="sapphire">Sapphire</option>
              <option value="emerald" selected>Emerald</option>
              <option value="aquamarine">Aquamarine</option>
              <option value="topaz">Topaz</option>
              <option value="amethyst">Amethyst</option>
              <option value="garnet">Garnet</option>
              <option value="opal">Opal</option>
              <option value="tourmaline">Tourmaline</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Cut Shape</label>
            <select id="gc4-shape" class="gc4-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="round">Round Brilliant</option>
              <option value="oval" selected>Oval</option>
              <option value="emerald">Emerald Cut</option>
              <option value="pear">Pear</option>
              <option value="marquise">Marquise</option>
              <option value="cushion">Cushion</option>
              <option value="princess">Princess (Square)</option>
              <option value="cabochon">Cabochon</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Length (mm)</label>
            <input type="number" id="gc4-len" class="gc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="8" min="0" step="0.1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Width (mm)</label>
            <input type="number" id="gc4-wid" class="gc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="6" min="0" step="0.1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Depth (mm)</label>
            <input type="number" id="gc4-dep" class="gc4-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="4" min="0" step="0.1">
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Quality Grade</label>
          <select id="gc4-quality" class="gc4-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="commercial">Commercial (lower)</option>
            <option value="good" selected>Good (average)</option>
            <option value="fine">Fine (high quality)</option>
            <option value="exceptional">Exceptional (museum grade)</option>
          </select>
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Carat Weight</div>
          <div class="text-4xl font-extrabold" id="gc4-carat">0</div>
          <div class="text-sm text-blue-200 mt-1">carats</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Weight (grams)</div>
            <div class="text-xl font-bold" id="gc4-grams">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Weight (mg)</div>
            <div class="text-xl font-bold" id="gc4-mg">0</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Est. Price / Carat</div>
            <div class="text-xl font-bold text-secondary" id="gc4-ppc">$0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Est. Total Value</div>
            <div class="text-xl font-bold text-secondary" id="gc4-value">$0</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Volume (mm³)</div>
          <div class="text-xl font-bold" id="gc4-vol">0</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-muted uppercase mb-2">Gem Density Reference</div>
          <div class="grid grid-cols-2 gap-1 text-xs">
            <div class="flex justify-between p-1"><span>Diamond</span><span class="font-bold">3.52 g/cm³</span></div>
            <div class="flex justify-between p-1"><span>Ruby/Sapphire</span><span class="font-bold">4.00 g/cm³</span></div>
            <div class="flex justify-between p-1"><span>Emerald</span><span class="font-bold">2.72 g/cm³</span></div>
            <div class="flex justify-between p-1"><span>Topaz</span><span class="font-bold">3.53 g/cm³</span></div>
            <div class="flex justify-between p-1"><span>Amethyst</span><span class="font-bold">2.65 g/cm³</span></div>
            <div class="flex justify-between p-1"><span>Opal</span><span class="font-bold">2.10 g/cm³</span></div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="gem-carat" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Gem Carat Weight Estimation</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Weight (ct)</strong> = Length x Width x Depth x Shape Factor x SG / 200</p>
        <p><strong>1 carat</strong> = 200 milligrams = 0.2 grams</p>
        <p>Shape factors adjust for how much material a cut shape removes from the rough stone</p>
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcGC4() {
      const gemDensity: Record<string, number> = {
        diamond: 3.52, ruby: 4.00, sapphire: 4.00, emerald: 2.72,
        aquamarine: 2.72, topaz: 3.53, amethyst: 2.65, garnet: 3.80,
        opal: 2.10, tourmaline: 3.10
      };

      const shapeFactors: Record<string, number> = {
        round: 0.0061, oval: 0.0062, emerald: 0.0080, pear: 0.0059,
        marquise: 0.0059, cushion: 0.0065, princess: 0.0083, cabochon: 0.0070
      };

      const pricePerCarat: Record<string, Record<string, number>> = {
        diamond:     { commercial: 3000, good: 8000, fine: 20000, exceptional: 60000 },
        ruby:        { commercial: 500, good: 3000, fine: 15000, exceptional: 50000 },
        sapphire:    { commercial: 400, good: 2000, fine: 10000, exceptional: 40000 },
        emerald:     { commercial: 300, good: 2000, fine: 10000, exceptional: 35000 },
        aquamarine:  { commercial: 50, good: 200, fine: 600, exceptional: 2000 },
        topaz:       { commercial: 10, good: 50, fine: 300, exceptional: 1000 },
        amethyst:    { commercial: 5, good: 20, fine: 80, exceptional: 250 },
        garnet:      { commercial: 10, good: 50, fine: 300, exceptional: 1500 },
        opal:        { commercial: 30, good: 200, fine: 2000, exceptional: 10000 },
        tourmaline:  { commercial: 30, good: 200, fine: 1000, exceptional: 5000 },
      };

      const gemType = (document.getElementById('gc4-type') as HTMLSelectElement).value;
      const shape = (document.getElementById('gc4-shape') as HTMLSelectElement).value;
      const len = parseFloat((document.getElementById('gc4-len') as HTMLInputElement).value) || 0;
      const wid = parseFloat((document.getElementById('gc4-wid') as HTMLInputElement).value) || 0;
      const dep = parseFloat((document.getElementById('gc4-dep') as HTMLInputElement).value) || 0;
      const quality = (document.getElementById('gc4-quality') as HTMLSelectElement).value;

      const sg = gemDensity[gemType] || 2.65;
      const sf = shapeFactors[shape] || 0.0062;

      const carat = len * wid * dep * sf * sg;
      const grams = carat * 0.2;
      const mg = grams * 1000;
      const volumeMm3 = (grams / sg) * 1000;

      const ppc = (pricePerCarat[gemType] || pricePerCarat.amethyst)[quality] || 50;
      const totalValue = carat * ppc;

      const fmt = (n: number) => n.toLocaleString('en-US', { maximumFractionDigits: 2 });

      document.getElementById('gc4-carat')!.textContent = carat.toFixed(3);
      document.getElementById('gc4-grams')!.textContent = grams.toFixed(4) + ' g';
      document.getElementById('gc4-mg')!.textContent = fmt(mg) + ' mg';
      document.getElementById('gc4-ppc')!.textContent = '$' + fmt(ppc);
      document.getElementById('gc4-value')!.textContent = '$' + fmt(totalValue);
      document.getElementById('gc4-vol')!.textContent = fmt(volumeMm3) + ' mm\u00B3';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.gc4-in').forEach(el => { el.addEventListener('input', calcGC4); el.addEventListener('change', calcGC4); });
      calcGC4();
    }, 50);
  </script>
</CalculatorLayout>
