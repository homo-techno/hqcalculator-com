---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Drill Bit Calculator - Tap, Clearance & Countersink Sizes";
const description = "Find the correct drill bit size for tap holes, clearance holes, and countersinks. Covers UNC, UNF, and metric threads with letter and number drills.";

const relatedCalcs = [
  { name: "Thread Pitch Calculator", url: "/thread-pitch-calculator", description: "Thread dimensions." },
  { name: "Cutting Speed Calculator", url: "/cutting-speed-calculator", description: "Drilling RPM and speed." },
  { name: "Bolt Torque Calculator", url: "/bolt-torque-calculator", description: "Bolt torque values." },
  { name: "Rivet Calculator", url: "/rivet-calculator", description: "Rivet hole sizing." },
  { name: "Metal Weight Calculator", url: "/metal-weight-calculator", description: "Metal weight." },
  { name: "Plasma Cutting Calculator", url: "/plasma-cutting-calculator", description: "Plasma cutter settings." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Drill Bit Calculator"
  keywords="drill bit size, tap drill, clearance hole, countersink, drill chart, tap hole, letter drill, number drill, metric drill"
  breadcrumbs={[{ name: "Drill Bit Calculator", url: "/drill-bit-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Drill Bit Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find the right drill bit size for tap holes, clearance holes, and countersinks.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Mode -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Drill For</label>
        <select id="db2-mode" class="db2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="tap">Tap Drill (threaded hole)</option>
          <option value="clearance">Clearance Hole (bolt pass-through)</option>
          <option value="countersink">Countersink (flat-head screw)</option>
        </select>
      </div>

      <!-- Thread System -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Thread System</label>
        <select id="db2-system" class="db2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="unc">UNC (Coarse)</option>
          <option value="unf">UNF (Fine)</option>
          <option value="metric">Metric (ISO)</option>
        </select>
      </div>

      <!-- Bolt/Screw Size -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Bolt / Screw Size</label>
        <select id="db2-size" class="db2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="0">--</option>
        </select>
      </div>

      <!-- Thread Engagement % (for tap drill) -->
      <div class="mb-5" id="db2-engwrap">
        <label class="block text-sm font-medium text-text mb-2">Thread Engagement (%)</label>
        <input type="number" id="db2-engagement" class="db2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="75" min="50" max="100" step="5">
        <p class="text-xs text-text-muted mt-1">75% is standard. Higher = stronger but harder to tap.</p>
      </div>

      <!-- Clearance Fit (for clearance holes) -->
      <div class="mb-5 hidden" id="db2-fitwrap">
        <label class="block text-sm font-medium text-text mb-2">Fit</label>
        <select id="db2-fit" class="db2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="close">Close Fit</option>
          <option value="normal" selected>Normal Fit</option>
          <option value="loose">Loose Fit</option>
        </select>
      </div>

      <!-- Results -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="db2-resultlabel">Tap Drill Size</div>
        <div class="text-4xl font-extrabold" id="db2-drillsize">--</div>
        <div class="text-sm text-blue-200 mt-1" id="db2-drillnote">decimal inches</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Decimal (inches)</div>
          <div class="text-xl font-bold" id="db2-decimal">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Metric (mm)</div>
          <div class="text-xl font-bold" id="db2-metric">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Nearest Fractional</div>
          <div class="text-xl font-bold" id="db2-frac">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Letter/Number Drill</div>
          <div class="text-xl font-bold" id="db2-letter">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl text-center mb-6" id="db2-cswrap" style="display:none">
        <div class="text-xs text-text-muted uppercase">Countersink Diameter</div>
        <div class="text-xl font-bold" id="db2-csdia">--</div>
      </div>

      <ShareButton calculatorId="drill-bit" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Tap Drill Size Formula</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm">
        <p><strong>Tap Drill</strong> = Major Diameter - (Pitch x Thread % / 76.98)</p>
        <p>For 75% thread: Tap Drill approx = Major - Pitch (metric) or Major - 1/TPI (imperial)</p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">Tips</h3>
      <ul>
        <li><strong>75% thread</strong> is the industry standard and provides adequate strength for most applications</li>
        <li>Going above 75% adds very little strength but significantly increases tapping torque and tap breakage risk</li>
        <li>For stainless steel and tough materials, consider 60-65% thread engagement</li>
        <li>Always use cutting fluid when tapping, especially stainless steel and titanium</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    type DrillInfo = { name: string; major: number; tpi: number; pitch_mm?: number };

    const db2Data: Record<string, DrillInfo[]> = {
      unc: [
        {name:'#2-56', major:0.086, tpi:56},
        {name:'#4-40', major:0.112, tpi:40},
        {name:'#6-32', major:0.138, tpi:32},
        {name:'#8-32', major:0.164, tpi:32},
        {name:'#10-24', major:0.190, tpi:24},
        {name:'1/4-20', major:0.250, tpi:20},
        {name:'5/16-18', major:0.3125, tpi:18},
        {name:'3/8-16', major:0.375, tpi:16},
        {name:'7/16-14', major:0.4375, tpi:14},
        {name:'1/2-13', major:0.500, tpi:13},
        {name:'9/16-12', major:0.5625, tpi:12},
        {name:'5/8-11', major:0.625, tpi:11},
        {name:'3/4-10', major:0.750, tpi:10},
        {name:'7/8-9', major:0.875, tpi:9},
        {name:'1-8', major:1.000, tpi:8}
      ],
      unf: [
        {name:'#4-48', major:0.112, tpi:48},
        {name:'#6-40', major:0.138, tpi:40},
        {name:'#8-36', major:0.164, tpi:36},
        {name:'#10-32', major:0.190, tpi:32},
        {name:'1/4-28', major:0.250, tpi:28},
        {name:'5/16-24', major:0.3125, tpi:24},
        {name:'3/8-24', major:0.375, tpi:24},
        {name:'7/16-20', major:0.4375, tpi:20},
        {name:'1/2-20', major:0.500, tpi:20},
        {name:'9/16-18', major:0.5625, tpi:18},
        {name:'5/8-18', major:0.625, tpi:18},
        {name:'3/4-16', major:0.750, tpi:16},
        {name:'7/8-14', major:0.875, tpi:14},
        {name:'1-12', major:1.000, tpi:12}
      ],
      metric: [
        {name:'M3 x 0.5', major:3, tpi:0, pitch_mm:0.5},
        {name:'M4 x 0.7', major:4, tpi:0, pitch_mm:0.7},
        {name:'M5 x 0.8', major:5, tpi:0, pitch_mm:0.8},
        {name:'M6 x 1.0', major:6, tpi:0, pitch_mm:1.0},
        {name:'M8 x 1.25', major:8, tpi:0, pitch_mm:1.25},
        {name:'M10 x 1.5', major:10, tpi:0, pitch_mm:1.5},
        {name:'M12 x 1.75', major:12, tpi:0, pitch_mm:1.75},
        {name:'M14 x 2.0', major:14, tpi:0, pitch_mm:2.0},
        {name:'M16 x 2.0', major:16, tpi:0, pitch_mm:2.0},
        {name:'M18 x 2.5', major:18, tpi:0, pitch_mm:2.5},
        {name:'M20 x 2.5', major:20, tpi:0, pitch_mm:2.5},
        {name:'M24 x 3.0', major:24, tpi:0, pitch_mm:3.0}
      ]
    };

    // Number drills (#1-#80) and letter drills (A-Z) with decimal sizes
    const numberDrills: [string, number][] = [
      ['#80',0.0135],['#79',0.0145],['#78',0.016],['#77',0.018],['#76',0.020],['#75',0.021],['#74',0.0225],['#73',0.024],
      ['#72',0.025],['#71',0.026],['#70',0.028],['#69',0.0292],['#68',0.031],['#67',0.032],['#66',0.033],['#65',0.035],
      ['#64',0.036],['#63',0.037],['#62',0.038],['#61',0.039],['#60',0.040],['#59',0.041],['#58',0.042],['#57',0.043],
      ['#56',0.0465],['#55',0.052],['#54',0.055],['#53',0.0595],['#52',0.0635],['#51',0.067],['#50',0.070],
      ['#49',0.073],['#48',0.076],['#47',0.0785],['#46',0.081],['#45',0.082],['#44',0.086],['#43',0.089],
      ['#42',0.0935],['#41',0.096],['#40',0.098],['#39',0.0995],['#38',0.1015],['#37',0.104],['#36',0.1065],
      ['#35',0.110],['#34',0.111],['#33',0.113],['#32',0.116],['#31',0.120],['#30',0.1285],['#29',0.136],
      ['#28',0.1405],['#27',0.144],['#26',0.147],['#25',0.1495],['#24',0.152],['#23',0.154],['#22',0.157],
      ['#21',0.159],['#20',0.161],['#19',0.166],['#18',0.1695],['#17',0.173],['#16',0.177],['#15',0.180],
      ['#14',0.182],['#13',0.185],['#12',0.189],['#11',0.191],['#10',0.1935],['#9',0.196],['#8',0.199],
      ['#7',0.201],['#6',0.204],['#5',0.2055],['#4',0.209],['#3',0.213],['#2',0.221],['#1',0.228],
      ['A',0.234],['B',0.238],['C',0.242],['D',0.246],['E',0.250],['F',0.257],['G',0.261],['H',0.266],
      ['I',0.272],['J',0.277],['K',0.281],['L',0.290],['M',0.295],['N',0.302],['O',0.316],['P',0.323],
      ['Q',0.332],['R',0.339],['S',0.348],['T',0.358],['U',0.368],['V',0.377],['W',0.386],['X',0.397],
      ['Y',0.404],['Z',0.413]
    ];

    function findNearestDrill(target_in: number): string {
      let best = numberDrills[0];
      let bestDiff = Math.abs(target_in - best[1]);
      for (const d of numberDrills) {
        const diff = Math.abs(target_in - d[1]);
        if (diff < bestDiff) { best = d; bestDiff = diff; }
      }
      return best[0] + ' (' + best[1].toFixed(4) + '")';
    }

    function toFraction(decimal: number): string {
      const denoms = [64, 32, 16, 8, 4, 2];
      for (const d of denoms) {
        const n = Math.round(decimal * d);
        if (Math.abs(n / d - decimal) < 0.002) {
          const gcd = (a: number, b: number): number => b === 0 ? a : gcd(b, a % b);
          const g = gcd(n, d);
          return (n / g) + '/' + (d / g) + '"';
        }
      }
      return decimal.toFixed(4) + '"';
    }

    function updateDB2Sizes() {
      const system = (document.getElementById('db2-system') as HTMLSelectElement).value;
      const sizeSelect = document.getElementById('db2-size') as HTMLSelectElement;
      const data = db2Data[system] || [];
      sizeSelect.innerHTML = '';
      data.forEach((d, i) => {
        const opt = document.createElement('option');
        opt.value = String(i);
        opt.textContent = d.name;
        sizeSelect.appendChild(opt);
      });
    }

    function calcDB2() {
      const mode = (document.getElementById('db2-mode') as HTMLSelectElement).value;
      const system = (document.getElementById('db2-system') as HTMLSelectElement).value;
      const idx = parseInt((document.getElementById('db2-size') as HTMLSelectElement).value) || 0;
      const engagement = (parseFloat((document.getElementById('db2-engagement') as HTMLInputElement).value) || 75) / 100;
      const fit = (document.getElementById('db2-fit') as HTMLSelectElement).value;
      const isMetric = system === 'metric';
      const data = db2Data[system];
      if (!data || !data[idx]) return;
      const d = data[idx];

      // Show/hide relevant controls
      document.getElementById('db2-engwrap')!.classList.toggle('hidden', mode !== 'tap');
      document.getElementById('db2-fitwrap')!.classList.toggle('hidden', mode !== 'clearance');
      const csEl = document.getElementById('db2-cswrap') as HTMLElement;
      csEl.style.display = mode === 'countersink' ? '' : 'none';

      let drillSize_in = 0;
      let label = '';

      if (mode === 'tap') {
        label = 'Tap Drill Size';
        if (isMetric) {
          const pitch = d.pitch_mm || 1;
          const drillMM = d.major - pitch * engagement / 0.7698;
          drillSize_in = drillMM / 25.4;
        } else {
          const pitch_in = 1 / d.tpi;
          drillSize_in = d.major - pitch_in * engagement / 0.7698;
        }
      } else if (mode === 'clearance') {
        label = 'Clearance Hole Drill';
        let major_in = isMetric ? d.major / 25.4 : d.major;
        let add = 0;
        if (fit === 'close') add = major_in * 0.03;
        else if (fit === 'normal') add = major_in * 0.06;
        else add = major_in * 0.12;
        drillSize_in = major_in + add;
      } else {
        label = 'Clearance + Countersink';
        let major_in = isMetric ? d.major / 25.4 : d.major;
        drillSize_in = major_in + major_in * 0.06;
        // Countersink diameter: typically 2x bolt head diameter
        const csdia_in = major_in * 2;
        document.getElementById('db2-csdia')!.textContent = csdia_in.toFixed(3) + '" (' + (csdia_in * 25.4).toFixed(1) + ' mm)';
      }

      const drillMM = drillSize_in * 25.4;

      document.getElementById('db2-resultlabel')!.textContent = label;
      document.getElementById('db2-drillsize')!.textContent = drillSize_in.toFixed(4) + '"';
      document.getElementById('db2-drillnote')!.textContent = isMetric ? (drillMM.toFixed(2) + ' mm') : 'decimal inches';
      document.getElementById('db2-decimal')!.textContent = drillSize_in.toFixed(4) + '"';
      document.getElementById('db2-metric')!.textContent = drillMM.toFixed(2) + ' mm';
      document.getElementById('db2-frac')!.textContent = toFraction(drillSize_in);
      document.getElementById('db2-letter')!.textContent = findNearestDrill(drillSize_in);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.getElementById('db2-system')!.addEventListener('change', () => { updateDB2Sizes(); calcDB2(); });

      document.querySelectorAll('.db2-in').forEach(el => {
        el.addEventListener('input', calcDB2);
        el.addEventListener('change', calcDB2);
      });

      updateDB2Sizes();
      calcDB2();
    }, 50);
  </script>
</CalculatorLayout>
