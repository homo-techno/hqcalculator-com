---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Photo Lighting Calculator - Lux, Lumens, Softbox & Positioning";
const description = "Calculate the light output needed in lux and lumens for photography. Determine softbox coverage area and optimal positioning with inverse square law.";
const relatedCalcs = [
  { name: "Flash Guide Number", url: "/flash-guide-number-calculator", description: "Flash power and distance." },
  { name: "Exposure Calculator", url: "/exposure-calculator", description: "Exposure triangle calculations." },
  { name: "Light Intensity", url: "/light-intensity-calculator", description: "Light intensity and lux." },
  { name: "Color Temperature", url: "/color-temperature-calculator", description: "Kelvin and mired conversions." },
  { name: "Lighting Calculator", url: "/lighting-calculator", description: "Room lighting needs." },
  { name: "Depth of Field", url: "/depth-of-field-calculator", description: "Aperture and DoF." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Photo Lighting Calculator" keywords="photo lighting calculator, lux lumens photography, softbox size, inverse square law, studio lighting, key light power" breadcrumbs={[{ name: "Photo Lighting", url: "/photo-lighting-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Photo Lighting Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate required light output, softbox coverage, and inverse square positioning for studio photography.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <h3 class="font-semibold text-text">Desired Exposure</h3>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">ISO</label>
            <select id="pl-iso" class="pl-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="100" selected>100</option>
              <option value="200">200</option>
              <option value="400">400</option>
              <option value="800">800</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Aperture (f/)</label>
            <input type="number" id="pl-aperture" class="pl-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="8" min="1" max="64" step="0.1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Shutter (1/x)</label>
            <input type="number" id="pl-shutter" class="pl-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="125" min="1" max="8000" step="1">
          </div>
        </div>

        <h3 class="font-semibold text-text">Light Source</h3>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Light Output (lumens)</label>
          <input type="number" id="pl-lumens" class="pl-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="5000" min="100" step="100">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Light-to-Subject Distance</label>
          <div class="flex gap-2">
            <input type="number" id="pl-dist" class="pl-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="1.5" min="0.1" step="0.1">
            <select id="pl-unit" class="pl-in px-4 py-3 border border-border rounded-xl text-lg">
              <option value="m" selected>m</option>
              <option value="ft">ft</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Modifier</label>
          <select id="pl-mod" class="pl-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="1.0">Bare bulb / reflector</option>
            <option value="0.6" selected>Softbox (1-2 stop loss)</option>
            <option value="0.4">Umbrella (shoot-through)</option>
            <option value="0.75">Beauty dish</option>
            <option value="0.3">Heavy diffusion</option>
          </select>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Light at Subject (lux)</div>
          <div class="text-4xl font-extrabold" id="pl-lux"></div>
          <div class="text-sm text-blue-200 mt-1" id="pl-ev"></div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Lux Needed for Exposure</div>
            <div class="text-xl font-bold text-text" id="pl-needed"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Exposure Difference</div>
            <div class="text-xl font-bold text-text" id="pl-diff"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">At 2x Distance</div>
            <div class="text-xl font-bold text-text" id="pl-2x"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">At 0.5x Distance</div>
            <div class="text-xl font-bold text-text" id="pl-half"></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="photo-lighting" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Studio Lighting Fundamentals</h2>
      <p>The inverse square law states that light intensity falls off with the square of the distance. Moving a light from 1m to 2m reduces illumination to 1/4.</p>
      <p><strong>Key light power:</strong> For f/8 at ISO 100 and 1/125s, you typically need around 2,500+ lux at the subject for proper exposure.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcPL() {
      const iso = parseInt((document.getElementById('pl-iso') as HTMLSelectElement).value);
      const aperture = parseFloat((document.getElementById('pl-aperture') as HTMLInputElement).value) || 8;
      const shutterDenom = parseFloat((document.getElementById('pl-shutter') as HTMLInputElement).value) || 125;
      const lumens = parseFloat((document.getElementById('pl-lumens') as HTMLInputElement).value) || 5000;
      let dist = parseFloat((document.getElementById('pl-dist') as HTMLInputElement).value) || 1.5;
      const unit = (document.getElementById('pl-unit') as HTMLSelectElement).value;
      const modEff = parseFloat((document.getElementById('pl-mod') as HTMLSelectElement).value);

      const distM = unit === 'ft' ? dist * 0.3048 : dist;

      // lux = lumens / (4 * pi * d^2) for point source, modified by modifier
      const luxAtSubject = (lumens * modEff) / (4 * Math.PI * distM * distM);

      document.getElementById('pl-lux')!.textContent = Math.round(luxAtSubject).toLocaleString() + ' lux';

      // EV from lux: EV = log2(lux / 2.5)
      const evFromLux = Math.log2(luxAtSubject / 2.5);
      document.getElementById('pl-ev')!.textContent = 'EV ' + evFromLux.toFixed(1) + ' at subject';

      // Required lux from exposure settings: lux = 2.5 * (N^2 / t) * (100/ISO)
      const shutterTime = 1 / shutterDenom;
      const neededLux = 2.5 * (aperture * aperture / shutterTime) * (100 / iso);
      document.getElementById('pl-needed')!.textContent = Math.round(neededLux).toLocaleString() + ' lux';

      const stopDiff = Math.log2(luxAtSubject / neededLux);
      let diffText = '';
      if (Math.abs(stopDiff) < 0.1) diffText = 'Correct exposure';
      else if (stopDiff > 0) diffText = '+' + stopDiff.toFixed(1) + ' stops (over)';
      else diffText = stopDiff.toFixed(1) + ' stops (under)';
      document.getElementById('pl-diff')!.textContent = diffText;

      const lux2x = luxAtSubject / 4;
      const luxHalf = luxAtSubject * 4;
      document.getElementById('pl-2x')!.textContent = Math.round(lux2x).toLocaleString() + ' lux';
      document.getElementById('pl-half')!.textContent = Math.round(luxHalf).toLocaleString() + ' lux';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.pl-in').forEach(el => {
        el.addEventListener('input', calcPL);
        el.addEventListener('change', calcPL);
      });
      calcPL();
    }, 50);
  </script>
</CalculatorLayout>
