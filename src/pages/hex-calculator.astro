---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Hex Calculator - Hexadecimal Converter & Arithmetic";
const description = "Convert between hexadecimal, decimal, binary, and octal. Perform hex arithmetic operations and explore color codes.";

const relatedCalcs = [
  { name: "Binary Calculator", url: "/binary-calculator", description: "Binary math." },
  { name: "Subnet Calculator", url: "/subnet-calculator", description: "IP subnets." },
  { name: "Roman Numeral", url: "/roman-numeral-converter", description: "Roman numerals." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Average Calculator", url: "/average-calculator", description: "Mean & median." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Hex Calculator"
  keywords="hex calculator, hexadecimal converter, hex to decimal, decimal to hex, hex arithmetic, hex color"
  breadcrumbs={[{ name: "Hex Calculator", url: "/hex-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Hex Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert between number bases and perform hexadecimal arithmetic.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Converter -->
      <h3 class="font-semibold text-text mb-3">Number Base Converter</h3>
      <div class="space-y-3 mb-6">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Hexadecimal (Base 16)</label>
          <input type="text" id="hx-hex" class="w-full px-4 py-3 border border-border rounded-xl text-lg font-mono uppercase" value="FF">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Decimal (Base 10)</label>
          <input type="text" id="hx-dec" class="w-full px-4 py-3 border border-border rounded-xl text-lg font-mono" value="255">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Binary (Base 2)</label>
          <input type="text" id="hx-bin" class="w-full px-4 py-3 border border-border rounded-xl text-lg font-mono" value="11111111">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Octal (Base 8)</label>
          <input type="text" id="hx-oct" class="w-full px-4 py-3 border border-border rounded-xl text-lg font-mono" value="377">
        </div>
      </div>

      <div class="flex flex-wrap gap-2 mb-6">
        <button class="hx-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold font-mono" data-val="FF">FF</button>
        <button class="hx-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold font-mono" data-val="100">100</button>
        <button class="hx-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold font-mono" data-val="FFFF">FFFF</button>
        <button class="hx-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold font-mono" data-val="FFFFFF">FFFFFF</button>
        <button class="hx-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold font-mono" data-val="7F">7F</button>
        <button class="hx-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold font-mono" data-val="A5">A5</button>
      </div>

      <!-- Hex Arithmetic -->
      <h3 class="font-semibold text-text mb-3">Hex Arithmetic</h3>
      <div class="flex items-center gap-2 mb-4">
        <input type="text" id="hx-a" class="flex-1 px-4 py-3 border border-border rounded-xl text-lg font-mono uppercase" value="1A" placeholder="Hex A">
        <select id="hx-op" class="px-3 py-3 border border-border rounded-xl text-lg font-bold">
          <option value="+">+</option>
          <option value="-">−</option>
          <option value="*">×</option>
          <option value="/">/</option>
          <option value="&">&</option>
          <option value="|">|</option>
          <option value="^">XOR</option>
        </select>
        <input type="text" id="hx-b" class="flex-1 px-4 py-3 border border-border rounded-xl text-lg font-mono uppercase" value="0F" placeholder="Hex B">
      </div>

      <div class="p-4 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Result (Hex)</div>
        <div class="text-3xl font-extrabold font-mono" id="hx-result">0</div>
        <div class="text-sm text-blue-200 mt-1 font-mono" id="hx-result-dec">(= 0 decimal)</div>
      </div>

      <!-- Color preview -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-2">Color Preview</h3>
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2 flex-1">
            <span class="text-text-muted font-mono text-sm">#</span>
            <input type="text" id="hx-color" class="flex-1 px-3 py-2 border border-border rounded-lg font-mono uppercase" value="FF6B35" maxlength="6" placeholder="RRGGBB">
          </div>
          <div id="hx-color-preview" class="w-16 h-16 rounded-xl border border-border" style="background-color: #FF6B35;"></div>
        </div>
        <div class="grid grid-cols-3 gap-2 mt-3 text-center text-xs">
          <div class="p-2 bg-white rounded-lg"><span class="text-text-muted">R:</span> <span id="hx-r" class="font-bold font-mono">255</span></div>
          <div class="p-2 bg-white rounded-lg"><span class="text-text-muted">G:</span> <span id="hx-g" class="font-bold font-mono">107</span></div>
          <div class="p-2 bg-white rounded-lg"><span class="text-text-muted">B:</span> <span id="hx-b-val" class="font-bold font-mono">53</span></div>
        </div>
      </div>

      <ShareButton calculatorId="hex" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">How Hexadecimal Works</h2>
      <p>Hexadecimal (hex) is a base-16 number system using digits 0-9 and letters A-F. Each hex digit represents 4 binary bits, making it ideal for representing binary data compactly.</p>

      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-center">
        FF₁₆ = 15×16 + 15×1 = 255₁₀ = 11111111₂
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Hex Digit Reference</h3>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead><tr><th class="text-left px-2 py-1">Hex</th><th class="text-left px-2 py-1">Dec</th><th class="text-left px-2 py-1">Binary</th><th class="text-left px-2 py-1">Hex</th><th class="text-left px-2 py-1">Dec</th><th class="text-left px-2 py-1">Binary</th></tr></thead>
          <tbody>
            <tr><td class="px-2 py-1 font-mono">0</td><td class="px-2 py-1">0</td><td class="px-2 py-1 font-mono">0000</td><td class="px-2 py-1 font-mono">8</td><td class="px-2 py-1">8</td><td class="px-2 py-1 font-mono">1000</td></tr>
            <tr><td class="px-2 py-1 font-mono">1</td><td class="px-2 py-1">1</td><td class="px-2 py-1 font-mono">0001</td><td class="px-2 py-1 font-mono">9</td><td class="px-2 py-1">9</td><td class="px-2 py-1 font-mono">1001</td></tr>
            <tr><td class="px-2 py-1 font-mono">2</td><td class="px-2 py-1">2</td><td class="px-2 py-1 font-mono">0010</td><td class="px-2 py-1 font-mono">A</td><td class="px-2 py-1">10</td><td class="px-2 py-1 font-mono">1010</td></tr>
            <tr><td class="px-2 py-1 font-mono">3</td><td class="px-2 py-1">3</td><td class="px-2 py-1 font-mono">0011</td><td class="px-2 py-1 font-mono">B</td><td class="px-2 py-1">11</td><td class="px-2 py-1 font-mono">1011</td></tr>
            <tr><td class="px-2 py-1 font-mono">4</td><td class="px-2 py-1">4</td><td class="px-2 py-1 font-mono">0100</td><td class="px-2 py-1 font-mono">C</td><td class="px-2 py-1">12</td><td class="px-2 py-1 font-mono">1100</td></tr>
            <tr><td class="px-2 py-1 font-mono">5</td><td class="px-2 py-1">5</td><td class="px-2 py-1 font-mono">0101</td><td class="px-2 py-1 font-mono">D</td><td class="px-2 py-1">13</td><td class="px-2 py-1 font-mono">1101</td></tr>
            <tr><td class="px-2 py-1 font-mono">6</td><td class="px-2 py-1">6</td><td class="px-2 py-1 font-mono">0110</td><td class="px-2 py-1 font-mono">E</td><td class="px-2 py-1">14</td><td class="px-2 py-1 font-mono">1110</td></tr>
            <tr><td class="px-2 py-1 font-mono">7</td><td class="px-2 py-1">7</td><td class="px-2 py-1 font-mono">0111</td><td class="px-2 py-1 font-mono">F</td><td class="px-2 py-1">15</td><td class="px-2 py-1 font-mono">1111</td></tr>
          </tbody>
        </table>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>Why is hex used in programming?</strong> Hex compactly represents binary data — each hex digit maps to exactly 4 bits. A byte (8 bits) is two hex digits, making memory addresses, colors, and binary data easy to read.</p>
      <p><strong>How do hex colors work?</strong> HTML/CSS colors use #RRGGBB format where each pair is a hex value 00-FF (0-255 in decimal) representing red, green, and blue intensity.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let updatingFrom = '';

    function updateFromDec(dec: number) {
      if (isNaN(dec) || dec < 0) return;
      const n = Math.floor(dec);
      if (updatingFrom !== 'hex') (document.getElementById('hx-hex') as HTMLInputElement).value = n.toString(16).toUpperCase();
      if (updatingFrom !== 'dec') (document.getElementById('hx-dec') as HTMLInputElement).value = String(n);
      if (updatingFrom !== 'bin') (document.getElementById('hx-bin') as HTMLInputElement).value = n.toString(2);
      if (updatingFrom !== 'oct') (document.getElementById('hx-oct') as HTMLInputElement).value = n.toString(8);
    }

    function calcHexArith() {
      const aStr = (document.getElementById('hx-a') as HTMLInputElement).value.trim();
      const bStr = (document.getElementById('hx-b') as HTMLInputElement).value.trim();
      const op = (document.getElementById('hx-op') as HTMLSelectElement).value;

      const a = parseInt(aStr, 16);
      const b = parseInt(bStr, 16);
      if (isNaN(a) || isNaN(b)) return;

      let result: number;
      switch (op) {
        case '+': result = a + b; break;
        case '-': result = Math.max(0, a - b); break;
        case '*': result = a * b; break;
        case '/': result = b !== 0 ? Math.floor(a / b) : 0; break;
        case '&': result = a & b; break;
        case '|': result = a | b; break;
        case '^': result = a ^ b; break;
        default: result = 0;
      }

      document.getElementById('hx-result')!.textContent = result.toString(16).toUpperCase();
      document.getElementById('hx-result-dec')!.textContent = `(= ${result} decimal)`;
    }

    function updateColor() {
      const hex = (document.getElementById('hx-color') as HTMLInputElement).value.trim();
      if (!/^[0-9A-Fa-f]{6}$/.test(hex)) return;

      document.getElementById('hx-color-preview')!.style.backgroundColor = '#' + hex;
      document.getElementById('hx-r')!.textContent = String(parseInt(hex.slice(0, 2), 16));
      document.getElementById('hx-g')!.textContent = String(parseInt(hex.slice(2, 4), 16));
      document.getElementById('hx-b-val')!.textContent = String(parseInt(hex.slice(4, 6), 16));
    }

    setTimeout(() => {
      document.getElementById('hx-hex')!.addEventListener('input', () => {
        updatingFrom = 'hex';
        updateFromDec(parseInt((document.getElementById('hx-hex') as HTMLInputElement).value, 16) || 0);
        updatingFrom = '';
      });
      document.getElementById('hx-dec')!.addEventListener('input', () => {
        updatingFrom = 'dec';
        updateFromDec(parseInt((document.getElementById('hx-dec') as HTMLInputElement).value) || 0);
        updatingFrom = '';
      });
      document.getElementById('hx-bin')!.addEventListener('input', () => {
        updatingFrom = 'bin';
        updateFromDec(parseInt((document.getElementById('hx-bin') as HTMLInputElement).value, 2) || 0);
        updatingFrom = '';
      });
      document.getElementById('hx-oct')!.addEventListener('input', () => {
        updatingFrom = 'oct';
        updateFromDec(parseInt((document.getElementById('hx-oct') as HTMLInputElement).value, 8) || 0);
        updatingFrom = '';
      });

      document.querySelectorAll('.hx-quick').forEach(btn => {
        btn.addEventListener('click', () => {
          (document.getElementById('hx-hex') as HTMLInputElement).value = (btn as HTMLElement).dataset.val || 'FF';
          updatingFrom = 'hex';
          updateFromDec(parseInt((btn as HTMLElement).dataset.val || 'FF', 16));
          updatingFrom = '';
        });
      });

      ['hx-a', 'hx-b'].forEach(id => document.getElementById(id)!.addEventListener('input', calcHexArith));
      document.getElementById('hx-op')!.addEventListener('change', calcHexArith);
      document.getElementById('hx-color')!.addEventListener('input', updateColor);

      calcHexArith();
      updateColor();
    }, 50);
  </script>
</CalculatorLayout>
