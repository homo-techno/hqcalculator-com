---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Crochet Pattern Calculator - Stitch Count & Yarn Needed";
const description = "Calculate crochet chain and stitch counts for rectangles and circles, yarn needed, and hook size recommendations by yarn weight.";
const relatedCalcs = [
  { name: "Yarn Calculator", url: "/yarn-calculator", description: "Yarn yardage calculator." },
  { name: "Fabric Calculator", url: "/fabric-calculator", description: "Fabric yardage needs." },
  { name: "Quilt Calculator", url: "/quilt-calculator", description: "Quilt sizing math." },
  { name: "Area Calculator", url: "/area-calculator", description: "Area calculations." },
  { name: "Ratio Calculator", url: "/ratio-calculator", description: "Ratio calculations." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Crochet Pattern Calculator" keywords="crochet pattern calculator, chain count, stitch count, yarn needed, hook size, crochet circle, crochet rectangle" breadcrumbs={[{ name: "Crochet Pattern", url: "/crochet-pattern-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Crochet Pattern Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate stitch counts, yarn needed, and hook sizes for your crochet projects.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Project Shape</label>
            <select id="cr-shape" class="cr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="rect" selected>Rectangle / Square</option>
              <option value="circle">Circle</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Yarn Weight</label>
            <select id="cr-weight" class="cr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="1">Fingering (#1)</option>
              <option value="2">Sport (#2)</option>
              <option value="3">DK (#3)</option>
              <option value="4" selected>Worsted (#4)</option>
              <option value="5">Bulky (#5)</option>
              <option value="6">Super Bulky (#6)</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Width / Diameter (inches)</label><input type="number" id="cr-w" class="cr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="1" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Height / Length (inches)</label><input type="number" id="cr-h" class="cr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="1" step="0.5"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Gauge: Stitches per 4 in</label><input type="number" id="cr-gst" class="cr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="14" min="4" max="40" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Gauge: Rows per 4 in</label><input type="number" id="cr-grow" class="cr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="4" max="40" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Yards per Skein</label><input type="number" id="cr-yps" class="cr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="220" min="10" step="10"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Price per Skein ($)</label><input type="number" id="cr-price" class="cr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="7" min="0" step="0.5"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Starting Chain Count</div>
          <div class="text-4xl font-extrabold font-mono" id="cr-result">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Rows</div><div class="text-xl font-bold font-mono" id="cr-rows">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Stitches</div><div class="text-xl font-bold font-mono" id="cr-totalsts">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Hook Size</div><div class="text-xl font-bold font-mono" id="cr-hook">--</div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Yarn Needed</div><div class="text-xl font-bold font-mono" id="cr-yarn">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Skeins</div><div class="text-xl font-bold font-mono" id="cr-skeins">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Cost</div><div class="text-xl font-bold font-mono" id="cr-cost">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="crochet-pattern" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcCR() {
      const shape = (document.getElementById('cr-shape') as HTMLSelectElement).value;
      const wt = parseInt((document.getElementById('cr-weight') as HTMLSelectElement).value);
      const w = parseFloat((document.getElementById('cr-w') as HTMLInputElement).value) || 12;
      const h = parseFloat((document.getElementById('cr-h') as HTMLInputElement).value) || 12;
      const gst = parseFloat((document.getElementById('cr-gst') as HTMLInputElement).value) || 14;
      const grow = parseFloat((document.getElementById('cr-grow') as HTMLInputElement).value) || 10;
      const yps = parseFloat((document.getElementById('cr-yps') as HTMLInputElement).value) || 220;
      const price = parseFloat((document.getElementById('cr-price') as HTMLInputElement).value) || 0;

      const spi = gst / 4;
      const rpi = grow / 4;

      const hookSizes: Record<number, string> = {
        1: 'B/1-C/2 (2.25-2.75mm)', 2: 'D/3-E/4 (3.25-3.5mm)',
        3: 'E/4-7 (3.5-4.5mm)', 4: 'H/8-I/9 (5-5.5mm)',
        5: 'J/10-K/10.5 (6-6.5mm)', 6: 'L/11-M/13 (8-9mm)'
      };

      let chainCount: number, totalRows: number, totalStitches: number;

      if (shape === 'rect') {
        chainCount = Math.round(spi * w) + 1; // +1 turning chain
        totalRows = Math.round(rpi * h);
        totalStitches = chainCount * totalRows;
      } else {
        // Circle: increases by 6 per round (sc) or 12 (dc)
        const radius = w / 2;
        const rounds = Math.round(rpi * radius);
        chainCount = 4; // magic ring start
        totalRows = rounds;
        totalStitches = 0;
        for (let r = 1; r <= rounds; r++) {
          totalStitches += 6 * r;
        }
      }

      // Yarn estimate: ~1 yard per 10-20 stitches depending on weight
      const ydsPerStitch: Record<number, number> = { 1: 0.04, 2: 0.05, 3: 0.06, 4: 0.07, 5: 0.09, 6: 0.12 };
      const yardFactor = ydsPerStitch[wt] || 0.07;
      const yarnYards = totalStitches * yardFactor * 1.1; // 10% buffer
      const skeins = Math.ceil(yarnYards / yps);
      const cost = skeins * price;

      document.getElementById('cr-result')!.textContent = chainCount + ' chains';
      document.getElementById('cr-rows')!.textContent = totalRows.toString();
      document.getElementById('cr-totalsts')!.textContent = totalStitches.toLocaleString();
      document.getElementById('cr-hook')!.textContent = hookSizes[wt] || '--';
      document.getElementById('cr-yarn')!.textContent = Math.round(yarnYards) + ' yd';
      document.getElementById('cr-skeins')!.textContent = skeins.toString();
      document.getElementById('cr-cost')!.textContent = '$' + cost.toFixed(2);
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.cr-in').forEach(el => { el.addEventListener('input', calcCR); el.addEventListener('change', calcCR); });
      calcCR();
    }, 50);
  </script>
</CalculatorLayout>
