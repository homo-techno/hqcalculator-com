---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Tip & Split Calculator - Split the Bill Easily";
const description = "Calculate tip and split the bill among friends. Supports custom tip percentages and uneven splits.";

const relatedCalcs = [
  { name: "Tip Calculator", url: "/tip-calculator", description: "Tips." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Discount Calculator", url: "/discount-calculator", description: "Discounts." },
  { name: "Sales Tax", url: "/sales-tax-calculator", description: "Sales tax." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Budget." },
  { name: "Currency Converter", url: "/currency-converter", description: "Currency." },
];
---

<CalculatorLayout title={title} description={description} calculatorName="Tip & Split Calculator" keywords="tip split calculator, split bill, bill splitter, tip calculator, share bill" breadcrumbs={[{ name: "Tip & Split", url: "/tip-split-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Tip & Split Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate tip and split the bill evenly among your group.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Bill Amount</label>
          <div class="relative"><span class="absolute left-4 top-1/2 -translate-y-1/2 text-text-muted font-bold">$</span>
            <input type="number" id="ts-bill" class="w-full pl-8 pr-4 py-3 border border-border rounded-xl text-2xl font-bold" value="86.50" min="0" step="0.01">
          </div>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-2">Tip Percentage</label>
          <div class="grid grid-cols-5 gap-2">
            <button class="ts-tip-btn px-2 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="10">10%</button>
            <button class="ts-tip-btn px-2 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="15">15%</button>
            <button class="ts-tip-btn px-2 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary text-center" data-val="18">18%</button>
            <button class="ts-tip-btn px-2 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="20">20%</button>
            <button class="ts-tip-btn px-2 py-2 rounded-xl text-sm font-semibold border border-border text-center" data-val="25">25%</button>
          </div>
          <input type="number" id="ts-tip-custom" class="w-full mt-2 px-4 py-2 border border-border rounded-xl text-lg" value="18" min="0" max="100" step="1" placeholder="Custom %">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Number of People</label>
          <div class="flex items-center gap-3">
            <button id="ts-minus" class="w-10 h-10 rounded-xl border border-border text-lg font-bold">âˆ’</button>
            <span class="text-3xl font-bold w-12 text-center" id="ts-people">2</span>
            <button id="ts-plus" class="w-10 h-10 rounded-xl border border-border text-lg font-bold">+</button>
          </div>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Each Person Pays</div>
          <div class="text-5xl font-extrabold" id="ts-each">$0</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Tip Amount</div>
            <div class="text-xl font-bold text-secondary" id="ts-tip-amt">$0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total</div>
            <div class="text-xl font-bold" id="ts-total">$0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Tip per Person</div>
            <div class="text-xl font-bold" id="ts-tip-each">$0</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="tip-split" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Tipping Guide</h2>
      <p>Standard restaurant tip: <strong>15-20%</strong>. For great service, 20-25%. For large groups (6+), many restaurants add 18% automatically.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let tipPct = 18, people = 2;

    function calcTipSplit() {
      const bill = parseFloat((document.getElementById('ts-bill') as HTMLInputElement).value) || 0;
      const tip = bill * tipPct / 100;
      const total = bill + tip;
      const each = total / people;
      const tipEach = tip / people;

      document.getElementById('ts-each')!.textContent = '$' + each.toFixed(2);
      document.getElementById('ts-tip-amt')!.textContent = '$' + tip.toFixed(2);
      document.getElementById('ts-total')!.textContent = '$' + total.toFixed(2);
      document.getElementById('ts-tip-each')!.textContent = '$' + tipEach.toFixed(2);
      document.getElementById('ts-people')!.textContent = String(people);
      (document.getElementById('ts-tip-custom') as HTMLInputElement).value = String(tipPct);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.getElementById('ts-bill')!.addEventListener('input', calcTipSplit);
      document.getElementById('ts-tip-custom')!.addEventListener('input', () => {
        tipPct = parseFloat((document.getElementById('ts-tip-custom') as HTMLInputElement).value) || 0;
        document.querySelectorAll('.ts-tip-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
        calcTipSplit();
      });
      document.getElementById('ts-minus')!.addEventListener('click', () => { people = Math.max(1, people - 1); calcTipSplit(); });
      document.getElementById('ts-plus')!.addEventListener('click', () => { people++; calcTipSplit(); });

      document.querySelectorAll('.ts-tip-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.ts-tip-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          tipPct = parseInt((btn as HTMLElement).dataset.val || '18');
          calcTipSplit();
        });
      });

      calcTipSplit();
    }, 50);
  </script>
</CalculatorLayout>
