---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Compost Calculator - C:N Ratio & Volume Estimator";
const description = "Calculate your compost carbon-to-nitrogen ratio, get recommendations for balance, and estimate finished compost volume.";
const relatedCalcs = [
  { name: "Garden Spacing", url: "/garden-spacing-calculator", description: "Plan garden bed layouts." },
  { name: "Fertilizer Calculator", url: "/fertilizer-calculator", description: "Calculate fertilizer needs." },
  { name: "Seed Calculator", url: "/seed-calculator", description: "Seeds needed for planting." },
  { name: "Harvest Date Calculator", url: "/harvest-date-calculator", description: "Predict harvest dates." },
  { name: "Irrigation Calculator", url: "/irrigation-calculator", description: "Plan irrigation schedules." },
  { name: "Greenhouse Calculator", url: "/greenhouse-calculator", description: "Greenhouse heating needs." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Compost Calculator" keywords="compost calculator, carbon nitrogen ratio, C:N ratio, composting, green brown ratio, compost volume" breadcrumbs={[{ name: "Compost", url: "/compost-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Compost Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate your compost C:N ratio and get recommendations for the perfect mix.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Green Materials (lbs)</label>
            <input type="number" id="cm2-green" class="cm2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="0" step="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Brown Materials (lbs)</label>
            <input type="number" id="cm2-brown" class="cm2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="60" min="0" step="1">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Green C:N Ratio</label>
            <select id="cm2-greentype" class="cm2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="15">Grass Clippings (~15:1)</option>
              <option value="20">Fruit/Veg Scraps (~20:1)</option>
              <option value="12">Coffee Grounds (~12:1)</option>
              <option value="25" selected>Mixed Green (~25:1)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Brown C:N Ratio</label>
            <select id="cm2-browntype" class="cm2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="60" selected>Dry Leaves (~60:1)</option>
              <option value="80">Straw (~80:1)</option>
              <option value="400">Cardboard (~400:1)</option>
              <option value="500">Sawdust (~500:1)</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Your C:N Ratio</div>
          <div class="text-5xl font-extrabold font-mono" id="cm2-result">0:1</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Target Ratio</div><div class="text-xl font-bold font-mono">30:1</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Status</div><div class="text-xl font-bold font-mono" id="cm2-status">-</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Recommendation</div><div class="text-xl font-bold font-mono" id="cm2-rec">-</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Est. Compost Volume</div><div class="text-xl font-bold font-mono" id="cm2-vol">0 ft&sup3;</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Weight</div><div class="text-xl font-bold font-mono" id="cm2-total">0 lbs</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Green:Brown Ratio</div><div class="text-xl font-bold font-mono" id="cm2-ratio">0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="compost" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcCM2() {
      const greenLbs = parseFloat((document.getElementById('cm2-green') as HTMLInputElement).value) || 0;
      const brownLbs = parseFloat((document.getElementById('cm2-brown') as HTMLInputElement).value) || 0;
      const greenCN = parseFloat((document.getElementById('cm2-greentype') as HTMLSelectElement).value) || 25;
      const brownCN = parseFloat((document.getElementById('cm2-browntype') as HTMLSelectElement).value) || 60;
      const totalWeight = greenLbs + brownLbs;
      // Weighted average C:N ratio
      let cnRatio = 0;
      if (totalWeight > 0) {
        cnRatio = (greenLbs * greenCN + brownLbs * brownCN) / totalWeight;
      }
      let status = '';
      let rec = '';
      if (cnRatio < 20) { status = 'Too Low'; rec = 'Add Browns'; }
      else if (cnRatio < 25) { status = 'Low'; rec = 'Add Browns'; }
      else if (cnRatio <= 35) { status = 'Ideal!'; rec = 'Good Balance'; }
      else if (cnRatio <= 50) { status = 'High'; rec = 'Add Greens'; }
      else { status = 'Too High'; rec = 'Add Greens'; }
      // Estimate volume: ~20 lbs per cubic foot for raw, shrinks to ~40% finished
      const rawVolume = totalWeight / 20;
      const finishedVol = rawVolume * 0.4;
      const gbRatio = brownLbs > 0 ? (greenLbs / brownLbs).toFixed(2) : '0';
      document.getElementById('cm2-result')!.textContent = cnRatio.toFixed(0) + ':1';
      document.getElementById('cm2-status')!.textContent = status;
      document.getElementById('cm2-rec')!.textContent = rec;
      document.getElementById('cm2-vol')!.textContent = finishedVol.toFixed(1) + ' ft\u00B3';
      document.getElementById('cm2-total')!.textContent = totalWeight + ' lbs';
      document.getElementById('cm2-ratio')!.textContent = gbRatio + ':1';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.cm2-in').forEach(el => { el.addEventListener('input', calcCM2); el.addEventListener('change', calcCM2); });
      calcCM2();
    }, 50);
  </script>
</CalculatorLayout>
