---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Crop Yield Calculator - Revenue & Profit Margin";
const description = "Estimate expected crop yield from acreage and crop type. Calculate revenue, input costs, and profit margin for farming operations.";
const relatedCalcs = [
  { name: "Fertilizer Calculator", url: "/fertilizer-calculator", description: "Fertilizer application rates." },
  { name: "Seed Calculator", url: "/seed-calculator", description: "Seed quantities for planting." },
  { name: "Harvest Date", url: "/harvest-date-calculator", description: "Estimate harvest timing." },
  { name: "Irrigation Calculator", url: "/irrigation-calculator", description: "Irrigation water needs." },
  { name: "Growing Degree Day", url: "/growing-degree-day-calculator", description: "Track heat accumulation." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Plan your budget." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Crop Yield Calculator" keywords="crop yield calculator, farm revenue, profit margin, bushels per acre, crop production cost" breadcrumbs={[{ name: "Crop Yield", url: "/crop-yield-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Crop Yield Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate yield, revenue, input costs, and profit margin for your crops.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Crop Type</label>
          <select id="cy-crop" class="cy-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="180|6.50|250">Corn (180 bu/ac, $6.50/bu)</option>
            <option value="55|13.00|200">Soybeans (55 bu/ac, $13.00/bu)</option>
            <option value="50|7.00|180">Winter Wheat (50 bu/ac, $7.00/bu)</option>
            <option value="150|5.50|220">Oats (150 bu/ac, $5.50/bu)</option>
            <option value="40|12.00|200">Canola (40 bu/ac, $12.00/bu)</option>
            <option value="4.5|900|350">Alfalfa Hay (4.5 ton/ac, $900/ton)</option>
            <option value="35000|0.02|300">Potatoes (35000 lb/ac, $0.02/lb)</option>
            <option value="1200|0.80|350">Cotton Lint (1200 lb/ac, $0.80/lb)</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Planted Acres</label>
            <input type="number" id="cy-acres" class="cy-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="100" min="1" max="50000" step="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Yield Adjustment (%)</label>
            <input type="number" id="cy-adj" class="cy-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="100" min="10" max="150" step="5">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Seed Cost ($/acre)</label>
            <input type="number" id="cy-seed" class="cy-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="80" min="0" step="5">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Fertilizer Cost ($/acre)</label>
            <input type="number" id="cy-fert" class="cy-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="90" min="0" step="5">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Chemical/Spray ($/acre)</label>
            <input type="number" id="cy-chem" class="cy-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="40" min="0" step="5">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Other Costs ($/acre)</label>
            <input type="number" id="cy-other" class="cy-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="50" min="0" step="5">
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Net Profit</div>
          <div class="text-5xl font-extrabold font-mono" id="cy-profit">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Yield</div>
            <div class="text-xl font-bold font-mono" id="cy-yield">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Gross Revenue</div>
            <div class="text-xl font-bold font-mono" id="cy-revenue">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Profit Margin</div>
            <div class="text-xl font-bold font-mono" id="cy-margin">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Input Costs</div>
            <div class="text-xl font-bold font-mono" id="cy-costs">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Profit Per Acre</div>
            <div class="text-xl font-bold font-mono" id="cy-peracre">--</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="crop-yield" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcCY() {
      const cropData = (document.getElementById('cy-crop') as HTMLSelectElement).value.split('|');
      const baseYield = parseFloat(cropData[0]);
      const pricePerUnit = parseFloat(cropData[1]);
      const defaultOps = parseFloat(cropData[2]);
      const acres = parseFloat((document.getElementById('cy-acres') as HTMLInputElement).value) || 100;
      const adj = parseFloat((document.getElementById('cy-adj') as HTMLInputElement).value) || 100;
      const seedCost = parseFloat((document.getElementById('cy-seed') as HTMLInputElement).value) || 0;
      const fertCost = parseFloat((document.getElementById('cy-fert') as HTMLInputElement).value) || 0;
      const chemCost = parseFloat((document.getElementById('cy-chem') as HTMLInputElement).value) || 0;
      const otherCost = parseFloat((document.getElementById('cy-other') as HTMLInputElement).value) || 0;
      const actualYield = baseYield * (adj / 100);
      const totalYield = actualYield * acres;
      const revenue = totalYield * pricePerUnit;
      const costPerAcre = seedCost + fertCost + chemCost + otherCost;
      const totalCosts = costPerAcre * acres;
      const profit = revenue - totalCosts;
      const margin = revenue > 0 ? (profit / revenue) * 100 : 0;
      const profitPerAcre = profit / acres;
      document.getElementById('cy-profit')!.textContent = (profit >= 0 ? '$' : '-$') + Math.abs(Math.round(profit)).toLocaleString();
      document.getElementById('cy-yield')!.textContent = Math.round(totalYield).toLocaleString();
      document.getElementById('cy-revenue')!.textContent = '$' + Math.round(revenue).toLocaleString();
      document.getElementById('cy-margin')!.textContent = margin.toFixed(1) + '%';
      document.getElementById('cy-costs')!.textContent = '$' + Math.round(totalCosts).toLocaleString();
      document.getElementById('cy-peracre')!.textContent = (profitPerAcre >= 0 ? '$' : '-$') + Math.abs(Math.round(profitPerAcre)).toLocaleString();
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.cy-in').forEach(el => { el.addEventListener('input', calcCY); el.addEventListener('change', calcCY); });
      calcCY();
    }, 50);
  </script>
</CalculatorLayout>
