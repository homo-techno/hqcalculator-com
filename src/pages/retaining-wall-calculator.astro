---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Retaining Wall Calculator";
const description = "Calculate blocks, gravel, and materials needed for a retaining wall. Includes cost estimation.";
const relatedCalcs = [
  { name: "Brick Calculator", url: "/brick-calculator", description: "Bricks." },
  { name: "Concrete", url: "/concrete-calculator", description: "Concrete." },
  { name: "Gravel", url: "/gravel-calculator", description: "Gravel." },
  { name: "Fence Post", url: "/fence-post-calculator", description: "Fence." },
  { name: "Paver", url: "/paver-calculator", description: "Pavers." },
  { name: "Square Footage", url: "/square-footage-calculator", description: "Sq ft." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Retaining Wall Calculator" keywords="retaining wall calculator, retaining wall blocks, wall materials, landscape wall, block wall" breadcrumbs={[{ name: "Retaining Wall", url: "/retaining-wall-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Retaining Wall Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate blocks and materials for your retaining wall.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Wall Length (ft)</label><input type="number" id="rw-len" class="rw-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="30" min="0" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Wall Height (ft)</label><input type="number" id="rw-ht" class="rw-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="3" min="0" step="0.5"></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Block Size</h3>
          <div class="grid grid-cols-2 gap-2">
            <div><label class="block text-xs text-text-muted">Length (in)</label><input type="number" id="rw-bl" class="rw-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="12" step="1"></div>
            <div><label class="block text-xs text-text-muted">Height (in)</label><input type="number" id="rw-bh" class="rw-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="6" step="1"></div>
          </div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Block Price ($)</label><input type="number" id="rw-price" class="rw-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3.50" min="0" step="0.25"></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Blocks Needed</div>
          <div class="text-5xl font-extrabold font-mono" id="rw-result">0</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Rows</div><div class="text-xl font-bold font-mono" id="rw-rows">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Per Row</div><div class="text-xl font-bold font-mono" id="rw-perrow">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Wall Face</div><div class="text-lg font-bold font-mono" id="rw-face">0</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Gravel (tons)</div><div class="text-xl font-bold font-mono" id="rw-gravel">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Est. Cost</div><div class="text-xl font-bold font-mono" id="rw-cost">$0</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Notes</h3>
          <div class="text-xs space-y-1" id="rw-notes"></div>
        </div>
      </div>
      <ShareButton calculatorId="retaining-wall" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcRW() {
      const len = parseFloat((document.getElementById('rw-len') as HTMLInputElement).value) || 0;
      const ht = parseFloat((document.getElementById('rw-ht') as HTMLInputElement).value) || 0;
      const bl = parseFloat((document.getElementById('rw-bl') as HTMLInputElement).value) || 12;
      const bh = parseFloat((document.getElementById('rw-bh') as HTMLInputElement).value) || 6;
      const price = parseFloat((document.getElementById('rw-price') as HTMLInputElement).value) || 0;
      const rows = Math.ceil((ht * 12) / bh);
      const perRow = Math.ceil((len * 12) / bl);
      const totalBlocks = rows * perRow;
      const faceArea = len * ht;
      const gravelTons = (len * 1 * ht * 110) / 2000;
      const blockCost = totalBlocks * price;
      const gravelCost = gravelTons * 40;
      document.getElementById('rw-result')!.textContent = totalBlocks.toLocaleString();
      document.getElementById('rw-rows')!.textContent = rows.toString();
      document.getElementById('rw-perrow')!.textContent = perRow.toString();
      document.getElementById('rw-face')!.textContent = faceArea.toFixed(0) + ' ftÂ²';
      document.getElementById('rw-gravel')!.textContent = gravelTons.toFixed(2);
      document.getElementById('rw-cost')!.textContent = '$' + (blockCost + gravelCost).toLocaleString(undefined, { maximumFractionDigits: 0 });
      const notes = [
        `<div>Block cost: $${blockCost.toFixed(0)} | Gravel: $${gravelCost.toFixed(0)}</div>`,
        ht > 4 ? '<div class="text-yellow-700 font-bold">Walls over 4 ft may require engineering design</div>' : '',
        '<div>Add 5-10% extra blocks for cuts and waste</div>',
        '<div>First course should be buried 1" below grade per 8" of wall height</div>',
      ].filter(Boolean);
      document.getElementById('rw-notes')!.innerHTML = notes.join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.rw-in').forEach(el => { el.addEventListener('input', calcRW); el.addEventListener('change', calcRW); });
      calcRW();
    }, 50);
  </script>
</CalculatorLayout>
