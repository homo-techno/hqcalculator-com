---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Celestial Coordinate Calculator";
const description = "Convert between RA/Dec and Alt/Az coordinates, calculate hour angle and local sidereal time.";
const relatedCalcs = [
  { name: "Polar Coordinates", url: "/polar-coordinates-calculator", description: "Polar coords." },
  { name: "Degrees Radians", url: "/degrees-radians-converter-calculator", description: "Angle convert." },
  { name: "Orbital Period", url: "/orbital-period-calculator", description: "Orbits." },
  { name: "Time Zone", url: "/time-zone-calculator", description: "Time zones." },
  { name: "Sunrise Sunset", url: "/sunrise-sunset-calculator", description: "Sun times." },
  { name: "Unit Circle", url: "/unit-circle-calculator", description: "Trig circle." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Celestial Coordinate Calculator" keywords="celestial coordinates, right ascension, declination, altitude, azimuth, hour angle, sidereal time" breadcrumbs={[{ name: "Celestial Coordinates", url: "/celestial-coordinate-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Celestial Coordinate Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert RA/Dec equatorial coordinates to Alt/Az horizontal coordinates for your location and time.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">RA Hours</label><input type="number" id="cd2-rah" class="cd2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" step="1" min="0" max="23"></div>
          <div><label class="block text-xs font-medium text-text mb-1">RA Minutes</label><input type="number" id="cd2-ram" class="cd2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="55" step="1" min="0" max="59"></div>
          <div><label class="block text-xs font-medium text-text mb-1">RA Seconds</label><input type="number" id="cd2-ras" class="cd2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10.3" step="0.1" min="0" max="59.99"></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Dec Degrees</label><input type="number" id="cd2-decd" class="cd2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="7" step="1" min="-90" max="90"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Dec Arcmin</label><input type="number" id="cd2-decm" class="cd2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="24" step="1" min="0" max="59"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Dec Arcsec</label><input type="number" id="cd2-decs" class="cd2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="25.4" step="0.1" min="0" max="59.99"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Observer Latitude</label><input type="number" id="cd2-lat" class="cd2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="40.7128" step="0.01" min="-90" max="90"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Observer Longitude</label><input type="number" id="cd2-lon" class="cd2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="-74.006" step="0.01" min="-180" max="180"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Date and Time (UTC)</label><input type="datetime-local" id="cd2-dt" class="cd2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold"></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Altitude / Azimuth</div>
          <div class="text-4xl font-extrabold font-mono" id="cd2-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Hour Angle</div><div class="text-xl font-bold font-mono" id="cd2-ha">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Local Sidereal Time</div><div class="text-xl font-bold font-mono" id="cd2-lst">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">RA (decimal hours)</div><div class="text-xl font-bold font-mono" id="cd2-radec">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Dec (decimal degrees)</div><div class="text-xl font-bold font-mono" id="cd2-decdec">--</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Visibility</div><div class="text-xl font-bold font-mono" id="cd2-vis">--</div></div>
      </div>
      <ShareButton calculatorId="celestial-coordinate" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcCD2() {
      const rah = parseFloat((document.getElementById('cd2-rah') as HTMLInputElement).value) || 0;
      const ram = parseFloat((document.getElementById('cd2-ram') as HTMLInputElement).value) || 0;
      const ras = parseFloat((document.getElementById('cd2-ras') as HTMLInputElement).value) || 0;
      const decd = parseFloat((document.getElementById('cd2-decd') as HTMLInputElement).value) || 0;
      const decm = parseFloat((document.getElementById('cd2-decm') as HTMLInputElement).value) || 0;
      const decs = parseFloat((document.getElementById('cd2-decs') as HTMLInputElement).value) || 0;
      const lat = parseFloat((document.getElementById('cd2-lat') as HTMLInputElement).value) || 0;
      const lon = parseFloat((document.getElementById('cd2-lon') as HTMLInputElement).value) || 0;
      const dtStr = (document.getElementById('cd2-dt') as HTMLInputElement).value;
      if (!dtStr) return;
      const dt = new Date(dtStr + 'Z');
      const raHours = rah + ram / 60 + ras / 3600;
      const raDeg = raHours * 15;
      const sign = decd >= 0 ? 1 : -1;
      const decDeg = sign * (Math.abs(decd) + decm / 60 + decs / 3600);
      const JD = dt.getTime() / 86400000 + 2440587.5;
      const T = (JD - 2451545.0) / 36525;
      const GMST = 280.46061837 + 360.98564736629 * (JD - 2451545.0) + 0.000387933 * T * T;
      const gmstDeg = ((GMST % 360) + 360) % 360;
      const lstDeg = ((gmstDeg + lon) % 360 + 360) % 360;
      const lstHours = lstDeg / 15;
      let haHours = lstHours - raHours;
      if (haHours < -12) haHours += 24;
      if (haHours > 12) haHours -= 24;
      const haDeg = haHours * 15;
      const latRad = lat * Math.PI / 180;
      const decRad = decDeg * Math.PI / 180;
      const haRad = haDeg * Math.PI / 180;
      const sinAlt = Math.sin(latRad) * Math.sin(decRad) + Math.cos(latRad) * Math.cos(decRad) * Math.cos(haRad);
      const alt = Math.asin(sinAlt) * 180 / Math.PI;
      const cosAz = (Math.sin(decRad) - Math.sin(latRad) * sinAlt) / (Math.cos(latRad) * Math.cos(alt * Math.PI / 180));
      let az = Math.acos(Math.max(-1, Math.min(1, cosAz))) * 180 / Math.PI;
      if (Math.sin(haRad) > 0) az = 360 - az;

      document.getElementById('cd2-result')!.textContent = 'Alt: ' + alt.toFixed(2) + '\u00b0 / Az: ' + az.toFixed(2) + '\u00b0';
      const haH = Math.floor(Math.abs(haHours));
      const haM = Math.floor((Math.abs(haHours) - haH) * 60);
      const haSign = haHours >= 0 ? '' : '-';
      document.getElementById('cd2-ha')!.textContent = haSign + haH + 'h ' + haM + 'm';
      const lstH = Math.floor(lstHours);
      const lstM = Math.floor((lstHours - lstH) * 60);
      const lstS = Math.floor(((lstHours - lstH) * 60 - lstM) * 60);
      document.getElementById('cd2-lst')!.textContent = lstH + 'h ' + lstM + 'm ' + lstS + 's';
      document.getElementById('cd2-radec')!.textContent = raHours.toFixed(4) + ' h';
      document.getElementById('cd2-decdec')!.textContent = decDeg.toFixed(4) + '\u00b0';
      if (alt > 0) {
        document.getElementById('cd2-vis')!.textContent = 'Above horizon (' + alt.toFixed(1) + '\u00b0 elevation)';
      } else {
        document.getElementById('cd2-vis')!.textContent = 'Below horizon (' + alt.toFixed(1) + '\u00b0)';
      }
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      const now = new Date();
      const iso = now.toISOString().slice(0, 16);
      (document.getElementById('cd2-dt') as HTMLInputElement).value = iso;
      document.querySelectorAll('.cd2-in').forEach(el => { el.addEventListener('input', calcCD2); el.addEventListener('change', calcCD2); });
      calcCD2();
    }, 50);
  </script>
</CalculatorLayout>
