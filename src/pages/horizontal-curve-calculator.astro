---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Horizontal Curve Calculator - Radius, Tangent, Length";
const description = "Calculate horizontal curve geometry including radius, tangent length, curve length, mid-ordinate, external distance, and chord length from deflection angle.";
const relatedCalcs = [
  { name: "Vertical Curve", url: "/vertical-curve-calculator", description: "Vertical curve design." },
  { name: "Traverse Calculator", url: "/traverse-calculator", description: "Closed traverse computation." },
  { name: "Stakeout Calculator", url: "/stakeout-calculator", description: "Stakeout coordinates." },
  { name: "Distance & Bearing", url: "/distance-bearing-calculator", description: "GPS distance & bearing." },
  { name: "Slope Grade", url: "/slope-grade-calculator", description: "Slope conversions." },
  { name: "Total Station", url: "/total-station-calculator", description: "Total station calcs." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Horizontal Curve Calculator" keywords="horizontal curve, radius, tangent length, curve length, mid ordinate, external distance, deflection angle, road design" breadcrumbs={[{ name: "Horizontal Curve Calculator", url: "/horizontal-curve-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Horizontal Curve Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Enter the deflection angle (delta) and radius to compute all horizontal curve elements.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Input Method</label>
          <select id="hc3-mode" class="hc3-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="ra">Radius & Deflection Angle</option>
            <option value="da">Degree of Curve & Deflection Angle</option>
          </select>
        </div>
        <div id="hc3-radius-input">
          <label class="block text-sm font-semibold text-text mb-1">Radius (ft)</label>
          <input type="number" id="hc3-R" class="hc3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="500" min="1" step="0.1">
        </div>
        <div id="hc3-degree-input" style="display:none">
          <label class="block text-sm font-semibold text-text mb-1">Degree of Curve (D)</label>
          <input type="number" id="hc3-D" class="hc3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" step="0.01">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Deflection Angle, Delta (degrees)</label>
          <input type="number" id="hc3-delta" class="hc3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="30" step="0.01" min="0.01" max="180">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">PI Station (optional, ft)</label>
          <input type="number" id="hc3-pi" class="hc3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5000">
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Curve Length</div>
          <div class="text-5xl font-extrabold font-mono" id="hc3-L">--</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Radius</div>
            <div class="text-xl font-bold" id="hc3-out-R">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Tangent Length (T)</div>
            <div class="text-xl font-bold" id="hc3-T">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Mid-Ordinate (M)</div>
            <div class="text-xl font-bold" id="hc3-M">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">External Distance (E)</div>
            <div class="text-xl font-bold" id="hc3-E">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Long Chord (LC)</div>
            <div class="text-xl font-bold" id="hc3-LC">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Degree of Curve</div>
            <div class="text-xl font-bold" id="hc3-out-D">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">PC Station</div>
            <div class="text-xl font-bold" id="hc3-PC">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">PT Station</div>
            <div class="text-xl font-bold" id="hc3-PT">--</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="horizontal-curve" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Horizontal Curve Formulas</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p>T = R * tan(Delta/2)</p>
        <p>L = R * Delta (in radians)</p>
        <p>M = R * (1 - cos(Delta/2))</p>
        <p>E = R * (1/cos(Delta/2) - 1)</p>
        <p>LC = 2 * R * sin(Delta/2)</p>
        <p>D = 5729.578 / R (arc definition)</p>
      </div>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcHC3() {
      const mode = (document.getElementById('hc3-mode') as HTMLSelectElement).value;
      document.getElementById('hc3-radius-input')!.style.display = mode === 'ra' ? '' : 'none';
      document.getElementById('hc3-degree-input')!.style.display = mode === 'da' ? '' : 'none';
      const delta = parseFloat((document.getElementById('hc3-delta') as HTMLInputElement).value) || 0;
      const piSta = parseFloat((document.getElementById('hc3-pi') as HTMLInputElement).value) || 0;
      const deltaRad = delta * Math.PI / 180;
      let R: number;
      if (mode === 'ra') {
        R = parseFloat((document.getElementById('hc3-R') as HTMLInputElement).value) || 500;
      } else {
        const D = parseFloat((document.getElementById('hc3-D') as HTMLInputElement).value) || 6;
        R = 5729.578 / D;
      }
      const T = R * Math.tan(deltaRad / 2);
      const L = R * deltaRad;
      const M = R * (1 - Math.cos(deltaRad / 2));
      const E = R * (1 / Math.cos(deltaRad / 2) - 1);
      const LC = 2 * R * Math.sin(deltaRad / 2);
      const D = 5729.578 / R;
      const pcSta = piSta - T;
      const ptSta = pcSta + L;
      document.getElementById('hc3-L')!.textContent = L.toFixed(2) + ' ft';
      document.getElementById('hc3-out-R')!.textContent = R.toFixed(2) + ' ft';
      document.getElementById('hc3-T')!.textContent = T.toFixed(2) + ' ft';
      document.getElementById('hc3-M')!.textContent = M.toFixed(2) + ' ft';
      document.getElementById('hc3-E')!.textContent = E.toFixed(2) + ' ft';
      document.getElementById('hc3-LC')!.textContent = LC.toFixed(2) + ' ft';
      document.getElementById('hc3-out-D')!.textContent = D.toFixed(4) + '\u00B0';
      document.getElementById('hc3-PC')!.textContent = pcSta.toFixed(2);
      document.getElementById('hc3-PT')!.textContent = ptSta.toFixed(2);
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.hc3-in').forEach(el => { el.addEventListener('input', calcHC3); el.addEventListener('change', calcHC3); });
      calcHC3();
    }, 50);
  </script>
</CalculatorLayout>
