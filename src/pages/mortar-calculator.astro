---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Mortar Calculator - Bags, Sand & Mix Ratio Estimator";
const description = "Calculate mortar needed for brick or block walls. Enter wall area, joint thickness, and brick size to get bags of mortar, cubic feet, and sand required.";

const relatedCalcs = [
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume estimator." },
  { name: "Rebar Calculator", url: "/rebar-calculator", description: "Rebar requirements." },
  { name: "Siding Calculator", url: "/siding-calculator", description: "Siding material needs." },
  { name: "Foundation Calculator", url: "/foundation-calculator", description: "Foundation concrete." },
  { name: "Asphalt Calculator", url: "/asphalt-calculator", description: "Asphalt tonnage." },
  { name: "Post Hole Calculator", url: "/post-hole-calculator", description: "Post hole concrete." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Mortar Calculator"
  keywords="mortar calculator, mortar bags, mortar mix, brick mortar, block mortar, sand for mortar, joint thickness"
  breadcrumbs={[{ name: "Mortar Calculator", url: "/mortar-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Mortar Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate mortar, sand, and cement needed for brick or block wall construction.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="grid grid-cols-2 gap-3 mb-5">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Wall Length (ft)</label>
              <input type="number" id="mt-length" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="20" min="0" step="0.5">
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Wall Height (ft)</label>
              <input type="number" id="mt-height" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="8" min="0" step="0.5">
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Joint Thickness (inches)</label>
            <select id="mt-joint" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
              <option value="0.25">1/4 inch</option>
              <option value="0.375" selected>3/8 inch (standard)</option>
              <option value="0.5">1/2 inch</option>
              <option value="0.625">5/8 inch</option>
              <option value="0.75">3/4 inch</option>
            </select>
          </div>

          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Brick / Block Size</label>
            <select id="mt-brick" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
              <option value="standard" selected>Standard Brick (8 x 2.25 x 3.75 in)</option>
              <option value="modular">Modular Brick (7.625 x 2.25 x 3.625 in)</option>
              <option value="queen">Queen Brick (7.625 x 2.75 x 3.625 in)</option>
              <option value="cmu8">CMU Block 8" (15.625 x 7.625 x 7.625 in)</option>
              <option value="cmu12">CMU Block 12" (15.625 x 7.625 x 11.625 in)</option>
            </select>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Waste Factor (%)</label>
              <input type="number" id="mt-waste" class="w-full px-3 py-2 border border-border rounded-lg" value="10" min="0" max="50" step="1">
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Bags of Mortar (80 lb)</div>
            <div class="text-5xl font-extrabold font-mono" id="mt-bags">0</div>
            <div class="text-sm text-blue-200 mt-1">Type S pre-mixed mortar</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Mortar Volume</div>
              <div class="text-xl font-bold" id="mt-cuft">0 cu ft</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Sand Needed</div>
              <div class="text-xl font-bold" id="mt-sand">0 cu ft</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Bricks / Blocks</div>
              <div class="text-xl font-bold" id="mt-bricks">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Wall Area</div>
              <div class="text-xl font-bold" id="mt-area">0 sq ft</div>
            </div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Mix Ratio (Cement : Lime : Sand)</div>
            <div class="text-xl font-bold" id="mt-ratio">1 : 0.5 : 4.5</div>
            <div class="text-xs text-text-muted">Type S mortar</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="mortar" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Mortar</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Mortar volume:</strong> (Bed joints + Head joints) per unit x Number of units</p>
        <p><strong>Bags needed:</strong> Total cubic feet / 0.50 cu ft per 80 lb bag</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Mortar Types</h3>
      <ul>
        <li><strong>Type M:</strong> Highest strength (2500 psi) - foundations, retaining walls</li>
        <li><strong>Type S:</strong> High strength (1800 psi) - below-grade, standard structural</li>
        <li><strong>Type N:</strong> Medium strength (750 psi) - above-grade, general purpose</li>
        <li><strong>Type O:</strong> Low strength (350 psi) - interior, non-load-bearing</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const mtBrickSizes: Record<string, { w: number; h: number; d: number }> = {
      standard: { w: 8, h: 2.25, d: 3.75 },
      modular: { w: 7.625, h: 2.25, d: 3.625 },
      queen: { w: 7.625, h: 2.75, d: 3.625 },
      cmu8: { w: 15.625, h: 7.625, d: 7.625 },
      cmu12: { w: 15.625, h: 7.625, d: 11.625 },
    };

    function calcMortar() {
      const wallL = parseFloat((document.getElementById('mt-length') as HTMLInputElement).value) || 0;
      const wallH = parseFloat((document.getElementById('mt-height') as HTMLInputElement).value) || 0;
      const joint = parseFloat((document.getElementById('mt-joint') as HTMLSelectElement).value) || 0.375;
      const brickType = (document.getElementById('mt-brick') as HTMLSelectElement).value;
      const waste = (parseFloat((document.getElementById('mt-waste') as HTMLInputElement).value) || 0) / 100;

      const brick = mtBrickSizes[brickType] || mtBrickSizes.standard;
      const area = wallL * wallH;

      const courseW = (brick.w + joint) / 12;
      const courseH = (brick.h + joint) / 12;

      const bricksPerSqFt = 1 / (courseW * courseH);
      const totalBricks = Math.ceil(bricksPerSqFt * area * (1 + waste));

      const bedJointVol = (brick.w / 12) * (brick.d / 12) * (joint / 12);
      const headJointVol = (brick.h / 12) * (brick.d / 12) * (joint / 12);
      const mortarPerBrick = bedJointVol + headJointVol;

      const totalMortarCuFt = mortarPerBrick * totalBricks;
      const mortarWithWaste = totalMortarCuFt * (1 + waste);

      const bagsNeeded = Math.ceil(mortarWithWaste / 0.50);

      const sandCuFt = mortarWithWaste * 0.75;

      document.getElementById('mt-bags')!.textContent = String(bagsNeeded);
      document.getElementById('mt-cuft')!.textContent = mortarWithWaste.toFixed(1) + ' cu ft';
      document.getElementById('mt-sand')!.textContent = sandCuFt.toFixed(1) + ' cu ft';
      document.getElementById('mt-bricks')!.textContent = totalBricks.toLocaleString();
      document.getElementById('mt-area')!.textContent = area.toFixed(0) + ' sq ft';
      document.getElementById('mt-ratio')!.textContent = '1 : 0.5 : 4.5';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('#mt-length, #mt-height, #mt-waste').forEach(el => {
        el.addEventListener('input', calcMortar);
        el.addEventListener('change', calcMortar);
      });
      document.querySelectorAll('#mt-joint, #mt-brick').forEach(el => {
        el.addEventListener('input', calcMortar);
        el.addEventListener('change', calcMortar);
      });
      calcMortar();
    }, 50);
  </script>
</CalculatorLayout>
