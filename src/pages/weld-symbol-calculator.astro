---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Weld Symbol Calculator - Joint Dimensions from AWS Symbols";
const description = "Calculate weld joint dimensions from AWS weld symbols including leg size, effective throat, root opening, and groove angle for various joint types.";

const relatedCalcs = [
  { name: "Welding Rod Calculator", url: "/welding-rod-calculator", description: "Electrode consumption." },
  { name: "Welding Heat Input", url: "/welding-heat-input-calculator", description: "Heat input calculation." },
  { name: "Welding Cost Calculator", url: "/welding-cost-calculator", description: "Welding job costs." },
  { name: "Metal Weight Calculator", url: "/metal-weight-calculator", description: "Metal weight." },
  { name: "Welding Gas Calculator", url: "/welding-gas-calculator", description: "Shielding gas." },
  { name: "Metal Fatigue Calculator", url: "/metal-fatigue-calculator", description: "Fatigue life." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Weld Symbol Calculator"
  keywords="weld symbol, AWS welding symbol, fillet weld, groove weld, leg size, throat size, weld dimensions, weld joint, root opening"
  breadcrumbs={[{ name: "Weld Symbol Calculator", url: "/weld-symbol-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Weld Symbol Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate weld joint dimensions from AWS weld symbol parameters.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Weld Type -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Weld Type</label>
        <select id="ws2-type" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="fillet">Fillet Weld</option>
          <option value="vgroove">V-Groove (Single)</option>
          <option value="dvgroove">Double V-Groove</option>
          <option value="bevel">Single Bevel</option>
          <option value="jgroove">J-Groove</option>
          <option value="ugroove">U-Groove</option>
          <option value="flare_v">Flare V-Groove</option>
          <option value="plug">Plug / Slot Weld</option>
        </select>
      </div>

      <!-- Unit -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Unit</label>
        <select id="ws2-unit" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="in">inches</option>
          <option value="mm">mm</option>
        </select>
      </div>

      <!-- Fillet Parameters -->
      <div id="ws2-fillet-params">
        <div class="grid grid-cols-2 gap-4 mb-5">
          <div>
            <label class="block text-sm font-medium text-text mb-2">Leg Size (S)</label>
            <input type="number" id="ws2-leg" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.25" min="0.01" step="0.01">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-2">Weld Length</label>
            <input type="number" id="ws2-length" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="0.1" step="0.1">
          </div>
        </div>
      </div>

      <!-- Groove Parameters -->
      <div id="ws2-groove-params" class="hidden">
        <div class="grid grid-cols-2 gap-4 mb-5">
          <div>
            <label class="block text-sm font-medium text-text mb-2">Plate Thickness (T)</label>
            <input type="number" id="ws2-thick" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.5" min="0.01" step="0.01">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-2">Groove Angle (degrees)</label>
            <input type="number" id="ws2-gangle" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="60" min="10" max="90" step="5">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4 mb-5">
          <div>
            <label class="block text-sm font-medium text-text mb-2">Root Opening</label>
            <input type="number" id="ws2-root" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.0625" min="0" step="0.01">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-2">Root Face (Land)</label>
            <input type="number" id="ws2-face" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.0625" min="0" step="0.01">
          </div>
        </div>
        <div class="mb-5">
          <label class="block text-sm font-medium text-text mb-2">Weld Length</label>
          <input type="number" id="ws2-glength" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="0.1" step="0.1">
        </div>
      </div>

      <!-- Plug Parameters -->
      <div id="ws2-plug-params" class="hidden">
        <div class="grid grid-cols-2 gap-4 mb-5">
          <div>
            <label class="block text-sm font-medium text-text mb-2">Hole Diameter</label>
            <input type="number" id="ws2-holedia" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.75" min="0.1" step="0.05">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-2">Depth of Fill</label>
            <input type="number" id="ws2-fill" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.25" min="0.01" step="0.01">
          </div>
        </div>
        <div class="mb-5">
          <label class="block text-sm font-medium text-text mb-2">Number of Plug Welds</label>
          <input type="number" id="ws2-plugcount" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" min="1" step="1">
        </div>
      </div>

      <!-- Results -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Effective Throat (a)</div>
        <div class="text-4xl font-extrabold" id="ws2-throat">--</div>
        <div class="text-sm text-blue-200 mt-1" id="ws2-throatnote">minimum effective weld thickness</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Cross-Section Area</div>
          <div class="text-xl font-bold" id="ws2-area">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Weld Volume</div>
          <div class="text-xl font-bold" id="ws2-vol">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Shear Area</div>
          <div class="text-xl font-bold" id="ws2-sheararea">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Filler Weight (steel)</div>
          <div class="text-xl font-bold" id="ws2-weight">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <div class="text-xs text-text-muted uppercase mb-2">Notes</div>
        <div class="text-sm" id="ws2-notes">--</div>
      </div>

      <ShareButton calculatorId="weld-symbol" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Weld Dimension Reference</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Fillet throat:</strong> a = S x cos(45) = 0.707 x S (for equal-leg fillet)</p>
        <p><strong>V-Groove area:</strong> A = root x T + tan(angle/2) x (T - face)^2</p>
        <p><strong>Shear area:</strong> = throat x length (fillet) or T x length (CJP groove)</p>
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcWS2() {
      const type = (document.getElementById('ws2-type') as HTMLSelectElement).value;
      const unit = (document.getElementById('ws2-unit') as HTMLSelectElement).value;
      const unitLabel = unit === 'in' ? '"' : ' mm';

      // Show/hide parameter groups
      const isFillet = type === 'fillet';
      const isPlug = type === 'plug';
      const isGroove = !isFillet && !isPlug;
      document.getElementById('ws2-fillet-params')!.classList.toggle('hidden', !isFillet);
      document.getElementById('ws2-groove-params')!.classList.toggle('hidden', !isGroove);
      document.getElementById('ws2-plug-params')!.classList.toggle('hidden', !isPlug);

      let throat = 0, area = 0, volume = 0, shearArea = 0, weight = 0, notes = '';
      const density = unit === 'in' ? 0.284 : 0.00785; // lb/in³ or g/mm³ (steel)

      if (isFillet) {
        const leg = parseFloat((document.getElementById('ws2-leg') as HTMLInputElement).value) || 0;
        const length = parseFloat((document.getElementById('ws2-length') as HTMLInputElement).value) || 0;

        throat = leg * 0.707;
        area = 0.5 * leg * leg; // triangle cross-section
        volume = area * length;
        shearArea = throat * length;
        weight = volume * density;
        notes = 'Fillet weld: effective throat = 0.707 x leg size. Minimum leg size per AWS D1.1 depends on thicker plate.';

      } else if (isPlug) {
        const holeDia = parseFloat((document.getElementById('ws2-holedia') as HTMLInputElement).value) || 0;
        const fill = parseFloat((document.getElementById('ws2-fill') as HTMLInputElement).value) || 0;
        const count = parseFloat((document.getElementById('ws2-plugcount') as HTMLInputElement).value) || 1;

        throat = fill;
        area = Math.PI * (holeDia / 2) ** 2;
        volume = area * fill * count;
        shearArea = area * count;
        weight = volume * density;
        notes = 'Plug weld shear area is the faying surface area (cross-section of hole x number of welds).';

      } else {
        const thick = parseFloat((document.getElementById('ws2-thick') as HTMLInputElement).value) || 0;
        const gangle = parseFloat((document.getElementById('ws2-gangle') as HTMLInputElement).value) || 60;
        const root = parseFloat((document.getElementById('ws2-root') as HTMLInputElement).value) || 0;
        const face = parseFloat((document.getElementById('ws2-face') as HTMLInputElement).value) || 0;
        const length = parseFloat((document.getElementById('ws2-glength') as HTMLInputElement).value) || 0;

        const halfAngleRad = (gangle / 2) * Math.PI / 180;
        const grooveDepth = thick - face;

        if (type === 'vgroove') {
          // V-groove area: root_gap * depth + tan(half_angle) * depth^2
          area = root * grooveDepth + Math.tan(halfAngleRad) * grooveDepth * grooveDepth;
          throat = thick; // CJP
          notes = 'Single V-groove: Complete joint penetration (CJP). Effective throat equals plate thickness.';
        } else if (type === 'dvgroove') {
          const halfDepth = grooveDepth / 2;
          area = 2 * (root * halfDepth + Math.tan(halfAngleRad) * halfDepth * halfDepth);
          throat = thick;
          notes = 'Double V-groove: Uses less filler metal than single V for thick plates. CJP weld.';
        } else if (type === 'bevel') {
          area = root * grooveDepth + 0.5 * Math.tan(halfAngleRad) * grooveDepth * grooveDepth;
          throat = thick;
          notes = 'Single bevel: One plate beveled, one square. Easier prep but more distortion than V-groove.';
        } else if (type === 'jgroove') {
          const r = face > 0 ? face : thick * 0.1;
          area = root * grooveDepth + 0.5 * Math.tan(halfAngleRad) * grooveDepth * grooveDepth * 0.7;
          throat = thick;
          notes = 'J-groove: Reduced filler metal vs bevel. Requires machined or ground preparation.';
        } else if (type === 'ugroove') {
          area = root * grooveDepth + Math.tan(halfAngleRad) * grooveDepth * grooveDepth * 0.6;
          throat = thick;
          notes = 'U-groove: Least filler metal for CJP on thick plates. Requires precision machining.';
        } else if (type === 'flare_v') {
          area = 0.5 * Math.PI * (thick / 2) * (thick / 2) * 0.3;
          throat = thick * 0.3;
          notes = 'Flare V-groove: Used for round bar or tube joints. Effective throat is typically 5/16 x radius.';
        }

        volume = area * length;
        shearArea = throat * length;
        weight = volume * density;
      }

      const areaUnit = unit === 'in' ? ' in\u00B2' : ' mm\u00B2';
      const volUnit = unit === 'in' ? ' in\u00B3' : ' mm\u00B3';
      const wtUnit = unit === 'in' ? ' lbs' : ' g';

      document.getElementById('ws2-throat')!.textContent = throat.toFixed(4) + unitLabel;
      document.getElementById('ws2-area')!.textContent = area.toFixed(4) + areaUnit;
      document.getElementById('ws2-vol')!.textContent = volume.toFixed(3) + volUnit;
      document.getElementById('ws2-sheararea')!.textContent = shearArea.toFixed(3) + areaUnit;
      document.getElementById('ws2-weight')!.textContent = weight.toFixed(3) + wtUnit;
      document.getElementById('ws2-notes')!.textContent = notes;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.ws2-in').forEach(el => {
        el.addEventListener('input', calcWS2);
        el.addEventListener('change', calcWS2);
      });
      calcWS2();
    }, 50);
  </script>
</CalculatorLayout>
