---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Wood Moisture Calculator - MC & Equilibrium Estimator";
const description = "Calculate wood moisture content from wet and dry weights. Estimate equilibrium moisture content (EMC) based on temperature and relative humidity.";

const relatedCalcs = [
  { name: "Wood Expansion Calculator", url: "/wood-expansion-calculator", description: "Wood expansion from MC change." },
  { name: "Wood Drying Calculator", url: "/wood-drying-calculator", description: "Drying time estimation." },
  { name: "Wood Weight Calculator", url: "/wood-weight-calculator", description: "Estimate wood weight." },
  { name: "Board Foot Calculator", url: "/board-foot-calculator", description: "Board feet calculator." },
  { name: "Wood Finish Calculator", url: "/wood-finish-calculator", description: "Finish coverage estimator." },
  { name: "Timber Span Calculator", url: "/timber-span-calculator", description: "Beam span calculator." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Wood Moisture Calculator"
  keywords="wood moisture content, EMC calculator, equilibrium moisture content, moisture meter, wood drying, MC calculation"
  breadcrumbs={[{ name: "Wood Moisture Calculator", url: "/wood-moisture-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Wood Moisture Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate moisture content from oven-dry weights or estimate equilibrium MC from ambient conditions.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <h3 class="text-lg font-bold text-text mb-4">Moisture Content (Oven-Dry Method)</h3>
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Wet Weight (grams)</label>
          <input type="number" id="wmc-wet" class="wmc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="500" min="0" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Oven-Dry Weight (grams)</label>
          <input type="number" id="wmc-dry" class="wmc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="420" min="0" step="1">
        </div>
      </div>

      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-6">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Moisture Content</div>
        <div class="text-4xl font-extrabold" id="wmc-mc">--</div>
        <div class="text-sm text-blue-200 mt-1" id="wmc-status">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Water Weight</div>
          <div class="text-xl font-bold" id="wmc-water">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Fiber Saturation</div>
          <div class="text-xl font-bold">~30%</div>
        </div>
      </div>

      <hr class="my-6 border-border">

      <h3 class="text-lg font-bold text-text mb-4">Equilibrium Moisture Content (EMC)</h3>
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Temperature (&deg;F)</label>
          <input type="number" id="wmc-temp" class="wmc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="70" min="30" max="200" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Relative Humidity (%)</label>
          <input type="number" id="wmc-rh" class="wmc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="40" min="5" max="99" step="1">
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Estimated EMC</div>
          <div class="text-xl font-bold" id="wmc-emc">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Recommendation</div>
          <div class="text-sm font-bold" id="wmc-rec">--</div>
        </div>
      </div>

      <ShareButton calculatorId="wood-moisture" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Wood Moisture Content</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>MC% = (Wet Weight - Oven-Dry Weight) / Oven-Dry Weight x 100</strong></p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">Target Moisture Content</h3>
      <ul>
        <li><strong>Indoor furniture:</strong> 6-8% MC</li>
        <li><strong>Indoor woodwork:</strong> 8-10% MC</li>
        <li><strong>Outdoor furniture:</strong> 12-14% MC</li>
        <li><strong>Construction lumber:</strong> 15-19% MC</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcWMC() {
      const wet = parseFloat((document.getElementById('wmc-wet') as HTMLInputElement).value) || 0;
      const dry = parseFloat((document.getElementById('wmc-dry') as HTMLInputElement).value) || 0;
      const temp = parseFloat((document.getElementById('wmc-temp') as HTMLInputElement).value) || 70;
      const rh = parseFloat((document.getElementById('wmc-rh') as HTMLInputElement).value) || 40;

      // Moisture content
      let mc = 0;
      if (dry > 0) {
        mc = ((wet - dry) / dry) * 100;
      }
      const waterWeight = wet - dry;

      document.getElementById('wmc-mc')!.textContent = mc.toFixed(1) + '%';
      document.getElementById('wmc-water')!.textContent = waterWeight.toFixed(0) + ' g';

      let status = '';
      if (mc < 6) status = 'Very dry - may be too dry for indoor use';
      else if (mc <= 8) status = 'Ideal for indoor furniture';
      else if (mc <= 12) status = 'Good for general indoor woodwork';
      else if (mc <= 19) status = 'Acceptable for construction lumber';
      else if (mc <= 30) status = 'Green wood - needs drying';
      else status = 'Very wet - significant drying needed';
      document.getElementById('wmc-status')!.textContent = status;

      // EMC calculation using Hailwood-Horrobin equation (simplified)
      const h = rh / 100;
      const T = (temp - 32) * 5 / 9; // Convert to Celsius
      const W = 349 + 1.29 * T + 0.0135 * T * T;
      const K = 0.805 + 0.000736 * T - 0.00000273 * T * T;
      const K1 = 6.27 - 0.00938 * T - 0.000303 * T * T;
      const K2 = 1.91 + 0.0407 * T - 0.000293 * T * T;
      const Kh = K * h;
      const emc = (1800 / W) * ((K1 * Kh) / (1 - K1 * K2 * Kh * Kh) + Kh / (1 - Kh));

      document.getElementById('wmc-emc')!.textContent = Math.max(0, emc).toFixed(1) + '%';

      let rec = '';
      if (emc < 6) rec = 'Use humidifier in shop';
      else if (emc <= 9) rec = 'Good for fine woodworking';
      else if (emc <= 13) rec = 'Normal indoor conditions';
      else rec = 'Consider dehumidifying';
      document.getElementById('wmc-rec')!.textContent = rec;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.wmc-in').forEach(el => {
        el.addEventListener('input', calcWMC);
        el.addEventListener('change', calcWMC);
      });
      calcWMC();
    }, 50);
  </script>
</CalculatorLayout>
