---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Ratio Calculator - Simplify, Solve & Scale Ratios";
const description = "Simplify ratios, solve proportions, and scale recipes. Find equivalent ratios and missing values in proportions.";

const relatedCalcs = [
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Fraction Calculator", url: "/fraction-calculator", description: "Fractions." },
  { name: "Proportion Calculator", url: "/probability-calculator", description: "Probability." },
  { name: "Average Calculator", url: "/average-calculator", description: "Mean & median." },
  { name: "Discount Calculator", url: "/discount-calculator", description: "Discounts." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Ratio Calculator"
  keywords="ratio calculator, simplify ratio, solve proportion, equivalent ratio, ratio to fraction, scale ratio"
  breadcrumbs={[{ name: "Ratio Calculator", url: "/ratio-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Ratio Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Simplify ratios, solve proportions, and find equivalent ratios.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Mode tabs -->
      <div class="flex gap-2 mb-6 flex-wrap">
        <button class="rt-mode-btn px-4 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary" data-mode="simplify">Simplify</button>
        <button class="rt-mode-btn px-4 py-2 rounded-xl text-sm font-semibold border border-border" data-mode="proportion">Solve Proportion</button>
        <button class="rt-mode-btn px-4 py-2 rounded-xl text-sm font-semibold border border-border" data-mode="scale">Scale Ratio</button>
      </div>

      <!-- Simplify -->
      <div id="rt-simplify">
        <h3 class="font-semibold text-text mb-3">Simplify a Ratio</h3>
        <div class="flex items-center gap-3 mb-4">
          <input type="number" id="rt-a" class="flex-1 px-4 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="12">
          <span class="text-2xl font-bold text-text-muted">:</span>
          <input type="number" id="rt-b" class="flex-1 px-4 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="8">
        </div>
      </div>

      <!-- Proportion -->
      <div id="rt-proportion" class="hidden">
        <h3 class="font-semibold text-text mb-3">Solve A:B = C:D</h3>
        <p class="text-xs text-text-muted mb-3">Leave one field empty to solve for it.</p>
        <div class="flex items-center gap-2 mb-4">
          <input type="number" id="rt-pa" class="flex-1 px-3 py-3 border border-border rounded-xl text-lg font-bold text-center" value="3" placeholder="A">
          <span class="text-lg font-bold text-text-muted">:</span>
          <input type="number" id="rt-pb" class="flex-1 px-3 py-3 border border-border rounded-xl text-lg font-bold text-center" value="4" placeholder="B">
          <span class="text-lg font-bold text-text-muted">=</span>
          <input type="number" id="rt-pc" class="flex-1 px-3 py-3 border border-border rounded-xl text-lg font-bold text-center" value="9" placeholder="C">
          <span class="text-lg font-bold text-text-muted">:</span>
          <input type="number" id="rt-pd" class="flex-1 px-3 py-3 border border-border rounded-xl text-lg font-bold text-center" value="" placeholder="D = ?">
        </div>
      </div>

      <!-- Scale -->
      <div id="rt-scale" class="hidden">
        <h3 class="font-semibold text-text mb-3">Scale a Ratio</h3>
        <div class="flex items-center gap-3 mb-3">
          <input type="number" id="rt-sa" class="flex-1 px-4 py-3 border border-border rounded-xl text-lg font-bold text-center" value="2">
          <span class="text-xl font-bold text-text-muted">:</span>
          <input type="number" id="rt-sb" class="flex-1 px-4 py-3 border border-border rounded-xl text-lg font-bold text-center" value="3">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Scale factor (or target total)</label>
          <div class="flex gap-2">
            <input type="number" id="rt-factor" class="flex-1 px-4 py-3 border border-border rounded-xl text-lg" value="5">
            <select id="rt-scale-type" class="px-3 py-3 border border-border rounded-xl text-sm">
              <option value="multiply">Multiply by</option>
              <option value="total">Target total</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Result -->
      <div class="p-4 bg-primary rounded-2xl text-white text-center my-6">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="rt-result-label">Simplified Ratio</div>
        <div class="text-3xl sm:text-4xl font-extrabold font-mono" id="rt-result">3 : 2</div>
      </div>

      <div class="grid grid-cols-2 gap-3 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase" id="rt-info1-label">As Fraction</div>
          <div class="text-xl font-bold" id="rt-info1">3/2</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase" id="rt-info2-label">As Decimal</div>
          <div class="text-xl font-bold" id="rt-info2">1.5</div>
        </div>
      </div>

      <!-- Equivalent ratios -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-2">Equivalent Ratios</h3>
        <div class="flex flex-wrap gap-2 text-sm font-mono" id="rt-equiv"></div>
      </div>

      <ShareButton calculatorId="ratio" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">How Ratios Work</h2>
      <p>A ratio compares two quantities. The ratio 3:2 means "for every 3 of one thing, there are 2 of another." Ratios can be simplified like fractions by dividing both numbers by their greatest common divisor (GCD).</p>

      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-center">
        12 : 8 → GCD(12,8) = 4 → 12÷4 : 8÷4 = 3 : 2
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How do I solve a proportion?</strong> In A:B = C:D, if you know three values, find the fourth by cross-multiplying: A×D = B×C.</p>
      <p><strong>How do I scale a recipe?</strong> If a recipe serves 4 and you need 6 servings, multiply all ingredients by 6/4 = 1.5.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let rtMode = 'simplify';

    function gcd(a: number, b: number): number {
      a = Math.abs(Math.round(a));
      b = Math.abs(Math.round(b));
      while (b) { [a, b] = [b, a % b]; }
      return a;
    }

    function calcRatio() {
      if (rtMode === 'simplify') {
        const a = parseFloat((document.getElementById('rt-a') as HTMLInputElement).value) || 0;
        const b = parseFloat((document.getElementById('rt-b') as HTMLInputElement).value) || 0;
        if (a === 0 && b === 0) return;

        const g = gcd(a, b) || 1;
        const sa = a / g;
        const sb = b / g;

        document.getElementById('rt-result-label')!.textContent = 'Simplified Ratio';
        document.getElementById('rt-result')!.textContent = `${sa} : ${sb}`;
        document.getElementById('rt-info1-label')!.textContent = 'As Fraction';
        document.getElementById('rt-info1')!.textContent = `${sa}/${sb}`;
        document.getElementById('rt-info2-label')!.textContent = 'As Decimal';
        document.getElementById('rt-info2')!.textContent = b !== 0 ? (a / b).toFixed(4) : '∞';

        const equivs = [];
        for (let i = 1; i <= 10; i++) {
          equivs.push(`${sa * i}:${sb * i}`);
        }
        document.getElementById('rt-equiv')!.innerHTML = equivs.map(e =>
          `<span class="px-2 py-1 bg-white rounded">${e}</span>`
        ).join('');

      } else if (rtMode === 'proportion') {
        const a = (document.getElementById('rt-pa') as HTMLInputElement).value;
        const b = (document.getElementById('rt-pb') as HTMLInputElement).value;
        const c = (document.getElementById('rt-pc') as HTMLInputElement).value;
        const d = (document.getElementById('rt-pd') as HTMLInputElement).value;

        const vals = [a, b, c, d].map(v => v === '' ? null : parseFloat(v));
        const emptyIdx = vals.findIndex(v => v === null);

        let result: number | null = null;
        if (emptyIdx === 0 && vals[1] && vals[2] && vals[3]) result = (vals[1] * vals[2]) / vals[3];
        else if (emptyIdx === 1 && vals[0] && vals[2] && vals[3]) result = (vals[0] * vals[3]) / vals[2];
        else if (emptyIdx === 2 && vals[0] && vals[1] && vals[3]) result = (vals[0] * vals[3]) / vals[1];
        else if (emptyIdx === 3 && vals[0] && vals[1] && vals[2]) result = (vals[1] * vals[2]) / vals[0];

        if (result !== null) {
          const labels = ['A', 'B', 'C', 'D'];
          document.getElementById('rt-result-label')!.textContent = `${labels[emptyIdx]} =`;
          document.getElementById('rt-result')!.textContent = Number.isInteger(result) ? String(result) : result.toFixed(4);
          const finalVals = [...vals];
          finalVals[emptyIdx] = result;
          document.getElementById('rt-info1-label')!.textContent = 'Proportion';
          document.getElementById('rt-info1')!.textContent = `${finalVals[0]}:${finalVals[1]} = ${finalVals[2]}:${finalVals[3]}`;
          document.getElementById('rt-info2-label')!.textContent = 'Verified';
          const cross1 = (finalVals[0]! * finalVals[3]!).toFixed(2);
          const cross2 = (finalVals[1]! * finalVals[2]!).toFixed(2);
          document.getElementById('rt-info2')!.textContent = `${cross1} = ${cross2}`;
          document.getElementById('rt-equiv')!.innerHTML = '';
        } else {
          document.getElementById('rt-result')!.textContent = 'Leave one field empty';
        }

      } else {
        const a = parseFloat((document.getElementById('rt-sa') as HTMLInputElement).value) || 0;
        const b = parseFloat((document.getElementById('rt-sb') as HTMLInputElement).value) || 0;
        const factor = parseFloat((document.getElementById('rt-factor') as HTMLInputElement).value) || 0;
        const type = (document.getElementById('rt-scale-type') as HTMLSelectElement).value;

        let newA: number, newB: number;
        if (type === 'multiply') {
          newA = a * factor;
          newB = b * factor;
        } else {
          const total = a + b;
          if (total === 0) return;
          newA = (a / total) * factor;
          newB = (b / total) * factor;
        }

        document.getElementById('rt-result-label')!.textContent = 'Scaled Ratio';
        const fmtA = Number.isInteger(newA) ? String(newA) : newA.toFixed(2);
        const fmtB = Number.isInteger(newB) ? String(newB) : newB.toFixed(2);
        document.getElementById('rt-result')!.textContent = `${fmtA} : ${fmtB}`;
        document.getElementById('rt-info1-label')!.textContent = 'Total';
        document.getElementById('rt-info1')!.textContent = (newA + newB).toFixed(2);
        document.getElementById('rt-info2-label')!.textContent = 'Original';
        document.getElementById('rt-info2')!.textContent = `${a} : ${b}`;
        document.getElementById('rt-equiv')!.innerHTML = '';
      }

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.rt-mode-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.rt-mode-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          rtMode = (btn as HTMLElement).dataset.mode || 'simplify';
          document.getElementById('rt-simplify')!.classList.toggle('hidden', rtMode !== 'simplify');
          document.getElementById('rt-proportion')!.classList.toggle('hidden', rtMode !== 'proportion');
          document.getElementById('rt-scale')!.classList.toggle('hidden', rtMode !== 'scale');
          calcRatio();
        });
      });

      ['rt-a', 'rt-b', 'rt-pa', 'rt-pb', 'rt-pc', 'rt-pd', 'rt-sa', 'rt-sb', 'rt-factor'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcRatio);
      });
      document.getElementById('rt-scale-type')?.addEventListener('change', calcRatio);

      calcRatio();
    }, 50);
  </script>
</CalculatorLayout>
