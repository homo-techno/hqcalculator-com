---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Elastic Calculator - Length & Stretch Ratio";
const description = "Calculate elastic length from body measurement with reduction percentage, casing width, and stretch ratio for waistbands, cuffs, and more.";
const relatedCalcs = [
  { name: "Fabric Calculator", url: "/fabric-calculator", description: "Fabric yardage needs." },
  { name: "Yarn Calculator", url: "/yarn-calculator", description: "Yarn yardage calculator." },
  { name: "Length Converter", url: "/length-converter", description: "Length conversions." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage calculations." },
  { name: "Quilt Calculator", url: "/quilt-calculator", description: "Quilt sizing math." },
  { name: "Ratio Calculator", url: "/ratio-calculator", description: "Ratio calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Elastic Calculator" keywords="elastic calculator, elastic length, stretch ratio, waistband elastic, casing width, elastic reduction" breadcrumbs={[{ name: "Elastic", url: "/elastic-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Elastic Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate the right elastic length for waistbands, cuffs, and necklines with reduction and stretch ratios.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Application</label>
          <select id="el2-app" class="el2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="waist" selected>Waistband</option>
            <option value="cuff">Sleeve / Leg Cuff</option>
            <option value="neck">Neckline</option>
            <option value="headband">Headband</option>
            <option value="swimwear">Swimwear Leg Opening</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Body Measurement (inches)</label><input type="number" id="el2-body" class="el2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="30" min="2" max="80" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Reduction %</label><input type="number" id="el2-reduce" class="el2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="15" min="5" max="40" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Elastic Width</label>
            <select id="el2-width" class="el2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="0.25">1/4 inch</option>
              <option value="0.375">3/8 inch</option>
              <option value="0.5">1/2 inch</option>
              <option value="0.75">3/4 inch</option>
              <option value="1" selected>1 inch</option>
              <option value="1.5">1-1/2 inch</option>
              <option value="2">2 inch</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Elastic Type</label>
            <select id="el2-type" class="el2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="braided">Braided</option>
              <option value="knit" selected>Knit</option>
              <option value="woven">Woven (non-roll)</option>
              <option value="fold">Fold-over (FOE)</option>
              <option value="clear">Clear / Swimwear</option>
            </select>
          </div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Overlap / Join (inches)</label><input type="number" id="el2-overlap" class="el2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="0.5" max="3" step="0.25"></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Cut Elastic Length</div>
          <div class="text-4xl font-extrabold font-mono" id="el2-result">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Relaxed Length</div><div class="text-xl font-bold font-mono" id="el2-relaxed">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Stretch Ratio</div><div class="text-xl font-bold font-mono" id="el2-stretch">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Casing Width</div><div class="text-xl font-bold font-mono" id="el2-casing">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Fabric Gathered</div><div class="text-xl font-bold font-mono" id="el2-gather">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Recovery</div><div class="text-xl font-bold font-mono" id="el2-recovery">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="elastic" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcEL2() {
      const app = (document.getElementById('el2-app') as HTMLSelectElement).value;
      const body = parseFloat((document.getElementById('el2-body') as HTMLInputElement).value) || 30;
      let reduce = parseFloat((document.getElementById('el2-reduce') as HTMLInputElement).value) || 15;
      const elasticW = parseFloat((document.getElementById('el2-width') as HTMLSelectElement).value) || 1;
      const etype = (document.getElementById('el2-type') as HTMLSelectElement).value;
      const overlap = parseFloat((document.getElementById('el2-overlap') as HTMLInputElement).value) || 1;

      // Recommended reductions by application
      const reductions: Record<string, number> = {
        waist: 15, cuff: 10, neck: 8, headband: 15, swimwear: 20
      };
      if (app !== 'custom') {
        reduce = reductions[app] || 15;
        (document.getElementById('el2-reduce') as HTMLInputElement).value = reduce.toString();
      }

      const relaxedLen = body * (1 - reduce / 100);
      const cutLen = relaxedLen + overlap;
      const stretchRatio = body / relaxedLen;

      // Casing width = elastic width + seam allowance + ease
      const casingWidth = elasticW + 0.5;

      // Fabric width for gathered area (needs body measurement of fabric)
      const fabricGathered = body; // fabric should be body measurement

      // Recovery rating by type
      const recoveryMap: Record<string, string> = {
        braided: 'Good (narrows when stretched)', knit: 'Excellent (retains width)',
        woven: 'Very Good (no-roll)', fold: 'Good (decorative edge)', clear: 'Excellent (chlorine resistant)'
      };
      const recovery = recoveryMap[etype] || 'Good';

      document.getElementById('el2-result')!.textContent = cutLen.toFixed(1) + ' inches';
      document.getElementById('el2-relaxed')!.textContent = relaxedLen.toFixed(1) + '"';
      document.getElementById('el2-stretch')!.textContent = stretchRatio.toFixed(2) + 'x';
      document.getElementById('el2-casing')!.textContent = casingWidth.toFixed(1) + '"';
      document.getElementById('el2-gather')!.textContent = fabricGathered.toFixed(1) + '" of fabric';
      document.getElementById('el2-recovery')!.textContent = recovery;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.el2-in').forEach(el => { el.addEventListener('input', calcEL2); el.addEventListener('change', calcEL2); });
      calcEL2();
    }, 50);
  </script>
</CalculatorLayout>
