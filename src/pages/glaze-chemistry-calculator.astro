---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Glaze Chemistry Calculator - Oxide Analysis, COE & Ratios";
const description = "Analyze glaze oxide chemistry including silica-to-alumina ratio, flux ratios, and coefficient of expansion (COE). Evaluate glaze fit and durability.";
const relatedCalcs = [
  { name: "Glaze Recipe Calculator", url: "/glaze-recipe-calculator", description: "Scale glaze batch recipes." },
  { name: "Kiln Temperature Calculator", url: "/kiln-temperature-calculator", description: "Firing schedules." },
  { name: "Thermal Shock Calculator", url: "/thermal-shock-calculator", description: "Thermal shock resistance." },
  { name: "Clay Shrinkage Calculator", url: "/clay-shrinkage-calculator", description: "Clay shrinkage rates." },
  { name: "Glass Fusing Calculator", url: "/glass-fusing-calculator", description: "Glass fusing & COE." },
  { name: "Ceramic Mold Calculator", url: "/ceramic-mold-calculator", description: "Plaster mold ratios." },
];
---
<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Glaze Chemistry Calculator"
  keywords="glaze chemistry, oxide analysis, seger formula, silica alumina ratio, glaze COE, flux ratio, ceramic chemistry, unity formula"
  breadcrumbs={[{ name: "Glaze Chemistry Calculator", url: "/glaze-chemistry-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Glaze Chemistry Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Evaluate glaze chemistry by entering oxide molar values. Check silica-to-alumina ratio, flux balance, and estimated COE.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <h3 class="font-semibold text-text mb-3">Flux Oxides (RO/R2O) - Unity = 1.0</h3>
      <div class="grid grid-cols-2 gap-3 mb-5">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Na2O (Soda)</label>
          <input type="number" id="gc2-na2o" class="gc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.15" min="0" max="1" step="0.01">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">K2O (Potash)</label>
          <input type="number" id="gc2-k2o" class="gc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.20" min="0" max="1" step="0.01">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">CaO (Calcium)</label>
          <input type="number" id="gc2-cao" class="gc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.40" min="0" max="1" step="0.01">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">MgO (Magnesium)</label>
          <input type="number" id="gc2-mgo" class="gc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.10" min="0" max="1" step="0.01">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">ZnO (Zinc)</label>
          <input type="number" id="gc2-zno" class="gc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.05" min="0" max="1" step="0.01">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">BaO (Barium)</label>
          <input type="number" id="gc2-bao" class="gc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.10" min="0" max="1" step="0.01">
        </div>
      </div>

      <h3 class="font-semibold text-text mb-3">Amphoteric (R2O3)</h3>
      <div class="grid grid-cols-2 gap-3 mb-5">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Al2O3 (Alumina)</label>
          <input type="number" id="gc2-al2o3" class="gc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.35" min="0" max="2" step="0.01">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">B2O3 (Boron)</label>
          <input type="number" id="gc2-b2o3" class="gc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.00" min="0" max="2" step="0.01">
        </div>
      </div>

      <h3 class="font-semibold text-text mb-3">Glass Former (RO2)</h3>
      <div class="mb-5">
        <label class="block text-xs font-medium text-text mb-1">SiO2 (Silica)</label>
        <input type="number" id="gc2-sio2" class="gc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3.00" min="0" max="10" step="0.1">
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Firing Range</label>
        <select id="gc2-range" class="gc2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="low">Low Fire (Cone 06-01)</option>
          <option value="mid" selected>Mid Fire (Cone 4-7)</option>
          <option value="high">High Fire (Cone 8-10)</option>
        </select>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Si:Al Ratio</div>
        <div class="text-4xl font-extrabold" id="gc2-si-al">--</div>
        <div class="text-sm text-blue-200 mt-1" id="gc2-si-al-note">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Flux Unity Total</div>
          <div class="text-xl font-bold" id="gc2-flux-total">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Est. COE (x10^-7)</div>
          <div class="text-xl font-bold" id="gc2-coe">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Alkali Ratio</div>
          <div class="text-xl font-bold" id="gc2-alkali">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Glaze Fit</div>
          <div class="text-xl font-bold" id="gc2-fit">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-4">
        <h3 class="font-semibold text-sm text-text mb-2">Analysis</h3>
        <ul class="text-xs text-text-muted space-y-1" id="gc2-analysis"></ul>
      </div>

      <ShareButton calculatorId="glaze-chemistry" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Understanding Glaze Chemistry</h2>
      <p>The Seger unity formula expresses glaze composition in molecular ratios with fluxes summing to 1.0. Key relationships like the silica-to-alumina ratio determine surface quality, durability, and melting behavior.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Ideal Ranges (Mid-Fire Cone 6)</h3>
      <ul>
        <li><strong>Si:Al ratio:</strong> 6-10 for glossy, 3-5 for matte</li>
        <li><strong>Al2O3:</strong> 0.25-0.50 (higher = more durable, stiffer melt)</li>
        <li><strong>SiO2:</strong> 2.5-4.5 (higher = more durable, higher melting point)</li>
        <li><strong>Alkali fluxes (Na2O + K2O):</strong> Keep below 0.40 to avoid crazing</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcGC2() {
      const na2o = parseFloat((document.getElementById('gc2-na2o') as HTMLInputElement).value) || 0;
      const k2o = parseFloat((document.getElementById('gc2-k2o') as HTMLInputElement).value) || 0;
      const cao = parseFloat((document.getElementById('gc2-cao') as HTMLInputElement).value) || 0;
      const mgo = parseFloat((document.getElementById('gc2-mgo') as HTMLInputElement).value) || 0;
      const zno = parseFloat((document.getElementById('gc2-zno') as HTMLInputElement).value) || 0;
      const bao = parseFloat((document.getElementById('gc2-bao') as HTMLInputElement).value) || 0;
      const al2o3 = parseFloat((document.getElementById('gc2-al2o3') as HTMLInputElement).value) || 0;
      const b2o3 = parseFloat((document.getElementById('gc2-b2o3') as HTMLInputElement).value) || 0;
      const sio2 = parseFloat((document.getElementById('gc2-sio2') as HTMLInputElement).value) || 0;
      const range = (document.getElementById('gc2-range') as HTMLSelectElement).value;

      const fluxTotal = na2o + k2o + cao + mgo + zno + bao;
      const alkaliTotal = na2o + k2o;
      const siAlRatio = al2o3 > 0 ? sio2 / al2o3 : 0;

      // Estimated COE using Appen factors (x10^-7 per degree C)
      // Simplified Appen coefficients for common oxides
      const coe = (na2o * 39.5 + k2o * 28.3 + cao * 16.7 + mgo * 6.0 +
                   zno * 7.0 + bao * 14.0 + al2o3 * (-5.0) + b2o3 * (-6.5) + sio2 * 3.8) /
                  (fluxTotal + al2o3 + b2o3 + sio2);

      document.getElementById('gc2-si-al')!.textContent = siAlRatio.toFixed(1) + ':1';
      document.getElementById('gc2-flux-total')!.textContent = fluxTotal.toFixed(2);
      document.getElementById('gc2-coe')!.textContent = (coe * 10).toFixed(1);
      document.getElementById('gc2-alkali')!.textContent = (alkaliTotal * 100 / Math.max(fluxTotal, 0.01)).toFixed(0) + '%';

      // Ideal ranges by firing range
      const idealRanges: Record<string, {siAlMin: number, siAlMax: number, alMin: number, alMax: number, siMin: number, siMax: number}> = {
        low: { siAlMin: 5, siAlMax: 15, alMin: 0.10, alMax: 0.35, siMin: 1.5, siMax: 3.5 },
        mid: { siAlMin: 5, siAlMax: 10, alMin: 0.25, alMax: 0.50, siMin: 2.5, siMax: 4.5 },
        high: { siAlMin: 5, siAlMax: 12, alMin: 0.30, alMax: 0.70, siMin: 3.0, siMax: 6.0 }
      };
      const ideal = idealRanges[range] || idealRanges['mid'];

      // Si:Al note
      let siAlNote = '';
      if (siAlRatio < 5) siAlNote = 'Very matte / underfired appearance';
      else if (siAlRatio < 7) siAlNote = 'Satin to matte surface';
      else if (siAlRatio < 10) siAlNote = 'Glossy surface';
      else siAlNote = 'Very glossy / may run';
      document.getElementById('gc2-si-al-note')!.textContent = siAlNote;

      // Glaze fit assessment
      const coeVal = coe * 10;
      let fitLabel = 'Good';
      if (coeVal > 80) fitLabel = 'High COE - may craze';
      else if (coeVal > 70) fitLabel = 'Slightly high';
      else if (coeVal < 50) fitLabel = 'Low COE - may shiver';
      else if (coeVal < 60) fitLabel = 'Slightly low';
      document.getElementById('gc2-fit')!.textContent = fitLabel;

      // Analysis
      const analysis: string[] = [];
      if (Math.abs(fluxTotal - 1.0) > 0.05) {
        analysis.push('Flux total is ' + fluxTotal.toFixed(2) + ' (should be 1.0 for unity formula)');
      } else {
        analysis.push('Flux unity is balanced at ' + fluxTotal.toFixed(2));
      }

      if (al2o3 < ideal.alMin) analysis.push('Al2O3 is low (' + al2o3.toFixed(2) + ') - glaze may be too fluid or not durable');
      else if (al2o3 > ideal.alMax) analysis.push('Al2O3 is high (' + al2o3.toFixed(2) + ') - glaze may be too stiff');
      else analysis.push('Al2O3 is in good range for ' + range + ' fire');

      if (sio2 < ideal.siMin) analysis.push('SiO2 is low (' + sio2.toFixed(1) + ') - may lack durability or acid resistance');
      else if (sio2 > ideal.siMax) analysis.push('SiO2 is high (' + sio2.toFixed(1) + ') - may not melt fully');
      else analysis.push('SiO2 is in good range');

      if (alkaliTotal > 0.40) analysis.push('High alkali flux (' + alkaliTotal.toFixed(2) + ') - increased crazing risk');
      if (cao > 0.50) analysis.push('High CaO may produce matte or crystalline surface');
      if (mgo > 0.25) analysis.push('High MgO creates smooth, buttery matte surfaces');

      const ul = document.getElementById('gc2-analysis')!;
      ul.innerHTML = '';
      analysis.forEach(note => {
        const li = document.createElement('li');
        li.textContent = note;
        ul.appendChild(li);
      });

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.gc2-in').forEach(el => {
        el.addEventListener('input', calcGC2);
        el.addEventListener('change', calcGC2);
      });
      calcGC2();
    }, 50);
  </script>
</CalculatorLayout>
