---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Fabric Width Calculator - Pattern Layout & Yardage";
const description = "Optimize pattern layout for different fabric widths (45\", 54\", 60\"). Compare yardage needed and find the most efficient layout.";
const relatedCalcs = [
  { name: "Fabric Calculator", url: "/fabric-calculator", description: "Fabric yardage needs." },
  { name: "Quilt Calculator", url: "/quilt-calculator", description: "Quilt sizing math." },
  { name: "Area Calculator", url: "/area-calculator", description: "Area calculations." },
  { name: "Yarn Calculator", url: "/yarn-calculator", description: "Yarn yardage calculator." },
  { name: "Unit Price Calculator", url: "/unit-price-calculator", description: "Unit price comparison." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Fabric Width Calculator" keywords="fabric width calculator, pattern layout, yardage comparison, 45 54 60 inch fabric, fabric optimization, layout efficiency" breadcrumbs={[{ name: "Fabric Width", url: "/fabric-width-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Fabric Width Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Compare pattern layouts across fabric widths to find the most efficient yardage for your project.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Pattern Piece Width (in)</label><input type="number" id="fw-pw" class="fw-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="18" min="1" max="60" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Pattern Piece Length (in)</label><input type="number" id="fw-pl" class="fw-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="30" min="1" max="72" step="0.5"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Number of Pieces</label><input type="number" id="fw-pieces" class="fw-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="1" max="30" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Seam Allowance (in)</label><input type="number" id="fw-seam" class="fw-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.625" min="0" max="2" step="0.125"></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Width 1 (in)</label><input type="number" id="fw-w1" class="fw-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="45" min="20" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Width 2 (in)</label><input type="number" id="fw-w2" class="fw-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="54" min="20" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Width 3 (in)</label><input type="number" id="fw-w3" class="fw-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="60" min="20" step="1"></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Price/yd (Width 1)</label><input type="number" id="fw-p1" class="fw-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="0" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Price/yd (Width 2)</label><input type="number" id="fw-p2" class="fw-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="0" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Price/yd (Width 3)</label><input type="number" id="fw-p3" class="fw-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="14" min="0" step="0.5"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Best Value Width</div>
          <div class="text-4xl font-extrabold font-mono" id="fw-result">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase" id="fw-l1">45" Width</div>
            <div class="text-xl font-bold font-mono" id="fw-y1">--</div>
            <div class="text-xs text-text-muted" id="fw-c1">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase" id="fw-l2">54" Width</div>
            <div class="text-xl font-bold font-mono" id="fw-y2">--</div>
            <div class="text-xs text-text-muted" id="fw-c2">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase" id="fw-l3">60" Width</div>
            <div class="text-xl font-bold font-mono" id="fw-y3">--</div>
            <div class="text-xs text-text-muted" id="fw-c3">--</div>
          </div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Waste (W1)</div><div class="text-xl font-bold font-mono" id="fw-waste1">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Waste (W2)</div><div class="text-xl font-bold font-mono" id="fw-waste2">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Waste (W3)</div><div class="text-xl font-bold font-mono" id="fw-waste3">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="fabric-width" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcFW() {
      const pw = parseFloat((document.getElementById('fw-pw') as HTMLInputElement).value) || 18;
      const pl = parseFloat((document.getElementById('fw-pl') as HTMLInputElement).value) || 30;
      const pieces = parseInt((document.getElementById('fw-pieces') as HTMLInputElement).value) || 6;
      const seam = parseFloat((document.getElementById('fw-seam') as HTMLInputElement).value) || 0.625;

      const widths = [
        parseFloat((document.getElementById('fw-w1') as HTMLInputElement).value) || 45,
        parseFloat((document.getElementById('fw-w2') as HTMLInputElement).value) || 54,
        parseFloat((document.getElementById('fw-w3') as HTMLInputElement).value) || 60
      ];
      const prices = [
        parseFloat((document.getElementById('fw-p1') as HTMLInputElement).value) || 0,
        parseFloat((document.getElementById('fw-p2') as HTMLInputElement).value) || 0,
        parseFloat((document.getElementById('fw-p3') as HTMLInputElement).value) || 0
      ];

      const cutW = pw + seam * 2;
      const cutL = pl + seam * 2;

      const results: {yards: number; cost: number; waste: number}[] = [];

      for (let i = 0; i < 3; i++) {
        const fabW = widths[i];
        const usableWidth = fabW - 1; // 1" for selvedge
        const piecesAcross = Math.max(1, Math.floor(usableWidth / cutW));
        const rows = Math.ceil(pieces / piecesAcross);
        const totalLengthIn = rows * cutL;
        const yards = totalLengthIn / 36;

        const fabricArea = yards * 36 * fabW;
        const usedArea = pieces * cutW * cutL;
        const wastePct = ((fabricArea - usedArea) / fabricArea * 100);
        const cost = yards * prices[i];

        results.push({ yards, cost, waste: wastePct });
      }

      // Find best value (lowest cost)
      let bestIdx = 0;
      let bestCost = Infinity;
      for (let i = 0; i < 3; i++) {
        if (prices[i] > 0 && results[i].cost < bestCost) {
          bestCost = results[i].cost;
          bestIdx = i;
        }
      }

      const bestLabel = widths[bestIdx] + '" ($' + results[bestIdx].cost.toFixed(2) + ')';
      document.getElementById('fw-result')!.textContent = bestLabel;

      for (let i = 0; i < 3; i++) {
        document.getElementById('fw-l' + (i+1))!.textContent = widths[i] + '" WIDTH';
        document.getElementById('fw-y' + (i+1))!.textContent = results[i].yards.toFixed(2) + ' yd';
        document.getElementById('fw-c' + (i+1))!.textContent = '$' + results[i].cost.toFixed(2);
        document.getElementById('fw-waste' + (i+1))!.textContent = results[i].waste.toFixed(1) + '%';
      }
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.fw-in').forEach(el => { el.addEventListener('input', calcFW); el.addEventListener('change', calcFW); });
      calcFW();
    }, 50);
  </script>
</CalculatorLayout>
