---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Escrow Calculator - Monthly Escrow Payment Estimator";
const description = "Calculate your monthly escrow payment including property taxes, homeowner's insurance, and PMI.";
const relatedCalcs = [
  { name: "Mortgage Calculator", url: "/mortgage-calculator", description: "Mortgage." },
  { name: "Property Tax", url: "/property-tax-calculator", description: "Property tax." },
  { name: "Down Payment", url: "/down-payment-calculator", description: "Down payment." },
  { name: "HELOC Calculator", url: "/heloc-calculator", description: "HELOC." },
  { name: "Rent vs Buy", url: "/rent-vs-buy-calculator", description: "Rent vs buy." },
  { name: "Amortization", url: "/amortization-calculator", description: "Amortization." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Escrow Calculator" keywords="escrow calculator, escrow payment, property tax escrow, insurance escrow, PMI escrow, mortgage escrow" breadcrumbs={[{ name: "Escrow", url: "/escrow-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Escrow Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your monthly escrow payment for taxes, insurance, and PMI.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Annual Property Tax ($)</label><input type="number" id="es-tax" class="es-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4800" min="0" step="100"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Annual Insurance ($)</label><input type="number" id="es-ins" class="es-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1800" min="0" step="100"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Monthly PMI ($)</label><input type="number" id="es-pmi" class="es-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="125" min="0" step="10"></div>
          <div><label class="block text-xs font-medium text-text mb-1">HOA Monthly ($)</label><input type="number" id="es-hoa" class="es-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0" min="0" step="10"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Monthly P&amp;I Payment ($)</label><input type="number" id="es-pi" class="es-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1500" min="0" step="10"></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Monthly Payment</div>
          <div class="text-5xl font-extrabold font-mono" id="es-total">$0</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Monthly Escrow</div><div class="text-2xl font-bold" id="es-escrow">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Annual Escrow</div><div class="text-2xl font-bold" id="es-annual">$0</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Tax/mo</div><div class="text-xl font-bold" id="es-taxmo">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Insurance/mo</div><div class="text-xl font-bold" id="es-insmo">$0</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Payment Breakdown</h3>
          <div class="space-y-2" id="es-bars"></div>
        </div>
      </div>
      <ShareButton calculatorId="escrow" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcEscrow() {
      const tax = parseFloat((document.getElementById('es-tax') as HTMLInputElement).value) || 0;
      const ins = parseFloat((document.getElementById('es-ins') as HTMLInputElement).value) || 0;
      const pmi = parseFloat((document.getElementById('es-pmi') as HTMLInputElement).value) || 0;
      const hoa = parseFloat((document.getElementById('es-hoa') as HTMLInputElement).value) || 0;
      const pi = parseFloat((document.getElementById('es-pi') as HTMLInputElement).value) || 0;
      const taxMo = tax / 12;
      const insMo = ins / 12;
      const escrow = taxMo + insMo + pmi + hoa;
      const total = pi + escrow;
      document.getElementById('es-total')!.textContent = '$' + Math.round(total).toLocaleString();
      document.getElementById('es-escrow')!.textContent = '$' + Math.round(escrow).toLocaleString();
      document.getElementById('es-annual')!.textContent = '$' + Math.round(escrow * 12).toLocaleString();
      document.getElementById('es-taxmo')!.textContent = '$' + Math.round(taxMo).toLocaleString();
      document.getElementById('es-insmo')!.textContent = '$' + Math.round(insMo).toLocaleString();
      const items = [
        ['Principal & Interest', pi, '#3B82F6'],
        ['Property Tax', taxMo, '#10B981'],
        ['Insurance', insMo, '#F59E0B'],
        ['PMI', pmi, '#EF4444'],
        ['HOA', hoa, '#8B5CF6'],
      ].filter(([, v]) => (v as number) > 0);
      document.getElementById('es-bars')!.innerHTML = items.map(([label, val, color]) => {
        const pct = total > 0 ? ((val as number) / total * 100) : 0;
        return `<div class="flex items-center gap-2"><div class="w-24 text-xs text-text-muted">${label}</div><div class="flex-1 h-5 bg-gray-100 rounded-full overflow-hidden"><div class="h-full rounded-full" style="width:${pct}%;background:${color}"></div></div><div class="w-20 text-right text-xs font-bold">$${Math.round(val as number)} (${pct.toFixed(0)}%)</div></div>`;
      }).join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => { document.querySelectorAll('.es-in').forEach(el => el.addEventListener('input', calcEscrow)); calcEscrow(); }, 50);
  </script>
</CalculatorLayout>
