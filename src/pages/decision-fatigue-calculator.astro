---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Decision Fatigue Calculator - Willpower & Decision Load";
const description = "Estimate your daily decision count, fatigue accumulation, willpower depletion, and find your optimal decision timing throughout the day.";
const relatedCalcs = [
  { name: "Productivity Calculator", url: "/productivity-calculator", description: "Productivity metrics." },
  { name: "Pomodoro Calculator", url: "/pomodoro-calculator", description: "Pomodoro timer." },
  { name: "Sleep Calculator", url: "/sleep-calculator", description: "Optimize sleep cycles." },
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calorie needs." },
  { name: "Caffeine Calculator", url: "/caffeine-calculator", description: "Caffeine intake." },
  { name: "Study Time", url: "/study-time-calculator", description: "Study planning." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Decision Fatigue Calculator" keywords="decision fatigue, willpower depletion, ego depletion, decision making, decision overload, choice fatigue, optimal timing" breadcrumbs={[{ name: "Decision Fatigue", url: "/decision-fatigue-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Decision Fatigue Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your daily decision load and find the best times for important choices.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Role / Job Type</label>
          <select id="df3-role" class="df3-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center">
            <option value="exec">Executive / Manager (high decision load)</option>
            <option value="professional">Professional / Knowledge Worker</option>
            <option value="creative">Creative / Designer</option>
            <option value="service">Service / Customer-facing</option>
            <option value="manual">Manual / Routine work</option>
            <option value="student">Student</option>
            <option value="homemaker">Homemaker / Caregiver</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Hours of Sleep Last Night</label>
          <input type="number" id="df3-sleep" class="df3-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="0" max="14" step="0.5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Meals Eaten So Far Today</label>
          <input type="number" id="df3-meals" class="df3-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="0" max="6" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Number of Major Decisions Already Made Today</label>
          <input type="number" id="df3-made" class="df3-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="0" max="100" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Current Stress Level (1-10)</label>
          <input type="range" id="df3-stress" class="df3-in w-full" min="1" max="10" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Relaxed (1)</span><span>Very stressed (10)</span></div>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm opacity-80">Current Decision Capacity</div>
          <div class="text-2xl font-extrabold mt-1" id="df3-capacity">--</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Est. Daily Decision Count</div>
            <div class="text-xl font-bold text-text mt-1" id="df3-count">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Fatigue Accumulation</div>
            <div class="text-xl font-bold text-text mt-1" id="df3-fatigue">--</div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Willpower Reserve</div>
            <div class="text-xl font-bold text-text mt-1" id="df3-willpower">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Optimal Decision Window</div>
            <div class="text-xl font-bold text-text mt-1" id="df3-window">--</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-secondary mb-2">Strategies to Reduce Decision Fatigue</div>
          <div class="text-sm text-text" id="df3-strat">--</div>
        </div>
      </div>

      <ShareButton calculatorId="decision-fatigue" />
      <FeedbackWidget />
    </div>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcDF3() {
      const role = (document.getElementById('df3-role') as HTMLSelectElement).value;
      const sleepHrs = parseFloat((document.getElementById('df3-sleep') as HTMLInputElement).value) || 7;
      const meals = parseInt((document.getElementById('df3-meals') as HTMLInputElement).value) || 2;
      const made = parseInt((document.getElementById('df3-made') as HTMLInputElement).value) || 5;
      const stress = parseInt((document.getElementById('df3-stress') as HTMLInputElement).value) || 5;

      // Estimated daily decisions by role
      const decisionCounts: Record<string, number> = {
        exec: 120, professional: 80, creative: 70, service: 90, manual: 40, student: 60, homemaker: 100,
      };
      const dailyDecisions = decisionCounts[role] || 70;

      // Willpower/capacity starts at 100, depletes with decisions, stress, poor sleep
      let maxCapacity = 100;
      // Sleep factor
      if (sleepHrs < 6) maxCapacity -= 25;
      else if (sleepHrs < 7) maxCapacity -= 10;

      // Glucose/meals boost: each meal restores ~10 willpower
      maxCapacity += Math.min(3, meals) * 8;

      // Stress drain
      maxCapacity -= stress * 2;

      // Decisions already made drain capacity
      const drainPerDecision = 100 / (dailyDecisions * 0.6); // hitting ~0 at 60% of daily decisions
      const currentDrain = made * drainPerDecision;
      const currentCapacity = Math.max(0, Math.min(100, maxCapacity - currentDrain));

      const fatiguePct = Math.min(100, currentDrain / maxCapacity * 100);

      let capacityLabel = '';
      if (currentCapacity > 70) capacityLabel = 'High - Good time for important decisions';
      else if (currentCapacity > 40) capacityLabel = 'Moderate - Routine decisions OK';
      else if (currentCapacity > 15) capacityLabel = 'Low - Avoid major decisions';
      else capacityLabel = 'Depleted - Take a break, eat, rest';

      // Optimal window
      let window = 'Morning (9-11 AM)';
      if (sleepHrs >= 7 && meals >= 1) window = '9-11 AM and 1-3 PM (after lunch)';
      else if (sleepHrs < 6) window = 'After a nap or rest period';

      document.getElementById('df3-capacity')!.textContent = currentCapacity.toFixed(0) + '% - ' + capacityLabel;
      document.getElementById('df3-count')!.textContent = dailyDecisions + ' decisions/day';
      document.getElementById('df3-fatigue')!.textContent = fatiguePct.toFixed(0) + '% fatigued';
      document.getElementById('df3-willpower')!.textContent = currentCapacity.toFixed(0) + ' / ' + maxCapacity.toFixed(0);
      document.getElementById('df3-window')!.textContent = window;

      let strats: string[] = [];
      strats.push('Automate routine decisions (meal prep, standard outfits, templates).');
      if (made > dailyDecisions * 0.4) strats.push('You have used over 40% of your decision budget. Defer remaining important choices to tomorrow morning.');
      if (meals < 2) strats.push('Eat something. Glucose restores decision-making capacity (the "glucose hypothesis").');
      if (sleepHrs < 7) strats.push('Sleep deprivation severely impairs judgment. Prioritize 7+ hours tonight.');
      if (stress > 6) strats.push('High stress accelerates decision fatigue. Take 10 min for a walk or deep breathing before deciding.');
      strats.push('Batch similar decisions together. Use the "2-minute rule" - if a decision takes under 2 minutes, make it immediately.');

      document.getElementById('df3-strat')!.textContent = strats.join(' ');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      (document.getElementById('df3-sleep') as HTMLInputElement).value = '7';
      (document.getElementById('df3-meals') as HTMLInputElement).value = '2';
      (document.getElementById('df3-made') as HTMLInputElement).value = '5';
      (document.getElementById('df3-stress') as HTMLInputElement).value = '5';
      document.querySelectorAll('.df3-in').forEach(el => {
        el.addEventListener('input', calcDF3);
        el.addEventListener('change', calcDF3);
      });
      calcDF3();
    }, 50);
  </script>
</CalculatorLayout>
