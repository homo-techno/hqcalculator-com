---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Embroidery Thread Calculator - Length & Coverage";
const description = "Calculate embroidery thread length from stitch count, number of strands, and coverage area for hand and machine embroidery.";
const relatedCalcs = [
  { name: "Fabric Calculator", url: "/fabric-calculator", description: "Fabric yardage." },
  { name: "Area Calculator", url: "/area-calculator", description: "Area calculations." },
  { name: "Length Converter", url: "/length-converter", description: "Length conversion." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Budget planning." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Unit Price", url: "/unit-price-calculator", description: "Unit pricing." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Embroidery Thread Calculator" keywords="embroidery thread calculator, stitch count, thread length, embroidery floss, strand coverage" breadcrumbs={[{ name: "Embroidery Thread", url: "/embroidery-thread-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Embroidery Thread Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate thread length, skeins, and coverage for hand or machine embroidery projects.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Stitch Type</label>
          <select id="et-stitch" class="et-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="cross" selected>Cross Stitch</option>
            <option value="back">Backstitch</option>
            <option value="satin">Satin Stitch</option>
            <option value="french">French Knot</option>
            <option value="chain">Chain Stitch</option>
            <option value="stem">Stem Stitch</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Design Width (inches)</label><input type="number" id="et-w" class="et-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="0.5" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Design Height (inches)</label><input type="number" id="et-h" class="et-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="0.5" step="0.5"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Fabric Count (ct)</label>
            <select id="et-ct" class="et-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="11">11 count Aida</option>
              <option value="14" selected>14 count Aida</option>
              <option value="16">16 count Aida</option>
              <option value="18">18 count Aida</option>
              <option value="28">28 count Evenweave</option>
            </select>
          </div>
          <div><label class="block text-xs font-medium text-text mb-1">Strands Used</label><input type="number" id="et-strands" class="et-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="1" max="6" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Coverage (%)</label><input type="number" id="et-cov" class="et-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="60" min="1" max="100" step="5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Number of Colors</label><input type="number" id="et-colors" class="et-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="1" max="100" step="1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Thread Needed</div>
          <div class="text-4xl font-extrabold font-mono" id="et-result">0 yards</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Stitches</div><div class="text-xl font-bold font-mono" id="et-stitches">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Skeins (8m)</div><div class="text-xl font-bold font-mono" id="et-skeins">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Per Color</div><div class="text-xl font-bold font-mono" id="et-percolor">0 yd</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Thread (meters)</div><div class="text-xl font-bold font-mono" id="et-meters">0 m</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Design Area</div><div class="text-xl font-bold font-mono" id="et-area">0 sq in</div></div>
        </div>
      </div>
      <ShareButton calculatorId="embroidery-thread" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcET() {
      const stitch = (document.getElementById('et-stitch') as HTMLSelectElement).value;
      const dw = parseFloat((document.getElementById('et-w') as HTMLInputElement).value) || 6;
      const dh = parseFloat((document.getElementById('et-h') as HTMLInputElement).value) || 6;
      const ct = parseInt((document.getElementById('et-ct') as HTMLSelectElement).value) || 14;
      const strands = parseInt((document.getElementById('et-strands') as HTMLInputElement).value) || 2;
      const coverage = parseFloat((document.getElementById('et-cov') as HTMLInputElement).value) || 60;
      const colors = parseInt((document.getElementById('et-colors') as HTMLInputElement).value) || 1;

      // Effective count (evenweave stitched over 2)
      const effectiveCt = ct >= 28 ? ct / 2 : ct;

      // Total possible stitches in design area
      const stitchesWide = Math.round(dw * effectiveCt);
      const stitchesHigh = Math.round(dh * effectiveCt);
      const totalPossible = stitchesWide * stitchesHigh;
      const totalStitches = Math.round(totalPossible * (coverage / 100));

      // Thread per stitch depends on stitch type and fabric count
      // Cross stitch: front + back ~ 1 inch per stitch on 14ct
      const inchPerStitch: Record<string, number> = {
        cross: 1.0 / effectiveCt * 14, // normalized to 14ct baseline
        back: 0.7 / effectiveCt * 14,
        satin: 1.3 / effectiveCt * 14,
        french: 0.8 / effectiveCt * 14,
        chain: 1.1 / effectiveCt * 14,
        stem: 0.9 / effectiveCt * 14
      };

      const ips = inchPerStitch[stitch] || 1.0;
      // Thread per stitch includes: stitch length + fabric thickness (~0.1")
      const threadPerStitch = ips + 0.1;

      // Total single-strand inches, then multiply by strand count
      const totalInches = totalStitches * threadPerStitch * strands;

      // Add 15% for tails and waste
      const totalWithWaste = totalInches * 1.15;
      const totalYards = totalWithWaste / 36;
      const totalMeters = totalYards * 0.9144;

      // Skeins: standard DMC skein = 8 meters = 8.7 yards
      const skeins = Math.ceil(totalYards / 8.7);

      // Per color (assume roughly equal distribution)
      const perColorYd = totalYards / colors;

      const designArea = dw * dh;

      document.getElementById('et-result')!.textContent = totalYards.toFixed(0) + ' yards';
      document.getElementById('et-stitches')!.textContent = totalStitches.toLocaleString();
      document.getElementById('et-skeins')!.textContent = skeins.toString();
      document.getElementById('et-percolor')!.textContent = perColorYd.toFixed(1) + ' yd';
      document.getElementById('et-meters')!.textContent = totalMeters.toFixed(0) + ' m';
      document.getElementById('et-area')!.textContent = designArea.toFixed(1) + ' sq in';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.et-in').forEach(el => { el.addEventListener('input', calcET); el.addEventListener('change', calcET); });
      calcET();
    }, 50);
  </script>
</CalculatorLayout>
