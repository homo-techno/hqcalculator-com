---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Thread Pitch Calculator - Dimensions, TPI & Tap Drill";
const description = "Calculate thread dimensions including major/minor diameter, pitch, TPI, and tap drill size for UNC, UNF, and metric threads.";

const relatedCalcs = [
  { name: "Drill Bit Calculator", url: "/drill-bit-calculator", description: "Drill sizes for taps." },
  { name: "Bolt Torque Calculator", url: "/bolt-torque-calculator", description: "Bolt torque values." },
  { name: "Rivet Calculator", url: "/rivet-calculator", description: "Rivet sizing." },
  { name: "Metal Weight Calculator", url: "/metal-weight-calculator", description: "Weight of metal shapes." },
  { name: "Cutting Speed Calculator", url: "/cutting-speed-calculator", description: "Machining speeds." },
  { name: "Structural Steel Calculator", url: "/structural-steel-calculator", description: "Steel section properties." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Thread Pitch Calculator"
  keywords="thread pitch, TPI, thread dimensions, UNC, UNF, metric thread, major diameter, minor diameter, tap drill size"
  breadcrumbs={[{ name: "Thread Pitch Calculator", url: "/thread-pitch-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Thread Pitch Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Look up thread dimensions, pitch, TPI, and tap drill sizes for standard thread series.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Thread System -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Thread System</label>
        <select id="tp2-system" class="tp2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="unc">UNC (Unified National Coarse)</option>
          <option value="unf">UNF (Unified National Fine)</option>
          <option value="metric">Metric (ISO)</option>
        </select>
      </div>

      <!-- Thread Size -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Thread Size</label>
        <select id="tp2-size" class="tp2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="0">--</option>
        </select>
      </div>

      <!-- Results -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Thread Designation</div>
        <div class="text-3xl font-extrabold" id="tp2-designation">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Major Diameter</div>
          <div class="text-xl font-bold" id="tp2-major">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Minor Diameter</div>
          <div class="text-xl font-bold" id="tp2-minor">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Pitch</div>
          <div class="text-xl font-bold" id="tp2-pitch">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">TPI</div>
          <div class="text-xl font-bold" id="tp2-tpi">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Tap Drill Size</div>
          <div class="text-xl font-bold" id="tp2-tap">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Clearance Drill</div>
          <div class="text-xl font-bold" id="tp2-clear">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl text-center mb-6">
        <div class="text-xs text-text-muted uppercase">Pitch Diameter</div>
        <div class="text-xl font-bold" id="tp2-pitchdia">--</div>
      </div>

      <ShareButton calculatorId="thread-pitch" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Thread Dimensions Reference</h2>
      <p>Standard thread dimensions follow specific formulas based on the thread series. The tap drill size provides approximately 75% thread engagement, which is standard for most applications.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Tap Drill (Imperial):</strong> Major Diameter - (1 / TPI)</p>
        <p><strong>Tap Drill (Metric):</strong> Major Diameter - Pitch</p>
        <p><strong>Minor Diameter:</strong> Major - 1.0825 x Pitch</p>
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    type ThreadData = { name: string; major: number; tpi: number; tapDrill: string; clearDrill: string };

    const tp2Threads: Record<string, ThreadData[]> = {
      unc: [
        {name:'#1-64', major:0.073, tpi:64, tapDrill:'#53 (0.060")', clearDrill:'#48 (0.076")'},
        {name:'#2-56', major:0.086, tpi:56, tapDrill:'#50 (0.070")', clearDrill:'#43 (0.089")'},
        {name:'#4-40', major:0.112, tpi:40, tapDrill:'#43 (0.089")', clearDrill:'#32 (0.116")'},
        {name:'#6-32', major:0.138, tpi:32, tapDrill:'#36 (0.107")', clearDrill:'#27 (0.144")'},
        {name:'#8-32', major:0.164, tpi:32, tapDrill:'#29 (0.136")', clearDrill:'#18 (0.170")'},
        {name:'#10-24', major:0.190, tpi:24, tapDrill:'#25 (0.150")', clearDrill:'#9 (0.196")'},
        {name:'1/4-20', major:0.250, tpi:20, tapDrill:'#7 (0.201")', clearDrill:'17/64" (0.266")'},
        {name:'5/16-18', major:0.3125, tpi:18, tapDrill:'F (0.257")', clearDrill:'21/64" (0.328")'},
        {name:'3/8-16', major:0.375, tpi:16, tapDrill:'5/16" (0.313")', clearDrill:'25/64" (0.391")'},
        {name:'7/16-14', major:0.4375, tpi:14, tapDrill:'U (0.368")', clearDrill:'29/64" (0.453")'},
        {name:'1/2-13', major:0.500, tpi:13, tapDrill:'27/64" (0.422")', clearDrill:'33/64" (0.516")'},
        {name:'9/16-12', major:0.5625, tpi:12, tapDrill:'31/64" (0.484")', clearDrill:'37/64" (0.578")'},
        {name:'5/8-11', major:0.625, tpi:11, tapDrill:'17/32" (0.531")', clearDrill:'41/64" (0.641")'},
        {name:'3/4-10', major:0.750, tpi:10, tapDrill:'21/32" (0.656")', clearDrill:'49/64" (0.766")'},
        {name:'7/8-9', major:0.875, tpi:9, tapDrill:'49/64" (0.766")', clearDrill:'57/64" (0.891")'},
        {name:'1-8', major:1.000, tpi:8, tapDrill:'7/8" (0.875")', clearDrill:'1-1/64" (1.016")'}
      ],
      unf: [
        {name:'#1-72', major:0.073, tpi:72, tapDrill:'#53 (0.060")', clearDrill:'#48 (0.076")'},
        {name:'#2-64', major:0.086, tpi:64, tapDrill:'#50 (0.070")', clearDrill:'#43 (0.089")'},
        {name:'#4-48', major:0.112, tpi:48, tapDrill:'#42 (0.094")', clearDrill:'#32 (0.116")'},
        {name:'#6-40', major:0.138, tpi:40, tapDrill:'#33 (0.113")', clearDrill:'#27 (0.144")'},
        {name:'#8-36', major:0.164, tpi:36, tapDrill:'#29 (0.136")', clearDrill:'#18 (0.170")'},
        {name:'#10-32', major:0.190, tpi:32, tapDrill:'#21 (0.159")', clearDrill:'#9 (0.196")'},
        {name:'1/4-28', major:0.250, tpi:28, tapDrill:'#3 (0.213")', clearDrill:'17/64" (0.266")'},
        {name:'5/16-24', major:0.3125, tpi:24, tapDrill:'I (0.272")', clearDrill:'21/64" (0.328")'},
        {name:'3/8-24', major:0.375, tpi:24, tapDrill:'Q (0.332")', clearDrill:'25/64" (0.391")'},
        {name:'7/16-20', major:0.4375, tpi:20, tapDrill:'25/64" (0.391")', clearDrill:'29/64" (0.453")'},
        {name:'1/2-20', major:0.500, tpi:20, tapDrill:'29/64" (0.453")', clearDrill:'33/64" (0.516")'},
        {name:'9/16-18', major:0.5625, tpi:18, tapDrill:'33/64" (0.516")', clearDrill:'37/64" (0.578")'},
        {name:'5/8-18', major:0.625, tpi:18, tapDrill:'37/64" (0.578")', clearDrill:'41/64" (0.641")'},
        {name:'3/4-16', major:0.750, tpi:16, tapDrill:'11/16" (0.688")', clearDrill:'49/64" (0.766")'},
        {name:'7/8-14', major:0.875, tpi:14, tapDrill:'13/16" (0.813")', clearDrill:'57/64" (0.891")'},
        {name:'1-12', major:1.000, tpi:12, tapDrill:'15/16" (0.938")', clearDrill:'1-1/64" (1.016")'}
      ],
      metric: [
        {name:'M2 x 0.4', major:2.0, tpi:63.5, tapDrill:'1.6 mm', clearDrill:'2.2 mm'},
        {name:'M2.5 x 0.45', major:2.5, tpi:56.4, tapDrill:'2.05 mm', clearDrill:'2.7 mm'},
        {name:'M3 x 0.5', major:3.0, tpi:50.8, tapDrill:'2.5 mm', clearDrill:'3.2 mm'},
        {name:'M4 x 0.7', major:4.0, tpi:36.3, tapDrill:'3.3 mm', clearDrill:'4.3 mm'},
        {name:'M5 x 0.8', major:5.0, tpi:31.8, tapDrill:'4.2 mm', clearDrill:'5.3 mm'},
        {name:'M6 x 1.0', major:6.0, tpi:25.4, tapDrill:'5.0 mm', clearDrill:'6.4 mm'},
        {name:'M8 x 1.25', major:8.0, tpi:20.3, tapDrill:'6.75 mm', clearDrill:'8.4 mm'},
        {name:'M10 x 1.5', major:10.0, tpi:16.9, tapDrill:'8.5 mm', clearDrill:'10.5 mm'},
        {name:'M12 x 1.75', major:12.0, tpi:14.5, tapDrill:'10.25 mm', clearDrill:'13.0 mm'},
        {name:'M14 x 2.0', major:14.0, tpi:12.7, tapDrill:'12.0 mm', clearDrill:'15.0 mm'},
        {name:'M16 x 2.0', major:16.0, tpi:12.7, tapDrill:'14.0 mm', clearDrill:'17.0 mm'},
        {name:'M18 x 2.5', major:18.0, tpi:10.2, tapDrill:'15.5 mm', clearDrill:'19.0 mm'},
        {name:'M20 x 2.5', major:20.0, tpi:10.2, tapDrill:'17.5 mm', clearDrill:'21.0 mm'},
        {name:'M24 x 3.0', major:24.0, tpi:8.5, tapDrill:'21.0 mm', clearDrill:'25.0 mm'},
        {name:'M30 x 3.5', major:30.0, tpi:7.3, tapDrill:'26.5 mm', clearDrill:'31.0 mm'}
      ]
    };

    function updateSizes() {
      const system = (document.getElementById('tp2-system') as HTMLSelectElement).value;
      const sizeSelect = document.getElementById('tp2-size') as HTMLSelectElement;
      const threads = tp2Threads[system] || [];
      sizeSelect.innerHTML = '';
      threads.forEach((t, i) => {
        const opt = document.createElement('option');
        opt.value = String(i);
        opt.textContent = t.name;
        sizeSelect.appendChild(opt);
      });
    }

    function calcTP2() {
      const system = (document.getElementById('tp2-system') as HTMLSelectElement).value;
      const idx = parseInt((document.getElementById('tp2-size') as HTMLSelectElement).value) || 0;
      const threads = tp2Threads[system] || [];
      const t = threads[idx];
      if (!t) return;

      const isMetric = system === 'metric';
      const pitch = 25.4 / t.tpi; // pitch in mm
      const pitchIn = 1 / t.tpi; // pitch in inches

      // Minor diameter: Major - 1.0825 * pitch
      let minorDia: number;
      let pitchDia: number;
      if (isMetric) {
        minorDia = t.major - 1.0825 * pitch;
        pitchDia = t.major - 0.6495 * pitch;
      } else {
        minorDia = t.major - 1.0825 * pitchIn;
        pitchDia = t.major - 0.6495 * pitchIn;
      }

      document.getElementById('tp2-designation')!.textContent = t.name;

      if (isMetric) {
        document.getElementById('tp2-major')!.textContent = t.major.toFixed(2) + ' mm';
        document.getElementById('tp2-minor')!.textContent = minorDia.toFixed(2) + ' mm';
        document.getElementById('tp2-pitch')!.textContent = pitch.toFixed(2) + ' mm';
        document.getElementById('tp2-pitchdia')!.textContent = pitchDia.toFixed(2) + ' mm';
      } else {
        document.getElementById('tp2-major')!.textContent = t.major.toFixed(4) + '"';
        document.getElementById('tp2-minor')!.textContent = minorDia.toFixed(4) + '"';
        document.getElementById('tp2-pitch')!.textContent = pitchIn.toFixed(4) + '" (' + pitch.toFixed(2) + ' mm)';
        document.getElementById('tp2-pitchdia')!.textContent = pitchDia.toFixed(4) + '"';
      }

      document.getElementById('tp2-tpi')!.textContent = t.tpi.toFixed(1);
      document.getElementById('tp2-tap')!.textContent = t.tapDrill;
      document.getElementById('tp2-clear')!.textContent = t.clearDrill;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.getElementById('tp2-system')!.addEventListener('change', () => { updateSizes(); calcTP2(); });

      document.querySelectorAll('.tp2-in').forEach(el => {
        el.addEventListener('input', calcTP2);
        el.addEventListener('change', calcTP2);
      });

      updateSizes();
      calcTP2();
    }, 50);
  </script>
</CalculatorLayout>
