---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Pergola Calculator - Posts, Beams, Rafters & Board Feet";
const description = "Calculate pergola lumber needs including posts, beams, rafters, slats, concrete, and total board feet for your outdoor structure.";

const relatedCalcs = [
  { name: "Post Hole Calculator", url: "/post-hole-calculator", description: "Post hole concrete." },
  { name: "Patio Calculator", url: "/patio-calculator", description: "Patio material." },
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume." },
  { name: "Rafter Calculator", url: "/rafter-calculator", description: "Rafter sizing." },
  { name: "Fire Pit Calculator", url: "/fire-pit-calculator", description: "Fire pit materials." },
  { name: "Truss Calculator", url: "/truss-calculator", description: "Roof truss design." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Pergola Calculator"
  keywords="pergola calculator, pergola lumber, pergola cost, pergola posts, pergola beams, pergola rafters, board feet"
  breadcrumbs={[{ name: "Pergola Calculator", url: "/pergola-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Pergola Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate all lumber, hardware, and concrete for building a pergola.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="grid grid-cols-2 gap-3 mb-5">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Length (ft)</label>
              <input type="number" id="pg-length" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="16" min="4" step="1">
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Width / Depth (ft)</label>
              <input type="number" id="pg-width" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="12" min="4" step="1">
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3 mb-5">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Post Spacing (ft)</label>
              <select id="pg-postspace" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
                <option value="6">6 ft</option>
                <option value="8" selected>8 ft</option>
                <option value="10">10 ft</option>
                <option value="12">12 ft</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Rafter Spacing (in OC)</label>
              <select id="pg-rafterspace" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
                <option value="12">12 inches</option>
                <option value="16" selected>16 inches</option>
                <option value="24">24 inches</option>
              </select>
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Post Height (ft)</label>
            <input type="number" id="pg-postheight" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="8" min="6" max="14" step="0.5">
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Slat Spacing (in)</label>
                <input type="number" id="pg-slatspace" class="w-full px-3 py-2 border border-border rounded-lg" value="4" min="2" max="12" step="1">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Add Top Slats?</label>
                <select id="pg-slats" class="w-full px-3 py-2 border border-border rounded-lg">
                  <option value="yes" selected>Yes</option>
                  <option value="no">No (rafters only)</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Board Feet</div>
            <div class="text-5xl font-extrabold font-mono" id="pg-bdft">0</div>
            <div class="text-sm text-blue-200 mt-1">all lumber combined</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Posts (6x6)</div>
              <div class="text-xl font-bold" id="pg-posts">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Beams (2x10)</div>
              <div class="text-xl font-bold" id="pg-beams">0</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Rafters (2x8)</div>
              <div class="text-xl font-bold" id="pg-rafters">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Slats (2x2)</div>
              <div class="text-xl font-bold" id="pg-slatcount">0</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Concrete (50 lb bags)</div>
              <div class="text-xl font-bold" id="pg-concrete">0</div>
              <div class="text-xs text-text-muted">for post footings</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Coverage Area</div>
              <div class="text-xl font-bold" id="pg-coverage">0 sq ft</div>
            </div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="pergola" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Build a Pergola - Material Calculations</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Posts:</strong> Along each long side at post spacing intervals</p>
        <p><strong>Beams:</strong> 2 per side (double beam) running the length</p>
        <p><strong>Rafters:</strong> Spanning the width at rafter spacing</p>
        <p><strong>Slats:</strong> Perpendicular to rafters for shade</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Typical Lumber Sizes</h3>
      <ul>
        <li><strong>Posts:</strong> 6x6 pressure treated or cedar</li>
        <li><strong>Beams:</strong> 2x10 or 2x12 (doubled)</li>
        <li><strong>Rafters:</strong> 2x6 or 2x8</li>
        <li><strong>Slats / Purlins:</strong> 2x2 for shade</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcPergola() {
      const length = parseFloat((document.getElementById('pg-length') as HTMLInputElement).value) || 0;
      const width = parseFloat((document.getElementById('pg-width') as HTMLInputElement).value) || 0;
      const postSpace = parseFloat((document.getElementById('pg-postspace') as HTMLSelectElement).value) || 8;
      const rafterSpaceIn = parseFloat((document.getElementById('pg-rafterspace') as HTMLSelectElement).value) || 16;
      const postHeight = parseFloat((document.getElementById('pg-postheight') as HTMLInputElement).value) || 8;
      const slatSpaceIn = parseFloat((document.getElementById('pg-slatspace') as HTMLInputElement).value) || 4;
      const addSlats = (document.getElementById('pg-slats') as HTMLSelectElement).value === 'yes';

      // Posts: along both long sides at post spacing
      const postsPerSide = Math.ceil(length / postSpace) + 1;
      const totalPosts = postsPerSide * 2;

      // Beams: 2 doubled beams running length (4 total beam pieces)
      const beamCount = 4; // double beams on each side

      // Rafters: spanning width, spaced along length
      const rafterCount = Math.ceil((length * 12) / rafterSpaceIn) + 1;

      // Slats: running along length, spaced along width (perpendicular to rafters)
      let slatCount = 0;
      if (addSlats) {
        slatCount = Math.ceil((width * 12) / slatSpaceIn) + 1;
      }

      // Board feet calculations
      // Posts: 6x6 = 36 sq in = 3 bd ft per linear ft
      const postBdFt = totalPosts * (postHeight + 3) * 3; // +3 ft for below grade

      // Beams: 2x10 = 20/12 = 1.667 bd ft per linear ft
      const beamBdFt = beamCount * (length + 2) * (2 * 10 / 12); // +2ft overhang

      // Rafters: 2x8 = 16/12 = 1.333 bd ft per linear ft
      const rafterBdFt = rafterCount * (width + 2) * (2 * 8 / 12); // +2ft overhang

      // Slats: 2x2 = 4/12 = 0.333 bd ft per linear ft
      const slatBdFt = addSlats ? slatCount * (length + 1) * (2 * 2 / 12) : 0;

      const totalBdFt = Math.ceil(postBdFt + beamBdFt + rafterBdFt + slatBdFt);

      // Concrete: ~4 bags per post (50 lb fast-set for 10" hole, 36" deep)
      const concreteBags = totalPosts * 4;

      const coverage = length * width;

      document.getElementById('pg-bdft')!.textContent = totalBdFt.toLocaleString();
      document.getElementById('pg-posts')!.textContent = String(totalPosts);
      document.getElementById('pg-beams')!.textContent = beamCount + ' pcs (' + (length + 2).toFixed(0) + "' each)";
      document.getElementById('pg-rafters')!.textContent = String(rafterCount);
      document.getElementById('pg-slatcount')!.textContent = addSlats ? String(slatCount) : '0';
      document.getElementById('pg-concrete')!.textContent = String(concreteBags);
      document.getElementById('pg-coverage')!.textContent = coverage + ' sq ft';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('#pg-length, #pg-width, #pg-postheight, #pg-slatspace').forEach(el => {
        el.addEventListener('input', calcPergola);
        el.addEventListener('change', calcPergola);
      });
      document.querySelectorAll('#pg-postspace, #pg-rafterspace, #pg-slats').forEach(el => {
        el.addEventListener('input', calcPergola);
        el.addEventListener('change', calcPergola);
      });
      calcPergola();
    }, 50);
  </script>
</CalculatorLayout>
