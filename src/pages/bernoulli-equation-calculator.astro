---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Bernoulli Equation Calculator - Pressure & Velocity";
const description = "Apply Bernoulli's equation to calculate pressure, velocity, or height changes in fluid flow. Visualize energy conservation in fluids.";
const relatedCalcs = [
  { name: "Reynolds Number Calculator", url: "/reynolds-number-calculator", description: "Flow regime." },
  { name: "Pipe Flow Calculator", url: "/pipe-flow-calculator", description: "Pipe flow rate." },
  { name: "Acceleration Calculator", url: "/acceleration-calculator", description: "Kinematics." },
  { name: "Stress & Strain Calculator", url: "/stress-strain-calculator", description: "Material stress." },
  { name: "Pressure Converter", url: "/pressure-calculator", description: "Pressure units." },
  { name: "Unit Converter", url: "/unit-converter", description: "Convert units." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Bernoulli Equation Calculator" keywords="bernoulli equation, fluid dynamics, pressure velocity, energy conservation, fluid mechanics" breadcrumbs={[{ name: "Bernoulli Equation Calculator", url: "/bernoulli-equation-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Bernoulli Equation Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Solve Bernoulli's equation: P1 + 0.5ρv1² + ρgh1 = P2 + 0.5ρv2² + ρgh2.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Solve For</label>
          <select id="be-solve" class="w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="P2" selected>Pressure at Point 2 (P2)</option>
            <option value="v2">Velocity at Point 2 (v2)</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Fluid Density ρ (kg/m³)</label>
          <input type="number" id="be-rho" class="be-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="1" min="0">
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">P1 (Pa)</label><input type="number" id="be-p1" class="be-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="100"></div>
          <div><label class="block text-xs font-medium text-text mb-1">v1 (m/s)</label><input type="number" id="be-v1" class="be-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="0.1" min="0"></div>
          <div><label class="block text-xs font-medium text-text mb-1">h1 (m)</label><input type="number" id="be-h1" class="be-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="0.1"></div>
        </div>
        <div class="grid grid-cols-3 gap-3" id="be-point2">
          <div id="be-p2-wrap"><label class="block text-xs font-medium text-text mb-1">P2 (Pa)</label><input type="number" id="be-p2" class="be-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="100"></div>
          <div id="be-v2-wrap"><label class="block text-xs font-medium text-text mb-1">v2 (m/s)</label><input type="number" id="be-v2" class="be-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="0.1" min="0"></div>
          <div><label class="block text-xs font-medium text-text mb-1">h2 (m)</label><input type="number" id="be-h2" class="be-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="0.1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="be-label">Pressure at Point 2</div>
          <div class="text-5xl font-extrabold font-mono" id="be-result">0</div>
          <div class="text-sm text-blue-200 mt-1" id="be-unit">Pa</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Pressure Difference</div><div class="text-xl font-bold" id="be-dp">—</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Velocity Change</div><div class="text-xl font-bold" id="be-dv">—</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Dynamic Pressure (Pt 1)</div><div class="text-xl font-bold" id="be-dyn1">—</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Dynamic Pressure (Pt 2)</div><div class="text-xl font-bold" id="be-dyn2">—</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Step-by-Step</h3>
          <div class="font-mono text-sm space-y-1" id="be-steps"></div>
        </div>
      </div>
      <ShareButton calculatorId="bernoulli-equation" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Bernoulli's Principle</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm">
        <p>P1 + ½ρv1² + ρgh1 = P2 + ½ρv2² + ρgh2</p>
      </div>
      <p>Bernoulli's equation states that for an inviscid, incompressible fluid in steady flow, the total mechanical energy along a streamline is constant.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcBe() {
      const solve = (document.getElementById('be-solve') as HTMLSelectElement).value;
      const rho = parseFloat((document.getElementById('be-rho') as HTMLInputElement).value) || 0;
      const P1 = parseFloat((document.getElementById('be-p1') as HTMLInputElement).value) || 0;
      const v1 = parseFloat((document.getElementById('be-v1') as HTMLInputElement).value) || 0;
      const h1 = parseFloat((document.getElementById('be-h1') as HTMLInputElement).value) || 0;
      const h2 = parseFloat((document.getElementById('be-h2') as HTMLInputElement).value) || 0;
      const g = 9.80665;
      const steps: string[] = [];
      let resultVal = 0;
      let P2 = 0, v2 = 0;
      if (solve === 'P2') {
        v2 = parseFloat((document.getElementById('be-v2') as HTMLInputElement).value) || 0;
        P2 = P1 + 0.5 * rho * (v1 * v1 - v2 * v2) + rho * g * (h1 - h2);
        resultVal = P2;
        steps.push('P2 = P1 + ½ρ(v1² − v2²) + ρg(h1 − h2)');
        steps.push(`P2 = ${P1} + 0.5×${rho}×(${v1}²−${v2}²) + ${rho}×${g.toFixed(3)}×(${h1}−${h2})`);
        steps.push(`P2 = ${P2.toFixed(2)} Pa`);
        document.getElementById('be-label')!.textContent = 'Pressure at Point 2';
        document.getElementById('be-unit')!.textContent = 'Pa';
        document.getElementById('be-p2-wrap')!.style.display = 'none';
        document.getElementById('be-v2-wrap')!.style.display = '';
      } else {
        P2 = parseFloat((document.getElementById('be-p2') as HTMLInputElement).value) || 0;
        const v2sq = v1 * v1 + 2 * (P1 - P2) / (rho || 1) + 2 * g * (h1 - h2);
        v2 = v2sq >= 0 ? Math.sqrt(v2sq) : 0;
        resultVal = v2;
        steps.push('v2² = v1² + 2(P1−P2)/ρ + 2g(h1−h2)');
        steps.push(`v2² = ${v1}² + 2×(${P1}−${P2})/${rho} + 2×${g.toFixed(3)}×(${h1}−${h2})`);
        steps.push(`v2 = ${v2.toFixed(4)} m/s`);
        document.getElementById('be-label')!.textContent = 'Velocity at Point 2';
        document.getElementById('be-unit')!.textContent = 'm/s';
        document.getElementById('be-p2-wrap')!.style.display = '';
        document.getElementById('be-v2-wrap')!.style.display = 'none';
      }
      document.getElementById('be-result')!.textContent = resultVal.toFixed(4);
      const dP = solve === 'P2' ? Math.abs(P1 - P2) : Math.abs(P1 - P2);
      document.getElementById('be-dp')!.textContent = dP.toFixed(2) + ' Pa';
      document.getElementById('be-dv')!.textContent = Math.abs(v1 - v2).toFixed(4) + ' m/s';
      const dyn1 = 0.5 * rho * v1 * v1;
      const dyn2 = 0.5 * rho * v2 * v2;
      document.getElementById('be-dyn1')!.textContent = dyn1.toFixed(2) + ' Pa';
      document.getElementById('be-dyn2')!.textContent = dyn2.toFixed(2) + ' Pa';
      document.getElementById('be-steps')!.innerHTML = steps.map(s => `<div>${s}</div>`).join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      (document.getElementById('be-rho') as HTMLInputElement).value = '998';
      (document.getElementById('be-p1') as HTMLInputElement).value = '101325';
      (document.getElementById('be-v1') as HTMLInputElement).value = '3';
      (document.getElementById('be-h1') as HTMLInputElement).value = '10';
      (document.getElementById('be-v2') as HTMLInputElement).value = '5';
      (document.getElementById('be-h2') as HTMLInputElement).value = '5';
      (document.getElementById('be-p2') as HTMLInputElement).value = '101325';
      document.querySelectorAll('.be-in').forEach(el => { el.addEventListener('input', calcBe); el.addEventListener('change', calcBe); });
      document.getElementById('be-solve')!.addEventListener('change', calcBe);
      calcBe();
    }, 50);
  </script>
</CalculatorLayout>
