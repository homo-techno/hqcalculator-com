---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Star Distance Calculator";
const description = "Calculate star distance from parallax angle in parsecs and light-years, plus stellar parallax and proper motion.";
const relatedCalcs = [
  { name: "Orbital Period", url: "/orbital-period-calculator", description: "Orbits." },
  { name: "Escape Velocity", url: "/escape-velocity-calculator", description: "Escape speed." },
  { name: "Light Intensity", url: "/light-intensity-calculator", description: "Light." },
  { name: "Length Converter", url: "/length-converter-calculator", description: "Distances." },
  { name: "Speed Calculator", url: "/speed-calculator", description: "Speed." },
  { name: "Scientific Notation", url: "/scientific-notation-calculator", description: "Notation." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Star Distance Calculator" keywords="star distance, parallax, parsec, light-year, stellar parallax, proper motion, astronomical distance" breadcrumbs={[{ name: "Star Distance", url: "/star-distance-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Star Distance Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Distance (parsecs) = 1 / parallax (arcseconds). Convert between parallax, parsecs, and light-years.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div><label class="block text-xs font-medium text-text mb-1">Input Mode</label>
          <select id="sd-mode" class="sd-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="parallax" selected>Parallax Angle (arcseconds)</option>
            <option value="parsec">Distance (parsecs)</option>
            <option value="ly">Distance (light-years)</option>
          </select>
        </div>
        <div id="sd-par-panel"><label class="block text-xs font-medium text-text mb-1">Parallax (arcseconds)</label><input type="number" id="sd-par" class="sd-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="0.7687" step="0.0001" min="0.0001"></div>
        <div id="sd-pc-panel" style="display:none;"><label class="block text-xs font-medium text-text mb-1">Distance (parsecs)</label><input type="number" id="sd-pc" class="sd-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="1.3" step="0.01" min="0.001"></div>
        <div id="sd-ly-panel" style="display:none;"><label class="block text-xs font-medium text-text mb-1">Distance (light-years)</label><input type="number" id="sd-ly" class="sd-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="4.24" step="0.01" min="0.001"></div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Proper Motion (arcsec/yr)</label><input type="number" id="sd-pm" class="sd-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3.710" step="0.001" min="0"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Radial Velocity (km/s)</label><input type="number" id="sd-rv" class="sd-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="-21.7" step="0.1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Distance</div>
          <div class="text-5xl font-extrabold font-mono" id="sd-result">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Parsecs</div><div class="text-xl font-bold font-mono" id="sd-rpc">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Light-Years</div><div class="text-xl font-bold font-mono" id="sd-rly">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Parallax</div><div class="text-xl font-bold font-mono" id="sd-rpar">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">AU Distance</div><div class="text-xl font-bold font-mono" id="sd-au">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Kilometers</div><div class="text-xl font-bold font-mono" id="sd-km">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Tangential Velocity</div><div class="text-xl font-bold font-mono" id="sd-tv">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Space Velocity</div><div class="text-xl font-bold font-mono" id="sd-sv">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="star-distance" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcSD() {
      const mode = (document.getElementById('sd-mode') as HTMLSelectElement).value;
      document.getElementById('sd-par-panel')!.style.display = mode === 'parallax' ? 'block' : 'none';
      document.getElementById('sd-pc-panel')!.style.display = mode === 'parsec' ? 'block' : 'none';
      document.getElementById('sd-ly-panel')!.style.display = mode === 'ly' ? 'block' : 'none';

      let pc = 0;
      if (mode === 'parallax') {
        const par = parseFloat((document.getElementById('sd-par') as HTMLInputElement).value) || 0.0001;
        pc = 1 / par;
      } else if (mode === 'parsec') {
        pc = parseFloat((document.getElementById('sd-pc') as HTMLInputElement).value) || 0.001;
      } else {
        const ly = parseFloat((document.getElementById('sd-ly') as HTMLInputElement).value) || 0.001;
        pc = ly / 3.26156;
      }

      const ly = pc * 3.26156;
      const par = 1 / pc;
      const au = pc * 206265;
      const km = pc * 3.0857e13;
      const pm = parseFloat((document.getElementById('sd-pm') as HTMLInputElement).value) || 0;
      const rv = parseFloat((document.getElementById('sd-rv') as HTMLInputElement).value) || 0;
      const vt = 4.74047 * pm * pc;
      const spaceVel = Math.sqrt(vt * vt + rv * rv);

      document.getElementById('sd-result')!.textContent = pc.toFixed(4) + ' pc / ' + ly.toFixed(4) + ' ly';
      document.getElementById('sd-rpc')!.textContent = pc.toFixed(4);
      document.getElementById('sd-rly')!.textContent = ly.toFixed(4);
      document.getElementById('sd-rpar')!.textContent = par.toFixed(4) + '"';
      document.getElementById('sd-au')!.textContent = au.toLocaleString(undefined, {maximumFractionDigits: 0}) + ' AU';
      document.getElementById('sd-km')!.textContent = km.toExponential(3) + ' km';
      document.getElementById('sd-tv')!.textContent = vt.toFixed(1) + ' km/s';
      document.getElementById('sd-sv')!.textContent = spaceVel.toFixed(1) + ' km/s';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.sd-in').forEach(el => { el.addEventListener('input', calcSD); el.addEventListener('change', calcSD); });
      calcSD();
    }, 50);
  </script>
</CalculatorLayout>
