---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Fertilizer Calculator - NPK Application Rate";
const description = "Calculate how much fertilizer you need based on lawn or garden area, NPK ratio, and application rate.";
const relatedCalcs = [
  { name: "Garden Spacing", url: "/garden-spacing-calculator", description: "Plan garden bed layouts." },
  { name: "Compost Calculator", url: "/compost-calculator", description: "Get compost ratio right." },
  { name: "Seed Calculator", url: "/seed-calculator", description: "Seeds needed for planting." },
  { name: "Irrigation Calculator", url: "/irrigation-calculator", description: "Plan irrigation schedules." },
  { name: "Harvest Date Calculator", url: "/harvest-date-calculator", description: "Predict harvest dates." },
  { name: "Greenhouse Calculator", url: "/greenhouse-calculator", description: "Greenhouse heating needs." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Fertilizer Calculator" keywords="fertilizer calculator, NPK ratio, fertilizer application rate, lawn fertilizer, garden fertilizer, nitrogen phosphorus potassium" breadcrumbs={[{ name: "Fertilizer", url: "/fertilizer-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Fertilizer Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate fertilizer amounts based on area, NPK ratio, and desired application rate.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Area (sq ft)</label>
            <input type="number" id="fz-area" class="fz-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5000" min="0" step="100">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Desired N Rate (lbs N / 1000 ft&sup2;)</label>
            <input type="number" id="fz-rate" class="fz-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="0" step="0.1">
          </div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">N (Nitrogen %)</label>
            <input type="number" id="fz-n" class="fz-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="0" max="100" step="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">P (Phosphorus %)</label>
            <input type="number" id="fz-p" class="fz-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="0" max="100" step="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">K (Potassium %)</label>
            <input type="number" id="fz-k" class="fz-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="0" max="100" step="1">
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Fertilizer Needed</div>
          <div class="text-5xl font-extrabold font-mono" id="fz-result">0 lbs</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Nitrogen Applied</div><div class="text-xl font-bold font-mono" id="fz-napplied">0 lbs</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Phosphorus Applied</div><div class="text-xl font-bold font-mono" id="fz-papplied">0 lbs</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Potassium Applied</div><div class="text-xl font-bold font-mono" id="fz-kapplied">0 lbs</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Per 1,000 ft&sup2;</div><div class="text-xl font-bold font-mono" id="fz-per1k">0 lbs</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Bags (50 lb)</div><div class="text-xl font-bold font-mono" id="fz-bags">0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="fertilizer" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcFZ() {
      const area = parseFloat((document.getElementById('fz-area') as HTMLInputElement).value) || 0;
      const rate = parseFloat((document.getElementById('fz-rate') as HTMLInputElement).value) || 0;
      const nPct = parseFloat((document.getElementById('fz-n') as HTMLInputElement).value) || 0;
      const pPct = parseFloat((document.getElementById('fz-p') as HTMLInputElement).value) || 0;
      const kPct = parseFloat((document.getElementById('fz-k') as HTMLInputElement).value) || 0;
      // Total nitrogen needed
      const totalN = (area / 1000) * rate;
      // Fertilizer needed = N needed / (N% / 100)
      const fertNeeded = nPct > 0 ? totalN / (nPct / 100) : 0;
      // Actual NPK applied
      const nApplied = fertNeeded * (nPct / 100);
      const pApplied = fertNeeded * (pPct / 100);
      const kApplied = fertNeeded * (kPct / 100);
      const per1k = area > 0 ? (fertNeeded / (area / 1000)) : 0;
      const bags = Math.ceil(fertNeeded / 50);
      document.getElementById('fz-result')!.textContent = fertNeeded.toFixed(1) + ' lbs';
      document.getElementById('fz-napplied')!.textContent = nApplied.toFixed(2) + ' lbs';
      document.getElementById('fz-papplied')!.textContent = pApplied.toFixed(2) + ' lbs';
      document.getElementById('fz-kapplied')!.textContent = kApplied.toFixed(2) + ' lbs';
      document.getElementById('fz-per1k')!.textContent = per1k.toFixed(1) + ' lbs';
      document.getElementById('fz-bags')!.textContent = bags.toString();
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.fz-in').forEach(el => { el.addEventListener('input', calcFZ); el.addEventListener('change', calcFZ); });
      calcFZ();
    }, 50);
  </script>
</CalculatorLayout>
