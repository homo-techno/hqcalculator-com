---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Workers Comp Calculator - Premium Estimation by Class Code";
const description = "Calculate workers compensation insurance premiums based on classification code, payroll, experience modification rate, and state factors.";
const relatedCalcs = [
  { name: "OSHA Penalty Calculator", url: "/osha-penalty-calculator", description: "OSHA violation costs." },
  { name: "Compliance Cost Calculator", url: "/compliance-cost-calculator", description: "Compliance budgeting." },
  { name: "Incorporation Calculator", url: "/incorporation-calculator", description: "Business formation." },
  { name: "Legal Fee Calculator", url: "/legal-fee-calculator", description: "Attorney costs." },
  { name: "ADA Compliance Calculator", url: "/ada-compliance-calculator", description: "ADA costs." },
  { name: "Regulatory Compliance", url: "/regulatory-compliance-calculator", description: "Regulatory budget." },
];
---

<CalculatorLayout title={title} description={description} calculatorName="Workers Comp Calculator" keywords="workers compensation calculator, workers comp premium, classification code, experience mod, payroll, insurance premium, EMR" breadcrumbs={[{ name: "Workers Comp", url: "/workers-comp-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Workers Comp Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate workers compensation insurance premiums by classification and payroll.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Industry / Classification</label>
          <select id="wkc-class" class="wkc-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="office">Office / Clerical (rate: $0.25/$100)</option>
            <option value="retail" selected>Retail / Sales (rate: $0.80/$100)</option>
            <option value="restaurant">Restaurant / Food Service (rate: $1.50/$100)</option>
            <option value="healthcare">Healthcare Workers (rate: $2.00/$100)</option>
            <option value="manufacturing">Manufacturing (rate: $3.50/$100)</option>
            <option value="construction">Construction - General (rate: $6.00/$100)</option>
            <option value="roofing">Roofing / High-risk (rate: $12.00/$100)</option>
            <option value="trucking">Trucking / Transport (rate: $8.00/$100)</option>
            <option value="landscaping">Landscaping (rate: $4.50/$100)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Annual Payroll ($)</label>
          <input type="number" id="wkc-payroll" class="wkc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="500000" min="0" step="10000">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Experience Modification Rate (EMR)</label>
          <input type="number" id="wkc-emr" class="wkc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.0" min="0.5" max="2.5" step="0.05">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">State Rate Factor</label>
          <select id="wkc-state" class="wkc-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="0.8">Below average (TX, IN, VA)</option>
            <option value="1.0" selected>Average</option>
            <option value="1.2">Above average (CA, NY, NJ)</option>
            <option value="1.5">High (AK, HI)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Number of Employees</label>
          <input type="number" id="wkc-employees" class="wkc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="1" max="10000" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Safety Program Discount</label>
          <select id="wkc-safety" class="wkc-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="0">No discount</option>
            <option value="5" selected>5% (basic safety program)</option>
            <option value="10">10% (certified safety program)</option>
            <option value="15">15% (exemplary safety record)</option>
          </select>
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Annual Premium</div>
          <div class="text-5xl font-extrabold font-mono" id="wkc-total"></div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Base Rate (per $100)</div>
            <div class="text-xl font-bold text-secondary" id="wkc-rate"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Monthly Premium</div>
            <div class="text-xl font-bold" id="wkc-monthly"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Cost Per Employee</div>
            <div class="text-xl font-bold text-orange-600" id="wkc-per-emp"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Safety Discount</div>
            <div class="text-xl font-bold text-green-600" id="wkc-discount"></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="workers-comp" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Understanding Workers Compensation Premiums</h2>
      <p>Workers comp premiums are calculated as: (Payroll / 100) x Classification Rate x Experience Mod x State Factor. The classification code rate varies dramatically by industry - office workers pay about $0.25 per $100 of payroll while roofers may pay $12+ per $100. Your Experience Modification Rate (EMR) reflects your claims history relative to similar businesses.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Reducing Your Premium</h3>
      <p>Lower your EMR by maintaining a safe workplace and minimizing claims. Implement safety programs for potential premium discounts of 5-15%. Ensure proper employee classification - misclassification can lead to audit penalties. Consider pay-as-you-go plans to improve cash flow.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const fmt = (n: number) => '$' + Math.round(n).toLocaleString();

    function calcWKC() {
      const classCode = (document.getElementById('wkc-class') as HTMLSelectElement).value;
      const payroll = parseFloat((document.getElementById('wkc-payroll') as HTMLInputElement).value) || 0;
      const emr = parseFloat((document.getElementById('wkc-emr') as HTMLInputElement).value) || 1.0;
      const stateFactor = parseFloat((document.getElementById('wkc-state') as HTMLSelectElement).value) || 1.0;
      const employees = parseInt((document.getElementById('wkc-employees') as HTMLInputElement).value) || 1;
      const safetyDiscount = parseFloat((document.getElementById('wkc-safety') as HTMLSelectElement).value) || 0;

      const classRates: Record<string, number> = {
        office: 0.25, retail: 0.80, restaurant: 1.50, healthcare: 2.00,
        manufacturing: 3.50, construction: 6.00, roofing: 12.00,
        trucking: 8.00, landscaping: 4.50
      };

      const rate = classRates[classCode] || 1.00;
      const basePremium = (payroll / 100) * rate * emr * stateFactor;
      const discount = basePremium * (safetyDiscount / 100);
      const totalPremium = basePremium - discount;
      const monthly = totalPremium / 12;
      const perEmployee = totalPremium / employees;

      document.getElementById('wkc-total')!.textContent = fmt(totalPremium);
      document.getElementById('wkc-rate')!.textContent = '$' + rate.toFixed(2);
      document.getElementById('wkc-monthly')!.textContent = fmt(monthly);
      document.getElementById('wkc-per-emp')!.textContent = fmt(perEmployee);
      document.getElementById('wkc-discount')!.textContent = '-' + fmt(discount);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.wkc-in').forEach(el => {
        el.addEventListener('input', calcWKC);
        el.addEventListener('change', calcWKC);
      });
      calcWKC();
    }, 50);
  </script>
</CalculatorLayout>
