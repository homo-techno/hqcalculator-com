---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Free Space Path Loss Calculator - FSPL Formula 2026";
const description = "Calculate free space path loss (FSPL) from frequency and distance. Essential for RF link planning, satellite communications, and wireless network design.";

const relatedCalcs = [
  { name: "Link Budget Calculator", url: "/link-budget-calculator", description: "Complete RF link budget analysis." },
  { name: "EIRP Calculator", url: "/eirp-calculator", description: "Effective isotropic radiated power." },
  { name: "Antenna Gain Calculator", url: "/antenna-gain-calculator", description: "Antenna gain from aperture." },
  { name: "Wireless Range Calculator", url: "/wireless-range-calculator", description: "WiFi/wireless range estimation." },
  { name: "Microwave Link Calculator", url: "/microwave-link-calculator", description: "Point-to-point microwave link." },
  { name: "Wavelength Frequency Calculator", url: "/wavelength-frequency-calculator", description: "Wavelength and frequency conversion." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Free Space Path Loss Calculator"
  keywords="free space path loss, FSPL calculator, path loss formula, RF propagation, signal attenuation, wireless planning"
  breadcrumbs={[{ name: "Free Space Path Loss Calculator", url: "/free-space-path-loss-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Free Space Path Loss Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate the signal attenuation over distance in free space using the Friis transmission equation.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Frequency</label>
        <div class="flex gap-2">
          <input type="number" id="fsp-freq" class="fsp-in flex-1 px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2400" step="0.1" min="0.001">
          <select id="fsp-freq-unit" class="fsp-in px-4 py-3 border border-border rounded-xl text-lg">
            <option value="MHz" selected>MHz</option>
            <option value="GHz">GHz</option>
            <option value="kHz">kHz</option>
          </select>
        </div>
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-text mb-1">Distance</label>
        <div class="flex gap-2">
          <input type="number" id="fsp-dist" class="fsp-in flex-1 px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" step="0.01" min="0.001">
          <select id="fsp-dist-unit" class="fsp-in px-4 py-3 border border-border rounded-xl text-lg">
            <option value="km" selected>km</option>
            <option value="mi">miles</option>
            <option value="m">meters</option>
            <option value="ft">feet</option>
          </select>
        </div>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm font-medium text-blue-100 mb-1">Free Space Path Loss</div>
        <div class="text-4xl font-extrabold" id="fsp-result">--</div>
        <div class="text-sm text-blue-200 mt-1">dB</div>
      </div>

      <!-- Secondary Stats -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Wavelength</div>
          <div class="text-xl font-bold text-text" id="fsp-wavelength">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Frequency (MHz)</div>
          <div class="text-xl font-bold text-text" id="fsp-freq-mhz">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Distance (km)</div>
          <div class="text-xl font-bold text-text" id="fsp-dist-km">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Loss per Decade</div>
          <div class="text-xl font-bold text-text" id="fsp-decade">--</div>
          <div class="text-xs text-text-muted">dB</div>
        </div>
      </div>

      <!-- FSPL Table -->
      <div class="bg-surface-alt rounded-xl p-4 mb-6">
        <h3 class="font-semibold text-text mb-3 text-sm">FSPL at Common Distances</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead><tr class="text-text-muted text-xs uppercase"><th class="pb-2 text-left">Distance</th><th class="pb-2 text-right">FSPL (dB)</th></tr></thead>
            <tbody id="fsp-table"></tbody>
          </table>
        </div>
      </div>

      <ShareButton calculatorId="free-space-path-loss" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Understanding Free Space Path Loss</h2>
      <p>Free Space Path Loss (FSPL) is the attenuation of radio energy between two antennas in an unobstructed line-of-sight environment. It follows the inverse-square law.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono text-sm">
        FSPL (dB) = 20*log10(d) + 20*log10(f) + 32.44
      </div>
      <p>Where d is the distance in kilometers and f is the frequency in MHz. Every doubling of distance adds approximately 6 dB of path loss, and every doubling of frequency also adds 6 dB.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcFSP() {
      const freqVal = parseFloat((document.getElementById('fsp-freq') as HTMLInputElement).value) || 1;
      const freqUnit = (document.getElementById('fsp-freq-unit') as HTMLSelectElement).value;
      const distVal = parseFloat((document.getElementById('fsp-dist') as HTMLInputElement).value) || 0.001;
      const distUnit = (document.getElementById('fsp-dist-unit') as HTMLSelectElement).value;

      let freqMHz = freqVal;
      if (freqUnit === 'GHz') freqMHz = freqVal * 1000;
      else if (freqUnit === 'kHz') freqMHz = freqVal / 1000;

      let distKm = distVal;
      if (distUnit === 'mi') distKm = distVal * 1.60934;
      else if (distUnit === 'm') distKm = distVal / 1000;
      else if (distUnit === 'ft') distKm = distVal * 0.0003048;

      const fspl = 20 * Math.log10(distKm) + 20 * Math.log10(freqMHz) + 32.44;
      const wavelength = 299792458 / (freqMHz * 1e6);

      document.getElementById('fsp-result')!.textContent = fspl.toFixed(2);
      document.getElementById('fsp-freq-mhz')!.textContent = freqMHz.toFixed(2);
      document.getElementById('fsp-dist-km')!.textContent = distKm.toFixed(4);
      document.getElementById('fsp-decade')!.textContent = '20.00';

      if (wavelength >= 1) {
        document.getElementById('fsp-wavelength')!.textContent = wavelength.toFixed(3) + ' m';
      } else if (wavelength >= 0.01) {
        document.getElementById('fsp-wavelength')!.textContent = (wavelength * 100).toFixed(2) + ' cm';
      } else {
        document.getElementById('fsp-wavelength')!.textContent = (wavelength * 1000).toFixed(2) + ' mm';
      }

      const distances = [0.1, 0.5, 1, 2, 5, 10, 20, 50, 100];
      const tbody = document.getElementById('fsp-table')!;
      tbody.innerHTML = distances.map(d => {
        const loss = 20 * Math.log10(d) + 20 * Math.log10(freqMHz) + 32.44;
        const active = Math.abs(d - distKm) < 0.01;
        return '<tr class="' + (active ? 'font-bold text-primary' : 'text-text-secondary') + ' border-b border-border/20"><td class="py-1.5">' + d + ' km</td><td class="py-1.5 text-right">' + loss.toFixed(2) + ' dB</td></tr>';
      }).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.fsp-in').forEach(el => { el.addEventListener('input', calcFSP); el.addEventListener('change', calcFSP); });
      calcFSP();
    }, 50);
  </script>
</CalculatorLayout>
