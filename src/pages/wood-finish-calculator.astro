---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Wood Finish Calculator - Stain, Poly & Oil Coverage Estimator";
const description = "Calculate wood finish coverage for stain, polyurethane, lacquer, and oil finishes. Estimate product needed by surface area and number of coats.";

const relatedCalcs = [
  { name: "Board Foot Calculator", url: "/board-foot-calculator", description: "Board feet calculator." },
  { name: "Wood Glue Calculator", url: "/wood-glue-calculator", description: "Glue coverage estimator." },
  { name: "Wood Veneer Calculator", url: "/wood-veneer-calculator", description: "Veneer coverage." },
  { name: "Paint Calculator", url: "/paint-calculator", description: "Paint coverage calculator." },
  { name: "Square Footage Calculator", url: "/square-footage-calculator", description: "Area calculator." },
  { name: "Wood Moisture Calculator", url: "/wood-moisture-calculator", description: "Moisture content." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Wood Finish Calculator"
  keywords="wood finish calculator, stain coverage, polyurethane calculator, lacquer coverage, oil finish, wood coating, finish estimator"
  breadcrumbs={[{ name: "Wood Finish Calculator", url: "/wood-finish-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Wood Finish Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate how much finish you need for stain, polyurethane, lacquer, or oil coatings.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Finish Type</label>
        <select id="wfn-type" class="wfn-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="stain" selected>Wood Stain</option>
          <option value="poly-oil">Oil-Based Polyurethane</option>
          <option value="poly-water">Water-Based Polyurethane</option>
          <option value="lacquer">Lacquer (spray)</option>
          <option value="shellac">Shellac</option>
          <option value="tung">Tung Oil</option>
          <option value="danish">Danish Oil</option>
          <option value="blo">Boiled Linseed Oil</option>
          <option value="wax">Paste Wax</option>
        </select>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Surface Area (sq ft)</label>
          <input type="number" id="wfn-area" class="wfn-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="25" min="1" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Number of Coats</label>
          <input type="number" id="wfn-coats" class="wfn-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="1" max="10" step="1">
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Wood Porosity</label>
          <select id="wfn-pore" class="wfn-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="closed">Closed Pore (Maple, Cherry)</option>
            <option value="medium" selected>Medium (Walnut, Poplar)</option>
            <option value="open">Open Pore (Oak, Ash, Mahogany)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Price per Quart ($)</label>
          <input type="number" id="wfn-price" class="wfn-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="0" step="0.50">
        </div>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Finish Needed</div>
        <div class="text-4xl font-extrabold" id="wfn-total">--</div>
        <div class="text-sm text-blue-200 mt-1" id="wfn-total-sub">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Per Coat</div>
          <div class="text-xl font-bold" id="wfn-percoat">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Coverage Rate</div>
          <div class="text-xl font-bold" id="wfn-rate">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Quarts to Buy</div>
          <div class="text-xl font-bold" id="wfn-quarts">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Estimated Cost</div>
          <div class="text-xl font-bold text-secondary" id="wfn-cost">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl text-center mb-6">
        <div class="text-xs text-text-muted uppercase">Dry Time Between Coats</div>
        <div class="text-xl font-bold" id="wfn-dry">--</div>
      </div>

      <ShareButton calculatorId="wood-finish" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Finish Coverage Guide</h2>
      <ul>
        <li><strong>Wood stain:</strong> ~200 sq ft/quart, 1-2 coats typical</li>
        <li><strong>Polyurethane:</strong> ~125 sq ft/quart, 2-3 coats recommended</li>
        <li><strong>Lacquer:</strong> ~150 sq ft/quart (spray), 3-4 coats</li>
        <li><strong>Tung/Danish oil:</strong> ~100 sq ft/quart, 2-4 coats</li>
      </ul>
      <h3 class="text-xl font-semibold text-text mt-8">Tips</h3>
      <ul>
        <li>Open-pore woods absorb significantly more finish on the first coat</li>
        <li>Always sand between coats with 220-320 grit sandpaper</li>
        <li>Raise the grain with water before applying water-based finishes</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcWFN() {
      const finishType = (document.getElementById('wfn-type') as HTMLSelectElement).value;
      const area = parseFloat((document.getElementById('wfn-area') as HTMLInputElement).value) || 0;
      const coats = parseInt((document.getElementById('wfn-coats') as HTMLInputElement).value) || 1;
      const porosity = (document.getElementById('wfn-pore') as HTMLSelectElement).value;
      const pricePerQt = parseFloat((document.getElementById('wfn-price') as HTMLInputElement).value) || 0;

      // Coverage in sq ft per quart, dry time in hours
      const finishData: Record<string, [number, number]> = {
        'stain':      [200, 2],
        'poly-oil':   [125, 8],
        'poly-water': [125, 2],
        'lacquer':    [150, 0.5],
        'shellac':    [130, 1],
        'tung':       [100, 24],
        'danish':     [110, 8],
        'blo':        [120, 24],
        'wax':        [160, 1],
      };

      const data = finishData[finishType] || finishData['stain'];
      let coveragePerQt = data[0];
      const dryTime = data[1];

      // Porosity adjustment: first coat absorbs more on open pore
      const poreMultiplier = porosity === 'open' ? 0.75 : porosity === 'closed' ? 1.15 : 1.0;

      // First coat uses more, subsequent coats use base rate
      const firstCoatCoverage = coveragePerQt * poreMultiplier;
      const laterCoatCoverage = coveragePerQt;

      let totalQts = 0;
      if (coats >= 1) totalQts += area / firstCoatCoverage;
      if (coats >= 2) totalQts += (coats - 1) * (area / laterCoatCoverage);

      const perCoatQts = area / firstCoatCoverage;
      const quartsToBuy = Math.ceil(totalQts);
      const cost = quartsToBuy * pricePerQt;
      const totalOz = totalQts * 32;

      document.getElementById('wfn-total')!.textContent = totalOz.toFixed(0) + ' oz';
      document.getElementById('wfn-total-sub')!.textContent = totalQts.toFixed(2) + ' quarts total';
      document.getElementById('wfn-percoat')!.textContent = (perCoatQts * 32).toFixed(0) + ' oz';
      document.getElementById('wfn-rate')!.textContent = Math.round(firstCoatCoverage) + ' sqft/qt';
      document.getElementById('wfn-quarts')!.textContent = quartsToBuy.toString();
      document.getElementById('wfn-cost')!.textContent = '$' + cost.toFixed(2);

      if (dryTime < 1) {
        document.getElementById('wfn-dry')!.textContent = Math.round(dryTime * 60) + ' minutes';
      } else {
        document.getElementById('wfn-dry')!.textContent = dryTime + ' hours';
      }

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.wfn-in').forEach(el => {
        el.addEventListener('input', calcWFN);
        el.addEventListener('change', calcWFN);
      });
      calcWFN();
    }, 50);
  </script>
</CalculatorLayout>
