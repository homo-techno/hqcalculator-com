---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Time Zone Calculator - World Time Converter 2026";
const description = "Convert time between any two time zones. See the time difference, business hours overlap, and plan meetings across time zones.";

const relatedCalcs = [
  { name: "Event Countdown Calculator", url: "/event-countdown-calculator", description: "Count down to events." },
  { name: "Flight Time Calculator", url: "/flight-time-calculator", description: "Estimate flight times." },
  { name: "Passport Expiration Calculator", url: "/passport-expiration-calculator", description: "Check passport validity." },
  { name: "Road Trip Calculator", url: "/road-trip-calculator", description: "Road trip costs." },
  { name: "Screen Time Calculator", url: "/screen-time-calculator", description: "Track screen time." },
  { name: "Tip Calculator", url: "/tip-percentage-calculator", description: "Calculate tips." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Time Zone Calculator"
  keywords="time zone calculator, time converter, world clock, timezone difference, business hours overlap, meeting planner"
  breadcrumbs={[{ name: "Time Zone Calculator", url: "/time-zone-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Time Zone Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert time between zones and find the best overlap for meetings and calls.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label for="tz-zone1" class="block text-sm font-medium text-text mb-1">From Time Zone</label>
          <select id="tz-zone1" class="tz-in w-full border border-border rounded-lg px-3 py-2">
            <option value="-12">UTC-12 (Baker Island)</option>
            <option value="-11">UTC-11 (Samoa)</option>
            <option value="-10">UTC-10 (Hawaii)</option>
            <option value="-9">UTC-9 (Alaska)</option>
            <option value="-8">UTC-8 (Pacific/LA)</option>
            <option value="-7">UTC-7 (Mountain/Denver)</option>
            <option value="-6">UTC-6 (Central/Chicago)</option>
            <option value="-5" selected>UTC-5 (Eastern/NYC)</option>
            <option value="-4">UTC-4 (Atlantic)</option>
            <option value="-3">UTC-3 (Buenos Aires)</option>
            <option value="-2">UTC-2 (Mid-Atlantic)</option>
            <option value="-1">UTC-1 (Azores)</option>
            <option value="0">UTC+0 (London/GMT)</option>
            <option value="1">UTC+1 (Paris/Berlin)</option>
            <option value="2">UTC+2 (Cairo/Athens)</option>
            <option value="3">UTC+3 (Moscow/Istanbul)</option>
            <option value="3.5">UTC+3:30 (Tehran)</option>
            <option value="4">UTC+4 (Dubai)</option>
            <option value="4.5">UTC+4:30 (Kabul)</option>
            <option value="5">UTC+5 (Karachi)</option>
            <option value="5.5">UTC+5:30 (Mumbai/Delhi)</option>
            <option value="5.75">UTC+5:45 (Kathmandu)</option>
            <option value="6">UTC+6 (Dhaka)</option>
            <option value="7">UTC+7 (Bangkok)</option>
            <option value="8">UTC+8 (Singapore/Beijing)</option>
            <option value="9">UTC+9 (Tokyo/Seoul)</option>
            <option value="9.5">UTC+9:30 (Adelaide)</option>
            <option value="10">UTC+10 (Sydney)</option>
            <option value="11">UTC+11 (Solomon Is.)</option>
            <option value="12">UTC+12 (Auckland)</option>
          </select>
        </div>
        <div>
          <label for="tz-time" class="block text-sm font-medium text-text mb-1">Time in Zone 1</label>
          <input type="time" id="tz-time" class="tz-in w-full border border-border rounded-lg px-3 py-2" value="09:00" />
        </div>
        <div>
          <label for="tz-zone2" class="block text-sm font-medium text-text mb-1">To Time Zone</label>
          <select id="tz-zone2" class="tz-in w-full border border-border rounded-lg px-3 py-2">
            <option value="-12">UTC-12 (Baker Island)</option>
            <option value="-11">UTC-11 (Samoa)</option>
            <option value="-10">UTC-10 (Hawaii)</option>
            <option value="-9">UTC-9 (Alaska)</option>
            <option value="-8">UTC-8 (Pacific/LA)</option>
            <option value="-7">UTC-7 (Mountain/Denver)</option>
            <option value="-6">UTC-6 (Central/Chicago)</option>
            <option value="-5">UTC-5 (Eastern/NYC)</option>
            <option value="-4">UTC-4 (Atlantic)</option>
            <option value="-3">UTC-3 (Buenos Aires)</option>
            <option value="-2">UTC-2 (Mid-Atlantic)</option>
            <option value="-1">UTC-1 (Azores)</option>
            <option value="0" selected>UTC+0 (London/GMT)</option>
            <option value="1">UTC+1 (Paris/Berlin)</option>
            <option value="2">UTC+2 (Cairo/Athens)</option>
            <option value="3">UTC+3 (Moscow/Istanbul)</option>
            <option value="3.5">UTC+3:30 (Tehran)</option>
            <option value="4">UTC+4 (Dubai)</option>
            <option value="4.5">UTC+4:30 (Kabul)</option>
            <option value="5">UTC+5 (Karachi)</option>
            <option value="5.5">UTC+5:30 (Mumbai/Delhi)</option>
            <option value="5.75">UTC+5:45 (Kathmandu)</option>
            <option value="6">UTC+6 (Dhaka)</option>
            <option value="7">UTC+7 (Bangkok)</option>
            <option value="8">UTC+8 (Singapore/Beijing)</option>
            <option value="9">UTC+9 (Tokyo/Seoul)</option>
            <option value="9.5">UTC+9:30 (Adelaide)</option>
            <option value="10">UTC+10 (Sydney)</option>
            <option value="11">UTC+11 (Solomon Is.)</option>
            <option value="12">UTC+12 (Auckland)</option>
          </select>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Time in Zone 2</div>
          <div class="text-5xl font-extrabold font-mono" id="tz-result">--:--</div>
          <div class="text-sm text-blue-200 mt-1" id="tz-day-note"></div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Time Difference</div>
            <div class="text-xl font-bold" id="tz-diff">0 hours</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Business Overlap</div>
            <div class="text-xl font-bold" id="tz-overlap">0 hours</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="text-sm font-bold text-text mb-2">Business Hours Overlap (9 AM - 5 PM)</h3>
          <div class="text-sm text-text-secondary" id="tz-overlap-detail">--</div>
        </div>
      </div>

      <ShareButton calculatorId="time-zone" />
      <FeedbackWidget />
    </div>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcTZ() {
      const zone1 = parseFloat((document.getElementById('tz-zone1') as HTMLSelectElement).value) || 0;
      const zone2 = parseFloat((document.getElementById('tz-zone2') as HTMLSelectElement).value) || 0;
      const timeStr = (document.getElementById('tz-time') as HTMLInputElement).value;

      if (!timeStr) return;

      const [h1, m1] = timeStr.split(':').map(Number);
      const totalMinutes1 = h1 * 60 + m1;

      const diffHours = zone2 - zone1;
      const diffMinutes = diffHours * 60;
      let totalMinutes2 = totalMinutes1 + diffMinutes;

      let dayShift = '';
      if (totalMinutes2 >= 1440) {
        totalMinutes2 -= 1440;
        dayShift = '(next day)';
      } else if (totalMinutes2 < 0) {
        totalMinutes2 += 1440;
        dayShift = '(previous day)';
      }

      const h2 = Math.floor(totalMinutes2 / 60);
      const m2 = totalMinutes2 % 60;
      const pad = (n: number) => String(Math.floor(n)).padStart(2, '0');

      // Format as 12-hour time
      const period2 = h2 >= 12 ? 'PM' : 'AM';
      const displayH2 = h2 === 0 ? 12 : h2 > 12 ? h2 - 12 : h2;

      (document.getElementById('tz-result') as HTMLElement).textContent = `${displayH2}:${pad(m2)} ${period2}`;
      (document.getElementById('tz-day-note') as HTMLElement).textContent = dayShift;

      // Difference display
      const absDiff = Math.abs(diffHours);
      const diffWhole = Math.floor(absDiff);
      const diffFrac = absDiff - diffWhole;
      let diffLabel = '';
      if (diffFrac === 0) {
        diffLabel = `${diffWhole} hour${diffWhole !== 1 ? 's' : ''}`;
      } else {
        diffLabel = `${diffWhole}h ${Math.round(diffFrac * 60)}m`;
      }
      if (diffHours > 0) diffLabel += ' ahead';
      else if (diffHours < 0) diffLabel += ' behind';

      (document.getElementById('tz-diff') as HTMLElement).textContent = diffLabel;

      // Business hours overlap (9:00-17:00 in each zone)
      const biz1Start = 9 * 60; // 9 AM zone 1
      const biz1End = 17 * 60; // 5 PM zone 1
      // Convert zone 1 biz hours to zone 2 time
      const biz1StartInZ2 = biz1Start + diffMinutes;
      const biz1EndInZ2 = biz1End + diffMinutes;

      const biz2Start = 9 * 60;
      const biz2End = 17 * 60;

      const overlapStart = Math.max(biz1StartInZ2, biz2Start);
      const overlapEnd = Math.min(biz1EndInZ2, biz2End);
      const overlapMinutes = Math.max(0, overlapEnd - overlapStart);
      const overlapHours = overlapMinutes / 60;

      (document.getElementById('tz-overlap') as HTMLElement).textContent = overlapHours.toFixed(1) + ' hours';

      const detailEl = document.getElementById('tz-overlap-detail') as HTMLElement;
      if (overlapMinutes > 0) {
        const formatTime = (mins: number) => {
          let m = ((mins % 1440) + 1440) % 1440;
          const hh = Math.floor(m / 60);
          const mm = m % 60;
          const period = hh >= 12 ? 'PM' : 'AM';
          const dh = hh === 0 ? 12 : hh > 12 ? hh - 12 : hh;
          return `${dh}:${pad(mm)} ${period}`;
        };
        // Show overlap in zone 2 local time
        detailEl.textContent = `Overlap window in Zone 2: ${formatTime(overlapStart)} - ${formatTime(overlapEnd)} (${overlapHours.toFixed(1)} hours)`;
      } else {
        detailEl.textContent = 'No business hours overlap. Consider early morning or late evening meetings.';
      }

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.tz-in').forEach(el => {
        el.addEventListener('input', calcTZ);
        el.addEventListener('change', calcTZ);
      });
      calcTZ();
    }, 50);
  </script>
</CalculatorLayout>
