---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Roman Numeral Converter - Convert Roman to Decimal & Back";
const description = "Convert between Roman numerals and decimal numbers. Supports values 1 to 3,999,999. Includes Roman numeral rules and reference chart.";

const relatedCalcs = [
  { name: "Binary Calculator", url: "/binary-calculator", description: "Binary math." },
  { name: "Hex Calculator", url: "/hex-calculator", description: "Hexadecimal." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Average Calculator", url: "/average-calculator", description: "Mean & median." },
  { name: "Date Calculator", url: "/date-calculator", description: "Date math." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Roman Numeral Converter"
  keywords="roman numeral converter, roman to decimal, decimal to roman, roman numeral chart, roman numbers"
  breadcrumbs={[{ name: "Roman Numeral Converter", url: "/roman-numeral-converter" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Roman Numeral Converter</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert between Roman numerals and decimal numbers instantly.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Decimal to Roman -->
      <h3 class="font-semibold text-text mb-3">Decimal → Roman</h3>
      <div class="mb-6">
        <input type="number" id="rn-dec" class="w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="2024" min="1" max="3999999" step="1">
        <div class="p-4 bg-primary rounded-2xl text-white text-center mt-3">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Roman Numeral</div>
          <div class="text-3xl sm:text-4xl font-extrabold font-serif tracking-wider" id="rn-roman">MMXXIV</div>
        </div>
      </div>

      <!-- Roman to Decimal -->
      <h3 class="font-semibold text-text mb-3">Roman → Decimal</h3>
      <div class="mb-6">
        <input type="text" id="rn-input" class="w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold text-center font-serif uppercase tracking-wider" value="MMXXIV" placeholder="Enter Roman numeral">
        <div class="p-4 bg-surface-alt rounded-xl text-center mt-3">
          <div class="text-xs text-text-muted uppercase tracking-wide mb-1">Decimal Value</div>
          <div class="text-3xl font-extrabold" id="rn-decimal">2,024</div>
          <div class="text-sm text-text-muted mt-1" id="rn-validity"></div>
        </div>
      </div>

      <!-- Quick buttons -->
      <div class="flex flex-wrap gap-2 mb-6">
        <button class="rn-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-val="1">1</button>
        <button class="rn-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-val="42">42</button>
        <button class="rn-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-val="100">100</button>
        <button class="rn-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-val="500">500</button>
        <button class="rn-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-val="1000">1000</button>
        <button class="rn-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-val="2024">2024</button>
        <button class="rn-quick px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-val="3999">3999</button>
      </div>

      <!-- Breakdown -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-2">Step-by-Step Breakdown</h3>
        <div class="space-y-1 text-sm font-mono" id="rn-breakdown"></div>
      </div>

      <!-- Reference chart -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-3">Roman Numeral Chart</h3>
        <div class="grid grid-cols-4 sm:grid-cols-7 gap-2 text-center">
          <div class="p-2 bg-white rounded-lg">
            <div class="text-lg font-bold font-serif">I</div>
            <div class="text-xs text-text-muted">1</div>
          </div>
          <div class="p-2 bg-white rounded-lg">
            <div class="text-lg font-bold font-serif">V</div>
            <div class="text-xs text-text-muted">5</div>
          </div>
          <div class="p-2 bg-white rounded-lg">
            <div class="text-lg font-bold font-serif">X</div>
            <div class="text-xs text-text-muted">10</div>
          </div>
          <div class="p-2 bg-white rounded-lg">
            <div class="text-lg font-bold font-serif">L</div>
            <div class="text-xs text-text-muted">50</div>
          </div>
          <div class="p-2 bg-white rounded-lg">
            <div class="text-lg font-bold font-serif">C</div>
            <div class="text-xs text-text-muted">100</div>
          </div>
          <div class="p-2 bg-white rounded-lg">
            <div class="text-lg font-bold font-serif">D</div>
            <div class="text-xs text-text-muted">500</div>
          </div>
          <div class="p-2 bg-white rounded-lg">
            <div class="text-lg font-bold font-serif">M</div>
            <div class="text-xs text-text-muted">1000</div>
          </div>
        </div>
      </div>

      <!-- 1-100 reference -->
      <details class="mb-6">
        <summary class="cursor-pointer font-semibold text-sm text-text hover:text-primary">1–100 Reference Table</summary>
        <div class="grid grid-cols-5 sm:grid-cols-10 gap-1 mt-3 text-xs text-center" id="rn-table"></div>
      </details>

      <ShareButton calculatorId="roman-numeral" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">How Roman Numerals Work</h2>
      <p>Roman numerals use seven symbols: I (1), V (5), X (10), L (50), C (100), D (500), M (1000). Numbers are formed by combining symbols from largest to smallest, left to right.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Subtractive Notation</h3>
      <p>When a smaller value precedes a larger one, it's subtracted:</p>
      <ul>
        <li><strong>IV = 4</strong> (5 − 1), <strong>IX = 9</strong> (10 − 1)</li>
        <li><strong>XL = 40</strong> (50 − 10), <strong>XC = 90</strong> (100 − 10)</li>
        <li><strong>CD = 400</strong> (500 − 100), <strong>CM = 900</strong> (1000 − 100)</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What's the largest Roman numeral?</strong> In standard notation, 3,999 (MMMCMXCIX). With a vinculum (overline = ×1000), numbers up to 3,999,999 are possible.</p>
      <p><strong>Is there a zero in Roman numerals?</strong> No, the Romans had no symbol for zero. The concept of zero came later from Indian/Arabic mathematics.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const romanValues: [string, number][] = [
      ['M', 1000], ['CM', 900], ['D', 500], ['CD', 400],
      ['C', 100], ['XC', 90], ['L', 50], ['XL', 40],
      ['X', 10], ['IX', 9], ['V', 5], ['IV', 4], ['I', 1]
    ];

    function decToRoman(num: number): string {
      if (num < 1 || num > 3999) return num < 1 ? '' : 'Too large (max 3999)';
      let result = '';
      let remaining = num;
      for (const [symbol, value] of romanValues) {
        while (remaining >= value) {
          result += symbol;
          remaining -= value;
        }
      }
      return result;
    }

    function romanToDec(str: string): number {
      const values: Record<string, number> = { I: 1, V: 5, X: 10, L: 50, C: 100, D: 500, M: 1000 };
      const s = str.toUpperCase().replace(/[^IVXLCDM]/g, '');
      let total = 0;
      for (let i = 0; i < s.length; i++) {
        const curr = values[s[i]] || 0;
        const next = values[s[i + 1]] || 0;
        if (curr < next) {
          total -= curr;
        } else {
          total += curr;
        }
      }
      return total;
    }

    function getBreakdown(num: number): string[] {
      if (num < 1 || num > 3999) return [];
      const parts: string[] = [];
      let remaining = num;
      for (const [symbol, value] of romanValues) {
        while (remaining >= value) {
          parts.push(`${symbol} = ${value}`);
          remaining -= value;
        }
      }
      return parts;
    }

    function updateDecToRoman() {
      const num = parseInt((document.getElementById('rn-dec') as HTMLInputElement).value) || 0;
      const roman = decToRoman(num);
      document.getElementById('rn-roman')!.textContent = roman || '—';

      const breakdown = getBreakdown(num);
      document.getElementById('rn-breakdown')!.innerHTML = breakdown.length > 0
        ? breakdown.map(p => `<div class="text-text-secondary">${p}</div>`).join('') +
          `<div class="pt-1 border-t border-border/50 font-bold">${breakdown.map(p => p.split(' = ')[0]).join(' + ')} = ${roman}</div>`
        : '<div class="text-text-muted">Enter a number 1–3999</div>';
    }

    function updateRomanToDec() {
      const input = (document.getElementById('rn-input') as HTMLInputElement).value.trim();
      if (!input) {
        document.getElementById('rn-decimal')!.textContent = '—';
        document.getElementById('rn-validity')!.textContent = '';
        return;
      }

      const cleaned = input.toUpperCase().replace(/[^IVXLCDM]/g, '');
      if (cleaned !== input.toUpperCase()) {
        document.getElementById('rn-validity')!.textContent = 'Contains invalid characters';
        document.getElementById('rn-validity')!.className = 'text-sm text-danger mt-1';
      } else {
        const dec = romanToDec(cleaned);
        const backToRoman = decToRoman(dec);
        if (backToRoman === cleaned && dec > 0) {
          document.getElementById('rn-validity')!.textContent = 'Valid Roman numeral';
          document.getElementById('rn-validity')!.className = 'text-sm text-secondary mt-1';
        } else {
          document.getElementById('rn-validity')!.textContent = dec > 0 ? `Non-standard form (standard: ${backToRoman})` : 'Invalid';
          document.getElementById('rn-validity')!.className = 'text-sm text-yellow-600 mt-1';
        }
      }

      const dec = romanToDec(input);
      document.getElementById('rn-decimal')!.textContent = dec > 0 ? dec.toLocaleString() : '—';
    }

    function buildTable() {
      let html = '';
      for (let i = 1; i <= 100; i++) {
        html += `<div class="p-1 bg-white rounded"><div class="font-bold font-serif text-xs">${decToRoman(i)}</div><div class="text-[10px] text-text-muted">${i}</div></div>`;
      }
      document.getElementById('rn-table')!.innerHTML = html;
    }

    setTimeout(() => {
      document.getElementById('rn-dec')!.addEventListener('input', updateDecToRoman);
      document.getElementById('rn-input')!.addEventListener('input', updateRomanToDec);

      document.querySelectorAll('.rn-quick').forEach(btn => {
        btn.addEventListener('click', () => {
          const val = (btn as HTMLElement).dataset.val || '1';
          (document.getElementById('rn-dec') as HTMLInputElement).value = val;
          updateDecToRoman();
        });
      });

      updateDecToRoman();
      updateRomanToDec();
      buildTable();
    }, 50);
  </script>
</CalculatorLayout>
