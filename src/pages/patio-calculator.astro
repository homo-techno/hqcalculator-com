---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Patio Calculator - Material, Base, Sand & Edging Estimator";
const description = "Calculate patio materials for concrete, pavers, or flagstone. Get square footage, material quantity, gravel base tons, sand, and edging needs.";

const relatedCalcs = [
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume." },
  { name: "Asphalt Calculator", url: "/asphalt-calculator", description: "Asphalt tonnage." },
  { name: "Post Hole Calculator", url: "/post-hole-calculator", description: "Post hole concrete." },
  { name: "Fire Pit Calculator", url: "/fire-pit-calculator", description: "Fire pit materials." },
  { name: "Pergola Calculator", url: "/pergola-calculator", description: "Pergola lumber." },
  { name: "Excavation Calculator", url: "/excavation-calculator", description: "Dig volume." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Patio Calculator"
  keywords="patio calculator, paver calculator, patio cost, patio materials, gravel base, patio sand, patio edging"
  breadcrumbs={[{ name: "Patio Calculator", url: "/patio-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Patio Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate materials for your patio project including pavers, base, sand, and edging.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="grid grid-cols-2 gap-3 mb-5">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Length (ft)</label>
              <input type="number" id="pa2-length" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="16" min="1" step="0.5">
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Width (ft)</label>
              <input type="number" id="pa2-width" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="12" min="1" step="0.5">
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Material</label>
            <select id="pa2-material" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
              <option value="concrete">Poured Concrete (4" slab)</option>
              <option value="pavers" selected>Pavers (4.5 per sq ft standard)</option>
              <option value="flagstone">Flagstone / Natural Stone</option>
            </select>
          </div>

          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Gravel Base Depth (inches)</label>
            <select id="pa2-base" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
              <option value="4" selected>4 inches (standard)</option>
              <option value="6">6 inches (recommended)</option>
              <option value="8">8 inches (heavy duty)</option>
              <option value="12">12 inches (poor soil)</option>
            </select>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Waste Factor (%)</label>
              <input type="number" id="pa2-waste" class="w-full px-3 py-2 border border-border rounded-lg" value="10" min="5" max="25" step="1">
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Patio Area</div>
            <div class="text-5xl font-extrabold font-mono" id="pa2-area">0</div>
            <div class="text-sm text-blue-200 mt-1">square feet</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Material Quantity</div>
              <div class="text-xl font-bold" id="pa2-matqty">0</div>
              <div class="text-xs text-text-muted" id="pa2-matunit">pieces</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Gravel Base</div>
              <div class="text-xl font-bold" id="pa2-gravel">0 tons</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Bedding Sand</div>
              <div class="text-xl font-bold" id="pa2-sand">0 tons</div>
              <div class="text-xs text-text-muted">1" layer</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Edging / Border</div>
              <div class="text-xl font-bold" id="pa2-edging">0 ft</div>
              <div class="text-xs text-text-muted">perimeter</div>
            </div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Polymeric Sand</div>
            <div class="text-xl font-bold" id="pa2-polysand">0 bags</div>
            <div class="text-xs text-text-muted">50 lb bags for joints</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="patio" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Patio Materials</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Pavers:</strong> Area (sq ft) x 4.5 pavers/sf x (1 + Waste%)</p>
        <p><strong>Gravel:</strong> Area x Depth (ft) x 1.4 tons/cu yd / 27</p>
        <p><strong>Sand:</strong> Area x 1/12 ft x 1.35 tons/cu yd / 27</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Patio Base Layers</h3>
      <ul>
        <li><strong>Gravel base:</strong> 4-6" of compacted crushed stone (3/4" minus)</li>
        <li><strong>Bedding sand:</strong> 1" of coarse concrete sand, screeded level</li>
        <li><strong>Pavers:</strong> Set on sand, tap level with rubber mallet</li>
        <li><strong>Joint sand:</strong> Polymeric sand swept into joints and activated with water</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcPatio() {
      const length = parseFloat((document.getElementById('pa2-length') as HTMLInputElement).value) || 0;
      const width = parseFloat((document.getElementById('pa2-width') as HTMLInputElement).value) || 0;
      const material = (document.getElementById('pa2-material') as HTMLSelectElement).value;
      const baseIn = parseFloat((document.getElementById('pa2-base') as HTMLSelectElement).value) || 4;
      const waste = (parseFloat((document.getElementById('pa2-waste') as HTMLInputElement).value) || 10) / 100;

      const area = length * width;
      const areaWithWaste = area * (1 + waste);
      const perimeter = 2 * (length + width);

      let matQty = 0;
      let matUnit = 'pieces';
      if (material === 'concrete') {
        // Cubic yards of concrete (4" slab)
        matQty = parseFloat((areaWithWaste * (4 / 12) / 27).toFixed(1));
        matUnit = 'cubic yards';
      } else if (material === 'pavers') {
        // 4.5 standard pavers per sq ft
        matQty = Math.ceil(areaWithWaste * 4.5);
        matUnit = 'pavers';
      } else {
        // Flagstone: ~1 ton per 70 sq ft at 1.5" thick
        matQty = parseFloat((areaWithWaste / 70).toFixed(1));
        matUnit = 'tons flagstone';
      }

      // Gravel: area x depth in feet / 27 = cu yd, x 1.4 tons/cu yd
      const gravelCuYd = area * (baseIn / 12) / 27;
      const gravelTons = gravelCuYd * 1.4;

      // Bedding sand: 1" depth
      const sandCuYd = area * (1 / 12) / 27;
      const sandTons = sandCuYd * 1.35;

      // Polymeric sand: ~1 bag per 40-60 sq ft depending on joint width
      const polySandBags = material !== 'concrete' ? Math.ceil(area / 50) : 0;

      document.getElementById('pa2-area')!.textContent = area.toLocaleString();
      document.getElementById('pa2-matqty')!.textContent = typeof matQty === 'number' ? matQty.toLocaleString() : String(matQty);
      document.getElementById('pa2-matunit')!.textContent = matUnit;
      document.getElementById('pa2-gravel')!.textContent = gravelTons.toFixed(1) + ' tons';
      document.getElementById('pa2-sand')!.textContent = material !== 'concrete' ? sandTons.toFixed(1) + ' tons' : 'N/A';
      document.getElementById('pa2-edging')!.textContent = Math.ceil(perimeter) + ' ft';
      document.getElementById('pa2-polysand')!.textContent = polySandBags + ' bags';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('#pa2-length, #pa2-width, #pa2-waste').forEach(el => {
        el.addEventListener('input', calcPatio);
        el.addEventListener('change', calcPatio);
      });
      document.querySelectorAll('#pa2-material, #pa2-base').forEach(el => {
        el.addEventListener('input', calcPatio);
        el.addEventListener('change', calcPatio);
      });
      calcPatio();
    }, 50);
  </script>
</CalculatorLayout>
