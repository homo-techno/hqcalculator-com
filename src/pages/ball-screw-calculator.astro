---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Ball Screw Calculator - Lead, Speed, Thrust & Critical Speed";
const description = "Calculate ball screw lead, linear speed, thrust force, driving torque, and critical speed. Size ball screws for CNC, robotics, and linear motion applications.";
const relatedCalcs = [
  { name: "Linear Actuator Calculator", url: "/linear-actuator-calculator", description: "Calculate linear actuator force and stroke." },
  { name: "Servo Motor Calculator", url: "/servo-motor-calculator", description: "Size servo motors for ball screw drives." },
  { name: "Stepper Driver Calculator", url: "/stepper-driver-calculator", description: "Configure stepper motor driver settings." },
  { name: "Encoder Resolution Calculator", url: "/encoder-resolution-calculator", description: "Calculate encoder resolution for positioning." },
  { name: "Motion Profile Calculator", url: "/motion-profile-calculator", description: "Design trapezoidal motion profiles." },
  { name: "Gearbox Ratio Calculator", url: "/gearbox-ratio-calculator", description: "Select gearbox ratio for motor matching." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Ball Screw Calculator" keywords="ball screw calculator, lead screw, ball screw lead, thrust force, critical speed, driving torque, ball screw sizing, CNC ball screw" breadcrumbs={[{ name: "Ball Screw Calculator", url: "/ball-screw-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Ball Screw Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate ball screw performance: linear speed from RPM, driving torque, thrust capacity, and critical speed for your application.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-6">
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Ball Screw Lead (mm)</label>
          <input type="number" id="bs2-lead" class="bs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="1" step="1">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Screw Shaft Diameter (mm)</label>
          <input type="number" id="bs2-shaft-dia" class="bs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="5" step="1">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Unsupported Length (mm)</label>
          <input type="number" id="bs2-length" class="bs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="500" min="50" step="50">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Motor Speed (RPM)</label>
          <input type="number" id="bs2-rpm" class="bs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1500" min="1" step="100">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Axial Load (N)</label>
          <input type="number" id="bs2-load" class="bs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="500" min="0" step="50">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Efficiency (%)</label>
          <input type="number" id="bs2-eff" class="bs2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="90" min="50" max="98" step="1">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">End Support</label>
          <select id="bs2-support" class="bs2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="fixed-free">Fixed-Free (f=3.4)</option>
            <option value="fixed-supported">Fixed-Supported (f=15.1)</option>
            <option value="fixed-fixed" selected>Fixed-Fixed (f=21.9)</option>
            <option value="supported-supported">Supported-Supported (f=9.7)</option>
          </select>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm font-medium opacity-80 mb-1">Linear Speed</div>
          <div id="bs2-result-speed" class="text-3xl sm:text-4xl font-extrabold">--</div>
          <div class="text-sm opacity-80 mt-1">mm/s</div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary mb-1">Driving Torque</div>
            <div id="bs2-torque" class="text-lg font-bold text-text">--</div>
            <div class="text-xs text-text-secondary">N*m</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary mb-1">Motor Power</div>
            <div id="bs2-power" class="text-lg font-bold text-text">--</div>
            <div class="text-xs text-text-secondary">W</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary mb-1">Critical Speed</div>
            <div id="bs2-critical" class="text-lg font-bold text-text">--</div>
            <div class="text-xs text-text-secondary">RPM</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary mb-1">Speed Safety Factor</div>
            <div id="bs2-speed-safety" class="text-lg font-bold text-text">--</div>
            <div class="text-xs text-text-secondary">critical/operating</div>
          </div>
        </div>

        <ShareButton />
        <FeedbackWidget />
      </div>
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcBS2() {
      const lead = parseFloat((document.getElementById('bs2-lead') as HTMLInputElement).value) || 10;
      const shaftDia = parseFloat((document.getElementById('bs2-shaft-dia') as HTMLInputElement).value) || 20;
      const length = parseFloat((document.getElementById('bs2-length') as HTMLInputElement).value) || 500;
      const rpm = parseFloat((document.getElementById('bs2-rpm') as HTMLInputElement).value) || 1500;
      const load = parseFloat((document.getElementById('bs2-load') as HTMLInputElement).value) || 500;
      const eff = parseFloat((document.getElementById('bs2-eff') as HTMLInputElement).value) / 100 || 0.9;
      const support = (document.getElementById('bs2-support') as HTMLSelectElement).value;

      let fFactor: number;
      if (support === 'fixed-free') fFactor = 3.4;
      else if (support === 'fixed-supported') fFactor = 15.1;
      else if (support === 'fixed-fixed') fFactor = 21.9;
      else fFactor = 9.7;

      const linearSpeed = (lead * rpm) / 60;
      const drivingTorque = (load * lead) / (2 * Math.PI * 1000 * eff);
      const power = drivingTorque * rpm * 2 * Math.PI / 60;

      const rootDia = shaftDia * 0.8;
      const criticalSpeed = fFactor * 1e7 * rootDia / (length * length);
      const speedSafety = criticalSpeed / rpm;

      document.getElementById('bs2-result-speed')!.textContent = linearSpeed.toFixed(1);
      document.getElementById('bs2-torque')!.textContent = drivingTorque.toFixed(4);
      document.getElementById('bs2-power')!.textContent = power.toFixed(1);
      document.getElementById('bs2-critical')!.textContent = criticalSpeed.toFixed(0);
      document.getElementById('bs2-speed-safety')!.textContent = speedSafety.toFixed(1) + 'x';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.bs2-in').forEach(el => { el.addEventListener('input', calcBS2); el.addEventListener('change', calcBS2); });
      calcBS2();
    }, 50);
  </script>
</CalculatorLayout>
