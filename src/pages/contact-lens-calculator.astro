---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Contact Lens Calculator";
const description = "Calculate annual contact lens cost by type (daily, biweekly, monthly), solution expenses, replacement schedule, and compare with glasses.";
const relatedCalcs = [
  { name: "Glasses Cost Calculator", url: "/glasses-cost-calculator", description: "Total eyeglasses cost estimate." },
  { name: "Lens Thickness Calculator", url: "/lens-thickness-calculator", description: "Lens thickness by index." },
  { name: "Eye Exam Calculator", url: "/eye-exam-calculator", description: "Eye exam cost by type." },
  { name: "Pupillary Distance Calculator", url: "/pupillary-distance-calculator", description: "PD measurement guide." },
  { name: "Vision Prescription Calculator", url: "/vision-prescription-calculator", description: "Understand your prescription." },
  { name: "Health Insurance Calculator", url: "/health-insurance-calculator", description: "Health plan cost comparison." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Contact Lens Calculator" keywords="contact lens cost, daily contacts, monthly contacts, contact lens calculator, contacts vs glasses cost" breadcrumbs={[{ name: "Contact Lens", url: "/contact-lens-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Contact Lens Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate annual contact lens costs and compare with glasses over time.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Lens Replacement Schedule</label>
            <select id="cl3-type" class="cl3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="daily" selected>Daily Disposable</option>
              <option value="biweekly">Biweekly (2-week)</option>
              <option value="monthly">Monthly</option>
              <option value="extended">Extended Wear (up to 30 days)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Lens Category</label>
            <select id="cl3-cat" class="cl3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="spherical" selected>Spherical (standard)</option>
              <option value="toric">Toric (astigmatism)</option>
              <option value="multifocal">Multifocal</option>
              <option value="color">Colored</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Brand Tier</label>
            <select id="cl3-brand" class="cl3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="budget">Budget / Store Brand</option>
              <option value="mid" selected>Mid-Range</option>
              <option value="premium">Premium Brand</option>
            </select>
          </div>
          <div><label class="block text-xs font-medium text-text mb-1">Days Worn per Week</label><input type="number" id="cl3-days" class="cl3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="7" min="1" max="7" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Vision Insurance Contact Allowance ($)</label><input type="number" id="cl3-ins" class="cl3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="150" min="0" max="500" step="10"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Contact Lens Exam Extra ($)</label><input type="number" id="cl3-exam" class="cl3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="50" min="0" max="200" step="10"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Annual Contact Lens Cost</div>
          <div class="text-5xl font-extrabold font-mono" id="cl3-annual">$0</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Lenses / Year</div><div class="text-xl font-bold font-mono" id="cl3-count">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Solution Cost</div><div class="text-xl font-bold font-mono" id="cl3-sol">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Out of Pocket</div><div class="text-xl font-bold font-mono" id="cl3-oop">$0</div></div>
        </div>
        <div class="p-3 bg-blue-50 rounded-xl text-center text-xs font-semibold text-blue-900 uppercase tracking-wide mb-1">5-Year Comparison</div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">5-Year Contacts</div><div class="text-xl font-bold font-mono" id="cl3-five">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">5-Year Glasses (est.)</div><div class="text-xl font-bold font-mono" id="cl3-glasses">$0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="contact-lens" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcCL3() {
      const type = (document.getElementById('cl3-type') as HTMLSelectElement).value;
      const cat = (document.getElementById('cl3-cat') as HTMLSelectElement).value;
      const brand = (document.getElementById('cl3-brand') as HTMLSelectElement).value;
      const daysPerWeek = parseFloat((document.getElementById('cl3-days') as HTMLInputElement).value) || 7;
      const insAllow = parseFloat((document.getElementById('cl3-ins') as HTMLInputElement).value) || 0;
      const examExtra = parseFloat((document.getElementById('cl3-exam') as HTMLInputElement).value) || 0;

      // Cost per lens (for a pair)
      const basePrices: Record<string, Record<string, number>> = {
        daily:    { budget: 0.55, mid: 0.85, premium: 1.20 },
        biweekly: { budget: 3.50, mid: 5.50, premium: 8.00 },
        monthly:  { budget: 5.00, mid: 8.00, premium: 12.00 },
        extended: { budget: 6.00, mid: 10.00, premium: 15.00 }
      };

      const catMult: Record<string, number> = { spherical: 1.0, toric: 1.35, multifocal: 1.50, color: 1.20 };

      const pricePerPair = basePrices[type][brand] * (catMult[cat] || 1.0);

      // Number of pairs per year
      let pairsPerYear = 0;
      const weeksPerYear = 52;
      if (type === 'daily') {
        pairsPerYear = Math.round(daysPerWeek * weeksPerYear);
      } else if (type === 'biweekly') {
        pairsPerYear = Math.ceil(weeksPerYear / 2);
      } else if (type === 'monthly') {
        pairsPerYear = 12;
      } else {
        pairsPerYear = 12; // extended replaced monthly
      }

      // Solution cost (not needed for daily)
      let solutionCost = 0;
      if (type !== 'daily') {
        solutionCost = 12 * 10; // ~$10/month for solution
      }

      const lensCost = Math.round(pairsPerYear * pricePerPair * 2); // *2 for both eyes
      const annualTotal = lensCost + solutionCost + examExtra;
      const oop = Math.max(0, annualTotal - insAllow);

      // 5-year comparison
      const fiveYearContacts = oop * 5;
      const fiveYearGlasses = Math.round(350 * 2.5); // ~2.5 pairs over 5 years at $350 each

      document.getElementById('cl3-annual')!.textContent = '$' + annualTotal.toLocaleString();
      document.getElementById('cl3-count')!.textContent = (pairsPerYear * 2) + ' lenses';
      document.getElementById('cl3-sol')!.textContent = '$' + solutionCost.toLocaleString() + '/yr';
      document.getElementById('cl3-oop')!.textContent = '$' + oop.toLocaleString();
      document.getElementById('cl3-five')!.textContent = '$' + fiveYearContacts.toLocaleString();
      document.getElementById('cl3-glasses')!.textContent = '$' + fiveYearGlasses.toLocaleString();

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.cl3-in').forEach(el => { el.addEventListener('input', calcCL3); el.addEventListener('change', calcCL3); });
      calcCL3();
    }, 50);
  </script>
</CalculatorLayout>
