---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Video Bitrate Calculator - File Size, Storage & Streaming Bandwidth";
const description = "Calculate video file size from resolution, frame rate, duration, and codec. Estimate storage needs and streaming bandwidth requirements.";
const relatedCalcs = [
  { name: "Video Storage", url: "/video-storage-calculator", description: "Storage for video projects." },
  { name: "Video Frame Rate", url: "/video-frame-rate-calculator", description: "Frame rate conversions." },
  { name: "Internet Speed", url: "/internet-speed-calculator", description: "Bandwidth calculations." },
  { name: "Data Storage", url: "/data-storage-converter", description: "Storage unit converter." },
  { name: "Aspect Ratio", url: "/aspect-ratio-calculator", description: "Video aspect ratios." },
  { name: "Photo Resolution", url: "/photo-resolution-calculator", description: "Image resolution calculator." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Video Bitrate Calculator" keywords="video bitrate calculator, video file size, streaming bandwidth, codec comparison, H.264, H.265, ProRes" breadcrumbs={[{ name: "Video Bitrate", url: "/video-bitrate-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Video Bitrate Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate video file sizes, storage needs, and streaming bandwidth from your recording settings.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Resolution</label>
          <select id="vb-res" class="vb-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="7680x4320">8K UHD (7680x4320)</option>
            <option value="3840x2160">4K UHD (3840x2160)</option>
            <option value="2560x1440">1440p QHD (2560x1440)</option>
            <option value="1920x1080" selected>1080p FHD (1920x1080)</option>
            <option value="1280x720">720p HD (1280x720)</option>
            <option value="854x480">480p SD (854x480)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Frame Rate (fps)</label>
          <select id="vb-fps" class="vb-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="24">24 fps (Cinema)</option>
            <option value="25">25 fps (PAL)</option>
            <option value="30" selected>30 fps (NTSC)</option>
            <option value="48">48 fps (HFR Cinema)</option>
            <option value="50">50 fps (PAL HFR)</option>
            <option value="60">60 fps (Smooth)</option>
            <option value="120">120 fps (Slow Motion)</option>
            <option value="240">240 fps (Super Slow-Mo)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Codec / Format</label>
          <select id="vb-codec" class="vb-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="h264" selected>H.264 / AVC</option>
            <option value="h265">H.265 / HEVC</option>
            <option value="prores422">Apple ProRes 422</option>
            <option value="prores4444">Apple ProRes 4444</option>
            <option value="dnxhd">Avid DNxHD/HR</option>
            <option value="raw">Cinema RAW</option>
            <option value="vp9">VP9 (YouTube)</option>
            <option value="av1">AV1</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Duration</label>
          <div class="grid grid-cols-3 gap-2">
            <div>
              <label class="block text-xs text-text-secondary">Hours</label>
              <input type="number" id="vb-hours" class="vb-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="0" min="0" step="1">
            </div>
            <div>
              <label class="block text-xs text-text-secondary">Minutes</label>
              <input type="number" id="vb-mins" class="vb-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="10" min="0" step="1">
            </div>
            <div>
              <label class="block text-xs text-text-secondary">Seconds</label>
              <input type="number" id="vb-secs" class="vb-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="0" min="0" step="1">
            </div>
          </div>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated File Size</div>
          <div class="text-4xl font-extrabold" id="vb-filesize"></div>
          <div class="text-sm text-blue-200 mt-1" id="vb-bitrate"></div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Streaming Bandwidth</div>
            <div class="text-xl font-bold text-text" id="vb-bandwidth"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Total Frames</div>
            <div class="text-xl font-bold text-text" id="vb-frames"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Data Rate</div>
            <div class="text-xl font-bold text-text" id="vb-datarate"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Storage per Minute</div>
            <div class="text-xl font-bold text-text" id="vb-permin"></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="video-bitrate" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Understanding Video Bitrate</h2>
      <p>Bitrate measures how much data is used per second of video. Higher bitrates mean better quality but larger files. Codec efficiency varies significantly: H.265 achieves similar quality to H.264 at roughly half the bitrate.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcVB() {
      const resParts = (document.getElementById('vb-res') as HTMLSelectElement).value.split('x');
      const resW = parseInt(resParts[0]);
      const resH = parseInt(resParts[1]);
      const fps = parseInt((document.getElementById('vb-fps') as HTMLSelectElement).value);
      const codec = (document.getElementById('vb-codec') as HTMLSelectElement).value;
      const hours = parseInt((document.getElementById('vb-hours') as HTMLInputElement).value) || 0;
      const mins = parseInt((document.getElementById('vb-mins') as HTMLInputElement).value) || 0;
      const secs = parseInt((document.getElementById('vb-secs') as HTMLInputElement).value) || 0;
      const totalSecs = hours * 3600 + mins * 60 + secs;

      const pixels = resW * resH;
      const basePixels = 1920 * 1080;
      const pixelRatio = pixels / basePixels;
      const fpsRatio = fps / 30;

      const codecBitrates: Record<string, number> = {
        'h264': 8,
        'h265': 5,
        'prores422': 147,
        'prores4444': 220,
        'dnxhd': 145,
        'raw': 500,
        'vp9': 4.5,
        'av1': 3.5,
      };

      const baseBitrateMbps = (codecBitrates[codec] || 8) * pixelRatio * fpsRatio;
      const bitrateBps = baseBitrateMbps * 1000000;
      const totalBits = bitrateBps * totalSecs;
      const totalBytes = totalBits / 8;

      function fmtSize(bytes: number): string {
        if (bytes >= 1099511627776) return (bytes / 1099511627776).toFixed(2) + ' TB';
        if (bytes >= 1073741824) return (bytes / 1073741824).toFixed(2) + ' GB';
        return (bytes / 1048576).toFixed(1) + ' MB';
      }

      document.getElementById('vb-filesize')!.textContent = fmtSize(totalBytes);
      document.getElementById('vb-bitrate')!.textContent = 'Bitrate: ' + baseBitrateMbps.toFixed(1) + ' Mbps';
      document.getElementById('vb-bandwidth')!.textContent = baseBitrateMbps.toFixed(1) + ' Mbps';
      document.getElementById('vb-frames')!.textContent = (totalSecs * fps).toLocaleString();
      document.getElementById('vb-datarate')!.textContent = (baseBitrateMbps / 8).toFixed(1) + ' MB/s';

      const bytesPerMin = (bitrateBps * 60) / 8;
      document.getElementById('vb-permin')!.textContent = fmtSize(bytesPerMin);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.vb-in').forEach(el => {
        el.addEventListener('input', calcVB);
        el.addEventListener('change', calcVB);
      });
      calcVB();
    }, 50);
  </script>
</CalculatorLayout>
