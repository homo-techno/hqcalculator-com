---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Welding Gas Calculator - Flow Rate & Cylinder Duration";
const description = "Calculate shielding gas flow rate and cylinder duration for MIG and TIG welding. Estimate gas consumption and costs for your welding project.";

const relatedCalcs = [
  { name: "Welding Rod Calculator", url: "/welding-rod-calculator", description: "Electrode consumption." },
  { name: "Welding Heat Input", url: "/welding-heat-input-calculator", description: "Heat input calculation." },
  { name: "Welding Cost Calculator", url: "/welding-cost-calculator", description: "Total welding job cost." },
  { name: "Metal Weight Calculator", url: "/metal-weight-calculator", description: "Weight of metal shapes." },
  { name: "Plasma Cutting Calculator", url: "/plasma-cutting-calculator", description: "Plasma cutter settings." },
  { name: "Soldering Calculator", url: "/soldering-calculator", description: "Solder wire consumption." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Welding Gas Calculator"
  keywords="welding gas calculator, shielding gas, argon, CO2, MIG gas, TIG gas, gas flow rate, cylinder duration, gas consumption"
  breadcrumbs={[{ name: "Welding Gas Calculator", url: "/welding-gas-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Welding Gas Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate shielding gas flow rate and cylinder duration for MIG/TIG welding processes.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Welding Process -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Welding Process</label>
        <select id="wg2-process" class="wg2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="mig">MIG (GMAW)</option>
          <option value="tig">TIG (GTAW)</option>
          <option value="mig-pulse">MIG Pulsed</option>
        </select>
      </div>

      <!-- Gas Type -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Gas Type / Mix</label>
        <select id="wg2-gas" class="wg2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="ar100">100% Argon</option>
          <option value="ar75co25" selected>75% Argon / 25% CO2 (C25)</option>
          <option value="ar90co10">90% Argon / 10% CO2</option>
          <option value="co2100">100% CO2</option>
          <option value="ar98o2">98% Argon / 2% O2</option>
          <option value="trimix">90% He / 7.5% Ar / 2.5% CO2</option>
        </select>
      </div>

      <!-- Flow Rate -->
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Flow Rate (CFH)</label>
          <input type="number" id="wg2-flow" class="wg2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="30" min="5" max="100" step="5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Cylinder Size</label>
          <select id="wg2-cylinder" class="wg2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="20">20 CF (Small)</option>
            <option value="40">40 CF</option>
            <option value="80">80 CF</option>
            <option value="125">125 CF</option>
            <option value="251" selected>251 CF (Standard)</option>
            <option value="330">330 CF (Large)</option>
          </select>
        </div>
      </div>

      <!-- Welding Time -->
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Arc-On Time Per Day (hours)</label>
          <input type="number" id="wg2-arctime" class="wg2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" min="0.5" max="12" step="0.5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Working Days</label>
          <input type="number" id="wg2-days" class="wg2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="1" max="30" step="1">
        </div>
      </div>

      <!-- Gas Cost -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Cylinder Cost ($)</label>
        <input type="number" id="wg2-cost" class="wg2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="45" min="0" step="5">
      </div>

      <!-- Results -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Cylinder Duration</div>
        <div class="text-4xl font-extrabold" id="wg2-duration">--</div>
        <div class="text-sm text-blue-200 mt-1">hours of welding time</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Gas Per Day</div>
          <div class="text-xl font-bold" id="wg2-perday">--</div>
          <div class="text-xs text-text-muted">cubic feet</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Days Per Cylinder</div>
          <div class="text-xl font-bold" id="wg2-days-cyl">--</div>
          <div class="text-xs text-text-muted">working days</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Total Gas Needed</div>
          <div class="text-xl font-bold" id="wg2-totalgas">--</div>
          <div class="text-xs text-text-muted">cubic feet for project</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Cylinders Needed</div>
          <div class="text-xl font-bold" id="wg2-numcyl">--</div>
          <div class="text-xs text-text-muted">for the project</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl text-center mb-6">
        <div class="text-xs text-text-muted uppercase">Total Gas Cost</div>
        <div class="text-2xl font-bold text-secondary" id="wg2-totalcost">--</div>
      </div>

      <ShareButton calculatorId="welding-gas" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Shielding Gas Flow Rates</h2>
      <p>Proper shielding gas flow rate is critical for weld quality. Too little gas allows atmospheric contamination; too much creates turbulence that pulls in air.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Recommended Flow Rates</h3>
      <ul>
        <li><strong>MIG (short circuit):</strong> 25-30 CFH for most applications</li>
        <li><strong>MIG (spray transfer):</strong> 30-50 CFH depending on nozzle size</li>
        <li><strong>TIG:</strong> 15-25 CFH for most metals</li>
        <li><strong>TIG (aluminum):</strong> 20-30 CFH due to higher heat</li>
      </ul>
      <h3 class="text-xl font-semibold text-text mt-8">Common Gas Mixtures</h3>
      <ul>
        <li><strong>75/25 (C25):</strong> Most popular MIG mix for mild steel</li>
        <li><strong>100% Argon:</strong> Required for TIG and MIG on aluminum</li>
        <li><strong>100% CO2:</strong> Deep penetration, more spatter, lowest cost</li>
        <li><strong>90/10:</strong> Less spatter than C25, good for thin steel</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcWG2() {
      const flow = parseFloat((document.getElementById('wg2-flow') as HTMLInputElement).value) || 30;
      const cylSize = parseFloat((document.getElementById('wg2-cylinder') as HTMLSelectElement).value) || 251;
      const arcTime = parseFloat((document.getElementById('wg2-arctime') as HTMLInputElement).value) || 4;
      const days = parseFloat((document.getElementById('wg2-days') as HTMLInputElement).value) || 5;
      const cylCost = parseFloat((document.getElementById('wg2-cost') as HTMLInputElement).value) || 45;

      // Duration: cylinder size / flow rate = hours
      const durationHrs = cylSize / flow;

      // Gas per day
      const gasPerDay = flow * arcTime;

      // Days per cylinder
      const daysCyl = cylSize / gasPerDay;

      // Total gas needed for project
      const totalGas = gasPerDay * days;

      // Cylinders needed
      const numCyl = Math.ceil(totalGas / cylSize);

      // Total cost
      const totalCost = numCyl * cylCost;

      document.getElementById('wg2-duration')!.textContent = durationHrs.toFixed(1);
      document.getElementById('wg2-perday')!.textContent = gasPerDay.toFixed(0);
      document.getElementById('wg2-days-cyl')!.textContent = daysCyl.toFixed(1);
      document.getElementById('wg2-totalgas')!.textContent = totalGas.toFixed(0);
      document.getElementById('wg2-numcyl')!.textContent = String(numCyl);
      document.getElementById('wg2-totalcost')!.textContent = '$' + totalCost.toFixed(0);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.wg2-in').forEach(el => {
        el.addEventListener('input', calcWG2);
        el.addEventListener('change', calcWG2);
      });
      calcWG2();
    }, 50);
  </script>
</CalculatorLayout>
