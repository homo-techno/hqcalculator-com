---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Anchor Chain Calculator - Rode Length & Scope Ratio";
const description = "Calculate anchor chain and rode length from water depth, scope ratio, and conditions. Determine proper anchoring setup for wind and current.";
const relatedCalcs = [
  { name: "Boat Loan", url: "/boat-loan-calculator", description: "Marine financing costs." },
  { name: "Nautical Mile", url: "/nautical-mile-calculator", description: "Nautical distance conversion." },
  { name: "Tide Calculator", url: "/tide-calculator", description: "Tidal predictions." },
  { name: "Bearing", url: "/bearing-calculator", description: "Navigation bearings." },
  { name: "Great Circle", url: "/great-circle-calculator", description: "Great circle navigation." },
  { name: "Buoyancy", url: "/buoyancy-calculator", description: "Buoyancy force calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Anchor Chain Calculator" keywords="anchor chain calculator, rode length, scope ratio, anchoring, chain rode, boat anchoring, anchor scope" breadcrumbs={[{ name: "Anchor Chain", url: "/anchor-chain-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Anchor Chain Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate the correct anchor chain and rode length based on depth, conditions, and scope ratio for safe anchoring.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Water Depth (ft)</label><input type="number" id="an2-depth" class="an2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Tidal Rise (ft)</label><input type="number" id="an2-tide" class="an2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="0" step="0.5"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Bow Height (ft)</label><input type="number" id="an2-bow" class="an2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="0.5"></div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Scope Ratio</label>
            <select id="an2-scope" class="an2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="5">5:1 (Calm, all chain)</option>
              <option value="7" selected>7:1 (Normal conditions)</option>
              <option value="8">8:1 (Moderate wind)</option>
              <option value="10">10:1 (Storm/strong current)</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Rode Type</label>
            <select id="an2-rode" class="an2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="chain">All Chain</option>
              <option value="combo">Chain + Rope</option>
              <option value="rope">All Rope</option>
            </select>
          </div>
          <div><label class="block text-xs font-medium text-text mb-1">Boat Length (ft)</label><input type="number" id="an2-boat" class="an2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Rode Needed</div>
          <div class="text-5xl font-extrabold font-mono" id="an2-total">--</div>
          <div class="text-sm text-blue-200 mt-1">feet</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Max Depth</div><div class="text-xl font-bold" id="an2-maxd">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Chain Length</div><div class="text-xl font-bold" id="an2-chain">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Rope Length</div><div class="text-xl font-bold" id="an2-rope">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Swing Radius</div><div class="text-xl font-bold" id="an2-swing">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Holding Rating</div><div class="text-xl font-bold" id="an2-rating">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="anchor-chain" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcAN2() {
      const depth = parseFloat((document.getElementById('an2-depth') as HTMLInputElement).value) || 0;
      const tide = parseFloat((document.getElementById('an2-tide') as HTMLInputElement).value) || 0;
      const bow = parseFloat((document.getElementById('an2-bow') as HTMLInputElement).value) || 0;
      const scope = parseFloat((document.getElementById('an2-scope') as HTMLSelectElement).value) || 7;
      const rodeType = (document.getElementById('an2-rode') as HTMLSelectElement).value;
      const boat = parseFloat((document.getElementById('an2-boat') as HTMLInputElement).value) || 0;

      const maxDepth = depth + tide;
      const totalHeight = maxDepth + bow;
      const totalRode = totalHeight * scope;

      let chainLen = 0;
      let ropeLen = 0;
      if (rodeType === 'chain') {
        chainLen = totalRode;
        ropeLen = 0;
      } else if (rodeType === 'combo') {
        // Chain should be at least 1 boat length or depth, whichever greater
        chainLen = Math.max(maxDepth, boat, 20);
        ropeLen = totalRode - chainLen;
        if (ropeLen < 0) ropeLen = 0;
      } else {
        chainLen = 0;
        ropeLen = totalRode;
      }

      const swingRadius = totalRode + boat;

      let rating = 'Poor';
      if (scope >= 10) rating = 'Excellent';
      else if (scope >= 8) rating = 'Very Good';
      else if (scope >= 7) rating = 'Good';
      else if (scope >= 5) rating = rodeType === 'chain' ? 'Good' : 'Fair';

      document.getElementById('an2-total')!.textContent = totalRode > 0 ? Math.ceil(totalRode).toString() : '--';
      document.getElementById('an2-maxd')!.textContent = maxDepth > 0 ? maxDepth.toFixed(1) + ' ft' : '--';
      document.getElementById('an2-chain')!.textContent = chainLen > 0 ? Math.ceil(chainLen) + ' ft' : '--';
      document.getElementById('an2-rope')!.textContent = ropeLen > 0 ? Math.ceil(ropeLen) + ' ft' : 'N/A';
      document.getElementById('an2-swing')!.textContent = swingRadius > 0 ? Math.ceil(swingRadius) + ' ft' : '--';
      document.getElementById('an2-rating')!.textContent = rating;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      (document.getElementById('an2-depth') as HTMLInputElement).value = '15';
      (document.getElementById('an2-tide') as HTMLInputElement).value = '4';
      (document.getElementById('an2-bow') as HTMLInputElement).value = '5';
      (document.getElementById('an2-boat') as HTMLInputElement).value = '32';
      document.querySelectorAll('.an2-in').forEach(el => { el.addEventListener('input', calcAN2); el.addEventListener('change', calcAN2); });
      calcAN2();
    }, 50);
  </script>
</CalculatorLayout>
