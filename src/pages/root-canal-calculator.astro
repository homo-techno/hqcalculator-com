---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Root Canal Calculator";
const description = "Estimate root canal cost by tooth type (anterior, premolar, molar), retreatment, post and core, crown, and insurance coverage.";
const relatedCalcs = [
  { name: "Dental Crown Calculator", url: "/dental-crown-calculator", description: "Crown cost by material." },
  { name: "Tooth Filling Calculator", url: "/tooth-filling-calculator", description: "Filling cost by material." },
  { name: "Dental Implant Cost Calculator", url: "/dental-implant-cost-calculator", description: "Implant cost estimates." },
  { name: "Dental Insurance Calculator", url: "/dental-insurance-calculator", description: "Dental plan analysis." },
  { name: "Dental Bridge Calculator", url: "/dental-bridge-calculator", description: "Bridge cost and alternatives." },
  { name: "Dosage Calculator", url: "/dosage-calculator", description: "Medication dosing calculator." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Root Canal Calculator" keywords="root canal cost, endodontic treatment, molar root canal, root canal insurance, retreatment cost" breadcrumbs={[{ name: "Root Canal", url: "/root-canal-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Root Canal Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate root canal treatment cost including tooth type, retreatment, post/core, and crown.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Tooth Type</label>
            <select id="rc2-tooth" class="rc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="anterior">Anterior (1 canal)</option>
              <option value="premolar" selected>Premolar (1-2 canals)</option>
              <option value="molar">Molar (3-4 canals)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Treatment Type</label>
            <select id="rc2-treat" class="rc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="initial" selected>Initial Treatment</option>
              <option value="retreat">Retreatment</option>
              <option value="apicoectomy">Apicoectomy (Surgery)</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Post and Core Needed?</label>
            <select id="rc2-post" class="rc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="no" selected>No</option>
              <option value="prefab">Prefabricated Post ($200-$350)</option>
              <option value="cast">Cast Post and Core ($350-$600)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Crown After RCT?</label>
            <select id="rc2-crown" class="rc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="no">No Crown</option>
              <option value="pfm" selected>PFM Crown</option>
              <option value="zirconia">Zirconia Crown</option>
              <option value="emax">E-Max Crown</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Insurance Coverage (%)</label><input type="number" id="rc2-ins" class="rc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="50" min="0" max="100" step="5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Annual Max Benefit ($)</label><input type="number" id="rc2-max" class="rc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1500" min="0" max="10000" step="100"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Treatment Plan Cost</div>
          <div class="text-5xl font-extrabold font-mono" id="rc2-total">$0</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Root Canal</div><div class="text-xl font-bold font-mono" id="rc2-rct">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Post and Core</div><div class="text-xl font-bold font-mono" id="rc2-postc">$0</div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Crown</div><div class="text-xl font-bold font-mono" id="rc2-crownc">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Insurance Pays</div><div class="text-xl font-bold font-mono" id="rc2-insc">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Out of Pocket</div><div class="text-xl font-bold font-mono" id="rc2-oop">$0</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase mb-1">Extraction + Implant Alternative</div>
          <div class="text-xl font-bold font-mono" id="rc2-alt">$0</div>
        </div>
      </div>
      <ShareButton calculatorId="root-canal" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcRC2() {
      const tooth = (document.getElementById('rc2-tooth') as HTMLSelectElement).value;
      const treat = (document.getElementById('rc2-treat') as HTMLSelectElement).value;
      const post = (document.getElementById('rc2-post') as HTMLSelectElement).value;
      const crown = (document.getElementById('rc2-crown') as HTMLSelectElement).value;
      const insPct = parseFloat((document.getElementById('rc2-ins') as HTMLInputElement).value) || 0;
      const insMax = parseFloat((document.getElementById('rc2-max') as HTMLInputElement).value) || 0;

      const rctCosts: Record<string, Record<string, number>> = {
        initial: { anterior: 750, premolar: 900, molar: 1200 },
        retreat: { anterior: 950, premolar: 1100, molar: 1500 },
        apicoectomy: { anterior: 1100, premolar: 1300, molar: 1600 }
      };

      const postCosts: Record<string, number> = { no: 0, prefab: 275, cast: 475 };
      const crownCosts: Record<string, number> = { no: 0, pfm: 1050, zirconia: 1350, emax: 1300 };

      const rctCost = rctCosts[treat][tooth];
      const postCost = postCosts[post];
      const crownCost = crownCosts[crown];
      const subtotal = rctCost + postCost + crownCost;
      const insOffset = Math.min(subtotal * (insPct / 100), insMax);
      const oop = subtotal - insOffset;

      // Extraction + implant alternative
      const extractCost = 250;
      const implantAlt = extractCost + 1800 + 500 + 1200; // extraction + implant + abutment + crown

      document.getElementById('rc2-total')!.textContent = '$' + Math.round(subtotal).toLocaleString();
      document.getElementById('rc2-rct')!.textContent = '$' + Math.round(rctCost).toLocaleString();
      document.getElementById('rc2-postc')!.textContent = '$' + Math.round(postCost).toLocaleString();
      document.getElementById('rc2-crownc')!.textContent = '$' + Math.round(crownCost).toLocaleString();
      document.getElementById('rc2-insc')!.textContent = '$' + Math.round(insOffset).toLocaleString();
      document.getElementById('rc2-oop')!.textContent = '$' + Math.round(oop).toLocaleString();
      document.getElementById('rc2-alt')!.textContent = '$' + implantAlt.toLocaleString() + ' (extract + implant)';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.rc2-in').forEach(el => { el.addEventListener('input', calcRC2); el.addEventListener('change', calcRC2); });
      calcRC2();
    }, 50);
  </script>
</CalculatorLayout>
