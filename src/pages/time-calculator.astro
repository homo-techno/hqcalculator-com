---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Time Calculator - Add & Subtract Time Online";
const description = "Add and subtract hours, minutes, and seconds. Convert between time units. Time duration calculator for work hours and scheduling.";

const relatedCalcs = [
  { name: "Date Calculator", url: "/date-calculator", description: "Date differences." },
  { name: "Hours Calculator", url: "/hours-calculator", description: "Work hours tracker." },
  { name: "Age Calculator", url: "/age-calculator", description: "Exact age." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Pace Calculator", url: "/pace-calculator", description: "Running pace." },
  { name: "Salary Calculator", url: "/salary-calculator", description: "Salary conversion." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Time Calculator"
  keywords="time calculator, add time, subtract time, time duration, hours minutes seconds, time converter"
  breadcrumbs={[{ name: "Time Calculator", url: "/time-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Time Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Add, subtract, and convert time durations in hours, minutes, and seconds.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Mode -->
      <div class="flex gap-2 mb-6">
        <button class="tc-mode-btn px-4 py-2 rounded-full text-sm font-semibold bg-primary text-white" data-mode="add">Add / Subtract</button>
        <button class="tc-mode-btn px-4 py-2 rounded-full text-sm font-semibold bg-surface-alt text-text-secondary" data-mode="convert">Convert</button>
      </div>

      <!-- Add/Subtract Mode -->
      <div id="tc-add-mode">
        <div id="tc-rows">
          <div class="tc-row flex items-center gap-2 mb-3">
            <select class="tc-op w-16 px-2 py-3 border border-border rounded-xl text-lg font-bold text-center">
              <option value="+">+</option>
              <option value="-">−</option>
            </select>
            <input type="number" class="tc-h w-20 px-3 py-3 border border-border rounded-xl text-lg text-center" value="2" min="0" placeholder="H">
            <span class="text-text-muted font-bold">:</span>
            <input type="number" class="tc-m w-20 px-3 py-3 border border-border rounded-xl text-lg text-center" value="30" min="0" max="59" placeholder="M">
            <span class="text-text-muted font-bold">:</span>
            <input type="number" class="tc-s w-20 px-3 py-3 border border-border rounded-xl text-lg text-center" value="0" min="0" max="59" placeholder="S">
          </div>
          <div class="tc-row flex items-center gap-2 mb-3">
            <select class="tc-op w-16 px-2 py-3 border border-border rounded-xl text-lg font-bold text-center">
              <option value="+">+</option>
              <option value="-">−</option>
            </select>
            <input type="number" class="tc-h w-20 px-3 py-3 border border-border rounded-xl text-lg text-center" value="1" min="0" placeholder="H">
            <span class="text-text-muted font-bold">:</span>
            <input type="number" class="tc-m w-20 px-3 py-3 border border-border rounded-xl text-lg text-center" value="45" min="0" max="59" placeholder="M">
            <span class="text-text-muted font-bold">:</span>
            <input type="number" class="tc-s w-20 px-3 py-3 border border-border rounded-xl text-lg text-center" value="0" min="0" max="59" placeholder="S">
          </div>
        </div>
        <div class="flex gap-2 mb-6">
          <button id="tc-add-row" class="px-4 py-2 border border-border rounded-xl text-sm font-semibold hover:bg-surface-alt">+ Add Row</button>
          <button id="tc-clear" class="px-4 py-2 border border-border rounded-xl text-sm font-semibold hover:bg-surface-alt text-text-muted">Clear</button>
        </div>
      </div>

      <!-- Convert Mode -->
      <div id="tc-convert-mode" class="hidden">
        <div class="flex items-center gap-3 mb-4">
          <input type="number" id="tc-conv-val" class="flex-1 px-4 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="90" step="any">
          <select id="tc-conv-from" class="px-4 py-3 border border-border rounded-xl text-lg">
            <option value="seconds">Seconds</option>
            <option value="minutes" selected>Minutes</option>
            <option value="hours">Hours</option>
            <option value="days">Days</option>
            <option value="weeks">Weeks</option>
          </select>
        </div>
        <div class="text-center text-text-muted text-2xl mb-4">↓</div>
        <div id="tc-conv-results" class="grid grid-cols-2 gap-3 mb-6"></div>
      </div>

      <!-- Result -->
      <div id="tc-result-section">
        <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Time</div>
          <div class="text-4xl font-extrabold" id="tc-result">4:15:00</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Hours</div>
            <div class="text-xl font-bold" id="tc-hours">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Minutes</div>
            <div class="text-xl font-bold" id="tc-minutes">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Seconds</div>
            <div class="text-xl font-bold" id="tc-seconds">0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Decimal Hours</div>
            <div class="text-xl font-bold" id="tc-decimal">0</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="time" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">How Time Calculations Work</h2>
      <p>Time uses a base-60 system for minutes and seconds. When adding time, 60 seconds becomes 1 minute and 60 minutes becomes 1 hour.</p>

      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">Total Seconds = Hours × 3600 + Minutes × 60 + Seconds</div>

      <h3 class="text-xl font-semibold text-text mt-8">Time Unit Conversions</h3>
      <ul>
        <li>1 hour = 60 minutes = 3,600 seconds</li>
        <li>1 day = 24 hours = 1,440 minutes = 86,400 seconds</li>
        <li>1 week = 7 days = 168 hours = 604,800 seconds</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How do I convert minutes to decimal hours?</strong> Divide minutes by 60. For example, 45 minutes = 45/60 = 0.75 hours. So 2:45 = 2.75 decimal hours.</p>
      <p><strong>How do I add time on a timesheet?</strong> Convert each entry to total minutes, sum them up, then convert back. Or use our calculator above to add multiple time entries.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let tcMode = 'add';

    function pad(n: number): string { return String(Math.abs(n)).padStart(2, '0'); }

    function formatTime(totalSec: number): string {
      const neg = totalSec < 0;
      const abs = Math.abs(totalSec);
      const h = Math.floor(abs / 3600);
      const m = Math.floor((abs % 3600) / 60);
      const s = abs % 60;
      return (neg ? '-' : '') + `${h}:${pad(m)}:${pad(s)}`;
    }

    function calcTimeAdd() {
      let totalSeconds = 0;
      document.querySelectorAll('.tc-row').forEach(row => {
        const op = (row.querySelector('.tc-op') as HTMLSelectElement).value;
        const h = parseInt((row.querySelector('.tc-h') as HTMLInputElement).value) || 0;
        const m = parseInt((row.querySelector('.tc-m') as HTMLInputElement).value) || 0;
        const s = parseInt((row.querySelector('.tc-s') as HTMLInputElement).value) || 0;
        const sec = h * 3600 + m * 60 + s;
        totalSeconds += op === '-' ? -sec : sec;
      });

      document.getElementById('tc-result')!.textContent = formatTime(totalSeconds);
      const abs = Math.abs(totalSeconds);
      document.getElementById('tc-hours')!.textContent = (abs / 3600).toFixed(2);
      document.getElementById('tc-minutes')!.textContent = String(Math.round(abs / 60));
      document.getElementById('tc-seconds')!.textContent = abs.toLocaleString();
      document.getElementById('tc-decimal')!.textContent = (totalSeconds / 3600).toFixed(4);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    function calcConvert() {
      const val = parseFloat((document.getElementById('tc-conv-val') as HTMLInputElement).value) || 0;
      const from = (document.getElementById('tc-conv-from') as HTMLSelectElement).value;

      const toSeconds: Record<string, number> = { seconds: 1, minutes: 60, hours: 3600, days: 86400, weeks: 604800 };
      const totalSec = val * toSeconds[from];
      const results = [
        { label: 'Seconds', value: totalSec.toLocaleString('en-US', { maximumFractionDigits: 2 }) },
        { label: 'Minutes', value: (totalSec / 60).toLocaleString('en-US', { maximumFractionDigits: 4 }) },
        { label: 'Hours', value: (totalSec / 3600).toLocaleString('en-US', { maximumFractionDigits: 4 }) },
        { label: 'Days', value: (totalSec / 86400).toLocaleString('en-US', { maximumFractionDigits: 6 }) },
        { label: 'Weeks', value: (totalSec / 604800).toLocaleString('en-US', { maximumFractionDigits: 6 }) },
        { label: 'H:M:S', value: formatTime(Math.round(totalSec)) },
      ];
      document.getElementById('tc-conv-results')!.innerHTML = results.map(r =>
        `<div class="p-3 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">${r.label}</div><div class="text-lg font-bold">${r.value}</div></div>`
      ).join('');
    }

    function addRow() {
      const container = document.getElementById('tc-rows')!;
      const row = document.createElement('div');
      row.className = 'tc-row flex items-center gap-2 mb-3';
      row.innerHTML = `
        <select class="tc-op w-16 px-2 py-3 border border-border rounded-xl text-lg font-bold text-center">
          <option value="+">+</option><option value="-">−</option>
        </select>
        <input type="number" class="tc-h w-20 px-3 py-3 border border-border rounded-xl text-lg text-center" value="0" min="0" placeholder="H">
        <span class="text-text-muted font-bold">:</span>
        <input type="number" class="tc-m w-20 px-3 py-3 border border-border rounded-xl text-lg text-center" value="0" min="0" max="59" placeholder="M">
        <span class="text-text-muted font-bold">:</span>
        <input type="number" class="tc-s w-20 px-3 py-3 border border-border rounded-xl text-lg text-center" value="0" min="0" max="59" placeholder="S">
        <button class="tc-remove text-text-muted hover:text-danger text-xl px-2">×</button>`;
      container.appendChild(row);
      row.querySelectorAll('input, select').forEach(el => el.addEventListener('input', calcTimeAdd));
      row.querySelector('.tc-remove')!.addEventListener('click', () => { row.remove(); calcTimeAdd(); });
    }

    setTimeout(() => {
      document.querySelectorAll('.tc-mode-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tc-mode-btn').forEach(b => { b.classList.remove('bg-primary', 'text-white'); b.classList.add('bg-surface-alt', 'text-text-secondary'); });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary'); btn.classList.add('bg-primary', 'text-white');
          tcMode = (btn as HTMLElement).dataset.mode || 'add';
          document.getElementById('tc-add-mode')!.classList.toggle('hidden', tcMode !== 'add');
          document.getElementById('tc-convert-mode')!.classList.toggle('hidden', tcMode !== 'convert');
          document.getElementById('tc-result-section')!.classList.toggle('hidden', tcMode === 'convert');
        });
      });

      document.querySelectorAll('.tc-row input, .tc-row select').forEach(el => el.addEventListener('input', calcTimeAdd));
      document.getElementById('tc-add-row')!.addEventListener('click', addRow);
      document.getElementById('tc-clear')!.addEventListener('click', () => {
        document.querySelectorAll('.tc-row input').forEach(el => (el as HTMLInputElement).value = '0');
        calcTimeAdd();
      });
      document.getElementById('tc-conv-val')!.addEventListener('input', calcConvert);
      document.getElementById('tc-conv-from')!.addEventListener('change', calcConvert);

      calcTimeAdd();
      calcConvert();
    }, 50);
  </script>
</CalculatorLayout>
