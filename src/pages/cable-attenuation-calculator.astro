---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Cable Attenuation Calculator - Coaxial Cable Loss 2026";
const description = "Calculate coaxial cable signal attenuation by cable type, length, and frequency. Compare RG-6, RG-58, RG-213, LMR-400, and other common cable types.";

const relatedCalcs = [
  { name: "EIRP Calculator", url: "/eirp-calculator", description: "Effective isotropic radiated power." },
  { name: "Link Budget Calculator", url: "/link-budget-calculator", description: "Complete RF link budget analysis." },
  { name: "Fiber Optic Loss Calculator", url: "/fiber-optic-loss-calculator", description: "Fiber optic link loss budget." },
  { name: "Antenna Gain Calculator", url: "/antenna-gain-calculator", description: "Antenna gain calculation." },
  { name: "Ethernet Cable Calculator", url: "/ethernet-cable-calculator", description: "Ethernet cable specifications." },
  { name: "RF Power Converter", url: "/rf-power-converter-calculator", description: "Convert dBm, dBW, watts." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Cable Attenuation Calculator"
  keywords="cable attenuation calculator, coaxial cable loss, RG-6, RG-58, LMR-400, signal loss, cable loss per foot"
  breadcrumbs={[{ name: "Cable Attenuation Calculator", url: "/cable-attenuation-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Cable Attenuation Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate signal loss through coaxial cable based on cable type, length, and operating frequency.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Cable Type</label>
        <select id="cat-type" class="cat-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="rg58">RG-58 (50 ohm, thin)</option>
          <option value="rg6">RG-6 (75 ohm, CATV)</option>
          <option value="rg8">RG-8/U (50 ohm)</option>
          <option value="rg213">RG-213 (50 ohm)</option>
          <option value="lmr240">LMR-240 (50 ohm)</option>
          <option value="lmr400" selected>LMR-400 (50 ohm, low loss)</option>
          <option value="lmr600">LMR-600 (50 ohm, very low loss)</option>
          <option value="half">1/2" Hardline</option>
          <option value="custom">Custom (enter dB/100ft)</option>
        </select>
      </div>

      <div class="mb-4" id="cat-custom-wrap" style="display:none;">
        <label class="block text-sm font-medium text-text mb-1">Attenuation (dB per 100 ft at specified frequency)</label>
        <input type="number" id="cat-custom-loss" class="cat-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3" step="0.1" min="0">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Cable Length</label>
        <div class="flex gap-2">
          <input type="number" id="cat-length" class="cat-in flex-1 px-4 py-3 border border-border rounded-xl text-lg font-bold" value="100" step="1" min="0">
          <select id="cat-length-unit" class="cat-in px-4 py-3 border border-border rounded-xl text-lg">
            <option value="ft" selected>feet</option>
            <option value="m">meters</option>
          </select>
        </div>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Frequency (MHz)</label>
        <input type="number" id="cat-freq" class="cat-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="450" step="1" min="1">
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-text mb-1">Number of Connectors</label>
        <input type="number" id="cat-connectors" class="cat-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" step="1" min="0">
        <p class="text-xs text-text-muted mt-1">Each connector adds ~0.5 dB loss</p>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm font-medium text-blue-100 mb-1">Total Cable System Loss</div>
        <div class="text-4xl font-extrabold" id="cat-total">--</div>
        <div class="text-sm text-blue-200 mt-1">dB</div>
      </div>

      <!-- Secondary Stats -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Cable Loss Only</div>
          <div class="text-xl font-bold text-text" id="cat-cable-loss">--</div>
          <div class="text-xs text-text-muted">dB</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Connector Loss</div>
          <div class="text-xl font-bold text-text" id="cat-conn-loss">--</div>
          <div class="text-xs text-text-muted">dB</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Loss per 100 ft</div>
          <div class="text-xl font-bold text-text" id="cat-per100">--</div>
          <div class="text-xs text-text-muted">dB</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Power Remaining</div>
          <div class="text-xl font-bold text-text" id="cat-pct">--</div>
          <div class="text-xs text-text-muted">%</div>
        </div>
      </div>

      <ShareButton calculatorId="cable-attenuation" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Understanding Coaxial Cable Attenuation</h2>
      <p>Coaxial cable attenuation increases with both frequency and length. Higher frequencies experience more loss due to skin effect and dielectric losses. The loss approximately follows a square-root relationship with frequency.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono text-sm">
        Cable Loss (dB) = Loss_per_100ft x (Length_ft / 100) x sqrt(Freq / Freq_ref)
      </div>
      <p>Using lower-loss cable or shorter runs reduces attenuation, which is critical for maintaining signal quality in RF systems.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcCAT() {
      const cableType = (document.getElementById('cat-type') as HTMLSelectElement).value;
      const lengthVal = parseFloat((document.getElementById('cat-length') as HTMLInputElement).value) || 0;
      const lengthUnit = (document.getElementById('cat-length-unit') as HTMLSelectElement).value;
      const freq = parseFloat((document.getElementById('cat-freq') as HTMLInputElement).value) || 1;
      const connectors = parseFloat((document.getElementById('cat-connectors') as HTMLInputElement).value) || 0;

      document.getElementById('cat-custom-wrap')!.style.display = cableType === 'custom' ? '' : 'none';

      let lengthFt = lengthVal;
      if (lengthUnit === 'm') lengthFt = lengthVal * 3.28084;

      // dB per 100ft at reference frequency (450 MHz)
      const cableLoss450: Record<string, number> = {
        rg58: 11.2, rg6: 5.6, rg8: 5.1, rg213: 5.2,
        lmr240: 5.3, lmr400: 2.7, lmr600: 1.7, half: 1.2
      };

      let lossPer100 = cableLoss450[cableType] || 2.7;
      if (cableType === 'custom') {
        lossPer100 = parseFloat((document.getElementById('cat-custom-loss') as HTMLInputElement).value) || 0;
      } else {
        // Scale by sqrt of frequency ratio from 450 MHz reference
        lossPer100 = lossPer100 * Math.sqrt(freq / 450);
      }

      const cableLoss = lossPer100 * (lengthFt / 100);
      const connLoss = connectors * 0.5;
      const totalLoss = cableLoss + connLoss;
      const pctRemaining = Math.pow(10, -totalLoss / 10) * 100;

      document.getElementById('cat-total')!.textContent = totalLoss.toFixed(2);
      document.getElementById('cat-cable-loss')!.textContent = cableLoss.toFixed(2);
      document.getElementById('cat-conn-loss')!.textContent = connLoss.toFixed(2);
      document.getElementById('cat-per100')!.textContent = lossPer100.toFixed(2);
      document.getElementById('cat-pct')!.textContent = pctRemaining.toFixed(1);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.cat-in').forEach(el => { el.addEventListener('input', calcCAT); el.addEventListener('change', calcCAT); });
      calcCAT();
    }, 50);
  </script>
</CalculatorLayout>
