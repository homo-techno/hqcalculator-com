---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Random Number Generator - Free Online RNG Tool";
const description = "Generate random numbers, random lists, coin flips, dice rolls, and lottery numbers. Cryptographically secure random number generator.";

const relatedCalcs = [
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Calculate percentages." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math." },
  { name: "Fraction Calculator", url: "/fraction-calculator", description: "Fraction operations." },
  { name: "GPA Calculator", url: "/gpa-calculator", description: "Grade point average." },
  { name: "Square Root Calculator", url: "/square-root-calculator", description: "Square roots." },
  { name: "Exponent Calculator", url: "/exponent-calculator", description: "Powers & exponents." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Random Number Generator" keywords="random number generator, rng, random picker, dice roller, coin flip, lottery number generator" breadcrumbs={[{ name: "Random Number Generator", url: "/random-number-generator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Random Number Generator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Generate random numbers, roll dice, flip coins, and pick lottery numbers.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Main RNG -->
      <div class="mb-8">
        <h2 class="font-bold text-text mb-4">Random Number</h2>
        <div class="grid grid-cols-2 gap-3 mb-4">
          <div><label class="text-xs text-text-muted">Minimum</label><input type="number" id="rng-min" class="w-full px-3 py-2.5 border border-border rounded-xl text-lg" value="1"></div>
          <div><label class="text-xs text-text-muted">Maximum</label><input type="number" id="rng-max" class="w-full px-3 py-2.5 border border-border rounded-xl text-lg" value="100"></div>
        </div>
        <div class="grid grid-cols-2 gap-3 mb-4">
          <div><label class="text-xs text-text-muted">How many</label><input type="number" id="rng-count" class="w-full px-3 py-2.5 border border-border rounded-xl" value="1" min="1" max="100"></div>
          <div><label class="text-xs text-text-muted">Type</label><select id="rng-type" class="w-full px-3 py-2.5 border border-border rounded-xl"><option value="integer">Integers</option><option value="decimal">Decimals</option></select></div>
        </div>
        <button id="rng-generate" class="w-full py-3 bg-primary text-white rounded-xl text-lg font-bold hover:bg-primary/90 transition-colors">Generate</button>
        <div class="mt-4 p-6 bg-surface-alt rounded-xl text-center min-h-[80px] flex items-center justify-center">
          <div class="text-4xl font-extrabold text-primary" id="rng-result">â€”</div>
        </div>
        <div class="mt-2 text-sm text-text-muted text-center" id="rng-history"></div>
      </div>

      <!-- Quick Tools -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <h3 class="font-bold text-text text-sm mb-3">Coin Flip</h3>
          <div class="text-3xl font-extrabold mb-2" id="coin-result">ðŸª™</div>
          <button id="coin-flip" class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-semibold">Flip Coin</button>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <h3 class="font-bold text-text text-sm mb-3">Dice Roll</h3>
          <div class="text-3xl font-extrabold mb-2" id="dice-result">ðŸŽ²</div>
          <div class="flex gap-1 justify-center">
            <button class="dice-btn px-3 py-2 bg-primary text-white rounded-lg text-xs font-semibold" data-sides="6">D6</button>
            <button class="dice-btn px-3 py-2 bg-surface-alt text-text-secondary rounded-lg text-xs font-semibold border border-border" data-sides="20">D20</button>
            <button class="dice-btn px-3 py-2 bg-surface-alt text-text-secondary rounded-lg text-xs font-semibold border border-border" data-sides="12">D12</button>
          </div>
        </div>
      </div>

      <!-- Lottery -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-bold text-text text-sm mb-3">Lottery Numbers</h3>
        <div class="flex flex-wrap gap-2 mb-3" id="lottery-numbers"></div>
        <div class="flex gap-2">
          <button id="lottery-645" class="px-3 py-2 bg-primary text-white rounded-lg text-xs font-semibold">6/49</button>
          <button id="lottery-powerball" class="px-3 py-2 bg-surface-alt text-text-secondary rounded-lg text-xs font-semibold border border-border">Powerball</button>
          <button id="lottery-mega" class="px-3 py-2 bg-surface-alt text-text-secondary rounded-lg text-xs font-semibold border border-border">Mega Millions</button>
        </div>
      </div>

      <ShareButton calculatorId="random-number" /><FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">About Random Number Generation</h2>
      <p>This generator uses <code>crypto.getRandomValues()</code> when available, providing cryptographically secure random numbers suitable for most applications including games, simulations, and fair selection.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Common Uses</h3>
      <ul><li>Picking raffle/lottery winners</li><li>Board game dice rolls</li><li>Statistical sampling</li><li>Password generation</li><li>Making fair decisions</li></ul>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function secureRandom(): number {
      if (typeof crypto !== 'undefined' && crypto.getRandomValues) {
        const arr = new Uint32Array(1); crypto.getRandomValues(arr); return arr[0] / 4294967296;
      }
      return Math.random();
    }
    function randInt(min: number, max: number): number { return Math.floor(secureRandom() * (max - min + 1)) + min; }
    function randFloat(min: number, max: number): number { return secureRandom() * (max - min) + min; }

    const history: string[] = [];
    function generate() {
      const min = parseInt((document.getElementById('rng-min') as HTMLInputElement).value);
      const max = parseInt((document.getElementById('rng-max') as HTMLInputElement).value);
      const count = Math.min(100, parseInt((document.getElementById('rng-count') as HTMLInputElement).value) || 1);
      const type = (document.getElementById('rng-type') as HTMLSelectElement).value;
      const nums: string[] = [];
      for (let i = 0; i < count; i++) {
        nums.push(type === 'integer' ? String(randInt(min, max)) : randFloat(min, max).toFixed(4));
      }
      const result = nums.join(', ');
      document.getElementById('rng-result')!.textContent = result;
      history.unshift(result);
      if (history.length > 5) history.pop();
      document.getElementById('rng-history')!.textContent = history.length > 1 ? 'Previous: ' + history.slice(1).join(' | ') : '';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    function lotteryNums(count: number, max: number, bonusMax?: number) {
      const nums = new Set<number>();
      while (nums.size < count) nums.add(randInt(1, max));
      const sorted = Array.from(nums).sort((a, b) => a - b);
      let html = sorted.map(n => `<span class="w-10 h-10 bg-primary text-white rounded-full flex items-center justify-center font-bold text-sm">${n}</span>`).join('');
      if (bonusMax) html += `<span class="w-10 h-10 bg-danger text-white rounded-full flex items-center justify-center font-bold text-sm">${randInt(1, bonusMax)}</span>`;
      document.getElementById('lottery-numbers')!.innerHTML = html;
    }

    setTimeout(() => {
      document.getElementById('rng-generate')!.addEventListener('click', generate);
      document.getElementById('rng-generate')!.addEventListener('click', () => {
        const el = document.getElementById('rng-result')!;
        el.style.transform = 'scale(1.1)'; setTimeout(() => el.style.transform = '', 150);
      });
      document.getElementById('coin-flip')!.addEventListener('click', () => {
        const result = secureRandom() < 0.5 ? 'Heads' : 'Tails';
        document.getElementById('coin-result')!.textContent = result === 'Heads' ? 'ðŸª™ Heads' : 'ðŸª™ Tails';
      });
      document.querySelectorAll('.dice-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const sides = parseInt((btn as HTMLElement).dataset.sides || '6');
          document.getElementById('dice-result')!.textContent = 'ðŸŽ² ' + randInt(1, sides);
        });
      });
      document.getElementById('lottery-645')!.addEventListener('click', () => lotteryNums(6, 49));
      document.getElementById('lottery-powerball')!.addEventListener('click', () => lotteryNums(5, 69, 26));
      document.getElementById('lottery-mega')!.addEventListener('click', () => lotteryNums(5, 70, 25));
      generate();
      lotteryNums(6, 49);
    }, 50);
  </script>
</CalculatorLayout>
