---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Foundation Calculator - Concrete, Rebar & Form Estimator";
const description = "Calculate foundation concrete for walls and footings. Get cubic yards, rebar linear feet, and form board feet for your foundation project.";

const relatedCalcs = [
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume estimator." },
  { name: "Rebar Calculator", url: "/rebar-calculator", description: "Rebar requirements." },
  { name: "Excavation Calculator", url: "/excavation-calculator", description: "Dig volume estimator." },
  { name: "Structural Load Calculator", url: "/structural-load-calculator", description: "Load analysis." },
  { name: "Column Calculator", url: "/column-calculator", description: "Column sizing." },
  { name: "Floor Joist Calculator", url: "/floor-joist-calculator", description: "Joist sizing." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Foundation Calculator"
  keywords="foundation calculator, footing calculator, foundation concrete, rebar for foundation, form boards, foundation cost"
  breadcrumbs={[{ name: "Foundation Calculator", url: "/foundation-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Foundation Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate concrete, rebar, and formwork for foundation walls and footings.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Foundation Perimeter (ft)</label>
            <input type="number" id="fn-perim" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="140" min="0" step="1">
          </div>

          <h3 class="text-sm font-semibold text-text mb-3">Wall Dimensions</h3>
          <div class="grid grid-cols-2 gap-3 mb-5">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Wall Thickness (in)</label>
              <input type="number" id="fn-wallw" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="8" min="4" step="1">
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Wall Height (ft)</label>
              <input type="number" id="fn-wallh" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="8" min="0" step="0.5">
            </div>
          </div>

          <h3 class="text-sm font-semibold text-text mb-3">Footing Dimensions</h3>
          <div class="grid grid-cols-2 gap-3 mb-5">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Footing Width (in)</label>
              <input type="number" id="fn-footw" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="16" min="8" step="2">
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Footing Depth (in)</label>
              <input type="number" id="fn-footd" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="8" min="6" step="1">
            </div>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Waste Factor (%)</label>
              <input type="number" id="fn-waste" class="w-full px-3 py-2 border border-border rounded-lg" value="10" min="0" max="30" step="1">
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Concrete Needed</div>
            <div class="text-5xl font-extrabold font-mono" id="fn-total">0</div>
            <div class="text-sm text-blue-200 mt-1">cubic yards (walls + footings)</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Wall Concrete</div>
              <div class="text-xl font-bold" id="fn-wallyds">0 cu yd</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Footing Concrete</div>
              <div class="text-xl font-bold" id="fn-footyds">0 cu yd</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Rebar (linear ft)</div>
              <div class="text-xl font-bold" id="fn-rebar">0</div>
              <div class="text-xs text-text-muted">#4 bar horizontal + vertical</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Form Boards (bd ft)</div>
              <div class="text-xl font-bold" id="fn-forms">0</div>
              <div class="text-xs text-text-muted">both sides of wall</div>
            </div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Truck Loads (8 yd)</div>
            <div class="text-xl font-bold" id="fn-trucks">0</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="foundation" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Foundation Concrete</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Wall Volume:</strong> Perimeter x Thickness (ft) x Height (ft) / 27</p>
        <p><strong>Footing Volume:</strong> Perimeter x Width (ft) x Depth (ft) / 27</p>
        <p><strong>Total:</strong> (Wall + Footing) x (1 + Waste factor)</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Standard Foundation Sizes</h3>
      <ul>
        <li><strong>Residential wall:</strong> 8" thick, 8' high (standard basement)</li>
        <li><strong>Footing:</strong> 2x wall width, 8" deep minimum</li>
        <li><strong>Rebar:</strong> Horizontal every 2 courses, vertical every 4 ft</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcFoundation() {
      const perim = parseFloat((document.getElementById('fn-perim') as HTMLInputElement).value) || 0;
      const wallW = (parseFloat((document.getElementById('fn-wallw') as HTMLInputElement).value) || 8) / 12;
      const wallH = parseFloat((document.getElementById('fn-wallh') as HTMLInputElement).value) || 0;
      const footW = (parseFloat((document.getElementById('fn-footw') as HTMLInputElement).value) || 16) / 12;
      const footD = (parseFloat((document.getElementById('fn-footd') as HTMLInputElement).value) || 8) / 12;
      const waste = (parseFloat((document.getElementById('fn-waste') as HTMLInputElement).value) || 0) / 100;

      const wallCuFt = perim * wallW * wallH;
      const footCuFt = perim * footW * footD;
      const totalCuFt = (wallCuFt + footCuFt) * (1 + waste);

      const wallYds = wallCuFt * (1 + waste) / 27;
      const footYds = footCuFt * (1 + waste) / 27;
      const totalYds = totalCuFt / 27;

      // Rebar: 2 horizontal runs top and bottom of wall + every 2ft vertically
      // Plus 2 bars continuous in footing
      const horizRuns = 2;
      const vertSpacing = 2; // feet
      const vertBarsCount = Math.ceil(perim / vertSpacing);
      const horizRebarFt = perim * horizRuns * Math.ceil(wallH / vertSpacing);
      const vertRebarFt = vertBarsCount * wallH;
      const footingRebarFt = perim * 2; // 2 continuous bars
      const totalRebar = Math.ceil(horizRebarFt + vertRebarFt + footingRebarFt);

      // Form boards: both sides of wall, 1" thick plywood = 1 bd ft per sq ft face
      const formSqFt = perim * wallH * 2;
      const formBdFt = Math.ceil(formSqFt);

      const trucks = Math.ceil(totalYds / 8);

      document.getElementById('fn-total')!.textContent = totalYds.toFixed(1);
      document.getElementById('fn-wallyds')!.textContent = wallYds.toFixed(1) + ' cu yd';
      document.getElementById('fn-footyds')!.textContent = footYds.toFixed(1) + ' cu yd';
      document.getElementById('fn-rebar')!.textContent = totalRebar.toLocaleString();
      document.getElementById('fn-forms')!.textContent = formBdFt.toLocaleString();
      document.getElementById('fn-trucks')!.textContent = String(trucks);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('#fn-perim, #fn-wallw, #fn-wallh, #fn-footw, #fn-footd, #fn-waste').forEach(el => {
        el.addEventListener('input', calcFoundation);
        el.addEventListener('change', calcFoundation);
      });
      calcFoundation();
    }, 50);
  </script>
</CalculatorLayout>
