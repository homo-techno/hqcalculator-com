---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Length Converter - Convert Between Any Length Units";
const description = "Convert between inches, feet, yards, miles, centimeters, meters, kilometers, and more. Instant length and distance conversion.";

const relatedCalcs = [
  { name: "Temperature Converter", url: "/temperature-converter", description: "Temperature units." },
  { name: "Weight Converter", url: "/weight-converter", description: "Weight units." },
  { name: "Square Footage", url: "/square-footage-calculator", description: "Area calculator." },
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Pace Calculator", url: "/pace-calculator", description: "Running pace." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Length Converter"
  keywords="length converter, distance converter, inches to cm, feet to meters, miles to km, unit converter, measurement converter"
  breadcrumbs={[{ name: "Length Converter", url: "/length-converter" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Length Converter</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert between any length or distance units instantly.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="flex items-end gap-3 mb-6">
        <div class="flex-1">
          <label class="block text-sm font-medium text-text mb-1">Value</label>
          <input type="number" id="len-val" class="w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="1" step="any">
        </div>
        <div class="flex-1">
          <label class="block text-sm font-medium text-text mb-1">From</label>
          <select id="len-from" class="w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="m" selected>Meters (m)</option>
            <option value="cm">Centimeters (cm)</option>
            <option value="mm">Millimeters (mm)</option>
            <option value="km">Kilometers (km)</option>
            <option value="in">Inches (in)</option>
            <option value="ft">Feet (ft)</option>
            <option value="yd">Yards (yd)</option>
            <option value="mi">Miles (mi)</option>
            <option value="nm">Nautical Miles</option>
            <option value="um">Micrometers (μm)</option>
          </select>
        </div>
      </div>

      <div class="text-center text-text-muted text-2xl mb-4">↓ converts to ↓</div>

      <!-- All results -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-6" id="len-results"></div>

      <!-- Quick swaps -->
      <div class="flex flex-wrap gap-2 mb-6">
        <button class="len-swap px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-from="in" data-val="1">1 inch</button>
        <button class="len-swap px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-from="ft" data-val="1">1 foot</button>
        <button class="len-swap px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-from="mi" data-val="1">1 mile</button>
        <button class="len-swap px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-from="m" data-val="1">1 meter</button>
        <button class="len-swap px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-from="km" data-val="1">1 km</button>
        <button class="len-swap px-3 py-1 text-xs rounded-full border border-border hover:bg-surface-alt font-semibold" data-from="cm" data-val="100">100 cm</button>
      </div>

      <ShareButton calculatorId="length" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Length Conversion Reference</h2>
      <h3 class="text-xl font-semibold text-text mt-8">Imperial ↔ Metric</h3>
      <ul>
        <li>1 inch = 2.54 cm (exact)</li>
        <li>1 foot = 30.48 cm = 0.3048 m</li>
        <li>1 yard = 91.44 cm = 0.9144 m</li>
        <li>1 mile = 1.60934 km = 5,280 feet</li>
        <li>1 kilometer = 0.62137 miles</li>
        <li>1 meter = 3.28084 feet = 39.3701 inches</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How many cm in an inch?</strong> There are exactly 2.54 centimeters in one inch. This is a defined conversion factor.</p>
      <p><strong>How do I convert feet and inches to cm?</strong> Convert feet to inches first (multiply by 12), add remaining inches, then multiply by 2.54.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    // All values in meters as base
    const units: Record<string, { name: string; toM: number; abbr: string }> = {
      mm: { name: 'Millimeters', toM: 0.001, abbr: 'mm' },
      cm: { name: 'Centimeters', toM: 0.01, abbr: 'cm' },
      m: { name: 'Meters', toM: 1, abbr: 'm' },
      km: { name: 'Kilometers', toM: 1000, abbr: 'km' },
      in: { name: 'Inches', toM: 0.0254, abbr: 'in' },
      ft: { name: 'Feet', toM: 0.3048, abbr: 'ft' },
      yd: { name: 'Yards', toM: 0.9144, abbr: 'yd' },
      mi: { name: 'Miles', toM: 1609.344, abbr: 'mi' },
      nm: { name: 'Nautical Miles', toM: 1852, abbr: 'nmi' },
      um: { name: 'Micrometers', toM: 0.000001, abbr: 'μm' },
    };

    function formatNum(n: number): string {
      if (n === 0) return '0';
      if (Math.abs(n) >= 1e6 || (Math.abs(n) < 0.001 && n !== 0)) return n.toExponential(4);
      if (Number.isInteger(n)) return n.toLocaleString();
      return n.toLocaleString('en-US', { maximumSignificantDigits: 8 });
    }

    function calcLength() {
      const val = parseFloat((document.getElementById('len-val') as HTMLInputElement).value) || 0;
      const from = (document.getElementById('len-from') as HTMLSelectElement).value;
      const meters = val * units[from].toM;

      const container = document.getElementById('len-results')!;
      container.innerHTML = Object.entries(units).map(([key, u]) => {
        const converted = meters / u.toM;
        const isSource = key === from;
        return `<div class="p-4 rounded-xl text-center ${isSource ? 'bg-primary text-white' : 'bg-surface-alt'}">
          <div class="text-xs ${isSource ? 'text-blue-200' : 'text-text-muted'} uppercase">${u.name} (${u.abbr})</div>
          <div class="text-xl font-bold">${formatNum(converted)}</div>
        </div>`;
      }).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.getElementById('len-val')!.addEventListener('input', calcLength);
      document.getElementById('len-from')!.addEventListener('change', calcLength);

      document.querySelectorAll('.len-swap').forEach(btn => {
        btn.addEventListener('click', () => {
          (document.getElementById('len-val') as HTMLInputElement).value = (btn as HTMLElement).dataset.val || '1';
          (document.getElementById('len-from') as HTMLSelectElement).value = (btn as HTMLElement).dataset.from || 'm';
          calcLength();
        });
      });

      calcLength();
    }, 50);
  </script>
</CalculatorLayout>
