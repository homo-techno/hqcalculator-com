---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Aspect Ratio Crop Calculator - Crop Dimensions, Pixel Loss & Common Ratios";
const description = "Calculate crop dimensions for a target aspect ratio from your image. Find pixel loss, percentage retained, and compare common aspect ratios for photos and video.";
const relatedCalcs = [
  { name: "Aspect Ratio", url: "/aspect-ratio-calculator", description: "Aspect ratio calculations." },
  { name: "Photo Resolution", url: "/photo-resolution-calculator", description: "Resolution and megapixels." },
  { name: "Print Size", url: "/print-size-calculator", description: "Print from cropped images." },
  { name: "Pixel Calculator", url: "/pixel-calculator", description: "Pixel conversions." },
  { name: "Screen Size", url: "/screen-size-calculator", description: "Display dimensions." },
  { name: "Percentage", url: "/percentage-calculator", description: "Percentage calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Aspect Ratio Crop Calculator" keywords="aspect ratio crop calculator, crop dimensions, pixel loss, photo crop, video crop, aspect ratio conversion, image cropping" breadcrumbs={[{ name: "Aspect Ratio Crop", url: "/aspect-ratio-crop-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Aspect Ratio Crop Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate the exact crop dimensions, pixel loss, and retained area when converting between aspect ratios.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Source Width (px)</label>
            <input type="number" id="ac3-srcw" class="ac3-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="6000" min="1" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Source Height (px)</label>
            <input type="number" id="ac3-srch" class="ac3-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="4000" min="1" step="1">
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Target Aspect Ratio</label>
          <select id="ac3-ratio" class="ac3-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="16:9" selected>16:9 (Widescreen)</option>
            <option value="4:3">4:3 (Classic)</option>
            <option value="1:1">1:1 (Square)</option>
            <option value="3:2">3:2 (35mm Film)</option>
            <option value="5:4">5:4 (Large Format)</option>
            <option value="21:9">21:9 (Ultra-wide)</option>
            <option value="2.39:1">2.39:1 (Anamorphic)</option>
            <option value="9:16">9:16 (Vertical Video)</option>
            <option value="4:5">4:5 (Instagram Portrait)</option>
            <option value="2:3">2:3 (Portrait 35mm)</option>
            <option value="custom">Custom Ratio</option>
          </select>
        </div>
        <div id="ac3-custom-wrap" style="display:none">
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm font-medium text-text mb-1">Ratio Width</label>
              <input type="number" id="ac3-cw" class="ac3-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="16" min="1" step="1">
            </div>
            <div>
              <label class="block text-sm font-medium text-text mb-1">Ratio Height</label>
              <input type="number" id="ac3-ch" class="ac3-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="9" min="1" step="1">
            </div>
          </div>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Cropped Dimensions</div>
          <div class="text-4xl font-extrabold" id="ac3-crop"></div>
          <div class="text-sm text-blue-200 mt-1" id="ac3-retained"></div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Pixels Lost</div>
            <div class="text-xl font-bold text-text" id="ac3-lost"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Cropped MP</div>
            <div class="text-xl font-bold text-text" id="ac3-mp"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Source Aspect Ratio</div>
            <div class="text-xl font-bold text-text" id="ac3-src-ratio"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Crop Direction</div>
            <div class="text-xl font-bold text-text" id="ac3-direction"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Pixels Trimmed Each Side</div>
            <div class="text-xl font-bold text-text" id="ac3-trim"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Max Print at 300 DPI</div>
            <div class="text-xl font-bold text-text" id="ac3-print"></div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h4 class="font-semibold text-sm text-text mb-2">All Common Ratios Compared</h4>
          <div class="text-sm text-text-secondary space-y-1" id="ac3-all"></div>
        </div>
      </div>
      <ShareButton calculatorId="aspect-ratio-crop" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Cropping and Aspect Ratios</h2>
      <p>Cropping an image to a different aspect ratio always means losing pixels from one dimension. The calculator shows you exactly how much you lose and what the final usable resolution will be.</p>
      <p><strong>Tip:</strong> If you know your final output ratio, compose with that crop in mind while shooting. Some cameras offer aspect ratio guides in the viewfinder.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcAC3() {
      const srcW = parseInt((document.getElementById('ac3-srcw') as HTMLInputElement).value) || 6000;
      const srcH = parseInt((document.getElementById('ac3-srch') as HTMLInputElement).value) || 4000;
      const ratioStr = (document.getElementById('ac3-ratio') as HTMLSelectElement).value;

      let ratioW: number, ratioH: number;
      if (ratioStr === 'custom') {
        document.getElementById('ac3-custom-wrap')!.style.display = '';
        ratioW = parseFloat((document.getElementById('ac3-cw') as HTMLInputElement).value) || 16;
        ratioH = parseFloat((document.getElementById('ac3-ch') as HTMLInputElement).value) || 9;
      } else {
        document.getElementById('ac3-custom-wrap')!.style.display = 'none';
        const parts = ratioStr.split(':');
        ratioW = parseFloat(parts[0]);
        ratioH = parseFloat(parts[1]);
      }

      const targetRatio = ratioW / ratioH;
      const srcRatio = srcW / srcH;

      let cropW: number, cropH: number;
      let direction: string;

      if (srcRatio > targetRatio) {
        // Wider than target, crop width
        cropH = srcH;
        cropW = Math.round(srcH * targetRatio);
        direction = 'Width cropped (sides)';
      } else if (srcRatio < targetRatio) {
        // Taller than target, crop height
        cropW = srcW;
        cropH = Math.round(srcW / targetRatio);
        direction = 'Height cropped (top/bottom)';
      } else {
        cropW = srcW;
        cropH = srcH;
        direction = 'No crop needed';
      }

      const srcPixels = srcW * srcH;
      const cropPixels = cropW * cropH;
      const lostPixels = srcPixels - cropPixels;
      const retainedPct = (cropPixels / srcPixels * 100);

      document.getElementById('ac3-crop')!.textContent = cropW + ' x ' + cropH;
      document.getElementById('ac3-retained')!.textContent = retainedPct.toFixed(1) + '% of pixels retained';
      document.getElementById('ac3-lost')!.textContent = (lostPixels / 1000000).toFixed(1) + ' MP';
      document.getElementById('ac3-mp')!.textContent = (cropPixels / 1000000).toFixed(1) + ' MP';

      function gcd(a: number, b: number): number {
        a = Math.abs(Math.round(a)); b = Math.abs(Math.round(b));
        while (b) { [a, b] = [b, a % b]; } return a;
      }
      const g = gcd(srcW, srcH);
      document.getElementById('ac3-src-ratio')!.textContent = (srcW / g) + ':' + (srcH / g);
      document.getElementById('ac3-direction')!.textContent = direction;

      const trimW = Math.round((srcW - cropW) / 2);
      const trimH = Math.round((srcH - cropH) / 2);
      if (trimW > 0) {
        document.getElementById('ac3-trim')!.textContent = trimW + 'px left/right';
      } else if (trimH > 0) {
        document.getElementById('ac3-trim')!.textContent = trimH + 'px top/bottom';
      } else {
        document.getElementById('ac3-trim')!.textContent = 'None';
      }

      const printW = (cropW / 300).toFixed(1);
      const printH = (cropH / 300).toFixed(1);
      document.getElementById('ac3-print')!.textContent = printW + '" x ' + printH + '"';

      // All ratios comparison
      const ratios = [
        { name: '16:9', w: 16, h: 9 },
        { name: '4:3', w: 4, h: 3 },
        { name: '1:1', w: 1, h: 1 },
        { name: '3:2', w: 3, h: 2 },
        { name: '5:4', w: 5, h: 4 },
        { name: '21:9', w: 21, h: 9 },
        { name: '9:16', w: 9, h: 16 },
        { name: '4:5', w: 4, h: 5 },
      ];

      let html = '';
      ratios.forEach(r => {
        const tR = r.w / r.h;
        let cW: number, cH: number;
        if (srcRatio > tR) { cH = srcH; cW = Math.round(srcH * tR); }
        else { cW = srcW; cH = Math.round(srcW / tR); }
        const pct = (cW * cH / srcPixels * 100).toFixed(1);
        html += '<div class="flex justify-between"><span>' + r.name + '</span><span class="font-bold">' + cW + 'x' + cH + ' (' + pct + '% retained)</span></div>';
      });
      document.getElementById('ac3-all')!.innerHTML = html;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.ac3-in').forEach(el => {
        el.addEventListener('input', calcAC3);
        el.addEventListener('change', calcAC3);
      });
      calcAC3();
    }, 50);
  </script>
</CalculatorLayout>
