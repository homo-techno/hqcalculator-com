---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Metal Expansion Calculator - Thermal Expansion of Metals";
const description = "Calculate thermal expansion of metals. Find length change from temperature difference for steel, aluminum, copper, brass, titanium, and more.";

const relatedCalcs = [
  { name: "Annealing Temperature", url: "/annealing-temperature-calculator", description: "Heat treatment temps." },
  { name: "Welding Heat Input", url: "/welding-heat-input-calculator", description: "Heat input calculation." },
  { name: "Metal Weight Calculator", url: "/metal-weight-calculator", description: "Metal weight." },
  { name: "Metal Fatigue Calculator", url: "/metal-fatigue-calculator", description: "Fatigue life." },
  { name: "Structural Steel Calculator", url: "/structural-steel-calculator", description: "Steel section properties." },
  { name: "Pipe Notch Calculator", url: "/pipe-notch-calculator", description: "Pipe cope templates." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Metal Expansion Calculator"
  keywords="thermal expansion, metal expansion, coefficient of thermal expansion, CTE, length change, temperature change, steel expansion, aluminum expansion"
  breadcrumbs={[{ name: "Metal Expansion Calculator", url: "/metal-expansion-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Metal Expansion Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate how much a metal part expands or contracts with temperature change.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Material -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Material</label>
        <select id="me2-material" class="me2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="11.7">Carbon Steel (11.7)</option>
          <option value="17.3">Stainless Steel 304 (17.3)</option>
          <option value="23.6">Aluminum 6061 (23.6)</option>
          <option value="16.6">Copper (16.6)</option>
          <option value="18.7">Brass (18.7)</option>
          <option value="8.6">Titanium (8.6)</option>
          <option value="10.8">Cast Iron (10.8)</option>
          <option value="13.0">Nickel (13.0)</option>
          <option value="11.8">Inconel 625 (11.8)</option>
          <option value="29.0">Lead (29.0)</option>
          <option value="30.2">Zinc (30.2)</option>
          <option value="0">Custom (enter CTE below)</option>
        </select>
        <p class="text-xs text-text-muted mt-1">CTE in 10^-6 /degrees C</p>
      </div>

      <!-- Custom CTE -->
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">CTE (x10^-6 per degree C)</label>
        <input type="number" id="me2-cte" class="me2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="11.7" min="0" max="100" step="0.1">
      </div>

      <!-- Original Length -->
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Original Length</label>
          <input type="number" id="me2-length" class="me2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1000" min="0" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Length Unit</label>
          <select id="me2-lunit" class="me2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="mm">mm</option>
            <option value="in">inches</option>
            <option value="ft">feet</option>
            <option value="m">meters</option>
          </select>
        </div>
      </div>

      <!-- Temperature Change -->
      <div class="grid grid-cols-3 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Initial Temp</label>
          <input type="number" id="me2-temp1" class="me2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Final Temp</label>
          <input type="number" id="me2-temp2" class="me2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="200" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Temp Unit</label>
          <select id="me2-tunit" class="me2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="C">Celsius</option>
            <option value="F">Fahrenheit</option>
          </select>
        </div>
      </div>

      <!-- Results -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Length Change</div>
        <div class="text-4xl font-extrabold" id="me2-change">--</div>
        <div class="text-sm text-blue-200 mt-1" id="me2-changeunit">mm</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">New Length</div>
          <div class="text-xl font-bold" id="me2-newlen">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Change (%)</div>
          <div class="text-xl font-bold" id="me2-pct">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Temp Difference</div>
          <div class="text-xl font-bold" id="me2-dt">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Thermal Stress (if fixed)</div>
          <div class="text-xl font-bold" id="me2-stress">--</div>
          <div class="text-xs text-text-muted">MPa (approx)</div>
        </div>
      </div>

      <ShareButton calculatorId="metal-expansion" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Thermal Expansion Formula</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm">
        <p><strong>dL = alpha x L x dT</strong></p>
        <p>dL = change in length, alpha = CTE, L = original length, dT = temperature change</p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">Why It Matters</h3>
      <ul>
        <li>Welded structures can develop significant thermal stresses if expansion is restrained</li>
        <li>Piping systems need expansion joints or loops for temperature cycling</li>
        <li>Machined parts with tight tolerances must account for shop vs. service temperature</li>
        <li>Dissimilar metal joints expand at different rates, causing stress at the interface</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcME2() {
      let cte = parseFloat((document.getElementById('me2-cte') as HTMLInputElement).value) || 0;
      const length = parseFloat((document.getElementById('me2-length') as HTMLInputElement).value) || 0;
      const lUnit = (document.getElementById('me2-lunit') as HTMLSelectElement).value;
      const temp1 = parseFloat((document.getElementById('me2-temp1') as HTMLInputElement).value) || 0;
      const temp2 = parseFloat((document.getElementById('me2-temp2') as HTMLInputElement).value) || 0;
      const tUnit = (document.getElementById('me2-tunit') as HTMLSelectElement).value;

      // CTE in per degree C (x10^-6)
      const alpha = cte * 1e-6;

      // Temperature difference in C
      let dT = temp2 - temp1;
      if (tUnit === 'F') dT = dT * 5 / 9;

      // Length in mm
      let L_mm = length;
      if (lUnit === 'in') L_mm = length * 25.4;
      else if (lUnit === 'ft') L_mm = length * 304.8;
      else if (lUnit === 'm') L_mm = length * 1000;

      // Change in length (mm)
      const dL_mm = alpha * L_mm * dT;
      const newLen_mm = L_mm + dL_mm;
      const pct = L_mm > 0 ? (dL_mm / L_mm) * 100 : 0;

      // Convert back to user unit
      let dL_disp = dL_mm;
      let newLen_disp = newLen_mm;
      if (lUnit === 'in') { dL_disp = dL_mm / 25.4; newLen_disp = newLen_mm / 25.4; }
      else if (lUnit === 'ft') { dL_disp = dL_mm / 304.8; newLen_disp = newLen_mm / 304.8; }
      else if (lUnit === 'm') { dL_disp = dL_mm / 1000; newLen_disp = newLen_mm / 1000; }

      // Thermal stress if fully restrained: sigma = E * alpha * dT
      // Use approximate E for steel (200 GPa) - this is illustrative
      const E_MPa = 200000;
      const thermalStress = E_MPa * alpha * Math.abs(dT);

      const dT_disp = tUnit === 'F' ? (temp2 - temp1) : dT;
      const dT_unit = tUnit === 'F' ? ' \u00B0F' : ' \u00B0C';

      document.getElementById('me2-change')!.textContent = dL_disp.toFixed(4);
      document.getElementById('me2-changeunit')!.textContent = lUnit;
      document.getElementById('me2-newlen')!.textContent = newLen_disp.toFixed(4) + ' ' + lUnit;
      document.getElementById('me2-pct')!.textContent = pct.toFixed(4) + '%';
      document.getElementById('me2-dt')!.textContent = dT_disp.toFixed(1) + dT_unit;
      document.getElementById('me2-stress')!.textContent = thermalStress.toFixed(1);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      // Update CTE when material changes
      document.getElementById('me2-material')!.addEventListener('change', () => {
        const val = (document.getElementById('me2-material') as HTMLSelectElement).value;
        if (val !== '0') {
          (document.getElementById('me2-cte') as HTMLInputElement).value = val;
        }
        calcME2();
      });

      document.querySelectorAll('.me2-in').forEach(el => {
        el.addEventListener('input', calcME2);
        el.addEventListener('change', calcME2);
      });
      calcME2();
    }, 50);
  </script>
</CalculatorLayout>
