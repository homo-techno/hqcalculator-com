---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Baby Growth Percentile Calculator";
const description = "Track your baby's weight and length percentiles using WHO growth chart data.";
const relatedCalcs = [
  { name: "Pregnancy Week", url: "/pregnancy-week-calculator", description: "Pregnancy." },
  { name: "Due Date", url: "/due-date-calculator", description: "Due date." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "BMI." },
  { name: "Age Calculator", url: "/age-calculator", description: "Age." },
  { name: "Height Converter", url: "/height-converter", description: "Height." },
  { name: "Weight Converter", url: "/weight-converter", description: "Weight." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Baby Growth Calculator" keywords="baby growth percentile, infant weight chart, baby length, WHO growth chart, child development" breadcrumbs={[{ name: "Baby Growth", url: "/baby-growth-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Baby Growth Percentile Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Check weight and length percentiles for infants 0-24 months.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="flex gap-2">
          <button class="bg-gen flex-1 py-2 rounded-xl font-bold text-sm border-2 border-primary bg-blue-50 text-primary" data-g="boy">Boy</button>
          <button class="bg-gen flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-g="girl">Girl</button>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Age (months)</label><input type="number" id="bg-age" class="bg-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="6" min="0" max="24" step="1"></div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Weight (lbs)</label><input type="number" id="bg-wt" class="bg-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="16.5" min="1" max="50" step="0.1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Length (inches)</label><input type="number" id="bg-len" class="bg-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="26" min="15" max="40" step="0.25"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Weight Percentile</div>
          <div class="text-5xl font-extrabold font-mono" id="bg-result">50th</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Length Percentile</div><div class="text-xl font-bold font-mono" id="bg-len-pct">50th</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Weight (kg)</div><div class="text-xl font-bold font-mono" id="bg-kg">0</div></div>
        </div>
        <div class="p-4 rounded-xl text-center" id="bg-status-box"><div class="font-bold text-sm" id="bg-status">-</div></div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Average Ranges at This Age</h3>
          <div class="text-xs space-y-1" id="bg-table"></div>
        </div>
      </div>
      <ShareButton calculatorId="baby-growth" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    let bgGender = 'boy';
    const BOY_WT_50: Record<number, number> = { 0: 3.3, 1: 4.5, 2: 5.6, 3: 6.4, 4: 7.0, 5: 7.5, 6: 7.9, 7: 8.3, 8: 8.6, 9: 8.9, 10: 9.2, 11: 9.4, 12: 9.6, 15: 10.3, 18: 10.9, 21: 11.5, 24: 12.2 };
    const GIRL_WT_50: Record<number, number> = { 0: 3.2, 1: 4.2, 2: 5.1, 3: 5.8, 4: 6.4, 5: 6.9, 6: 7.3, 7: 7.6, 8: 7.9, 9: 8.2, 10: 8.5, 11: 8.7, 12: 8.9, 15: 9.6, 18: 10.2, 21: 10.9, 24: 11.5 };
    const BOY_LEN_50: Record<number, number> = { 0: 49.9, 1: 54.7, 2: 58.4, 3: 61.4, 4: 63.9, 5: 65.9, 6: 67.6, 7: 69.2, 8: 70.6, 9: 72.0, 10: 73.3, 11: 74.5, 12: 75.7, 15: 79.1, 18: 82.3, 21: 85.1, 24: 87.8 };
    const GIRL_LEN_50: Record<number, number> = { 0: 49.1, 1: 53.7, 2: 57.1, 3: 59.8, 4: 62.1, 5: 64.0, 6: 65.7, 7: 67.3, 8: 68.7, 9: 70.1, 10: 71.5, 11: 72.8, 12: 74.0, 15: 77.5, 18: 80.7, 21: 83.7, 24: 86.4 };
    function getClosest(table: Record<number, number>, age: number): number {
      const keys = Object.keys(table).map(Number).sort((a, b) => a - b);
      let closest = keys[0];
      for (const k of keys) { if (k <= age) closest = k; }
      return table[closest];
    }
    function estimatePercentile(value: number, median: number): number {
      const z = (value - median) / (median * 0.12);
      const p = 0.5 * (1 + Math.tanh(z * 0.7));
      return Math.max(1, Math.min(99, Math.round(p * 100)));
    }
    function calcBG() {
      const age = parseInt((document.getElementById('bg-age') as HTMLInputElement).value) || 0;
      const wtLbs = parseFloat((document.getElementById('bg-wt') as HTMLInputElement).value) || 0;
      const lenIn = parseFloat((document.getElementById('bg-len') as HTMLInputElement).value) || 0;
      const wtKg = wtLbs * 0.453592;
      const lenCm = lenIn * 2.54;
      const wtTable = bgGender === 'boy' ? BOY_WT_50 : GIRL_WT_50;
      const lenTable = bgGender === 'boy' ? BOY_LEN_50 : GIRL_LEN_50;
      const medWt = getClosest(wtTable, age);
      const medLen = getClosest(lenTable, age);
      const wtPct = estimatePercentile(wtKg, medWt);
      const lenPct = estimatePercentile(lenCm, medLen);
      document.getElementById('bg-result')!.textContent = wtPct + 'th';
      document.getElementById('bg-len-pct')!.textContent = lenPct + 'th';
      document.getElementById('bg-kg')!.textContent = wtKg.toFixed(1) + ' kg';
      let status: string, color: string;
      if (wtPct >= 5 && wtPct <= 95) { status = 'Within normal range'; color = 'bg-green-50 text-green-800'; }
      else if (wtPct < 5) { status = 'Below 5th percentile — consult pediatrician'; color = 'bg-yellow-50 text-yellow-800'; }
      else { status = 'Above 95th percentile — consult pediatrician'; color = 'bg-yellow-50 text-yellow-800'; }
      document.getElementById('bg-status')!.textContent = status;
      document.getElementById('bg-status-box')!.className = `p-4 rounded-xl text-center ${color}`;
      document.getElementById('bg-table')!.innerHTML = [
        `<div class="flex justify-between"><span>50th %ile weight</span><span>${(medWt * 2.205).toFixed(1)} lbs (${medWt.toFixed(1)} kg)</span></div>`,
        `<div class="flex justify-between"><span>50th %ile length</span><span>${(medLen / 2.54).toFixed(1)} in (${medLen.toFixed(1)} cm)</span></div>`,
        `<div class="flex justify-between"><span>Your baby's weight</span><span>${wtLbs} lbs (${wtKg.toFixed(1)} kg)</span></div>`,
        `<div class="flex justify-between"><span>Your baby's length</span><span>${lenIn} in (${lenCm.toFixed(1)} cm)</span></div>`,
      ].join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.bg-gen').forEach(b => b.addEventListener('click', () => {
        bgGender = (b as HTMLButtonElement).dataset.g!;
        document.querySelectorAll('.bg-gen').forEach(btn => {
          const active = (btn as HTMLButtonElement).dataset.g === bgGender;
          (btn as HTMLButtonElement).className = `bg-gen flex-1 py-2 rounded-xl font-bold text-sm border-2 ${active ? 'border-primary bg-blue-50 text-primary' : 'border-border text-text-muted'}`;
        });
        calcBG();
      }));
      document.querySelectorAll('.bg-in').forEach(el => { el.addEventListener('input', calcBG); el.addEventListener('change', calcBG); });
      calcBG();
    }, 50);
  </script>
</CalculatorLayout>
