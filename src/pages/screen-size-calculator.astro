---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Screen Size Calculator - PPI, Aspect Ratio & Display Size";
const description = "Calculate screen dimensions, PPI (pixels per inch), aspect ratio, and compare display sizes. Works for monitors, TVs, phones, and tablets.";

const relatedCalcs = [
  { name: "Aspect Ratio", url: "/aspect-ratio-calculator", description: "Aspect ratios." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Length Converter", url: "/length-converter", description: "Length units." },
  { name: "Square Footage", url: "/square-footage-calculator", description: "Area calculator." },
  { name: "Ratio Calculator", url: "/ratio-calculator", description: "Ratios." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Screen Size Calculator"
  keywords="screen size calculator, PPI calculator, pixels per inch, display size, monitor size, aspect ratio, screen dimensions"
  breadcrumbs={[{ name: "Screen Size", url: "/screen-size-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Screen Size Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate screen PPI, dimensions, and area from diagonal size and resolution.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="space-y-4 mb-5">
            <div>
              <label class="block text-sm font-medium text-text mb-1">Diagonal Size (inches)</label>
              <input type="number" id="sc-diag" class="w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="27" min="1" step="0.1">
            </div>
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Horizontal Pixels</label>
                <input type="number" id="sc-px-w" class="w-full px-3 py-3 border border-border rounded-xl text-lg text-center" value="2560" min="1" step="1">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Vertical Pixels</label>
                <input type="number" id="sc-px-h" class="w-full px-3 py-3 border border-border rounded-xl text-lg text-center" value="1440" min="1" step="1">
              </div>
            </div>
          </div>

          <!-- Presets -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-2">Common Presets</h3>
            <div class="grid grid-cols-2 gap-2">
              <button class="sc-preset px-2 py-1.5 text-xs rounded-lg border border-border hover:bg-white font-semibold" data-d="6.1" data-w="2556" data-h="1179">iPhone 15 (6.1")</button>
              <button class="sc-preset px-2 py-1.5 text-xs rounded-lg border border-border hover:bg-white font-semibold" data-d="6.7" data-w="2796" data-h="1290">iPhone 15 Pro Max</button>
              <button class="sc-preset px-2 py-1.5 text-xs rounded-lg border border-border hover:bg-white font-semibold" data-d="13.6" data-w="2560" data-h="1664">MacBook Air 13"</button>
              <button class="sc-preset px-2 py-1.5 text-xs rounded-lg border border-border hover:bg-white font-semibold" data-d="24" data-w="1920" data-h="1080">24" FHD Monitor</button>
              <button class="sc-preset px-2 py-1.5 text-xs rounded-lg border border-border hover:bg-white font-semibold" data-d="27" data-w="2560" data-h="1440">27" QHD Monitor</button>
              <button class="sc-preset px-2 py-1.5 text-xs rounded-lg border border-border hover:bg-white font-semibold" data-d="32" data-w="3840" data-h="2160">32" 4K Monitor</button>
              <button class="sc-preset px-2 py-1.5 text-xs rounded-lg border border-border hover:bg-white font-semibold" data-d="55" data-w="3840" data-h="2160">55" 4K TV</button>
              <button class="sc-preset px-2 py-1.5 text-xs rounded-lg border border-border hover:bg-white font-semibold" data-d="65" data-w="3840" data-h="2160">65" 4K TV</button>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Pixels Per Inch</div>
            <div class="text-5xl font-extrabold" id="sc-ppi">109</div>
            <div class="text-sm text-blue-200 mt-1">PPI</div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Width</div>
              <div class="text-xl font-bold" id="sc-width">23.5"</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Height</div>
              <div class="text-xl font-bold" id="sc-height">13.2"</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Aspect Ratio</div>
              <div class="text-xl font-bold" id="sc-ratio">16:9</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Screen Area</div>
              <div class="text-xl font-bold" id="sc-area">0 in²</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Pixels</div>
              <div class="text-xl font-bold" id="sc-total-px">0 MP</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Resolution Name</div>
              <div class="text-xl font-bold" id="sc-res-name">QHD</div>
            </div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="screen-size" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How PPI is Calculated</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Diagonal Pixels</strong> = √(Width² + Height²)</p>
        <p><strong>PPI</strong> = Diagonal Pixels ÷ Diagonal Inches</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What PPI is considered "Retina"?</strong> Apple considers a display "Retina" when pixels aren't individually visible at typical viewing distance — roughly 220+ PPI for phones, 200+ for tablets, and 100+ for monitors.</p>
      <p><strong>Is higher PPI always better?</strong> Higher PPI means sharper text and images, but beyond a certain point the human eye can't distinguish the difference at normal viewing distances.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function gcd(a: number, b: number): number {
      a = Math.abs(Math.round(a)); b = Math.abs(Math.round(b));
      while (b) { [a, b] = [b, a % b]; } return a;
    }

    function getResName(w: number, h: number): string {
      const p = Math.max(w, h);
      if (p >= 7680) return '8K UHD';
      if (p >= 5120) return '5K';
      if (p >= 3840) return '4K UHD';
      if (p >= 2560 && Math.min(w, h) >= 1440) return 'QHD';
      if (p >= 2560) return 'WQHD';
      if (p >= 1920) return 'FHD';
      if (p >= 1280) return 'HD';
      return 'SD';
    }

    function calcScreen() {
      const diag = parseFloat((document.getElementById('sc-diag') as HTMLInputElement).value) || 0;
      const pxW = parseInt((document.getElementById('sc-px-w') as HTMLInputElement).value) || 0;
      const pxH = parseInt((document.getElementById('sc-px-h') as HTMLInputElement).value) || 0;

      const diagPx = Math.sqrt(pxW ** 2 + pxH ** 2);
      const ppi = diag > 0 ? diagPx / diag : 0;

      const aspectGcd = gcd(pxW, pxH);
      const ratioW = aspectGcd > 0 ? pxW / aspectGcd : 0;
      const ratioH = aspectGcd > 0 ? pxH / aspectGcd : 0;

      const angle = Math.atan(pxH / pxW);
      const widthIn = diag * Math.cos(angle);
      const heightIn = diag * Math.sin(angle);
      const area = widthIn * heightIn;

      document.getElementById('sc-ppi')!.textContent = Math.round(ppi).toString();
      document.getElementById('sc-width')!.textContent = widthIn.toFixed(1) + '"';
      document.getElementById('sc-height')!.textContent = heightIn.toFixed(1) + '"';

      // Simplify common ratios
      let ratioStr = `${ratioW}:${ratioH}`;
      if (ratioW === 8 && ratioH === 5) ratioStr = '16:10';
      document.getElementById('sc-ratio')!.textContent = ratioStr;

      document.getElementById('sc-area')!.textContent = area.toFixed(1) + ' in²';
      const totalMP = (pxW * pxH) / 1e6;
      document.getElementById('sc-total-px')!.textContent = totalMP.toFixed(2) + ' MP';
      document.getElementById('sc-res-name')!.textContent = getResName(pxW, pxH);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      ['sc-diag', 'sc-px-w', 'sc-px-h'].forEach(id => {
        document.getElementById(id)!.addEventListener('input', calcScreen);
      });

      document.querySelectorAll('.sc-preset').forEach(btn => {
        btn.addEventListener('click', () => {
          const el = btn as HTMLElement;
          (document.getElementById('sc-diag') as HTMLInputElement).value = el.dataset.d || '27';
          (document.getElementById('sc-px-w') as HTMLInputElement).value = el.dataset.w || '1920';
          (document.getElementById('sc-px-h') as HTMLInputElement).value = el.dataset.h || '1080';
          calcScreen();
        });
      });

      calcScreen();
    }, 50);
  </script>
</CalculatorLayout>
