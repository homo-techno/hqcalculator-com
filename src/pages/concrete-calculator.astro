---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Concrete Calculator - Yards, Bags & Cost Estimator";
const description = "Calculate concrete needed in cubic yards and bags. Supports slabs, footings, columns, and stairs. Get cost estimates and order quantities.";

const relatedCalcs = [
  { name: "Square Footage", url: "/square-footage-calculator", description: "Area calculator." },
  { name: "Length Converter", url: "/length-converter", description: "Length units." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Mortgage Calculator", url: "/mortgage-calculator", description: "Home loans." },
  { name: "Loan Calculator", url: "/loan-calculator", description: "Loan payments." },
  { name: "Weight Converter", url: "/weight-converter", description: "Weight units." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Concrete Calculator"
  keywords="concrete calculator, cubic yards, concrete bags, concrete cost, slab calculator, footing calculator, how much concrete"
  breadcrumbs={[{ name: "Concrete Calculator", url: "/concrete-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Concrete Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate how much concrete you need for slabs, footings, columns, and more.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <!-- Shape -->
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Project Type</label>
            <div class="grid grid-cols-2 gap-2">
              <button class="cc-shape-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary" data-shape="slab">Slab / Square</button>
              <button class="cc-shape-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-shape="footing">Wall / Footing</button>
              <button class="cc-shape-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-shape="column">Column / Tube</button>
              <button class="cc-shape-btn px-3 py-2.5 rounded-xl text-sm font-semibold border border-border" data-shape="stairs">Stairs</button>
            </div>
          </div>

          <!-- Slab -->
          <div id="cc-slab">
            <div class="grid grid-cols-3 gap-3 mb-5">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Length (ft)</label>
                <input type="number" id="cc-length" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="20" min="0" step="0.5">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Width (ft)</label>
                <input type="number" id="cc-width" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="10" min="0" step="0.5">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Depth (in)</label>
                <input type="number" id="cc-depth" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="4" min="0" step="0.5">
              </div>
            </div>
          </div>

          <!-- Column -->
          <div id="cc-column" class="hidden">
            <div class="grid grid-cols-3 gap-3 mb-5">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Diameter (in)</label>
                <input type="number" id="cc-diameter" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="12" min="0" step="1">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Height (ft)</label>
                <input type="number" id="cc-col-height" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="4" min="0" step="0.5">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Quantity</label>
                <input type="number" id="cc-col-qty" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="4" min="1" step="1">
              </div>
            </div>
          </div>

          <!-- Stairs -->
          <div id="cc-stairs" class="hidden">
            <div class="grid grid-cols-2 gap-3 mb-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Width (ft)</label>
                <input type="number" id="cc-stair-width" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="4" min="0" step="0.5">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Number of Steps</label>
                <input type="number" id="cc-steps" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="5" min="1" step="1">
              </div>
            </div>
            <div class="grid grid-cols-2 gap-3 mb-5">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Tread Depth (in)</label>
                <input type="number" id="cc-tread" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="10" min="0" step="0.5">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Rise Height (in)</label>
                <input type="number" id="cc-rise" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="7" min="0" step="0.5">
              </div>
            </div>
          </div>

          <!-- Waste factor & cost -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Waste Factor (%)</label>
                <input type="number" id="cc-waste" class="w-full px-3 py-2 border border-border rounded-lg" value="10" min="0" max="50" step="1">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Cost per Cubic Yard</label>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
                  <input type="number" id="cc-cost" class="w-full pl-7 pr-3 py-2 border border-border rounded-lg" value="150" min="0" step="5">
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Concrete Needed</div>
            <div class="text-4xl font-extrabold" id="cc-yards">0</div>
            <div class="text-sm text-blue-200 mt-1">cubic yards (incl. waste)</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Cubic Feet</div>
              <div class="text-xl font-bold" id="cc-cuft">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Cubic Meters</div>
              <div class="text-xl font-bold" id="cc-cum">0</div>
            </div>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-3">Bags Needed</h3>
            <div class="grid grid-cols-3 gap-3 text-center">
              <div>
                <div class="text-xs text-text-muted">40 lb bags</div>
                <div class="text-2xl font-bold" id="cc-bags40">0</div>
                <div class="text-xs text-text-muted">0.011 yd³/bag</div>
              </div>
              <div>
                <div class="text-xs text-text-muted">60 lb bags</div>
                <div class="text-2xl font-bold" id="cc-bags60">0</div>
                <div class="text-xs text-text-muted">0.017 yd³/bag</div>
              </div>
              <div>
                <div class="text-xs text-text-muted">80 lb bags</div>
                <div class="text-2xl font-bold" id="cc-bags80">0</div>
                <div class="text-xs text-text-muted">0.022 yd³/bag</div>
              </div>
            </div>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Estimated Cost</div>
            <div class="text-3xl font-bold text-secondary" id="cc-total-cost">$0</div>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Weight (approx)</div>
            <div class="text-xl font-bold" id="cc-weight">0 lbs</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="concrete" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Concrete</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Slab:</strong> Volume = Length (ft) × Width (ft) × Depth (in) ÷ 12 ÷ 27 = cubic yards</p>
        <p><strong>Column:</strong> Volume = π × (Diameter/2)² × Height ÷ 1728 ÷ 27 = cubic yards</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Tips for Ordering Concrete</h3>
      <ul>
        <li><strong>Always add 10% extra</strong> for waste, spillage, and uneven surfaces</li>
        <li>Ready-mix trucks typically carry 8-10 cubic yards</li>
        <li>For small projects (< 1 yard), bags may be more economical</li>
        <li>Standard concrete weighs about 4,050 lbs per cubic yard</li>
        <li>Set time is typically 24-48 hours; full cure takes 28 days</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How many bags of concrete for 1 cubic yard?</strong> About 45 bags of 80 lb mix, 60 bags of 60 lb mix, or 90 bags of 40 lb mix.</p>
      <p><strong>What thickness for a driveway?</strong> Standard is 4 inches. Heavy-duty driveways should be 5-6 inches.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let ccShape = 'slab';

    function calcConcrete() {
      let cuFt = 0;
      const waste = (parseFloat((document.getElementById('cc-waste') as HTMLInputElement).value) || 0) / 100;
      const costPerYard = parseFloat((document.getElementById('cc-cost') as HTMLInputElement).value) || 0;

      if (ccShape === 'slab' || ccShape === 'footing') {
        const l = parseFloat((document.getElementById('cc-length') as HTMLInputElement).value) || 0;
        const w = parseFloat((document.getElementById('cc-width') as HTMLInputElement).value) || 0;
        const d = (parseFloat((document.getElementById('cc-depth') as HTMLInputElement).value) || 0) / 12;
        cuFt = l * w * d;
      } else if (ccShape === 'column') {
        const d = (parseFloat((document.getElementById('cc-diameter') as HTMLInputElement).value) || 0) / 12;
        const h = parseFloat((document.getElementById('cc-col-height') as HTMLInputElement).value) || 0;
        const qty = parseInt((document.getElementById('cc-col-qty') as HTMLInputElement).value) || 1;
        cuFt = Math.PI * (d / 2) ** 2 * h * qty;
      } else if (ccShape === 'stairs') {
        const w = parseFloat((document.getElementById('cc-stair-width') as HTMLInputElement).value) || 0;
        const steps = parseInt((document.getElementById('cc-steps') as HTMLInputElement).value) || 0;
        const tread = (parseFloat((document.getElementById('cc-tread') as HTMLInputElement).value) || 0) / 12;
        const rise = (parseFloat((document.getElementById('cc-rise') as HTMLInputElement).value) || 0) / 12;
        // Each step is a rectangular block: width × tread × (rise × step number from top)
        for (let i = 1; i <= steps; i++) {
          cuFt += w * tread * rise;
        }
        // Plus the base platform
        cuFt += w * tread * rise * steps / 2;
      }

      const cuFtWithWaste = cuFt * (1 + waste);
      const cuYards = cuFtWithWaste / 27;
      const cuMeters = cuFtWithWaste * 0.0283168;

      const fmt = (n: number) => n.toLocaleString('en-US', { maximumFractionDigits: 2 });

      document.getElementById('cc-yards')!.textContent = cuYards.toFixed(2);
      document.getElementById('cc-cuft')!.textContent = fmt(cuFtWithWaste);
      document.getElementById('cc-cum')!.textContent = cuMeters.toFixed(2);

      // Bags
      document.getElementById('cc-bags40')!.textContent = String(Math.ceil(cuYards / 0.011));
      document.getElementById('cc-bags60')!.textContent = String(Math.ceil(cuYards / 0.017));
      document.getElementById('cc-bags80')!.textContent = String(Math.ceil(cuYards / 0.022));

      document.getElementById('cc-total-cost')!.textContent = '$' + Math.round(cuYards * costPerYard).toLocaleString();
      document.getElementById('cc-weight')!.textContent = Math.round(cuYards * 4050).toLocaleString() + ' lbs';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.cc-shape-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.cc-shape-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          ccShape = (btn as HTMLElement).dataset.shape || 'slab';
          document.getElementById('cc-slab')!.classList.toggle('hidden', ccShape !== 'slab' && ccShape !== 'footing');
          document.getElementById('cc-column')!.classList.toggle('hidden', ccShape !== 'column');
          document.getElementById('cc-stairs')!.classList.toggle('hidden', ccShape !== 'stairs');
          calcConcrete();
        });
      });

      ['cc-length', 'cc-width', 'cc-depth', 'cc-diameter', 'cc-col-height', 'cc-col-qty',
       'cc-stair-width', 'cc-steps', 'cc-tread', 'cc-rise', 'cc-waste', 'cc-cost'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcConcrete);
      });

      calcConcrete();
    }, 50);
  </script>
</CalculatorLayout>
