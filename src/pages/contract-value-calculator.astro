---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Contract Value Calculator - Present Value with Escalation Clauses";
const description = "Calculate the present value of contract payments over time, including annual escalation clauses, discount rates, and payment schedules.";
const relatedCalcs = [
  { name: "Legal Fee Calculator", url: "/legal-fee-calculator", description: "Attorney costs." },
  { name: "Litigation Cost Calculator", url: "/litigation-cost-calculator", description: "Litigation expenses." },
  { name: "Legal Billing Calculator", url: "/legal-billing-calculator", description: "Track billable hours." },
  { name: "Arbitration Cost Calculator", url: "/arbitration-cost-calculator", description: "ADR cost comparison." },
  { name: "Compliance Cost Calculator", url: "/compliance-cost-calculator", description: "Compliance budgeting." },
  { name: "Probate Cost Calculator", url: "/probate-cost-calculator", description: "Estate valuation." },
];
---

<CalculatorLayout title={title} description={description} calculatorName="Contract Value Calculator" keywords="contract value calculator, present value, escalation clause, contract payments, NPV, discount rate, contract analysis" breadcrumbs={[{ name: "Contract Value", url: "/contract-value-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Contract Value Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate the present value of contract payments with escalation clauses and discount rates.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Initial Annual Payment ($)</label>
          <input type="number" id="cv2-payment" class="cv2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="120000" min="0" step="1000">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Contract Duration (years)</label>
          <input type="number" id="cv2-years" class="cv2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="1" max="30" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Payment Frequency</label>
          <select id="cv2-freq" class="cv2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="monthly" selected>Monthly</option>
            <option value="quarterly">Quarterly</option>
            <option value="annual">Annual</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Annual Escalation Rate (%)</label>
          <input type="number" id="cv2-escalation" class="cv2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3" min="0" max="20" step="0.5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Discount Rate / Cost of Capital (%)</label>
          <input type="number" id="cv2-discount" class="cv2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="0" max="30" step="0.5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Upfront Signing Bonus ($)</label>
          <input type="number" id="cv2-bonus" class="cv2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0" min="0" step="1000">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Early Termination Penalty ($)</label>
          <input type="number" id="cv2-penalty" class="cv2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0" min="0" step="1000">
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Present Value of Contract</div>
          <div class="text-5xl font-extrabold font-mono" id="cv2-npv"></div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Nominal Value</div>
            <div class="text-xl font-bold text-secondary" id="cv2-nominal"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Final Year Payment</div>
            <div class="text-xl font-bold" id="cv2-final"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Escalation</div>
            <div class="text-xl font-bold text-orange-600" id="cv2-escalation-total"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Discount Savings</div>
            <div class="text-xl font-bold text-green-600" id="cv2-discount-amt"></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="contract-value" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Understanding Contract Valuation</h2>
      <p>The present value (PV) of a contract represents what all future payments are worth today, accounting for the time value of money. Escalation clauses increase payments annually (commonly 2-5%) to keep pace with inflation or market rates. A higher discount rate reduces the present value, reflecting greater risk or opportunity cost.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Negotiation Insights</h3>
      <p>Understanding the NPV helps in negotiating contract terms. A lower escalation rate benefits the payer, while the payee benefits from higher escalation. The discount rate should reflect your cost of capital or the risk-adjusted return you could earn elsewhere.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const fmt = (n: number) => '$' + Math.round(n).toLocaleString();

    function calcCV2() {
      const annualPayment = parseFloat((document.getElementById('cv2-payment') as HTMLInputElement).value) || 0;
      const years = parseInt((document.getElementById('cv2-years') as HTMLInputElement).value) || 1;
      const freq = (document.getElementById('cv2-freq') as HTMLSelectElement).value;
      const escalation = parseFloat((document.getElementById('cv2-escalation') as HTMLInputElement).value) / 100 || 0;
      const discountRate = parseFloat((document.getElementById('cv2-discount') as HTMLInputElement).value) / 100 || 0;
      const bonus = parseFloat((document.getElementById('cv2-bonus') as HTMLInputElement).value) || 0;

      const periodsPerYear = freq === 'monthly' ? 12 : freq === 'quarterly' ? 4 : 1;
      const periodRate = discountRate / periodsPerYear;

      let npv = bonus;
      let totalNominal = bonus;
      let finalYearPayment = annualPayment;

      for (let y = 0; y < years; y++) {
        const yearPayment = annualPayment * Math.pow(1 + escalation, y);
        const periodPayment = yearPayment / periodsPerYear;
        finalYearPayment = yearPayment;

        for (let p = 0; p < periodsPerYear; p++) {
          const period = y * periodsPerYear + p + 1;
          npv += periodPayment / Math.pow(1 + periodRate, period);
          totalNominal += periodPayment;
        }
      }

      const escalationTotal = totalNominal - bonus - (annualPayment * years);
      const discountSavings = totalNominal - npv;

      document.getElementById('cv2-npv')!.textContent = fmt(npv);
      document.getElementById('cv2-nominal')!.textContent = fmt(totalNominal);
      document.getElementById('cv2-final')!.textContent = fmt(finalYearPayment);
      document.getElementById('cv2-escalation-total')!.textContent = '+' + fmt(Math.max(0, escalationTotal));
      document.getElementById('cv2-discount-amt')!.textContent = fmt(discountSavings);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.cv2-in').forEach(el => {
        el.addEventListener('input', calcCV2);
        el.addEventListener('change', calcCV2);
      });
      calcCV2();
    }, 50);
  </script>
</CalculatorLayout>
