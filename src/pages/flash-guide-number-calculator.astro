---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Flash Guide Number Calculator - Distance, Aperture & ISO Adjustment";
const description = "Calculate flash guide number to working distance and aperture. Understand inverse square falloff and ISO adjustments for flash photography.";
const relatedCalcs = [
  { name: "Exposure Calculator", url: "/exposure-calculator", description: "Exposure triangle calculations." },
  { name: "Photo Lighting", url: "/photo-lighting-calculator", description: "Lighting output calculations." },
  { name: "Depth of Field", url: "/depth-of-field-calculator", description: "Aperture and DoF." },
  { name: "Light Intensity", url: "/light-intensity-calculator", description: "Light falloff and lux." },
  { name: "Camera Sensor", url: "/camera-sensor-calculator", description: "Sensor size and ISO." },
  { name: "Focal Length", url: "/focal-length-calculator", description: "Lens focal lengths." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Flash Guide Number Calculator" keywords="flash guide number, GN calculator, flash distance, flash aperture, inverse square law, flash ISO, strobe power" breadcrumbs={[{ name: "Flash Guide Number", url: "/flash-guide-number-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Flash Guide Number Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert guide numbers to working distance and aperture for flash photography.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Solve For</label>
          <select id="fg-mode" class="fg-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="distance" selected>Distance (from GN and aperture)</option>
            <option value="aperture">Aperture (from GN and distance)</option>
            <option value="gn">Guide Number (from distance and aperture)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Guide Number (GN at ISO 100)</label>
          <input type="number" id="fg-gn" class="fg-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="58" min="1" max="200" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">GN Unit</label>
          <select id="fg-gnunit" class="fg-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="m" selected>Meters</option>
            <option value="ft">Feet</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Aperture (f/)</label>
          <input type="number" id="fg-aperture" class="fg-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="5.6" min="0.7" max="128" step="0.1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Subject Distance</label>
          <input type="number" id="fg-dist" class="fg-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="10" min="0.1" step="0.1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">ISO</label>
          <select id="fg-iso" class="fg-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="100" selected>100</option>
            <option value="200">200</option>
            <option value="400">400</option>
            <option value="800">800</option>
            <option value="1600">1600</option>
            <option value="3200">3200</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Flash Power</label>
          <select id="fg-power" class="fg-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="1">1/1 (Full)</option>
            <option value="0.5">1/2</option>
            <option value="0.25">1/4</option>
            <option value="0.125">1/8</option>
            <option value="0.0625">1/16</option>
            <option value="0.03125">1/32</option>
            <option value="0.015625">1/64</option>
            <option value="0.0078125">1/128</option>
          </select>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="fg-result-label">Maximum Distance</div>
          <div class="text-4xl font-extrabold" id="fg-result"></div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Effective GN (at ISO)</div>
            <div class="text-xl font-bold text-text" id="fg-eff-gn"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">GN at Power Setting</div>
            <div class="text-xl font-bold text-text" id="fg-power-gn"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Light at 2x Distance</div>
            <div class="text-xl font-bold text-text" id="fg-falloff"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary uppercase tracking-wide">Stops from Full Power</div>
            <div class="text-xl font-bold text-text" id="fg-stops"></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="flash-guide-number" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Understanding Guide Numbers</h2>
      <p>Guide Number (GN) = Distance x Aperture (at ISO 100). A flash with GN 58(m) can illuminate a subject at 10.4m at f/5.6.</p>
      <p><strong>Inverse square law:</strong> Doubling the distance reduces light to 1/4 (2 stops less). Halving power reduces GN by 0.7x (1 stop).</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcFG() {
      const mode = (document.getElementById('fg-mode') as HTMLSelectElement).value;
      const gn100 = parseFloat((document.getElementById('fg-gn') as HTMLInputElement).value) || 58;
      const gnUnit = (document.getElementById('fg-gnunit') as HTMLSelectElement).value;
      const aperture = parseFloat((document.getElementById('fg-aperture') as HTMLInputElement).value) || 5.6;
      const dist = parseFloat((document.getElementById('fg-dist') as HTMLInputElement).value) || 10;
      const iso = parseInt((document.getElementById('fg-iso') as HTMLSelectElement).value);
      const power = parseFloat((document.getElementById('fg-power') as HTMLSelectElement).value);

      const isoMult = Math.sqrt(iso / 100);
      const effectiveGN = gn100 * isoMult * Math.sqrt(power);
      const unitLabel = gnUnit === 'ft' ? ' ft' : ' m';

      document.getElementById('fg-eff-gn')!.textContent = (gn100 * isoMult).toFixed(1) + unitLabel;
      document.getElementById('fg-power-gn')!.textContent = effectiveGN.toFixed(1) + unitLabel;

      let result = '';
      if (mode === 'distance') {
        const maxDist = effectiveGN / aperture;
        result = maxDist.toFixed(2) + unitLabel;
        document.getElementById('fg-result-label')!.textContent = 'Maximum Distance';
      } else if (mode === 'aperture') {
        const reqAperture = effectiveGN / dist;
        result = 'f/' + reqAperture.toFixed(1);
        document.getElementById('fg-result-label')!.textContent = 'Required Aperture';
      } else {
        const calcGN = dist * aperture;
        result = 'GN ' + calcGN.toFixed(1) + unitLabel;
        document.getElementById('fg-result-label')!.textContent = 'Guide Number';
      }
      document.getElementById('fg-result')!.textContent = result;

      document.getElementById('fg-falloff')!.textContent = '25% (-2 stops)';

      const stopsFromFull = -Math.log2(power);
      document.getElementById('fg-stops')!.textContent = stopsFromFull === 0 ? 'Full power' : '-' + stopsFromFull.toFixed(1) + ' stops';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.fg-in').forEach(el => {
        el.addEventListener('input', calcFG);
        el.addEventListener('change', calcFG);
      });
      calcFG();
    }, 50);
  </script>
</CalculatorLayout>
