---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Protein Calculator - Daily Protein Intake";
const description = "Calculate your recommended daily protein intake based on weight, activity level, and fitness goals.";
const relatedCalcs = [
  { name: "Calorie Calculator", url: "/calorie-calculator", description: "Daily calories." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body mass index." },
  { name: "Body Fat Calculator", url: "/body-fat-calculator", description: "Body fat %." },
  { name: "Macro Calculator", url: "/macro-calculator", description: "Macros." },
  { name: "TDEE Calculator", url: "/tdee-calculator", description: "Energy expenditure." },
  { name: "Ideal Weight", url: "/ideal-weight-calculator", description: "Ideal weight." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Protein Calculator" keywords="protein calculator, daily protein intake, protein per day, protein needs, muscle building protein" breadcrumbs={[{ name: "Protein Calculator", url: "/protein-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Protein Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Get your personalized daily protein recommendation.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Weight</label>
            <div class="flex gap-1">
              <input type="number" id="pr-weight" class="flex-1 px-4 py-3 border border-border rounded-xl text-lg font-bold" value="70" min="20" step="0.5">
              <select id="pr-unit" class="px-2 py-3 border border-border rounded-xl text-sm">
                <option value="kg" selected>kg</option><option value="lbs">lbs</option>
              </select>
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Goal</label>
            <select id="pr-goal" class="w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="maintain" selected>Maintain Weight</option>
              <option value="muscle">Build Muscle</option>
              <option value="lose">Lose Fat</option>
              <option value="athlete">Athlete/Endurance</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Activity Level</label>
          <select id="pr-activity" class="w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="sedentary">Sedentary (little exercise)</option>
            <option value="light">Lightly Active (1-3 days/week)</option>
            <option value="moderate" selected>Moderately Active (3-5 days/week)</option>
            <option value="active">Very Active (6-7 days/week)</option>
            <option value="extreme">Extremely Active (2x/day)</option>
          </select>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Daily Protein</div>
          <div class="text-5xl font-extrabold" id="pr-result">0g</div>
          <div class="text-sm text-blue-200 mt-1" id="pr-range">0 - 0 g/day</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Per Meal (3)</div><div class="text-xl font-bold" id="pr-meal3">0g</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Per Meal (4)</div><div class="text-xl font-bold" id="pr-meal4">0g</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Per Meal (5)</div><div class="text-xl font-bold" id="pr-meal5">0g</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Protein Sources (to reach daily goal)</h3>
          <div class="space-y-1 text-sm" id="pr-sources"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">g per kg body weight</div><div class="text-xl font-bold font-mono" id="pr-gpkg">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Calories from Protein</div><div class="text-xl font-bold" id="pr-cals">0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="protein" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">How Much Protein Do You Need?</h2>
      <p>General recommendation: 0.8g/kg for sedentary adults. Athletes and those building muscle may need 1.2-2.2g/kg.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    const multipliers: Record<string, Record<string, [number, number]>> = {
      maintain: { sedentary: [0.8,1.0], light: [0.9,1.1], moderate: [1.0,1.2], active: [1.1,1.4], extreme: [1.2,1.6] },
      muscle: { sedentary: [1.4,1.6], light: [1.6,1.8], moderate: [1.6,2.0], active: [1.8,2.2], extreme: [2.0,2.4] },
      lose: { sedentary: [1.0,1.2], light: [1.2,1.4], moderate: [1.2,1.6], active: [1.4,1.8], extreme: [1.6,2.0] },
      athlete: { sedentary: [1.2,1.4], light: [1.4,1.6], moderate: [1.4,1.8], active: [1.6,2.0], extreme: [1.8,2.2] },
    };
    const sources = [
      { name: 'Chicken breast (100g)', protein: 31 },
      { name: 'Eggs (1 large)', protein: 6 },
      { name: 'Greek yogurt (170g)', protein: 17 },
      { name: 'Salmon (100g)', protein: 25 },
      { name: 'Whey protein (1 scoop)', protein: 25 },
      { name: 'Tofu (100g)', protein: 8 },
    ];
    function calcProtein() {
      let weight = parseFloat((document.getElementById('pr-weight') as HTMLInputElement).value) || 70;
      const unit = (document.getElementById('pr-unit') as HTMLSelectElement).value;
      if (unit === 'lbs') weight *= 0.453592;
      const goal = (document.getElementById('pr-goal') as HTMLSelectElement).value;
      const activity = (document.getElementById('pr-activity') as HTMLSelectElement).value;
      const [lo, hi] = multipliers[goal][activity];
      const minP = Math.round(weight * lo);
      const maxP = Math.round(weight * hi);
      const avg = Math.round((minP + maxP) / 2);
      document.getElementById('pr-result')!.textContent = avg + 'g';
      document.getElementById('pr-range')!.textContent = `${minP} â€“ ${maxP} g/day`;
      document.getElementById('pr-meal3')!.textContent = Math.round(avg / 3) + 'g';
      document.getElementById('pr-meal4')!.textContent = Math.round(avg / 4) + 'g';
      document.getElementById('pr-meal5')!.textContent = Math.round(avg / 5) + 'g';
      document.getElementById('pr-gpkg')!.textContent = ((lo + hi) / 2).toFixed(1);
      document.getElementById('pr-cals')!.textContent = (avg * 4) + ' kcal';
      const srcLines = sources.map(s => {
        const servings = (avg / s.protein).toFixed(1);
        return `<div class="flex justify-between"><span>${s.name}</span><span class="font-mono font-bold">${servings} servings</span></div>`;
      });
      document.getElementById('pr-sources')!.innerHTML = srcLines.join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => { ['pr-weight','pr-unit','pr-goal','pr-activity'].forEach(id => document.getElementById(id)!.addEventListener('change', calcProtein)); document.getElementById('pr-weight')!.addEventListener('input', calcProtein); calcProtein(); }, 50);
  </script>
</CalculatorLayout>
