---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Orthodontic Retainer Calculator";
const description = "Compare retainer types (Hawley, Essix, bonded/permanent), replacement schedule, and estimate lifetime retainer costs.";
const relatedCalcs = [
  { name: "Braces Cost Calculator", url: "/braces-cost-calculator", description: "Orthodontic treatment costs." },
  { name: "Dental Crown Calculator", url: "/dental-crown-calculator", description: "Crown cost by material." },
  { name: "Dental Insurance Calculator", url: "/dental-insurance-calculator", description: "Dental plan benefit analysis." },
  { name: "Dental Implant Cost Calculator", url: "/dental-implant-cost-calculator", description: "Implant cost estimates." },
  { name: "Tooth Filling Calculator", url: "/tooth-filling-calculator", description: "Filling cost by material." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Plan your monthly budget." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Orthodontic Retainer Calculator" keywords="retainer cost, Hawley retainer, Essix retainer, bonded retainer, permanent retainer, retainer replacement" breadcrumbs={[{ name: "Orthodontic Retainer", url: "/orthodontic-retainer-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Orthodontic Retainer Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Compare retainer types, replacement costs, and total lifetime investment after braces.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Retainer Type</label>
            <select id="or-type" class="or-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="hawley" selected>Hawley (Wire + Acrylic)</option>
              <option value="essix">Essix (Clear Plastic)</option>
              <option value="bonded">Bonded / Permanent Wire</option>
              <option value="vivera">Vivera (Invisalign Retainer)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Arches (Upper / Lower)</label>
            <select id="or-arch" class="or-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="1">Single Arch</option>
              <option value="2" selected>Both Arches</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Expected Years of Use</label><input type="number" id="or-years" class="or-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="1" max="50" step="1"></div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Replacement Frequency</label>
            <select id="or-replace" class="or-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="1">Every Year</option>
              <option value="2" selected>Every 2 Years</option>
              <option value="3">Every 3 Years</option>
              <option value="5">Every 5 Years</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Insurance Covers Retainer?</label>
            <select id="or-ins" class="or-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="no" selected>No</option>
              <option value="initial">Initial Set Only</option>
              <option value="partial">Partial (50%)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Lost / Damage Risk</label>
            <select id="or-risk" class="or-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="low" selected>Low</option>
              <option value="avg">Average</option>
              <option value="high">High (teenager)</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Initial Retainer Cost</div>
          <div class="text-5xl font-extrabold font-mono" id="or-initial">$0</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Replacement Cost</div><div class="text-xl font-bold font-mono" id="or-rep">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Replacements Needed</div><div class="text-xl font-bold font-mono" id="or-count">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Lifetime Cost</div><div class="text-xl font-bold font-mono" id="or-lifetime">$0</div></div>
        </div>
        <div class="p-3 bg-blue-50 rounded-xl text-center text-xs font-semibold text-blue-900 uppercase tracking-wide mb-1">Type Comparison (Both Arches, 10 Years)</div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Hawley</div><div class="text-xl font-bold font-mono" id="or-chawley">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Essix</div><div class="text-xl font-bold font-mono" id="or-cessix">$0</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Bonded</div><div class="text-xl font-bold font-mono" id="or-cbonded">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Vivera</div><div class="text-xl font-bold font-mono" id="or-cvivera">$0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="orthodontic-retainer" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcOR() {
      const type = (document.getElementById('or-type') as HTMLSelectElement).value;
      const arches = parseInt((document.getElementById('or-arch') as HTMLSelectElement).value) || 2;
      const years = parseFloat((document.getElementById('or-years') as HTMLInputElement).value) || 10;
      const replaceFreq = parseInt((document.getElementById('or-replace') as HTMLSelectElement).value) || 2;
      const ins = (document.getElementById('or-ins') as HTMLSelectElement).value;
      const risk = (document.getElementById('or-risk') as HTMLSelectElement).value;

      // Costs per arch
      const initialCosts: Record<string, number> = { hawley: 300, essix: 200, bonded: 400, vivera: 350 };
      const replaceCosts: Record<string, number> = { hawley: 250, essix: 150, bonded: 350, vivera: 300 };
      const typicalLife: Record<string, number> = { hawley: 5, essix: 1.5, bonded: 10, vivera: 2 };

      const riskMult: Record<string, number> = { low: 1.0, avg: 1.3, high: 1.6 };

      const initialCost = initialCosts[type] * arches;
      const replaceCost = replaceCosts[type] * arches;
      const effectiveReplaceFreq = Math.min(replaceFreq, typicalLife[type]);
      const replacements = Math.max(0, Math.floor((years - 1) / effectiveReplaceFreq));
      const extraFromRisk = Math.round((riskMult[risk] - 1) * replacements);
      const totalReplacements = replacements + extraFromRisk;

      let insDiscount = 0;
      if (ins === 'initial') insDiscount = initialCost * 0.5;
      else if (ins === 'partial') insDiscount = initialCost * 0.5 + totalReplacements * replaceCost * 0.25;

      const lifetimeCost = Math.round(initialCost + totalReplacements * replaceCost - insDiscount);

      // 10-year comparison for all types (both arches)
      function tenYearCost(t: string): number {
        const init = initialCosts[t] * 2;
        const rep = replaceCosts[t] * 2;
        const life = typicalLife[t];
        const reps = Math.max(0, Math.floor(9 / Math.min(2, life)));
        return init + reps * rep;
      }

      document.getElementById('or-initial')!.textContent = '$' + initialCost.toLocaleString();
      document.getElementById('or-rep')!.textContent = '$' + replaceCost.toLocaleString();
      document.getElementById('or-count')!.textContent = totalReplacements.toString();
      document.getElementById('or-lifetime')!.textContent = '$' + lifetimeCost.toLocaleString();
      document.getElementById('or-chawley')!.textContent = '$' + tenYearCost('hawley').toLocaleString();
      document.getElementById('or-cessix')!.textContent = '$' + tenYearCost('essix').toLocaleString();
      document.getElementById('or-cbonded')!.textContent = '$' + tenYearCost('bonded').toLocaleString();
      document.getElementById('or-cvivera')!.textContent = '$' + tenYearCost('vivera').toLocaleString();

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.or-in').forEach(el => { el.addEventListener('input', calcOR); el.addEventListener('change', calcOR); });
      calcOR();
    }, 50);
  </script>
</CalculatorLayout>
