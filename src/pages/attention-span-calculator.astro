---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Attention Span Calculator - Focus Duration by Age & Task";
const description = "Estimate your attention span by age and task type. Get break frequency recommendations and focus optimization tips.";
const relatedCalcs = [
  { name: "Pomodoro Calculator", url: "/pomodoro-calculator", description: "Pomodoro timer." },
  { name: "Productivity Calculator", url: "/productivity-calculator", description: "Productivity metrics." },
  { name: "Reading Time", url: "/reading-time-calculator", description: "Reading duration." },
  { name: "Study Time", url: "/study-time-calculator", description: "Study planning." },
  { name: "Screen Time", url: "/screen-time-calculator", description: "Screen usage." },
  { name: "Age Calculator", url: "/age-calculator", description: "Calculate exact age." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Attention Span Calculator" keywords="attention span, focus duration, concentration time, break frequency, age attention, task focus, productivity" breadcrumbs={[{ name: "Attention Span", url: "/attention-span-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Attention Span Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your sustained attention capacity based on age, task complexity, and environmental factors.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Your Age</label>
          <input type="number" id="as-age" class="as-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="3" max="100" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Task Type</label>
          <select id="as-task" class="as-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center">
            <option value="passive">Passive (watching video, listening)</option>
            <option value="reading">Reading / Studying</option>
            <option value="creative">Creative (writing, designing)</option>
            <option value="analytical">Analytical (math, coding, problem-solving)</option>
            <option value="repetitive">Repetitive (data entry, assembly)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Interest Level (1-10)</label>
          <input type="range" id="as-interest" class="as-in w-full" min="1" max="10" step="1">
          <div class="flex justify-between text-xs text-text-secondary"><span>Very boring (1)</span><span>Fascinating (10)</span></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Caffeine Consumed Today?</label>
          <select id="as-caff" class="as-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center">
            <option value="0">None</option>
            <option value="1">Moderate (1-2 cups)</option>
            <option value="2">High (3+ cups)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Hours of Sleep Last Night</label>
          <input type="number" id="as-sleep" class="as-in w-full px-4 py-3 border border-border rounded-xl text-lg text-center" min="0" max="16" step="0.5">
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm opacity-80">Estimated Attention Span</div>
          <div class="text-2xl font-extrabold mt-1" id="as-span">--</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Recommended Break Frequency</div>
            <div class="text-xl font-bold text-text mt-1" id="as-break">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Age-Based Baseline</div>
            <div class="text-xl font-bold text-text mt-1" id="as-baseline">--</div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Optimal Work Sessions/Day</div>
            <div class="text-xl font-bold text-text mt-1" id="as-sessions">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary">Total Focused Hours</div>
            <div class="text-xl font-bold text-text mt-1" id="as-total">--</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-secondary mb-2">Focus Optimization Tips</div>
          <div class="text-sm text-text" id="as-tips">--</div>
        </div>
      </div>

      <ShareButton calculatorId="attention-span" />
      <FeedbackWidget />
    </div>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcAS() {
      const age = parseInt((document.getElementById('as-age') as HTMLInputElement).value) || 25;
      const task = (document.getElementById('as-task') as HTMLSelectElement).value;
      const interest = parseInt((document.getElementById('as-interest') as HTMLInputElement).value) || 5;
      const caff = parseInt((document.getElementById('as-caff') as HTMLSelectElement).value) || 0;
      const sleepHrs = parseFloat((document.getElementById('as-sleep') as HTMLInputElement).value) || 7;

      // Age-based baseline attention span in minutes (sustained attention)
      let baseline = 20;
      if (age < 5) baseline = 5 + age;
      else if (age < 8) baseline = 10 + (age - 5) * 2;
      else if (age < 12) baseline = 16 + (age - 8) * 2;
      else if (age < 18) baseline = 24 + (age - 12) * 1.5;
      else if (age < 30) baseline = 33;
      else if (age < 50) baseline = 30;
      else if (age < 65) baseline = 27;
      else baseline = 22;

      // Task type multiplier
      const taskMult: Record<string, number> = {
        passive: 1.3,
        reading: 0.9,
        creative: 1.1,
        analytical: 0.8,
        repetitive: 0.7,
      };
      const tMult = taskMult[task] || 1;

      // Interest multiplier (1-10 maps to 0.6 - 1.5)
      const intMult = 0.6 + (interest - 1) * 0.1;

      // Caffeine boost
      const caffBoost = caff === 1 ? 1.1 : caff === 2 ? 1.05 : 1.0;

      // Sleep factor
      let sleepFactor = 1.0;
      if (sleepHrs < 5) sleepFactor = 0.6;
      else if (sleepHrs < 6) sleepFactor = 0.75;
      else if (sleepHrs < 7) sleepFactor = 0.9;
      else if (sleepHrs <= 9) sleepFactor = 1.0;
      else sleepFactor = 0.95;

      const span = Math.round(baseline * tMult * intMult * caffBoost * sleepFactor);
      const breakFreq = Math.max(10, span);
      const sessionsPerDay = Math.min(12, Math.round(480 / (span + 10)));
      const totalFocused = (sessionsPerDay * span / 60).toFixed(1);

      document.getElementById('as-span')!.textContent = span + ' minutes';
      document.getElementById('as-break')!.textContent = 'Every ' + breakFreq + ' min';
      document.getElementById('as-baseline')!.textContent = Math.round(baseline) + ' min (age ' + age + ')';
      document.getElementById('as-sessions')!.textContent = sessionsPerDay + ' sessions';
      document.getElementById('as-total')!.textContent = totalFocused + ' hrs';

      let tips: string[] = [];
      if (sleepHrs < 7) tips.push('Sleep more to boost focus by up to 40%.');
      if (interest < 5) tips.push('Low interest reduces attention significantly. Try gamifying the task or finding personal relevance.');
      if (task === 'analytical') tips.push('For analytical work, break problems into smaller chunks. Alternate with lighter tasks.');
      if (task === 'repetitive') tips.push('Repetitive tasks drain focus fastest. Use the Pomodoro technique (25 min on, 5 min off).');
      if (caff === 0 && age >= 18) tips.push('Moderate caffeine (1-2 cups) may improve attention by 10%.');
      if (caff === 2) tips.push('Excess caffeine can increase anxiety and reduce net focus. Consider cutting back.');
      if (tips.length === 0) tips.push('Your focus conditions are good. Maintain consistent sleep, moderate caffeine, and take regular breaks.');

      document.getElementById('as-tips')!.textContent = tips.join(' ');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      (document.getElementById('as-age') as HTMLInputElement).value = '25';
      (document.getElementById('as-interest') as HTMLInputElement).value = '5';
      (document.getElementById('as-sleep') as HTMLInputElement).value = '7';
      document.querySelectorAll('.as-in').forEach(el => {
        el.addEventListener('input', calcAS);
        el.addEventListener('change', calcAS);
      });
      calcAS();
    }, 50);
  </script>
</CalculatorLayout>
