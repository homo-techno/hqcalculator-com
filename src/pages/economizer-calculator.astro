---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Economizer Calculator - HVAC Free Cooling Savings";
const description = "Calculate HVAC economizer savings from free cooling hours based on climate data, setpoints, and system capacity. Estimate annual energy and cost savings.";

const relatedCalcs = [
  { name: "Cooling Load Calculator", url: "/cooling-load-calculator", description: "Cooling loads." },
  { name: "Ventilation Rate Calculator", url: "/ventilation-rate-calculator", description: "Ventilation rates." },
  { name: "Psychrometric Calculator", url: "/psychrometric-calculator", description: "Air properties." },
  { name: "Chiller Sizing Calculator", url: "/chiller-sizing-calculator", description: "Chiller tonnage." },
  { name: "Air Changes Calculator", url: "/air-changes-calculator", description: "ACH rates." },
  { name: "Cooling Tower Calculator", url: "/cooling-tower-calculator", description: "Tower capacity." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Economizer Calculator"
  keywords="economizer calculator, free cooling, HVAC savings, outdoor air economizer, energy savings, air side economizer"
  breadcrumbs={[{ name: "Economizer Calculator", url: "/economizer-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Economizer Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate HVAC economizer savings from free cooling based on climate and system parameters.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-5">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Climate Zone</label>
          <select id="eco-climate" class="eco-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="hot-humid">Hot-Humid (Miami, Houston)</option>
            <option value="hot-dry">Hot-Dry (Phoenix, Las Vegas)</option>
            <option value="mixed" selected>Mixed (Atlanta, DC)</option>
            <option value="cool">Cool (Chicago, Denver)</option>
            <option value="cold">Cold (Minneapolis, Boston)</option>
            <option value="marine">Marine (Seattle, SF)</option>
          </select>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Economizer High Limit (°F)</label>
            <input type="number" id="eco-highlimit" class="eco-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="65" min="50" max="80" step="1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Return Air Temp (°F)</label>
            <input type="number" id="eco-rat" class="eco-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="75" step="1">
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">System Capacity (tons)</label>
            <input type="number" id="eco-tons" class="eco-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="50" min="1" step="5">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">System Efficiency (kW/ton)</label>
            <input type="number" id="eco-eff" class="eco-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.0" min="0.3" max="2" step="0.05">
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Operating Hours/Year</label>
            <input type="number" id="eco-hours" class="eco-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3000" min="500" max="8760" step="100">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Electricity Cost ($/kWh)</label>
            <input type="number" id="eco-cost" class="eco-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.12" min="0.01" max="0.50" step="0.01">
          </div>
        </div>

        <!-- Results -->
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Annual Energy Savings</div>
          <div class="text-4xl font-extrabold" id="eco-kwh">--</div>
          <div class="text-sm text-blue-200 mt-1">kWh/year</div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Annual Cost Savings</div>
            <div class="text-xl font-bold" id="eco-savings">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Free Cooling Hours</div>
            <div class="text-xl font-bold" id="eco-freehours">--</div>
            <div class="text-xs text-text-muted">hours/year</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">% of Cooling Hours</div>
            <div class="text-xl font-bold" id="eco-pct">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Avg Load Offset</div>
            <div class="text-xl font-bold" id="eco-offset">--</div>
            <div class="text-xs text-text-muted">tons (avg during econ mode)</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">CO2 Reduction</div>
            <div class="text-xl font-bold" id="eco-co2">--</div>
            <div class="text-xs text-text-muted">lbs CO2/year</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Simple Payback</div>
            <div class="text-xl font-bold" id="eco-payback">--</div>
            <div class="text-xs text-text-muted">years (est. $3-5K install)</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="economizer" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl mx-auto prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How HVAC Economizers Save Energy</h2>
      <p>An air-side economizer uses cool outdoor air for free cooling when conditions are favorable, reducing or eliminating the need for mechanical cooling.</p>
      <ul>
        <li><strong>Dry bulb economizer:</strong> Opens when outdoor air is below the high limit setpoint</li>
        <li><strong>Enthalpy economizer:</strong> Compares enthalpy of outdoor and return air for better humidity control</li>
        <li>Savings vary significantly by climate zone; marine and cool climates see the most benefit</li>
        <li>Code requires economizers for most commercial systems above 54,000 BTU/hr (ASHRAE 90.1)</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcECO() {
      const climate = (document.getElementById('eco-climate') as HTMLSelectElement).value;
      const highLimit = parseFloat((document.getElementById('eco-highlimit') as HTMLInputElement).value) || 65;
      const rat = parseFloat((document.getElementById('eco-rat') as HTMLInputElement).value) || 75;
      const tons = parseFloat((document.getElementById('eco-tons') as HTMLInputElement).value) || 0;
      const eff = parseFloat((document.getElementById('eco-eff') as HTMLInputElement).value) || 1.0;
      const opHours = parseFloat((document.getElementById('eco-hours') as HTMLInputElement).value) || 3000;
      const costPerKwh = parseFloat((document.getElementById('eco-cost') as HTMLInputElement).value) || 0.12;

      // Percentage of cooling hours below economizer high limit by climate zone
      // (approximate bin data analysis results)
      const econPct: Record<string, number> = {
        'hot-humid': 0.10,
        'hot-dry': 0.20,
        'mixed': 0.35,
        'cool': 0.50,
        'cold': 0.55,
        'marine': 0.65,
      };

      const freePct = econPct[climate] || 0.35;
      const freeHours = opHours * freePct;

      // Average load offset during economizer mode
      // When economizer is active, it offsets roughly 60-90% of cooling load
      const avgOffset = tons * 0.75; // 75% average offset

      // Energy savings
      const savedKw = avgOffset * eff; // kW not used
      const savedKwh = savedKw * freeHours;
      const costSaved = savedKwh * costPerKwh;

      // CO2 reduction (average US grid: 0.86 lbs CO2/kWh)
      const co2Saved = savedKwh * 0.86;

      // Payback (typical economizer install $3000-5000)
      const installCost = 4000; // estimate
      const payback = costSaved > 0 ? installCost / costSaved : 999;

      document.getElementById('eco-kwh')!.textContent = Math.round(savedKwh).toLocaleString();
      document.getElementById('eco-savings')!.textContent = '$' + Math.round(costSaved).toLocaleString();
      document.getElementById('eco-freehours')!.textContent = Math.round(freeHours).toLocaleString();
      document.getElementById('eco-pct')!.textContent = (freePct * 100).toFixed(0) + '%';
      document.getElementById('eco-offset')!.textContent = avgOffset.toFixed(1);
      document.getElementById('eco-co2')!.textContent = Math.round(co2Saved).toLocaleString();
      document.getElementById('eco-payback')!.textContent = payback < 20 ? payback.toFixed(1) : '> 20';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.eco-in').forEach(el => {
        el.addEventListener('input', calcECO);
        el.addEventListener('change', calcECO);
      });
      calcECO();
    }, 50);
  </script>
</CalculatorLayout>
