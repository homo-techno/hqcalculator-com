---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Spaced Repetition Calculator - Optimize Your Study Schedule";
const description = "Calculate your optimal spaced repetition review schedule, daily review load, total study time, and projected mastery date.";
const relatedCalcs = [
  { name: "SAT Score", url: "/sat-score-calculator", description: "SAT scores." },
  { name: "ACT Score", url: "/act-score-calculator", description: "ACT scores." },
  { name: "Language Learning", url: "/language-learning-calculator", description: "Language study." },
  { name: "Productivity", url: "/productivity-calculator", description: "Productivity." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Time Calculator", url: "/time-calculator", description: "Time math." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Spaced Repetition Calculator" keywords="spaced repetition, flashcards, anki, review schedule, study planner, memory retention" breadcrumbs={[{ name: "Spaced Repetition", url: "/spaced-repetition-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Spaced Repetition Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Plan your flashcard study schedule and estimate when you will achieve mastery.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Total Cards</label><input type="number" id="sr2-cards" class="sr2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="500" min="1" step="10"></div>
          <div><label class="block text-xs font-medium text-text mb-1">New Cards/Day</label><input type="number" id="sr2-new" class="sr2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="1" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Retention Rate (%)</label><input type="number" id="sr2-ret" class="sr2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="85" min="50" max="99" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Avg Seconds/Card</label><input type="number" id="sr2-sec" class="sr2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="3" max="60" step="1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Daily Reviews (Steady State)</div>
          <div class="text-5xl font-extrabold font-mono" id="sr2-daily">0</div>
          <div class="text-sm text-blue-200 mt-1">cards per day</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Daily Study Time</div><div class="text-xl font-bold" id="sr2-time">0 min</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Days to Complete</div><div class="text-xl font-bold" id="sr2-days">0</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Mastery Date</div><div class="text-xl font-bold" id="sr2-date">-</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Study Hours</div><div class="text-xl font-bold" id="sr2-total">0</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Review Schedule (Intervals)</h3>
          <div class="text-sm text-text-secondary" id="sr2-schedule"></div>
        </div>
      </div>
      <ShareButton calculatorId="spaced-repetition" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">How Spaced Repetition Works</h2>
      <p>Spaced repetition optimizes long-term memory by increasing review intervals for cards you know well and shortening intervals for difficult cards. The formula models exponential growth in review load as you add new cards daily.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcSR() {
      const totalCards = parseFloat((document.getElementById('sr2-cards') as HTMLInputElement).value) || 500;
      const newPerDay = parseFloat((document.getElementById('sr2-new') as HTMLInputElement).value) || 20;
      const retention = parseFloat((document.getElementById('sr2-ret') as HTMLInputElement).value) || 85;
      const secPerCard = parseFloat((document.getElementById('sr2-sec') as HTMLInputElement).value) || 8;
      const retRate = retention / 100;
      const daysToComplete = Math.ceil(totalCards / newPerDay);
      // Steady-state daily reviews = totalCards * (1 - retention) / ln(retention) approximation
      // More practical: each card reviewed ~(1/retRate) times across intervals 1,3,7,14,30,60 days
      const intervals = [1, 3, 7, 14, 30, 60, 120];
      const failRate = 1 - retRate;
      // Average reviews per card = sum of probabilities of seeing card at each interval
      const avgReviewsPerCard = intervals.reduce((sum, _, i) => sum + Math.pow(failRate, i), 0);
      // Daily review load at steady state
      const dailyReviews = Math.round(newPerDay * avgReviewsPerCard + newPerDay);
      const dailyMinutes = Math.round(dailyReviews * secPerCard / 60);
      const totalHours = Math.round(dailyMinutes * daysToComplete / 60 * 10) / 10;
      const masteryDate = new Date();
      masteryDate.setDate(masteryDate.getDate() + daysToComplete);
      const dateStr = masteryDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      document.getElementById('sr2-daily')!.textContent = dailyReviews.toLocaleString();
      document.getElementById('sr2-time')!.textContent = dailyMinutes + ' min';
      document.getElementById('sr2-days')!.textContent = daysToComplete.toLocaleString();
      document.getElementById('sr2-date')!.textContent = dateStr;
      document.getElementById('sr2-total')!.textContent = totalHours + ' hrs';
      const scheduleHTML = intervals.map((d, i) => {
        const prob = Math.round(Math.pow(retRate, i + 1) * 100);
        return `<div class="flex justify-between py-1 border-b border-border last:border-0"><span>Review ${i + 1}: Day ${d}</span><span class="font-bold">${prob}% recall</span></div>`;
      }).join('');
      document.getElementById('sr2-schedule')!.innerHTML = scheduleHTML;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => { document.querySelectorAll('.sr2-in').forEach(el => { el.addEventListener('input', calcSR); el.addEventListener('change', calcSR); }); calcSR(); }, 50);
  </script>
</CalculatorLayout>
