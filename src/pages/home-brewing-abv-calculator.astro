---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Home Brewing ABV Calculator - OG, FG & IBU";
const description = "Calculate ABV from original and final gravity, apparent vs real attenuation, calories per serving, and IBU for home brewing.";
const relatedCalcs = [
  { name: "Beer Brewing", url: "/beer-brewing-calculator", description: "Brewing recipes." },
  { name: "BAC Calculator", url: "/bac-calculator", description: "Blood alcohol." },
  { name: "Alcohol Calories", url: "/alcohol-calorie-calculator", description: "Alcohol calories." },
  { name: "Alcohol Units", url: "/alcohol-unit-calculator", description: "Alcohol units." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Unit Price", url: "/unit-price-calculator", description: "Unit pricing." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Home Brewing ABV Calculator" keywords="ABV calculator, home brewing, original gravity, final gravity, attenuation, IBU, calories beer" breadcrumbs={[{ name: "Brewing ABV", url: "/home-brewing-abv-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Home Brewing ABV Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate ABV, attenuation, calories, and bitterness for your homebrew from gravity readings.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Original Gravity (OG)</label><input type="number" id="hb-og" class="hb-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.050" min="1.000" max="1.200" step="0.001"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Final Gravity (FG)</label><input type="number" id="hb-fg" class="hb-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.010" min="0.990" max="1.100" step="0.001"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Batch Size (gallons)</label><input type="number" id="hb-batch" class="hb-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="0.5" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Serving Size (oz)</label><input type="number" id="hb-serv" class="hb-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="12" min="1" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Hop Alpha Acid (%)</label><input type="number" id="hb-aa" class="hb-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="0" max="25" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Hop Amount (oz)</label><input type="number" id="hb-hops" class="hb-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.5" min="0" step="0.25"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Boil Time (minutes)</label><input type="number" id="hb-boil" class="hb-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="60" min="0" max="120" step="5"></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Alcohol by Volume</div>
          <div class="text-5xl font-extrabold font-mono" id="hb-result">0% ABV</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">ABW</div><div class="text-xl font-bold font-mono" id="hb-abw">0%</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Apparent Atten.</div><div class="text-xl font-bold font-mono" id="hb-aa-out">0%</div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Real Atten.</div><div class="text-xl font-bold font-mono" id="hb-ra">0%</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Cal/Serving</div><div class="text-xl font-bold font-mono" id="hb-cal">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Est. IBU</div><div class="text-xl font-bold font-mono" id="hb-ibu">0</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Servings</div><div class="text-xl font-bold font-mono" id="hb-servings">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Plato (OG)</div><div class="text-xl font-bold font-mono" id="hb-plato">0Â°P</div></div>
        </div>
      </div>
      <ShareButton calculatorId="home-brewing-abv" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcHB() {
      const og = parseFloat((document.getElementById('hb-og') as HTMLInputElement).value) || 1.050;
      const fg = parseFloat((document.getElementById('hb-fg') as HTMLInputElement).value) || 1.010;
      const batch = parseFloat((document.getElementById('hb-batch') as HTMLInputElement).value) || 5;
      const serv = parseFloat((document.getElementById('hb-serv') as HTMLInputElement).value) || 12;
      const aa = parseFloat((document.getElementById('hb-aa') as HTMLInputElement).value) || 6;
      const hops = parseFloat((document.getElementById('hb-hops') as HTMLInputElement).value) || 1.5;
      const boil = parseFloat((document.getElementById('hb-boil') as HTMLInputElement).value) || 60;

      // ABV calculation (standard formula)
      const abv = (og - fg) * 131.25;

      // ABW (Alcohol by Weight) = ABV * 0.79336
      const abw = abv * 0.79336;

      // Apparent attenuation
      const ogPoints = (og - 1) * 1000;
      const fgPoints = (fg - 1) * 1000;
      const apparentAtten = ogPoints > 0 ? ((ogPoints - fgPoints) / ogPoints) * 100 : 0;

      // Real attenuation (corrected for alcohol density)
      const realAtten = apparentAtten * 0.8192;

      // Plato (degrees)
      const plato = (-463.37) + (668.72 * og) - (205.35 * og * og);

      // Calories per serving (Daniels formula)
      const calAlcohol = (6.9 * abw / 100) * fg * serv * 29.5735 / 100;
      const calCarb = (3.55 * (1 - 0.8192 * (1 - fg / og))) * fgPoints / 10 * fg * serv * 29.5735 / 100;
      const totalCal = (calAlcohol + calCarb);
      // Simplified: ~((ABV * 2.5) + ((FG-1)*1000 * 3.8)) * serv_oz/12
      const calSimple = ((abv * 2.5 + fgPoints * 3.55) * serv / 12);

      // IBU (Tinseth formula simplified)
      const gravityFactor = 1.65 * Math.pow(0.000125, (og - 1));
      const timeFactor = (1 - Math.exp(-0.04 * boil)) / 4.15;
      const utilization = gravityFactor * timeFactor;
      const ibu = (aa / 100 * hops * 28.3495 * utilization * 1000) / (batch * 3.78541);

      // Total servings
      const totalOz = batch * 128;
      const servings = Math.floor(totalOz / serv);

      document.getElementById('hb-result')!.textContent = abv.toFixed(2) + '% ABV';
      document.getElementById('hb-abw')!.textContent = abw.toFixed(2) + '%';
      document.getElementById('hb-aa-out')!.textContent = apparentAtten.toFixed(1) + '%';
      document.getElementById('hb-ra')!.textContent = realAtten.toFixed(1) + '%';
      document.getElementById('hb-cal')!.textContent = Math.round(calSimple).toString();
      document.getElementById('hb-ibu')!.textContent = Math.round(ibu).toString();
      document.getElementById('hb-servings')!.textContent = servings.toString();
      document.getElementById('hb-plato')!.textContent = plato.toFixed(1) + '\u00B0P';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.hb-in').forEach(el => { el.addEventListener('input', calcHB); el.addEventListener('change', calcHB); });
      calcHB();
    }, 50);
  </script>
</CalculatorLayout>
