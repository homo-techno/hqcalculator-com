---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "GDPR Fine Calculator - Estimate Penalty by Violation & Revenue";
const description = "Calculate potential GDPR penalty amounts based on violation type, company revenue, severity factors, and mitigating circumstances.";
const relatedCalcs = [
  { name: "Compliance Cost Calculator", url: "/compliance-cost-calculator", description: "Compliance budgeting." },
  { name: "Regulatory Compliance", url: "/regulatory-compliance-calculator", description: "Compliance staffing." },
  { name: "OSHA Penalty Calculator", url: "/osha-penalty-calculator", description: "OSHA violation costs." },
  { name: "Tax Penalty Calculator", url: "/tax-penalty-calculator", description: "IRS penalty calculator." },
  { name: "Litigation Cost Calculator", url: "/litigation-cost-calculator", description: "Litigation expenses." },
  { name: "Contract Value Calculator", url: "/contract-value-calculator", description: "Contract valuation." },
];
---

<CalculatorLayout title={title} description={description} calculatorName="GDPR Fine Calculator" keywords="GDPR fine calculator, GDPR penalty, data protection, privacy violation, data breach fine, EU regulation, GDPR compliance" breadcrumbs={[{ name: "GDPR Fine", url: "/gdpr-fine-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">GDPR Fine Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate potential GDPR penalties based on violation type, revenue, and circumstances.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Violation Tier</label>
          <select id="gdp-tier" class="gdp-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="lower" selected>Lower Tier (Art. 83(4)) - up to 2% / EUR 10M</option>
            <option value="upper">Upper Tier (Art. 83(5/6)) - up to 4% / EUR 20M</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Violation Type</label>
          <select id="gdp-type" class="gdp-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="consent">Lack of valid consent</option>
            <option value="breach-notification" selected>Breach notification failure</option>
            <option value="data-rights">Data subject rights violation</option>
            <option value="transfer">Unlawful data transfer</option>
            <option value="dpia">Failure to conduct DPIA</option>
            <option value="dpo">No Data Protection Officer</option>
            <option value="records">Insufficient record-keeping</option>
            <option value="security">Inadequate security measures</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Annual Global Revenue (EUR)</label>
          <input type="number" id="gdp-revenue" class="gdp-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="50000000" min="0" step="1000000">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Number of Data Subjects Affected</label>
          <input type="number" id="gdp-subjects" class="gdp-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10000" min="1" step="100">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Severity</label>
          <select id="gdp-severity" class="gdp-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="minor">Minor / negligible harm</option>
            <option value="moderate" selected>Moderate harm</option>
            <option value="severe">Severe / significant harm</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Intentional or Negligent?</label>
          <select id="gdp-intent" class="gdp-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="negligent" selected>Negligent</option>
            <option value="intentional">Intentional</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Mitigating Factors</label>
          <select id="gdp-mitigate" class="gdp-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="none">None</option>
            <option value="some" selected>Some (cooperation, remedial action)</option>
            <option value="strong">Strong (self-reported, DPO involved)</option>
          </select>
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated GDPR Fine</div>
          <div class="text-5xl font-extrabold font-mono" id="gdp-total"></div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Maximum Possible</div>
            <div class="text-xl font-bold text-secondary" id="gdp-max"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">% of Revenue</div>
            <div class="text-xl font-bold" id="gdp-pct"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Severity Factor</div>
            <div class="text-xl font-bold text-orange-600" id="gdp-sev-factor"></div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Risk Level</div>
            <div class="text-xl font-bold" id="gdp-risk"></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="gdpr-fine" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Understanding GDPR Fines</h2>
      <p>GDPR fines fall into two tiers. Lower-tier violations (Art. 83(4)) include failures in record-keeping, security measures, or DPIA obligations - carrying fines up to EUR 10 million or 2% of global revenue. Upper-tier violations (Art. 83(5/6)) cover consent, data rights, and unlawful transfers - with fines up to EUR 20 million or 4% of global revenue.</p>
      <h3 class="text-xl font-semibold text-text mt-8">How Fines Are Determined</h3>
      <p>Supervisory authorities consider the nature and severity of the violation, number of affected individuals, degree of cooperation, history of violations, and whether the violation was intentional or negligent. Self-reporting and swift remedial action can significantly reduce penalties.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const fmtEur = (n: number) => 'EUR ' + Math.round(n).toLocaleString();

    function calcGDP() {
      const tier = (document.getElementById('gdp-tier') as HTMLSelectElement).value;
      const revenue = parseFloat((document.getElementById('gdp-revenue') as HTMLInputElement).value) || 0;
      const subjects = parseInt((document.getElementById('gdp-subjects') as HTMLInputElement).value) || 1;
      const severity = (document.getElementById('gdp-severity') as HTMLSelectElement).value;
      const intent = (document.getElementById('gdp-intent') as HTMLSelectElement).value;
      const mitigate = (document.getElementById('gdp-mitigate') as HTMLSelectElement).value;

      // Maximum fine
      const revenuePct = tier === 'upper' ? 0.04 : 0.02;
      const flatMax = tier === 'upper' ? 20000000 : 10000000;
      const maxFine = Math.max(revenue * revenuePct, flatMax);

      // Severity multiplier
      const sevMultipliers: Record<string, number> = { minor: 0.1, moderate: 0.35, severe: 0.7 };
      const sevFactor = sevMultipliers[severity] || 0.35;

      // Intent multiplier
      const intentFactor = intent === 'intentional' ? 1.5 : 1.0;

      // Scale factor based on affected subjects
      let scaleFactor = 1.0;
      if (subjects > 100000) scaleFactor = 1.3;
      else if (subjects > 10000) scaleFactor = 1.1;
      else if (subjects < 100) scaleFactor = 0.7;

      // Mitigation discount
      const mitigateDiscount: Record<string, number> = { none: 1.0, some: 0.7, strong: 0.4 };
      const mitFactor = mitigateDiscount[mitigate] || 1.0;

      let estimatedFine = maxFine * sevFactor * intentFactor * scaleFactor * mitFactor;
      estimatedFine = Math.min(estimatedFine, maxFine);
      estimatedFine = Math.max(estimatedFine, 5000); // minimum realistic fine

      const pctOfRevenue = revenue > 0 ? ((estimatedFine / revenue) * 100).toFixed(2) + '%' : 'N/A';

      let riskLevel = 'Low';
      if (estimatedFine > 5000000) riskLevel = 'Critical';
      else if (estimatedFine > 1000000) riskLevel = 'High';
      else if (estimatedFine > 100000) riskLevel = 'Medium';

      document.getElementById('gdp-total')!.textContent = fmtEur(estimatedFine);
      document.getElementById('gdp-max')!.textContent = fmtEur(maxFine);
      document.getElementById('gdp-pct')!.textContent = pctOfRevenue;
      document.getElementById('gdp-sev-factor')!.textContent = (sevFactor * intentFactor * scaleFactor * mitFactor * 100).toFixed(0) + '%';
      const riskEl = document.getElementById('gdp-risk')!;
      riskEl.textContent = riskLevel;
      riskEl.className = 'text-xl font-bold ' + (riskLevel === 'Critical' ? 'text-red-600' : riskLevel === 'High' ? 'text-orange-600' : riskLevel === 'Medium' ? 'text-yellow-600' : 'text-green-600');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.gdp-in').forEach(el => {
        el.addEventListener('input', calcGDP);
        el.addEventListener('change', calcGDP);
      });
      calcGDP();
    }, 50);
  </script>
</CalculatorLayout>
