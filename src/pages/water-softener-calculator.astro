---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Water Softener Calculator - Size & Grain Capacity";
const description = "Calculate the right water softener size from water hardness, daily usage, number of people, grain capacity, regeneration frequency, and salt usage.";
const relatedCalcs = [
  { name: "Water Quality", url: "/water-quality-calculator", description: "Water quality analysis." },
  { name: "Water Usage", url: "/water-usage-calculator", description: "Daily water consumption." },
  { name: "Water Intake", url: "/water-intake-calculator", description: "Personal water needs." },
  { name: "Well Water", url: "/well-water-calculator", description: "Well water analysis." },
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Operating cost estimate." },
  { name: "Pool Volume", url: "/pool-volume-calculator", description: "Water volume calculation." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Water Softener Calculator" keywords="water softener size, grain capacity, hardness, regeneration, salt usage calculator" breadcrumbs={[{ name: "Water Softener", url: "/water-softener-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Water Softener Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Determine the right water softener size based on your water hardness and household usage.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Number of People</label>
          <input type="number" id="ws2-people" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" min="1" max="20" step="1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Water Hardness (GPG - grains per gallon)</label>
          <input type="number" id="ws2-hard" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="15" min="1" max="100" step="1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Iron Content (ppm) - adds to effective hardness</label>
          <input type="number" id="ws2-iron" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="0" max="20" step="0.5">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Daily Water Use Per Person (gallons)</label>
          <input type="number" id="ws2-gpd" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="75" min="30" max="200" step="5">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Desired Regeneration Frequency (days)</label>
          <select id="ws2-freq" class="ws2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="5">Every 5 days</option>
            <option value="7" selected>Every 7 days (weekly)</option>
            <option value="10">Every 10 days</option>
            <option value="14">Every 14 days</option>
          </select>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Softener Size</div>
          <div class="text-4xl font-extrabold" id="ws2-size">0 grains</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Daily Hardness Load</div><div class="text-xl font-bold" id="ws2-daily">0 grains/day</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Effective Hardness</div><div class="text-xl font-bold" id="ws2-effhard">0 GPG</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Salt Per Regen</div><div class="text-xl font-bold" id="ws2-salt">0 lbs</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Annual Salt Cost</div><div class="text-xl font-bold" id="ws2-saltcost">$0</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">System Recommendations</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between"><span>Resin Volume</span><span class="font-bold" id="ws2-resin">0 cu ft</span></div>
            <div class="flex justify-between"><span>Monthly Salt Usage</span><span class="font-bold" id="ws2-monsalt">0 lbs</span></div>
            <div class="flex justify-between"><span>Water Hardness Level</span><span class="font-bold" id="ws2-level">--</span></div>
            <div class="flex justify-between"><span>Annual Water for Regen</span><span class="font-bold" id="ws2-regenwater">0 gal</span></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="water-softener" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcWS2() {
      const people = parseInt((document.getElementById('ws2-people') as HTMLInputElement).value) || 4;
      const hardness = parseFloat((document.getElementById('ws2-hard') as HTMLInputElement).value) || 15;
      const iron = parseFloat((document.getElementById('ws2-iron') as HTMLInputElement).value) || 0;
      const gpd = parseFloat((document.getElementById('ws2-gpd') as HTMLInputElement).value) || 75;
      const freq = parseInt((document.getElementById('ws2-freq') as HTMLSelectElement).value) || 7;

      // Effective hardness: iron adds 5 GPG per ppm
      const effHardness = hardness + (iron * 5);
      const dailyUsage = people * gpd;
      const dailyGrains = dailyUsage * effHardness;
      const totalGrains = dailyGrains * freq;

      // Standard softener sizes: 24000, 32000, 40000, 48000, 64000, 80000, 96000
      const sizes = [24000, 32000, 40000, 48000, 64000, 80000, 96000];
      let recSize = sizes[sizes.length - 1];
      for (const s of sizes) {
        if (s >= totalGrains) { recSize = s; break; }
      }

      // Salt usage: approximately 6-8 lbs per 1000 grains regenerated (at efficient setting)
      const saltPerRegen = (recSize / 1000) * 6;
      const regensPerYear = 365 / freq;
      const annualSalt = saltPerRegen * regensPerYear;
      const saltCostPerLb = 0.15; // bulk salt ~$6/40lb bag
      const annualSaltCost = annualSalt * saltCostPerLb;

      // Resin volume (approx 1 cu ft per 30,000 grains)
      const resinVol = recSize / 30000;

      // Regen water usage: ~50 gallons per cu ft of resin per regen
      const regenWater = resinVol * 50 * regensPerYear;

      let level = 'Soft';
      if (effHardness <= 1) level = 'Soft (0-1 GPG)';
      else if (effHardness <= 3.5) level = 'Slightly Hard';
      else if (effHardness <= 7) level = 'Moderately Hard';
      else if (effHardness <= 10.5) level = 'Hard';
      else if (effHardness <= 15) level = 'Very Hard';
      else level = 'Extremely Hard';

      document.getElementById('ws2-size')!.textContent = recSize.toLocaleString() + ' grains';
      document.getElementById('ws2-daily')!.textContent = Math.round(dailyGrains).toLocaleString() + ' gr/day';
      document.getElementById('ws2-effhard')!.textContent = effHardness.toFixed(1) + ' GPG';
      document.getElementById('ws2-salt')!.textContent = saltPerRegen.toFixed(1) + ' lbs';
      document.getElementById('ws2-saltcost')!.textContent = '$' + Math.round(annualSaltCost);
      document.getElementById('ws2-resin')!.textContent = resinVol.toFixed(1) + ' cu ft';
      document.getElementById('ws2-monsalt')!.textContent = Math.round(annualSalt / 12) + ' lbs';
      document.getElementById('ws2-level')!.textContent = level;
      document.getElementById('ws2-regenwater')!.textContent = Math.round(regenWater).toLocaleString() + ' gal';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ws2-in').forEach(el => { el.addEventListener('input', calcWS2); el.addEventListener('change', calcWS2); });
      calcWS2();
    }, 50);
  </script>
</CalculatorLayout>
