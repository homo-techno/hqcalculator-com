---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Gas Mileage Calculator - MPG, Fuel Cost & Trip Calculator";
const description = "Calculate gas mileage (MPG), fuel cost per trip, and compare vehicles. Track fuel efficiency and estimate trip costs.";

const relatedCalcs = [
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Discount Calculator", url: "/discount-calculator", description: "Discounts." },
  { name: "Length Converter", url: "/length-converter", description: "Length units." },
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Energy costs." },
  { name: "Savings Calculator", url: "/savings-calculator", description: "Savings growth." },
  { name: "Loan Calculator", url: "/loan-calculator", description: "Loan payments." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Gas Mileage Calculator"
  keywords="gas mileage calculator, mpg calculator, fuel cost, miles per gallon, fuel efficiency, trip cost calculator"
  breadcrumbs={[{ name: "Gas Mileage", url: "/gas-mileage-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Gas Mileage Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate MPG, fuel costs, and compare trip expenses.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <!-- Mode tabs -->
          <div class="flex gap-2 mb-5">
            <button class="gm-mode-btn px-4 py-2 rounded-xl text-sm font-semibold border border-primary bg-blue-50 text-primary" data-mode="mpg">Calculate MPG</button>
            <button class="gm-mode-btn px-4 py-2 rounded-xl text-sm font-semibold border border-border" data-mode="trip">Trip Cost</button>
            <button class="gm-mode-btn px-4 py-2 rounded-xl text-sm font-semibold border border-border" data-mode="compare">Compare</button>
          </div>

          <!-- MPG mode -->
          <div id="gm-mpg">
            <div class="space-y-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Distance Driven (miles)</label>
                <input type="number" id="gm-distance" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="350" min="0" step="1">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Fuel Used (gallons)</label>
                <input type="number" id="gm-fuel" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="12.5" min="0" step="0.1">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Gas Price (per gallon)</label>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
                  <input type="number" id="gm-gas-price" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="3.50" min="0" step="0.01">
                </div>
              </div>
            </div>
          </div>

          <!-- Trip mode -->
          <div id="gm-trip" class="hidden">
            <div class="space-y-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Trip Distance (miles)</label>
                <input type="number" id="gm-trip-dist" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="500" min="0" step="1">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Your MPG</label>
                <input type="number" id="gm-trip-mpg" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="28" min="1" step="0.5">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Gas Price (per gallon)</label>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
                  <input type="number" id="gm-trip-price" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="3.50" min="0" step="0.01">
                </div>
              </div>
            </div>
          </div>

          <!-- Compare mode -->
          <div id="gm-compare" class="hidden">
            <div class="space-y-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Annual Miles Driven</label>
                <input type="number" id="gm-annual" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="12000" min="0" step="500">
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Gas Price (per gallon)</label>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
                  <input type="number" id="gm-cmp-price" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="3.50" min="0" step="0.01">
                </div>
              </div>
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label class="block text-xs font-medium text-text mb-1">Vehicle A MPG</label>
                  <input type="number" id="gm-mpg-a" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="25" min="1" step="0.5">
                </div>
                <div>
                  <label class="block text-xs font-medium text-text mb-1">Vehicle B MPG</label>
                  <input type="number" id="gm-mpg-b" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="35" min="1" step="0.5">
                </div>
              </div>
            </div>
          </div>

          <!-- MPG presets -->
          <div class="mt-4 p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-2">Average MPG by Vehicle Type</h3>
            <div class="grid grid-cols-2 gap-2 text-xs">
              <div class="flex justify-between"><span>Compact Car</span><span class="font-bold">32 MPG</span></div>
              <div class="flex justify-between"><span>Sedan</span><span class="font-bold">28 MPG</span></div>
              <div class="flex justify-between"><span>SUV</span><span class="font-bold">24 MPG</span></div>
              <div class="flex justify-between"><span>Truck</span><span class="font-bold">20 MPG</span></div>
              <div class="flex justify-between"><span>Hybrid</span><span class="font-bold">48 MPG</span></div>
              <div class="flex justify-between"><span>Minivan</span><span class="font-bold">22 MPG</span></div>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <!-- MPG results -->
          <div id="gm-mpg-results">
            <div class="p-6 bg-primary rounded-2xl text-white text-center">
              <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="gm-result-label">Fuel Economy</div>
              <div class="text-4xl sm:text-5xl font-extrabold" id="gm-result">28.0 MPG</div>
            </div>
            <div class="grid grid-cols-2 gap-3 mt-3">
              <div class="p-4 bg-surface-alt rounded-xl text-center">
                <div class="text-xs text-text-muted uppercase">Cost per Mile</div>
                <div class="text-xl font-bold" id="gm-cpm">$0.13</div>
              </div>
              <div class="p-4 bg-surface-alt rounded-xl text-center">
                <div class="text-xs text-text-muted uppercase">Fuel Cost</div>
                <div class="text-xl font-bold text-secondary" id="gm-fuel-cost">$43.75</div>
              </div>
              <div class="p-4 bg-surface-alt rounded-xl text-center">
                <div class="text-xs text-text-muted uppercase">L/100 km</div>
                <div class="text-xl font-bold" id="gm-l100">0</div>
              </div>
              <div class="p-4 bg-surface-alt rounded-xl text-center">
                <div class="text-xs text-text-muted uppercase">km/L</div>
                <div class="text-xl font-bold" id="gm-kml">0</div>
              </div>
            </div>
          </div>

          <!-- Annual cost estimator -->
          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-2" id="gm-annual-label">Annual Fuel Estimate</h3>
            <div class="space-y-1 text-sm" id="gm-annual-detail"></div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="gas-mileage" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Gas Mileage</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>MPG</strong> = Miles Driven ÷ Gallons Used</p>
        <p><strong>Trip Cost</strong> = (Distance ÷ MPG) × Gas Price</p>
        <p><strong>L/100km</strong> = 235.215 ÷ MPG</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Tips to Improve Gas Mileage</h3>
      <ul>
        <li>Keep tires properly inflated (improves MPG by up to 3%)</li>
        <li>Avoid aggressive driving — rapid acceleration and braking waste fuel</li>
        <li>Remove excess weight from your vehicle</li>
        <li>Use cruise control on highways</li>
        <li>Keep your engine properly tuned</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What's good gas mileage?</strong> 25-30 MPG is average for passenger cars. 40+ MPG is excellent. Hybrids average 45-55 MPG.</p>
      <p><strong>How do I convert MPG to L/100km?</strong> Divide 235.215 by the MPG value. For example, 28 MPG = 8.4 L/100km.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let gmMode = 'mpg';
    const fmt = (n: number) => '$' + n.toFixed(2);

    function calcGasMileage() {
      if (gmMode === 'mpg') {
        const dist = parseFloat((document.getElementById('gm-distance') as HTMLInputElement).value) || 0;
        const fuel = parseFloat((document.getElementById('gm-fuel') as HTMLInputElement).value) || 0;
        const price = parseFloat((document.getElementById('gm-gas-price') as HTMLInputElement).value) || 0;

        const mpg = fuel > 0 ? dist / fuel : 0;
        const costPerMile = mpg > 0 ? price / mpg : 0;
        const fuelCost = fuel * price;

        document.getElementById('gm-result-label')!.textContent = 'Fuel Economy';
        document.getElementById('gm-result')!.textContent = mpg.toFixed(1) + ' MPG';
        document.getElementById('gm-cpm')!.textContent = fmt(costPerMile);
        document.getElementById('gm-fuel-cost')!.textContent = fmt(fuelCost);
        document.getElementById('gm-l100')!.textContent = mpg > 0 ? (235.215 / mpg).toFixed(1) : '—';
        document.getElementById('gm-kml')!.textContent = (mpg * 0.425144).toFixed(1);

        // Annual estimate
        const annualMiles = 12000;
        const annualGallons = mpg > 0 ? annualMiles / mpg : 0;
        const annualCost = annualGallons * price;
        document.getElementById('gm-annual-label')!.textContent = 'Annual Estimate (12,000 mi)';
        document.getElementById('gm-annual-detail')!.innerHTML = `
          <div class="flex justify-between"><span>Gallons/year</span><span class="font-bold">${Math.round(annualGallons)}</span></div>
          <div class="flex justify-between"><span>Annual fuel cost</span><span class="font-bold text-secondary">${fmt(annualCost)}</span></div>
          <div class="flex justify-between"><span>Monthly fuel cost</span><span class="font-bold">${fmt(annualCost / 12)}</span></div>
        `;
      } else if (gmMode === 'trip') {
        const dist = parseFloat((document.getElementById('gm-trip-dist') as HTMLInputElement).value) || 0;
        const mpg = parseFloat((document.getElementById('gm-trip-mpg') as HTMLInputElement).value) || 1;
        const price = parseFloat((document.getElementById('gm-trip-price') as HTMLInputElement).value) || 0;

        const gallons = dist / mpg;
        const cost = gallons * price;
        const costPerMile = price / mpg;

        document.getElementById('gm-result-label')!.textContent = 'Trip Fuel Cost';
        document.getElementById('gm-result')!.textContent = '$' + cost.toFixed(2);
        document.getElementById('gm-cpm')!.textContent = fmt(costPerMile);
        document.getElementById('gm-fuel-cost')!.textContent = gallons.toFixed(1) + ' gal';
        document.getElementById('gm-l100')!.textContent = (235.215 / mpg).toFixed(1);
        document.getElementById('gm-kml')!.textContent = (mpg * 0.425144).toFixed(1);

        // Round trip
        document.getElementById('gm-annual-label')!.textContent = 'Trip Details';
        document.getElementById('gm-annual-detail')!.innerHTML = `
          <div class="flex justify-between"><span>One-way</span><span class="font-bold">${fmt(cost)}</span></div>
          <div class="flex justify-between"><span>Round trip</span><span class="font-bold text-secondary">${fmt(cost * 2)}</span></div>
          <div class="flex justify-between"><span>Gallons needed</span><span class="font-bold">${gallons.toFixed(1)}</span></div>
          <div class="flex justify-between"><span>Tank stops (15 gal tank)</span><span class="font-bold">${Math.ceil(gallons / 15)}</span></div>
        `;
      } else {
        const annual = parseFloat((document.getElementById('gm-annual') as HTMLInputElement).value) || 0;
        const price = parseFloat((document.getElementById('gm-cmp-price') as HTMLInputElement).value) || 0;
        const mpgA = parseFloat((document.getElementById('gm-mpg-a') as HTMLInputElement).value) || 1;
        const mpgB = parseFloat((document.getElementById('gm-mpg-b') as HTMLInputElement).value) || 1;

        const costA = (annual / mpgA) * price;
        const costB = (annual / mpgB) * price;
        const savings = Math.abs(costA - costB);

        document.getElementById('gm-result-label')!.textContent = 'Annual Savings';
        document.getElementById('gm-result')!.textContent = '$' + Math.round(savings).toLocaleString() + '/yr';
        document.getElementById('gm-cpm')!.textContent = fmt(price / mpgA);
        document.getElementById('gm-fuel-cost')!.textContent = fmt(price / mpgB);

        const labels = document.querySelectorAll('#gm-mpg-results .text-text-muted');
        if (labels[0]) labels[0].textContent = 'Vehicle A $/mi';
        if (labels[1]) labels[1].textContent = 'Vehicle B $/mi';

        document.getElementById('gm-l100')!.textContent = (235.215 / mpgA).toFixed(1);
        document.getElementById('gm-kml')!.textContent = (235.215 / mpgB).toFixed(1);

        document.getElementById('gm-annual-label')!.textContent = 'Comparison';
        document.getElementById('gm-annual-detail')!.innerHTML = `
          <div class="flex justify-between"><span>Vehicle A (${mpgA} MPG)</span><span class="font-bold">$${Math.round(costA).toLocaleString()}/yr</span></div>
          <div class="flex justify-between"><span>Vehicle B (${mpgB} MPG)</span><span class="font-bold">$${Math.round(costB).toLocaleString()}/yr</span></div>
          <div class="flex justify-between pt-1 border-t border-border/50"><span class="font-semibold">${costA > costB ? 'Vehicle B' : 'Vehicle A'} saves</span><span class="font-bold text-secondary">$${Math.round(savings).toLocaleString()}/yr</span></div>
          <div class="flex justify-between"><span>5-year savings</span><span class="font-bold">$${Math.round(savings * 5).toLocaleString()}</span></div>
        `;
      }

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.gm-mode-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.gm-mode-btn').forEach(b => { b.classList.remove('border-primary', 'bg-blue-50', 'text-primary'); b.classList.add('border-border'); });
          btn.classList.remove('border-border'); btn.classList.add('border-primary', 'bg-blue-50', 'text-primary');
          gmMode = (btn as HTMLElement).dataset.mode || 'mpg';
          document.getElementById('gm-mpg')!.classList.toggle('hidden', gmMode !== 'mpg');
          document.getElementById('gm-trip')!.classList.toggle('hidden', gmMode !== 'trip');
          document.getElementById('gm-compare')!.classList.toggle('hidden', gmMode !== 'compare');
          calcGasMileage();
        });
      });

      ['gm-distance', 'gm-fuel', 'gm-gas-price', 'gm-trip-dist', 'gm-trip-mpg', 'gm-trip-price', 'gm-annual', 'gm-cmp-price', 'gm-mpg-a', 'gm-mpg-b'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcGasMileage);
      });

      calcGasMileage();
    }, 50);
  </script>
</CalculatorLayout>
