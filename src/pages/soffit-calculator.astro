---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Soffit & Fascia Calculator - Area, Panels & Vent Requirements";
const description = "Calculate soffit and fascia material for your home. Enter perimeter, overhang width, and fascia height to get square footage, panels, vents, and linear feet.";

const relatedCalcs = [
  { name: "Siding Calculator", url: "/siding-calculator", description: "Siding material needs." },
  { name: "Rafter Calculator", url: "/rafter-calculator", description: "Rafter length." },
  { name: "Truss Calculator", url: "/truss-calculator", description: "Roof truss design." },
  { name: "Pergola Calculator", url: "/pergola-calculator", description: "Pergola lumber." },
  { name: "Patio Calculator", url: "/patio-calculator", description: "Patio material." },
  { name: "Garage Door Calculator", url: "/garage-door-calculator", description: "Garage door sizing." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Soffit & Fascia Calculator"
  keywords="soffit calculator, fascia calculator, soffit panels, soffit area, fascia linear feet, attic ventilation, soffit vents"
  breadcrumbs={[{ name: "Soffit Calculator", url: "/soffit-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Soffit & Fascia Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate soffit panels, fascia boards, and ventilation needs for your home.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">House Perimeter (ft)</label>
            <input type="number" id="sf2-perim" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="160" min="10" step="1">
          </div>

          <div class="grid grid-cols-2 gap-3 mb-5">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Overhang Width (inches)</label>
              <input type="number" id="sf2-overhang" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="16" min="4" step="1">
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Fascia Height (inches)</label>
              <input type="number" id="sf2-fascia" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="6" min="3" step="0.5">
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Soffit Panel Size</label>
            <select id="sf2-panel" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
              <option value="12x12" selected>12" x 12' panel (12 sq ft)</option>
              <option value="16x12">16" x 12' panel (16 sq ft)</option>
              <option value="24x12">24" x 12' panel (24 sq ft)</option>
            </select>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Attic Area (sq ft)</label>
                <input type="number" id="sf2-attic" class="w-full px-3 py-2 border border-border rounded-lg" value="1200" min="100" step="50">
                <div class="text-xs text-text-muted mt-1">For vent area calculation</div>
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Waste Factor (%)</label>
                <input type="number" id="sf2-waste" class="w-full px-3 py-2 border border-border rounded-lg" value="10" min="0" max="30" step="1">
              </div>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Soffit Area</div>
            <div class="text-5xl font-extrabold font-mono" id="sf2-area">0</div>
            <div class="text-sm text-blue-200 mt-1">square feet</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Soffit Panels</div>
              <div class="text-xl font-bold" id="sf2-panels">0</div>
              <div class="text-xs text-text-muted">with waste</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Fascia (linear ft)</div>
              <div class="text-xl font-bold" id="sf2-fascialft">0</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Vent Area Needed</div>
              <div class="text-xl font-bold" id="sf2-ventarea">0 sq in</div>
              <div class="text-xs text-text-muted">1/150 of attic area</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Fascia Boards (1x6x12)</div>
              <div class="text-xl font-bold" id="sf2-fasciaboards">0</div>
            </div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">F-Channel / J-Channel</div>
            <div class="text-xl font-bold" id="sf2-channel">0 pieces</div>
            <div class="text-xs text-text-muted">12 ft pieces</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="soffit" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Soffit & Fascia</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Soffit area:</strong> Perimeter x Overhang width (ft)</p>
        <p><strong>Fascia:</strong> Perimeter in linear feet, divided by board length</p>
        <p><strong>Vent area:</strong> Attic sq ft / 150 (code minimum NFA)</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Ventilation Requirements</h3>
      <ul>
        <li><strong>1/150 rule:</strong> 1 sq ft of Net Free Area per 150 sq ft of attic (no vapor barrier)</li>
        <li><strong>1/300 rule:</strong> 1 sq ft per 300 sq ft if vapor barrier present and balanced intake/exhaust</li>
        <li>Soffit vents should provide at least 50% of total attic ventilation</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const sf2PanelSizes: Record<string, number> = {
      '12x12': 12,
      '16x12': 16,
      '24x12': 24,
    };

    function calcSoffit() {
      const perim = parseFloat((document.getElementById('sf2-perim') as HTMLInputElement).value) || 0;
      const overhangIn = parseFloat((document.getElementById('sf2-overhang') as HTMLInputElement).value) || 0;
      const fasciaH = parseFloat((document.getElementById('sf2-fascia') as HTMLInputElement).value) || 6;
      const panelType = (document.getElementById('sf2-panel') as HTMLSelectElement).value;
      const attic = parseFloat((document.getElementById('sf2-attic') as HTMLInputElement).value) || 0;
      const waste = (parseFloat((document.getElementById('sf2-waste') as HTMLInputElement).value) || 0) / 100;

      const overhangFt = overhangIn / 12;
      const soffitArea = perim * overhangFt;
      const soffitWithWaste = soffitArea * (1 + waste);

      const panelSqFt = sf2PanelSizes[panelType] || 12;
      const panels = Math.ceil(soffitWithWaste / panelSqFt);

      const fasciaLft = perim;
      const fasciaBoards = Math.ceil(fasciaLft / 12); // 12 ft boards

      // Vent area: 1/150 rule, converted to sq inches
      const ventAreaSqFt = attic / 150;
      const ventAreaSqIn = ventAreaSqFt * 144;

      // F/J channel: 2 pieces per 12 ft run (wall side + fascia side)
      const channelPieces = Math.ceil(perim / 12) * 2;

      document.getElementById('sf2-area')!.textContent = Math.ceil(soffitArea).toLocaleString();
      document.getElementById('sf2-panels')!.textContent = String(panels);
      document.getElementById('sf2-fascialft')!.textContent = perim.toLocaleString() + ' ft';
      document.getElementById('sf2-ventarea')!.textContent = Math.ceil(ventAreaSqIn).toLocaleString() + ' sq in';
      document.getElementById('sf2-fasciaboards')!.textContent = String(fasciaBoards);
      document.getElementById('sf2-channel')!.textContent = channelPieces + ' pieces';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('#sf2-perim, #sf2-overhang, #sf2-fascia, #sf2-attic, #sf2-waste').forEach(el => {
        el.addEventListener('input', calcSoffit);
        el.addEventListener('change', calcSoffit);
      });
      document.querySelectorAll('#sf2-panel').forEach(el => {
        el.addEventListener('input', calcSoffit);
        el.addEventListener('change', calcSoffit);
      });
      calcSoffit();
    }, 50);
  </script>
</CalculatorLayout>
