---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Game FPS Calculator";
const description = "Estimate expected FPS from GPU/CPU benchmark scores, analyze bottlenecks, and calculate resolution scaling impact on frame rates.";
const relatedCalcs = [
  { name: "Video Frame Rate", url: "/video-frame-rate-calculator", description: "Frame rate conversion." },
  { name: "Screen Size", url: "/screen-size-calculator", description: "Display calculations." },
  { name: "Speed Calculator", url: "/speed-calculator", description: "Rate calculations." },
  { name: "Aspect Ratio", url: "/aspect-ratio-calculator", description: "Aspect ratio math." },
  { name: "Video Bitrate", url: "/video-bitrate-calculator", description: "Bitrate estimation." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage math." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Game FPS Calculator" keywords="fps calculator, game performance, gpu benchmark, cpu bottleneck, resolution scaling, frame rate estimate" breadcrumbs={[{ name: "Game FPS", url: "/game-fps-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Game FPS Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate expected FPS based on hardware benchmarks and resolution settings.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-text mb-1">GPU Benchmark Score (e.g., 3DMark)</label>
          <input type="number" class="gf2-in w-full px-4 py-2 border border-border rounded-lg" id="gf2-gpu" min="100" value="12000">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">CPU Benchmark Score (single-thread)</label>
          <input type="number" class="gf2-in w-full px-4 py-2 border border-border rounded-lg" id="gf2-cpu" min="100" value="1800">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Target Resolution</label>
          <select class="gf2-in w-full px-4 py-2 border border-border rounded-lg" id="gf2-res">
            <option value="720">720p (1280x720)</option>
            <option value="1080" selected>1080p (1920x1080)</option>
            <option value="1440">1440p (2560x1440)</option>
            <option value="2160">4K (3840x2160)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Game Optimization Level</label>
          <select class="gf2-in w-full px-4 py-2 border border-border rounded-lg" id="gf2-opt">
            <option value="1.3">Well Optimized (e.g., Valorant)</option>
            <option value="1.0" selected>Average Optimization</option>
            <option value="0.7">Poorly Optimized (e.g., new AAA)</option>
            <option value="0.5">Very Demanding (e.g., Cyberpunk Ultra)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Graphics Quality Preset</label>
          <select class="gf2-in w-full px-4 py-2 border border-border rounded-lg" id="gf2-quality">
            <option value="1.6">Low</option>
            <option value="1.2">Medium</option>
            <option value="1.0" selected>High</option>
            <option value="0.75">Ultra</option>
            <option value="0.55">Ultra + Ray Tracing</option>
          </select>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated FPS</div>
          <div class="text-5xl font-extrabold font-mono" id="gf2-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">GPU-Limited FPS</div>
            <div class="text-xl font-bold font-mono" id="gf2-gpufps">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">CPU-Limited FPS</div>
            <div class="text-xl font-bold font-mono" id="gf2-cpufps">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Bottleneck</div>
            <div class="text-lg font-bold font-mono" id="gf2-bottleneck">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Frame Time</div>
            <div class="text-lg font-bold font-mono" id="gf2-frametime">--</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Resolution Comparison</h3>
          <div class="text-xs font-mono space-y-1" id="gf2-compare"></div>
        </div>
      </div>
      <ShareButton calculatorId="game-fps" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcGF2() {
      const gpu = parseFloat((document.getElementById('gf2-gpu') as HTMLInputElement).value) || 12000;
      const cpu = parseFloat((document.getElementById('gf2-cpu') as HTMLInputElement).value) || 1800;
      const res = parseInt((document.getElementById('gf2-res') as HTMLSelectElement).value);
      const opt = parseFloat((document.getElementById('gf2-opt') as HTMLSelectElement).value);
      const quality = parseFloat((document.getElementById('gf2-quality') as HTMLSelectElement).value);

      const pixelCounts: Record<number, number> = { 720: 921600, 1080: 2073600, 1440: 3686400, 2160: 8294400 };
      const basePixels = pixelCounts[1080];
      const resScale = basePixels / pixelCounts[res];

      // GPU FPS estimate: benchmark score maps roughly to FPS at 1080p
      const gpuFps = Math.round((gpu / 100) * opt * quality * resScale);

      // CPU FPS estimate: single-thread score, less affected by resolution
      const cpuFps = Math.round((cpu / 10) * opt * 1.1);

      const estimatedFps = Math.min(gpuFps, cpuFps);
      const bottleneck = gpuFps < cpuFps ? 'GPU' : (cpuFps < gpuFps ? 'CPU' : 'Balanced');
      const frameTime = (1000 / estimatedFps).toFixed(2);

      document.getElementById('gf2-result')!.textContent = estimatedFps.toString();
      document.getElementById('gf2-gpufps')!.textContent = gpuFps + ' FPS';
      document.getElementById('gf2-cpufps')!.textContent = cpuFps + ' FPS';
      document.getElementById('gf2-bottleneck')!.textContent = bottleneck;
      document.getElementById('gf2-frametime')!.textContent = frameTime + ' ms';

      let compare = '';
      const resLabels: Record<number, string> = { 720: '720p', 1080: '1080p', 1440: '1440p', 2160: '4K' };
      for (const [r, px] of Object.entries(pixelCounts)) {
        const rScale = basePixels / px;
        const rFps = Math.min(Math.round((gpu / 100) * opt * quality * rScale), cpuFps);
        const marker = parseInt(r) === res ? ' <-' : '';
        compare += '<div class="flex justify-between"><span>' + resLabels[parseInt(r)] + '</span><span>' + rFps + ' FPS' + marker + '</span></div>';
      }
      document.getElementById('gf2-compare')!.innerHTML = compare;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.gf2-in').forEach(el => { el.addEventListener('input', calcGF2); el.addEventListener('change', calcGF2); });
      calcGF2();
    }, 50);
  </script>
</CalculatorLayout>
