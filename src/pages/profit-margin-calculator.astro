---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Profit Margin Calculator - Markup, Margin & Revenue";
const description = "Calculate profit margin, markup percentage, gross profit, and revenue. Convert between margin and markup for business pricing.";

const relatedCalcs = [
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Discount Calculator", url: "/discount-calculator", description: "Discount pricing." },
  { name: "Sales Tax Calculator", url: "/sales-tax-calculator", description: "Sales tax." },
  { name: "Salary Calculator", url: "/salary-calculator", description: "Salary breakdown." },
  { name: "Loan Calculator", url: "/loan-calculator", description: "Loan payments." },
  { name: "Investment Calculator", url: "/investment-calculator", description: "Investments." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Profit Margin Calculator"
  keywords="profit margin calculator, markup calculator, gross margin, net margin, business profit, pricing calculator"
  breadcrumbs={[{ name: "Profit Margin", url: "/profit-margin-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Profit Margin Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate profit margin, markup, and gross profit for any product or business.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="flex gap-2 mb-6">
        <button class="pm-mode-btn px-4 py-2 rounded-full text-sm font-semibold bg-primary text-white" data-mode="margin">Margin</button>
        <button class="pm-mode-btn px-4 py-2 rounded-full text-sm font-semibold bg-surface-alt text-text-secondary" data-mode="markup">Markup</button>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Cost</label>
          <div class="relative"><span class="absolute left-4 top-1/2 -translate-y-1/2 text-text-muted font-bold">$</span><input type="number" id="pm-cost" class="w-full pl-8 pr-4 py-3 border border-border rounded-xl text-xl font-bold" value="50" min="0" step="0.01"></div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Revenue / Selling Price</label>
          <div class="relative"><span class="absolute left-4 top-1/2 -translate-y-1/2 text-text-muted font-bold">$</span><input type="number" id="pm-revenue" class="w-full pl-8 pr-4 py-3 border border-border rounded-xl text-xl font-bold" value="80" min="0" step="0.01"></div>
        </div>
      </div>

      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="pm-label">Profit Margin</div>
        <div class="text-5xl font-extrabold" id="pm-result">37.5%</div>
      </div>

      <div class="grid grid-cols-2 gap-3 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Profit</div>
          <div class="text-xl font-bold text-secondary" id="pm-profit">$30.00</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Markup</div>
          <div class="text-xl font-bold" id="pm-markup">60.0%</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Margin</div>
          <div class="text-xl font-bold" id="pm-margin">37.5%</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Cost / Revenue</div>
          <div class="text-xl font-bold" id="pm-ratio">62.5%</div>
        </div>
      </div>

      <!-- Margin ↔ Markup table -->
      <div class="bg-surface-alt rounded-xl p-4 mb-6">
        <h3 class="font-semibold text-sm text-text mb-3">Margin ↔ Markup Reference</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead><tr class="border-b border-border text-left"><th class="py-1 font-semibold">Margin</th><th class="py-1 font-semibold">Markup</th><th class="py-1 font-semibold">Multiplier</th></tr></thead>
            <tbody id="pm-table"></tbody>
          </table>
        </div>
      </div>

      <ShareButton calculatorId="profit-margin" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Margin vs. Markup</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Margin</strong> = (Revenue − Cost) / Revenue × 100</p>
        <p><strong>Markup</strong> = (Revenue − Cost) / Cost × 100</p>
      </div>
      <p>Margin is the percentage of the selling price that is profit. Markup is how much more than cost you charge. A 50% markup yields a 33.3% margin.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What's a good profit margin?</strong> It depends on industry. Retail: 2-5% net. Software: 20-40% net. Restaurants: 3-9% net. Luxury goods: 10-20%+.</p>
      <p><strong>Margin vs. markup — which should I use?</strong> Margin is better for analyzing profitability. Markup is more intuitive for pricing. Convert between them using the table above.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let pmMode = 'margin';
    const fmt = (n: number) => '$' + n.toFixed(2);

    function calcPM() {
      const cost = parseFloat((document.getElementById('pm-cost') as HTMLInputElement).value) || 0;
      const revenue = parseFloat((document.getElementById('pm-revenue') as HTMLInputElement).value) || 0;
      const profit = revenue - cost;
      const margin = revenue > 0 ? (profit / revenue * 100) : 0;
      const markup = cost > 0 ? (profit / cost * 100) : 0;
      const ratio = revenue > 0 ? (cost / revenue * 100) : 0;

      document.getElementById('pm-label')!.textContent = pmMode === 'margin' ? 'Profit Margin' : 'Markup';
      document.getElementById('pm-result')!.textContent = (pmMode === 'margin' ? margin : markup).toFixed(1) + '%';
      document.getElementById('pm-profit')!.textContent = fmt(profit);
      document.getElementById('pm-margin')!.textContent = margin.toFixed(1) + '%';
      document.getElementById('pm-markup')!.textContent = markup.toFixed(1) + '%';
      document.getElementById('pm-ratio')!.textContent = ratio.toFixed(1) + '%';

      // Table
      const margins = [10, 15, 20, 25, 30, 33.3, 40, 50, 60, 75];
      document.getElementById('pm-table')!.innerHTML = margins.map(m => {
        const mu = m / (100 - m) * 100;
        const mult = (100 / (100 - m));
        const highlight = Math.abs(m - margin) < 2;
        return `<tr class="border-b border-border/20 ${highlight ? 'font-bold text-primary bg-blue-50' : ''}">
          <td class="py-1">${m.toFixed(1)}%</td>
          <td class="py-1">${mu.toFixed(1)}%</td>
          <td class="py-1">×${mult.toFixed(2)}</td>
        </tr>`;
      }).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.pm-mode-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.pm-mode-btn').forEach(b => { b.classList.remove('bg-primary', 'text-white'); b.classList.add('bg-surface-alt', 'text-text-secondary'); });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary'); btn.classList.add('bg-primary', 'text-white');
          pmMode = (btn as HTMLElement).dataset.mode || 'margin';
          calcPM();
        });
      });

      ['pm-cost', 'pm-revenue'].forEach(id => document.getElementById(id)!.addEventListener('input', calcPM));
      calcPM();
    }, 50);
  </script>
</CalculatorLayout>
