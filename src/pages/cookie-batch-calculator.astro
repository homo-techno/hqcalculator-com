---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Cookie Batch Calculator - Scale Recipes by Count & Size";
const description = "Scale cookie recipes to make any number of cookies in your desired size. Get exact ingredient amounts for chocolate chip, sugar, and other cookies.";
const relatedCalcs = [
  { name: "Cake Pan Converter", url: "/cake-pan-converter-calculator", description: "Convert recipes between pan sizes." },
  { name: "Frosting Calculator", url: "/frosting-calculator", description: "Calculate frosting quantities." },
  { name: "Baking Conversion Calculator", url: "/baking-conversion-calculator", description: "Convert between baking units." },
  { name: "Recipe Scaler", url: "/recipe-scaler", description: "Scale any recipe up or down." },
  { name: "Baker's Percentage Calculator", url: "/baker-percentage-calculator", description: "Baker's percentages for recipes." },
  { name: "Baking Altitude Calculator", url: "/baking-altitude-calculator", description: "High altitude adjustments." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Cookie Batch Calculator" keywords="cookie recipe scaling, cookie batch size, how many cookies, cookie dough calculator, scale cookie recipe" breadcrumbs={[{ name: "Cookie Batch", url: "/cookie-batch-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Cookie Batch Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Scale any cookie recipe to make exactly the number of cookies you need, in your preferred size.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Cookie Type</label>
          <select id="cob-type" class="cob-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="chocchip">Chocolate Chip</option>
            <option value="sugar">Sugar Cookies</option>
            <option value="oatmeal">Oatmeal Raisin</option>
            <option value="peanut">Peanut Butter</option>
            <option value="snicker">Snickerdoodle</option>
            <option value="shortbread">Shortbread</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Desired Cookie Count</label>
            <input type="number" id="cob-count" class="cob-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="24" min="1" step="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Cookie Size</label>
            <select id="cob-size" class="cob-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="small">Small (1 tbsp / 15g)</option>
              <option value="medium" selected>Medium (2 tbsp / 30g)</option>
              <option value="large">Large (3 tbsp / 45g)</option>
              <option value="bakery">Bakery Size (1/4 cup / 60g)</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Dough Weight</div>
          <div class="text-5xl font-extrabold font-mono" id="cob-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Flour</div>
            <div class="text-xl font-bold font-mono" id="cob-flour">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Butter</div>
            <div class="text-xl font-bold font-mono" id="cob-butter">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Sugar</div>
            <div class="text-xl font-bold font-mono" id="cob-sugar">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Eggs</div>
            <div class="text-xl font-bold font-mono" id="cob-eggs">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Mix-ins / Special</div>
            <div class="text-xl font-bold font-mono" id="cob-mixin">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Sheet Pans Needed</div>
            <div class="text-xl font-bold font-mono" id="cob-pans">--</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Baking Temp & Time</div>
          <div class="text-xl font-bold font-mono" id="cob-bake">--</div>
        </div>
      </div>
      <ShareButton calculatorId="cookie-batch" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcCOB() {
      const type = (document.getElementById('cob-type') as HTMLSelectElement).value;
      const count = parseFloat((document.getElementById('cob-count') as HTMLInputElement).value) || 24;
      const size = (document.getElementById('cob-size') as HTMLSelectElement).value;

      const sizeG: Record<string, number> = { small: 15, medium: 30, large: 45, bakery: 60 };
      const doughPerCookie = sizeG[size];
      const totalDough = count * doughPerCookie;

      // Base recipes normalized to percentages of total dough weight
      // flour%, butter%, sugar%, egg%, mixin%
      const recipes: Record<string, {flour: number, butter: number, sugar: number, egg: number, mixin: number, mixinName: string, temp: string}> = {
        chocchip: { flour: 0.33, butter: 0.22, sugar: 0.27, egg: 0.08, mixin: 0.10, mixinName: 'Chocolate chips', temp: '375\u00B0F / 190\u00B0C' },
        sugar:    { flour: 0.40, butter: 0.24, sugar: 0.26, egg: 0.08, mixin: 0.02, mixinName: 'Vanilla extract', temp: '350\u00B0F / 175\u00B0C' },
        oatmeal:  { flour: 0.22, butter: 0.18, sugar: 0.22, egg: 0.07, mixin: 0.31, mixinName: 'Oats + raisins', temp: '350\u00B0F / 175\u00B0C' },
        peanut:   { flour: 0.28, butter: 0.14, sugar: 0.24, egg: 0.07, mixin: 0.27, mixinName: 'Peanut butter', temp: '350\u00B0F / 175\u00B0C' },
        snicker:  { flour: 0.38, butter: 0.24, sugar: 0.28, egg: 0.08, mixin: 0.02, mixinName: 'Cinnamon-sugar coating', temp: '375\u00B0F / 190\u00B0C' },
        shortbread: { flour: 0.48, butter: 0.32, sugar: 0.18, egg: 0.00, mixin: 0.02, mixinName: 'Vanilla/salt', temp: '325\u00B0F / 163\u00B0C' },
      };

      const r = recipes[type];
      const flourG = totalDough * r.flour;
      const butterG = totalDough * r.butter;
      const sugarG = totalDough * r.sugar;
      const eggG = totalDough * r.egg;
      const mixinG = totalDough * r.mixin;
      const eggs = eggG / 50; // ~50g per large egg

      // Cookies per sheet pan: depends on size
      const perPan: Record<string, number> = { small: 24, medium: 16, large: 12, bakery: 9 };
      const pans = Math.ceil(count / perPan[size]);

      // Baking time based on size
      const times: Record<string, string> = { small: '8-10 min', medium: '10-12 min', large: '12-14 min', bakery: '14-16 min' };

      document.getElementById('cob-result')!.textContent = totalDough.toFixed(0) + ' g';
      document.getElementById('cob-flour')!.textContent = flourG.toFixed(0) + ' g (' + (flourG / 125).toFixed(1) + ' cups)';
      document.getElementById('cob-butter')!.textContent = butterG.toFixed(0) + ' g (' + (butterG / 113).toFixed(1) + ' sticks)';
      document.getElementById('cob-sugar')!.textContent = sugarG.toFixed(0) + ' g (' + (sugarG / 200).toFixed(1) + ' cups)';
      document.getElementById('cob-eggs')!.textContent = eggs < 0.3 ? 'None' : Math.round(eggs) + ' large (' + eggG.toFixed(0) + 'g)';
      document.getElementById('cob-mixin')!.textContent = mixinG.toFixed(0) + 'g ' + r.mixinName;
      document.getElementById('cob-pans')!.textContent = pans + ' pan' + (pans > 1 ? 's' : '');
      document.getElementById('cob-bake')!.textContent = r.temp + ', ' + times[size];

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.cob-in').forEach(el => { el.addEventListener('input', calcCOB); el.addEventListener('change', calcCOB); });
      calcCOB();
    }, 50);
  </script>
</CalculatorLayout>
