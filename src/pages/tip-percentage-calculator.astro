---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Tip Calculator - Advanced Tip Percentage & Bill Splitter 2026";
const description = "Calculate the perfect tip based on service quality, split the bill among friends, and see tip amounts for different percentages side by side.";

const relatedCalcs = [
  { name: "Budget Calculator", url: "/budget-calculator", description: "Monthly budget planner." },
  { name: "Road Trip Calculator", url: "/road-trip-calculator", description: "Road trip costs." },
  { name: "Salary Calculator", url: "/salary-calculator", description: "Salary breakdown." },
  { name: "Clothing Size Converter", url: "/clothing-size-converter", description: "Convert clothing sizes." },
  { name: "Screen Time Calculator", url: "/screen-time-calculator", description: "Track screen time." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Calculate percentages." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Tip Percentage Calculator"
  keywords="tip calculator, tip percentage, bill splitter, restaurant tip, gratuity calculator, service tip"
  breadcrumbs={[{ name: "Tip Percentage Calculator", url: "/tip-percentage-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Tip Percentage Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate your tip based on service quality and split the bill among your party.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label for="tp-bill" class="block text-sm font-medium text-text mb-1">Bill Amount ($)</label>
          <input type="number" id="tp-bill" class="tp-in w-full border border-border rounded-lg px-3 py-2" value="85.00" min="0" step="0.01" />
        </div>
        <div>
          <label for="tp-quality" class="block text-sm font-medium text-text mb-1">Service Quality</label>
          <input type="range" id="tp-quality" class="tp-in w-full" min="0" max="4" step="1" value="2" />
          <div class="flex justify-between text-xs text-text-muted mt-1">
            <span>Poor (10%)</span>
            <span>Fair (15%)</span>
            <span>Good (18%)</span>
            <span>Great (20%)</span>
            <span>Excellent (25%)</span>
          </div>
        </div>
        <div>
          <label for="tp-custom" class="block text-sm font-medium text-text mb-1">Or Custom Tip %</label>
          <input type="number" id="tp-custom" class="tp-in w-full border border-border rounded-lg px-3 py-2" placeholder="Leave empty to use slider" min="0" max="100" step="1" />
        </div>
        <div>
          <label for="tp-people" class="block text-sm font-medium text-text mb-1">Split Between (people)</label>
          <input type="number" id="tp-people" class="tp-in w-full border border-border rounded-lg px-3 py-2" value="2" min="1" max="50" step="1" />
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Tip Amount</div>
          <div class="text-5xl font-extrabold font-mono" id="tp-result">$0.00</div>
          <div class="text-sm text-blue-200 mt-1" id="tp-pct-label">18%</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total with Tip</div>
            <div class="text-xl font-bold" id="tp-total">$0.00</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Per Person</div>
            <div class="text-xl font-bold" id="tp-perperson">$0.00</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Tip Per Person</div>
            <div class="text-xl font-bold" id="tp-tipperperson">$0.00</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Bill Per Person</div>
            <div class="text-xl font-bold" id="tp-billperperson">$0.00</div>
          </div>
        </div>

        <!-- Quick comparison table -->
        <div class="mt-4">
          <h3 class="text-sm font-bold text-text mb-2">Quick Comparison</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="border-b border-border text-left">
                  <th class="py-1 pr-3 font-semibold">Tip %</th>
                  <th class="py-1 pr-3 font-semibold text-right">Tip</th>
                  <th class="py-1 pr-3 font-semibold text-right">Total</th>
                  <th class="py-1 font-semibold text-right">Per Person</th>
                </tr>
              </thead>
              <tbody id="tp-comparison"></tbody>
            </table>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="tip-percentage" />
      <FeedbackWidget />
    </div>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const qualityTips = [10, 15, 18, 20, 25];

    function calcTP() {
      const bill = parseFloat((document.getElementById('tp-bill') as HTMLInputElement).value) || 0;
      const qualityIdx = parseInt((document.getElementById('tp-quality') as HTMLInputElement).value) || 0;
      const customPct = (document.getElementById('tp-custom') as HTMLInputElement).value;
      const people = parseInt((document.getElementById('tp-people') as HTMLInputElement).value) || 1;

      const tipPct = customPct !== '' ? parseFloat(customPct) || 0 : qualityTips[qualityIdx];
      const tipAmount = bill * (tipPct / 100);
      const totalWithTip = bill + tipAmount;
      const perPerson = totalWithTip / people;
      const tipPerPerson = tipAmount / people;
      const billPerPerson = bill / people;

      const fmt = (n: number) => '$' + n.toFixed(2);

      (document.getElementById('tp-result') as HTMLElement).textContent = fmt(tipAmount);
      (document.getElementById('tp-pct-label') as HTMLElement).textContent = tipPct + '%';
      (document.getElementById('tp-total') as HTMLElement).textContent = fmt(totalWithTip);
      (document.getElementById('tp-perperson') as HTMLElement).textContent = fmt(perPerson);
      (document.getElementById('tp-tipperperson') as HTMLElement).textContent = fmt(tipPerPerson);
      (document.getElementById('tp-billperperson') as HTMLElement).textContent = fmt(billPerPerson);

      // Comparison table
      const pcts = [10, 15, 18, 20, 25];
      let html = '';
      for (const p of pcts) {
        const t = bill * (p / 100);
        const tot = bill + t;
        const pp = tot / people;
        const isCurrent = p === tipPct;
        html += `<tr class="border-b border-border/30 ${isCurrent ? 'bg-blue-50 font-semibold' : ''}">
          <td class="py-1 pr-3">${p}%</td>
          <td class="py-1 pr-3 text-right">${fmt(t)}</td>
          <td class="py-1 pr-3 text-right">${fmt(tot)}</td>
          <td class="py-1 text-right">${fmt(pp)}</td>
        </tr>`;
      }
      (document.getElementById('tp-comparison') as HTMLElement).innerHTML = html;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.tp-in').forEach(el => {
        el.addEventListener('input', calcTP);
        el.addEventListener('change', calcTP);
      });
      calcTP();
    }, 50);
  </script>
</CalculatorLayout>
