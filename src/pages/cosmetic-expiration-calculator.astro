---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Cosmetic Expiration Calculator - Shelf Life & PAO Tracker";
const description = "Track cosmetic product shelf life and period after opening (PAO). Know when to replace makeup, skincare, and beauty products.";
const relatedCalcs = [
  { name: "Skincare Routine Calculator", url: "/skincare-routine-calculator", description: "Product layering order." },
  { name: "Beauty Budget Calculator", url: "/beauty-budget-calculator", description: "Beauty spending breakdown." },
  { name: "Skin Type Calculator", url: "/skin-type-calculator", description: "Determine your skin type." },
  { name: "SPF Calculator", url: "/spf-calculator", description: "SPF protection time." },
  { name: "Nail Salon Pricing Calculator", url: "/nail-salon-pricing-calculator", description: "Nail service pricing." },
  { name: "Chemical Peel Calculator", url: "/chemical-peel-calculator", description: "Peel depth and recovery." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Cosmetic Expiration Calculator" keywords="cosmetic expiration, makeup shelf life, PAO, period after opening, product expiry, beauty product lifespan" breadcrumbs={[{ name: "Cosmetic Expiration", url: "/cosmetic-expiration-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Cosmetic Expiration Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Track when your beauty products expire based on their PAO (period after opening).</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Product Category</label>
          <select id="cex-product" class="cex-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="mascara">Mascara (3-6 months)</option>
            <option value="eyeliner_liquid">Liquid Eyeliner (3-6 months)</option>
            <option value="eyeliner_pencil">Pencil Eyeliner (12-24 months)</option>
            <option value="foundation_liquid" selected>Liquid Foundation (6-12 months)</option>
            <option value="foundation_powder">Powder Foundation (12-24 months)</option>
            <option value="concealer">Concealer (6-12 months)</option>
            <option value="lipstick">Lipstick (12-18 months)</option>
            <option value="lip_gloss">Lip Gloss (6-12 months)</option>
            <option value="blush_powder">Powder Blush (12-24 months)</option>
            <option value="blush_cream">Cream Blush (6-12 months)</option>
            <option value="eyeshadow_powder">Powder Eyeshadow (12-24 months)</option>
            <option value="eyeshadow_cream">Cream Eyeshadow (6-12 months)</option>
            <option value="moisturizer">Moisturizer (6-12 months)</option>
            <option value="serum">Serum (6-12 months)</option>
            <option value="sunscreen">Sunscreen (6-12 months)</option>
            <option value="cleanser">Cleanser (12 months)</option>
            <option value="nail_polish">Nail Polish (12-24 months)</option>
            <option value="perfume">Perfume (24-36 months)</option>
            <option value="setting_spray">Setting Spray (6-12 months)</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Date Opened</label>
          <input type="date" id="cex-opened" class="cex-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Storage Conditions</label>
          <select id="cex-storage" class="cex-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="1.0" selected>Cool, dry, away from sunlight (ideal)</option>
            <option value="0.85">Bathroom (humid, warm)</option>
            <option value="0.75">Hot environment / direct sunlight</option>
            <option value="1.1">Refrigerated (extends life)</option>
          </select>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Product Status</div>
          <div class="text-4xl font-extrabold font-mono" id="cex-status">--</div>
          <div class="text-sm text-blue-200 mt-1" id="cex-remaining">--</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">PAO (Period After Opening)</div><div class="text-xl font-bold" id="cex-pao">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Expiration Date</div><div class="text-xl font-bold" id="cex-expiry">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Days Since Opened</div><div class="text-xl font-bold" id="cex-days">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Usage Percentage</div><div class="text-xl font-bold" id="cex-usage">--</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Signs of Expiration</h3>
          <div class="text-sm space-y-1" id="cex-signs"></div>
        </div>
      </div>
      <ShareButton calculatorId="cosmetic-expiration" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Cosmetic Shelf Life Guide</h2>
      <p>All cosmetics have a limited shelf life after opening, indicated by the PAO (Period After Opening) symbol - a small jar icon with a number like "6M" or "12M". Eye products like mascara expire fastest (3-6 months) due to bacteria risk. Powder products last longest (up to 24 months). Store products in cool, dry places away from sunlight. Signs of expiration include changes in smell, color, texture, or separation. Using expired products can cause breakouts, infections, and skin irritation.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcCEX() {
      const product = (document.getElementById('cex-product') as HTMLSelectElement).value;
      const openedStr = (document.getElementById('cex-opened') as HTMLInputElement).value;
      const storageFactor = parseFloat((document.getElementById('cex-storage') as HTMLSelectElement).value);

      const paoMonths: Record<string, number> = {
        mascara: 4, eyeliner_liquid: 4, eyeliner_pencil: 18, foundation_liquid: 9,
        foundation_powder: 18, concealer: 9, lipstick: 15, lip_gloss: 9,
        blush_powder: 18, blush_cream: 9, eyeshadow_powder: 18, eyeshadow_cream: 9,
        moisturizer: 9, serum: 9, sunscreen: 9, cleanser: 12,
        nail_polish: 18, perfume: 30, setting_spray: 9
      };

      const basePAO = paoMonths[product] || 12;
      const adjustedPAO = Math.round(basePAO * storageFactor);

      const signs: Record<string, string[]> = {
        mascara: ['Dries out or clumps', 'Smells unusual', 'Causes eye irritation', 'Changes consistency'],
        eyeliner_liquid: ['Dries out', 'Skips or drags', 'Smells off', 'Causes eye irritation'],
        eyeliner_pencil: ['Becomes very hard', 'Color changes', 'Difficult to apply smoothly'],
        foundation_liquid: ['Separates or looks oily', 'Changes color or smell', 'Feels different on skin', 'Causes breakouts'],
        foundation_powder: ['Changes color', 'Develops a film', 'Becomes chalky or hard pan'],
        concealer: ['Separates', 'Thickens', 'Changes color', 'Causes breakouts'],
        lipstick: ['Changes smell (waxy/rancid)', 'Dries out', 'Changes texture', 'Tastes odd'],
        lip_gloss: ['Becomes sticky/thick', 'Smells off', 'Color changes'],
        blush_powder: ['Color fades', 'Hard pan forms', 'Changes texture'],
        blush_cream: ['Dries out', 'Separates', 'Smells off', 'Changes texture'],
        eyeshadow_powder: ['Color fades', 'Hard pan forms', 'Crumbles'],
        eyeshadow_cream: ['Dries out', 'Becomes patchy', 'Smells off'],
        moisturizer: ['Separates', 'Changes smell', 'Different texture', 'Causes irritation'],
        serum: ['Changes color', 'Oxidizes (turns dark)', 'Smells different', 'Less effective'],
        sunscreen: ['Separates', 'Changes consistency', 'Smells different', 'SPF effectiveness decreases'],
        cleanser: ['Changes smell', 'Separates', 'Different texture'],
        nail_polish: ['Thickens', 'Separates', 'Becomes stringy', 'Hard to apply evenly'],
        perfume: ['Scent changes', 'Color darkens', 'Becomes weaker'],
        setting_spray: ['Clogs nozzle', 'Changes smell', 'Separates']
      };

      let status = 'Enter opening date';
      let remaining = '';
      let daysSinceOpened = 0;
      let usagePct = 0;
      let expiryStr = '--';

      if (openedStr) {
        const opened = new Date(openedStr);
        const now = new Date();
        const expiry = new Date(opened);
        expiry.setMonth(expiry.getMonth() + adjustedPAO);

        daysSinceOpened = Math.floor((now.getTime() - opened.getTime()) / (1000 * 60 * 60 * 24));
        const totalDays = Math.floor((expiry.getTime() - opened.getTime()) / (1000 * 60 * 60 * 24));
        const daysLeft = Math.floor((expiry.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));
        usagePct = Math.min(100, Math.max(0, (daysSinceOpened / totalDays) * 100));

        expiryStr = expiry.toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'});

        if (daysLeft > 90) {
          status = 'Good to Use';
          remaining = daysLeft + ' days remaining';
        } else if (daysLeft > 30) {
          status = 'Use Soon';
          remaining = daysLeft + ' days remaining - replace soon';
        } else if (daysLeft > 0) {
          status = 'Expiring Soon';
          remaining = 'Only ' + daysLeft + ' days left!';
        } else {
          status = 'EXPIRED';
          remaining = 'Expired ' + Math.abs(daysLeft) + ' days ago - discard';
        }
      }

      const productSigns = signs[product] || ['Check for changes in smell, color, or texture.'];

      document.getElementById('cex-status')!.textContent = status;
      document.getElementById('cex-remaining')!.textContent = remaining;
      document.getElementById('cex-pao')!.textContent = adjustedPAO + ' months';
      document.getElementById('cex-expiry')!.textContent = expiryStr;
      document.getElementById('cex-days')!.textContent = openedStr ? daysSinceOpened.toString() : '--';
      document.getElementById('cex-usage')!.textContent = openedStr ? usagePct.toFixed(0) + '%' : '--';
      document.getElementById('cex-signs')!.innerHTML = productSigns.map(s => '<p>- ' + s + '</p>').join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      const today = new Date();
      today.setMonth(today.getMonth() - 3);
      (document.getElementById('cex-opened') as HTMLInputElement).value = today.toISOString().split('T')[0];
      document.querySelectorAll('.cex-in').forEach(el => { el.addEventListener('input', calcCEX); el.addEventListener('change', calcCEX); });
      calcCEX();
    }, 50);
  </script>
</CalculatorLayout>
