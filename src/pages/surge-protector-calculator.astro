---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Surge Protector Calculator - Joule Rating & UPS Sizing";
const description = "Calculate the joule rating needed for your equipment, determine clamping voltage, protection level, and UPS battery backup sizing.";
const relatedCalcs = [
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Energy costs." },
  { name: "Battery Life", url: "/battery-life-calculator", description: "Battery runtime." },
  { name: "Electrical Load", url: "/electrical-load-calculator", description: "Panel loads." },
  { name: "Ohm's Law", url: "/ohms-law-calculator", description: "Voltage, current, resistance." },
  { name: "Electricity Usage", url: "/electricity-usage-calculator", description: "Usage tracking." },
  { name: "Wire Gauge", url: "/wire-gauge-calculator", description: "Wire sizing." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Surge Protector Calculator" keywords="surge protector calculator, joule rating, clamping voltage, UPS sizing, power strip protection, VA rating" breadcrumbs={[{ name: "Surge Protector", url: "/surge-protector-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Surge Protector Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Determine the right surge protector joule rating and UPS backup size for your equipment.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Equipment to Protect</h3>
          <div class="grid grid-cols-2 gap-2">
            <div><label class="block text-xs text-text-muted">Desktop Computer (W)</label><input type="number" id="sp2-pc" class="sp2-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="400" min="0"></div>
            <div><label class="block text-xs text-text-muted">Monitor(s) (W)</label><input type="number" id="sp2-mon" class="sp2-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="80" min="0"></div>
            <div><label class="block text-xs text-text-muted">Router/Modem (W)</label><input type="number" id="sp2-net" class="sp2-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="30" min="0"></div>
            <div><label class="block text-xs text-text-muted">TV/Entertainment (W)</label><input type="number" id="sp2-tv" class="sp2-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="150" min="0"></div>
            <div><label class="block text-xs text-text-muted">Gaming Console (W)</label><input type="number" id="sp2-game" class="sp2-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="0" min="0"></div>
            <div><label class="block text-xs text-text-muted">Other Equipment (W)</label><input type="number" id="sp2-other" class="sp2-in w-full px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="50" min="0"></div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Equipment Value ($)</label>
            <input type="number" id="sp2-value" class="sp2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3000" min="0" step="100">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Need Battery Backup?</label>
            <select id="sp2-ups" class="sp2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="no">No (surge only)</option>
              <option value="yes" selected>Yes (UPS with surge)</option>
            </select>
          </div>
        </div>
        <div id="sp2-backup-row">
          <label class="block text-xs font-medium text-text mb-1">Desired Backup Time (minutes)</label>
          <input type="number" id="sp2-time" class="sp2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="1" max="60" step="1">
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Joule Rating</div>
          <div class="text-5xl font-extrabold font-mono" id="sp2-result">0 J</div>
          <div class="text-sm text-blue-200 mt-1" id="sp2-note">-</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Load</div>
            <div class="text-xl font-bold font-mono" id="sp2-load">0 W</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Clamping Voltage</div>
            <div class="text-xl font-bold font-mono" id="sp2-clamp">-</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">UPS VA Rating</div>
            <div class="text-xl font-bold font-mono" id="sp2-va">- VA</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Protection Level</h3>
          <div class="text-sm" id="sp2-level">-</div>
        </div>
      </div>
      <ShareButton calculatorId="surge-protector" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcSP2() {
      const pc = parseFloat((document.getElementById('sp2-pc') as HTMLInputElement).value) || 0;
      const mon = parseFloat((document.getElementById('sp2-mon') as HTMLInputElement).value) || 0;
      const net = parseFloat((document.getElementById('sp2-net') as HTMLInputElement).value) || 0;
      const tv = parseFloat((document.getElementById('sp2-tv') as HTMLInputElement).value) || 0;
      const game = parseFloat((document.getElementById('sp2-game') as HTMLInputElement).value) || 0;
      const other = parseFloat((document.getElementById('sp2-other') as HTMLInputElement).value) || 0;
      const eqValue = parseFloat((document.getElementById('sp2-value') as HTMLInputElement).value) || 0;
      const needUps = (document.getElementById('sp2-ups') as HTMLSelectElement).value;
      const backupMin = parseFloat((document.getElementById('sp2-time') as HTMLInputElement).value) || 10;

      const totalLoad = pc + mon + net + tv + game + other;

      // Show/hide backup row
      document.getElementById('sp2-backup-row')!.className = needUps === 'yes' ? '' : 'hidden';

      // Joule rating: higher value equipment = higher joules needed
      let joules: number;
      if (eqValue > 5000) joules = 3000;
      else if (eqValue > 2000) joules = 2000;
      else if (eqValue > 1000) joules = 1400;
      else joules = 800;

      // Add joules for higher wattage loads
      if (totalLoad > 500) joules += 500;
      if (totalLoad > 1000) joules += 500;

      // Clamping voltage recommendation
      let clampVoltage: string;
      if (eqValue > 3000) clampVoltage = '330V (best)';
      else if (eqValue > 1000) clampVoltage = '400V (good)';
      else clampVoltage = '500V (basic)';

      // UPS VA sizing: W / power factor (0.6 typical) * runtime factor
      const vaRating = needUps === 'yes' ? Math.ceil(totalLoad / 0.6 / 50) * 50 : 0;
      // Actual VA sizes available
      const vaSizes = [350, 425, 550, 750, 900, 1000, 1350, 1500, 2200, 3000];
      const recVA = vaSizes.find(v => v >= vaRating) || 3000;

      // Protection level
      let level: string;
      if (joules >= 2500 && clampVoltage.includes('330')) {
        level = 'Premium protection for sensitive electronics. UL 1449 Type 3 rated. Protects against most surge events including nearby lightning strikes.';
      } else if (joules >= 1400) {
        level = 'Good protection for computers and electronics. Handles typical power surges from appliance switching and utility grid events.';
      } else {
        level = 'Basic protection suitable for lamps, fans, and non-sensitive devices. Consider upgrading for computers or expensive electronics.';
      }

      document.getElementById('sp2-result')!.textContent = joules.toLocaleString() + ' J';
      document.getElementById('sp2-note')!.textContent = 'For $' + eqValue.toLocaleString() + ' in equipment at ' + totalLoad + 'W';
      document.getElementById('sp2-load')!.textContent = totalLoad + ' W';
      document.getElementById('sp2-clamp')!.textContent = clampVoltage;
      document.getElementById('sp2-va')!.textContent = needUps === 'yes' ? recVA + ' VA' : 'N/A';
      document.getElementById('sp2-level')!.textContent = level;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.sp2-in').forEach(el => {
        el.addEventListener('input', calcSP2);
        el.addEventListener('change', calcSP2);
      });
      calcSP2();
    }, 50);
  </script>
</CalculatorLayout>
