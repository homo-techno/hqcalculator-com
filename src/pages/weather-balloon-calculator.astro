---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Weather Balloon Calculator - Burst Altitude & Ascent Rate";
const description = "Calculate weather balloon burst altitude from balloon size, gas type, and payload weight. Estimate ascent rate and drift distance.";
const relatedCalcs = [
  { name: "Atmospheric Layer", url: "/atmospheric-layer-calculator", description: "Atmospheric layers." },
  { name: "Barometric Pressure", url: "/barometric-pressure-calculator", description: "Pressure readings." },
  { name: "Wind Speed Converter", url: "/wind-speed-converter", description: "Wind speed units." },
  { name: "Cloud Base", url: "/cloud-base-calculator", description: "Cloud base height." },
  { name: "Temperature Converter", url: "/temperature-converter", description: "Temperature units." },
  { name: "Solar Radiation", url: "/solar-radiation-calculator", description: "Solar irradiance." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Weather Balloon Calculator" keywords="weather balloon, burst altitude, ascent rate, radiosonde, high altitude balloon, HAB calculator" breadcrumbs={[{ name: "Weather Balloon", url: "/weather-balloon-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Weather Balloon Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate burst altitude, ascent rate, and drift distance for high-altitude balloon flights.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Balloon Size</label>
            <select id="wb2-size" class="wb2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="300">300g (small)</option>
              <option value="600">600g (medium)</option>
              <option value="1000">1000g (standard)</option>
              <option value="1200" selected>1200g (large)</option>
              <option value="1500">1500g (extra large)</option>
              <option value="2000">2000g (scientific)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Lift Gas</label>
            <select id="wb2-gas" class="wb2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="0.164">Helium (0.164 kg/m3)</option>
              <option value="0.082">Hydrogen (0.082 kg/m3)</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Payload Weight (grams)</label><input type="number" id="wb2-payload" class="wb2-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="500" min="0" step="50"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Avg Wind Speed (mph)</label><input type="number" id="wb2-wind" class="wb2-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="30" min="0" step="5"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Neck Lift (grams, free lift above neutral)</label><input type="number" id="wb2-lift" class="wb2-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="200" min="50" step="25"></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Burst Altitude</div>
          <div class="text-5xl font-extrabold font-mono" id="wb2-result">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Ascent Rate</div><div class="text-xl font-bold font-mono" id="wb2-ascent">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Flight Time</div><div class="text-xl font-bold font-mono" id="wb2-time">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Drift Distance</div><div class="text-xl font-bold font-mono" id="wb2-drift">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Burst Diameter</div><div class="text-xl font-bold font-mono" id="wb2-diam">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Launch Volume</div><div class="text-xl font-bold font-mono" id="wb2-vol">--</div></div>
        </div>
        <div class="p-4 rounded-xl text-center" id="wb2-status-box">
          <div class="font-bold text-sm" id="wb2-status">--</div>
        </div>
      </div>
      <ShareButton calculatorId="weather-balloon" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcWB2() {
      const balloonG = parseFloat((document.getElementById('wb2-size') as HTMLSelectElement).value) || 1200;
      const gasDensity = parseFloat((document.getElementById('wb2-gas') as HTMLSelectElement).value) || 0.164;
      const payloadG = parseFloat((document.getElementById('wb2-payload') as HTMLInputElement).value) || 500;
      const windMph = parseFloat((document.getElementById('wb2-wind') as HTMLInputElement).value) || 30;
      const neckLiftG = parseFloat((document.getElementById('wb2-lift') as HTMLInputElement).value) || 200;
      const airDensity = 1.225; // kg/m3 at sea level
      // Burst diameters by balloon mass (approximate, meters)
      const burstDiamMap: Record<number, number> = { 300: 3.8, 600: 5.8, 1000: 7.2, 1200: 7.9, 1500: 8.6, 2000: 9.4 };
      const burstDiam = burstDiamMap[balloonG] || (4.0 + balloonG / 200);
      const burstVolume = (4/3) * Math.PI * Math.pow(burstDiam / 2, 3);
      // Gross lift needed = payload + balloon + neck lift
      const totalMassKg = (payloadG + balloonG) / 1000;
      const freeLiftKg = neckLiftG / 1000;
      const totalLiftKg = totalMassKg + freeLiftKg;
      // Gas volume at launch: lift = (air_density - gas_density) * volume * g
      const liftPerM3 = (airDensity - gasDensity); // kg per m3
      const launchVolM3 = totalLiftKg / liftPerM3;
      const launchDiam = 2 * Math.pow((3 * launchVolM3) / (4 * Math.PI), 1/3);
      // Ascent rate (simplified): based on free lift and drag
      const cd = 0.3; // drag coefficient
      const area = Math.PI * Math.pow(launchDiam / 2, 2);
      const ascentMs = Math.sqrt((2 * freeLiftKg * 9.81) / (airDensity * cd * area));
      const ascentFpm = ascentMs * 196.85;
      // Burst altitude: pressure ratio from launch to burst volume
      const volumeRatio = burstVolume / launchVolM3;
      // Using isothermal approximation: P_burst = P_surface / volumeRatio
      // Then altitude from barometric formula: h = -RT/Mg * ln(P/P0) ~ 7400 * ln(volumeRatio)
      const burstAltM = 7400 * Math.log(volumeRatio);
      const burstAltFt = burstAltM * 3.28084;
      // Flight time
      const flightTimeSec = burstAltM / ascentMs;
      const flightTimeMin = flightTimeSec / 60;
      // Drift distance
      const windMs = windMph * 0.44704;
      const driftM = windMs * flightTimeSec;
      const driftMi = driftM / 1609.34;
      document.getElementById('wb2-result')!.textContent = Math.round(burstAltFt).toLocaleString() + ' ft';
      document.getElementById('wb2-ascent')!.textContent = ascentMs.toFixed(1) + ' m/s';
      document.getElementById('wb2-time')!.textContent = flightTimeMin.toFixed(0) + ' min';
      document.getElementById('wb2-drift')!.textContent = driftMi.toFixed(1) + ' mi';
      document.getElementById('wb2-diam')!.textContent = burstDiam.toFixed(1) + ' m';
      document.getElementById('wb2-vol')!.textContent = launchVolM3.toFixed(2) + ' m\u00B3';
      let status: string, color: string;
      if (burstAltFt > 100000) { status = 'Excellent altitude - near space!'; color = 'bg-green-50 text-green-800'; }
      else if (burstAltFt > 70000) { status = 'Good altitude for high-altitude photography'; color = 'bg-blue-50 text-blue-800'; }
      else if (burstAltFt > 40000) { status = 'Moderate altitude - consider more gas or larger balloon'; color = 'bg-yellow-50 text-yellow-800'; }
      else { status = 'Low altitude - reduce payload or increase balloon size'; color = 'bg-orange-50 text-orange-800'; }
      document.getElementById('wb2-status')!.textContent = status;
      document.getElementById('wb2-status-box')!.className = 'p-4 rounded-xl text-center ' + color;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => { document.querySelectorAll('.wb2-in').forEach(el => { el.addEventListener('input', calcWB2); el.addEventListener('change', calcWB2); }); calcWB2(); }, 50);
  </script>
</CalculatorLayout>
