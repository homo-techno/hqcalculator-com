---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Typesetting Calculator - Characters & Words Per Page";
const description = "Calculate characters per line, lines per page, and words per page based on font, size, margins, leading, and page dimensions.";
const relatedCalcs = [
  { name: "Font Size Calculator", url: "/font-size-calculator", description: "Convert font size units." },
  { name: "Typography Scale Calculator", url: "/typography-scale-calculator", description: "Modular type scale generator." },
  { name: "Magazine Layout Calculator", url: "/magazine-layout-calculator", description: "Magazine page planning." },
  { name: "Spine Width Calculator", url: "/spine-width-calculator", description: "Book spine width." },
  { name: "Book Binding Calculator", url: "/book-binding-calculator", description: "Binding method costs." },
  { name: "Print Cost Calculator", url: "/print-cost-calculator", description: "Print job cost estimator." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Typesetting Calculator" keywords="typesetting, characters per page, words per page, leading, line spacing, font size, margins, text layout" breadcrumbs={[{ name: "Typesetting Calculator", url: "/typesetting-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Typesetting Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate how many characters, words, and lines fit on a page based on font size, leading, margins, and page dimensions.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Page Width (inches)</label><input type="number" id="ts2-width" class="ts2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="0.25"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Page Height (inches)</label><input type="number" id="ts2-height" class="ts2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="0.25"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Left/Right Margins (in each)</label><input type="number" id="ts2-hmargin" class="ts2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="0" step="0.125"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Top/Bottom Margins (in each)</label><input type="number" id="ts2-vmargin" class="ts2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="0" step="0.125"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Font Size (pt)</label><input type="number" id="ts2-fontsize" class="ts2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="4" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Leading / Line Spacing (pt)</label><input type="number" id="ts2-leading" class="ts2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="4" step="0.5"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Avg Char Width Factor</label><input type="number" id="ts2-charwidth" class="ts2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="0.1" step="0.05" title="Typical: 0.5-0.6 for proportional fonts"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Total Pages in Book</label><input type="number" id="ts2-totalpages" class="ts2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="1"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Words Per Page</div>
          <div class="text-5xl font-extrabold font-mono" id="ts2-result">0</div>
          <div class="text-sm text-blue-200 mt-1" id="ts2-totalwords"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Characters/Line</div><div class="text-xl font-bold" id="ts2-cpl">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Lines/Page</div><div class="text-xl font-bold" id="ts2-lpp">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Characters/Page</div><div class="text-xl font-bold" id="ts2-cpp">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Text Area (sq in)</div><div class="text-xl font-bold" id="ts2-area">--</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Calculations</h3>
          <div class="font-mono text-sm space-y-1" id="ts2-steps"></div>
        </div>
      </div>
      <ShareButton calculatorId="typesetting" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Typesetting Formulas</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p>Text Width = Page Width - (Left Margin + Right Margin)</p>
        <p>Text Height = Page Height - (Top Margin + Bottom Margin)</p>
        <p>Characters/Line = Text Width (in) x 72 / (Font Size x Char Width Factor)</p>
        <p>Lines/Page = Text Height (in) x 72 / Leading</p>
        <p>Words/Page = Characters/Page / 5 (average word length)</p>
      </div>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcTs2() {
      const pageW = parseFloat((document.getElementById('ts2-width') as HTMLInputElement).value) || 0;
      const pageH = parseFloat((document.getElementById('ts2-height') as HTMLInputElement).value) || 0;
      const hMargin = parseFloat((document.getElementById('ts2-hmargin') as HTMLInputElement).value) || 0;
      const vMargin = parseFloat((document.getElementById('ts2-vmargin') as HTMLInputElement).value) || 0;
      const fontSize = parseFloat((document.getElementById('ts2-fontsize') as HTMLInputElement).value) || 0;
      const leading = parseFloat((document.getElementById('ts2-leading') as HTMLInputElement).value) || 0;
      const charWidthFactor = parseFloat((document.getElementById('ts2-charwidth') as HTMLInputElement).value) || 0.55;
      const totalPages = parseFloat((document.getElementById('ts2-totalpages') as HTMLInputElement).value) || 1;
      const textW = pageW - 2 * hMargin;
      const textH = pageH - 2 * vMargin;
      const textWpt = textW * 72;
      const textHpt = textH * 72;
      const charWidthPt = fontSize * charWidthFactor;
      const cpl = charWidthPt > 0 ? Math.floor(textWpt / charWidthPt) : 0;
      const lpp = leading > 0 ? Math.floor(textHpt / leading) : 0;
      const cpp = cpl * lpp;
      const wpp = Math.floor(cpp / 5);
      const totalWords = wpp * totalPages;
      const area = textW * textH;
      const steps: string[] = [];
      steps.push('Text width: ' + pageW + ' - 2x' + hMargin + ' = ' + textW.toFixed(2) + ' in (' + textWpt.toFixed(0) + ' pt)');
      steps.push('Text height: ' + pageH + ' - 2x' + vMargin + ' = ' + textH.toFixed(2) + ' in (' + textHpt.toFixed(0) + ' pt)');
      steps.push('Char width: ' + fontSize + 'pt x ' + charWidthFactor + ' = ' + charWidthPt.toFixed(2) + ' pt');
      steps.push('Chars/line: ' + textWpt.toFixed(0) + ' / ' + charWidthPt.toFixed(2) + ' = ' + cpl);
      steps.push('Lines/page: ' + textHpt.toFixed(0) + ' / ' + leading + ' = ' + lpp);
      steps.push('Chars/page: ' + cpl + ' x ' + lpp + ' = ' + cpp);
      steps.push('Words/page: ' + cpp + ' / 5 = ~' + wpp);
      steps.push('Total words (' + totalPages + ' pages): ~' + totalWords.toLocaleString());
      document.getElementById('ts2-result')!.textContent = wpp.toLocaleString();
      document.getElementById('ts2-totalwords')!.textContent = 'Total: ~' + totalWords.toLocaleString() + ' words in ' + totalPages + ' pages';
      document.getElementById('ts2-cpl')!.textContent = cpl.toString();
      document.getElementById('ts2-lpp')!.textContent = lpp.toString();
      document.getElementById('ts2-cpp')!.textContent = cpp.toLocaleString();
      document.getElementById('ts2-area')!.textContent = area.toFixed(2);
      document.getElementById('ts2-steps')!.innerHTML = steps.map(s => '<div>' + s + '</div>').join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      (document.getElementById('ts2-width') as HTMLInputElement).value = '6';
      (document.getElementById('ts2-height') as HTMLInputElement).value = '9';
      (document.getElementById('ts2-hmargin') as HTMLInputElement).value = '0.75';
      (document.getElementById('ts2-vmargin') as HTMLInputElement).value = '0.875';
      (document.getElementById('ts2-fontsize') as HTMLInputElement).value = '11';
      (document.getElementById('ts2-leading') as HTMLInputElement).value = '14';
      (document.getElementById('ts2-charwidth') as HTMLInputElement).value = '0.55';
      (document.getElementById('ts2-totalpages') as HTMLInputElement).value = '250';
      document.querySelectorAll('.ts2-in').forEach(el => { el.addEventListener('input', calcTs2); el.addEventListener('change', calcTs2); });
      calcTs2();
    }, 50);
  </script>
</CalculatorLayout>
