---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Roulette Calculator - Odds, Payouts & House Edge";
const description = "Calculate roulette bet probabilities, payouts, and house edge. Compare American vs European roulette and analyze expected loss per hour.";
const relatedCalcs = [
  { name: "Probability Calculator", url: "/probability-calculator", description: "Event probability." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage math." },
  { name: "Statistics Calculator", url: "/statistics-calculator", description: "Statistical tools." },
  { name: "Average Calculator", url: "/average-calculator", description: "Calculate averages." },
  { name: "Random Number", url: "/random-number-generator", description: "Random numbers." },
  { name: "Fraction Calculator", url: "/fraction-calculator", description: "Fraction math." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Roulette Calculator" keywords="roulette calculator, roulette odds, house edge, roulette strategy, expected loss, roulette payout" breadcrumbs={[{ name: "Roulette", url: "/roulette-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Roulette Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Analyze roulette bet types, probabilities, payouts, and expected loss over time.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Roulette Type</label>
          <select class="ro-in w-full px-4 py-2 border border-border rounded-xl" id="ro-type">
            <option value="american">American (0 and 00) - 38 slots</option>
            <option value="european">European (single 0) - 37 slots</option>
            <option value="french">French (La Partage) - 37 slots</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-1">Bet Type</label>
          <select class="ro-in w-full px-4 py-2 border border-border rounded-xl" id="ro-bet">
            <option value="straight">Straight Up (single number)</option>
            <option value="split">Split (2 numbers)</option>
            <option value="street">Street (3 numbers)</option>
            <option value="corner">Corner (4 numbers)</option>
            <option value="line">Line (6 numbers)</option>
            <option value="dozen">Dozen (12 numbers)</option>
            <option value="column">Column (12 numbers)</option>
            <option value="even">Red/Black/Even/Odd (18 numbers)</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-text mb-1">Bet Amount ($)</label>
            <input type="number" class="ro-in w-full px-4 py-3 border border-border rounded-xl text-xl font-bold text-center" id="ro-amount" min="1" value="10">
          </div>
          <div>
            <label class="block text-sm font-semibold text-text mb-1">Spins per Hour</label>
            <input type="number" class="ro-in w-full px-4 py-3 border border-border rounded-xl text-xl font-bold text-center" id="ro-spins" min="1" max="200" value="40">
          </div>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Win Probability</div>
          <div class="text-5xl font-extrabold font-mono" id="ro-prob">--</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Payout (to 1)</div>
            <div class="text-xl font-bold font-mono" id="ro-payout">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">House Edge</div>
            <div class="text-xl font-bold font-mono" id="ro-edge">--</div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Expected Loss / Spin</div>
            <div class="text-xl font-bold font-mono" id="ro-lossspin">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Expected Loss / Hour</div>
            <div class="text-xl font-bold font-mono" id="ro-losshour">--</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">All Bet Types Comparison</h3>
          <div class="text-xs font-mono space-y-1" id="ro-table"></div>
        </div>
      </div>
      <ShareButton calculatorId="roulette" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Roulette Odds Explained</h2>
      <p>American roulette has 38 slots (1-36, 0, 00) with a 5.26% house edge. European roulette has 37 slots (1-36, 0) with a 2.70% house edge. French roulette with La Partage returns half of even-money bets when 0 hits, reducing the edge to 1.35%.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcRO() {
      const type = (document.getElementById('ro-type') as HTMLSelectElement).value;
      const bet = (document.getElementById('ro-bet') as HTMLSelectElement).value;
      const amount = parseFloat((document.getElementById('ro-amount') as HTMLInputElement).value) || 10;
      const spins = parseInt((document.getElementById('ro-spins') as HTMLInputElement).value) || 40;

      const slots = type === 'american' ? 38 : 37;

      const betCoverage: Record<string, number> = {
        'straight': 1, 'split': 2, 'street': 3, 'corner': 4,
        'line': 6, 'dozen': 12, 'column': 12, 'even': 18
      };
      const payouts: Record<string, number> = {
        'straight': 35, 'split': 17, 'street': 11, 'corner': 8,
        'line': 5, 'dozen': 2, 'column': 2, 'even': 1
      };

      const coverage = betCoverage[bet] || 1;
      const payout = payouts[bet] || 35;
      let winProb = coverage / slots;
      let houseEdge: number;

      if (type === 'french' && bet === 'even') {
        // La Partage: half back on 0
        houseEdge = 1 / (2 * slots);
        winProb = 18 / slots;
      } else {
        houseEdge = (slots - coverage * (payout + 1)) / slots;
      }

      const lossPerSpin = amount * Math.abs(houseEdge);
      const lossPerHour = lossPerSpin * spins;

      document.getElementById('ro-prob')!.textContent = (winProb * 100).toFixed(2) + '%';
      document.getElementById('ro-payout')!.textContent = payout + ':1';
      document.getElementById('ro-edge')!.textContent = (Math.abs(houseEdge) * 100).toFixed(2) + '%';
      document.getElementById('ro-lossspin')!.textContent = '-$' + lossPerSpin.toFixed(2);
      document.getElementById('ro-losshour')!.textContent = '-$' + lossPerHour.toFixed(2);

      // All bets comparison
      const allBets = ['straight', 'split', 'street', 'corner', 'line', 'dozen', 'column', 'even'];
      const names: Record<string, string> = {
        'straight': 'Straight Up', 'split': 'Split', 'street': 'Street', 'corner': 'Corner',
        'line': 'Line', 'dozen': 'Dozen', 'column': 'Column', 'even': 'Even Money'
      };
      let html = '';
      for (const b of allBets) {
        const cov = betCoverage[b];
        const pay = payouts[b];
        const wp = cov / slots;
        let he = (slots - cov * (pay + 1)) / slots;
        if (type === 'french' && b === 'even') he = 1 / (2 * slots);
        const marker = b === bet ? ' font-bold text-primary' : '';
        html += '<div class="flex justify-between py-0.5 border-b border-border' + marker + '"><span>' + names[b] + ' (' + cov + ' nums)</span><span>' + (wp * 100).toFixed(1) + '% | ' + pay + ':1 | Edge ' + (Math.abs(he) * 100).toFixed(2) + '%</span></div>';
      }
      document.getElementById('ro-table')!.innerHTML = html;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.ro-in').forEach(el => { el.addEventListener('input', calcRO); el.addEventListener('change', calcRO); });
      calcRO();
    }, 50);
  </script>
</CalculatorLayout>
