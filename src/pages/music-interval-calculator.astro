---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Music Interval Calculator - Frequency Ratio, Cents & Semitones";
const description = "Calculate the frequency ratio between two notes, interval in cents and semitones, interval name, and consonance rating.";
const relatedCalcs = [
  { name: "Frequency Calculator", url: "/frequency-calculator", description: "Convert frequency units." },
  { name: "Ratio Calculator", url: "/ratio-calculator", description: "Solve ratios." },
  { name: "Percentage Change", url: "/percentage-change-calculator", description: "Percentage change." },
  { name: "Sound Speed Calculator", url: "/sound-speed-calculator", description: "Speed of sound." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Scientific math." },
  { name: "Resonance Calculator", url: "/resonance-calculator", description: "Resonant frequency." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Music Interval Calculator" keywords="music interval, frequency ratio, cents, semitones, consonance, interval name, music theory" breadcrumbs={[{ name: "Music Interval", url: "/music-interval-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Music Interval Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find the frequency ratio, cents, semitones, and interval name between two notes.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Note 1 (Lower)</label>
            <select id="mi-n1" class="mi-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="C">C</option><option value="C#">C#/Db</option><option value="D">D</option><option value="D#">D#/Eb</option>
              <option value="E">E</option><option value="F">F</option><option value="F#">F#/Gb</option><option value="G">G</option>
              <option value="G#">G#/Ab</option><option value="A" selected>A</option><option value="A#">A#/Bb</option><option value="B">B</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Octave 1</label>
            <select id="mi-o1" class="mi-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="2">2</option><option value="3">3</option><option value="4" selected>4</option><option value="5">5</option><option value="6">6</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Note 2 (Upper)</label>
            <select id="mi-n2" class="mi-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="C">C</option><option value="C#">C#/Db</option><option value="D">D</option><option value="D#">D#/Eb</option>
              <option value="E" selected>E</option><option value="F">F</option><option value="F#">F#/Gb</option><option value="G">G</option>
              <option value="G#">G#/Ab</option><option value="A">A</option><option value="A#">A#/Bb</option><option value="B">B</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Octave 2</label>
            <select id="mi-o2" class="mi-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5" selected>5</option><option value="6">6</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">A4 Reference (Hz)</label>
          <input type="number" id="mi-ref" class="mi-in w-full px-4 py-3 border border-border rounded-xl text-lg" min="400" max="480" step="0.1">
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Interval</div>
          <div class="text-4xl font-extrabold font-mono" id="mi-name">--</div>
          <div class="text-sm text-blue-200 mt-1" id="mi-cons">--</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Frequency 1</div><div class="text-xl font-bold font-mono" id="mi-f1">0 Hz</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Frequency 2</div><div class="text-xl font-bold font-mono" id="mi-f2">0 Hz</div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Semitones</div><div class="text-xl font-bold font-mono" id="mi-semi">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Cents</div><div class="text-xl font-bold font-mono" id="mi-cents">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Freq Ratio</div><div class="text-xl font-bold font-mono" id="mi-ratio">1:1</div></div>
        </div>
      </div>
      <ShareButton calculatorId="music-interval" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    const noteMap: Record<string, number> = { 'C': 0, 'C#': 1, 'D': 2, 'D#': 3, 'E': 4, 'F': 5, 'F#': 6, 'G': 7, 'G#': 8, 'A': 9, 'A#': 10, 'B': 11 };
    const intervalNames = ['Unison','Minor 2nd','Major 2nd','Minor 3rd','Major 3rd','Perfect 4th','Tritone','Perfect 5th','Minor 6th','Major 6th','Minor 7th','Major 7th','Octave'];
    const consonance = ['Perfect consonance','Strong dissonance','Mild dissonance','Mild consonance','Mild consonance','Consonance','Strong dissonance','Perfect consonance','Mild consonance','Mild consonance','Mild dissonance','Strong dissonance','Perfect consonance'];

    function noteToMidi(note: string, octave: number): number {
      return (octave + 1) * 12 + noteMap[note];
    }

    function midiToFreq(midi: number, a4: number): number {
      return a4 * Math.pow(2, (midi - 69) / 12);
    }

    function calcMI() {
      const n1 = (document.getElementById('mi-n1') as HTMLSelectElement).value;
      const o1 = parseInt((document.getElementById('mi-o1') as HTMLSelectElement).value);
      const n2 = (document.getElementById('mi-n2') as HTMLSelectElement).value;
      const o2 = parseInt((document.getElementById('mi-o2') as HTMLSelectElement).value);
      const a4 = parseFloat((document.getElementById('mi-ref') as HTMLInputElement).value) || 440;

      const midi1 = noteToMidi(n1, o1);
      const midi2 = noteToMidi(n2, o2);
      const f1 = midiToFreq(midi1, a4);
      const f2 = midiToFreq(midi2, a4);

      const semiDiff = midi2 - midi1;
      const cents = semiDiff * 100;
      const ratio = f2 / f1;
      const absSemi = Math.abs(semiDiff) % 12;

      document.getElementById('mi-f1')!.textContent = f1.toFixed(2) + ' Hz';
      document.getElementById('mi-f2')!.textContent = f2.toFixed(2) + ' Hz';
      document.getElementById('mi-semi')!.textContent = semiDiff.toString();
      document.getElementById('mi-cents')!.textContent = cents.toString();
      document.getElementById('mi-ratio')!.textContent = ratio.toFixed(4) + ':1';

      const octaves = Math.floor(Math.abs(semiDiff) / 12);
      let name = intervalNames[absSemi] || '--';
      if (octaves > 1) name += ' + ' + octaves + ' octaves';
      else if (octaves === 1 && absSemi > 0) name += ' + 1 octave';
      else if (octaves === 1 && absSemi === 0) name = 'Octave';

      document.getElementById('mi-name')!.textContent = name;
      document.getElementById('mi-cons')!.textContent = consonance[absSemi] || '--';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      (document.getElementById('mi-ref') as HTMLInputElement).value = '440';
      document.querySelectorAll('.mi-in').forEach(el => { el.addEventListener('input', calcMI); el.addEventListener('change', calcMI); });
      calcMI();
    }, 50);
  </script>
</CalculatorLayout>
