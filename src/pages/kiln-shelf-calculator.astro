---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Kiln Shelf Calculator - Arrangement & Capacity Planner";
const description = "Plan kiln shelf arrangement and calculate capacity for different piece sizes. Optimize kiln loading for maximum efficiency.";
const relatedCalcs = [
  { name: "Kiln Temperature Calculator", url: "/kiln-temperature-calculator", description: "Firing schedules." },
  { name: "Kiln Energy Calculator", url: "/kiln-energy-calculator", description: "Firing energy costs." },
  { name: "Clay Weight Calculator", url: "/clay-weight-calculator", description: "Clay weight for forms." },
  { name: "Pottery Pricing Calculator", url: "/pottery-pricing-calculator", description: "Price your pottery." },
  { name: "Ceramic Fiber Calculator", url: "/ceramic-fiber-calculator", description: "Kiln insulation." },
  { name: "Raku Firing Calculator", url: "/raku-firing-calculator", description: "Raku firing planning." },
];
---
<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Kiln Shelf Calculator"
  keywords="kiln shelf, kiln loading, kiln capacity, shelf arrangement, kiln posts, kiln furniture, kiln stacking, pottery kiln"
  breadcrumbs={[{ name: "Kiln Shelf Calculator", url: "/kiln-shelf-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Kiln Shelf Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Plan your kiln loading by calculating how many pieces fit per shelf and total kiln capacity.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <h3 class="font-semibold text-text mb-3">Kiln Interior Dimensions</h3>
      <div class="grid grid-cols-3 gap-3 mb-5">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Width (in)</label>
          <input type="number" id="ks2-kw" class="ks2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="23" min="6" step="0.5">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Depth (in)</label>
          <input type="number" id="ks2-kd" class="ks2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="23" min="6" step="0.5">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Height (in)</label>
          <input type="number" id="ks2-kh" class="ks2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="27" min="6" step="0.5">
        </div>
      </div>

      <h3 class="font-semibold text-text mb-3">Piece Dimensions</h3>
      <div class="grid grid-cols-3 gap-3 mb-5">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Piece Diameter (in)</label>
          <input type="number" id="ks2-pd" class="ks2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="1" step="0.5">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Piece Height (in)</label>
          <input type="number" id="ks2-ph" class="ks2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" min="1" step="0.5">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Spacing (in)</label>
          <input type="number" id="ks2-space" class="ks2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.5" min="0.25" max="3" step="0.25">
        </div>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Post Height Between Shelves (in)</label>
        <input type="number" id="ks2-post" class="ks2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="0.5" max="4" step="0.5">
        <p class="text-xs text-text-muted mt-1">Clearance above tallest piece on shelf (posts usually 0.5" to 1" taller than pieces)</p>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Kiln Capacity</div>
        <div class="text-4xl font-extrabold" id="ks2-total">--</div>
        <div class="text-sm text-blue-200 mt-1">pieces per full load</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Pieces per Shelf</div>
          <div class="text-xl font-bold" id="ks2-per-shelf">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Number of Shelves</div>
          <div class="text-xl font-bold" id="ks2-shelves">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Shelf Level Height</div>
          <div class="text-xl font-bold" id="ks2-level-h">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Space Efficiency</div>
          <div class="text-xl font-bold" id="ks2-efficiency">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-4">
        <h3 class="font-semibold text-sm text-text mb-2">Layout</h3>
        <p class="text-xs text-text-muted" id="ks2-layout">--</p>
      </div>

      <ShareButton calculatorId="kiln-shelf" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Kiln Loading Tips</h2>
      <p>Efficient kiln loading saves energy and ensures even firing. Leave adequate spacing between pieces for heat circulation, and avoid placing pieces too close to elements.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Loading Guidelines</h3>
      <ul>
        <li>Leave 1/2" to 1" between pieces for bisque firing</li>
        <li>Glaze-fired pieces must not touch - leave at least 1/2" gap</li>
        <li>Keep pieces at least 1" from kiln walls and elements</li>
        <li>Use kiln wash on all shelves to prevent glaze drips from bonding</li>
        <li>Place heavier pieces on lower shelves</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcKS2() {
      const kw = parseFloat((document.getElementById('ks2-kw') as HTMLInputElement).value) || 23;
      const kd = parseFloat((document.getElementById('ks2-kd') as HTMLInputElement).value) || 23;
      const kh = parseFloat((document.getElementById('ks2-kh') as HTMLInputElement).value) || 27;
      const pd = parseFloat((document.getElementById('ks2-pd') as HTMLInputElement).value) || 5;
      const ph = parseFloat((document.getElementById('ks2-ph') as HTMLInputElement).value) || 4;
      const spacing = parseFloat((document.getElementById('ks2-space') as HTMLInputElement).value) || 0.5;
      const postH = parseFloat((document.getElementById('ks2-post') as HTMLInputElement).value) || 1;

      // Usable shelf area (1" from walls)
      const usableW = kw - 2;
      const usableD = kd - 2;

      // How many pieces fit in a row and column (grid layout with spacing)
      const piecePlusSpace = pd + spacing;
      const cols = Math.floor((usableW + spacing) / piecePlusSpace);
      const rows = Math.floor((usableD + spacing) / piecePlusSpace);
      const perShelf = cols * rows;

      // How many shelf levels fit
      const shelfThickness = 0.625; // 5/8" standard shelf
      const levelHeight = ph + postH + shelfThickness;
      const numShelves = Math.floor(kh / levelHeight);

      const totalPieces = perShelf * numShelves;

      // Efficiency: volume used vs available
      const pieceVol = Math.PI * (pd / 2) * (pd / 2) * ph;
      const kilnVol = kw * kd * kh;
      const usedVol = pieceVol * totalPieces;
      const efficiency = (usedVol / kilnVol) * 100;

      document.getElementById('ks2-total')!.textContent = String(totalPieces);
      document.getElementById('ks2-per-shelf')!.textContent = String(perShelf);
      document.getElementById('ks2-shelves')!.textContent = String(numShelves);
      document.getElementById('ks2-level-h')!.textContent = levelHeight.toFixed(1) + '"';
      document.getElementById('ks2-efficiency')!.textContent = efficiency.toFixed(0) + '%';

      document.getElementById('ks2-layout')!.textContent =
        cols + ' columns x ' + rows + ' rows per shelf. Each shelf level uses ' +
        levelHeight.toFixed(1) + '" of height (' + ph + '" piece + ' + postH + '" post + ' +
        shelfThickness + '" shelf). Usable shelf area: ' + usableW.toFixed(1) + '" x ' + usableD.toFixed(1) + '".';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.ks2-in').forEach(el => {
        el.addEventListener('input', calcKS2);
        el.addEventListener('change', calcKS2);
      });
      calcKS2();
    }, 50);
  </script>
</CalculatorLayout>
