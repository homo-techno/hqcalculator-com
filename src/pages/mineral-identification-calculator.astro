---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Mineral Identification Calculator - ID by Properties";
const description = "Identify minerals from hardness, luster, streak, cleavage, and color. Match against a mineral database with confidence scoring.";
const relatedCalcs = [
  { name: "Density Calculator", url: "/density-calculator", description: "Material density." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage math." },
  { name: "Weight Converter", url: "/weight-converter", description: "Weight units." },
  { name: "Force Calculator", url: "/force-calculator", description: "Force calculations." },
  { name: "Friction Calculator", url: "/friction-calculator", description: "Friction forces." },
  { name: "Soil Composition", url: "/soil-composition-calculator", description: "Soil makeup." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Mineral Identification Calculator" keywords="mineral identification, mineral ID, hardness, luster, streak, cleavage, crystal system, geology" breadcrumbs={[{ name: "Mineral ID", url: "/mineral-identification-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Mineral Identification Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Enter observable mineral properties to find matching minerals with confidence scores from the built-in database.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Hardness (Mohs 1-10)</label>
            <input type="number" id="mi2-hardness" class="mi2-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="7" min="1" max="10" step="0.5">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Specific Gravity</label>
            <input type="number" id="mi2-sg" class="mi2-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="2.65" min="0" step="0.05">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Luster</label>
            <select id="mi2-luster" class="mi2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="any">Any / Unknown</option>
              <option value="vitreous" selected>Vitreous (glassy)</option>
              <option value="metallic">Metallic</option>
              <option value="pearly">Pearly</option>
              <option value="silky">Silky</option>
              <option value="resinous">Resinous</option>
              <option value="adamantine">Adamantine</option>
              <option value="earthy">Earthy / Dull</option>
              <option value="waxy">Waxy</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Streak Color</label>
            <select id="mi2-streak" class="mi2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="any">Any / Unknown</option>
              <option value="white" selected>White / Colorless</option>
              <option value="red">Red / Brown</option>
              <option value="black">Black / Dark</option>
              <option value="yellow">Yellow / Gold</option>
              <option value="green">Green</option>
              <option value="blue">Blue</option>
              <option value="gray">Gray</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Cleavage</label>
            <select id="mi2-cleavage" class="mi2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="any">Any / Unknown</option>
              <option value="none" selected>None (conchoidal fracture)</option>
              <option value="1dir">1 direction</option>
              <option value="2dir">2 directions</option>
              <option value="3dir">3 directions</option>
              <option value="4dir">4 directions</option>
              <option value="6dir">6 directions</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Color</label>
            <select id="mi2-color" class="mi2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="any">Any / Unknown</option>
              <option value="clear">Clear / Colorless</option>
              <option value="white">White</option>
              <option value="pink">Pink / Red</option>
              <option value="yellow">Yellow / Brown</option>
              <option value="green">Green</option>
              <option value="blue">Blue</option>
              <option value="black">Black / Dark</option>
              <option value="gray">Gray / Silver</option>
              <option value="purple">Purple</option>
            </select>
          </div>
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Best Match</div>
          <div class="text-4xl font-extrabold" id="mi2-best">--</div>
          <div class="text-sm text-blue-200 mt-1" id="mi2-conf">Confidence: 0%</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-muted uppercase mb-2">Top Matches</div>
          <div id="mi2-matches" class="space-y-2 text-sm"></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Best Match Details</div>
          <div class="text-sm" id="mi2-details">--</div>
        </div>
      </div>

      <ShareButton calculatorId="mineral-identification" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Mineral Identification Guide</h2>
      <p>Minerals are identified by their physical properties: hardness, luster, streak, cleavage, crystal system, color, and specific gravity. Each property narrows the list of possible minerals. The more properties you specify, the higher the confidence of identification.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcMI2() {
      const minerals = [
        { name: 'Quartz', h: 7, sg: 2.65, luster: 'vitreous', streak: 'white', cleavage: 'none', colors: ['clear','white','pink','purple','yellow','gray'], desc: 'SiO2 - Most common mineral. Conchoidal fracture, hexagonal crystals.' },
        { name: 'Feldspar (Orthoclase)', h: 6, sg: 2.56, luster: 'vitreous', streak: 'white', cleavage: '2dir', colors: ['pink','white','gray'], desc: 'KAlSi3O8 - Most abundant mineral group. Two cleavage directions at ~90 degrees.' },
        { name: 'Calcite', h: 3, sg: 2.71, luster: 'vitreous', streak: 'white', cleavage: '3dir', colors: ['clear','white','yellow'], desc: 'CaCO3 - Reacts with HCl. Rhombohedral cleavage.' },
        { name: 'Fluorite', h: 4, sg: 3.18, luster: 'vitreous', streak: 'white', cleavage: '4dir', colors: ['purple','green','blue','yellow','clear'], desc: 'CaF2 - Octahedral cleavage (4 directions). Often fluorescent.' },
        { name: 'Pyrite', h: 6.5, sg: 5.0, luster: 'metallic', streak: 'black', cleavage: 'none', colors: ['yellow','gray'], desc: 'FeS2 - "Fools Gold". Cubic crystals, black streak distinguishes from gold.' },
        { name: 'Galena', h: 2.5, sg: 7.6, luster: 'metallic', streak: 'gray', cleavage: '3dir', colors: ['gray','black'], desc: 'PbS - Lead ore. Perfect cubic cleavage, very heavy.' },
        { name: 'Hematite', h: 6, sg: 5.3, luster: 'metallic', streak: 'red', cleavage: 'none', colors: ['black','gray','pink'], desc: 'Fe2O3 - Iron ore. Red-brown streak is diagnostic.' },
        { name: 'Magnetite', h: 6, sg: 5.2, luster: 'metallic', streak: 'black', cleavage: 'none', colors: ['black'], desc: 'Fe3O4 - Magnetic iron ore. Strongly attracted to magnets.' },
        { name: 'Talc', h: 1, sg: 2.75, luster: 'pearly', streak: 'white', cleavage: '1dir', colors: ['white','green','gray'], desc: 'Mg3Si4O10(OH)2 - Softest mineral. Soapy feel.' },
        { name: 'Gypsum', h: 2, sg: 2.32, luster: 'vitreous', streak: 'white', cleavage: '1dir', colors: ['clear','white','pink'], desc: 'CaSO4 2H2O - Can be scratched by fingernail.' },
        { name: 'Mica (Muscovite)', h: 2.5, sg: 2.82, luster: 'pearly', streak: 'white', cleavage: '1dir', colors: ['clear','white','gray'], desc: 'KAl2(AlSi3O10)(OH)2 - Perfect basal cleavage, peels in sheets.' },
        { name: 'Biotite', h: 2.5, sg: 3.0, luster: 'pearly', streak: 'white', cleavage: '1dir', colors: ['black','green'], desc: 'K(Mg,Fe)3AlSi3O10(OH)2 - Dark mica, peels in sheets.' },
        { name: 'Olivine', h: 6.5, sg: 3.3, luster: 'vitreous', streak: 'white', cleavage: 'none', colors: ['green','yellow'], desc: '(Mg,Fe)2SiO4 - Green glassy mineral. Common in basalt.' },
        { name: 'Garnet', h: 7, sg: 3.8, luster: 'vitreous', streak: 'white', cleavage: 'none', colors: ['pink','green','black','yellow'], desc: 'Complex silicate - Dodecahedral crystals. No cleavage.' },
        { name: 'Topaz', h: 8, sg: 3.53, luster: 'vitreous', streak: 'white', cleavage: '1dir', colors: ['clear','blue','yellow','pink'], desc: 'Al2SiO4(F,OH)2 - Hard gemstone. Perfect basal cleavage.' },
        { name: 'Corundum', h: 9, sg: 4.0, luster: 'adamantine', streak: 'white', cleavage: 'none', colors: ['blue','pink','clear','yellow'], desc: 'Al2O3 - Sapphire/Ruby. Extremely hard, hexagonal crystals.' },
        { name: 'Diamond', h: 10, sg: 3.52, luster: 'adamantine', streak: 'white', cleavage: '4dir', colors: ['clear','yellow','blue','pink'], desc: 'C - Hardest natural substance. Octahedral cleavage.' },
        { name: 'Halite', h: 2.5, sg: 2.16, luster: 'vitreous', streak: 'white', cleavage: '3dir', colors: ['clear','white','pink','blue'], desc: 'NaCl - Rock salt. Cubic cleavage, salty taste.' },
        { name: 'Apatite', h: 5, sg: 3.2, luster: 'vitreous', streak: 'white', cleavage: 'none', colors: ['green','blue','yellow','purple'], desc: 'Ca5(PO4)3(F,Cl,OH) - Hexagonal crystals. Found in bones/teeth.' },
        { name: 'Chalcopyrite', h: 3.5, sg: 4.2, luster: 'metallic', streak: 'black', cleavage: 'none', colors: ['yellow','green'], desc: 'CuFeS2 - Copper ore. Iridescent tarnish.' },
      ];

      const inputH = parseFloat((document.getElementById('mi2-hardness') as HTMLInputElement).value) || 0;
      const inputSG = parseFloat((document.getElementById('mi2-sg') as HTMLInputElement).value) || 0;
      const inputLuster = (document.getElementById('mi2-luster') as HTMLSelectElement).value;
      const inputStreak = (document.getElementById('mi2-streak') as HTMLSelectElement).value;
      const inputCleavage = (document.getElementById('mi2-cleavage') as HTMLSelectElement).value;
      const inputColor = (document.getElementById('mi2-color') as HTMLSelectElement).value;

      const scored = minerals.map(m => {
        let score = 0;
        let maxScore = 0;

        maxScore += 30;
        const hDiff = Math.abs(m.h - inputH);
        score += Math.max(0, 30 - hDiff * 15);

        maxScore += 20;
        const sgDiff = Math.abs(m.sg - inputSG);
        score += Math.max(0, 20 - sgDiff * 10);

        if (inputLuster !== 'any') {
          maxScore += 20;
          if (m.luster === inputLuster) score += 20;
        }
        if (inputStreak !== 'any') {
          maxScore += 15;
          if (m.streak === inputStreak) score += 15;
        }
        if (inputCleavage !== 'any') {
          maxScore += 15;
          if (m.cleavage === inputCleavage) score += 15;
        }
        if (inputColor !== 'any') {
          maxScore += 10;
          if (m.colors.includes(inputColor)) score += 10;
        }

        const confidence = maxScore > 0 ? (score / maxScore) * 100 : 0;
        return { ...m, score, confidence };
      });

      scored.sort((a, b) => b.confidence - a.confidence);
      const top5 = scored.slice(0, 5);
      const best = top5[0];

      document.getElementById('mi2-best')!.textContent = best.name;
      document.getElementById('mi2-conf')!.textContent = 'Confidence: ' + best.confidence.toFixed(0) + '%';
      document.getElementById('mi2-details')!.textContent = best.desc;

      const matchesEl = document.getElementById('mi2-matches')!;
      let html = '';
      top5.forEach((m, i) => {
        const barW = m.confidence.toFixed(0);
        html += '<div class="flex items-center gap-2">';
        html += '<span class="w-5 text-right text-xs text-text-muted">' + (i + 1) + '.</span>';
        html += '<span class="w-32 truncate font-medium">' + m.name + '</span>';
        html += '<div class="flex-1 bg-gray-200 rounded-full h-3"><div class="h-3 rounded-full bg-primary" style="width:' + barW + '%"></div></div>';
        html += '<span class="w-10 text-right text-xs font-bold">' + barW + '%</span>';
        html += '</div>';
      });
      matchesEl.innerHTML = html;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.mi2-in').forEach(el => { el.addEventListener('input', calcMI2); el.addEventListener('change', calcMI2); });
      calcMI2();
    }, 50);
  </script>
</CalculatorLayout>
