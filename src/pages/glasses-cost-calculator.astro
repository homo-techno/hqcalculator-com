---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Glasses Cost Calculator";
const description = "Calculate total eyeglasses cost including frame, lenses, coatings (AR, blue-light, photochromic, progressive), and insurance benefits.";
const relatedCalcs = [
  { name: "Lens Thickness Calculator", url: "/lens-thickness-calculator", description: "Lens thickness by index." },
  { name: "Contact Lens Calculator", url: "/contact-lens-calculator", description: "Annual contact lens costs." },
  { name: "Eye Exam Calculator", url: "/eye-exam-calculator", description: "Eye exam cost by type." },
  { name: "Pupillary Distance Calculator", url: "/pupillary-distance-calculator", description: "PD measurement guide." },
  { name: "Vision Prescription Calculator", url: "/vision-prescription-calculator", description: "Understand your prescription." },
  { name: "Health Insurance Calculator", url: "/health-insurance-calculator", description: "Health plan cost comparison." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Glasses Cost Calculator" keywords="glasses cost calculator, eyeglasses price, progressive lenses cost, blue light coating, anti-reflective coating, vision insurance" breadcrumbs={[{ name: "Glasses Cost", url: "/glasses-cost-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Glasses Cost Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate total eyeglasses cost with frame, lenses, coatings, and insurance offset.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Frame Tier</label>
            <select id="gc3-frame" class="gc3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="budget">Budget ($30-$80)</option>
              <option value="mid" selected>Mid-Range ($100-$200)</option>
              <option value="designer">Designer ($250-$500)</option>
              <option value="luxury">Luxury ($500+)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Lens Type</label>
            <select id="gc3-lens" class="gc3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="sv" selected>Single Vision</option>
              <option value="bifocal">Bifocal</option>
              <option value="progressive">Progressive (No-Line Bifocal)</option>
              <option value="occupational">Occupational / Office</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Lens Material / Index</label>
            <select id="gc3-mat" class="gc3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="cr39">CR-39 (1.50)</option>
              <option value="poly" selected>Polycarbonate (1.59)</option>
              <option value="hi160">High-Index 1.60</option>
              <option value="hi167">High-Index 1.67</option>
              <option value="hi174">Ultra High-Index 1.74</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Coatings</label>
            <select id="gc3-coat" class="gc3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="none">No Coatings</option>
              <option value="ar" selected>Anti-Reflective Only</option>
              <option value="arblue">AR + Blue Light Filter</option>
              <option value="photo">Photochromic (Transitions)</option>
              <option value="all">AR + Blue + Photochromic</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Vision Insurance Allowance ($)</label><input type="number" id="gc3-ins" class="gc3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="150" min="0" max="1000" step="10"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Frame Allowance ($)</label><input type="number" id="gc3-fa" class="gc3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="130" min="0" max="500" step="10"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Glasses Cost</div>
          <div class="text-5xl font-extrabold font-mono" id="gc3-total">$0</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Frame Cost</div><div class="text-xl font-bold font-mono" id="gc3-fc">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Lenses + Coatings</div><div class="text-xl font-bold font-mono" id="gc3-lc">$0</div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Insurance Offset</div><div class="text-xl font-bold font-mono" id="gc3-io">-$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Out of Pocket</div><div class="text-xl font-bold font-mono" id="gc3-oop">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Annual (replace 2yr)</div><div class="text-xl font-bold font-mono" id="gc3-annual">$0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="glasses-cost" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcGC3() {
      const frame = (document.getElementById('gc3-frame') as HTMLSelectElement).value;
      const lens = (document.getElementById('gc3-lens') as HTMLSelectElement).value;
      const mat = (document.getElementById('gc3-mat') as HTMLSelectElement).value;
      const coat = (document.getElementById('gc3-coat') as HTMLSelectElement).value;
      const insAllow = parseFloat((document.getElementById('gc3-ins') as HTMLInputElement).value) || 0;
      const frameAllow = parseFloat((document.getElementById('gc3-fa') as HTMLInputElement).value) || 0;

      const frameCosts: Record<string, number> = { budget: 55, mid: 150, designer: 375, luxury: 650 };
      const lensCosts: Record<string, number> = { sv: 80, bifocal: 150, progressive: 300, occupational: 250 };
      const matCosts: Record<string, number> = { cr39: 0, poly: 50, hi160: 100, hi167: 150, hi174: 250 };
      const coatCosts: Record<string, number> = { none: 0, ar: 80, arblue: 120, photo: 130, all: 200 };

      const fc = frameCosts[frame];
      const lc = lensCosts[lens] + matCosts[mat] + coatCosts[coat];
      const subtotal = fc + lc;

      const frameOffset = Math.min(fc, frameAllow);
      const lensOffset = Math.min(lc, insAllow);
      const totalOffset = frameOffset + lensOffset;
      const oop = Math.max(0, subtotal - totalOffset);
      const annual = Math.round(oop / 2);

      document.getElementById('gc3-total')!.textContent = '$' + subtotal.toLocaleString();
      document.getElementById('gc3-fc')!.textContent = '$' + fc.toLocaleString();
      document.getElementById('gc3-lc')!.textContent = '$' + lc.toLocaleString();
      document.getElementById('gc3-io')!.textContent = '-$' + Math.round(totalOffset).toLocaleString();
      document.getElementById('gc3-oop')!.textContent = '$' + Math.round(oop).toLocaleString();
      document.getElementById('gc3-annual')!.textContent = '$' + annual.toLocaleString() + '/yr';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.gc3-in').forEach(el => { el.addEventListener('input', calcGC3); el.addEventListener('change', calcGC3); });
      calcGC3();
    }, 50);
  </script>
</CalculatorLayout>
