---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Pleating Calculator - Fabric for Pleats";
const description = "Calculate fabric needed for knife, box, and accordion pleats. Determine pleat depth, spacing, fullness ratio, and total fabric required.";
const relatedCalcs = [
  { name: "Fabric Calculator", url: "/fabric-calculator", description: "Fabric yardage needs." },
  { name: "Quilt Calculator", url: "/quilt-calculator", description: "Quilt sizing math." },
  { name: "Yarn Calculator", url: "/yarn-calculator", description: "Yarn yardage calculator." },
  { name: "Area Calculator", url: "/area-calculator", description: "Area calculations." },
  { name: "Ratio Calculator", url: "/ratio-calculator", description: "Ratio calculations." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Pleating Calculator" keywords="pleating calculator, fabric for pleats, knife pleat, box pleat, accordion pleat, pleat depth, fullness ratio" breadcrumbs={[{ name: "Pleating", url: "/pleating-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Pleating Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate fabric needed for different pleat types with depth, spacing, and fullness ratio.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Pleat Type</label>
          <select id="pl2-type" class="pl2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="knife" selected>Knife Pleat</option>
            <option value="box">Box Pleat</option>
            <option value="inverted">Inverted Box Pleat</option>
            <option value="accordion">Accordion / Crystal Pleat</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Finished Width (inches)</label><input type="number" id="pl2-fw" class="pl2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="30" min="1" step="0.5"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Pleat Depth (inches)</label><input type="number" id="pl2-depth" class="pl2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.5" min="0.25" max="6" step="0.25"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Pleat Spacing (inches)</label><input type="number" id="pl2-space" class="pl2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.5" min="0.25" max="6" step="0.25"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Garment Length (inches)</label><input type="number" id="pl2-len" class="pl2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="24" min="4" step="0.5"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Fabric Width (inches)</label><input type="number" id="pl2-fabw" class="pl2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="45" min="36" max="120" step="1"></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Fabric Width Needed</div>
          <div class="text-4xl font-extrabold font-mono" id="pl2-result">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Number of Pleats</div><div class="text-xl font-bold font-mono" id="pl2-count">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Fullness Ratio</div><div class="text-xl font-bold font-mono" id="pl2-ratio">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Fabric per Pleat</div><div class="text-xl font-bold font-mono" id="pl2-per">--</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Fabric Yardage</div><div class="text-xl font-bold font-mono" id="pl2-yards">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Extra Fabric</div><div class="text-xl font-bold font-mono" id="pl2-extra">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="pleating" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcPL2() {
      const ptype = (document.getElementById('pl2-type') as HTMLSelectElement).value;
      const fw = parseFloat((document.getElementById('pl2-fw') as HTMLInputElement).value) || 30;
      const depth = parseFloat((document.getElementById('pl2-depth') as HTMLInputElement).value) || 1.5;
      const spacing = parseFloat((document.getElementById('pl2-space') as HTMLInputElement).value) || 1.5;
      const length = parseFloat((document.getElementById('pl2-len') as HTMLInputElement).value) || 24;
      const fabWidth = parseFloat((document.getElementById('pl2-fabw') as HTMLInputElement).value) || 45;

      // Number of pleats based on finished width and spacing
      const numPleats = Math.floor(fw / spacing);

      // Fabric consumed per pleat depends on type
      let fabricPerPleat = 0;
      if (ptype === 'knife') {
        fabricPerPleat = depth * 2; // each knife pleat uses 2x depth
      } else if (ptype === 'box' || ptype === 'inverted') {
        fabricPerPleat = depth * 4; // box pleat uses 4x depth
      } else if (ptype === 'accordion') {
        fabricPerPleat = depth * 2; // accordion similar to knife
      }

      const totalFabricWidth = fw + (numPleats * fabricPerPleat);
      const fullnessRatio = totalFabricWidth / fw;
      const extraFabric = totalFabricWidth - fw;

      // How many fabric widths needed if joining panels
      const panels = Math.ceil(totalFabricWidth / fabWidth);
      const fabricYardage = (panels * (length + 2)) / 36; // +2" for hem

      document.getElementById('pl2-result')!.textContent = totalFabricWidth.toFixed(1) + ' inches';
      document.getElementById('pl2-count')!.textContent = numPleats.toString();
      document.getElementById('pl2-ratio')!.textContent = fullnessRatio.toFixed(2) + 'x';
      document.getElementById('pl2-per')!.textContent = fabricPerPleat.toFixed(1) + '"';
      document.getElementById('pl2-yards')!.textContent = fabricYardage.toFixed(2) + ' yd';
      document.getElementById('pl2-extra')!.textContent = extraFabric.toFixed(1) + '"';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.pl2-in').forEach(el => { el.addEventListener('input', calcPL2); el.addEventListener('change', calcPL2); });
      calcPL2();
    }, 50);
  </script>
</CalculatorLayout>
