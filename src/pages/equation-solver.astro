---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Equation Solver";
const description = "Solve linear, quadratic, and cubic equations step by step. Find real and complex roots.";
const relatedCalcs = [
  { name: "Quadratic Equation", url: "/quadratic-equation-calculator", description: "Quadratic." },
  { name: "Linear Equation", url: "/linear-equation-calculator", description: "Linear." },
  { name: "Polynomial", url: "/polynomial-calculator", description: "Polynomial." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Scientific." },
  { name: "Fraction Calculator", url: "/fraction-calculator", description: "Fractions." },
  { name: "Square Root", url: "/square-root-calculator", description: "Sqrt." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Equation Solver" keywords="equation solver, solve equations, find x, linear equation, quadratic solver, cubic equation" breadcrumbs={[{ name: "Equation Solver", url: "/equation-solver" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Equation Solver</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Solve linear, quadratic, and cubic equations with steps.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="flex gap-2">
          <button class="eq-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 border-primary bg-blue-50 text-primary" data-mode="linear">Linear</button>
          <button class="eq-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-mode="quadratic">Quadratic</button>
          <button class="eq-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-mode="cubic">Cubic</button>
        </div>
        <div id="eq-linear" class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">ax + b = 0</h3>
          <div class="flex gap-2 items-center">
            <input type="number" id="eq-la" class="eq-in w-24 px-3 py-2 border border-border rounded-xl text-lg font-bold text-center" value="5" step="1">
            <span class="font-bold">x +</span>
            <input type="number" id="eq-lb" class="eq-in w-24 px-3 py-2 border border-border rounded-xl text-lg font-bold text-center" value="-15" step="1">
            <span class="font-bold">= 0</span>
          </div>
        </div>
        <div id="eq-quadratic" class="p-4 bg-surface-alt rounded-xl hidden">
          <h3 class="font-semibold text-sm text-text mb-2">ax² + bx + c = 0</h3>
          <div class="flex gap-2 items-center">
            <input type="number" id="eq-qa" class="eq-in w-20 px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="1" step="1">
            <span class="font-bold text-sm">x² +</span>
            <input type="number" id="eq-qb" class="eq-in w-20 px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="-5" step="1">
            <span class="font-bold text-sm">x +</span>
            <input type="number" id="eq-qc" class="eq-in w-20 px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="6" step="1">
            <span class="font-bold text-sm">= 0</span>
          </div>
        </div>
        <div id="eq-cubic" class="p-4 bg-surface-alt rounded-xl hidden">
          <h3 class="font-semibold text-sm text-text mb-2">ax³ + bx² + cx + d = 0</h3>
          <div class="flex gap-2 items-center flex-wrap">
            <input type="number" id="eq-ca" class="eq-in w-16 px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="1" step="1">
            <span class="font-bold text-sm">x³ +</span>
            <input type="number" id="eq-cb" class="eq-in w-16 px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="-6" step="1">
            <span class="font-bold text-sm">x² +</span>
            <input type="number" id="eq-cc" class="eq-in w-16 px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="11" step="1">
            <span class="font-bold text-sm">x +</span>
            <input type="number" id="eq-cd" class="eq-in w-16 px-2 py-2 border border-border rounded-xl text-lg font-bold text-center" value="-6" step="1">
            <span class="font-bold text-sm">= 0</span>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Solution</div>
          <div class="text-4xl font-extrabold font-mono" id="eq-result">x = 3</div>
        </div>
        <div class="grid grid-cols-2 gap-3" id="eq-extra">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase" id="eq-e1-label">Type</div><div class="text-xl font-bold font-mono" id="eq-e1">Linear</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase" id="eq-e2-label">Roots</div><div class="text-xl font-bold font-mono" id="eq-e2">1</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Step-by-Step</h3>
          <div class="text-xs space-y-1" id="eq-steps"></div>
        </div>
      </div>
      <ShareButton calculatorId="equation-solver" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    let eqMode = 'linear';
    function calcEQ() {
      const steps: string[] = [];
      if (eqMode === 'linear') {
        const a = parseFloat((document.getElementById('eq-la') as HTMLInputElement).value) || 0;
        const b = parseFloat((document.getElementById('eq-lb') as HTMLInputElement).value) || 0;
        if (a === 0) {
          document.getElementById('eq-result')!.textContent = b === 0 ? 'All x' : 'No solution';
          document.getElementById('eq-e1')!.textContent = 'Linear';
          document.getElementById('eq-e2')!.textContent = a === 0 && b === 0 ? '∞' : '0';
          steps.push(`<div>${a}x + (${b}) = 0</div>`);
          steps.push(`<div>a = 0, ${b === 0 ? 'identity (true for all x)' : 'contradiction (no solution)'}</div>`);
        } else {
          const x = -b / a;
          document.getElementById('eq-result')!.textContent = `x = ${x.toFixed(4)}`;
          document.getElementById('eq-e1')!.textContent = 'Linear';
          document.getElementById('eq-e2')!.textContent = '1 root';
          steps.push(`<div>${a}x + (${b}) = 0</div>`);
          steps.push(`<div>${a}x = ${-b}</div>`);
          steps.push(`<div>x = ${-b} / ${a} = ${x.toFixed(4)}</div>`);
          steps.push(`<div class="font-bold text-primary">Verify: ${a}(${x.toFixed(4)}) + (${b}) = ${(a * x + b).toFixed(6)} ✓</div>`);
        }
        document.getElementById('eq-e1-label')!.textContent = 'Type';
        document.getElementById('eq-e2-label')!.textContent = 'Roots';
      } else if (eqMode === 'quadratic') {
        const a = parseFloat((document.getElementById('eq-qa') as HTMLInputElement).value) || 0;
        const b = parseFloat((document.getElementById('eq-qb') as HTMLInputElement).value) || 0;
        const c = parseFloat((document.getElementById('eq-qc') as HTMLInputElement).value) || 0;
        const disc = b * b - 4 * a * c;
        steps.push(`<div>${a}x² + (${b})x + (${c}) = 0</div>`);
        steps.push(`<div>Discriminant: b² - 4ac = ${b}² - 4(${a})(${c}) = ${disc.toFixed(2)}</div>`);
        document.getElementById('eq-e1-label')!.textContent = 'Discriminant';
        document.getElementById('eq-e1')!.textContent = disc.toFixed(2);
        if (a === 0) {
          const x = b !== 0 ? -c / b : 0;
          document.getElementById('eq-result')!.textContent = b !== 0 ? `x = ${x.toFixed(4)}` : 'Not quadratic';
          document.getElementById('eq-e2')!.textContent = '1 root';
        } else if (disc > 0) {
          const x1 = (-b + Math.sqrt(disc)) / (2 * a);
          const x2 = (-b - Math.sqrt(disc)) / (2 * a);
          document.getElementById('eq-result')!.textContent = `x = ${x1.toFixed(4)}, ${x2.toFixed(4)}`;
          document.getElementById('eq-e2')!.textContent = '2 real';
          steps.push(`<div>x = (-b ± √D) / 2a</div>`);
          steps.push(`<div>x₁ = (${-b} + ${Math.sqrt(disc).toFixed(4)}) / ${2 * a} = ${x1.toFixed(4)}</div>`);
          steps.push(`<div>x₂ = (${-b} - ${Math.sqrt(disc).toFixed(4)}) / ${2 * a} = ${x2.toFixed(4)}</div>`);
        } else if (disc === 0) {
          const x1 = -b / (2 * a);
          document.getElementById('eq-result')!.textContent = `x = ${x1.toFixed(4)} (double)`;
          document.getElementById('eq-e2')!.textContent = '1 (double)';
          steps.push(`<div>x = -b / 2a = ${x1.toFixed(4)}</div>`);
        } else {
          const real = -b / (2 * a);
          const imag = Math.sqrt(-disc) / (2 * a);
          document.getElementById('eq-result')!.textContent = `${real.toFixed(3)} ± ${Math.abs(imag).toFixed(3)}i`;
          document.getElementById('eq-e2')!.textContent = '2 complex';
          steps.push(`<div>Complex roots: ${real.toFixed(4)} ± ${Math.abs(imag).toFixed(4)}i</div>`);
        }
        document.getElementById('eq-e2-label')!.textContent = 'Roots';
      } else {
        const a = parseFloat((document.getElementById('eq-ca') as HTMLInputElement).value) || 0;
        const b = parseFloat((document.getElementById('eq-cb') as HTMLInputElement).value) || 0;
        const c = parseFloat((document.getElementById('eq-cc') as HTMLInputElement).value) || 0;
        const d = parseFloat((document.getElementById('eq-cd') as HTMLInputElement).value) || 0;
        steps.push(`<div>${a}x³ + (${b})x² + (${c})x + (${d}) = 0</div>`);
        const roots: number[] = [];
        for (let x = -50; x <= 50; x += 0.05) {
          const y1 = a * x * x * x + b * x * x + c * x + d;
          const x2 = x + 0.05;
          const y2 = a * x2 * x2 * x2 + b * x2 * x2 + c * x2 + d;
          if (y1 * y2 <= 0) {
            let lo = x, hi = x2;
            for (let i = 0; i < 50; i++) {
              const mid = (lo + hi) / 2;
              const ym = a * mid * mid * mid + b * mid * mid + c * mid + d;
              if (ym * (a * lo * lo * lo + b * lo * lo + c * lo + d) <= 0) hi = mid;
              else lo = mid;
            }
            const root = parseFloat(((lo + hi) / 2).toFixed(4));
            if (roots.every(r => Math.abs(r - root) > 0.01)) roots.push(root);
          }
        }
        if (roots.length > 0) {
          document.getElementById('eq-result')!.textContent = roots.map(r => `x = ${r}`).join(', ');
          roots.forEach((r, i) => steps.push(`<div>x${i + 1} = ${r}</div>`));
        } else {
          document.getElementById('eq-result')!.textContent = 'No real roots in [-50, 50]';
        }
        document.getElementById('eq-e1-label')!.textContent = 'Type';
        document.getElementById('eq-e1')!.textContent = 'Cubic';
        document.getElementById('eq-e2-label')!.textContent = 'Real Roots';
        document.getElementById('eq-e2')!.textContent = roots.length.toString();
        steps.push(`<div class="text-text-muted">Roots found numerically via bisection</div>`);
      }
      document.getElementById('eq-steps')!.innerHTML = steps.join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.eq-mode').forEach(b => b.addEventListener('click', () => {
        eqMode = (b as HTMLButtonElement).dataset.mode!;
        document.querySelectorAll('.eq-mode').forEach(btn => {
          const active = (btn as HTMLButtonElement).dataset.mode === eqMode;
          (btn as HTMLButtonElement).className = `eq-mode flex-1 py-2 rounded-xl font-bold text-sm border-2 ${active ? 'border-primary bg-blue-50 text-primary' : 'border-border text-text-muted'}`;
        });
        document.getElementById('eq-linear')!.classList.toggle('hidden', eqMode !== 'linear');
        document.getElementById('eq-quadratic')!.classList.toggle('hidden', eqMode !== 'quadratic');
        document.getElementById('eq-cubic')!.classList.toggle('hidden', eqMode !== 'cubic');
        calcEQ();
      }));
      document.querySelectorAll('.eq-in').forEach(el => { el.addEventListener('input', calcEQ); el.addEventListener('change', calcEQ); });
      calcEQ();
    }, 50);
  </script>
</CalculatorLayout>
