---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Servo Motor Calculator - Torque, Speed & Power Selection";
const description = "Calculate servo motor torque, speed, and power requirements for robotic joints. Size servo motors for load inertia, acceleration, and duty cycle.";
const relatedCalcs = [
  { name: "Stepper Motor Calculator", url: "/stepper-motor-calculator", description: "Calculate stepper motor torque curves and step accuracy." },
  { name: "Gearbox Ratio Calculator", url: "/gearbox-ratio-calculator", description: "Select gearbox ratio for motor-to-load matching." },
  { name: "PID Controller Calculator", url: "/pid-controller-calculator", description: "Tune PID parameters with Ziegler-Nichols method." },
  { name: "Ball Screw Calculator", url: "/ball-screw-calculator", description: "Calculate ball screw lead, speed, and thrust." },
  { name: "Motion Profile Calculator", url: "/motion-profile-calculator", description: "Design trapezoidal and S-curve motion profiles." },
  { name: "Harmonic Drive Calculator", url: "/harmonic-drive-calculator", description: "Calculate harmonic drive gear ratio and torque capacity." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Servo Motor Calculator" keywords="servo motor calculator, servo torque calculation, servo motor sizing, robotic joint motor, servo power calculation, motor selection tool" breadcrumbs={[{ name: "Servo Motor Calculator", url: "/servo-motor-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Servo Motor Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate servo motor torque, speed, and power for robotic joint applications. Accounts for load inertia, friction, and acceleration requirements.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-6">
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Load Inertia (kg*cmÂ²)</label>
          <input type="number" id="svm-load-inertia" class="svm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" min="0.01" step="0.1">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Load Torque (N*m)</label>
          <input type="number" id="svm-load-torque" class="svm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.5" min="0" step="0.1">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Required Speed (RPM)</label>
          <input type="number" id="svm-speed" class="svm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3000" min="1" step="100">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Acceleration Time (ms)</label>
          <input type="number" id="svm-accel-time" class="svm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="100" min="1" step="10">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Gear Ratio</label>
          <input type="number" id="svm-gear-ratio" class="svm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="1" step="1">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Safety Factor</label>
          <input type="number" id="svm-safety" class="svm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.5" min="1" step="0.1">
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm font-medium opacity-80 mb-1">Required Motor Torque</div>
          <div id="svm-result-torque" class="text-3xl sm:text-4xl font-extrabold">--</div>
          <div class="text-sm opacity-80 mt-1">N*m (with safety factor)</div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary mb-1">Accel Torque</div>
            <div id="svm-accel-torque" class="text-lg font-bold text-text">--</div>
            <div class="text-xs text-text-secondary">N*m</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary mb-1">Motor Power</div>
            <div id="svm-power" class="text-lg font-bold text-text">--</div>
            <div class="text-xs text-text-secondary">Watts</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary mb-1">Motor Speed</div>
            <div id="svm-motor-speed" class="text-lg font-bold text-text">--</div>
            <div class="text-xs text-text-secondary">RPM</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary mb-1">Inertia Ratio</div>
            <div id="svm-inertia-ratio" class="text-lg font-bold text-text">--</div>
            <div class="text-xs text-text-secondary">Load/Motor</div>
          </div>
        </div>

        <ShareButton />
        <FeedbackWidget />
      </div>
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcSVM() {
      const loadInertia = parseFloat((document.getElementById('svm-load-inertia') as HTMLInputElement).value) || 5;
      const loadTorque = parseFloat((document.getElementById('svm-load-torque') as HTMLInputElement).value) || 0;
      const speed = parseFloat((document.getElementById('svm-speed') as HTMLInputElement).value) || 3000;
      const accelTime = parseFloat((document.getElementById('svm-accel-time') as HTMLInputElement).value) || 100;
      const gearRatio = parseFloat((document.getElementById('svm-gear-ratio') as HTMLInputElement).value) || 1;
      const safety = parseFloat((document.getElementById('svm-safety') as HTMLInputElement).value) || 1.5;

      const loadInertiaKgM2 = loadInertia / 10000;
      const motorSpeed = speed * gearRatio;
      const angularAccel = (motorSpeed * 2 * Math.PI / 60) / (accelTime / 1000);
      const accelTorque = loadInertiaKgM2 * angularAccel / (gearRatio * gearRatio);
      const totalTorque = (accelTorque + loadTorque / gearRatio) * safety;
      const power = totalTorque * motorSpeed * 2 * Math.PI / 60;
      const typicalMotorInertia = loadInertiaKgM2 / 5;
      const inertiaRatio = loadInertiaKgM2 / (typicalMotorInertia > 0 ? typicalMotorInertia : 0.0001);

      document.getElementById('svm-result-torque')!.textContent = totalTorque.toFixed(3);
      document.getElementById('svm-accel-torque')!.textContent = accelTorque.toFixed(3);
      document.getElementById('svm-power')!.textContent = power.toFixed(1);
      document.getElementById('svm-motor-speed')!.textContent = motorSpeed.toFixed(0);
      document.getElementById('svm-inertia-ratio')!.textContent = inertiaRatio.toFixed(1) + ':1';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.svm-in').forEach(el => { el.addEventListener('input', calcSVM); el.addEventListener('change', calcSVM); });
      calcSVM();
    }, 50);
  </script>
</CalculatorLayout>
