---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Envelope Calculator - Sizes, Postage Weight & Printing Area";
const description = "Calculate envelope sizes, mail weight, postage costs, and printable area for standard and custom envelopes.";
const relatedCalcs = [
  { name: "Paper Weight Calculator", url: "/paper-weight-calculator", description: "Paper weight converter." },
  { name: "Label Calculator", url: "/label-calculator", description: "Label printing costs." },
  { name: "Business Card Calculator", url: "/business-card-calculator", description: "Business card printing." },
  { name: "Print Cost Calculator", url: "/print-cost-calculator", description: "Print job cost estimator." },
  { name: "Paper Fold Calculator", url: "/paper-fold-calculator", description: "Fold types and panels." },
  { name: "Bleed Margin Calculator", url: "/bleed-margin-calculator", description: "Print bleed calculations." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Envelope Calculator" keywords="envelope size, envelope weight, postage calculator, printing area, envelope dimensions, mailing cost, USPS envelope" breadcrumbs={[{ name: "Envelope Calculator", url: "/envelope-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Envelope Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Look up envelope sizes, calculate total mailing weight with contents, and determine printable area for envelope printing.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div><label class="block text-xs font-medium text-text mb-1">Envelope Size</label>
          <select id="env-size" class="env-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="6.5x3.625">#6-3/4 (6.5 x 3.625 in)</option>
            <option value="7.5x3.875">#7-3/4 (7.5 x 3.875 in)</option>
            <option value="8.625x3.625">#9 (8.625 x 3.625 in)</option>
            <option value="9.5x4.125">#10 (9.5 x 4.125 in) - Standard</option>
            <option value="11.5x4.5">#12 (11.5 x 4.5 in)</option>
            <option value="10x13">10 x 13 (Catalog)</option>
            <option value="12x15.5">12 x 15.5 (Catalog Large)</option>
            <option value="6x9">6 x 9 (Booklet)</option>
            <option value="9x12">9 x 12 (Booklet Large)</option>
            <option value="5.25x7.25">A7 (5.25 x 7.25 in)</option>
            <option value="custom">Custom Size</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Width (inches)</label><input type="number" id="env-width" class="env-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="0.125"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Height (inches)</label><input type="number" id="env-height" class="env-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="0.125"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Pages Inside</label><input type="number" id="env-pages" class="env-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="0" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Paper Weight (GSM)</label><input type="number" id="env-gsm" class="env-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="1"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Paper Size Inside</label>
          <select id="env-paper" class="env-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="8.5x11">Letter (8.5 x 11 in)</option>
            <option value="8.5x14">Legal (8.5 x 14 in)</option>
            <option value="5.5x8.5">Half Letter (5.5 x 8.5 in)</option>
            <option value="a4">A4 (210 x 297 mm)</option>
          </select>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Mailing Weight</div>
          <div class="text-5xl font-extrabold font-mono" id="env-result">0.0 oz</div>
          <div class="text-sm text-blue-200 mt-1" id="env-postage"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Envelope Weight</div><div class="text-xl font-bold" id="env-envwt">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Contents Weight</div><div class="text-xl font-bold" id="env-contwt">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Printable Area</div><div class="text-xl font-bold" id="env-printarea">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Mail Class</div><div class="text-xl font-bold" id="env-class">--</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Details</h3>
          <div class="font-mono text-sm space-y-1" id="env-steps"></div>
        </div>
      </div>
      <ShareButton calculatorId="envelope" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Envelope Size & Mailing Guide</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p>#10 envelope: 9.5 x 4.125 in (standard business)</p>
        <p>USPS Letter: max 11.5 x 6.125 in, 0.25 in thick, 3.5 oz</p>
        <p>USPS Large Envelope/Flat: max 15 x 12 in, 0.75 in thick, 13 oz</p>
        <p>Envelope weight estimate: ~5-10g for standard, ~15-25g for catalog</p>
      </div>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcEnv() {
      const sizeVal = (document.getElementById('env-size') as HTMLSelectElement).value;
      if (sizeVal !== 'custom') {
        const parts = sizeVal.split('x');
        (document.getElementById('env-width') as HTMLInputElement).value = parts[0];
        (document.getElementById('env-height') as HTMLInputElement).value = parts[1];
      }
      const envW = parseFloat((document.getElementById('env-width') as HTMLInputElement).value) || 0;
      const envH = parseFloat((document.getElementById('env-height') as HTMLInputElement).value) || 0;
      const pages = parseFloat((document.getElementById('env-pages') as HTMLInputElement).value) || 0;
      const gsm = parseFloat((document.getElementById('env-gsm') as HTMLInputElement).value) || 80;
      const paperSize = (document.getElementById('env-paper') as HTMLSelectElement).value;
      const paperDims: Record<string, [number, number]> = {
        '8.5x11': [8.5, 11], '8.5x14': [8.5, 14], '5.5x8.5': [5.5, 8.5], a4: [8.268, 11.693]
      };
      const pd = paperDims[paperSize] || [8.5, 11];
      const paperAreaM2 = (pd[0] * 0.0254) * (pd[1] * 0.0254);
      const paperWeightG = paperAreaM2 * gsm;
      const contentsWeightG = paperWeightG * pages;
      const envAreaM2 = (envW * 0.0254) * (envH * 0.0254) * 2;
      const envWeightG = envAreaM2 * 90 + 2;
      const totalWeightG = envWeightG + contentsWeightG;
      const totalWeightOz = totalWeightG / 28.3495;
      const printMargin = 0.25;
      const printW = envW - 2 * printMargin;
      const printH = envH - 2 * printMargin;
      let mailClass = 'Letter';
      let postageEst = 0.73;
      if (envW > 11.5 || envH > 6.125 || totalWeightOz > 3.5) {
        mailClass = 'Large Envelope / Flat';
        postageEst = 1.35;
        if (totalWeightOz > 1) postageEst += Math.ceil(totalWeightOz - 1) * 0.24;
      } else {
        if (totalWeightOz > 1) postageEst += Math.ceil(totalWeightOz - 1) * 0.24;
      }
      if (totalWeightOz > 13) { mailClass = 'Package'; postageEst = 4.00; }
      const steps: string[] = [];
      steps.push('Envelope: ' + envW + ' x ' + envH + ' in');
      steps.push('Envelope weight: ~' + envWeightG.toFixed(1) + 'g (' + (envWeightG / 28.3495).toFixed(2) + ' oz)');
      steps.push('Paper: ' + pd[0] + ' x ' + pd[1] + ' in at ' + gsm + ' GSM');
      steps.push('Per sheet: ' + paperWeightG.toFixed(1) + 'g');
      steps.push('Contents: ' + pages + ' sheets x ' + paperWeightG.toFixed(1) + 'g = ' + contentsWeightG.toFixed(1) + 'g');
      steps.push('Total: ' + totalWeightG.toFixed(1) + 'g (' + totalWeightOz.toFixed(2) + ' oz)');
      steps.push('Printable area: ' + printW.toFixed(2) + ' x ' + printH.toFixed(2) + ' in');
      steps.push('Est. postage: ~$' + postageEst.toFixed(2) + ' (' + mailClass + ')');
      document.getElementById('env-result')!.textContent = totalWeightOz.toFixed(2) + ' oz';
      document.getElementById('env-postage')!.textContent = 'Est. postage: ~$' + postageEst.toFixed(2) + ' (' + mailClass + ')';
      document.getElementById('env-envwt')!.textContent = envWeightG.toFixed(1) + ' g';
      document.getElementById('env-contwt')!.textContent = contentsWeightG.toFixed(1) + ' g';
      document.getElementById('env-printarea')!.textContent = printW.toFixed(2) + ' x ' + printH.toFixed(2) + ' in';
      document.getElementById('env-class')!.textContent = mailClass;
      document.getElementById('env-steps')!.innerHTML = steps.map(s => '<div>' + s + '</div>').join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      (document.getElementById('env-width') as HTMLInputElement).value = '9.5';
      (document.getElementById('env-height') as HTMLInputElement).value = '4.125';
      (document.getElementById('env-pages') as HTMLInputElement).value = '3';
      (document.getElementById('env-gsm') as HTMLInputElement).value = '80';
      document.querySelectorAll('.env-in').forEach(el => { el.addEventListener('input', calcEnv); el.addEventListener('change', calcEnv); });
      calcEnv();
    }, 50);
  </script>
</CalculatorLayout>
