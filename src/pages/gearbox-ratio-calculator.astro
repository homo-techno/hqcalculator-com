---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Gearbox Ratio Calculator - Motor-to-Load Speed & Torque Matching";
const description = "Calculate optimal gearbox ratio for matching motor speed and torque to load requirements. Includes efficiency, reflected inertia, and output calculations.";
const relatedCalcs = [
  { name: "Servo Motor Calculator", url: "/servo-motor-calculator", description: "Size servo motors for robotic applications." },
  { name: "Harmonic Drive Calculator", url: "/harmonic-drive-calculator", description: "Calculate harmonic drive gear ratio and torque." },
  { name: "Stepper Motor Calculator", url: "/stepper-motor-calculator", description: "Calculate stepper motor torque curves." },
  { name: "Ball Screw Calculator", url: "/ball-screw-calculator", description: "Calculate ball screw lead and thrust." },
  { name: "Conveyor Speed Calculator", url: "/conveyor-speed-calculator", description: "Calculate conveyor motor power requirements." },
  { name: "Motion Profile Calculator", url: "/motion-profile-calculator", description: "Design trapezoidal motion profiles." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Gearbox Ratio Calculator" keywords="gearbox ratio calculator, gear reduction, motor to load matching, torque multiplication, speed reduction, gear ratio selection, inertia matching" breadcrumbs={[{ name: "Gearbox Ratio Calculator", url: "/gearbox-ratio-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Gearbox Ratio Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find the optimal gearbox reduction ratio to match motor output to load requirements. Calculate output torque, speed, and reflected inertia.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-6">
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Motor Rated Speed (RPM)</label>
          <input type="number" id="gbr-motor-rpm" class="gbr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3000" min="1" step="100">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Motor Rated Torque (N*m)</label>
          <input type="number" id="gbr-motor-torque" class="gbr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2.5" min="0.01" step="0.1">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Motor Rotor Inertia (kg*cm²)</label>
          <input type="number" id="gbr-motor-inertia" class="gbr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1.2" min="0.01" step="0.1">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Required Load Speed (RPM)</label>
          <input type="number" id="gbr-load-rpm" class="gbr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="100" min="1" step="10">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Required Load Torque (N*m)</label>
          <input type="number" id="gbr-load-torque" class="gbr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="50" min="0.1" step="1">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Load Inertia (kg*cm²)</label>
          <input type="number" id="gbr-load-inertia" class="gbr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="100" min="0.01" step="1">
        </div>
        <div>
          <label class="block text-sm font-semibold text-text mb-2">Gearbox Efficiency (%)</label>
          <input type="number" id="gbr-eff" class="gbr-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="95" min="50" max="100" step="1">
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm font-medium opacity-80 mb-1">Required Gear Ratio</div>
          <div id="gbr-result-ratio" class="text-3xl sm:text-4xl font-extrabold">--</div>
          <div class="text-sm opacity-80 mt-1">:1 reduction</div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary mb-1">Output Torque (at ratio)</div>
            <div id="gbr-output-torque" class="text-lg font-bold text-text">--</div>
            <div class="text-xs text-text-secondary">N*m</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary mb-1">Output Speed</div>
            <div id="gbr-output-speed" class="text-lg font-bold text-text">--</div>
            <div class="text-xs text-text-secondary">RPM</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary mb-1">Reflected Inertia</div>
            <div id="gbr-reflected" class="text-lg font-bold text-text">--</div>
            <div class="text-xs text-text-secondary">kg*cm²</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-secondary mb-1">Inertia Match Ratio</div>
            <div id="gbr-inertia-match" class="text-lg font-bold text-text">--</div>
            <div class="text-xs text-text-secondary">reflected/motor</div>
          </div>
        </div>

        <ShareButton />
        <FeedbackWidget />
      </div>
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcGBR() {
      const motorRPM = parseFloat((document.getElementById('gbr-motor-rpm') as HTMLInputElement).value) || 3000;
      const motorTorque = parseFloat((document.getElementById('gbr-motor-torque') as HTMLInputElement).value) || 2.5;
      const motorInertia = parseFloat((document.getElementById('gbr-motor-inertia') as HTMLInputElement).value) || 1.2;
      const loadRPM = parseFloat((document.getElementById('gbr-load-rpm') as HTMLInputElement).value) || 100;
      const loadTorque = parseFloat((document.getElementById('gbr-load-torque') as HTMLInputElement).value) || 50;
      const loadInertia = parseFloat((document.getElementById('gbr-load-inertia') as HTMLInputElement).value) || 100;
      const eff = parseFloat((document.getElementById('gbr-eff') as HTMLInputElement).value) / 100 || 0.95;

      const ratioBySpeed = motorRPM / loadRPM;
      const ratioByTorque = loadTorque / (motorTorque * eff);
      const requiredRatio = Math.max(ratioBySpeed, ratioByTorque);

      const outputTorque = motorTorque * requiredRatio * eff;
      const outputSpeed = motorRPM / requiredRatio;
      const reflectedInertia = loadInertia / (requiredRatio * requiredRatio);
      const inertiaMatch = reflectedInertia / motorInertia;

      document.getElementById('gbr-result-ratio')!.textContent = requiredRatio.toFixed(2);
      document.getElementById('gbr-output-torque')!.textContent = outputTorque.toFixed(2);
      document.getElementById('gbr-output-speed')!.textContent = outputSpeed.toFixed(1);
      document.getElementById('gbr-reflected')!.textContent = reflectedInertia.toFixed(3);
      document.getElementById('gbr-inertia-match')!.textContent = inertiaMatch.toFixed(2) + ':1';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.gbr-in').forEach(el => { el.addEventListener('input', calcGBR); el.addEventListener('change', calcGBR); });
      calcGBR();
    }, 50);
  </script>
</CalculatorLayout>
