---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Blood Volume Calculator - Nadler's Equation";
const description = "Estimate total blood volume using Nadler's equation based on height, weight, and sex. Shows plasma and red cell volumes.";
const relatedCalcs = [
  { name: "Body Surface Area Calculator", url: "/body-surface-area-calculator", description: "BSA calculation." },
  { name: "Body Water Calculator", url: "/body-water-calculator", description: "Total body water." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body mass index." },
  { name: "Creatinine Clearance Calculator", url: "/creatinine-clearance-calculator", description: "Kidney function." },
  { name: "A1C Calculator", url: "/a1c-calculator", description: "HbA1c conversion." },
  { name: "Blood Donation Calculator", url: "/blood-donation-calculator", description: "Donation eligibility." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Blood Volume Calculator" keywords="blood volume, Nadler equation, plasma volume, red cell volume, hematocrit" breadcrumbs={[{ name: "Blood Volume", url: "/blood-volume-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Blood Volume Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate total blood volume using Nadler's equation.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Sex</label>
          <select id="bv-sex" class="bv-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="male" selected>Male</option>
            <option value="female">Female</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Height (cm)</label><input type="number" id="bv-ht" class="bv-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="175" min="50" max="250" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Weight (kg)</label><input type="number" id="bv-wt" class="bv-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="75" min="10" max="300" step="0.1"></div>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Hematocrit (%)</label>
          <input type="number" id="bv-hct" class="bv-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="45" min="10" max="70" step="1">
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Blood Volume</div>
          <div class="text-5xl font-extrabold font-mono" id="bv-total">0</div>
          <div class="text-sm text-blue-200 mt-1">liters</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Plasma Volume</div><div class="text-xl font-bold" id="bv-plasma">0 L</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Red Cell Volume</div><div class="text-xl font-bold" id="bv-rbc">0 L</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">mL per kg</div><div class="text-xl font-bold" id="bv-mlkg">0</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Normal Blood Volume</h3>
          <div class="grid grid-cols-2 gap-2 text-sm">
            <div class="flex justify-between"><span>Adult male</span><span class="font-bold">~5.0 L (70 mL/kg)</span></div>
            <div class="flex justify-between"><span>Adult female</span><span class="font-bold">~4.0 L (65 mL/kg)</span></div>
            <div class="flex justify-between"><span>Newborn</span><span class="font-bold">~80 mL/kg</span></div>
            <div class="flex justify-between"><span>Pregnant</span><span class="font-bold">~100 mL/kg</span></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="blood-volume" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Nadler's Equation</h2>
      <p>Nadler's equation estimates total blood volume. For males: BV = 0.3669 x H³ + 0.03219 x W + 0.6041. For females: BV = 0.3561 x H³ + 0.03308 x W + 0.1833. Height is in meters, weight in kg, and result in liters.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcBV() {
      const sex = (document.getElementById('bv-sex') as HTMLSelectElement).value;
      const ht = parseFloat((document.getElementById('bv-ht') as HTMLInputElement).value) || 0;
      const wt = parseFloat((document.getElementById('bv-wt') as HTMLInputElement).value) || 0;
      const hct = parseFloat((document.getElementById('bv-hct') as HTMLInputElement).value) || 45;
      const hm = ht / 100;
      let bv: number;
      if (sex === 'male') {
        bv = 0.3669 * Math.pow(hm, 3) + 0.03219 * wt + 0.6041;
      } else {
        bv = 0.3561 * Math.pow(hm, 3) + 0.03308 * wt + 0.1833;
      }
      const plasma = bv * (1 - hct / 100);
      const rbc = bv * (hct / 100);
      const mlkg = wt > 0 ? (bv * 1000) / wt : 0;
      document.getElementById('bv-total')!.textContent = bv.toFixed(2);
      document.getElementById('bv-plasma')!.textContent = plasma.toFixed(2) + ' L';
      document.getElementById('bv-rbc')!.textContent = rbc.toFixed(2) + ' L';
      document.getElementById('bv-mlkg')!.textContent = mlkg.toFixed(0);
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.bv-in').forEach(el => { el.addEventListener('input', calcBV); el.addEventListener('change', calcBV); });
      calcBV();
    }, 50);
  </script>
</CalculatorLayout>
