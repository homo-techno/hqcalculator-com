---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Square Root Calculator - Free √ Calculator Online";
const description = "Calculate square roots, cube roots, and nth roots instantly. Perfect squares table, simplification, and step-by-step solutions.";

const relatedCalcs = [
  { name: "Exponent Calculator", url: "/exponent-calculator", description: "Powers and exponents." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math operations." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Calculate percentages." },
  { name: "Fraction Calculator", url: "/fraction-calculator", description: "Fraction operations." },
  { name: "Logarithm Calculator", url: "/logarithm-calculator", description: "Log and natural log." },
  { name: "LCM Calculator", url: "/lcm-calculator", description: "Least common multiple." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Square Root Calculator"
  keywords="square root calculator, sqrt calculator, cube root, nth root, perfect squares, radical calculator"
  breadcrumbs={[{ name: "Square Root Calculator", url: "/square-root-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Square Root Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate square roots, cube roots, and any nth root. See simplified radical forms and step-by-step solutions.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Mode Toggle -->
      <div class="flex gap-2 mb-6">
        <button class="sqrt-mode-btn px-4 py-2 rounded-full text-sm font-semibold bg-primary text-white" data-mode="sqrt">Square Root (√)</button>
        <button class="sqrt-mode-btn px-4 py-2 rounded-full text-sm font-semibold bg-surface-alt text-text-secondary" data-mode="cbrt">Cube Root (∛)</button>
        <button class="sqrt-mode-btn px-4 py-2 rounded-full text-sm font-semibold bg-surface-alt text-text-secondary" data-mode="nth">Nth Root</button>
      </div>

      <div class="flex items-center gap-4 mb-6">
        <div class="flex-1">
          <label class="block text-sm font-medium text-text mb-1">Number</label>
          <input type="number" id="sqrt-num" class="w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="144" step="any">
        </div>
        <div class="hidden" id="sqrt-nth-wrap">
          <label class="block text-sm font-medium text-text mb-1">Root</label>
          <input type="number" id="sqrt-nth" class="w-24 px-4 py-3 border border-border rounded-xl text-2xl font-bold text-center" value="4" min="2" max="100">
        </div>
      </div>

      <!-- Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="sqrt-label">√144 =</div>
        <div class="text-5xl font-extrabold" id="sqrt-result">12</div>
      </div>

      <div class="grid grid-cols-2 gap-3 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Decimal</div>
          <div class="text-xl font-bold" id="sqrt-decimal">12</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Perfect?</div>
          <div class="text-xl font-bold" id="sqrt-perfect">Yes ✓</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Simplified</div>
          <div class="text-xl font-bold" id="sqrt-simplified">12</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Squared</div>
          <div class="text-xl font-bold" id="sqrt-squared">144</div>
        </div>
      </div>

      <ShareButton calculatorId="square-root" />
      <FeedbackWidget />
    </div>

    <!-- Batch Calculator -->
    <div class="mt-12 bg-white border border-border rounded-2xl p-6 sm:p-8 max-w-2xl mx-auto">
      <h2 class="text-2xl font-bold text-text mb-4">Batch Square Root Calculator</h2>
      <p class="text-sm text-text-secondary mb-4">Enter multiple numbers separated by commas:</p>
      <input type="text" id="sqrt-batch" class="w-full px-4 py-3 border border-border rounded-xl text-lg mb-4" placeholder="4, 9, 16, 25, 36, 49, 64" value="4, 9, 16, 25, 36, 49, 64">
      <div id="sqrt-batch-results" class="grid grid-cols-2 sm:grid-cols-4 gap-2"></div>
    </div>

    <!-- Perfect Squares Table -->
    <div class="mt-12 bg-white border border-border rounded-2xl p-6 sm:p-8">
      <h2 class="text-2xl font-bold text-text mb-4">Perfect Squares (1-30)</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-border text-left">
              <th class="py-2 pr-3 font-semibold">n</th>
              <th class="py-2 pr-3 font-semibold">n²</th>
              <th class="py-2 pr-3 font-semibold">√n²</th>
              <th class="py-2 pr-3 font-semibold">n</th>
              <th class="py-2 pr-3 font-semibold">n²</th>
              <th class="py-2 font-semibold">√n²</th>
            </tr>
          </thead>
          <tbody class="text-text-secondary" id="sqrt-table"></tbody>
        </table>
      </div>
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">How Square Roots Work</h2>
      <p>The square root of a number x is a value y such that y² = x. For example, √144 = 12 because 12² = 144. The symbol √ is called a radical sign.</p>

      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">
        √x = x<sup>1/2</sup> &nbsp;&nbsp;|&nbsp;&nbsp; ∛x = x<sup>1/3</sup> &nbsp;&nbsp;|&nbsp;&nbsp; ⁿ√x = x<sup>1/n</sup>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Simplifying Square Roots</h3>
      <p>To simplify √72: find the largest perfect square factor. 72 = 36 × 2, so √72 = √36 × √2 = 6√2.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Properties of Square Roots</h3>
      <ul>
        <li>√(a × b) = √a × √b</li>
        <li>√(a / b) = √a / √b</li>
        <li>(√a)² = a</li>
        <li>√a² = |a| (absolute value)</li>
        <li>Square root of a negative number is imaginary: √(-1) = i</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What is a perfect square?</strong> A perfect square is an integer that is the square of another integer. Examples: 1, 4, 9, 16, 25, 36, 49, 64, 81, 100.</p>
      <p><strong>Can you take the square root of a negative number?</strong> Not in real numbers. The square root of a negative number involves imaginary numbers (i = √−1). For example, √−9 = 3i.</p>
      <p><strong>How do I estimate square roots?</strong> Find the two perfect squares the number falls between. √50 is between √49 (7) and √64 (8), closer to 7. Actual: 7.07.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let sqrtMode = 'sqrt';

    function simplifySquareRoot(n: number): { outside: number; inside: number } {
      if (n < 0) return { outside: 0, inside: n };
      let outside = 1;
      let inside = n;
      for (let i = Math.floor(Math.sqrt(n)); i >= 2; i--) {
        if (inside % (i * i) === 0) {
          outside *= i;
          inside /= (i * i);
          break;
        }
      }
      return { outside, inside };
    }

    function calcSqrt() {
      const num = parseFloat((document.getElementById('sqrt-num') as HTMLInputElement).value);
      if (isNaN(num)) return;

      let rootN = 2;
      if (sqrtMode === 'cbrt') rootN = 3;
      else if (sqrtMode === 'nth') rootN = parseInt((document.getElementById('sqrt-nth') as HTMLInputElement).value) || 2;

      const result = num < 0 && rootN % 2 === 0 ? NaN : Math.pow(Math.abs(num), 1 / rootN) * (num < 0 ? -1 : 1);
      const isWhole = Math.abs(result - Math.round(result)) < 1e-10;
      const displayResult = isWhole ? String(Math.round(result)) : result.toFixed(8).replace(/0+$/, '');

      // Label
      const rootSymbol = rootN === 2 ? '√' : rootN === 3 ? '∛' : `${rootN}√`;
      document.getElementById('sqrt-label')!.textContent = `${rootSymbol}${num} =`;
      document.getElementById('sqrt-result')!.textContent = isNaN(result) ? 'Undefined' : displayResult;
      document.getElementById('sqrt-decimal')!.textContent = isNaN(result) ? '—' : result.toFixed(6);
      document.getElementById('sqrt-perfect')!.textContent = isWhole && !isNaN(result) ? 'Yes ✓' : 'No';
      document.getElementById('sqrt-squared')!.textContent = isNaN(result) ? '—' : (Math.round(result) ** rootN === num ? String(num) : (result ** rootN).toFixed(2));

      // Simplified form (only for square root of positive integers)
      if (rootN === 2 && num > 0 && Number.isInteger(num)) {
        const s = simplifySquareRoot(num);
        if (s.inside === 1) {
          document.getElementById('sqrt-simplified')!.textContent = String(s.outside);
        } else if (s.outside === 1) {
          document.getElementById('sqrt-simplified')!.textContent = `√${s.inside}`;
        } else {
          document.getElementById('sqrt-simplified')!.textContent = `${s.outside}√${s.inside}`;
        }
      } else {
        document.getElementById('sqrt-simplified')!.textContent = displayResult;
      }

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    function calcBatch() {
      const input = (document.getElementById('sqrt-batch') as HTMLInputElement).value;
      const nums = input.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
      const container = document.getElementById('sqrt-batch-results')!;
      container.innerHTML = nums.map(n => {
        const r = Math.sqrt(n);
        return `<div class="p-2 bg-surface-alt rounded-lg text-center">
          <div class="text-xs text-text-muted">√${n}</div>
          <div class="font-bold">${Math.abs(r - Math.round(r)) < 1e-10 ? Math.round(r) : r.toFixed(4)}</div>
        </div>`;
      }).join('');
    }

    function buildTable() {
      const tbody = document.getElementById('sqrt-table')!;
      let html = '';
      for (let i = 1; i <= 15; i++) {
        const j = i + 15;
        html += `<tr class="border-b border-border/30">
          <td class="py-1.5 pr-3 font-medium">${i}</td>
          <td class="py-1.5 pr-3">${i * i}</td>
          <td class="py-1.5 pr-3 text-primary">${i}</td>
          <td class="py-1.5 pr-3 font-medium">${j}</td>
          <td class="py-1.5 pr-3">${j * j}</td>
          <td class="py-1.5 text-primary">${j}</td>
        </tr>`;
      }
      tbody.innerHTML = html;
    }

    setTimeout(() => {
      // Mode toggle
      document.querySelectorAll('.sqrt-mode-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.sqrt-mode-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-surface-alt', 'text-text-secondary');
          });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary');
          btn.classList.add('bg-primary', 'text-white');
          sqrtMode = (btn as HTMLElement).dataset.mode || 'sqrt';
          document.getElementById('sqrt-nth-wrap')!.classList.toggle('hidden', sqrtMode !== 'nth');
          calcSqrt();
        });
      });

      document.getElementById('sqrt-num')!.addEventListener('input', calcSqrt);
      document.getElementById('sqrt-nth')!.addEventListener('input', calcSqrt);
      document.getElementById('sqrt-batch')!.addEventListener('input', calcBatch);

      calcSqrt();
      calcBatch();
      buildTable();
    }, 50);
  </script>
</CalculatorLayout>
