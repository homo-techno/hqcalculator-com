---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Electricity Cost Calculator - Energy Usage & Bill Estimator";
const description = "Calculate electricity costs for appliances and devices. Estimate monthly and annual energy bills based on wattage, usage hours, and kWh rate.";

const relatedCalcs = [
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Savings Calculator", url: "/savings-calculator", description: "Savings growth." },
  { name: "Salary Calculator", url: "/salary-calculator", description: "Salary breakdown." },
  { name: "Inflation Calculator", url: "/inflation-calculator", description: "Purchasing power." },
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume." },
  { name: "Square Footage", url: "/square-footage-calculator", description: "Area calculator." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Electricity Cost Calculator"
  keywords="electricity cost calculator, energy calculator, kWh calculator, electricity bill, power consumption, appliance cost"
  breadcrumbs={[{ name: "Electricity Cost", url: "/electricity-cost-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Electricity Cost Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate how much it costs to run any appliance based on wattage, usage, and your electricity rate.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-2">Common Appliances (Quick Fill)</label>
            <select id="ec-preset" class="w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="">— Select an appliance —</option>
              <option value="60">LED Light Bulb (10W equiv 60W)</option>
              <option value="1500">Space Heater</option>
              <option value="1000">Hair Dryer</option>
              <option value="150">TV (50-inch LED)</option>
              <option value="300">Desktop Computer</option>
              <option value="50">Laptop</option>
              <option value="100">WiFi Router</option>
              <option value="500">Refrigerator</option>
              <option value="2000">Oven / Range</option>
              <option value="5000">Central AC</option>
              <option value="1200">Dishwasher</option>
              <option value="500">Washing Machine</option>
              <option value="3000">Clothes Dryer</option>
              <option value="1800">Microwave</option>
              <option value="1500">Coffee Maker</option>
              <option value="700">Gaming Console</option>
              <option value="400">Ceiling Fan</option>
              <option value="1500">Pool Pump</option>
              <option value="4000">EV Charger (Level 2)</option>
            </select>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-1">Power Consumption</label>
            <div class="flex gap-2">
              <input type="number" id="ec-watts" class="flex-1 px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="1500" min="0" step="10">
              <span class="self-center text-text-muted font-bold text-lg">Watts</span>
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-1">Usage</label>
            <div class="flex gap-2">
              <input type="number" id="ec-hours" class="flex-1 px-4 py-3 border border-border rounded-xl text-lg" value="8" min="0" max="24" step="0.5">
              <span class="self-center text-text-muted font-semibold">hours/day</span>
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-text mb-1">Electricity Rate</label>
            <div class="flex gap-2">
              <input type="number" id="ec-rate" class="flex-1 px-4 py-3 border border-border rounded-xl text-lg" value="0.16" min="0" max="1" step="0.01">
              <span class="self-center text-text-muted font-semibold">$/kWh</span>
            </div>
            <div class="flex gap-1 mt-2 flex-wrap">
              <button class="ec-rate-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-rate="0.10">Low ($0.10)</button>
              <button class="ec-rate-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-rate="0.16">US Avg ($0.16)</button>
              <button class="ec-rate-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-rate="0.25">High ($0.25)</button>
              <button class="ec-rate-btn px-2 py-1 text-xs rounded-lg border border-border hover:bg-surface-alt" data-rate="0.35">CA/NY ($0.35)</button>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Monthly Cost</div>
            <div class="text-4xl sm:text-5xl font-extrabold" id="ec-monthly">$0</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Daily Cost</div>
              <div class="text-xl font-bold" id="ec-daily">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Annual Cost</div>
              <div class="text-xl font-bold text-secondary" id="ec-annual">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">kWh/Day</div>
              <div class="text-xl font-bold" id="ec-kwh-day">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">kWh/Month</div>
              <div class="text-xl font-bold" id="ec-kwh-month">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">kWh/Year</div>
              <div class="text-xl font-bold" id="ec-kwh-year">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Cost/Hour</div>
              <div class="text-xl font-bold" id="ec-hourly">$0</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Multi-appliance -->
      <div class="mt-8 p-4 bg-surface-alt rounded-xl">
        <h3 class="font-semibold text-text mb-3">Multi-Appliance Calculator</h3>
        <div id="ec-items" class="space-y-2 mb-3"></div>
        <button id="ec-add" class="px-4 py-2 border border-border rounded-xl text-sm font-semibold hover:bg-white">+ Add Appliance</button>
        <div class="mt-3 flex justify-between items-center">
          <span class="text-text-muted text-sm">Total Monthly:</span>
          <span class="text-2xl font-bold text-secondary" id="ec-multi-total">$0</span>
        </div>
      </div>

      <ShareButton calculatorId="electricity" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Electricity Cost</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">
        Daily kWh = Watts × Hours/Day ÷ 1000<br>
        Monthly Cost = Daily kWh × 30 × Rate ($/kWh)
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Common Appliance Costs (at $0.16/kWh)</h3>
      <ul>
        <li><strong>LED Bulb (10W, 8 hrs):</strong> ~$0.47/month</li>
        <li><strong>Refrigerator (500W, 24/7):</strong> ~$58/month</li>
        <li><strong>Central AC (5kW, 8 hrs):</strong> ~$192/month</li>
        <li><strong>EV Charger (4kW, 3 hrs):</strong> ~$58/month</li>
        <li><strong>Desktop PC (300W, 10 hrs):</strong> ~$14/month</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Tips to Save on Electricity</h3>
      <ul>
        <li>Switch to LED bulbs — 75% less energy than incandescent</li>
        <li>Unplug electronics when not in use (vampire power)</li>
        <li>Use a programmable thermostat for heating/cooling</li>
        <li>Run dishwasher and laundry during off-peak hours</li>
        <li>Consider time-of-use rates from your utility company</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What is a kWh?</strong> A kilowatt-hour (kWh) is the standard unit of energy. It equals using 1,000 watts for one hour (e.g., a 100W bulb for 10 hours).</p>
      <p><strong>What's the average electricity rate?</strong> The US average is about $0.16/kWh, but ranges from $0.10 (LA, TX) to $0.35+ (CA, CT, HI).</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const multiItems: { name: string; watts: number; hours: number }[] = [];

    function calcElectricity() {
      const watts = parseFloat((document.getElementById('ec-watts') as HTMLInputElement).value) || 0;
      const hours = parseFloat((document.getElementById('ec-hours') as HTMLInputElement).value) || 0;
      const rate = parseFloat((document.getElementById('ec-rate') as HTMLInputElement).value) || 0;

      const kwhDay = watts * hours / 1000;
      const kwhMonth = kwhDay * 30;
      const kwhYear = kwhDay * 365;
      const dailyCost = kwhDay * rate;
      const monthlyCost = kwhMonth * rate;
      const annualCost = kwhYear * rate;
      const hourlyCost = (watts / 1000) * rate;

      const fmtMoney = (n: number) => '$' + n.toFixed(2);

      document.getElementById('ec-monthly')!.textContent = fmtMoney(monthlyCost);
      document.getElementById('ec-daily')!.textContent = fmtMoney(dailyCost);
      document.getElementById('ec-annual')!.textContent = fmtMoney(annualCost);
      document.getElementById('ec-kwh-day')!.textContent = kwhDay.toFixed(2);
      document.getElementById('ec-kwh-month')!.textContent = kwhMonth.toFixed(1);
      document.getElementById('ec-kwh-year')!.textContent = Math.round(kwhYear).toLocaleString();
      document.getElementById('ec-hourly')!.textContent = fmtMoney(hourlyCost);

      // Multi-appliance total
      const multiTotal = multiItems.reduce((sum, item) => {
        return sum + (item.watts * item.hours / 1000 * 30 * rate);
      }, 0);
      document.getElementById('ec-multi-total')!.textContent = fmtMoney(multiTotal + monthlyCost);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    function renderMulti() {
      const rate = parseFloat((document.getElementById('ec-rate') as HTMLInputElement).value) || 0;
      document.getElementById('ec-items')!.innerHTML = multiItems.length === 0
        ? '<div class="text-text-muted text-sm">No additional appliances added</div>'
        : multiItems.map((item, i) => {
          const cost = item.watts * item.hours / 1000 * 30 * rate;
          return `<div class="flex items-center justify-between gap-2 py-2 px-3 bg-white rounded-lg">
            <span class="font-medium text-sm">${item.name}</span>
            <span class="text-text-muted text-xs">${item.watts}W × ${item.hours}h</span>
            <span class="font-bold text-sm">$${cost.toFixed(2)}/mo</span>
            <button class="ec-rm text-danger text-xs hover:underline" data-idx="${i}">×</button>
          </div>`;
        }).join('');

      document.querySelectorAll('.ec-rm').forEach(btn => {
        btn.addEventListener('click', () => {
          multiItems.splice(parseInt((btn as HTMLElement).dataset.idx || '0'), 1);
          renderMulti();
          calcElectricity();
        });
      });
    }

    setTimeout(() => {
      document.getElementById('ec-preset')!.addEventListener('change', (e) => {
        const val = (e.target as HTMLSelectElement).value;
        if (val) (document.getElementById('ec-watts') as HTMLInputElement).value = val;
        calcElectricity();
      });

      document.querySelectorAll('.ec-rate-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          (document.getElementById('ec-rate') as HTMLInputElement).value = (btn as HTMLElement).dataset.rate || '0.16';
          calcElectricity();
        });
      });

      ['ec-watts', 'ec-hours', 'ec-rate'].forEach(id => document.getElementById(id)!.addEventListener('input', calcElectricity));

      document.getElementById('ec-add')!.addEventListener('click', () => {
        const watts = parseFloat((document.getElementById('ec-watts') as HTMLInputElement).value) || 0;
        const hours = parseFloat((document.getElementById('ec-hours') as HTMLInputElement).value) || 0;
        const preset = (document.getElementById('ec-preset') as HTMLSelectElement);
        const name = preset.selectedOptions[0]?.text || `${watts}W Appliance`;
        if (watts > 0) {
          multiItems.push({ name, watts, hours });
          renderMulti();
          calcElectricity();
        }
      });

      renderMulti();
      calcElectricity();
    }, 50);
  </script>
</CalculatorLayout>
