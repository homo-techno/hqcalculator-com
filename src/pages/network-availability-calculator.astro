---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Network Availability Calculator - Uptime Nines Calculator 2026";
const description = "Calculate network uptime and downtime from availability percentage (nines). Convert between 99.9%, 99.99%, and other availability levels to actual downtime per year, month, week, and day.";

const relatedCalcs = [
  { name: "Bandwidth Calculator", url: "/bandwidth-calculator", description: "Network bandwidth requirements." },
  { name: "Network Throughput Calculator", url: "/network-throughput-calculator", description: "TCP throughput estimation." },
  { name: "Network Latency Calculator", url: "/network-latency-calculator", description: "Round-trip latency estimation." },
  { name: "Data Transfer Calculator", url: "/data-transfer-calculator", description: "File transfer time estimation." },
  { name: "Ethernet Cable Calculator", url: "/ethernet-cable-calculator", description: "Ethernet cable specifications." },
  { name: "IP Subnet Calculator", url: "/ip-subnet-calculator", description: "IP subnetting and CIDR." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Network Availability Calculator"
  keywords="network availability calculator, uptime calculator, nines calculator, SLA, downtime, 99.99% uptime, high availability"
  breadcrumbs={[{ name: "Network Availability Calculator", url: "/network-availability-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Network Availability Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert between availability percentage and actual downtime. Understand what "five nines" really means for your SLA.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Quick Select</label>
        <div class="flex flex-wrap gap-2 mb-3">
          <button class="nav-pct-btn px-3 py-1.5 rounded-lg text-sm font-semibold bg-surface-alt text-text-secondary border border-border hover:border-primary/30" data-pct="99">2 Nines</button>
          <button class="nav-pct-btn px-3 py-1.5 rounded-lg text-sm font-semibold bg-surface-alt text-text-secondary border border-border hover:border-primary/30" data-pct="99.9">3 Nines</button>
          <button class="nav-pct-btn px-3 py-1.5 rounded-lg text-sm font-semibold bg-primary text-white border border-primary" data-pct="99.99">4 Nines</button>
          <button class="nav-pct-btn px-3 py-1.5 rounded-lg text-sm font-semibold bg-surface-alt text-text-secondary border border-border hover:border-primary/30" data-pct="99.999">5 Nines</button>
          <button class="nav-pct-btn px-3 py-1.5 rounded-lg text-sm font-semibold bg-surface-alt text-text-secondary border border-border hover:border-primary/30" data-pct="99.9999">6 Nines</button>
        </div>
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-text mb-1">Availability (%)</label>
        <input type="number" id="nav-avail" class="nav-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="99.99" step="0.001" min="0" max="100">
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm font-medium text-blue-100 mb-1">Annual Downtime</div>
        <div class="text-4xl font-extrabold" id="nav-annual">--</div>
      </div>

      <!-- Downtime breakdown -->
      <div class="space-y-2 mb-6">
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Downtime per Year</span>
          <span class="font-bold text-text" id="nav-year">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Downtime per Month</span>
          <span class="font-bold text-text" id="nav-month">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Downtime per Week</span>
          <span class="font-bold text-text" id="nav-week">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Downtime per Day</span>
          <span class="font-bold text-text" id="nav-day">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Nines Level</span>
          <span class="font-bold text-text" id="nav-nines">--</span>
        </div>
        <div class="flex justify-between items-center p-3 bg-surface-alt rounded-xl">
          <span class="text-sm text-text-secondary">Uptime per Year</span>
          <span class="font-bold text-text" id="nav-uptime">--</span>
        </div>
      </div>

      <!-- Comparison table -->
      <div class="bg-surface-alt rounded-xl p-4 mb-6">
        <h3 class="font-semibold text-text mb-3 text-sm">Availability Levels Comparison</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead><tr class="text-text-muted text-xs uppercase"><th class="pb-2 text-left">Level</th><th class="pb-2 text-left">Availability</th><th class="pb-2 text-right">Annual Downtime</th></tr></thead>
            <tbody id="nav-table"></tbody>
          </table>
        </div>
      </div>

      <ShareButton calculatorId="network-availability" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Understanding Availability Nines</h2>
      <p>Network availability is commonly expressed as a percentage, often referred to by the number of nines. Each additional nine dramatically reduces the allowed downtime.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono text-sm">
        Downtime = Total_time x (1 - Availability/100)
        <br>Annual Downtime = 365.25 x 24 x 60 x (1 - Availability/100) minutes
      </div>
      <p>Moving from 99.9% to 99.99% availability means reducing downtime from 8.77 hours/year to 52.6 minutes/year - a 10x improvement that typically requires significant infrastructure investment.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function formatDuration(minutes: number): string {
      if (minutes < 1/60) return (minutes * 3600).toFixed(2) + ' seconds';
      if (minutes < 1) return (minutes * 60).toFixed(2) + ' seconds';
      if (minutes < 60) return minutes.toFixed(2) + ' minutes';
      if (minutes < 1440) {
        const h = Math.floor(minutes / 60);
        const m = Math.floor(minutes % 60);
        return h + 'h ' + m + 'm';
      }
      const d = Math.floor(minutes / 1440);
      const h = Math.floor((minutes % 1440) / 60);
      return d + 'd ' + h + 'h';
    }

    function calcNAV() {
      const avail = parseFloat((document.getElementById('nav-avail') as HTMLInputElement).value) || 99.99;
      const unavail = (100 - avail) / 100;

      const yearMin = 365.25 * 24 * 60;
      const monthMin = yearMin / 12;
      const weekMin = 7 * 24 * 60;
      const dayMin = 24 * 60;

      const downYear = yearMin * unavail;
      const downMonth = monthMin * unavail;
      const downWeek = weekMin * unavail;
      const downDay = dayMin * unavail;
      const uptimeYear = yearMin * (avail / 100);

      // Count nines
      let nines = 0;
      let test = avail;
      if (test >= 100) nines = Infinity;
      else {
        const s = avail.toString();
        // Count continuous nines after potential leading digits
        const match = s.match(/^(\d*\.?)(9*)/);
        if (match) {
          const afterDot = s.includes('.') ? s.split('.')[1] || '' : '';
          const beforeDot = s.split('.')[0];
          if (beforeDot === '100') nines = Infinity;
          else {
            // Count nines: e.g. 99.999 = 5 nines
            let count = 0;
            for (const c of (beforeDot + afterDot)) {
              if (c === '9') count++; else break;
            }
            nines = count;
          }
        }
      }

      document.getElementById('nav-annual')!.textContent = formatDuration(downYear);
      document.getElementById('nav-year')!.textContent = formatDuration(downYear);
      document.getElementById('nav-month')!.textContent = formatDuration(downMonth);
      document.getElementById('nav-week')!.textContent = formatDuration(downWeek);
      document.getElementById('nav-day')!.textContent = formatDuration(downDay);
      document.getElementById('nav-nines')!.textContent = nines === Infinity ? 'Infinite (100%)' : nines + ' nines (' + avail + '%)';
      document.getElementById('nav-uptime')!.textContent = formatDuration(uptimeYear);

      // Button highlighting
      document.querySelectorAll('.nav-pct-btn').forEach(btn => {
        const pct = parseFloat((btn as HTMLElement).dataset.pct || '0');
        if (Math.abs(pct - avail) < 0.0001) {
          btn.classList.remove('bg-surface-alt', 'text-text-secondary', 'border-border');
          btn.classList.add('bg-primary', 'text-white', 'border-primary');
        } else {
          btn.classList.remove('bg-primary', 'text-white', 'border-primary');
          btn.classList.add('bg-surface-alt', 'text-text-secondary', 'border-border');
        }
      });

      // Comparison table
      const levels = [
        { name: '1 Nine', pct: 90 },
        { name: '2 Nines', pct: 99 },
        { name: '3 Nines', pct: 99.9 },
        { name: '3.5 Nines', pct: 99.95 },
        { name: '4 Nines', pct: 99.99 },
        { name: '5 Nines', pct: 99.999 },
        { name: '6 Nines', pct: 99.9999 },
      ];
      const tbody = document.getElementById('nav-table')!;
      tbody.innerHTML = levels.map(l => {
        const dt = yearMin * (1 - l.pct / 100);
        const active = Math.abs(l.pct - avail) < 0.0001;
        return '<tr class="' + (active ? 'font-bold text-primary' : 'text-text-secondary') + ' border-b border-border/20"><td class="py-1.5">' + l.name + '</td><td class="py-1.5">' + l.pct + '%</td><td class="py-1.5 text-right">' + formatDuration(dt) + '</td></tr>';
      }).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.nav-in').forEach(el => { el.addEventListener('input', calcNAV); el.addEventListener('change', calcNAV); });
      document.querySelectorAll('.nav-pct-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          (document.getElementById('nav-avail') as HTMLInputElement).value = (btn as HTMLElement).dataset.pct || '99.99';
          calcNAV();
        });
      });
      calcNAV();
    }, 50);
  </script>
</CalculatorLayout>
