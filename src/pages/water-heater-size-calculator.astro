---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Water Heater Size Calculator - Tank Size & First Hour Rating";
const description = "Calculate the right water heater tank size based on household occupancy, usage patterns, first hour rating, recovery rate, and energy comparison.";
const relatedCalcs = [
  { name: "Tankless Water Heater", url: "/tankless-water-heater-calculator", description: "Size a tankless unit." },
  { name: "Water Usage", url: "/water-usage-calculator", description: "Estimate daily water use." },
  { name: "Electricity Bill", url: "/electricity-bill-calculator", description: "Estimate electric costs." },
  { name: "HVAC Calculator", url: "/hvac-calculator", description: "Heating and cooling sizing." },
  { name: "Heat Pump", url: "/heat-pump-calculator", description: "Heat pump efficiency." },
  { name: "Insulation Calculator", url: "/insulation-calculator", description: "Home insulation needs." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Water Heater Size Calculator" keywords="water heater size, tank size calculator, first hour rating, recovery rate, hot water heater sizing" breadcrumbs={[{ name: "Water Heater Size", url: "/water-heater-size-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Water Heater Size Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find the right water heater tank size based on your household size, usage habits, and peak demand.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Number of People in Household</label>
          <input type="number" id="wh2-people" class="wh2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="4" min="1" max="20" step="1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Number of Bathrooms</label>
          <input type="number" id="wh2-baths" class="wh2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="1" max="10" step="1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Peak Hour Usage Pattern</label>
          <select id="wh2-usage" class="wh2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="low">Low - Staggered showers, few appliances</option>
            <option value="medium" selected>Medium - Some overlap, dishwasher</option>
            <option value="high">High - Simultaneous showers + laundry</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Inlet Water Temperature (&deg;F)</label>
          <input type="number" id="wh2-inlet" class="wh2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="55" min="35" max="80" step="1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Desired Hot Water Temperature (&deg;F)</label>
          <input type="number" id="wh2-target" class="wh2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="120" min="100" max="160" step="5">
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Tank Size</div>
          <div class="text-4xl font-extrabold" id="wh2-tank">0 gallons</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">First Hour Rating</div><div class="text-xl font-bold" id="wh2-fhr">0 GPH</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Peak Demand</div><div class="text-xl font-bold" id="wh2-peak">0 gal</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Recovery Rate (Gas)</div><div class="text-xl font-bold" id="wh2-recgas">0 GPH</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Recovery Rate (Electric)</div><div class="text-xl font-bold" id="wh2-recelec">0 GPH</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Annual Energy Cost Comparison</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between"><span>Gas Water Heater</span><span class="font-bold" id="wh2-costgas">$0</span></div>
            <div class="flex justify-between"><span>Electric Water Heater</span><span class="font-bold" id="wh2-costelec">$0</span></div>
            <div class="flex justify-between"><span>Heat Pump Water Heater</span><span class="font-bold" id="wh2-costhp">$0</span></div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Peak Hour Breakdown</h3>
          <div class="space-y-1 text-sm" id="wh2-breakdown"></div>
        </div>
      </div>
      <ShareButton calculatorId="water-heater-size" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcWH2() {
      const people = parseInt((document.getElementById('wh2-people') as HTMLInputElement).value) || 4;
      const baths = parseInt((document.getElementById('wh2-baths') as HTMLInputElement).value) || 2;
      const usage = (document.getElementById('wh2-usage') as HTMLSelectElement).value;
      const inlet = parseFloat((document.getElementById('wh2-inlet') as HTMLInputElement).value) || 55;
      const target = parseFloat((document.getElementById('wh2-target') as HTMLInputElement).value) || 120;
      const tempRise = target - inlet;

      // Peak hour demand calculation
      const showerGal = 10; // gallons per shower
      const shavingGal = 2;
      const dishwashGal = 6;
      const handWashGal = 2;
      const laundryGal = 7;

      let simultShowers = 1;
      let useFactor = 1.0;
      if (usage === 'low') { simultShowers = 1; useFactor = 0.7; }
      else if (usage === 'medium') { simultShowers = Math.min(people, baths, 2); useFactor = 1.0; }
      else { simultShowers = Math.min(people, baths); useFactor = 1.3; }

      const peakShowers = Math.min(people, simultShowers + 1) * showerGal;
      const peakOther = shavingGal + handWashGal * Math.min(people, 3) + (useFactor > 0.9 ? dishwashGal : 0) + (useFactor > 1.1 ? laundryGal : 0);
      const peakDemand = Math.round((peakShowers + peakOther) * useFactor);

      // Recovery rates (GPH at given temp rise)
      // Gas: ~40,000 BTU input, 80% efficient => 32,000 BTU/hr
      const gasRecovery = Math.round(32000 / (tempRise * 8.33));
      // Electric: 4500W element => 15,354 BTU/hr, 98% efficient
      const elecRecovery = Math.round((15354 * 0.98) / (tempRise * 8.33));

      // First hour rating = 70% of tank + recovery rate
      // Tank sizing: peak demand minus recovery rate in first hour
      const minTank = Math.max(peakDemand - gasRecovery, 20);
      const tankSizes = [30, 40, 50, 65, 75, 80, 100];
      let recTank = tankSizes[0];
      for (const sz of tankSizes) {
        if (sz >= minTank) { recTank = sz; break; }
        recTank = sz;
      }
      // Also ensure min tank by household size
      const minByPeople = people <= 2 ? 30 : people <= 3 ? 40 : people <= 5 ? 50 : people <= 7 ? 65 : 80;
      recTank = Math.max(recTank, minByPeople);
      for (const sz of tankSizes) {
        if (sz >= recTank) { recTank = sz; break; }
      }

      const fhr = Math.round(recTank * 0.7 + gasRecovery);

      // Annual energy cost
      const dailyGal = people * 20; // avg 20 gal/person/day
      const dailyBTU = dailyGal * 8.33 * tempRise;
      const gasCostAnnual = (dailyBTU / 0.80 / 100000) * 1.20 * 365; // $1.20/therm
      const elecCostAnnual = (dailyBTU / 0.98 / 3412) * 0.14 * 365; // $0.14/kWh
      const hpCostAnnual = (dailyBTU / 3.0 / 3412) * 0.14 * 365; // COP 3.0

      document.getElementById('wh2-tank')!.textContent = recTank + ' gallons';
      document.getElementById('wh2-fhr')!.textContent = fhr + ' GPH';
      document.getElementById('wh2-peak')!.textContent = peakDemand + ' gal';
      document.getElementById('wh2-recgas')!.textContent = gasRecovery + ' GPH';
      document.getElementById('wh2-recelec')!.textContent = elecRecovery + ' GPH';
      document.getElementById('wh2-costgas')!.textContent = '$' + Math.round(gasCostAnnual).toLocaleString() + '/yr';
      document.getElementById('wh2-costelec')!.textContent = '$' + Math.round(elecCostAnnual).toLocaleString() + '/yr';
      document.getElementById('wh2-costhp')!.textContent = '$' + Math.round(hpCostAnnual).toLocaleString() + '/yr';

      const bd = document.getElementById('wh2-breakdown')!;
      bd.innerHTML = '<div class="flex justify-between"><span>Showers (' + Math.min(people, simultShowers+1) + ' people)</span><span class="font-bold">' + peakShowers + ' gal</span></div>' +
        '<div class="flex justify-between"><span>Hand washing + shaving</span><span class="font-bold">' + (shavingGal + handWashGal * Math.min(people, 3)) + ' gal</span></div>' +
        (useFactor > 0.9 ? '<div class="flex justify-between"><span>Dishwashing</span><span class="font-bold">' + dishwashGal + ' gal</span></div>' : '') +
        (useFactor > 1.1 ? '<div class="flex justify-between"><span>Laundry</span><span class="font-bold">' + laundryGal + ' gal</span></div>' : '') +
        '<div class="flex justify-between border-t pt-1 mt-1"><span class="font-semibold">Total Peak Hour</span><span class="font-bold">' + peakDemand + ' gal</span></div>';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.wh2-in').forEach(el => { el.addEventListener('input', calcWH2); el.addEventListener('change', calcWH2); });
      calcWH2();
    }, 50);
  </script>
</CalculatorLayout>
