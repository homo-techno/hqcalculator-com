---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Dice Roller - Virtual Dice & D&D Dice Roller";
const description = "Roll virtual dice: d4, d6, d8, d10, d12, d20, and d100. Perfect for D&D, board games, and tabletop RPGs.";
const relatedCalcs = [
  { name: "Random Number", url: "/random-number-generator", description: "Random numbers." },
  { name: "Probability", url: "/probability-calculator", description: "Probability." },
  { name: "Coin Flip", url: "/coin-flip", description: "Coin flip." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Average Calculator", url: "/average-calculator", description: "Average." },
  { name: "Standard Deviation", url: "/standard-deviation-calculator", description: "Std dev." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Dice Roller" keywords="dice roller, virtual dice, d20 roller, D&D dice, tabletop RPG dice, random dice" breadcrumbs={[{ name: "Dice Roller", url: "/dice-roller" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Dice Roller</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Roll virtual dice for tabletop games, D&amp;D, and more.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Number of Dice</label><input type="number" id="dr-count" class="w-full px-4 py-3 border border-border rounded-xl text-lg font-bold text-center" value="2" min="1" max="100" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Modifier (+/-)</label><input type="number" id="dr-mod" class="w-full px-4 py-3 border border-border rounded-xl text-lg font-bold text-center" value="0" step="1"></div>
        </div>
        <div class="grid grid-cols-7 gap-2">
          <button class="dr-die py-3 rounded-xl border-2 border-primary bg-blue-50 text-primary font-bold text-sm" data-sides="6">d6</button>
          <button class="dr-die py-3 rounded-xl border-2 border-border text-text-muted font-bold text-sm" data-sides="4">d4</button>
          <button class="dr-die py-3 rounded-xl border-2 border-border text-text-muted font-bold text-sm" data-sides="8">d8</button>
          <button class="dr-die py-3 rounded-xl border-2 border-border text-text-muted font-bold text-sm" data-sides="10">d10</button>
          <button class="dr-die py-3 rounded-xl border-2 border-border text-text-muted font-bold text-sm" data-sides="12">d12</button>
          <button class="dr-die py-3 rounded-xl border-2 border-border text-text-muted font-bold text-sm" data-sides="20">d20</button>
          <button class="dr-die py-3 rounded-xl border-2 border-border text-text-muted font-bold text-sm" data-sides="100">d100</button>
        </div>
        <button id="dr-roll" class="w-full py-4 bg-primary text-white rounded-xl font-bold text-xl hover:bg-primary/90 transition">Roll!</button>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="dr-label">2d6</div>
          <div class="text-6xl font-extrabold font-mono" id="dr-total">-</div>
        </div>
        <div class="flex flex-wrap gap-2 justify-center" id="dr-dice"></div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Sum</div><div class="text-xl font-bold font-mono" id="dr-sum">-</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Min Possible</div><div class="text-xl font-bold font-mono" id="dr-min">-</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Max Possible</div><div class="text-xl font-bold font-mono" id="dr-max">-</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl max-h-40 overflow-y-auto">
          <h3 class="font-semibold text-sm text-text mb-2">History</h3>
          <div class="space-y-1 text-sm font-mono" id="dr-history"></div>
        </div>
      </div>
      <ShareButton calculatorId="dice-roller" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    let drSides = 6;
    function rollDice() {
      const count = parseInt((document.getElementById('dr-count') as HTMLInputElement).value) || 1;
      const mod = parseInt((document.getElementById('dr-mod') as HTMLInputElement).value) || 0;
      const results: number[] = [];
      for (let i = 0; i < count; i++) results.push(Math.floor(Math.random() * drSides) + 1);
      const sum = results.reduce((a, b) => a + b, 0);
      const total = sum + mod;
      const modStr = mod > 0 ? `+${mod}` : mod < 0 ? String(mod) : '';
      document.getElementById('dr-label')!.textContent = `${count}d${drSides}${modStr}`;
      document.getElementById('dr-total')!.textContent = String(total);
      document.getElementById('dr-sum')!.textContent = String(sum);
      document.getElementById('dr-min')!.textContent = String(count + mod);
      document.getElementById('dr-max')!.textContent = String(count * drSides + mod);
      document.getElementById('dr-dice')!.innerHTML = results.map(r =>
        `<div class="w-12 h-12 flex items-center justify-center rounded-lg bg-white border-2 border-border font-bold text-lg ${r === drSides ? 'text-green-600 border-green-400' : r === 1 ? 'text-red-600 border-red-400' : ''}">${r}</div>`
      ).join('');
      const hist = document.getElementById('dr-history')!;
      hist.innerHTML = `<div>${count}d${drSides}${modStr}: [${results.join(', ')}]${modStr ? ` ${modStr}` : ''} = ${total}</div>` + hist.innerHTML;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.getElementById('dr-roll')!.addEventListener('click', rollDice);
      document.querySelectorAll('.dr-die').forEach(btn => btn.addEventListener('click', () => {
        drSides = parseInt((btn as HTMLElement).dataset.sides!) || 6;
        document.querySelectorAll('.dr-die').forEach(b => {
          const active = (b as HTMLElement).dataset.sides === String(drSides);
          (b as HTMLElement).className = `dr-die py-3 rounded-xl border-2 font-bold text-sm ${active ? 'border-primary bg-blue-50 text-primary' : 'border-border text-text-muted'}`;
        });
      }));
      rollDice();
    }, 50);
  </script>
</CalculatorLayout>
