---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Alimony Calculator - Estimate Spousal Support Payments";
const description = "Estimate alimony or spousal support payments based on income difference, marriage duration, and state guidelines.";

const relatedCalcs = [
  { name: "Child Support", url: "/child-support-calculator", description: "Child support estimate." },
  { name: "Divorce Cost", url: "/divorce-cost-calculator", description: "Divorce expenses." },
  { name: "Income Tax", url: "/income-tax-calculator", description: "Tax estimate." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Budget planning." },
  { name: "Net Worth", url: "/net-worth-calculator", description: "Track net worth." },
  { name: "Paycheck Calculator", url: "/paycheck-calculator", description: "Take-home pay." },
];
---

<CalculatorLayout title={title} description={description} calculatorName="Alimony Calculator" keywords="alimony calculator, spousal support, alimony estimate, maintenance payments, divorce support, spousal maintenance" breadcrumbs={[{ name: "Alimony", url: "/alimony-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Alimony Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate spousal support payments based on income disparity and marriage length. Results are for informational purposes only.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Higher Earner Gross Annual Income</label>
            <div class="relative"><span class="absolute left-4 top-1/2 -translate-y-1/2 text-text-muted font-bold">$</span>
              <input type="number" id="al-high-income" class="w-full pl-8 pr-4 py-3 border border-border rounded-xl text-2xl font-bold" value="120000" min="0" step="5000">
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Lower Earner Gross Annual Income</label>
            <div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
              <input type="number" id="al-low-income" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="40000" min="0" step="5000">
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Marriage Duration (years)</label>
            <input type="number" id="al-duration" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="12" min="0" max="50" step="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Children Involved</label>
            <select id="al-children" class="w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="no" selected>No children</option>
              <option value="yes">Yes, with children</option>
            </select>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Monthly Alimony</div>
            <div class="text-5xl font-extrabold font-mono" id="al-monthly">$0</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Annual Amount</div>
              <div class="text-xl font-bold text-secondary" id="al-annual">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Est. Duration</div>
              <div class="text-xl font-bold" id="al-est-duration">0 yrs</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Estimated</div>
              <div class="text-xl font-bold text-orange-600" id="al-total">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Income Difference</div>
              <div class="text-xl font-bold" id="al-diff">$0</div>
            </div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Tax Note</div>
            <div class="text-sm font-medium" id="al-tax-note">--</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="alimony" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Is Alimony Calculated?</h2>
      <p>Common formulas use 30-40% of the income difference between spouses. Duration is typically tied to marriage length: short marriages (under 10 years) may get 30-50% of the marriage duration, while long marriages (20+ years) may result in longer or permanent alimony.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Tax Implications</h3>
      <p>For divorces finalized after December 31, 2018, alimony is no longer tax-deductible for the payer and not taxable income for the recipient under federal law (Tax Cuts and Jobs Act).</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const fmt = (n: number) => '$' + Math.round(n).toLocaleString();

    function calcAL() {
      const highIncome = parseFloat((document.getElementById('al-high-income') as HTMLInputElement).value) || 0;
      const lowIncome = parseFloat((document.getElementById('al-low-income') as HTMLInputElement).value) || 0;
      const duration = parseInt((document.getElementById('al-duration') as HTMLInputElement).value) || 0;
      const hasChildren = (document.getElementById('al-children') as HTMLSelectElement).value === 'yes';

      const incomeDiff = Math.max(0, highIncome - lowIncome);

      // Common formula: 30-40% of income difference
      let rate = hasChildren ? 0.30 : 0.35;
      // Some formulas: 40% of higher - 50% of lower
      const altCalc = highIncome * 0.4 - lowIncome * 0.5;
      const baseCalc = incomeDiff * rate;
      const annualAlimony = Math.max(0, Math.min(baseCalc, altCalc > 0 ? altCalc : baseCalc));
      const monthlyAlimony = annualAlimony / 12;

      // Duration estimate
      let estDuration: number;
      if (duration <= 5) estDuration = Math.ceil(duration * 0.3);
      else if (duration <= 10) estDuration = Math.ceil(duration * 0.4);
      else if (duration <= 20) estDuration = Math.ceil(duration * 0.5);
      else estDuration = Math.ceil(duration * 0.6); // long marriages

      const totalAlimony = annualAlimony * estDuration;

      document.getElementById('al-monthly')!.textContent = fmt(monthlyAlimony);
      document.getElementById('al-annual')!.textContent = fmt(annualAlimony);
      document.getElementById('al-est-duration')!.textContent = estDuration + (estDuration === 1 ? ' yr' : ' yrs');
      document.getElementById('al-total')!.textContent = fmt(totalAlimony);
      document.getElementById('al-diff')!.textContent = fmt(incomeDiff) + '/yr';
      document.getElementById('al-tax-note')!.textContent = 'Post-2018: Not tax-deductible for payer, not taxable for recipient (federal).';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      ['al-high-income', 'al-low-income', 'al-duration'].forEach(id => {
        const el = document.getElementById(id);
        if (el) { el.addEventListener('input', calcAL); el.addEventListener('change', calcAL); }
      });
      document.getElementById('al-children')!.addEventListener('change', calcAL);
      calcAL();
    }, 50);
  </script>
</CalculatorLayout>
