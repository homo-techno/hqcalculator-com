---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import SliderInput from '../components/SliderInput.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Savings Calculator - How Much Will My Savings Grow? 2026";
const description = "Free savings calculator. See how your savings grow over time with regular deposits and compound interest. Savings goal planner with charts.";

const relatedCalcs = [
  { name: "Compound Interest Calculator", url: "/compound-interest-calculator", description: "Compound interest growth." },
  { name: "Investment Calculator", url: "/investment-calculator", description: "Future value of investments." },
  { name: "Retirement Calculator", url: "/retirement-calculator", description: "Plan for retirement." },
  { name: "Mortgage Calculator", url: "/mortgage-calculator", description: "Home loan payments." },
  { name: "Loan Calculator", url: "/loan-calculator", description: "Loan payment calculator." },
  { name: "Inflation Calculator", url: "/inflation-calculator", description: "Purchasing power." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Savings Calculator"
  keywords="savings calculator, savings growth, savings goal, deposit calculator, high yield savings, savings interest"
  breadcrumbs={[{ name: "Savings Calculator", url: "/savings-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Savings Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate how your savings will grow with regular deposits and compound interest.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <SliderInput id="sav-initial" label="Initial Deposit" min={0} max={500000} step={500} value={5000} prefix="$" tooltip="Starting amount" />
          <SliderInput id="sav-monthly" label="Monthly Deposit" min={0} max={5000} step={25} value={300} prefix="$" tooltip="Regular monthly contribution" />
          <SliderInput id="sav-rate" label="Annual Interest Rate (APY)" min={0} max={15} step={0.1} value={4.5} suffix="%" tooltip="Annual Percentage Yield" />
          <SliderInput id="sav-years" label="Time Period" min={1} max={40} step={1} value={10} suffix=" years" tooltip="How long you'll save" />
        </div>

        <div class="space-y-4">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Savings</div>
            <div class="text-4xl sm:text-5xl font-extrabold" id="sav-total">$0</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Deposits</div>
              <div class="text-xl font-bold" id="sav-deposits">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Interest Earned</div>
              <div class="text-xl font-bold text-secondary" id="sav-interest">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Interest %</div>
              <div class="text-xl font-bold" id="sav-interest-pct">0%</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Monthly Interest (Final)</div>
              <div class="text-xl font-bold" id="sav-monthly-int">$0</div>
            </div>
          </div>
          <div class="chart-container p-4 bg-surface-alt rounded-xl">
            <canvas id="sav-chart" width="400" height="250"></canvas>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="savings" />
      <FeedbackWidget />
    </div>

    <!-- Year-by-Year -->
    <div class="mt-12 bg-white border border-border rounded-2xl p-6 sm:p-8">
      <h2 class="text-2xl font-bold text-text mb-4">Year-by-Year Growth</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-border text-left">
              <th class="py-2 pr-3 font-semibold">Year</th>
              <th class="py-2 pr-3 font-semibold text-right">Deposits</th>
              <th class="py-2 pr-3 font-semibold text-right">Interest</th>
              <th class="py-2 font-semibold text-right">Balance</th>
            </tr>
          </thead>
          <tbody id="sav-tbody"></tbody>
        </table>
      </div>
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Savings Grow</h2>
      <p>Your savings grow through two mechanisms: your regular deposits and compound interest. Interest is earned not just on your deposits, but also on previously earned interest — the "compounding" effect that accelerates growth over time.</p>

      <h3 class="text-xl font-semibold text-text mt-8">APR vs. APY</h3>
      <ul>
        <li><strong>APR (Annual Percentage Rate):</strong> The nominal interest rate without compounding</li>
        <li><strong>APY (Annual Percentage Yield):</strong> The effective rate including compounding. APY is always equal to or higher than APR.</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Where to Save (2026 Rates)</h3>
      <ul>
        <li><strong>High-yield savings accounts:</strong> 4.0-5.0% APY — best for emergency funds</li>
        <li><strong>CDs (Certificates of Deposit):</strong> 4.0-5.0% APY — fixed rates, locked periods</li>
        <li><strong>Money market accounts:</strong> 3.5-4.5% APY — higher minimums, check-writing</li>
        <li><strong>Regular savings accounts:</strong> 0.01-0.5% APY — avoid these!</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>How much should I save each month?</strong> The 50/30/20 rule suggests 20% of after-tax income for savings. Start with whatever you can and increase over time.</p>
      <p><strong>Is my savings account FDIC insured?</strong> Yes, deposits at FDIC-insured banks are protected up to $250,000 per depositor, per bank.</p>
      <p><strong>How much do I need for an emergency fund?</strong> Financial experts recommend 3-6 months of essential expenses in an easily accessible savings account.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    import Chart from 'chart.js/auto';
    let savChart: Chart | null = null;

    function getVal(id: string): number {
      const s = document.getElementById(`${id}-slider`) as HTMLInputElement;
      return parseFloat(s?.value || '0');
    }
    const fmt = (n: number) => '$' + Math.round(n).toLocaleString('en-US');

    function calcSavings() {
      const initial = getVal('sav-initial');
      const monthly = getVal('sav-monthly');
      const rate = getVal('sav-rate') / 100;
      const years = getVal('sav-years');

      const monthlyRate = rate / 12;
      let balance = initial;
      let totalDeposits = initial;

      const yearData: { year: number; deposits: number; interest: number; balance: number }[] = [];
      const balances: number[] = [initial];
      const deposits: number[] = [initial];

      for (let y = 1; y <= years; y++) {
        let yearInterest = 0;
        for (let m = 0; m < 12; m++) {
          const interest = balance * monthlyRate;
          yearInterest += interest;
          balance += interest + monthly;
          totalDeposits += monthly;
        }
        yearData.push({ year: y, deposits: totalDeposits, interest: balance - totalDeposits, balance });
        balances.push(balance);
        deposits.push(totalDeposits);
      }

      const totalInterest = balance - totalDeposits;
      const monthlyInt = balance * monthlyRate;

      document.getElementById('sav-total')!.textContent = fmt(balance);
      document.getElementById('sav-deposits')!.textContent = fmt(totalDeposits);
      document.getElementById('sav-interest')!.textContent = fmt(totalInterest);
      document.getElementById('sav-interest-pct')!.textContent = totalDeposits > 0 ? (totalInterest / totalDeposits * 100).toFixed(1) + '%' : '0%';
      document.getElementById('sav-monthly-int')!.textContent = fmt(monthlyInt);

      // Chart
      const ctx = (document.getElementById('sav-chart') as HTMLCanvasElement).getContext('2d')!;
      if (savChart) savChart.destroy();
      const labels = Array.from({ length: years + 1 }, (_, i) => i === 0 ? 'Start' : `Year ${i}`);
      savChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            { label: 'Balance', data: balances, borderColor: '#3b82f6', backgroundColor: 'rgba(59,130,246,0.1)', fill: true, tension: 0.3, pointRadius: 2 },
            { label: 'Deposits', data: deposits, borderColor: '#94a3b8', backgroundColor: 'transparent', borderDash: [5, 5], tension: 0.3, pointRadius: 0 }
          ]
        },
        options: {
          responsive: true,
          scales: {
            y: { ticks: { callback: (v) => '$' + Number(v).toLocaleString() } },
            x: { grid: { display: false } }
          },
          plugins: {
            legend: { position: 'bottom', labels: { padding: 12, usePointStyle: true, font: { size: 11 } } },
            tooltip: { callbacks: { label: (c) => `${c.dataset.label}: ${fmt(c.parsed.y)}` } }
          }
        }
      });

      // Table
      document.getElementById('sav-tbody')!.innerHTML = yearData.map(d =>
        `<tr class="border-b border-border/30 hover:bg-surface-alt/50">
          <td class="py-2 pr-3 text-text-secondary">Year ${d.year}</td>
          <td class="py-2 pr-3 text-right">${fmt(d.deposits)}</td>
          <td class="py-2 pr-3 text-right text-secondary">${fmt(d.interest)}</td>
          <td class="py-2 text-right font-medium">${fmt(d.balance)}</td>
        </tr>`
      ).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      ['sav-initial-slider', 'sav-monthly-slider', 'sav-rate-slider', 'sav-years-slider'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcSavings);
      });
      ['sav-initial-input', 'sav-monthly-input', 'sav-rate-input', 'sav-years-input'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', () => setTimeout(calcSavings, 120));
      });
      calcSavings();
    }, 50);
  </script>
</CalculatorLayout>
