---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Freight Class Calculator";
const description = "Determine NMFC freight class from density, stowability, handling, and liability factors. Essential for accurate LTL shipping quotes.";
const relatedCalcs = [
  { name: "Profit Margin", url: "/profit-margin-calculator", description: "Calculate profit margins." },
  { name: "Break Even", url: "/break-even-calculator", description: "Find break-even point." },
  { name: "Inventory Turnover", url: "/inventory-turnover-calculator", description: "Inventory efficiency." },
  { name: "ROI", url: "/roi-calculator", description: "Return on investment." },
  { name: "Gas Cost", url: "/gas-cost-calculator", description: "Estimate fuel expenses." },
  { name: "Moving Cost", url: "/moving-cost-calculator", description: "Estimate moving expenses." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Freight Class Calculator" keywords="freight class, NMFC, density, LTL shipping, freight classification, stowability" breadcrumbs={[{ name: "Freight Class", url: "/freight-class-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Freight Class Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Determine your NMFC freight class based on density, stowability, handling, and liability for LTL shipments.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div><label class="block text-xs font-medium text-text mb-1">Shipment Weight (lbs)</label><input type="number" id="fc2-weight" class="fc2-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" min="1" step="1"></div>
        <div class="grid grid-cols-3 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Length (in)</label><input type="number" id="fc2-length" class="fc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Width (in)</label><input type="number" id="fc2-width" class="fc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Height (in)</label><input type="number" id="fc2-height" class="fc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" min="1" step="1"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Stowability</label><select id="fc2-stow" class="fc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold"><option value="easy">Easy - Standard palletized</option><option value="moderate">Moderate - Irregular shape</option><option value="difficult">Difficult - Hazardous/oversized</option></select></div>
        <div><label class="block text-xs font-medium text-text mb-1">Handling</label><select id="fc2-handle" class="fc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold"><option value="easy">Easy - No special requirements</option><option value="moderate">Moderate - Requires care</option><option value="difficult">Difficult - Fragile/hazardous</option></select></div>
        <div><label class="block text-xs font-medium text-text mb-1">Liability</label><select id="fc2-liability" class="fc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold"><option value="low">Low - Under $5/lb value</option><option value="medium">Medium - $5-$25/lb value</option><option value="high">High - Over $25/lb value</option></select></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Freight Class</div>
          <div class="text-5xl font-extrabold font-mono" id="fc2-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Density (PCF)</div><div class="text-xl font-bold font-mono" id="fc2-density">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Volume (cu ft)</div><div class="text-xl font-bold font-mono" id="fc2-volume">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Density Class</div><div class="text-xl font-bold font-mono" id="fc2-dclass">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Rate Tier</div><div class="text-xl font-bold font-mono" id="fc2-tier">--</div></div>
        </div>
      </div>
      <ShareButton calculatorId="freight-class" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcFC2() {
      const weight = parseFloat((document.getElementById('fc2-weight') as HTMLInputElement).value) || 0;
      const length = parseFloat((document.getElementById('fc2-length') as HTMLInputElement).value) || 0;
      const width = parseFloat((document.getElementById('fc2-width') as HTMLInputElement).value) || 0;
      const height = parseFloat((document.getElementById('fc2-height') as HTMLInputElement).value) || 0;
      const stow = (document.getElementById('fc2-stow') as HTMLSelectElement).value;
      const handle = (document.getElementById('fc2-handle') as HTMLSelectElement).value;
      const liability = (document.getElementById('fc2-liability') as HTMLSelectElement).value;

      const volumeCuFt = (length * width * height) / 1728;
      const density = volumeCuFt > 0 ? weight / volumeCuFt : 0;

      let densityClass = 500;
      if (density >= 50) densityClass = 50;
      else if (density >= 35) densityClass = 55;
      else if (density >= 30) densityClass = 60;
      else if (density >= 22.5) densityClass = 65;
      else if (density >= 15) densityClass = 70;
      else if (density >= 13.5) densityClass = 77.5;
      else if (density >= 12) densityClass = 85;
      else if (density >= 10.5) densityClass = 92.5;
      else if (density >= 9) densityClass = 100;
      else if (density >= 8) densityClass = 110;
      else if (density >= 7) densityClass = 125;
      else if (density >= 6) densityClass = 150;
      else if (density >= 5) densityClass = 175;
      else if (density >= 4) densityClass = 200;
      else if (density >= 3) densityClass = 250;
      else if (density >= 2) densityClass = 300;
      else if (density >= 1) densityClass = 400;

      let adjustment = 0;
      if (stow === 'moderate') adjustment += 1;
      if (stow === 'difficult') adjustment += 2;
      if (handle === 'moderate') adjustment += 1;
      if (handle === 'difficult') adjustment += 2;
      if (liability === 'medium') adjustment += 1;
      if (liability === 'high') adjustment += 2;

      const classes = [50, 55, 60, 65, 70, 77.5, 85, 92.5, 100, 110, 125, 150, 175, 200, 250, 300, 400, 500];
      let idx = classes.indexOf(densityClass);
      idx = Math.min(classes.length - 1, idx + Math.floor(adjustment / 2));
      const finalClass = classes[idx];

      let tier = 'Economy';
      if (finalClass >= 300) tier = 'Premium';
      else if (finalClass >= 150) tier = 'High';
      else if (finalClass >= 85) tier = 'Standard';

      document.getElementById('fc2-result')!.textContent = 'Class ' + finalClass;
      document.getElementById('fc2-density')!.textContent = density.toFixed(1) + ' PCF';
      document.getElementById('fc2-volume')!.textContent = volumeCuFt.toFixed(2) + ' ft\u00B3';
      document.getElementById('fc2-dclass')!.textContent = 'Class ' + densityClass;
      document.getElementById('fc2-tier')!.textContent = tier;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      (document.getElementById('fc2-weight') as HTMLInputElement).value = '500';
      (document.getElementById('fc2-length') as HTMLInputElement).value = '48';
      (document.getElementById('fc2-width') as HTMLInputElement).value = '40';
      (document.getElementById('fc2-height') as HTMLInputElement).value = '36';
      document.querySelectorAll('.fc2-in').forEach(el => { el.addEventListener('input', calcFC2); el.addEventListener('change', calcFC2); });
      calcFC2();
    }, 50);
  </script>
</CalculatorLayout>
