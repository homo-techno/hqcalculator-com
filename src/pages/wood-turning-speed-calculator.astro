---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Wood Turning Speed Calculator - Lathe RPM by Diameter & Material";
const description = "Calculate optimal lathe RPM from workpiece diameter and material. Get safe speed recommendations for roughing, finishing, and sanding operations.";

const relatedCalcs = [
  { name: "Router Bit Speed Calculator", url: "/router-bit-speed-calculator", description: "Router RPM calculator." },
  { name: "Saw Blade Calculator", url: "/saw-blade-calculator", description: "Saw blade specs." },
  { name: "Board Foot Calculator", url: "/board-foot-calculator", description: "Board feet calculator." },
  { name: "Wood Weight Calculator", url: "/wood-weight-calculator", description: "Wood weight estimator." },
  { name: "Wood Bending Calculator", url: "/wood-bending-calculator", description: "Steam bending radius." },
  { name: "Wood Moisture Calculator", url: "/wood-moisture-calculator", description: "Moisture content." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Wood Turning Speed Calculator"
  keywords="lathe speed calculator, lathe RPM, wood turning, spindle speed, bowl turning, roughing speed, finishing speed"
  breadcrumbs={[{ name: "Wood Turning Speed Calculator", url: "/wood-turning-speed-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Wood Turning Speed Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Find the optimal lathe RPM for your workpiece diameter and turning operation.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Workpiece Diameter (inches)</label>
        <input type="number" id="wts-diam" class="wts-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="6" min="0.5" max="36" step="0.5">
      </div>

      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Turning Operation</label>
          <select id="wts-op" class="wts-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="rough" selected>Roughing</option>
            <option value="shape">Shaping</option>
            <option value="finish">Finishing</option>
            <option value="sand">Sanding</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Workpiece Type</label>
          <select id="wts-type" class="wts-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="spindle" selected>Spindle (between centers)</option>
            <option value="bowl">Bowl/Faceplate</option>
          </select>
        </div>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Wood Density</label>
        <select id="wts-density" class="wts-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="soft">Softwood (Pine, Cedar)</option>
          <option value="medium" selected>Medium (Walnut, Cherry)</option>
          <option value="hard">Hardwood (Maple, Oak)</option>
          <option value="exotic">Exotic/Dense (Ebony, Ipe)</option>
        </select>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended RPM</div>
        <div class="text-4xl font-extrabold" id="wts-rpm">--</div>
        <div class="text-sm text-blue-200 mt-1" id="wts-rpm-sub">--</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Min Safe RPM</div>
          <div class="text-xl font-bold" id="wts-min">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Max Safe RPM</div>
          <div class="text-xl font-bold" id="wts-max">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Surface Speed</div>
          <div class="text-xl font-bold" id="wts-sfm">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Rim Speed</div>
          <div class="text-xl font-bold" id="wts-mph">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h4 class="font-semibold text-sm text-text mb-1">Safety Notes</h4>
        <p class="text-sm text-text-secondary" id="wts-notes">--</p>
      </div>

      <ShareButton calculatorId="wood-turning-speed" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Lathe Speed Guide</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>RPM = Ideal SFM x 12 / (pi x Diameter)</strong></p>
        <p>Target 6,000-9,000 SFM for most operations</p>
      </div>
      <h3 class="text-xl font-semibold text-text mt-8">General Speed Guidelines</h3>
      <ul>
        <li><strong>Large diameter (&gt;8"):</strong> Start slow (500-800 RPM), increase gradually</li>
        <li><strong>Medium diameter (4-8"):</strong> 800-1800 RPM for roughing</li>
        <li><strong>Small diameter (&lt;4"):</strong> Up to 3000+ RPM for finishing</li>
        <li><strong>Bowl turning:</strong> Use lower speeds than spindle turning at same diameter</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcWTS() {
      const diam = parseFloat((document.getElementById('wts-diam') as HTMLInputElement).value) || 6;
      const op = (document.getElementById('wts-op') as HTMLSelectElement).value;
      const type = (document.getElementById('wts-type') as HTMLSelectElement).value;
      const density = (document.getElementById('wts-density') as HTMLSelectElement).value;

      // Target surface feet per minute by operation
      const sfmTargets: Record<string, number> = {
        'rough': 6000,
        'shape': 7500,
        'finish': 9000,
        'sand': 5000,
      };

      // Density adjustment factor
      const densityFactor: Record<string, number> = {
        'soft': 1.1,
        'medium': 1.0,
        'hard': 0.9,
        'exotic': 0.8,
      };

      // Bowl turning uses lower speeds (safety factor)
      const typeFactor = type === 'bowl' ? 0.7 : 1.0;

      const targetSFM = sfmTargets[op] * densityFactor[density] * typeFactor;
      const rpm = (targetSFM * 12) / (Math.PI * diam);

      // Safe range: +/- 30%
      const minRPM = Math.round(rpm * 0.7);
      const maxRPM = Math.round(rpm * 1.3);
      const recRPM = Math.round(rpm);

      // Actual surface speed at recommended RPM
      const actualSFM = (Math.PI * diam * recRPM) / 12;
      const mph = (Math.PI * diam * recRPM) / (12 * 5280) * 60;

      document.getElementById('wts-rpm')!.textContent = recRPM.toLocaleString();
      document.getElementById('wts-rpm-sub')!.textContent = op + ' operation, ' + type + ' turning';
      document.getElementById('wts-min')!.textContent = minRPM.toLocaleString();
      document.getElementById('wts-max')!.textContent = maxRPM.toLocaleString();
      document.getElementById('wts-sfm')!.textContent = Math.round(actualSFM).toLocaleString() + ' SFM';
      document.getElementById('wts-mph')!.textContent = mph.toFixed(1) + ' mph';

      let notes = '';
      if (diam > 10) {
        notes = 'Large workpiece! Start at the lowest speed and increase gradually. Ensure the piece is securely mounted and balanced. ';
      } else if (diam > 6) {
        notes = 'Medium workpiece. Start conservatively and increase speed as the piece becomes round. ';
      } else {
        notes = 'Small workpiece suitable for higher speeds. ';
      }
      if (type === 'bowl') {
        notes += 'Bowl turning: ensure faceplate screws are long enough. Check for cracks before turning.';
      } else {
        notes += 'Spindle turning: check that tailstock is locked and centers are tight.';
      }
      document.getElementById('wts-notes')!.textContent = notes;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.wts-in').forEach(el => {
        el.addEventListener('input', calcWTS);
        el.addEventListener('change', calcWTS);
      });
      calcWTS();
    }, 50);
  </script>
</CalculatorLayout>
