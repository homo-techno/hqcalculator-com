---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Wireless Range Calculator - WiFi Range Estimator 2026";
const description = "Estimate WiFi and wireless range based on transmit power, frequency, antenna gain, and environmental conditions. Plan wireless coverage for any scenario.";

const relatedCalcs = [
  { name: "Free Space Path Loss Calculator", url: "/free-space-path-loss-calculator", description: "FSPL from frequency and distance." },
  { name: "Link Budget Calculator", url: "/link-budget-calculator", description: "Complete RF link budget analysis." },
  { name: "EIRP Calculator", url: "/eirp-calculator", description: "Effective isotropic radiated power." },
  { name: "Fresnel Zone Calculator", url: "/fresnel-zone-calculator", description: "Fresnel zone clearance radius." },
  { name: "Antenna Gain Calculator", url: "/antenna-gain-calculator", description: "Antenna gain calculation." },
  { name: "Cell Tower Coverage Calculator", url: "/cell-tower-coverage-calculator", description: "Cell tower coverage radius." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Wireless Range Calculator"
  keywords="wireless range calculator, WiFi range, signal range, coverage area, wireless coverage, WiFi distance, signal propagation"
  breadcrumbs={[{ name: "Wireless Range Calculator", url: "/wireless-range-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Wireless Range Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate the maximum range of a wireless link based on transmit power, frequency, gains, and environment.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Transmit Power (dBm)</label>
        <input type="number" id="wrc-tx-power" class="wrc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" step="0.1">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">TX Antenna Gain (dBi)</label>
        <input type="number" id="wrc-tx-gain" class="wrc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="5" step="0.1">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">RX Antenna Gain (dBi)</label>
        <input type="number" id="wrc-rx-gain" class="wrc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" step="0.1">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Frequency (MHz)</label>
        <input type="number" id="wrc-freq" class="wrc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2400" step="1" min="1">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Receiver Sensitivity (dBm)</label>
        <input type="number" id="wrc-rx-sens" class="wrc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="-70" step="0.1">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Cable/Connector Losses (dB total)</label>
        <input type="number" id="wrc-cable-loss" class="wrc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" step="0.1" min="0">
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-text mb-1">Environment</label>
        <select id="wrc-env" class="wrc-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="0">Free Space (no obstacles)</option>
          <option value="10" selected>Light Indoor (residential, few walls)</option>
          <option value="20">Dense Indoor (office, many walls)</option>
          <option value="15">Urban Outdoor</option>
          <option value="5">Rural / Suburban Outdoor</option>
          <option value="30">Heavy Foliage / Industrial</option>
        </select>
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm font-medium text-blue-100 mb-1">Estimated Maximum Range</div>
        <div class="text-4xl font-extrabold" id="wrc-range">--</div>
      </div>

      <!-- Secondary Stats -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">EIRP</div>
          <div class="text-xl font-bold text-text" id="wrc-eirp">--</div>
          <div class="text-xs text-text-muted">dBm</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Max Allowable Path Loss</div>
          <div class="text-xl font-bold text-text" id="wrc-mapl">--</div>
          <div class="text-xs text-text-muted">dB</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Free Space Range</div>
          <div class="text-xl font-bold text-text" id="wrc-fs-range">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted mb-1">Coverage Area</div>
          <div class="text-xl font-bold text-text" id="wrc-area">--</div>
        </div>
      </div>

      <ShareButton calculatorId="wireless-range" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">How Wireless Range is Estimated</h2>
      <p>The maximum range is derived from the link budget. The allowable path loss is the difference between EIRP plus receiver antenna gain minus cable losses and receiver sensitivity. This path loss is then converted to distance using the free-space path loss formula, minus environmental attenuation.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono text-sm">
        Max FSPL = EIRP + G_rx - L_cable - Sensitivity - Env_loss
        <br>Distance = 10^((FSPL - 32.44 - 20*log10(f)) / 20)
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcWRC() {
      const txPower = parseFloat((document.getElementById('wrc-tx-power') as HTMLInputElement).value) || 0;
      const txGain = parseFloat((document.getElementById('wrc-tx-gain') as HTMLInputElement).value) || 0;
      const rxGain = parseFloat((document.getElementById('wrc-rx-gain') as HTMLInputElement).value) || 0;
      const freq = parseFloat((document.getElementById('wrc-freq') as HTMLInputElement).value) || 1;
      const rxSens = parseFloat((document.getElementById('wrc-rx-sens') as HTMLInputElement).value) || -70;
      const cableLoss = parseFloat((document.getElementById('wrc-cable-loss') as HTMLInputElement).value) || 0;
      const envLoss = parseFloat((document.getElementById('wrc-env') as HTMLSelectElement).value) || 0;

      const eirp = txPower + txGain;
      const maxPathLoss = eirp + rxGain - cableLoss - rxSens;
      const fsplAllowed = maxPathLoss - envLoss;

      // FSPL = 20*log10(d) + 20*log10(f) + 32.44
      // d = 10^((FSPL - 32.44 - 20*log10(f)) / 20)
      const distKm = Math.pow(10, (fsplAllowed - 32.44 - 20 * Math.log10(freq)) / 20);
      const freeSpaceDistKm = Math.pow(10, (maxPathLoss - 32.44 - 20 * Math.log10(freq)) / 20);

      const formatDist = (km: number) => {
        if (km < 0.001) return (km * 1e6).toFixed(0) + ' mm';
        if (km < 0.01) return (km * 1000).toFixed(1) + ' m';
        if (km < 1) return (km * 1000).toFixed(0) + ' m';
        return km.toFixed(2) + ' km';
      };

      const areaKm2 = Math.PI * distKm * distKm;
      const formatArea = (a: number) => {
        if (a < 0.001) return (a * 1e6).toFixed(0) + ' m\u00B2';
        return a.toFixed(4) + ' km\u00B2';
      };

      document.getElementById('wrc-range')!.textContent = formatDist(Math.max(0, distKm));
      document.getElementById('wrc-eirp')!.textContent = eirp.toFixed(1);
      document.getElementById('wrc-mapl')!.textContent = maxPathLoss.toFixed(1);
      document.getElementById('wrc-fs-range')!.textContent = formatDist(Math.max(0, freeSpaceDistKm));
      document.getElementById('wrc-area')!.textContent = formatArea(Math.max(0, areaKm2));

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.wrc-in').forEach(el => { el.addEventListener('input', calcWRC); el.addEventListener('change', calcWRC); });
      calcWRC();
    }, 50);
  </script>
</CalculatorLayout>
