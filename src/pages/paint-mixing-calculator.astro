---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Paint Mixing Calculator - Ratios & Coverage";
const description = "Calculate paint color mixing ratios, tint amounts, coverage per coat, and drying time estimates for your painting projects.";
const relatedCalcs = [
  { name: "Paint Calculator", url: "/paint-calculator", description: "Paint coverage." },
  { name: "Wallpaper Calculator", url: "/wallpaper-calculator", description: "Wall covering." },
  { name: "Drywall Calculator", url: "/drywall-calculator", description: "Drywall sheets." },
  { name: "Square Footage", url: "/square-footage-calculator", description: "Square footage." },
  { name: "Area Calculator", url: "/area-calculator", description: "Area calculations." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Paint Mixing Calculator" keywords="paint mixing calculator, color mixing ratio, paint tint, coverage per coat, drying time" breadcrumbs={[{ name: "Paint Mixing", url: "/paint-mixing-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Paint Mixing Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate mixing ratios, tint amounts, and coverage for paint projects.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Paint Type</label>
          <select id="pm-type" class="pm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="latex" selected>Latex / Water-Based</option>
            <option value="oil">Oil-Based / Alkyd</option>
            <option value="chalk">Chalk Paint</option>
            <option value="epoxy">Epoxy Paint</option>
            <option value="spray">Spray Paint</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Base Paint (oz)</label><input type="number" id="pm-base" class="pm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="128" min="1" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Tint/Colorant (oz)</label><input type="number" id="pm-tint" class="pm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="0" step="0.25"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Surface Area (sq ft)</label><input type="number" id="pm-area" class="pm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="400" min="1" step="10"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Number of Coats</label><input type="number" id="pm-coats" class="pm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="1" max="5" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Temperature (Â°F)</label><input type="number" id="pm-temp" class="pm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="72" min="40" max="110" step="1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Humidity (%)</label><input type="number" id="pm-hum" class="pm-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="50" min="10" max="95" step="5"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Paint Needed</div>
          <div class="text-4xl font-extrabold font-mono" id="pm-result">0 gallons</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Mix Ratio</div><div class="text-xl font-bold font-mono" id="pm-ratio">0:0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Tint %</div><div class="text-xl font-bold font-mono" id="pm-tpct">0%</div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Coverage/Gal</div><div class="text-xl font-bold font-mono" id="pm-cov">0 sq ft</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Dry to Touch</div><div class="text-xl font-bold font-mono" id="pm-dry">0 hrs</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Recoat Time</div><div class="text-xl font-bold font-mono" id="pm-recoat">0 hrs</div></div>
        </div>
      </div>
      <ShareButton calculatorId="paint-mixing" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcPM() {
      const paintType = (document.getElementById('pm-type') as HTMLSelectElement).value;
      const base = parseFloat((document.getElementById('pm-base') as HTMLInputElement).value) || 128;
      const tint = parseFloat((document.getElementById('pm-tint') as HTMLInputElement).value) || 0;
      const area = parseFloat((document.getElementById('pm-area') as HTMLInputElement).value) || 400;
      const coats = parseInt((document.getElementById('pm-coats') as HTMLInputElement).value) || 2;
      const temp = parseFloat((document.getElementById('pm-temp') as HTMLInputElement).value) || 72;
      const hum = parseFloat((document.getElementById('pm-hum') as HTMLInputElement).value) || 50;

      // Coverage per gallon by paint type
      const coveragePerGal: Record<string, number> = { latex: 400, oil: 350, chalk: 150, epoxy: 250, spray: 100 };
      const baseDryHrs: Record<string, number> = { latex: 1, oil: 6, chalk: 0.5, epoxy: 4, spray: 0.25 };
      const baseRecoatHrs: Record<string, number> = { latex: 4, oil: 24, chalk: 1, epoxy: 12, spray: 1 };

      const covPerGal = coveragePerGal[paintType] || 400;
      const totalArea = area * coats;
      const gallonsNeeded = totalArea / covPerGal;

      // Mix ratio (simplified)
      const totalMix = base + tint;
      const tintPct = (tint / totalMix) * 100;
      const gcd = (a: number, b: number): number => b === 0 ? a : gcd(b, a % b);
      const g = gcd(Math.round(base), Math.round(tint));
      const ratioBase = g > 0 ? Math.round(base / g) : Math.round(base);
      const ratioTint = g > 0 ? Math.round(tint / g) : Math.round(tint);

      // Drying time adjustment based on temp and humidity
      // Higher temp = faster drying, higher humidity = slower drying
      const tempFactor = 72 / Math.max(temp, 40);
      const humFactor = 1 + (hum - 50) / 100;
      const dryTime = (baseDryHrs[paintType] || 1) * tempFactor * humFactor;
      const recoatTime = (baseRecoatHrs[paintType] || 4) * tempFactor * humFactor;

      document.getElementById('pm-result')!.textContent = gallonsNeeded.toFixed(2) + ' gallons';
      document.getElementById('pm-ratio')!.textContent = ratioBase + ':' + ratioTint;
      document.getElementById('pm-tpct')!.textContent = tintPct.toFixed(1) + '%';
      document.getElementById('pm-cov')!.textContent = covPerGal + ' sq ft';
      document.getElementById('pm-dry')!.textContent = dryTime.toFixed(1) + ' hrs';
      document.getElementById('pm-recoat')!.textContent = recoatTime.toFixed(1) + ' hrs';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.pm-in').forEach(el => { el.addEventListener('input', calcPM); el.addEventListener('change', calcPM); });
      calcPM();
    }, 50);
  </script>
</CalculatorLayout>
