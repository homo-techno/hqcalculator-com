---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Fluoride Calculator";
const description = "Calculate optimal fluoride intake by age and weight, assess water fluoride levels, and get supplement recommendations per ADA guidelines.";
const relatedCalcs = [
  { name: "Dental Insurance Calculator", url: "/dental-insurance-calculator", description: "Dental plan benefit analysis." },
  { name: "Tooth Filling Calculator", url: "/tooth-filling-calculator", description: "Filling cost by material." },
  { name: "Dental X-Ray Calculator", url: "/dental-x-ray-calculator", description: "X-ray radiation dose." },
  { name: "Dosage Calculator", url: "/dosage-calculator", description: "Medication dosing calculator." },
  { name: "Water Intake Calculator", url: "/water-intake-calculator", description: "Daily water intake needs." },
  { name: "BMI Calculator", url: "/bmi-calculator", description: "Body mass index calculator." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Fluoride Calculator" keywords="fluoride intake, fluoride supplement, water fluoride level, fluoride dose children, fluoride recommendation, ADA fluoride" breadcrumbs={[{ name: "Fluoride", url: "/fluoride-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Fluoride Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate optimal fluoride intake and supplement needs based on age, weight, and water fluoride concentration.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Age Group</label>
            <select id="fl3-age" class="fl3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="0-6m">0-6 months</option>
              <option value="6m-3y" selected>6 months - 3 years</option>
              <option value="3-6y">3-6 years</option>
              <option value="6-16y">6-16 years</option>
              <option value="adult">Adult (16+)</option>
            </select>
          </div>
          <div><label class="block text-xs font-medium text-text mb-1">Weight (kg)</label><input type="number" id="fl3-wt" class="fl3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="15" min="3" max="150" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Water Fluoride Level (ppm)</label><input type="number" id="fl3-water" class="fl3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.3" min="0" max="10" step="0.1"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Daily Water Intake (mL)</label><input type="number" id="fl3-intake" class="fl3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="750" min="0" max="5000" step="50"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Fluoride Toothpaste?</label>
            <select id="fl3-paste" class="fl3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="no">No</option>
              <option value="child" selected>Children's (500 ppm)</option>
              <option value="adult">Regular (1000-1500 ppm)</option>
              <option value="rx">Prescription (5000 ppm)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Fluoride Rinse?</label>
            <select id="fl3-rinse" class="fl3-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="no" selected>No</option>
              <option value="otc">OTC (225 ppm NaF)</option>
              <option value="rx">Prescription (900 ppm)</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Supplement Recommendation</div>
          <div class="text-4xl font-extrabold font-mono" id="fl3-supp">None Needed</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Optimal Intake</div><div class="text-xl font-bold font-mono" id="fl3-optimal">0 mg/day</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">From Water</div><div class="text-xl font-bold font-mono" id="fl3-fromw">0 mg/day</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Deficit / Excess</div><div class="text-xl font-bold font-mono" id="fl3-gap">0 mg</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Water Level Status</div><div class="text-xl font-bold font-mono" id="fl3-status">-</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Fluorosis Risk</div><div class="text-xl font-bold font-mono" id="fl3-frisk">-</div></div>
        </div>
        <div class="p-3 bg-amber-50 rounded-xl text-center text-xs text-amber-800 font-semibold">
          Consult your pediatrician or dentist before giving fluoride supplements. Optimal water fluoride: 0.7 ppm (US PHS recommendation).
        </div>
      </div>
      <ShareButton calculatorId="fluoride" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcFL3() {
      const ageGroup = (document.getElementById('fl3-age') as HTMLSelectElement).value;
      const weight = parseFloat((document.getElementById('fl3-wt') as HTMLInputElement).value) || 15;
      const waterF = parseFloat((document.getElementById('fl3-water') as HTMLInputElement).value) || 0;
      const waterIntake = parseFloat((document.getElementById('fl3-intake') as HTMLInputElement).value) || 750;
      const paste = (document.getElementById('fl3-paste') as HTMLSelectElement).value;
      const rinse = (document.getElementById('fl3-rinse') as HTMLSelectElement).value;

      // Adequate Intake (AI) of fluoride by age (mg/day) per ADA/IOM
      const ai: Record<string, number> = {
        '0-6m': 0.01,
        '6m-3y': 0.5,
        '3-6y': 0.7,
        '6-16y': 1.0,
        'adult': 3.0 // female, male is 4.0
      };

      // Upper limit (UL) mg/day
      const ul: Record<string, number> = {
        '0-6m': 0.7,
        '6m-3y': 1.3,
        '3-6y': 2.2,
        '6-16y': 10.0,
        'adult': 10.0
      };

      const optimalIntake = ai[ageGroup] || 0.5;
      const upperLimit = ul[ageGroup] || 2.0;

      // Fluoride from water (ppm = mg/L)
      const fromWater = (waterF * waterIntake) / 1000;

      // ADA supplement schedule based on water fluoride level
      let suppDose = 0;
      if (ageGroup === '0-6m') {
        suppDose = 0; // No supplement for infants <6 months
      } else if (ageGroup === '6m-3y') {
        suppDose = waterF < 0.3 ? 0.25 : 0;
      } else if (ageGroup === '3-6y') {
        suppDose = waterF < 0.3 ? 0.50 : waterF < 0.6 ? 0.25 : 0;
      } else if (ageGroup === '6-16y') {
        suppDose = waterF < 0.3 ? 1.00 : waterF < 0.6 ? 0.50 : 0;
      } else {
        suppDose = 0; // Adults typically don't use supplements
      }

      const gap = optimalIntake - fromWater;

      // Water fluoride status
      let waterStatus: string;
      if (waterF >= 0.7) waterStatus = 'Optimal (0.7+ ppm)';
      else if (waterF >= 0.3) waterStatus = 'Sub-optimal';
      else waterStatus = 'Deficient';

      // Fluorosis risk (mainly for children)
      let fluorosisRisk: string;
      const totalF = fromWater + suppDose;
      if (ageGroup === 'adult') {
        fluorosisRisk = 'N/A (adult)';
      } else if (totalF > upperLimit) {
        fluorosisRisk = 'High';
      } else if (waterF > 2.0 || (paste === 'adult' && ageGroup === '6m-3y')) {
        fluorosisRisk = 'Moderate';
      } else {
        fluorosisRisk = 'Low';
      }

      let suppText: string;
      if (suppDose > 0) {
        suppText = suppDose.toFixed(2) + ' mg F/day';
      } else if (ageGroup === '0-6m') {
        suppText = 'Not recommended';
      } else {
        suppText = 'None needed';
      }

      document.getElementById('fl3-supp')!.textContent = suppText;
      document.getElementById('fl3-optimal')!.textContent = optimalIntake.toFixed(2) + ' mg/day';
      document.getElementById('fl3-fromw')!.textContent = fromWater.toFixed(2) + ' mg/day';
      document.getElementById('fl3-gap')!.textContent = (gap > 0 ? '-' : '+') + Math.abs(gap).toFixed(2) + ' mg';
      document.getElementById('fl3-status')!.textContent = waterStatus;
      document.getElementById('fl3-frisk')!.textContent = fluorosisRisk;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.fl3-in').forEach(el => { el.addEventListener('input', calcFL3); el.addEventListener('change', calcFL3); });
      calcFL3();
    }, 50);
  </script>
</CalculatorLayout>
