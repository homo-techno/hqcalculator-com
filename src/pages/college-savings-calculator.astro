---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "College Savings Calculator (529) - Plan for Education Costs";
const description = "Calculate how much to save for college using a 529 plan. See projected savings, funding gap, and required monthly contributions.";

const relatedCalcs = [
  { name: "College Cost", url: "/college-cost-calculator", description: "College cost estimate." },
  { name: "Savings Calculator", url: "/savings-calculator", description: "Savings growth." },
  { name: "Investment Calculator", url: "/investment-calculator", description: "Investment returns." },
  { name: "Compound Interest", url: "/compound-interest-calculator", description: "Compound growth." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Budget planning." },
  { name: "Financial Independence", url: "/financial-independence-calculator", description: "FIRE planning." },
];
---

<CalculatorLayout title={title} description={description} calculatorName="College Savings Calculator" keywords="college savings calculator, 529 plan, education savings, college cost, tuition, college fund" breadcrumbs={[{ name: "College Savings", url: "/college-savings-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">College Savings Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Plan your 529 or education savings to ensure you can cover future college costs.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Child's Current Age</label>
            <input type="number" id="sv-age" class="w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="5" min="0" max="17" step="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Target Total College Cost (4 years)</label>
            <div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
              <input type="number" id="sv-target" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="120000" min="0" step="5000">
            </div>
            <p class="text-xs text-text-muted mt-1">Average 4-year public: ~$100K; private: ~$220K (including room/board)</p>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Current Savings</label>
            <div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
              <input type="number" id="sv-current" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="15000" min="0" step="1000">
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Monthly Contribution</label>
            <div class="relative"><span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
              <input type="number" id="sv-monthly" class="w-full pl-7 pr-3 py-3 border border-border rounded-xl text-lg" value="300" min="0" step="25">
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Expected Annual Return (%)</label>
            <div class="relative">
              <input type="number" id="sv-return" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="6" min="0" max="15" step="0.5">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-text-muted">%</span>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Projected Savings at Age 18</div>
            <div class="text-5xl font-extrabold font-mono" id="sv-projected">$0</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Funding Gap</div>
              <div class="text-xl font-bold text-red-600" id="sv-gap">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Years to Save</div>
              <div class="text-xl font-bold" id="sv-years">0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Required Monthly</div>
              <div class="text-xl font-bold text-green-600" id="sv-required">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Total Contributions</div>
              <div class="text-xl font-bold" id="sv-total-contrib">$0</div>
            </div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Investment Growth</div>
            <div class="text-xl font-bold text-blue-600" id="sv-growth">$0</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="college-savings" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">529 College Savings Plans</h2>
      <p>A 529 plan offers tax-free growth and tax-free withdrawals for qualified education expenses. Many states also offer state income tax deductions for contributions. Start early to maximize the power of compound growth.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Tips for College Savings</h3>
      <p>Even small monthly contributions add up over 18 years. Encourage grandparents and family to contribute for birthdays and holidays. Consider an age-based investment portfolio that automatically becomes more conservative as college approaches.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const fmt = (n: number) => '$' + Math.round(n).toLocaleString();

    function calcSV() {
      const age = parseInt((document.getElementById('sv-age') as HTMLInputElement).value) || 0;
      const target = parseFloat((document.getElementById('sv-target') as HTMLInputElement).value) || 0;
      const current = parseFloat((document.getElementById('sv-current') as HTMLInputElement).value) || 0;
      const monthly = parseFloat((document.getElementById('sv-monthly') as HTMLInputElement).value) || 0;
      const annualReturn = (parseFloat((document.getElementById('sv-return') as HTMLInputElement).value) || 0) / 100;

      const yearsToSave = Math.max(0, 18 - age);
      const monthsToSave = yearsToSave * 12;
      const monthlyRate = annualReturn / 12;

      // Future value of current savings + monthly contributions
      let projected = current * Math.pow(1 + annualReturn, yearsToSave);
      if (monthlyRate > 0 && monthsToSave > 0) {
        projected += monthly * ((Math.pow(1 + monthlyRate, monthsToSave) - 1) / monthlyRate);
      } else {
        projected += monthly * monthsToSave;
      }

      const totalContributions = current + monthly * monthsToSave;
      const growth = projected - totalContributions;
      const gap = Math.max(0, target - projected);

      // Required monthly to reach target
      let requiredMonthly = 0;
      if (monthsToSave > 0) {
        const fvCurrent = current * Math.pow(1 + annualReturn, yearsToSave);
        const remaining = target - fvCurrent;
        if (remaining > 0 && monthlyRate > 0) {
          requiredMonthly = remaining / ((Math.pow(1 + monthlyRate, monthsToSave) - 1) / monthlyRate);
        } else if (remaining > 0) {
          requiredMonthly = remaining / monthsToSave;
        }
      }

      document.getElementById('sv-projected')!.textContent = fmt(projected);
      document.getElementById('sv-gap')!.textContent = gap > 0 ? fmt(gap) : '$0 (funded!)';
      document.getElementById('sv-years')!.textContent = yearsToSave.toString();
      document.getElementById('sv-required')!.textContent = fmt(Math.max(0, requiredMonthly)) + '/mo';
      document.getElementById('sv-total-contrib')!.textContent = fmt(totalContributions);
      document.getElementById('sv-growth')!.textContent = fmt(Math.max(0, growth));

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      ['sv-age', 'sv-target', 'sv-current', 'sv-monthly', 'sv-return'].forEach(id => {
        const el = document.getElementById(id);
        if (el) { el.addEventListener('input', calcSV); el.addEventListener('change', calcSV); }
      });
      calcSV();
    }, 50);
  </script>
</CalculatorLayout>
