---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Lamination Calculator - Croissant & Puff Pastry Layer Count";
const description = "Calculate the number of layers in laminated dough from fold types and count. Plan your croissant, puff pastry, or danish dough lamination.";
const relatedCalcs = [
  { name: "Baker's Percentage Calculator", url: "/baker-percentage-calculator", description: "Calculate baker's percentages." },
  { name: "Dough Hydration Calculator", url: "/dough-hydration-calculator", description: "Calculate dough hydration." },
  { name: "Chocolate Tempering Calculator", url: "/chocolate-tempering-calculator", description: "Chocolate tempering temperatures." },
  { name: "Pastry Cream Calculator", url: "/pastry-cream-calculator", description: "Scale pastry cream recipes." },
  { name: "Bread Flour Calculator", url: "/bread-flour-calculator", description: "Flour types and substitutions." },
  { name: "Baking Conversion Calculator", url: "/baking-conversion-calculator", description: "Convert between baking units." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Lamination Calculator" keywords="lamination, croissant layers, puff pastry folds, letter fold, book fold, dough lamination, pastry layers" breadcrumbs={[{ name: "Lamination", url: "/lamination-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Lamination Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate the total number of butter and dough layers from your fold sequence. Plan laminated dough for croissants, puff pastry, and danish.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Pastry Type (preset)</label>
          <select id="lam-preset" class="lam-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="custom">Custom Fold Sequence</option>
            <option value="croissant">Classic Croissant (3 single folds)</option>
            <option value="puff">Puff Pastry (6 single folds)</option>
            <option value="danish">Danish (3 single folds)</option>
            <option value="roughpuff">Rough Puff (4 single folds)</option>
          </select>
        </div>
        <h3 class="font-bold text-text text-sm uppercase tracking-wide">Fold Sequence (up to 6 folds)</h3>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Fold 1</label>
            <select id="lam-f1" class="lam-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="0">None</option>
              <option value="3" selected>Letter/Single (3)</option>
              <option value="4">Book/Double (4)</option>
              <option value="5">Double Letter (5)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Fold 2</label>
            <select id="lam-f2" class="lam-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="0">None</option>
              <option value="3" selected>Letter/Single (3)</option>
              <option value="4">Book/Double (4)</option>
              <option value="5">Double Letter (5)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Fold 3</label>
            <select id="lam-f3" class="lam-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="0">None</option>
              <option value="3" selected>Letter/Single (3)</option>
              <option value="4">Book/Double (4)</option>
              <option value="5">Double Letter (5)</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Fold 4</label>
            <select id="lam-f4" class="lam-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="0" selected>None</option>
              <option value="3">Letter/Single (3)</option>
              <option value="4">Book/Double (4)</option>
              <option value="5">Double Letter (5)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Fold 5</label>
            <select id="lam-f5" class="lam-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="0" selected>None</option>
              <option value="3">Letter/Single (3)</option>
              <option value="4">Book/Double (4)</option>
              <option value="5">Double Letter (5)</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Fold 6</label>
            <select id="lam-f6" class="lam-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="0" selected>None</option>
              <option value="3">Letter/Single (3)</option>
              <option value="4">Book/Double (4)</option>
              <option value="5">Double Letter (5)</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Butter Block Weight (g)</label>
            <input type="number" id="lam-butter" class="lam-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="250" min="50" step="10">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Dough Weight (g)</label>
            <input type="number" id="lam-dough" class="lam-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="500" min="100" step="10">
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Layers</div>
          <div class="text-5xl font-extrabold font-mono" id="lam-result">--</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Dough Layers</div>
            <div class="text-xl font-bold font-mono" id="lam-dough-layers">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Butter Layers</div>
            <div class="text-xl font-bold font-mono" id="lam-butter-layers">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Butter Ratio</div>
            <div class="text-xl font-bold font-mono" id="lam-ratio">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Layer Thickness</div>
            <div class="text-sm font-bold" id="lam-quality">--</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="lamination" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcLAM() {
      const preset = (document.getElementById('lam-preset') as HTMLSelectElement).value;

      // Set presets
      if (preset !== 'custom') {
        const presets: Record<string, number[]> = {
          croissant: [3, 3, 3, 0, 0, 0],
          puff: [3, 3, 3, 3, 3, 3],
          danish: [3, 3, 3, 0, 0, 0],
          roughpuff: [3, 3, 3, 3, 0, 0],
        };
        const p = presets[preset];
        for (let i = 0; i < 6; i++) {
          (document.getElementById('lam-f' + (i + 1)) as HTMLSelectElement).value = String(p[i]);
        }
      }

      const folds: number[] = [];
      for (let i = 1; i <= 6; i++) {
        const v = parseInt((document.getElementById('lam-f' + i) as HTMLSelectElement).value) || 0;
        if (v > 0) folds.push(v);
      }

      const butter = parseFloat((document.getElementById('lam-butter') as HTMLInputElement).value) || 250;
      const dough = parseFloat((document.getElementById('lam-dough') as HTMLInputElement).value) || 500;

      // Layer calculation: each fold multiplies layers
      // Starting: 1 dough layer + 1 butter layer = 1 dough layer wrapping butter
      // After fold n with factor f: dough_layers = previous_layers * f
      // Butter layers = dough_layers - 1
      let doughLayers = 1;
      for (const f of folds) {
        doughLayers = doughLayers * f;
      }
      const butterLayers = doughLayers - 1;
      const totalLayers = doughLayers + butterLayers;

      const ratio = (butter / (dough + butter) * 100).toFixed(0);

      let quality = '';
      if (doughLayers < 10) quality = 'Very few layers - chunky butter pieces';
      else if (doughLayers < 20) quality = 'Moderate layers - visible flakes';
      else if (doughLayers < 40) quality = 'Ideal for croissants';
      else if (doughLayers < 100) quality = 'Good for puff pastry';
      else if (doughLayers < 300) quality = 'Very fine layers';
      else quality = 'Extremely thin - layers may merge';

      document.getElementById('lam-result')!.textContent = totalLayers + ' total';
      document.getElementById('lam-dough-layers')!.textContent = doughLayers.toString();
      document.getElementById('lam-butter-layers')!.textContent = butterLayers.toString();
      document.getElementById('lam-ratio')!.textContent = ratio + '% butter';
      document.getElementById('lam-quality')!.textContent = quality;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.lam-in').forEach(el => { el.addEventListener('input', calcLAM); el.addEventListener('change', calcLAM); });
      calcLAM();
    }, 50);
  </script>
</CalculatorLayout>
