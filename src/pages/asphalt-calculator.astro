---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Asphalt Calculator - Tons, Volume & Cost Estimator";
const description = "Calculate asphalt needed for driveways and parking lots. Enter area and thickness to get tons, hot mix volume, and cost estimates.";

const relatedCalcs = [
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume estimator." },
  { name: "Excavation Calculator", url: "/excavation-calculator", description: "Dig volume estimator." },
  { name: "Gravel Calculator", url: "/gravel-calculator", description: "Gravel and aggregate." },
  { name: "Patio Calculator", url: "/patio-calculator", description: "Patio material needs." },
  { name: "Rebar Calculator", url: "/rebar-calculator", description: "Rebar requirements." },
  { name: "Foundation Calculator", url: "/foundation-calculator", description: "Foundation estimator." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Asphalt Calculator"
  keywords="asphalt calculator, asphalt tons, hot mix asphalt, driveway asphalt, asphalt cost, blacktop calculator"
  breadcrumbs={[{ name: "Asphalt Calculator", url: "/asphalt-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Asphalt Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate asphalt tonnage, volume, and cost for paving projects.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <div class="grid grid-cols-2 gap-3 mb-5">
            <div>
              <label class="block text-xs font-medium text-text mb-1">Length (ft)</label>
              <input type="number" id="ap-length" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="50" min="0" step="1">
            </div>
            <div>
              <label class="block text-xs font-medium text-text mb-1">Width (ft)</label>
              <input type="number" id="ap-width" class="w-full px-3 py-3 border border-border rounded-xl text-lg" value="20" min="0" step="1">
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-xs font-medium text-text mb-1">Thickness (inches)</label>
            <select id="ap-thickness" class="w-full px-3 py-3 border border-border rounded-xl text-lg">
              <option value="1">1 inch (overlay)</option>
              <option value="1.5">1.5 inches (overlay)</option>
              <option value="2" selected>2 inches (residential driveway)</option>
              <option value="3">3 inches (standard)</option>
              <option value="4">4 inches (heavy duty)</option>
              <option value="6">6 inches (commercial)</option>
            </select>
          </div>

          <div class="p-4 bg-surface-alt rounded-xl">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-text mb-1">Cost per Ton ($)</label>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">$</span>
                  <input type="number" id="ap-cost" class="w-full pl-7 pr-3 py-2 border border-border rounded-lg" value="100" min="0" step="5">
                </div>
              </div>
              <div>
                <label class="block text-xs font-medium text-text mb-1">Waste Factor (%)</label>
                <input type="number" id="ap-waste" class="w-full px-3 py-2 border border-border rounded-lg" value="10" min="0" max="50" step="1">
              </div>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Asphalt Needed</div>
            <div class="text-5xl font-extrabold font-mono" id="ap-tons">0</div>
            <div class="text-sm text-blue-200 mt-1">tons (incl. waste)</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Area</div>
              <div class="text-xl font-bold" id="ap-area">0 sq ft</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Hot Mix Volume</div>
              <div class="text-xl font-bold" id="ap-volume">0 cu yd</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Estimated Cost</div>
              <div class="text-2xl font-bold text-secondary" id="ap-total">$0</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Truck Loads (25 ton)</div>
              <div class="text-xl font-bold" id="ap-trucks">0</div>
            </div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="asphalt" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Asphalt</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Volume:</strong> Area (sq ft) x Thickness (ft) / 27 = cubic yards</p>
        <p><strong>Weight:</strong> Cubic yards x 2.025 tons/yd3 = tons</p>
        <p><strong>Rule of thumb:</strong> 1 ton covers about 80 sq ft at 2" thick</p>
      </div>

      <h3 class="text-xl font-semibold text-text mt-8">Asphalt Thickness Guidelines</h3>
      <ul>
        <li><strong>1-1.5 inches:</strong> Overlay / resurfacing existing pavement</li>
        <li><strong>2 inches:</strong> Standard residential driveway</li>
        <li><strong>3-4 inches:</strong> Heavy-duty residential, light commercial</li>
        <li><strong>6+ inches:</strong> Commercial parking lots, roads</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcAsphalt() {
      const length = parseFloat((document.getElementById('ap-length') as HTMLInputElement).value) || 0;
      const width = parseFloat((document.getElementById('ap-width') as HTMLInputElement).value) || 0;
      const thickness = parseFloat((document.getElementById('ap-thickness') as HTMLSelectElement).value) || 2;
      const costPerTon = parseFloat((document.getElementById('ap-cost') as HTMLInputElement).value) || 0;
      const waste = (parseFloat((document.getElementById('ap-waste') as HTMLInputElement).value) || 0) / 100;

      const area = length * width;
      const volumeCuFt = area * (thickness / 12);
      const volumeCuYd = volumeCuFt / 27;

      // Hot mix asphalt weighs ~2.025 tons per cubic yard (148 lbs/cu ft)
      const tonsRaw = volumeCuYd * 2.025;
      const tonsWithWaste = tonsRaw * (1 + waste);

      const totalCost = tonsWithWaste * costPerTon;
      const truckLoads = Math.ceil(tonsWithWaste / 25);

      document.getElementById('ap-tons')!.textContent = tonsWithWaste.toFixed(1);
      document.getElementById('ap-area')!.textContent = area.toLocaleString() + ' sq ft';
      document.getElementById('ap-volume')!.textContent = (volumeCuYd * (1 + waste)).toFixed(1) + ' cu yd';
      document.getElementById('ap-total')!.textContent = '$' + Math.round(totalCost).toLocaleString();
      document.getElementById('ap-trucks')!.textContent = String(truckLoads);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('#ap-length, #ap-width, #ap-cost, #ap-waste').forEach(el => {
        el.addEventListener('input', calcAsphalt);
        el.addEventListener('change', calcAsphalt);
      });
      document.querySelectorAll('#ap-thickness').forEach(el => {
        el.addEventListener('input', calcAsphalt);
        el.addEventListener('change', calcAsphalt);
      });
      calcAsphalt();
    }, 50);
  </script>
</CalculatorLayout>
