---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "RF Power Converter Calculator - dBm dBW Watts mW 2026";
const description = "Convert between RF power units: dBm, dBW, watts, milliwatts, microwatts, and kilowatts. Instant bidirectional conversion for radio frequency engineering.";

const relatedCalcs = [
  { name: "EIRP Calculator", url: "/eirp-calculator", description: "Effective isotropic radiated power." },
  { name: "Link Budget Calculator", url: "/link-budget-calculator", description: "Complete RF link budget analysis." },
  { name: "Cable Attenuation Calculator", url: "/cable-attenuation-calculator", description: "Coaxial cable signal attenuation." },
  { name: "Antenna Gain Calculator", url: "/antenna-gain-calculator", description: "Antenna gain calculation." },
  { name: "Free Space Path Loss Calculator", url: "/free-space-path-loss-calculator", description: "FSPL calculation." },
  { name: "Wavelength Frequency Calculator", url: "/wavelength-frequency-calculator", description: "Wavelength and frequency conversion." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="RF Power Converter Calculator"
  keywords="RF power converter, dBm to watts, dBW to dBm, watts to dBm, milliwatts to dBm, power conversion, RF engineering"
  breadcrumbs={[{ name: "RF Power Converter Calculator", url: "/rf-power-converter-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">RF Power Converter Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert between all common RF power units instantly. Enter a value in any field and all others update automatically.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <p class="text-sm text-text-secondary mb-4">Enter a value in any field to convert:</p>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">dBm (decibels relative to 1 milliwatt)</label>
        <input type="number" id="rpc-dbm" class="rpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="30" step="0.1" data-unit="dbm">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">dBW (decibels relative to 1 watt)</label>
        <input type="number" id="rpc-dbw" class="rpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="0.1" data-unit="dbw">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Watts (W)</label>
        <input type="number" id="rpc-w" class="rpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="any" data-unit="w">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Milliwatts (mW)</label>
        <input type="number" id="rpc-mw" class="rpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="any" data-unit="mw">
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-text mb-1">Microwatts (uW)</label>
        <input type="number" id="rpc-uw" class="rpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="any" data-unit="uw">
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-text mb-1">Kilowatts (kW)</label>
        <input type="number" id="rpc-kw" class="rpc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" step="any" data-unit="kw">
      </div>

      <!-- Reference Table -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm font-medium text-blue-100 mb-1">Current Power</div>
        <div class="text-4xl font-extrabold" id="rpc-main">--</div>
        <div class="text-sm text-blue-200 mt-1" id="rpc-main-sub">--</div>
      </div>

      <div class="bg-surface-alt rounded-xl p-4 mb-6">
        <h3 class="font-semibold text-text mb-3 text-sm">Common RF Power Levels</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead><tr class="text-text-muted text-xs uppercase"><th class="pb-2 text-left">Source</th><th class="pb-2 text-right">dBm</th><th class="pb-2 text-right">Watts</th></tr></thead>
            <tbody class="text-text-secondary">
              <tr class="border-b border-border/20"><td class="py-1.5">WiFi AP (typical)</td><td class="py-1.5 text-right">20 dBm</td><td class="py-1.5 text-right">100 mW</td></tr>
              <tr class="border-b border-border/20"><td class="py-1.5">Cell phone</td><td class="py-1.5 text-right">23 dBm</td><td class="py-1.5 text-right">200 mW</td></tr>
              <tr class="border-b border-border/20"><td class="py-1.5">Ham radio (QRP)</td><td class="py-1.5 text-right">37 dBm</td><td class="py-1.5 text-right">5 W</td></tr>
              <tr class="border-b border-border/20"><td class="py-1.5">Cell tower</td><td class="py-1.5 text-right">43 dBm</td><td class="py-1.5 text-right">20 W</td></tr>
              <tr class="border-b border-border/20"><td class="py-1.5">FM radio station</td><td class="py-1.5 text-right">70 dBm</td><td class="py-1.5 text-right">10 kW</td></tr>
              <tr><td class="py-1.5">Thermal noise floor</td><td class="py-1.5 text-right">-174 dBm</td><td class="py-1.5 text-right">4e-18 mW</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <ShareButton calculatorId="rf-power-converter" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">RF Power Unit Conversions</h2>
      <p>RF engineers commonly use logarithmic (decibel) scales because they simplify gain and loss calculations to addition and subtraction.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono text-sm">
        dBm = 10 * log10(mW) = 10 * log10(W) + 30
        <br>dBW = dBm - 30
        <br>mW = 10^(dBm / 10)
      </div>
      <p>A 3 dB increase doubles the power. A 10 dB increase is a 10x increase. A 30 dBm signal is 1 watt (1000 milliwatts).</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let rpcUpdating = false;

    function updateFromDbm(dbm: number, sourceId: string) {
      if (rpcUpdating) return;
      rpcUpdating = true;

      const mw = Math.pow(10, dbm / 10);
      const w = mw / 1000;
      const dbw = dbm - 30;
      const uw = mw * 1000;
      const kw = w / 1000;

      const fields: Record<string, string> = {
        'rpc-dbm': dbm.toFixed(2),
        'rpc-dbw': dbw.toFixed(2),
        'rpc-w': w.toPrecision(6),
        'rpc-mw': mw.toPrecision(6),
        'rpc-uw': uw.toPrecision(6),
        'rpc-kw': kw.toPrecision(6),
      };

      Object.keys(fields).forEach(id => {
        if (id !== sourceId) {
          (document.getElementById(id) as HTMLInputElement).value = fields[id];
        }
      });

      // Main display
      let mainText = dbm.toFixed(2) + ' dBm';
      let subText = '';
      if (w >= 1000) subText = (w / 1000).toFixed(3) + ' kW';
      else if (w >= 1) subText = w.toFixed(4) + ' W';
      else if (mw >= 1) subText = mw.toFixed(3) + ' mW';
      else subText = uw.toFixed(2) + ' \u00B5W';

      document.getElementById('rpc-main')!.textContent = mainText;
      document.getElementById('rpc-main-sub')!.textContent = subText;

      rpcUpdating = false;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    function handleRPCInput(e: Event) {
      const input = e.target as HTMLInputElement;
      const val = parseFloat(input.value);
      if (isNaN(val)) return;

      const unit = input.dataset.unit;
      let dbm = val;

      if (unit === 'dbm') dbm = val;
      else if (unit === 'dbw') dbm = val + 30;
      else if (unit === 'w') dbm = 10 * Math.log10(val * 1000);
      else if (unit === 'mw') dbm = 10 * Math.log10(val);
      else if (unit === 'uw') dbm = 10 * Math.log10(val / 1000);
      else if (unit === 'kw') dbm = 10 * Math.log10(val * 1e6);

      updateFromDbm(dbm, input.id);
    }

    setTimeout(() => {
      document.querySelectorAll('.rpc-in').forEach(el => {
        el.addEventListener('input', handleRPCInput);
        el.addEventListener('change', handleRPCInput);
      });
      updateFromDbm(30, '');
    }, 50);
  </script>
</CalculatorLayout>
