---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Color Converter - HEX, RGB, HSL & CMYK Color Picker";
const description = "Convert colors between HEX, RGB, HSL, and CMYK formats. Pick colors visually and get CSS-ready values.";

const relatedCalcs = [
  { name: "Hex Calculator", url: "/hex-calculator", description: "Hexadecimal." },
  { name: "Screen Size", url: "/screen-size-calculator", description: "Display sizes." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Binary Calculator", url: "/binary-calculator", description: "Binary math." },
  { name: "Random Number", url: "/random-number-generator", description: "Random numbers." },
  { name: "Aspect Ratio", url: "/aspect-ratio-calculator", description: "Aspect ratios." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Color Converter"
  keywords="color converter, hex to rgb, rgb to hex, hsl converter, color picker, cmyk converter, css color"
  breadcrumbs={[{ name: "Color Converter", url: "/color-converter" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Color Converter</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert between HEX, RGB, HSL, and CMYK color formats.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <!-- Color preview -->
      <div class="flex gap-4 mb-6">
        <div id="cc-preview" class="w-32 h-32 rounded-2xl border border-border shadow-inner" style="background-color: #3B82F6;"></div>
        <div class="flex-1 space-y-2">
          <input type="color" id="cc-picker" class="w-full h-10 cursor-pointer rounded-lg" value="#3B82F6">
          <button id="cc-random" class="w-full px-3 py-2 border border-border rounded-xl text-sm font-semibold hover:bg-surface-alt">Random Color</button>
        </div>
      </div>

      <!-- HEX -->
      <div class="mb-4">
        <label class="block text-xs font-medium text-text mb-1">HEX</label>
        <div class="flex gap-2">
          <span class="self-center text-text-muted font-bold">#</span>
          <input type="text" id="cc-hex" class="flex-1 px-4 py-2 border border-border rounded-xl font-mono text-lg uppercase" value="3B82F6" maxlength="6">
        </div>
      </div>

      <!-- RGB -->
      <div class="mb-4">
        <label class="block text-xs font-medium text-text mb-1">RGB</label>
        <div class="grid grid-cols-3 gap-2">
          <div class="flex items-center gap-1"><span class="text-xs text-red-500 font-bold">R</span><input type="number" id="cc-r" class="w-full px-2 py-2 border border-border rounded-xl text-center" value="59" min="0" max="255"></div>
          <div class="flex items-center gap-1"><span class="text-xs text-green-500 font-bold">G</span><input type="number" id="cc-g" class="w-full px-2 py-2 border border-border rounded-xl text-center" value="130" min="0" max="255"></div>
          <div class="flex items-center gap-1"><span class="text-xs text-blue-500 font-bold">B</span><input type="number" id="cc-b" class="w-full px-2 py-2 border border-border rounded-xl text-center" value="246" min="0" max="255"></div>
        </div>
      </div>

      <!-- HSL -->
      <div class="mb-4">
        <label class="block text-xs font-medium text-text mb-1">HSL</label>
        <div class="grid grid-cols-3 gap-2">
          <div class="flex items-center gap-1"><span class="text-xs text-text-muted font-bold">H</span><input type="number" id="cc-h" class="w-full px-2 py-2 border border-border rounded-xl text-center" value="217" min="0" max="360"></div>
          <div class="flex items-center gap-1"><span class="text-xs text-text-muted font-bold">S%</span><input type="number" id="cc-s" class="w-full px-2 py-2 border border-border rounded-xl text-center" value="91" min="0" max="100"></div>
          <div class="flex items-center gap-1"><span class="text-xs text-text-muted font-bold">L%</span><input type="number" id="cc-l" class="w-full px-2 py-2 border border-border rounded-xl text-center" value="60" min="0" max="100"></div>
        </div>
      </div>

      <!-- CSS output -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-2">CSS Values</h3>
        <div class="space-y-1 text-sm font-mono" id="cc-css"></div>
      </div>

      <!-- Palette presets -->
      <div class="flex flex-wrap gap-2 mb-6">
        <button class="cc-preset w-8 h-8 rounded-lg border border-border" style="background:#EF4444;" data-hex="EF4444"></button>
        <button class="cc-preset w-8 h-8 rounded-lg border border-border" style="background:#F97316;" data-hex="F97316"></button>
        <button class="cc-preset w-8 h-8 rounded-lg border border-border" style="background:#EAB308;" data-hex="EAB308"></button>
        <button class="cc-preset w-8 h-8 rounded-lg border border-border" style="background:#22C55E;" data-hex="22C55E"></button>
        <button class="cc-preset w-8 h-8 rounded-lg border border-border" style="background:#3B82F6;" data-hex="3B82F6"></button>
        <button class="cc-preset w-8 h-8 rounded-lg border border-border" style="background:#8B5CF6;" data-hex="8B5CF6"></button>
        <button class="cc-preset w-8 h-8 rounded-lg border border-border" style="background:#EC4899;" data-hex="EC4899"></button>
        <button class="cc-preset w-8 h-8 rounded-lg border border-border" style="background:#000000;" data-hex="000000"></button>
        <button class="cc-preset w-8 h-8 rounded-lg border border-border" style="background:#FFFFFF;" data-hex="FFFFFF"></button>
        <button class="cc-preset w-8 h-8 rounded-lg border border-border" style="background:#6B7280;" data-hex="6B7280"></button>
      </div>

      <ShareButton calculatorId="color" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Color Format Guide</h2>
      <ul>
        <li><strong>HEX:</strong> 6-digit hexadecimal (#RRGGBB). Most common in web development.</li>
        <li><strong>RGB:</strong> Red, Green, Blue values 0-255. Used in CSS and most programming.</li>
        <li><strong>HSL:</strong> Hue (0-360Â°), Saturation (0-100%), Lightness (0-100%). More intuitive for humans.</li>
      </ul>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>Which format should I use?</strong> HEX is the most common for web. HSL is best for adjusting colors (easy to change brightness/saturation). RGB is standard for programming.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let updating = '';

    function hexToRgb(hex: string): [number, number, number] {
      const r = parseInt(hex.slice(0, 2), 16);
      const g = parseInt(hex.slice(2, 4), 16);
      const b = parseInt(hex.slice(4, 6), 16);
      return [r, g, b];
    }

    function rgbToHex(r: number, g: number, b: number): string {
      return [r, g, b].map(v => Math.max(0, Math.min(255, Math.round(v))).toString(16).padStart(2, '0')).join('').toUpperCase();
    }

    function rgbToHsl(r: number, g: number, b: number): [number, number, number] {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h = 0, s = 0, l = (max + min) / 2;
      if (max !== min) {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        if (max === r) h = ((g - b) / d + (g < b ? 6 : 0)) / 6;
        else if (max === g) h = ((b - r) / d + 2) / 6;
        else h = ((r - g) / d + 4) / 6;
      }
      return [Math.round(h * 360), Math.round(s * 100), Math.round(l * 100)];
    }

    function hslToRgb(h: number, s: number, l: number): [number, number, number] {
      h /= 360; s /= 100; l /= 100;
      if (s === 0) { const v = Math.round(l * 255); return [v, v, v]; }
      const hue2rgb = (p: number, q: number, t: number) => {
        if (t < 0) t += 1; if (t > 1) t -= 1;
        if (t < 1/6) return p + (q - p) * 6 * t;
        if (t < 1/2) return q;
        if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
        return p;
      };
      const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
      const p = 2 * l - q;
      return [Math.round(hue2rgb(p, q, h + 1/3) * 255), Math.round(hue2rgb(p, q, h) * 255), Math.round(hue2rgb(p, q, h - 1/3) * 255)];
    }

    function updateAll(r: number, g: number, b: number) {
      const hex = rgbToHex(r, g, b);
      const [h, s, l] = rgbToHsl(r, g, b);

      if (updating !== 'hex') (document.getElementById('cc-hex') as HTMLInputElement).value = hex;
      if (updating !== 'rgb') {
        (document.getElementById('cc-r') as HTMLInputElement).value = String(r);
        (document.getElementById('cc-g') as HTMLInputElement).value = String(g);
        (document.getElementById('cc-b') as HTMLInputElement).value = String(b);
      }
      if (updating !== 'hsl') {
        (document.getElementById('cc-h') as HTMLInputElement).value = String(h);
        (document.getElementById('cc-s') as HTMLInputElement).value = String(s);
        (document.getElementById('cc-l') as HTMLInputElement).value = String(l);
      }
      if (updating !== 'picker') (document.getElementById('cc-picker') as HTMLInputElement).value = '#' + hex;

      const color = '#' + hex;
      document.getElementById('cc-preview')!.style.backgroundColor = color;

      document.getElementById('cc-css')!.innerHTML = [
        `<div>hex: <strong>${color}</strong></div>`,
        `<div>rgb: <strong>rgb(${r}, ${g}, ${b})</strong></div>`,
        `<div>hsl: <strong>hsl(${h}, ${s}%, ${l}%)</strong></div>`,
      ].join('');
    }

    setTimeout(() => {
      document.getElementById('cc-hex')!.addEventListener('input', () => {
        const hex = (document.getElementById('cc-hex') as HTMLInputElement).value.replace('#', '');
        if (/^[0-9A-Fa-f]{6}$/.test(hex)) {
          updating = 'hex';
          const [r, g, b] = hexToRgb(hex);
          updateAll(r, g, b);
          updating = '';
        }
      });

      ['cc-r', 'cc-g', 'cc-b'].forEach(id => {
        document.getElementById(id)!.addEventListener('input', () => {
          updating = 'rgb';
          const r = parseInt((document.getElementById('cc-r') as HTMLInputElement).value) || 0;
          const g = parseInt((document.getElementById('cc-g') as HTMLInputElement).value) || 0;
          const b = parseInt((document.getElementById('cc-b') as HTMLInputElement).value) || 0;
          updateAll(r, g, b);
          updating = '';
        });
      });

      ['cc-h', 'cc-s', 'cc-l'].forEach(id => {
        document.getElementById(id)!.addEventListener('input', () => {
          updating = 'hsl';
          const h = parseInt((document.getElementById('cc-h') as HTMLInputElement).value) || 0;
          const s = parseInt((document.getElementById('cc-s') as HTMLInputElement).value) || 0;
          const l = parseInt((document.getElementById('cc-l') as HTMLInputElement).value) || 0;
          const [r, g, b] = hslToRgb(h, s, l);
          updateAll(r, g, b);
          updating = '';
        });
      });

      document.getElementById('cc-picker')!.addEventListener('input', () => {
        updating = 'picker';
        const hex = (document.getElementById('cc-picker') as HTMLInputElement).value.slice(1);
        const [r, g, b] = hexToRgb(hex);
        updateAll(r, g, b);
        updating = '';
      });

      document.querySelectorAll('.cc-preset').forEach(btn => {
        btn.addEventListener('click', () => {
          const hex = (btn as HTMLElement).dataset.hex || '000000';
          updating = 'hex';
          (document.getElementById('cc-hex') as HTMLInputElement).value = hex;
          const [r, g, b] = hexToRgb(hex);
          updateAll(r, g, b);
          updating = '';
        });
      });

      document.getElementById('cc-random')!.addEventListener('click', () => {
        const r = Math.floor(Math.random() * 256);
        const g = Math.floor(Math.random() * 256);
        const b = Math.floor(Math.random() * 256);
        updateAll(r, g, b);
      });

      updateAll(59, 130, 246);
    }, 50);
  </script>
</CalculatorLayout>
