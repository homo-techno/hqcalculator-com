---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Welding Cost Calculator - Job Estimate & Breakdown";
const description = "Calculate total welding job cost including labor, filler material, gas, electricity, and overhead. Get accurate cost estimates for welding projects.";

const relatedCalcs = [
  { name: "Welding Rod Calculator", url: "/welding-rod-calculator", description: "Electrode consumption." },
  { name: "Welding Gas Calculator", url: "/welding-gas-calculator", description: "Gas flow and duration." },
  { name: "Welding Heat Input", url: "/welding-heat-input-calculator", description: "Heat input calculation." },
  { name: "Metal Weight Calculator", url: "/metal-weight-calculator", description: "Weight of metal shapes." },
  { name: "Structural Steel Calculator", url: "/structural-steel-calculator", description: "Steel section properties." },
  { name: "Metal Finishing Calculator", url: "/metal-finishing-calculator", description: "Finishing material needs." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Welding Cost Calculator"
  keywords="welding cost calculator, welding job estimate, welding labor cost, welding material cost, welding project cost, fabrication cost"
  breadcrumbs={[{ name: "Welding Cost Calculator", url: "/welding-cost-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Welding Cost Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate total welding job cost with labor, material, gas, electricity, and overhead breakdown.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <h3 class="font-semibold text-text mb-4">Labor</h3>
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Hourly Labor Rate ($)</label>
          <input type="number" id="wc2-labor" class="wc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="45" min="0" step="5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Total Labor Hours</label>
          <input type="number" id="wc2-hours" class="wc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="0.5" step="0.5">
        </div>
      </div>

      <h3 class="font-semibold text-text mb-4">Materials</h3>
      <div class="grid grid-cols-2 gap-4 mb-3">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Filler Metal Cost ($)</label>
          <input type="number" id="wc2-filler" class="wc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="35" min="0" step="5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Base Metal Cost ($)</label>
          <input type="number" id="wc2-base" class="wc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="120" min="0" step="10">
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Consumables ($)</label>
          <input type="number" id="wc2-consumables" class="wc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="15" min="0" step="5">
          <p class="text-xs text-text-muted mt-1">Tips, nozzles, grinding discs</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Shielding Gas ($)</label>
          <input type="number" id="wc2-gas" class="wc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="25" min="0" step="5">
        </div>
      </div>

      <h3 class="font-semibold text-text mb-4">Overhead</h3>
      <div class="grid grid-cols-2 gap-4 mb-3">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Electricity Cost ($)</label>
          <input type="number" id="wc2-elec" class="wc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="8" min="0" step="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Equipment Depreciation ($)</label>
          <input type="number" id="wc2-equip" class="wc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="10" min="0" step="5">
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Overhead Rate (%)</label>
          <input type="number" id="wc2-overhead" class="wc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="15" min="0" max="100" step="5">
          <p class="text-xs text-text-muted mt-1">Shop, insurance, admin</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Profit Margin (%)</label>
          <input type="number" id="wc2-margin" class="wc2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="0" max="100" step="5">
        </div>
      </div>

      <!-- Results -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Job Price</div>
        <div class="text-4xl font-extrabold" id="wc2-total">--</div>
        <div class="text-sm text-blue-200 mt-1">including profit margin</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Labor Cost</div>
          <div class="text-xl font-bold" id="wc2-laborcost">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Material Cost</div>
          <div class="text-xl font-bold" id="wc2-matcost">--</div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Overhead</div>
          <div class="text-xl font-bold" id="wc2-overheadcost">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Profit</div>
          <div class="text-xl font-bold" id="wc2-profitcost">--</div>
        </div>
      </div>

      <div class="p-4 bg-surface-alt rounded-xl text-center mb-6">
        <div class="text-xs text-text-muted uppercase">Cost Per Hour (all-in)</div>
        <div class="text-xl font-bold" id="wc2-perhour">--</div>
      </div>

      <ShareButton calculatorId="welding-cost" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Estimate Welding Job Costs</h2>
      <p>A complete welding cost estimate includes direct costs (labor, materials, gas) and indirect costs (overhead, equipment depreciation, shop expenses). Adding a profit margin gives the final job price.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Cost Breakdown Tips</h3>
      <ul>
        <li><strong>Labor:</strong> Typically 50-70% of total cost. Include setup, tack welding, grinding, and cleanup time.</li>
        <li><strong>Materials:</strong> Include base metal, filler metal, and consumables (tips, nozzles, grinding discs).</li>
        <li><strong>Gas:</strong> Based on flow rate and arc-on time. Use the Gas Calculator for precise estimates.</li>
        <li><strong>Overhead:</strong> 10-25% covers shop rent, insurance, admin, and safety equipment.</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcWC2() {
      const laborRate = parseFloat((document.getElementById('wc2-labor') as HTMLInputElement).value) || 0;
      const hours = parseFloat((document.getElementById('wc2-hours') as HTMLInputElement).value) || 0;
      const filler = parseFloat((document.getElementById('wc2-filler') as HTMLInputElement).value) || 0;
      const base = parseFloat((document.getElementById('wc2-base') as HTMLInputElement).value) || 0;
      const consumables = parseFloat((document.getElementById('wc2-consumables') as HTMLInputElement).value) || 0;
      const gas = parseFloat((document.getElementById('wc2-gas') as HTMLInputElement).value) || 0;
      const elec = parseFloat((document.getElementById('wc2-elec') as HTMLInputElement).value) || 0;
      const equip = parseFloat((document.getElementById('wc2-equip') as HTMLInputElement).value) || 0;
      const overheadPct = (parseFloat((document.getElementById('wc2-overhead') as HTMLInputElement).value) || 0) / 100;
      const marginPct = (parseFloat((document.getElementById('wc2-margin') as HTMLInputElement).value) || 0) / 100;

      const laborCost = laborRate * hours;
      const materialCost = filler + base + consumables + gas;
      const directCosts = laborCost + materialCost + elec + equip;
      const overhead = directCosts * overheadPct;
      const subtotal = directCosts + overhead;
      const profit = subtotal * marginPct;
      const total = subtotal + profit;
      const perHour = hours > 0 ? total / hours : 0;

      const fmt = (n: number) => '$' + n.toFixed(2);

      document.getElementById('wc2-total')!.textContent = fmt(total);
      document.getElementById('wc2-laborcost')!.textContent = fmt(laborCost);
      document.getElementById('wc2-matcost')!.textContent = fmt(materialCost);
      document.getElementById('wc2-overheadcost')!.textContent = fmt(overhead);
      document.getElementById('wc2-profitcost')!.textContent = fmt(profit);
      document.getElementById('wc2-perhour')!.textContent = fmt(perHour);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.wc2-in').forEach(el => {
        el.addEventListener('input', calcWC2);
        el.addEventListener('change', calcWC2);
      });
      calcWC2();
    }, 50);
  </script>
</CalculatorLayout>
