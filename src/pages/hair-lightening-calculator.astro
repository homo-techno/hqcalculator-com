---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Hair Lightening Calculator - Bleach Mixing & Processing Time";
const description = "Calculate bleach mixing ratios, developer volume, and processing time for your target lift level. Includes damage assessment and toner recommendations.";
const relatedCalcs = [
  { name: "Hair Developer Calculator", url: "/hair-developer-calculator", description: "Developer volume selection." },
  { name: "Hair Color Mixing Calculator", url: "/hair-color-mixing-calculator", description: "Hair dye mixing ratios." },
  { name: "Hair Porosity Calculator", url: "/hair-porosity-calculator", description: "Porosity assessment." },
  { name: "Hair Growth Calculator", url: "/hair-growth-calculator", description: "Growth rate projection." },
  { name: "Hair Extension Calculator", url: "/hair-extension-calculator", description: "Extension bundle count." },
  { name: "Chemical Peel Calculator", url: "/chemical-peel-calculator", description: "Peel depth and recovery." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Hair Lightening Calculator" keywords="hair lightening, bleach ratio, bleach hair, developer volume, lift levels, hair bleaching, processing time" breadcrumbs={[{ name: "Hair Lightening", url: "/hair-lightening-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Hair Lightening Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate bleach mixing ratio and processing time for your target lift level.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Current Level</label>
            <select id="hlt-current" class="hlt-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="1">1 - Black</option>
              <option value="2">2 - Darkest Brown</option>
              <option value="3">3 - Dark Brown</option>
              <option value="4" selected>4 - Medium Brown</option>
              <option value="5">5 - Light Brown</option>
              <option value="6">6 - Dark Blonde</option>
              <option value="7">7 - Medium Blonde</option>
              <option value="8">8 - Light Blonde</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Target Level</label>
            <select id="hlt-target" class="hlt-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="6">6 - Dark Blonde</option>
              <option value="7">7 - Medium Blonde</option>
              <option value="8" selected>8 - Light Blonde</option>
              <option value="9">9 - Very Light Blonde</option>
              <option value="10">10 - Lightest Blonde / Platinum</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Bleach Type</label>
          <select id="hlt-bleach" class="hlt-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="powder" selected>Powder Lightener (standard)</option>
            <option value="clay">Clay Lightener (gentle)</option>
            <option value="oil">Oil Lightener (conditioning)</option>
            <option value="cream">Cream Lightener (balayage)</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Hair Condition</label>
          <select id="hlt-condition" class="hlt-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="virgin">Virgin (never processed)</option>
            <option value="healthy" selected>Healthy (minimal damage)</option>
            <option value="colored">Previously colored</option>
            <option value="damaged">Previously bleached / damaged</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Bleach Amount (g)</label><input type="number" id="hlt-amount" class="hlt-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="30" min="10" max="200" step="5"></div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Scalp Sensitivity</label>
            <select id="hlt-scalp" class="hlt-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="low">Low sensitivity</option>
              <option value="normal" selected>Normal</option>
              <option value="high">High sensitivity</option>
            </select>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Developer</div>
          <div class="text-5xl font-extrabold font-mono" id="hlt-developer">--</div>
          <div class="text-sm text-blue-200 mt-1" id="hlt-ratio">Mixing ratio: --</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Bleach Powder</div><div class="text-xl font-bold" id="hlt-powder">0 g</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Developer Amount</div><div class="text-xl font-bold" id="hlt-devamt">0 g</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Processing Time</div><div class="text-xl font-bold" id="hlt-time">-- min</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Lift Levels</div><div class="text-xl font-bold" id="hlt-lift">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Damage Risk</div><div class="text-xl font-bold" id="hlt-risk">--</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Underlying Pigment</div><div class="text-xl font-bold" id="hlt-pigment">--</div></div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Toner Recommendation</h3>
          <div class="text-sm space-y-1" id="hlt-toner"></div>
        </div>
      </div>
      <ShareButton calculatorId="hair-lightening" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Hair Lightening Guide</h2>
      <p>Hair lightening (bleaching) removes natural melanin pigment to achieve lighter shades. Standard mixing ratio for powder lightener is 1:2 (bleach to developer). Developer volume determines lift power: 20 vol for 1-2 levels, 30 vol for 2-3, and 40 vol for 3-4 levels. Never exceed 45 minutes processing time. Each hair level reveals underlying pigments (red, orange, yellow, pale yellow) that need toning for a clean result. Always do a strand test first.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcHLT() {
      const current = parseInt((document.getElementById('hlt-current') as HTMLSelectElement).value);
      const target = parseInt((document.getElementById('hlt-target') as HTMLSelectElement).value);
      const bleachType = (document.getElementById('hlt-bleach') as HTMLSelectElement).value;
      const condition = (document.getElementById('hlt-condition') as HTMLSelectElement).value;
      const amount = parseFloat((document.getElementById('hlt-amount') as HTMLInputElement).value) || 30;
      const scalp = (document.getElementById('hlt-scalp') as HTMLSelectElement).value;

      const lift = Math.max(0, target - current);

      let devVol = '20 Volume';
      let devRatio = 2;
      if (lift <= 2) { devVol = '20 Volume'; devRatio = 2; }
      else if (lift <= 4) { devVol = '30 Volume'; devRatio = 2; }
      else { devVol = '40 Volume'; devRatio = 2; }

      if (bleachType === 'clay' || bleachType === 'oil') {
        if (devVol === '40 Volume') devVol = '30 Volume';
        devRatio = bleachType === 'oil' ? 1.5 : 2;
      }
      if (bleachType === 'cream') devRatio = 1;

      if (condition === 'damaged') {
        if (devVol === '40 Volume') devVol = '30 Volume';
        else if (devVol === '30 Volume') devVol = '20 Volume';
      }

      const devAmount = amount * devRatio;
      const totalMix = amount + devAmount;

      let processTime = '25-35';
      if (lift <= 2) processTime = '20-30';
      else if (lift <= 4) processTime = '30-40';
      else processTime = '35-45';

      if (condition === 'damaged') processTime = 'Max 25';
      if (scalp === 'high') processTime += ' (check every 5 min)';

      let risk = 'Moderate';
      if (lift <= 2 && condition === 'virgin') risk = 'Low';
      else if (lift <= 2) risk = 'Low-Moderate';
      else if (lift <= 4) risk = 'Moderate';
      else risk = 'High';
      if (condition === 'damaged') risk = 'Very High';

      const pigments: Record<number,string> = {
        1:'Red',2:'Red',3:'Red-Orange',4:'Orange',5:'Orange-Yellow',
        6:'Yellow-Orange',7:'Yellow',8:'Pale Yellow',9:'Very Pale Yellow',10:'Lightest Pale Yellow'
      };
      const underlyingPigment = pigments[target] || 'Yellow';

      const toner: string[] = [];
      if (target >= 9) {
        toner.push('Use a violet-based toner to neutralize pale yellow.');
        toner.push('Recommended: Level 10 ash or pearl toner with 10 vol developer.');
      } else if (target >= 7) {
        toner.push('Use a violet/blue-based toner to neutralize yellow/gold.');
        toner.push('Recommended: Ash blonde toner or purple shampoo maintenance.');
      } else if (target >= 5) {
        toner.push('Use a blue/green-based toner to neutralize orange/copper tones.');
        toner.push('Recommended: Ash or cool-toned demi-permanent color.');
      }
      toner.push('Wait 24-48 hours after bleaching before toning if hair feels compromised.');

      document.getElementById('hlt-developer')!.textContent = devVol;
      document.getElementById('hlt-ratio')!.textContent = 'Mixing ratio: 1:' + devRatio;
      document.getElementById('hlt-powder')!.textContent = amount + ' g';
      document.getElementById('hlt-devamt')!.textContent = Math.round(devAmount) + ' g';
      document.getElementById('hlt-time')!.textContent = processTime + ' min';
      document.getElementById('hlt-lift')!.textContent = lift.toString();
      document.getElementById('hlt-risk')!.textContent = risk;
      document.getElementById('hlt-pigment')!.textContent = underlyingPigment;
      document.getElementById('hlt-toner')!.innerHTML = toner.map(t => '<p>' + t + '</p>').join('');
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.hlt-in').forEach(el => { el.addEventListener('input', calcHLT); el.addEventListener('change', calcHLT); });
      calcHLT();
    }, 50);
  </script>
</CalculatorLayout>
