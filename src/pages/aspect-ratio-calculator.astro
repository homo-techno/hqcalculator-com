---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Aspect Ratio Calculator - Resize & Calculate Dimensions";
const description = "Calculate aspect ratios, resize images proportionally, and find missing dimensions. Supports all common aspect ratios.";

const relatedCalcs = [
  { name: "Screen Size", url: "/screen-size-calculator", description: "Display sizes." },
  { name: "Ratio Calculator", url: "/ratio-calculator", description: "Ratios." },
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentages." },
  { name: "Square Footage", url: "/square-footage-calculator", description: "Area calculator." },
  { name: "Color Converter", url: "/color-converter", description: "Color formats." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Aspect Ratio Calculator"
  keywords="aspect ratio calculator, image resize, 16:9, aspect ratio converter, video dimensions, resize calculator"
  breadcrumbs={[{ name: "Aspect Ratio", url: "/aspect-ratio-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Aspect Ratio Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate aspect ratios and resize proportionally.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Common Ratios</label>
        <div class="flex flex-wrap gap-2">
          <button class="ar-preset px-3 py-1.5 rounded-lg text-xs font-semibold border border-border hover:bg-surface-alt" data-w="16" data-h="9">16:9</button>
          <button class="ar-preset px-3 py-1.5 rounded-lg text-xs font-semibold border border-border hover:bg-surface-alt" data-w="4" data-h="3">4:3</button>
          <button class="ar-preset px-3 py-1.5 rounded-lg text-xs font-semibold border border-border hover:bg-surface-alt" data-w="21" data-h="9">21:9</button>
          <button class="ar-preset px-3 py-1.5 rounded-lg text-xs font-semibold border border-border hover:bg-surface-alt" data-w="1" data-h="1">1:1</button>
          <button class="ar-preset px-3 py-1.5 rounded-lg text-xs font-semibold border border-border hover:bg-surface-alt" data-w="3" data-h="2">3:2</button>
          <button class="ar-preset px-3 py-1.5 rounded-lg text-xs font-semibold border border-border hover:bg-surface-alt" data-w="9" data-h="16">9:16</button>
          <button class="ar-preset px-3 py-1.5 rounded-lg text-xs font-semibold border border-border hover:bg-surface-alt" data-w="5" data-h="4">5:4</button>
        </div>
      </div>

      <h3 class="font-semibold text-text mb-3">Original Dimensions</h3>
      <div class="grid grid-cols-2 gap-3 mb-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Width</label>
          <input type="number" id="ar-w1" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="1920" min="1" step="1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Height</label>
          <input type="number" id="ar-h1" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="1080" min="1" step="1">
        </div>
      </div>

      <div class="p-4 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Aspect Ratio</div>
        <div class="text-4xl font-extrabold" id="ar-ratio">16:9</div>
        <div class="text-sm text-blue-200 mt-1" id="ar-decimal">= 1.7778</div>
      </div>

      <h3 class="font-semibold text-text mb-3">Resize (lock ratio)</h3>
      <div class="grid grid-cols-2 gap-3 mb-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">New Width</label>
          <input type="number" id="ar-w2" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="1280" min="1" step="1">
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">New Height</label>
          <input type="number" id="ar-h2" class="w-full px-4 py-3 border border-border rounded-xl text-lg" value="720" min="1" step="1">
        </div>
      </div>

      <!-- Visual preview -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-2">Visual Preview</h3>
        <div class="flex items-center justify-center" style="height: 150px;">
          <div id="ar-visual" class="bg-primary/20 border-2 border-primary rounded-lg flex items-center justify-center text-xs text-primary font-bold" style="width: 200px; height: 112px;">
            1920 × 1080
          </div>
        </div>
      </div>

      <!-- Common resolutions -->
      <div class="p-4 bg-surface-alt rounded-xl mb-6">
        <h3 class="font-semibold text-sm text-text mb-2">Common Resolutions</h3>
        <div class="grid grid-cols-2 gap-1 text-xs">
          <div class="flex justify-between p-1"><span>4K UHD</span><span class="font-bold">3840×2160 (16:9)</span></div>
          <div class="flex justify-between p-1"><span>1440p QHD</span><span class="font-bold">2560×1440 (16:9)</span></div>
          <div class="flex justify-between p-1"><span>1080p FHD</span><span class="font-bold">1920×1080 (16:9)</span></div>
          <div class="flex justify-between p-1"><span>720p HD</span><span class="font-bold">1280×720 (16:9)</span></div>
          <div class="flex justify-between p-1"><span>Instagram Post</span><span class="font-bold">1080×1080 (1:1)</span></div>
          <div class="flex justify-between p-1"><span>Instagram Story</span><span class="font-bold">1080×1920 (9:16)</span></div>
        </div>
      </div>

      <ShareButton calculatorId="aspect-ratio" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Understanding Aspect Ratios</h2>
      <p>An aspect ratio describes the proportional relationship between width and height. 16:9 means for every 16 units of width, the height is 9 units.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What's the most common aspect ratio?</strong> 16:9 is the standard for most monitors, TVs, and video content. 9:16 is standard for vertical/mobile video.</p>
      <p><strong>How do I resize without distortion?</strong> Lock the aspect ratio and change only one dimension — the other adjusts automatically.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    let lastEdited = 'w2';

    function gcd(a: number, b: number): number {
      a = Math.abs(Math.round(a)); b = Math.abs(Math.round(b));
      while (b) { [a, b] = [b, a % b]; } return a;
    }

    function calcAR() {
      const w1 = parseInt((document.getElementById('ar-w1') as HTMLInputElement).value) || 1;
      const h1 = parseInt((document.getElementById('ar-h1') as HTMLInputElement).value) || 1;

      const g = gcd(w1, h1);
      const rw = w1 / g;
      const rh = h1 / g;
      const decimal = w1 / h1;

      document.getElementById('ar-ratio')!.textContent = `${rw}:${rh}`;
      document.getElementById('ar-decimal')!.textContent = `= ${decimal.toFixed(4)}`;

      // Update resize
      const ratio = w1 / h1;
      if (lastEdited === 'w2') {
        const w2 = parseInt((document.getElementById('ar-w2') as HTMLInputElement).value) || 1;
        (document.getElementById('ar-h2') as HTMLInputElement).value = String(Math.round(w2 / ratio));
      } else {
        const h2 = parseInt((document.getElementById('ar-h2') as HTMLInputElement).value) || 1;
        (document.getElementById('ar-w2') as HTMLInputElement).value = String(Math.round(h2 * ratio));
      }

      // Visual
      const maxW = 240, maxH = 140;
      let vw: number, vh: number;
      if (ratio > maxW / maxH) { vw = maxW; vh = maxW / ratio; }
      else { vh = maxH; vw = maxH * ratio; }
      const visual = document.getElementById('ar-visual')!;
      visual.style.width = Math.round(vw) + 'px';
      visual.style.height = Math.round(vh) + 'px';
      visual.textContent = `${w1} × ${h1}`;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      ['ar-w1', 'ar-h1'].forEach(id => {
        document.getElementById(id)!.addEventListener('input', () => {
          const w1 = parseInt((document.getElementById('ar-w1') as HTMLInputElement).value) || 1;
          const h1 = parseInt((document.getElementById('ar-h1') as HTMLInputElement).value) || 1;
          const ratio = w1 / h1;
          const w2 = parseInt((document.getElementById('ar-w2') as HTMLInputElement).value) || 1;
          (document.getElementById('ar-h2') as HTMLInputElement).value = String(Math.round(w2 / ratio));
          calcAR();
        });
      });

      document.getElementById('ar-w2')!.addEventListener('input', () => { lastEdited = 'w2'; calcAR(); });
      document.getElementById('ar-h2')!.addEventListener('input', () => { lastEdited = 'h2'; calcAR(); });

      document.querySelectorAll('.ar-preset').forEach(btn => {
        btn.addEventListener('click', () => {
          const w = parseInt((btn as HTMLElement).dataset.w || '16');
          const h = parseInt((btn as HTMLElement).dataset.h || '9');
          const scale = Math.round(1920 / w);
          (document.getElementById('ar-w1') as HTMLInputElement).value = String(w * scale);
          (document.getElementById('ar-h1') as HTMLInputElement).value = String(h * scale);
          lastEdited = 'w2';
          calcAR();
        });
      });

      calcAR();
    }, 50);
  </script>
</CalculatorLayout>
