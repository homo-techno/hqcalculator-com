---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Refrigerant Charge Calculator - System Charge by Type & Line Length";
const description = "Calculate refrigerant charge for HVAC systems based on system type, refrigerant, line set length, and capacity. Get accurate charge amounts in pounds and ounces.";

const relatedCalcs = [
  { name: "Refrigeration Cycle Calculator", url: "/refrigeration-cycle-calculator", description: "COP and EER." },
  { name: "Compressor Calculator", url: "/compressor-calculator", description: "Compressor sizing." },
  { name: "Cooling Load Calculator", url: "/cooling-load-calculator", description: "BTU/hr load." },
  { name: "Chiller Sizing Calculator", url: "/chiller-sizing-calculator", description: "Chiller tonnage." },
  { name: "Cooling Tower Calculator", url: "/cooling-tower-calculator", description: "Tower capacity." },
  { name: "Heat Exchanger Calculator", url: "/heat-exchanger-calculator", description: "Heat transfer." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Refrigerant Charge Calculator"
  keywords="refrigerant charge calculator, R410A charge, R22 charge, line set length, HVAC refrigerant, subcooling, superheat"
  breadcrumbs={[{ name: "Refrigerant Charge Calculator", url: "/refrigerant-charge-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Refrigerant Charge Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate refrigerant charge based on system type, refrigerant, and line set length.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-5">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Refrigerant Type</label>
            <select id="rch-type" class="rch-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="R410A" selected>R-410A</option>
              <option value="R22">R-22</option>
              <option value="R134a">R-134a</option>
              <option value="R404A">R-404A</option>
              <option value="R407C">R-407C</option>
              <option value="R32">R-32</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">System Type</label>
            <select id="rch-system" class="rch-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="split" selected>Split System</option>
              <option value="package">Package Unit</option>
              <option value="mini">Mini-Split</option>
              <option value="commercial">Commercial RTU</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">System Capacity (tons)</label>
            <input type="number" id="rch-capacity" class="rch-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3" min="0.5" max="50" step="0.5">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Line Set Length (ft)</label>
            <input type="number" id="rch-lineset" class="rch-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="25" min="5" max="200" step="5">
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Factory Line Length (ft)</label>
            <input type="number" id="rch-factory" class="rch-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="15" min="5" max="50" step="5">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Liquid Line Diameter (in)</label>
            <select id="rch-diameter" class="rch-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="0.25">1/4"</option>
              <option value="0.3125" selected>5/16"</option>
              <option value="0.375">3/8"</option>
              <option value="0.5">1/2"</option>
              <option value="0.625">5/8"</option>
            </select>
          </div>
        </div>

        <!-- Results -->
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Refrigerant Charge</div>
          <div class="text-4xl font-extrabold" id="rch-total">--</div>
          <div class="text-sm text-blue-200 mt-1">pounds (lbs)</div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Factory Charge</div>
            <div class="text-xl font-bold" id="rch-factoryCharge">--</div>
            <div class="text-xs text-text-muted">lbs</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Additional Charge</div>
            <div class="text-xl font-bold" id="rch-additional">--</div>
            <div class="text-xs text-text-muted">lbs (for extra line)</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total in Ounces</div>
            <div class="text-xl font-bold" id="rch-oz">--</div>
            <div class="text-xs text-text-muted">oz</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total in kg</div>
            <div class="text-xl font-bold" id="rch-kg">--</div>
            <div class="text-xs text-text-muted">kilograms</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <div class="text-xs text-text-muted uppercase mb-1">Charge Rate per Extra Foot</div>
          <div class="text-xl font-bold" id="rch-rate">--</div>
        </div>
      </div>

      <ShareButton calculatorId="refrigerant-charge" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl mx-auto prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How Refrigerant Charge Is Calculated</h2>
      <p>The total refrigerant charge consists of the factory charge (pre-loaded) plus additional charge for line set length beyond the factory default. The additional charge depends on the liquid line diameter and refrigerant type.</p>
      <ul>
        <li><strong>Factory charge:</strong> Typically based on system capacity (about 2-4 lbs per ton depending on system type)</li>
        <li><strong>Additional charge:</strong> Added per foot of liquid line beyond the factory default length</li>
        <li><strong>R-410A:</strong> ~0.6 oz/ft for 3/8" liquid line</li>
        <li><strong>R-22:</strong> ~0.5 oz/ft for 3/8" liquid line</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcRCH() {
      const refType = (document.getElementById('rch-type') as HTMLSelectElement).value;
      const sysType = (document.getElementById('rch-system') as HTMLSelectElement).value;
      const capacity = parseFloat((document.getElementById('rch-capacity') as HTMLInputElement).value) || 0;
      const lineSet = parseFloat((document.getElementById('rch-lineset') as HTMLInputElement).value) || 0;
      const factoryLen = parseFloat((document.getElementById('rch-factory') as HTMLInputElement).value) || 0;
      const diameter = parseFloat((document.getElementById('rch-diameter') as HTMLSelectElement).value) || 0.375;

      // Factory charge per ton (lbs/ton) by system type
      const factoryPerTon: Record<string, number> = { split: 2.5, package: 3.0, mini: 2.0, commercial: 3.5 };
      const factoryCharge = capacity * (factoryPerTon[sysType] || 2.5);

      // Charge rate per foot by refrigerant and line diameter (oz/ft)
      // Based on liquid density in line
      const baseRates: Record<string, number> = {
        R410A: 0.6, R22: 0.5, R134a: 0.45, R404A: 0.65, R407C: 0.55, R32: 0.5
      };
      const baseRate = baseRates[refType] || 0.6;
      // Scale by diameter ratio (base is 3/8")
      const diameterFactor = (diameter / 0.375) ** 2;
      const ratePerFoot = baseRate * diameterFactor; // oz per foot

      const extraLength = Math.max(0, lineSet - factoryLen);
      const additionalOz = extraLength * ratePerFoot;
      const additionalLbs = additionalOz / 16;

      const totalLbs = factoryCharge + additionalLbs;
      const totalOz = totalLbs * 16;
      const totalKg = totalLbs * 0.453592;

      document.getElementById('rch-total')!.textContent = totalLbs.toFixed(2);
      document.getElementById('rch-factoryCharge')!.textContent = factoryCharge.toFixed(2);
      document.getElementById('rch-additional')!.textContent = additionalLbs.toFixed(2);
      document.getElementById('rch-oz')!.textContent = totalOz.toFixed(1);
      document.getElementById('rch-kg')!.textContent = totalKg.toFixed(2);
      document.getElementById('rch-rate')!.textContent = ratePerFoot.toFixed(2) + ' oz/ft';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.rch-in').forEach(el => {
        el.addEventListener('input', calcRCH);
        el.addEventListener('change', calcRCH);
      });
      calcRCH();
    }, 50);
  </script>
</CalculatorLayout>
