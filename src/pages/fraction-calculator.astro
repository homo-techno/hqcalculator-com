---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Fraction Calculator - Add, Subtract, Multiply, Divide Fractions";
const description = "Free fraction calculator. Add, subtract, multiply, and divide fractions and mixed numbers. Simplify fractions instantly. Step-by-step solutions.";

const relatedCalcs = [
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Convert fractions to percentages." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math operations." },
  { name: "GPA Calculator", url: "/gpa-calculator", description: "Calculate your grade point average." },
  { name: "Square Root Calculator", url: "/square-root-calculator", description: "Find square roots instantly." },
  { name: "LCM Calculator", url: "/lcm-calculator", description: "Least common multiple." },
  { name: "GCF Calculator", url: "/gcf-calculator", description: "Greatest common factor." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Fraction Calculator"
  keywords="fraction calculator, add fractions, subtract fractions, multiply fractions, divide fractions, simplify fractions, mixed number calculator"
  breadcrumbs={[{ name: "Fraction Calculator", url: "/fraction-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Fraction Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Add, subtract, multiply, and divide fractions and mixed numbers with step-by-step solutions.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <!-- Operation Tabs -->
      <div class="flex flex-wrap gap-2 mb-8">
        <button class="frac-op-btn px-4 py-2 rounded-full text-sm font-semibold bg-primary text-white" data-op="+">Add (+)</button>
        <button class="frac-op-btn px-4 py-2 rounded-full text-sm font-semibold bg-surface-alt text-text-secondary" data-op="-">Subtract (−)</button>
        <button class="frac-op-btn px-4 py-2 rounded-full text-sm font-semibold bg-surface-alt text-text-secondary" data-op="*">Multiply (×)</button>
        <button class="frac-op-btn px-4 py-2 rounded-full text-sm font-semibold bg-surface-alt text-text-secondary" data-op="/">Divide (÷)</button>
      </div>

      <!-- Fraction Inputs -->
      <div class="flex flex-wrap items-center justify-center gap-4 mb-8">
        <!-- Fraction A -->
        <div class="flex items-center gap-2">
          <input type="number" id="frac-a-whole" class="w-16 px-2 py-2 border border-border rounded-lg text-center text-lg" placeholder="0" title="Whole number (optional)">
          <div class="flex flex-col items-center">
            <input type="number" id="frac-a-num" class="w-16 px-2 py-2 border border-border rounded-lg text-center text-lg" placeholder="1" value="1" title="Numerator">
            <div class="w-14 h-0.5 bg-text my-1"></div>
            <input type="number" id="frac-a-den" class="w-16 px-2 py-2 border border-border rounded-lg text-center text-lg" placeholder="2" value="2" title="Denominator">
          </div>
        </div>

        <!-- Operator -->
        <div class="text-3xl font-bold text-primary" id="frac-operator">+</div>

        <!-- Fraction B -->
        <div class="flex items-center gap-2">
          <input type="number" id="frac-b-whole" class="w-16 px-2 py-2 border border-border rounded-lg text-center text-lg" placeholder="0" title="Whole number (optional)">
          <div class="flex flex-col items-center">
            <input type="number" id="frac-b-num" class="w-16 px-2 py-2 border border-border rounded-lg text-center text-lg" placeholder="1" value="1" title="Numerator">
            <div class="w-14 h-0.5 bg-text my-1"></div>
            <input type="number" id="frac-b-den" class="w-16 px-2 py-2 border border-border rounded-lg text-center text-lg" placeholder="3" value="3" title="Denominator">
          </div>
        </div>

        <!-- Equals -->
        <div class="text-3xl font-bold text-text">=</div>

        <!-- Result -->
        <div class="flex items-center gap-2" id="frac-result-display">
          <span class="text-2xl font-bold text-primary" id="frac-result-whole"></span>
          <div class="flex flex-col items-center">
            <span class="text-2xl font-bold text-primary" id="frac-result-num">5</span>
            <div class="w-10 h-0.5 bg-primary my-1" id="frac-result-line"></div>
            <span class="text-2xl font-bold text-primary" id="frac-result-den">6</span>
          </div>
        </div>
      </div>

      <!-- Decimal & Percentage -->
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Decimal</div>
          <div class="text-xl font-bold" id="frac-decimal">0.8333</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Percentage</div>
          <div class="text-xl font-bold" id="frac-percent">83.33%</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Simplified</div>
          <div class="text-xl font-bold text-primary" id="frac-simplified">5/6</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Mixed Number</div>
          <div class="text-xl font-bold" id="frac-mixed">5/6</div>
        </div>
      </div>

      <!-- Step-by-step Solution -->
      <div class="bg-surface-alt rounded-xl p-5 mb-6">
        <h3 class="font-semibold text-text mb-3">Step-by-Step Solution</h3>
        <div id="frac-steps" class="text-sm text-text-secondary space-y-2"></div>
      </div>

      <ShareButton calculatorId="fraction" />
      <FeedbackWidget />
    </div>

    <!-- Simplify Fraction Tool -->
    <div class="mt-12 bg-white border border-border rounded-2xl p-6 sm:p-8">
      <h2 class="text-2xl font-bold text-text mb-4">Simplify a Fraction</h2>
      <div class="flex flex-wrap items-center gap-4">
        <div class="flex flex-col items-center">
          <input type="number" id="simplify-num" class="w-20 px-2 py-2 border border-border rounded-lg text-center text-lg" placeholder="12" value="12">
          <div class="w-16 h-0.5 bg-text my-1"></div>
          <input type="number" id="simplify-den" class="w-20 px-2 py-2 border border-border rounded-lg text-center text-lg" placeholder="18" value="18">
        </div>
        <div class="text-2xl font-bold text-text">=</div>
        <div class="flex flex-col items-center">
          <span class="text-2xl font-bold text-primary" id="simplify-result-num">2</span>
          <div class="w-10 h-0.5 bg-primary my-1"></div>
          <span class="text-2xl font-bold text-primary" id="simplify-result-den">3</span>
        </div>
        <div class="text-sm text-text-secondary ml-4" id="simplify-info">GCF = 6</div>
      </div>
    </div>

    <!-- Fraction to Decimal Table -->
    <div class="mt-12 bg-white border border-border rounded-2xl p-6 sm:p-8">
      <h2 class="text-2xl font-bold text-text mb-4">Common Fractions to Decimals</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-border text-left">
              <th class="py-2 pr-3 font-semibold">Fraction</th>
              <th class="py-2 pr-3 font-semibold">Decimal</th>
              <th class="py-2 pr-3 font-semibold">Percentage</th>
              <th class="py-2 pr-3 font-semibold">Fraction</th>
              <th class="py-2 pr-3 font-semibold">Decimal</th>
              <th class="py-2 font-semibold">Percentage</th>
            </tr>
          </thead>
          <tbody class="text-text-secondary">
            <tr class="border-b border-border/30"><td class="py-2 pr-3 font-medium">1/2</td><td class="py-2 pr-3">0.5</td><td class="py-2 pr-3">50%</td><td class="py-2 pr-3 font-medium">1/8</td><td class="py-2 pr-3">0.125</td><td class="py-2">12.5%</td></tr>
            <tr class="border-b border-border/30"><td class="py-2 pr-3 font-medium">1/3</td><td class="py-2 pr-3">0.333</td><td class="py-2 pr-3">33.33%</td><td class="py-2 pr-3 font-medium">3/8</td><td class="py-2 pr-3">0.375</td><td class="py-2">37.5%</td></tr>
            <tr class="border-b border-border/30"><td class="py-2 pr-3 font-medium">2/3</td><td class="py-2 pr-3">0.667</td><td class="py-2 pr-3">66.67%</td><td class="py-2 pr-3 font-medium">5/8</td><td class="py-2 pr-3">0.625</td><td class="py-2">62.5%</td></tr>
            <tr class="border-b border-border/30"><td class="py-2 pr-3 font-medium">1/4</td><td class="py-2 pr-3">0.25</td><td class="py-2 pr-3">25%</td><td class="py-2 pr-3 font-medium">7/8</td><td class="py-2 pr-3">0.875</td><td class="py-2">87.5%</td></tr>
            <tr class="border-b border-border/30"><td class="py-2 pr-3 font-medium">3/4</td><td class="py-2 pr-3">0.75</td><td class="py-2 pr-3">75%</td><td class="py-2 pr-3 font-medium">1/5</td><td class="py-2 pr-3">0.2</td><td class="py-2">20%</td></tr>
            <tr class="border-b border-border/30"><td class="py-2 pr-3 font-medium">1/6</td><td class="py-2 pr-3">0.167</td><td class="py-2 pr-3">16.67%</td><td class="py-2 pr-3 font-medium">2/5</td><td class="py-2 pr-3">0.4</td><td class="py-2">40%</td></tr>
            <tr class="border-b border-border/30"><td class="py-2 pr-3 font-medium">5/6</td><td class="py-2 pr-3">0.833</td><td class="py-2 pr-3">83.33%</td><td class="py-2 pr-3 font-medium">3/5</td><td class="py-2 pr-3">0.6</td><td class="py-2">60%</td></tr>
            <tr><td class="py-2 pr-3 font-medium">1/10</td><td class="py-2 pr-3">0.1</td><td class="py-2 pr-3">10%</td><td class="py-2 pr-3 font-medium">4/5</td><td class="py-2 pr-3">0.8</td><td class="py-2">80%</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">How to Calculate Fractions</h2>
      <p>A fraction represents a part of a whole. It consists of a numerator (top number) and a denominator (bottom number). This calculator handles all four basic operations: addition, subtraction, multiplication, and division of fractions and mixed numbers.</p>

      <h3 class="text-xl font-semibold text-text mt-8">Adding and Subtracting Fractions</h3>
      <p>To add or subtract fractions, you need a common denominator. Find the least common denominator (LCD), convert each fraction, then add or subtract the numerators.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">
        a/b + c/d = (a&times;d + c&times;b) / (b&times;d)
      </div>
      <p><strong>Example:</strong> 1/4 + 1/3 = 3/12 + 4/12 = 7/12</p>

      <h3 class="text-xl font-semibold text-text mt-8">Multiplying Fractions</h3>
      <p>To multiply fractions, multiply the numerators together and the denominators together. Then simplify the result.</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">
        a/b &times; c/d = (a&times;c) / (b&times;d)
      </div>
      <p><strong>Example:</strong> 2/3 × 3/4 = 6/12 = 1/2</p>

      <h3 class="text-xl font-semibold text-text mt-8">Dividing Fractions</h3>
      <p>To divide fractions, multiply by the reciprocal (flip the second fraction). This is often called "keep, change, flip."</p>
      <div class="bg-surface-alt rounded-xl p-4 my-4 text-center font-mono">
        a/b ÷ c/d = a/b &times; d/c = (a&times;d) / (b&times;c)
      </div>
      <p><strong>Example:</strong> 1/2 ÷ 1/4 = 1/2 × 4/1 = 4/2 = 2</p>

      <h3 class="text-xl font-semibold text-text mt-8">Simplifying Fractions</h3>
      <p>To simplify a fraction, find the greatest common factor (GCF) of the numerator and denominator, then divide both by that number.</p>
      <p><strong>Example:</strong> 12/18 → GCF is 6 → 12÷6 / 18÷6 = 2/3</p>

      <h3 class="text-xl font-semibold text-text mt-8">Mixed Numbers</h3>
      <p>A mixed number combines a whole number with a fraction (e.g., 2 1/3). To calculate with mixed numbers, first convert to an improper fraction: multiply the whole number by the denominator, add the numerator, and keep the same denominator.</p>
      <p><strong>Example:</strong> 2 1/3 = (2×3 + 1)/3 = 7/3</p>

      <h3 class="text-xl font-semibold text-text mt-8">Frequently Asked Questions</h3>
      <p><strong>What is an improper fraction?</strong> An improper fraction has a numerator larger than or equal to the denominator (e.g., 7/3). It can be converted to a mixed number: 7/3 = 2 1/3.</p>
      <p><strong>How do I convert a fraction to a decimal?</strong> Divide the numerator by the denominator. For example, 3/4 = 3 ÷ 4 = 0.75.</p>
      <p><strong>What is the LCD?</strong> The Least Common Denominator is the smallest number that both denominators divide into evenly. For 1/4 and 1/6, the LCD is 12.</p>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function gcd(a: number, b: number): number {
      a = Math.abs(a); b = Math.abs(b);
      while (b) { [a, b] = [b, a % b]; }
      return a;
    }

    function lcm(a: number, b: number): number {
      return Math.abs(a * b) / gcd(a, b);
    }

    interface Frac { num: number; den: number; }

    function simplify(f: Frac): Frac {
      if (f.den === 0) return { num: 0, den: 1 };
      const g = gcd(Math.abs(f.num), Math.abs(f.den));
      let num = f.num / g;
      let den = f.den / g;
      if (den < 0) { num = -num; den = -den; }
      return { num, den };
    }

    function toImproper(whole: number, num: number, den: number): Frac {
      if (den === 0) return { num: 0, den: 1 };
      const sign = whole < 0 ? -1 : 1;
      return { num: sign * (Math.abs(whole) * den + num), den };
    }

    function toMixed(f: Frac): { whole: number; num: number; den: number } {
      const s = simplify(f);
      const whole = Math.trunc(s.num / s.den);
      const rem = Math.abs(s.num % s.den);
      return { whole, num: rem, den: s.den };
    }

    let currentOp = '+';

    function getInput(id: string): number {
      const el = document.getElementById(id) as HTMLInputElement;
      return parseInt(el?.value || '0') || 0;
    }

    function calcFraction() {
      const aWhole = getInput('frac-a-whole');
      const aNum = getInput('frac-a-num');
      const aDen = getInput('frac-a-den') || 1;
      const bWhole = getInput('frac-b-whole');
      const bNum = getInput('frac-b-num');
      const bDen = getInput('frac-b-den') || 1;

      const a = toImproper(aWhole, Math.abs(aNum), aDen);
      const b = toImproper(bWhole, Math.abs(bNum), bDen);

      let result: Frac;
      const steps: string[] = [];

      // Show conversion to improper fractions
      const aStr = `${a.num}/${a.den}`;
      const bStr = `${b.num}/${b.den}`;
      if (aWhole) steps.push(`Convert ${aWhole} ${Math.abs(aNum)}/${aDen} to improper fraction: ${aStr}`);
      if (bWhole) steps.push(`Convert ${bWhole} ${Math.abs(bNum)}/${bDen} to improper fraction: ${bStr}`);

      const opSymbol = currentOp === '+' ? '+' : currentOp === '-' ? '−' : currentOp === '*' ? '×' : '÷';

      switch (currentOp) {
        case '+':
        case '-': {
          const lcd = lcm(a.den, b.den);
          const aNew = a.num * (lcd / a.den);
          const bNew = b.num * (lcd / b.den);
          steps.push(`Find common denominator: LCD(${a.den}, ${b.den}) = ${lcd}`);
          steps.push(`Convert: ${a.num}/${a.den} = ${aNew}/${lcd}`);
          steps.push(`Convert: ${b.num}/${b.den} = ${bNew}/${lcd}`);
          const resNum = currentOp === '+' ? aNew + bNew : aNew - bNew;
          steps.push(`${currentOp === '+' ? 'Add' : 'Subtract'} numerators: ${aNew} ${opSymbol} ${bNew} = ${resNum}`);
          result = { num: resNum, den: lcd };
          break;
        }
        case '*': {
          steps.push(`Multiply numerators: ${a.num} × ${b.num} = ${a.num * b.num}`);
          steps.push(`Multiply denominators: ${a.den} × ${b.den} = ${a.den * b.den}`);
          result = { num: a.num * b.num, den: a.den * b.den };
          break;
        }
        case '/': {
          steps.push(`Flip the second fraction: ${b.num}/${b.den} → ${b.den}/${b.num}`);
          steps.push(`Multiply: ${a.num}/${a.den} × ${b.den}/${b.num}`);
          result = { num: a.num * b.den, den: a.den * b.num };
          break;
        }
        default:
          result = { num: 0, den: 1 };
      }

      const simplified = simplify(result);
      if (result.num !== simplified.num || result.den !== simplified.den) {
        const g = gcd(Math.abs(result.num), Math.abs(result.den));
        steps.push(`Simplify ${result.num}/${result.den}: GCF = ${g}`);
        steps.push(`Result: ${simplified.num}/${simplified.den}`);
      } else {
        steps.push(`Result: ${simplified.num}/${simplified.den}`);
      }

      // Display result
      const mixed = toMixed(simplified);
      const decimal = simplified.den !== 0 ? simplified.num / simplified.den : 0;

      if (simplified.den === 1) {
        // Whole number result
        document.getElementById('frac-result-whole')!.textContent = String(simplified.num);
        document.getElementById('frac-result-num')!.textContent = '';
        document.getElementById('frac-result-den')!.textContent = '';
        document.getElementById('frac-result-line')!.style.display = 'none';
      } else {
        document.getElementById('frac-result-line')!.style.display = '';
        if (mixed.whole !== 0) {
          document.getElementById('frac-result-whole')!.textContent = String(mixed.whole) + ' ';
          document.getElementById('frac-result-num')!.textContent = String(mixed.num);
          document.getElementById('frac-result-den')!.textContent = String(mixed.den);
        } else {
          document.getElementById('frac-result-whole')!.textContent = '';
          document.getElementById('frac-result-num')!.textContent = String(simplified.num);
          document.getElementById('frac-result-den')!.textContent = String(simplified.den);
        }
      }

      document.getElementById('frac-decimal')!.textContent = decimal.toFixed(4).replace(/0+$/, '').replace(/\.$/, '');
      document.getElementById('frac-percent')!.textContent = (decimal * 100).toFixed(2) + '%';
      document.getElementById('frac-simplified')!.textContent = simplified.den === 1 ? String(simplified.num) : `${simplified.num}/${simplified.den}`;

      if (mixed.whole !== 0 && mixed.num !== 0) {
        document.getElementById('frac-mixed')!.textContent = `${mixed.whole} ${mixed.num}/${mixed.den}`;
      } else if (mixed.whole !== 0) {
        document.getElementById('frac-mixed')!.textContent = String(mixed.whole);
      } else {
        document.getElementById('frac-mixed')!.textContent = `${simplified.num}/${simplified.den}`;
      }

      // Steps
      document.getElementById('frac-steps')!.innerHTML = steps.map((s, i) =>
        `<div class="flex gap-2"><span class="text-primary font-bold">${i + 1}.</span><span>${s}</span></div>`
      ).join('');

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    function calcSimplify() {
      const num = getInput('simplify-num');
      const den = getInput('simplify-den') || 1;
      const g = gcd(Math.abs(num), Math.abs(den));
      const sNum = num / g;
      const sDen = den / g;
      document.getElementById('simplify-result-num')!.textContent = String(den < 0 ? -sNum : sNum);
      document.getElementById('simplify-result-den')!.textContent = String(Math.abs(sDen));
      document.getElementById('simplify-info')!.textContent = `GCF = ${g}`;
    }

    setTimeout(() => {
      // Operation buttons
      document.querySelectorAll('.frac-op-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.frac-op-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-surface-alt', 'text-text-secondary');
          });
          btn.classList.remove('bg-surface-alt', 'text-text-secondary');
          btn.classList.add('bg-primary', 'text-white');
          currentOp = (btn as HTMLElement).dataset.op || '+';
          const symbols: Record<string, string> = { '+': '+', '-': '−', '*': '×', '/': '÷' };
          document.getElementById('frac-operator')!.textContent = symbols[currentOp] || '+';
          calcFraction();
        });
      });

      // All fraction inputs
      ['frac-a-whole', 'frac-a-num', 'frac-a-den', 'frac-b-whole', 'frac-b-num', 'frac-b-den'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcFraction);
      });

      // Simplify inputs
      ['simplify-num', 'simplify-den'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', calcSimplify);
      });

      calcFraction();
      calcSimplify();
    }, 50);
  </script>
</CalculatorLayout>
