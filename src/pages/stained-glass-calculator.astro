---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Stained Glass Calculator - Materials, Lead Came & Solder";
const description = "Calculate stained glass project materials including glass area, lead came, solder, flux, and copper foil. Plan your project with accurate estimates.";
const relatedCalcs = [
  { name: "Glass Thickness Calculator", url: "/glass-thickness-calculator", description: "Glass thickness for loads." },
  { name: "Glass Cutting Calculator", url: "/glass-cutting-calculator", description: "Glass cutting optimization." },
  { name: "Glass Fusing Calculator", url: "/glass-fusing-calculator", description: "Glass fusing schedules." },
  { name: "Mosaic Grout Calculator", url: "/mosaic-grout-calculator", description: "Grout quantities." },
  { name: "Glass Annealing Calculator", url: "/glass-annealing-calculator", description: "Annealing schedules." },
  { name: "Pottery Pricing Calculator", url: "/pottery-pricing-calculator", description: "Price craft projects." },
];
---
<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Stained Glass Calculator"
  keywords="stained glass, lead came, solder, copper foil, stained glass materials, glass project, stained glass supplies"
  breadcrumbs={[{ name: "Stained Glass Calculator", url: "/stained-glass-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Stained Glass Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate materials needed for your stained glass project including glass, came, solder, flux, and copper foil.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-medium text-text mb-2">Panel Width (inches)</label>
          <input type="number" id="sg2-width" class="sg2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="18" min="1" step="0.5">
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-2">Panel Height (inches)</label>
          <input type="number" id="sg2-height" class="sg2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="24" min="1" step="0.5">
        </div>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Number of Pieces</label>
        <input type="number" id="sg2-pieces" class="sg2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="25" min="1" step="1">
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Technique</label>
        <select id="sg2-technique" class="sg2-in w-full px-4 py-3 border border-border rounded-xl text-lg">
          <option value="lead" selected>Lead Came</option>
          <option value="copper">Copper Foil (Tiffany)</option>
        </select>
      </div>

      <div class="mb-5">
        <label class="block text-sm font-medium text-text mb-2">Waste Factor (%)</label>
        <input type="number" id="sg2-waste" class="sg2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="0" max="50" step="5">
      </div>

      <!-- Primary Result -->
      <div class="p-6 bg-primary rounded-2xl text-white text-center mb-4">
        <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Glass Needed</div>
        <div class="text-4xl font-extrabold" id="sg2-glass">--</div>
        <div class="text-sm text-blue-200 mt-1">square feet (including waste)</div>
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Panel Area</div>
          <div class="text-xl font-bold" id="sg2-area">--</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Avg Piece Size</div>
          <div class="text-xl font-bold" id="sg2-avg">--</div>
        </div>
      </div>

      <div class="mb-4" id="sg2-lead-section">
        <h3 class="font-semibold text-text mb-3">Lead Came Materials</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Lead Came</div>
            <div class="text-xl font-bold" id="sg2-came">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Solder (60/40)</div>
            <div class="text-xl font-bold" id="sg2-solder">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Flux</div>
            <div class="text-xl font-bold" id="sg2-flux">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Putty / Cement</div>
            <div class="text-xl font-bold" id="sg2-putty">--</div>
          </div>
        </div>
      </div>

      <div class="mb-4 hidden" id="sg2-copper-section">
        <h3 class="font-semibold text-text mb-3">Copper Foil Materials</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Copper Foil</div>
            <div class="text-xl font-bold" id="sg2-foil">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Solder (60/40)</div>
            <div class="text-xl font-bold" id="sg2-cf-solder">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Flux</div>
            <div class="text-xl font-bold" id="sg2-cf-flux">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Patina</div>
            <div class="text-xl font-bold" id="sg2-patina">--</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="stained-glass" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Stained Glass Material Planning</h2>
      <p>Accurate material estimation prevents waste and ensures you have everything needed to complete your project. Allow 15-25% extra glass for waste from cutting, and always buy slightly more came or foil than calculated.</p>
      <h3 class="text-xl font-semibold text-text mt-8">Lead Came vs Copper Foil</h3>
      <ul>
        <li><strong>Lead Came:</strong> Traditional technique, stronger for large panels, uses H-channel and U-channel strips</li>
        <li><strong>Copper Foil:</strong> Tiffany method, better for intricate detail work, each piece is wrapped in foil then soldered</li>
      </ul>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcSG2() {
      const w = parseFloat((document.getElementById('sg2-width') as HTMLInputElement).value) || 18;
      const h = parseFloat((document.getElementById('sg2-height') as HTMLInputElement).value) || 24;
      const pieces = parseInt((document.getElementById('sg2-pieces') as HTMLInputElement).value) || 25;
      const technique = (document.getElementById('sg2-technique') as HTMLSelectElement).value;
      const wastePct = (parseFloat((document.getElementById('sg2-waste') as HTMLInputElement).value) || 0) / 100;

      const panelAreaSqIn = w * h;
      const panelAreaSqFt = panelAreaSqIn / 144;
      const glassWithWaste = panelAreaSqFt * (1 + wastePct);
      const avgPieceSqIn = panelAreaSqIn / pieces;

      document.getElementById('sg2-glass')!.textContent = glassWithWaste.toFixed(2) + ' sq ft';
      document.getElementById('sg2-area')!.textContent = panelAreaSqFt.toFixed(2) + ' sq ft';
      document.getElementById('sg2-avg')!.textContent = avgPieceSqIn.toFixed(1) + ' sq in';

      // Show/hide technique sections
      document.getElementById('sg2-lead-section')!.classList.toggle('hidden', technique !== 'lead');
      document.getElementById('sg2-copper-section')!.classList.toggle('hidden', technique !== 'copper');

      if (technique === 'lead') {
        // Estimate internal came: avg piece perimeter * pieces / 2 (shared edges) + perimeter
        const avgPiecePerim = 4 * Math.sqrt(avgPieceSqIn); // approximate square root for avg perimeter
        const internalCame = (avgPiecePerim * pieces) / 2; // shared edges
        const perimeterCame = 2 * (w + h);
        const totalCameIn = internalCame + perimeterCame;
        const totalCameFt = totalCameIn / 12;

        // Came comes in 6-foot strips
        const cameStrips = Math.ceil(totalCameFt / 6);

        // Solder: approximately 1 oz per 2 joints, each piece has ~4 corners, shared = pieces * 4 / 2
        const joints = pieces * 2; // approximate joint count
        const solderOz = joints * 0.5;

        // Flux: about 2 oz per sq ft of panel
        const fluxOz = panelAreaSqFt * 2;

        // Putty: about 4 oz per sq ft
        const puttyOz = panelAreaSqFt * 4;

        document.getElementById('sg2-came')!.textContent = totalCameFt.toFixed(0) + ' ft (' + cameStrips + ' strips)';
        document.getElementById('sg2-solder')!.textContent = (solderOz / 16).toFixed(1) + ' lbs';
        document.getElementById('sg2-flux')!.textContent = fluxOz.toFixed(1) + ' oz';
        document.getElementById('sg2-putty')!.textContent = puttyOz.toFixed(1) + ' oz';
      } else {
        // Copper foil: each piece gets wrapped, so total perimeter of all pieces
        const avgPiecePerim = 4 * Math.sqrt(avgPieceSqIn);
        const totalFoilIn = avgPiecePerim * pieces;
        const totalFoilFt = totalFoilIn / 12;

        // Foil comes in 36-yard rolls
        const foilRolls = Math.ceil(totalFoilFt / 108);

        // Solder: more solder for copper foil method, ~1 oz per linear foot of seam
        const seamFt = totalFoilFt / 2; // shared seams
        const solderOz = seamFt * 1.0;

        // Flux
        const fluxOz = panelAreaSqFt * 3;

        // Patina
        const patinaOz = panelAreaSqFt * 2;

        document.getElementById('sg2-foil')!.textContent = totalFoilFt.toFixed(0) + ' ft (' + foilRolls + ' rolls)';
        document.getElementById('sg2-cf-solder')!.textContent = (solderOz / 16).toFixed(1) + ' lbs';
        document.getElementById('sg2-cf-flux')!.textContent = fluxOz.toFixed(1) + ' oz';
        document.getElementById('sg2-patina')!.textContent = patinaOz.toFixed(1) + ' oz';
      }

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.sg2-in').forEach(el => {
        el.addEventListener('input', calcSG2);
        el.addEventListener('change', calcSG2);
      });
      calcSG2();
    }, 50);
  </script>
</CalculatorLayout>
