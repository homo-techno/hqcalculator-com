---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Geothermal Calculator - System Size, Cost & Payback";
const description = "Calculate geothermal heat pump system size, loop length, installation cost, annual savings, and payback period for your home.";
const relatedCalcs = [
  { name: "Heat Pump", url: "/heat-pump-calculator", description: "Air-source heat pumps." },
  { name: "Solar Panel", url: "/solar-panel-calculator", description: "Solar." },
  { name: "BTU Calculator", url: "/btu-calculator", description: "BTU sizing." },
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Electricity." },
  { name: "Carbon Footprint", url: "/carbon-footprint-calculator", description: "Carbon." },
  { name: "Wind Power", url: "/wind-power-calculator", description: "Wind energy." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Geothermal Calculator" keywords="geothermal calculator, geothermal heat pump, ground source, loop length, geothermal cost, geothermal savings" breadcrumbs={[{ name: "Geothermal", url: "/geothermal-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Geothermal Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your geothermal system size, cost, and return on investment.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Home Size (sq ft)</label><input type="number" id="gt-sqft" class="gt-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2500" min="500" step="100"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Heating Load (BTU/hr)</label><input type="number" id="gt-heat" class="gt-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="60000" min="10000" step="5000"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Cooling Load (BTU/hr)</label><input type="number" id="gt-cool" class="gt-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="48000" min="10000" step="5000"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Ground Temp (F)</label><input type="number" id="gt-temp" class="gt-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="55" min="40" max="75" step="1"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Loop Type</label>
            <select id="gt-loop" class="gt-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="horizontal">Horizontal</option>
              <option value="vertical" selected>Vertical</option>
              <option value="pond">Pond/Lake</option>
            </select>
          </div>
          <div><label class="block text-xs font-medium text-text mb-1">Current Heating+Cooling ($/yr)</label><input type="number" id="gt-current" class="gt-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="3500" min="0" step="100"></div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Electricity Rate ($/kWh)</label><input type="number" id="gt-elec" class="gt-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0.13" min="0.01" step="0.01"></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">System Size</div>
          <div class="text-5xl font-extrabold font-mono" id="gt-tons">0</div>
          <div class="text-sm text-blue-200 mt-1">tons capacity</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Loop Length</div><div class="text-xl font-bold" id="gt-length">0 ft</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Installation Cost</div><div class="text-xl font-bold" id="gt-install">$0</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Annual Savings</div><div class="text-xl font-bold" id="gt-savings">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Payback Period</div><div class="text-xl font-bold" id="gt-payback">0 yrs</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">After 30% Tax Credit</div><div class="text-xl font-bold" id="gt-credit">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Annual Operating Cost</div><div class="text-xl font-bold" id="gt-opcost">$0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="geothermal" />
      <FeedbackWidget />
    </div>
    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Geothermal Energy Systems</h2>
      <p>Geothermal heat pumps use the stable underground temperature (50-60F) to heat and cool buildings at 300-500% efficiency. Vertical loops need 150-200 ft of bore per ton. The 30% federal tax credit significantly reduces installation costs. Systems last 25-50 years.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcGeo() {
      const sqft = parseFloat((document.getElementById('gt-sqft') as HTMLInputElement).value) || 2500;
      const heatLoad = parseFloat((document.getElementById('gt-heat') as HTMLInputElement).value) || 60000;
      const coolLoad = parseFloat((document.getElementById('gt-cool') as HTMLInputElement).value) || 48000;
      const groundTemp = parseFloat((document.getElementById('gt-temp') as HTMLInputElement).value) || 55;
      const loopType = (document.getElementById('gt-loop') as HTMLSelectElement).value;
      const currentCost = parseFloat((document.getElementById('gt-current') as HTMLInputElement).value) || 3500;
      const elecRate = parseFloat((document.getElementById('gt-elec') as HTMLInputElement).value) || 0.13;
      // System size based on max of heating/cooling loads
      const maxLoad = Math.max(heatLoad, coolLoad);
      const tons = maxLoad / 12000;
      // Loop length per ton by type
      const loopPerTon: Record<string, number> = { horizontal: 500, vertical: 175, pond: 300 };
      const loopLength = Math.round(tons * (loopPerTon[loopType] || 175));
      // Installation cost per ton by type
      const costPerTon: Record<string, number> = { horizontal: 4000, vertical: 6000, pond: 4500 };
      const installCost = Math.round(tons * (costPerTon[loopType] || 6000));
      const afterCredit = Math.round(installCost * 0.70); // 30% federal tax credit
      // Geothermal COP ~4.0 average
      const cop = 4.0;
      // Annual energy: approximate heating degree hours + cooling
      // Simplified: total BTU / COP / 3412 = kWh
      const annualBTU = (heatLoad * 1500 + coolLoad * 800); // rough annual hours
      const annualKWh = annualBTU / cop / 3412;
      const annualOpCost = Math.round(annualKWh * elecRate);
      const annualSavings = Math.max(0, currentCost - annualOpCost);
      const payback = annualSavings > 0 ? (afterCredit / annualSavings) : 99;
      document.getElementById('gt-tons')!.textContent = tons.toFixed(1);
      document.getElementById('gt-length')!.textContent = loopLength.toLocaleString() + ' ft';
      document.getElementById('gt-install')!.textContent = '$' + installCost.toLocaleString();
      document.getElementById('gt-savings')!.textContent = '$' + annualSavings.toLocaleString();
      document.getElementById('gt-payback')!.textContent = payback.toFixed(1) + ' yrs';
      document.getElementById('gt-credit')!.textContent = '$' + afterCredit.toLocaleString();
      document.getElementById('gt-opcost')!.textContent = '$' + annualOpCost.toLocaleString();
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => { document.querySelectorAll('.gt-in').forEach(el => { el.addEventListener('input', calcGeo); el.addEventListener('change', calcGeo); }); calcGeo(); }, 50);
  </script>
</CalculatorLayout>
