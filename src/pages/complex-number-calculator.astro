---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Complex Number Calculator";
const description = "Perform arithmetic with complex numbers: add, subtract, multiply, divide, and convert between rectangular and polar forms.";
const relatedCalcs = [
  { name: "Matrix Calculator", url: "/matrix-calculator", description: "Matrix." },
  { name: "Vector Calculator", url: "/vector-calculator", description: "Vector." },
  { name: "Quadratic Equation", url: "/quadratic-equation-calculator", description: "Quadratic." },
  { name: "Square Root", url: "/square-root-calculator", description: "Square root." },
  { name: "Degrees ↔ Radians", url: "/degrees-radians-converter", description: "Angles." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Scientific." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Complex Number Calculator" keywords="complex number calculator, imaginary number, polar form, complex arithmetic, i, real imaginary" breadcrumbs={[{ name: "Complex Numbers", url: "/complex-number-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Complex Number Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Add, subtract, multiply, divide complex numbers (a + bi).</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Z₁ = a + bi</h3>
          <div class="flex gap-2 items-center">
            <input type="number" id="cn-a1" class="cn-in flex-1 px-3 py-2 border border-border rounded-xl text-lg font-bold text-center" value="3" step="0.1">
            <span class="font-bold">+</span>
            <input type="number" id="cn-b1" class="cn-in flex-1 px-3 py-2 border border-border rounded-xl text-lg font-bold text-center" value="4" step="0.1">
            <span class="font-bold text-primary">i</span>
          </div>
        </div>
        <div class="flex gap-2">
          <button class="cn-op flex-1 py-2 rounded-xl font-bold text-sm border-2 border-primary bg-blue-50 text-primary" data-op="+">Add</button>
          <button class="cn-op flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-op="-">Subtract</button>
          <button class="cn-op flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-op="*">Multiply</button>
          <button class="cn-op flex-1 py-2 rounded-xl font-bold text-sm border-2 border-border text-text-muted" data-op="/">Divide</button>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Z₂ = c + di</h3>
          <div class="flex gap-2 items-center">
            <input type="number" id="cn-a2" class="cn-in flex-1 px-3 py-2 border border-border rounded-xl text-lg font-bold text-center" value="1" step="0.1">
            <span class="font-bold">+</span>
            <input type="number" id="cn-b2" class="cn-in flex-1 px-3 py-2 border border-border rounded-xl text-lg font-bold text-center" value="-2" step="0.1">
            <span class="font-bold text-primary">i</span>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Result</div>
          <div class="text-4xl font-extrabold font-mono" id="cn-result">0 + 0i</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">|Z₁| Magnitude</div><div class="text-xl font-bold font-mono" id="cn-mag1">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">|Z₂| Magnitude</div><div class="text-xl font-bold font-mono" id="cn-mag2">0</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Z₁ Polar</div><div class="text-lg font-bold font-mono" id="cn-pol1">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Z₂ Polar</div><div class="text-lg font-bold font-mono" id="cn-pol2">0</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Z₁ Conjugate</div><div class="text-lg font-bold font-mono" id="cn-conj1">0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">|Result|</div><div class="text-lg font-bold font-mono" id="cn-magR">0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="complex-number" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    let cnOp = '+';
    function fmtC(r: number, i: number): string {
      if (i === 0) return r.toFixed(2);
      const sign = i >= 0 ? '+' : '-';
      return `${r.toFixed(2)} ${sign} ${Math.abs(i).toFixed(2)}i`;
    }
    function toPolar(r: number, i: number): string {
      const mag = Math.sqrt(r * r + i * i);
      const angle = Math.atan2(i, r) * 180 / Math.PI;
      return `${mag.toFixed(2)}∠${angle.toFixed(1)}°`;
    }
    function calcCN() {
      const a1 = parseFloat((document.getElementById('cn-a1') as HTMLInputElement).value) || 0;
      const b1 = parseFloat((document.getElementById('cn-b1') as HTMLInputElement).value) || 0;
      const a2 = parseFloat((document.getElementById('cn-a2') as HTMLInputElement).value) || 0;
      const b2 = parseFloat((document.getElementById('cn-b2') as HTMLInputElement).value) || 0;
      let rr = 0, ri = 0;
      if (cnOp === '+') { rr = a1 + a2; ri = b1 + b2; }
      else if (cnOp === '-') { rr = a1 - a2; ri = b1 - b2; }
      else if (cnOp === '*') { rr = a1 * a2 - b1 * b2; ri = a1 * b2 + b1 * a2; }
      else if (cnOp === '/') {
        const d = a2 * a2 + b2 * b2;
        if (d > 0) { rr = (a1 * a2 + b1 * b2) / d; ri = (b1 * a2 - a1 * b2) / d; }
      }
      document.getElementById('cn-result')!.textContent = fmtC(rr, ri);
      document.getElementById('cn-mag1')!.textContent = Math.sqrt(a1 * a1 + b1 * b1).toFixed(4);
      document.getElementById('cn-mag2')!.textContent = Math.sqrt(a2 * a2 + b2 * b2).toFixed(4);
      document.getElementById('cn-pol1')!.textContent = toPolar(a1, b1);
      document.getElementById('cn-pol2')!.textContent = toPolar(a2, b2);
      document.getElementById('cn-conj1')!.textContent = fmtC(a1, -b1);
      document.getElementById('cn-magR')!.textContent = Math.sqrt(rr * rr + ri * ri).toFixed(4);
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.cn-op').forEach(b => b.addEventListener('click', () => {
        cnOp = (b as HTMLButtonElement).dataset.op!;
        document.querySelectorAll('.cn-op').forEach(btn => {
          const active = (btn as HTMLButtonElement).dataset.op === cnOp;
          (btn as HTMLButtonElement).className = `cn-op flex-1 py-2 rounded-xl font-bold text-sm border-2 ${active ? 'border-primary bg-blue-50 text-primary' : 'border-border text-text-muted'}`;
        });
        calcCN();
      }));
      document.querySelectorAll('.cn-in').forEach(el => { el.addEventListener('input', calcCN); el.addEventListener('change', calcCN); });
      calcCN();
    }, 50);
  </script>
</CalculatorLayout>
