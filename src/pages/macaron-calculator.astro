---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Macaron Calculator - Recipe Ratios by Count";
const description = "Calculate precise macaron recipe amounts by desired count. Get exact ratios of almond flour, powdered sugar, and egg whites for French or Italian method.";
const relatedCalcs = [
  { name: "Pastry Cream Calculator", url: "/pastry-cream-calculator", description: "Scale pastry cream for filling." },
  { name: "Chocolate Tempering Calculator", url: "/chocolate-tempering-calculator", description: "Chocolate tempering for ganache filling." },
  { name: "Frosting Calculator", url: "/frosting-calculator", description: "Buttercream filling quantities." },
  { name: "Baker's Percentage Calculator", url: "/baker-percentage-calculator", description: "Baker's percentages for recipes." },
  { name: "Baking Conversion Calculator", url: "/baking-conversion-calculator", description: "Convert between baking units." },
  { name: "Cookie Batch Calculator", url: "/cookie-batch-calculator", description: "Scale cookie recipes by count." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Macaron Calculator" keywords="macaron recipe, macaron ratio, almond flour macarons, french macaron, italian macaron, macaron scaling" breadcrumbs={[{ name: "Macaron", url: "/macaron-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Macaron Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate exact ingredient amounts for macarons by your desired count. Supports both French and Italian meringue methods.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Desired Macaron Count</label>
            <input type="number" id="mac-count" class="mac-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="24" min="6" step="6">
            <p class="text-xs text-text-muted mt-1">Sandwiched pairs</p>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Shell Size</label>
            <select id="mac-size" class="mac-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="small">Small (1.25" / 3cm)</option>
              <option value="medium" selected>Standard (1.5" / 4cm)</option>
              <option value="large">Large (2" / 5cm)</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Method</label>
          <select id="mac-method" class="mac-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="french">French Method (simpler)</option>
            <option value="italian">Italian Method (more stable)</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-text mb-1">Filling Type</label>
          <select id="mac-filling" class="mac-in w-full px-4 py-3 border border-border rounded-xl text-lg">
            <option value="ganache">Chocolate Ganache</option>
            <option value="buttercream">Buttercream</option>
            <option value="curd">Fruit Curd</option>
            <option value="jam">Jam / Preserves</option>
          </select>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Total Shells to Pipe</div>
          <div class="text-5xl font-extrabold font-mono" id="mac-result">--</div>
        </div>
        <h3 class="font-bold text-text text-sm uppercase tracking-wide">Shell Ingredients</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Almond Flour</div>
            <div class="text-xl font-bold font-mono" id="mac-almond">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Powdered Sugar</div>
            <div class="text-xl font-bold font-mono" id="mac-psugar">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Egg Whites</div>
            <div class="text-xl font-bold font-mono" id="mac-whites">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Granulated Sugar</div>
            <div class="text-xl font-bold font-mono" id="mac-gsugar">--</div>
          </div>
        </div>
        <h3 class="font-bold text-text text-sm uppercase tracking-wide">Filling</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Filling Amount</div>
            <div class="text-xl font-bold font-mono" id="mac-fill-amt">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Baking Temp</div>
            <div class="text-xl font-bold font-mono" id="mac-temp">--</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="macaron" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcMAC() {
      const count = parseFloat((document.getElementById('mac-count') as HTMLInputElement).value) || 24;
      const size = (document.getElementById('mac-size') as HTMLSelectElement).value;
      const method = (document.getElementById('mac-method') as HTMLSelectElement).value;
      const filling = (document.getElementById('mac-filling') as HTMLSelectElement).value;

      const shells = count * 2; // 2 shells per macaron sandwich
      // Add ~10% extra for breakage
      const shellsWithExtra = Math.ceil(shells * 1.1);

      // Base recipe for ~24 shells (12 macarons) using French method:
      // 75g almond flour, 75g powdered sugar, 55g egg whites (about 2), 50g granulated sugar
      // Scale factor per shell
      const baseShells = 24;

      // Size multiplier: small = 0.7, medium = 1.0, large = 1.6
      const sizeMult: Record<string, number> = { small: 0.7, medium: 1.0, large: 1.6 };
      const mult = sizeMult[size];

      const scale = (shellsWithExtra / baseShells) * mult;

      const almondG = 75 * scale;
      const psugarG = 75 * scale;
      const eggWhiteG = 55 * scale;
      const gsugarG = 50 * scale;

      const eggCount = eggWhiteG / 30; // ~30g per egg white

      // For Italian method: sugar syrup portion is different
      let gsugarDisplay = '';
      if (method === 'italian') {
        const syrupSugar = gsugarG * 0.7;
        const meringeSugar = gsugarG * 0.3;
        gsugarDisplay = gsugarG.toFixed(0) + ' g total (' + syrupSugar.toFixed(0) + 'g for syrup + ' + meringeSugar.toFixed(0) + 'g for meringue)';
      } else {
        gsugarDisplay = gsugarG.toFixed(0) + ' g';
      }

      // Filling amount: ~5-8g per macaron depending on size
      const fillPerMac: Record<string, number> = { small: 4, medium: 6, large: 10 };
      const totalFillG = count * fillPerMac[size];

      let fillDesc = '';
      if (filling === 'ganache') fillDesc = totalFillG.toFixed(0) + 'g (' + (totalFillG * 0.5).toFixed(0) + 'g chocolate + ' + (totalFillG * 0.5).toFixed(0) + 'g cream)';
      else if (filling === 'buttercream') fillDesc = totalFillG.toFixed(0) + 'g (' + (totalFillG * 0.4).toFixed(0) + 'g butter + ' + (totalFillG * 0.6).toFixed(0) + 'g powdered sugar)';
      else if (filling === 'curd') fillDesc = totalFillG.toFixed(0) + 'g fruit curd';
      else fillDesc = totalFillG.toFixed(0) + 'g jam';

      document.getElementById('mac-result')!.textContent = shellsWithExtra + ' shells (incl. extras)';
      document.getElementById('mac-almond')!.textContent = almondG.toFixed(0) + ' g';
      document.getElementById('mac-psugar')!.textContent = psugarG.toFixed(0) + ' g';
      document.getElementById('mac-whites')!.textContent = eggWhiteG.toFixed(0) + ' g (~' + Math.ceil(eggCount) + ' whites)';
      document.getElementById('mac-gsugar')!.textContent = gsugarDisplay;
      document.getElementById('mac-fill-amt')!.textContent = fillDesc;
      document.getElementById('mac-temp')!.textContent = '300-325\u00B0F / 150-163\u00B0C, 14-18 min';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.mac-in').forEach(el => { el.addEventListener('input', calcMAC); el.addEventListener('change', calcMAC); });
      calcMAC();
    }, 50);
  </script>
</CalculatorLayout>
