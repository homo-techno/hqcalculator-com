---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Sourdough Calculator - Bread Dough Ratios & Weights";
const description = "Calculate flour, water, starter, and salt amounts for sourdough bread based on target dough weight, hydration, and starter percentage.";
const relatedCalcs = [
  { name: "Baking Conversion", url: "/baking-conversion-calculator", description: "Convert baking measurements." },
  { name: "Yeast Calculator", url: "/yeast-calculator", description: "Convert between yeast types." },
  { name: "Coffee Ratio Calculator", url: "/coffee-ratio-calculator", description: "Perfect coffee-to-water ratios." },
  { name: "Meal Prep Calculator", url: "/meal-prep-calculator", description: "Plan weekly meal prep." },
  { name: "Food Cost Calculator", url: "/food-cost-calculator", description: "Restaurant food cost analysis." },
  { name: "Canning Calculator", url: "/canning-calculator", description: "Canning jar needs." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Sourdough Calculator" keywords="sourdough calculator, sourdough bread recipe, baker's percentage, hydration percentage, sourdough starter, bread dough weight" breadcrumbs={[{ name: "Sourdough", url: "/sourdough-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Sourdough Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate ingredient weights for sourdough bread based on your target dough weight and ratios.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Target Dough Weight (g)</label>
            <input type="number" id="so-weight" class="so-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="900" min="100" step="10">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Number of Loaves</label>
            <input type="number" id="so-loaves" class="so-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="1" step="1">
          </div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Hydration (%)</label>
            <input type="number" id="so-hydration" class="so-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="75" min="50" max="100" step="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Starter (%)</label>
            <input type="number" id="so-starter" class="so-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="20" min="5" max="50" step="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Salt (%)</label>
            <input type="number" id="so-salt" class="so-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="2" min="0" max="5" step="0.1">
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Flour</div>
          <div class="text-5xl font-extrabold font-mono" id="so-result">0 g</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Water</div><div class="text-xl font-bold font-mono" id="so-water">0 g</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Starter</div><div class="text-xl font-bold font-mono" id="so-starteramt">0 g</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Salt</div><div class="text-xl font-bold font-mono" id="so-saltamt">0 g</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Total Dough</div><div class="text-xl font-bold font-mono" id="so-total">0 g</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">True Hydration</div><div class="text-xl font-bold font-mono" id="so-truehydr">0%</div></div>
        </div>
      </div>
      <ShareButton calculatorId="sourdough" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcSO() {
      const targetWeight = parseFloat((document.getElementById('so-weight') as HTMLInputElement).value) || 0;
      const loaves = parseFloat((document.getElementById('so-loaves') as HTMLInputElement).value) || 1;
      const hydration = parseFloat((document.getElementById('so-hydration') as HTMLInputElement).value) || 75;
      const starterPct = parseFloat((document.getElementById('so-starter') as HTMLInputElement).value) || 20;
      const saltPct = parseFloat((document.getElementById('so-salt') as HTMLInputElement).value) || 2;
      const totalTarget = targetWeight * loaves;
      // Baker's percentages: flour is 100%
      // Total = flour + (flour * hydration/100) + (flour * starter/100) + (flour * salt/100)
      // Total = flour * (1 + hydration/100 + starter/100 + salt/100)
      const multiplier = 1 + hydration / 100 + starterPct / 100 + saltPct / 100;
      const flour = totalTarget / multiplier;
      const water = flour * (hydration / 100);
      const starter = flour * (starterPct / 100);
      const salt = flour * (saltPct / 100);
      const total = flour + water + starter + salt;
      // True hydration includes water from starter (assume 50% hydration starter)
      const starterWater = starter * 0.5;
      const starterFlour = starter * 0.5;
      const totalFlour = flour + starterFlour;
      const totalWater = water + starterWater;
      const trueHydration = totalFlour > 0 ? (totalWater / totalFlour) * 100 : 0;
      document.getElementById('so-result')!.textContent = Math.round(flour) + ' g';
      document.getElementById('so-water')!.textContent = Math.round(water) + ' g';
      document.getElementById('so-starteramt')!.textContent = Math.round(starter) + ' g';
      document.getElementById('so-saltamt')!.textContent = salt.toFixed(1) + ' g';
      document.getElementById('so-total')!.textContent = Math.round(total) + ' g';
      document.getElementById('so-truehydr')!.textContent = trueHydration.toFixed(1) + '%';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.so-in').forEach(el => { el.addEventListener('input', calcSO); el.addEventListener('change', calcSO); });
      calcSO();
    }, 50);
  </script>
</CalculatorLayout>
