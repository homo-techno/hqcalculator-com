---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Upholstery Calculator - Fabric & Foam";
const description = "Calculate fabric yardage for furniture reupholstery by type, pattern repeat allowance, and foam thickness requirements.";
const relatedCalcs = [
  { name: "Fabric Calculator", url: "/fabric-calculator", description: "Fabric yardage." },
  { name: "Carpet Calculator", url: "/carpet-calculator", description: "Carpet coverage." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Budget planning." },
  { name: "Area Calculator", url: "/area-calculator", description: "Area calculations." },
  { name: "Square Footage", url: "/square-footage-calculator", description: "Square footage." },
  { name: "Unit Price", url: "/unit-price-calculator", description: "Unit pricing." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Upholstery Calculator" keywords="upholstery calculator, fabric yardage, reupholster, furniture fabric, foam thickness, pattern repeat" breadcrumbs={[{ name: "Upholstery", url: "/upholstery-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Upholstery Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Calculate fabric yardage, foam, and material needs for furniture reupholstery projects.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Furniture Type</label>
          <select id="up-type" class="up-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="dining" selected>Dining Chair</option>
            <option value="armchair">Armchair</option>
            <option value="loveseat">Loveseat</option>
            <option value="sofa3">3-Seat Sofa</option>
            <option value="ottoman">Ottoman</option>
            <option value="bench">Bench / Window Seat</option>
            <option value="headboard">Headboard</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Fabric Width</label>
            <select id="up-fw" class="up-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="48">48 inches</option>
              <option value="54" selected>54 inches</option>
              <option value="60">60 inches</option>
            </select>
          </div>
          <div><label class="block text-xs font-medium text-text mb-1">Pattern Repeat (inches)</label><input type="number" id="up-pr" class="up-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="0" min="0" max="36" step="0.5"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Fabric Price ($/yard)</label><input type="number" id="up-fp" class="up-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="25" min="0" step="1"></div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Foam Thickness</label>
            <select id="up-foam" class="up-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
              <option value="1">1 inch</option>
              <option value="2" selected>2 inches</option>
              <option value="3">3 inches</option>
              <option value="4">4 inches</option>
              <option value="5">5 inches</option>
            </select>
          </div>
        </div>
        <div><label class="block text-xs font-medium text-text mb-1">Quantity</label><input type="number" id="up-qty" class="up-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="1" min="1" max="20" step="1"></div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Fabric Needed</div>
          <div class="text-4xl font-extrabold font-mono" id="up-result">0 yards</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Pattern Extra</div><div class="text-xl font-bold font-mono" id="up-extra">0 yd</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Foam Area</div><div class="text-xl font-bold font-mono" id="up-foama">0 sq ft</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Fabric Cost</div><div class="text-xl font-bold font-mono" id="up-cost">$0</div></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Welt Cord</div><div class="text-xl font-bold font-mono" id="up-welt">0 yd</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Staples (approx)</div><div class="text-xl font-bold font-mono" id="up-staples">0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="upholstery" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcUP() {
      const fType = (document.getElementById('up-type') as HTMLSelectElement).value;
      const fw = parseFloat((document.getElementById('up-fw') as HTMLSelectElement).value) || 54;
      const pr = parseFloat((document.getElementById('up-pr') as HTMLInputElement).value) || 0;
      const fp = parseFloat((document.getElementById('up-fp') as HTMLInputElement).value) || 0;
      const foam = parseFloat((document.getElementById('up-foam') as HTMLSelectElement).value) || 2;
      const qty = parseInt((document.getElementById('up-qty') as HTMLInputElement).value) || 1;

      // Base yardage by furniture type at 54" width
      const baseYards: Record<string, number> = {
        dining: 1.5, armchair: 6, loveseat: 10, sofa3: 14,
        ottoman: 2.5, bench: 3, headboard: 4
      };
      // Foam area (sq ft) by type
      const foamArea: Record<string, number> = {
        dining: 2.5, armchair: 12, loveseat: 18, sofa3: 24,
        ottoman: 6, bench: 8, headboard: 15
      };
      // Welt/piping yards by type
      const weltYards: Record<string, number> = {
        dining: 2, armchair: 12, loveseat: 16, sofa3: 22,
        ottoman: 5, bench: 6, headboard: 10
      };

      let baseYd = baseYards[fType] || 6;
      // Adjust for fabric width (base is 54")
      baseYd = baseYd * (54 / fw);

      // Pattern repeat adds extra: for each cut piece, round up to next repeat
      let patternExtraYd = 0;
      if (pr > 0) {
        const repeatYd = pr / 36;
        const approxPieces = Math.ceil(baseYd / 1.5);
        patternExtraYd = approxPieces * repeatYd * 0.5;
      }

      const totalYdPer = Math.ceil((baseYd + patternExtraYd) * 4) / 4;
      const totalYd = totalYdPer * qty;
      const foamSqFt = (foamArea[fType] || 6) * qty;
      const fabricCost = totalYd * fp;
      const welt = (weltYards[fType] || 6) * qty;

      // Staple estimate: ~3 staples per inch of perimeter
      const perimeterEstIn: Record<string, number> = {
        dining: 80, armchair: 200, loveseat: 280, sofa3: 360,
        ottoman: 120, bench: 150, headboard: 180
      };
      const staples = ((perimeterEstIn[fType] || 100) * 3) * qty;

      document.getElementById('up-result')!.textContent = totalYd.toFixed(2) + ' yards';
      document.getElementById('up-extra')!.textContent = (patternExtraYd * qty).toFixed(2) + ' yd';
      document.getElementById('up-foama')!.textContent = foamSqFt.toFixed(1) + ' sq ft';
      document.getElementById('up-cost')!.textContent = '$' + fabricCost.toFixed(2);
      document.getElementById('up-welt')!.textContent = welt.toFixed(1) + ' yd';
      document.getElementById('up-staples')!.textContent = staples.toLocaleString();
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.up-in').forEach(el => { el.addEventListener('input', calcUP); el.addEventListener('change', calcUP); });
      calcUP();
    }, 50);
  </script>
</CalculatorLayout>
