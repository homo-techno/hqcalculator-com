---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Gold Panning Calculator - Recovery Rate & Pay Per Yard";
const description = "Calculate gold recovery rate, value per cubic yard, concentration needed, and pay-per-yard threshold for recreational and small-scale gold panning.";
const relatedCalcs = [
  { name: "Percentage Calculator", url: "/percentage-calculator", description: "Percentage math." },
  { name: "Weight Converter", url: "/weight-converter", description: "Weight units." },
  { name: "Density Calculator", url: "/density-calculator", description: "Material density." },
  { name: "Gravel Calculator", url: "/gravel-calculator", description: "Material tonnage." },
  { name: "Volume Calculator", url: "/volume-calculator", description: "Volume shapes." },
  { name: "Excavation Calculator", url: "/excavation-calculator", description: "Earthwork volumes." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Gold Panning Calculator" keywords="gold panning, gold recovery, value per yard, pay dirt, gold prospecting, placer gold" breadcrumbs={[{ name: "Gold Panning", url: "/gold-panning-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Gold Panning Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate gold recovery, value per cubic yard, and determine if a placer deposit is worth working based on gold concentration and costs.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Gold Price ($/troy oz)</label>
            <input type="number" id="gp-price" class="gp-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="2000" min="0" step="10">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Gold per Yard (mg)</label>
            <input type="number" id="gp-mgyard" class="gp-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="150" min="0" step="10">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Yards Processed per Day</label>
            <input type="number" id="gp-yards" class="gp-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="3" min="0" step="0.5">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Recovery Rate (%)</label>
            <input type="number" id="gp-recovery" class="gp-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="60" min="0" max="100" step="5">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Equipment Method</label>
            <select id="gp-method" class="gp-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="pan">Gold Pan (slow, low cost)</option>
              <option value="sluice" selected>Sluice Box (moderate)</option>
              <option value="trommel">Trommel/Highbanker (fast)</option>
              <option value="dredge">Suction Dredge (highest)</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Operating Cost ($/day)</label>
            <input type="number" id="gp-cost" class="gp-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="30" min="0" step="5">
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-text mb-1">Days of Operation</label>
          <input type="number" id="gp-days" class="gp-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="30" min="1" step="1">
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Daily Gold Value</div>
          <div class="text-4xl font-extrabold" id="gp-daily">$0</div>
          <div class="text-sm text-blue-200 mt-1" id="gp-dailygrams">0 grams/day</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Value per Yard</div>
            <div class="text-xl font-bold text-secondary" id="gp-peryard">$0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Net Daily Profit</div>
            <div class="text-xl font-bold" id="gp-profit">$0</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Gold Recovered</div>
            <div class="text-xl font-bold" id="gp-totalgold">0 g</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Value</div>
            <div class="text-xl font-bold" id="gp-totalval">$0</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Net Profit</div>
            <div class="text-xl font-bold" id="gp-totalprofit">$0</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Breakeven (mg/yd)</div>
            <div class="text-xl font-bold" id="gp-breakeven">0</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Assessment</div>
          <div class="text-sm font-bold" id="gp-assess">--</div>
        </div>
      </div>

      <ShareButton calculatorId="gold-panning" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Gold Panning Economics</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Gold Recovered/Day</strong> = (mg/yard x yards/day x recovery%) / 1000 grams</p>
        <p><strong>Value/Day</strong> = Grams x (Price per troy oz / 31.1035)</p>
        <p><strong>1 troy oz</strong> = 31.1035 grams</p>
        <p><strong>Breakeven</strong> = (Daily Cost x 1000) / (Yards x Recovery x Price/gram)</p>
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcGP() {
      const price = parseFloat((document.getElementById('gp-price') as HTMLInputElement).value) || 0;
      const mgYard = parseFloat((document.getElementById('gp-mgyard') as HTMLInputElement).value) || 0;
      const yards = parseFloat((document.getElementById('gp-yards') as HTMLInputElement).value) || 0;
      const recovery = (parseFloat((document.getElementById('gp-recovery') as HTMLInputElement).value) || 0) / 100;
      const cost = parseFloat((document.getElementById('gp-cost') as HTMLInputElement).value) || 0;
      const days = parseFloat((document.getElementById('gp-days') as HTMLInputElement).value) || 0;

      const pricePerGram = price / 31.1035;
      const goldPerDayMg = mgYard * yards * recovery;
      const goldPerDayG = goldPerDayMg / 1000;
      const dailyValue = goldPerDayG * pricePerGram;
      const valuePerYard = yards > 0 ? dailyValue / yards : 0;
      const dailyProfit = dailyValue - cost;

      const totalGold = goldPerDayG * days;
      const totalValue = dailyValue * days;
      const totalCost = cost * days;
      const totalProfit = totalValue - totalCost;

      const breakevenMg = (yards > 0 && recovery > 0 && pricePerGram > 0) ?
        (cost * 1000) / (yards * recovery * pricePerGram) : 0;

      let assess = '';
      if (dailyProfit > 100) assess = 'Excellent - highly profitable placer deposit';
      else if (dailyProfit > 30) assess = 'Good - worthwhile commercial operation';
      else if (dailyProfit > 0) assess = 'Marginal - covers costs, fun hobby income';
      else assess = 'Below breakeven - gold concentration too low for costs';

      const fmt = (n: number) => n.toLocaleString('en-US', { maximumFractionDigits: 2 });

      document.getElementById('gp-daily')!.textContent = '$' + fmt(dailyValue);
      document.getElementById('gp-dailygrams')!.textContent = goldPerDayG.toFixed(3) + ' grams/day';
      document.getElementById('gp-peryard')!.textContent = '$' + fmt(valuePerYard);
      document.getElementById('gp-profit')!.textContent = (dailyProfit >= 0 ? '$' : '-$') + fmt(Math.abs(dailyProfit));
      document.getElementById('gp-totalgold')!.textContent = fmt(totalGold) + ' g (' + (totalGold / 31.1035).toFixed(3) + ' oz)';
      document.getElementById('gp-totalval')!.textContent = '$' + fmt(totalValue);
      document.getElementById('gp-totalprofit')!.textContent = (totalProfit >= 0 ? '$' : '-$') + fmt(Math.abs(totalProfit));
      document.getElementById('gp-breakeven')!.textContent = fmt(breakevenMg) + ' mg/yd';
      document.getElementById('gp-assess')!.textContent = assess;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.gp-in').forEach(el => { el.addEventListener('input', calcGP); el.addEventListener('change', calcGP); });
      calcGP();
    }, 50);
  </script>
</CalculatorLayout>
