---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Tree Growth Calculator - Site Index & Projected Size";
const description = "Estimate tree growth by age using site index curves. Project DBH, height, and volume at rotation age with annual growth ring analysis.";
const relatedCalcs = [
  { name: "Carbon Footprint", url: "/carbon-footprint-calculator", description: "Estimate carbon emissions." },
  { name: "Growing Degree Day", url: "/growing-degree-day-calculator", description: "Track heat accumulation." },
  { name: "Volume Calculator", url: "/volume-calculator", description: "General volume calculations." },
  { name: "Harvest Date", url: "/harvest-date-calculator", description: "Estimate harvest timing." },
  { name: "Percentage Change", url: "/percentage-change-calculator", description: "Calculate percent changes." },
  { name: "Area Calculator", url: "/area-calculator", description: "Calculate area of shapes." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Tree Growth Calculator" keywords="tree growth calculator, site index, rotation age, annual growth, DBH projection, forest growth" breadcrumbs={[{ name: "Tree Growth", url: "/tree-growth-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Tree Growth Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Project tree size at any age using site index and species growth curves.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-xs font-medium text-text mb-1">Species Type</label>
          <select id="tg2-species" class="tg2-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold">
            <option value="1.0">Oak (moderate growth)</option>
            <option value="1.2">Pine (fast growth)</option>
            <option value="0.8">Walnut (slow growth)</option>
            <option value="1.1">Maple (moderate-fast)</option>
            <option value="1.5">Poplar/Cottonwood (very fast)</option>
            <option value="0.9">Spruce/Fir (slow-moderate)</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Site Index (base age 50)</label>
            <input type="number" id="tg2-si" class="tg2-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="70" min="30" max="120" step="5">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Current Age (years)</label>
            <input type="number" id="tg2-age" class="tg2-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="25" min="1" max="300" step="1">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs font-medium text-text mb-1">Target Age (years)</label>
            <input type="number" id="tg2-target" class="tg2-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="80" min="10" max="300" step="5">
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Current DBH (inches)</label>
            <input type="number" id="tg2-dbh" class="tg2-in w-full px-4 py-3 border border-border rounded-xl text-2xl font-bold" value="8" min="1" max="60" step="0.5">
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Projected Height at Target Age</div>
          <div class="text-5xl font-extrabold font-mono" id="tg2-projht">--</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Projected DBH</div>
            <div class="text-xl font-bold font-mono" id="tg2-projdbh">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Current Height</div>
            <div class="text-xl font-bold font-mono" id="tg2-curht">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Avg Ring Width</div>
            <div class="text-xl font-bold font-mono" id="tg2-ring">--</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Annual DBH Growth</div>
            <div class="text-xl font-bold font-mono" id="tg2-annual">--</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Optimal Rotation</div>
            <div class="text-xl font-bold font-mono" id="tg2-rot">--</div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="tree-growth" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcTG2() {
      const growthFactor = parseFloat((document.getElementById('tg2-species') as HTMLSelectElement).value) || 1.0;
      const si = parseFloat((document.getElementById('tg2-si') as HTMLInputElement).value) || 70;
      const age = parseFloat((document.getElementById('tg2-age') as HTMLInputElement).value) || 25;
      const targetAge = parseFloat((document.getElementById('tg2-target') as HTMLInputElement).value) || 80;
      const curDBH = parseFloat((document.getElementById('tg2-dbh') as HTMLInputElement).value) || 8;
      const curHeight = si * (1 - Math.exp(-0.03 * growthFactor * age)) / (1 - Math.exp(-0.03 * growthFactor * 50));
      const projHeight = si * (1 - Math.exp(-0.03 * growthFactor * targetAge)) / (1 - Math.exp(-0.03 * growthFactor * 50));
      const dbhGrowthRate = curDBH / age;
      const projDBH = curDBH + dbhGrowthRate * (targetAge - age) * Math.pow(age / targetAge, 0.3);
      const ringWidth = (curDBH / 2) / age;
      const optRotation = Math.round(50 * (si / 60) / growthFactor + 30);
      document.getElementById('tg2-projht')!.textContent = projHeight.toFixed(1) + ' ft';
      document.getElementById('tg2-projdbh')!.textContent = projDBH.toFixed(1) + ' in';
      document.getElementById('tg2-curht')!.textContent = curHeight.toFixed(1) + ' ft';
      document.getElementById('tg2-ring')!.textContent = (ringWidth * 25.4).toFixed(1) + ' mm';
      document.getElementById('tg2-annual')!.textContent = dbhGrowthRate.toFixed(2) + ' in/yr';
      document.getElementById('tg2-rot')!.textContent = optRotation + ' yrs';
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.tg2-in').forEach(el => { el.addEventListener('input', calcTG2); el.addEventListener('change', calcTG2); });
      calcTG2();
    }, 50);
  </script>
</CalculatorLayout>
