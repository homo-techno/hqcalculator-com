---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Generator Size Calculator - Wattage & Surge Capacity";
const description = "Calculate the right generator size based on your appliances. Compare starting vs running watts and determine the minimum surge capacity needed.";
const relatedCalcs = [
  { name: "Electrical Load", url: "/electrical-load-calculator", description: "Panel loads." },
  { name: "Electricity Cost", url: "/electricity-cost-calculator", description: "Energy costs." },
  { name: "Solar Panel", url: "/solar-panel-calculator", description: "Solar sizing." },
  { name: "Battery Life", url: "/battery-life-calculator", description: "Battery runtime." },
  { name: "HVAC", url: "/hvac-calculator", description: "HVAC sizing." },
  { name: "Wire Gauge", url: "/wire-gauge-calculator", description: "Wire sizing." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Generator Size Calculator" keywords="generator size calculator, generator wattage, starting watts, running watts, surge capacity, backup generator" breadcrumbs={[{ name: "Generator Size", url: "/generator-size-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Generator Size Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Determine the right generator wattage by listing your appliances with starting and running watts.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Select Appliances</h3>
          <div class="space-y-2" id="gn2-list">
            <div class="grid grid-cols-12 gap-1 text-xs text-text-muted font-semibold px-1">
              <div class="col-span-5">Appliance</div>
              <div class="col-span-3 text-center">Running W</div>
              <div class="col-span-3 text-center">Starting W</div>
              <div class="col-span-1 text-center">On</div>
            </div>
          </div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Generator</div>
          <div class="text-5xl font-extrabold font-mono" id="gn2-result">0 W</div>
          <div class="text-sm text-blue-200 mt-1" id="gn2-note">-</div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Total Running</div>
            <div class="text-xl font-bold font-mono" id="gn2-running">0 W</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Largest Surge</div>
            <div class="text-xl font-bold font-mono" id="gn2-surge">0 W</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Peak Demand</div>
            <div class="text-xl font-bold font-mono" id="gn2-peak">0 W</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Generator Type Suggestion</div>
          <div class="text-lg font-bold" id="gn2-type">-</div>
        </div>
      </div>
      <ShareButton calculatorId="generator-size" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    const GN2_APPLIANCES = [
      { name: 'Refrigerator', running: 200, starting: 1200 },
      { name: 'Freezer', running: 150, starting: 900 },
      { name: 'Sump Pump (1/2 HP)', running: 800, starting: 2000 },
      { name: 'Central AC (3 ton)', running: 3500, starting: 7000 },
      { name: 'Window AC (10k BTU)', running: 1200, starting: 3600 },
      { name: 'Furnace Blower', running: 800, starting: 2400 },
      { name: 'Well Pump (1/2 HP)', running: 750, starting: 2000 },
      { name: 'Microwave (1000W)', running: 1000, starting: 1000 },
      { name: 'Electric Range (1 burner)', running: 2500, starting: 2500 },
      { name: 'Lights (10 LEDs)', running: 100, starting: 100 },
      { name: 'TV / Entertainment', running: 300, starting: 300 },
      { name: 'Garage Door Opener', running: 550, starting: 1100 },
      { name: 'Electric Water Heater', running: 4500, starting: 4500 },
      { name: 'Washer', running: 500, starting: 1200 },
      { name: 'Dryer (Electric)', running: 5000, starting: 6000 },
    ];

    function buildGN2List() {
      const container = document.getElementById('gn2-list')!;
      const header = container.querySelector('.grid');
      let html = header ? header.outerHTML : '';
      GN2_APPLIANCES.forEach((app, i) => {
        html += '<div class="grid grid-cols-12 gap-1 items-center">';
        html += '<div class="col-span-5 text-xs font-medium truncate">' + app.name + '</div>';
        html += '<div class="col-span-3"><input type="number" class="gn2-in w-full px-1 py-1 border border-border rounded-lg text-sm font-bold text-center" id="gn2-r' + i + '" value="' + app.running + '" min="0"></div>';
        html += '<div class="col-span-3"><input type="number" class="gn2-in w-full px-1 py-1 border border-border rounded-lg text-sm font-bold text-center" id="gn2-s' + i + '" value="' + app.starting + '" min="0"></div>';
        html += '<div class="col-span-1 text-center"><input type="checkbox" class="gn2-in" id="gn2-c' + i + '"' + (i < 4 ? ' checked' : '') + '></div>';
        html += '</div>';
      });
      container.innerHTML = html;
    }

    function calcGN2() {
      let totalRunning = 0;
      let largestSurge = 0;
      const surges: number[] = [];

      GN2_APPLIANCES.forEach((_, i) => {
        const checked = (document.getElementById('gn2-c' + i) as HTMLInputElement)?.checked;
        if (!checked) return;
        const running = parseFloat((document.getElementById('gn2-r' + i) as HTMLInputElement).value) || 0;
        const starting = parseFloat((document.getElementById('gn2-s' + i) as HTMLInputElement).value) || 0;
        totalRunning += running;
        const surge = starting - running;
        surges.push(surge);
        if (surge > largestSurge) largestSurge = surge;
      });

      // Peak = total running + largest single surge (worst case startup)
      const peakDemand = totalRunning + largestSurge;
      // Add 20% safety margin
      const recommended = Math.ceil(peakDemand * 1.2 / 500) * 500;

      document.getElementById('gn2-running')!.textContent = totalRunning.toLocaleString() + ' W';
      document.getElementById('gn2-surge')!.textContent = largestSurge.toLocaleString() + ' W';
      document.getElementById('gn2-peak')!.textContent = peakDemand.toLocaleString() + ' W';
      document.getElementById('gn2-result')!.textContent = recommended.toLocaleString() + ' W';
      document.getElementById('gn2-note')!.textContent = (recommended / 1000).toFixed(1) + ' kW minimum with 20% safety margin';

      let genType: string;
      if (recommended <= 3500) genType = 'Portable inverter generator (quiet, fuel efficient)';
      else if (recommended <= 7500) genType = 'Portable conventional generator';
      else if (recommended <= 12000) genType = 'Large portable or small standby generator';
      else genType = 'Whole-house standby generator (automatic transfer switch)';
      document.getElementById('gn2-type')!.textContent = genType;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      buildGN2List();
      document.querySelectorAll('.gn2-in').forEach(el => {
        el.addEventListener('input', calcGN2);
        el.addEventListener('change', calcGN2);
      });
      calcGN2();
    }, 50);
  </script>
</CalculatorLayout>
