---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Tire Size Calculator - Compare Tire Sizes & Speedometer Error 2026";
const description = "Compare two tire sizes side by side. Calculate diameter, circumference, sidewall height, and speedometer difference between your original and new tires.";

const relatedCalcs = [
  { name: "Towing Capacity Calculator", url: "/towing-capacity-calculator", description: "Check towing limits." },
  { name: "Road Trip Calculator", url: "/road-trip-calculator", description: "Plan road trip costs." },
  { name: "Car Payment Calculator", url: "/car-payment-calculator", description: "Monthly car payment." },
  { name: "Unit Converter - Weight", url: "/unit-converter-weight", description: "Convert weight units." },
  { name: "Speed Calculator", url: "/speed-calculator", description: "Speed distance time." },
  { name: "Auto Loan Calculator", url: "/auto-loan-calculator", description: "Auto loan payments." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Tire Size Calculator"
  keywords="tire size calculator, tire comparison, speedometer error, tire diameter, tire circumference, sidewall height"
  breadcrumbs={[{ name: "Tire Size Calculator", url: "/tire-size-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Tire Size Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Compare two tire sizes and see how the change affects your speedometer, diameter, and ground clearance.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <h3 class="text-lg font-bold text-text">Original Tire</h3>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label for="ts-w1" class="block text-xs font-medium text-text mb-1">Width (mm)</label>
            <input type="number" id="ts-w1" class="ts-in w-full border border-border rounded-lg px-3 py-2" value="225" min="100" max="400" step="5" />
          </div>
          <div>
            <label for="ts-a1" class="block text-xs font-medium text-text mb-1">Aspect Ratio</label>
            <input type="number" id="ts-a1" class="ts-in w-full border border-border rounded-lg px-3 py-2" value="60" min="20" max="90" step="5" />
          </div>
          <div>
            <label for="ts-r1" class="block text-xs font-medium text-text mb-1">Rim (in)</label>
            <input type="number" id="ts-r1" class="ts-in w-full border border-border rounded-lg px-3 py-2" value="16" min="12" max="26" step="1" />
          </div>
        </div>

        <h3 class="text-lg font-bold text-text">New Tire</h3>
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label for="ts-w2" class="block text-xs font-medium text-text mb-1">Width (mm)</label>
            <input type="number" id="ts-w2" class="ts-in w-full border border-border rounded-lg px-3 py-2" value="235" min="100" max="400" step="5" />
          </div>
          <div>
            <label for="ts-a2" class="block text-xs font-medium text-text mb-1">Aspect Ratio</label>
            <input type="number" id="ts-a2" class="ts-in w-full border border-border rounded-lg px-3 py-2" value="55" min="20" max="90" step="5" />
          </div>
          <div>
            <label for="ts-r2" class="block text-xs font-medium text-text mb-1">Rim (in)</label>
            <input type="number" id="ts-r2" class="ts-in w-full border border-border rounded-lg px-3 py-2" value="17" min="12" max="26" step="1" />
          </div>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Speedometer Difference</div>
          <div class="text-5xl font-extrabold font-mono" id="ts-result">0%</div>
          <div class="text-sm text-blue-200 mt-1" id="ts-speedo-note">At 60 mph, speedo reads 60 mph</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Original Diameter</div>
            <div class="text-xl font-bold" id="ts-dia1">0 in</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">New Diameter</div>
            <div class="text-xl font-bold" id="ts-dia2">0 in</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Original Circumference</div>
            <div class="text-xl font-bold" id="ts-circ1">0 in</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">New Circumference</div>
            <div class="text-xl font-bold" id="ts-circ2">0 in</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Original Sidewall</div>
            <div class="text-xl font-bold" id="ts-sw1">0 mm</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">New Sidewall</div>
            <div class="text-xl font-bold" id="ts-sw2">0 mm</div>
          </div>
        </div>
      </div>

      <ShareButton calculatorId="tire-size" />
      <FeedbackWidget />
    </div>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcTS() {
      const w1 = parseFloat((document.getElementById('ts-w1') as HTMLInputElement).value) || 0;
      const a1 = parseFloat((document.getElementById('ts-a1') as HTMLInputElement).value) || 0;
      const r1 = parseFloat((document.getElementById('ts-r1') as HTMLInputElement).value) || 0;
      const w2 = parseFloat((document.getElementById('ts-w2') as HTMLInputElement).value) || 0;
      const a2 = parseFloat((document.getElementById('ts-a2') as HTMLInputElement).value) || 0;
      const r2 = parseFloat((document.getElementById('ts-r2') as HTMLInputElement).value) || 0;

      // Sidewall height in mm
      const sw1 = w1 * (a1 / 100);
      const sw2 = w2 * (a2 / 100);

      // Total diameter in inches (sidewall * 2 + rim)
      const dia1 = (sw1 * 2 / 25.4) + r1;
      const dia2 = (sw2 * 2 / 25.4) + r2;

      // Circumference in inches
      const circ1 = dia1 * Math.PI;
      const circ2 = dia2 * Math.PI;

      // Speedometer difference: if new tire is larger, actual speed is higher than displayed
      const speedoDiff = dia1 > 0 ? ((dia2 - dia1) / dia1) * 100 : 0;
      const actualAt60 = 60 * (dia2 / dia1);

      (document.getElementById('ts-result') as HTMLElement).textContent = (speedoDiff >= 0 ? '+' : '') + speedoDiff.toFixed(1) + '%';
      (document.getElementById('ts-speedo-note') as HTMLElement).textContent =
        `At 60 mph indicated, actual speed is ${actualAt60.toFixed(1)} mph`;
      (document.getElementById('ts-dia1') as HTMLElement).textContent = dia1.toFixed(2) + ' in';
      (document.getElementById('ts-dia2') as HTMLElement).textContent = dia2.toFixed(2) + ' in';
      (document.getElementById('ts-circ1') as HTMLElement).textContent = circ1.toFixed(1) + ' in';
      (document.getElementById('ts-circ2') as HTMLElement).textContent = circ2.toFixed(1) + ' in';
      (document.getElementById('ts-sw1') as HTMLElement).textContent = sw1.toFixed(1) + ' mm';
      (document.getElementById('ts-sw2') as HTMLElement).textContent = sw2.toFixed(1) + ' mm';

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.ts-in').forEach(el => {
        el.addEventListener('input', calcTS);
        el.addEventListener('change', calcTS);
      });
      calcTS();
    }, 50);
  </script>
</CalculatorLayout>
