---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Closing Cost Calculator - Home Buying Closing Costs";
const description = "Estimate home closing costs including origination fees, title insurance, appraisal, and other fees.";
const relatedCalcs = [
  { name: "Mortgage Calculator", url: "/mortgage-calculator", description: "Mortgage." },
  { name: "Down Payment", url: "/down-payment-calculator", description: "Down payment." },
  { name: "Escrow Calculator", url: "/escrow-calculator", description: "Escrow." },
  { name: "Property Tax", url: "/property-tax-calculator", description: "Property tax." },
  { name: "HELOC Calculator", url: "/heloc-calculator", description: "HELOC." },
  { name: "Rent vs Buy", url: "/rent-vs-buy-calculator", description: "Rent vs buy." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Closing Cost Calculator" keywords="closing cost calculator, home closing costs, buyer closing costs, title insurance, origination fee" breadcrumbs={[{ name: "Closing Costs", url: "/closing-cost-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Closing Cost Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Estimate your total closing costs when buying a home.</p>
    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="block text-xs font-medium text-text mb-1">Home Price ($)</label><input type="number" id="cc-price" class="cc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="350000" min="0" step="5000"></div>
          <div><label class="block text-xs font-medium text-text mb-1">Loan Amount ($)</label><input type="number" id="cc-loan" class="cc-in w-full px-4 py-3 border border-border rounded-xl text-lg font-bold" value="280000" min="0" step="5000"></div>
        </div>
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Estimated Closing Costs</div>
          <div class="text-4xl font-extrabold font-mono" id="cc-total">$0</div>
          <div class="text-sm text-blue-200 mt-1" id="cc-pct">0% of home price</div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-3">Cost Breakdown</h3>
          <div class="space-y-2 text-sm" id="cc-items"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Cash to Close</div><div class="text-xl font-bold" id="cc-cash">$0</div></div>
          <div class="p-4 bg-surface-alt rounded-xl text-center"><div class="text-xs text-text-muted uppercase">Down Payment</div><div class="text-xl font-bold" id="cc-down">$0</div></div>
        </div>
      </div>
      <ShareButton calculatorId="closing-cost" />
      <FeedbackWidget />
    </div>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>
  <script>
    function calcCC() {
      const price = parseFloat((document.getElementById('cc-price') as HTMLInputElement).value) || 0;
      const loan = parseFloat((document.getElementById('cc-loan') as HTMLInputElement).value) || 0;
      const down = price - loan;
      const items: [string, number][] = [
        ['Origination Fee (1%)', loan * 0.01],
        ['Appraisal Fee', 500],
        ['Title Insurance', price * 0.005],
        ['Title Search', 300],
        ['Attorney Fees', 1500],
        ['Recording Fees', 250],
        ['Survey Fee', 400],
        ['Credit Report', 50],
        ['Flood Certification', 25],
        ['Tax Service Fee', 75],
        ['Prepaid Interest (15 days)', loan * 0.065 / 365 * 15],
        ['Homeowner Insurance (prepaid)', 1200],
        ['Property Tax Escrow (2 months)', price * 0.012 / 12 * 2],
      ];
      const total = items.reduce((s, [, v]) => s + v, 0);
      document.getElementById('cc-total')!.textContent = '$' + Math.round(total).toLocaleString();
      document.getElementById('cc-pct')!.textContent = (price > 0 ? (total / price * 100) : 0).toFixed(1) + '% of home price';
      document.getElementById('cc-cash')!.textContent = '$' + Math.round(down + total).toLocaleString();
      document.getElementById('cc-down')!.textContent = '$' + Math.round(down).toLocaleString();
      document.getElementById('cc-items')!.innerHTML = items.map(([name, val]) =>
        `<div class="flex justify-between"><span class="text-text-muted">${name}</span><span class="font-bold">$${Math.round(val).toLocaleString()}</span></div>`
      ).join('') + `<div class="flex justify-between border-t border-border pt-2 mt-2 font-bold"><span>Total</span><span>$${Math.round(total).toLocaleString()}</span></div>`;
      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => { document.querySelectorAll('.cc-in').forEach(el => el.addEventListener('input', calcCC)); calcCC(); }, 50);
  </script>
</CalculatorLayout>
