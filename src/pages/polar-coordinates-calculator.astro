---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Polar Coordinates Calculator - Rectangular to Polar Conversion";
const description = "Convert between rectangular (x, y) and polar (r, theta) coordinates. Shows both degrees and radians.";

const relatedCalcs = [
  { name: "Cross Product Calculator", url: "/cross-product-calculator", description: "3D vector cross product." },
  { name: "Dot Product Calculator", url: "/dot-product-calculator", description: "Vector dot product." },
  { name: "Interpolation Calculator", url: "/interpolation-calculator", description: "Linear interpolation." },
  { name: "Scientific Calculator", url: "/scientific-calculator", description: "Advanced math operations." },
  { name: "Area Calculator", url: "/area-calculator", description: "Calculate areas of shapes." },
  { name: "Arc Length Calculator", url: "/arc-length-calculator", description: "Arc length calculation." },
];
---

<CalculatorLayout
  title={title}
  description={description}
  calculatorName="Polar Coordinates Calculator"
  keywords="polar coordinates, rectangular to polar, cartesian to polar, polar to rectangular, r theta, coordinate conversion"
  breadcrumbs={[{ name: "Polar Coordinates Calculator", url: "/polar-coordinates-calculator" }]}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Polar Coordinates Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Convert between rectangular (x, y) and polar (r, &theta;) coordinate systems.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-text mb-1">Conversion Mode</label>
          <select id="pc-mode" class="pc-in w-full px-4 py-2 border border-border rounded-xl text-lg">
            <option value="r2p" selected>Rectangular &rarr; Polar</option>
            <option value="p2r">Polar &rarr; Rectangular</option>
          </select>
        </div>

        <div id="pc-rect-inputs">
          <h3 class="font-semibold text-text mb-2">Rectangular Coordinates</h3>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm font-medium text-text mb-1">x</label>
              <input type="number" id="pc-x" class="pc-in w-full px-4 py-2 border border-border rounded-xl text-lg" value="3" step="any" />
            </div>
            <div>
              <label class="block text-sm font-medium text-text mb-1">y</label>
              <input type="number" id="pc-y" class="pc-in w-full px-4 py-2 border border-border rounded-xl text-lg" value="4" step="any" />
            </div>
          </div>
        </div>

        <div id="pc-pol-inputs" class="hidden">
          <h3 class="font-semibold text-text mb-2">Polar Coordinates</h3>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm font-medium text-text mb-1">r (radius)</label>
              <input type="number" id="pc-r" class="pc-in w-full px-4 py-2 border border-border rounded-xl text-lg" value="5" step="any" />
            </div>
            <div>
              <label class="block text-sm font-medium text-text mb-1">&theta; (degrees)</label>
              <input type="number" id="pc-theta" class="pc-in w-full px-4 py-2 border border-border rounded-xl text-lg" value="53.1301" step="any" />
            </div>
          </div>
        </div>

        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1" id="pc-result-label">Polar Coordinates</div>
          <div class="text-3xl font-extrabold font-mono" id="pc-result">(r, &theta;) = (5, 53.13&deg;)</div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">r (radius)</div>
            <div class="text-xl font-bold" id="pc-out-r">5</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">&theta; (degrees)</div>
            <div class="text-xl font-bold" id="pc-out-deg">53.13&deg;</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">&theta; (radians)</div>
            <div class="text-xl font-bold" id="pc-out-rad">0.9273</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Quadrant</div>
            <div class="text-xl font-bold" id="pc-quadrant">I</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">x</div>
            <div class="text-xl font-bold" id="pc-out-x">3</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">y</div>
            <div class="text-xl font-bold" id="pc-out-y">4</div>
          </div>
        </div>

        <div class="p-4 bg-surface-alt rounded-xl">
          <h3 class="font-semibold text-sm text-text mb-2">Formulas Used</h3>
          <div class="text-sm text-text-secondary font-mono whitespace-pre-wrap" id="pc-formula"></div>
        </div>
      </div>

      <ShareButton calculatorId="polar-coordinates" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate mx-auto">
      <h2 class="text-2xl font-bold text-text">Coordinate Conversion Formulas</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Rectangular &rarr; Polar:</strong></p>
        <p>r = &radic;(x&sup2; + y&sup2;),  &theta; = atan2(y, x)</p>
        <p><strong>Polar &rarr; Rectangular:</strong></p>
        <p>x = r cos(&theta;),  y = r sin(&theta;)</p>
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcPC() {
      const mode = (document.getElementById('pc-mode') as HTMLSelectElement).value;
      const fmt = (v: number) => Number.isInteger(v) ? String(v) : v.toFixed(4);

      document.getElementById('pc-rect-inputs')!.classList.toggle('hidden', mode !== 'r2p');
      document.getElementById('pc-pol-inputs')!.classList.toggle('hidden', mode !== 'p2r');

      let x: number, y: number, r: number, thetaDeg: number, thetaRad: number;

      if (mode === 'r2p') {
        x = parseFloat((document.getElementById('pc-x') as HTMLInputElement).value) || 0;
        y = parseFloat((document.getElementById('pc-y') as HTMLInputElement).value) || 0;

        r = Math.sqrt(x * x + y * y);
        thetaRad = Math.atan2(y, x);
        thetaDeg = thetaRad * (180 / Math.PI);
        if (thetaDeg < 0) thetaDeg += 360;

        document.getElementById('pc-result-label')!.textContent = 'Polar Coordinates';
        document.getElementById('pc-result')!.innerHTML = `(r, &theta;) = (${fmt(r)}, ${fmt(thetaDeg)}&deg;)`;

        document.getElementById('pc-formula')!.textContent =
          `r = √(x² + y²) = √(${x}² + ${y}²) = √(${fmt(x * x + y * y)}) = ${fmt(r)}\nθ = atan2(y, x) = atan2(${y}, ${x}) = ${fmt(thetaRad)} rad = ${fmt(thetaDeg)}°`;

      } else {
        r = parseFloat((document.getElementById('pc-r') as HTMLInputElement).value) || 0;
        thetaDeg = parseFloat((document.getElementById('pc-theta') as HTMLInputElement).value) || 0;
        thetaRad = thetaDeg * (Math.PI / 180);

        x = r * Math.cos(thetaRad);
        y = r * Math.sin(thetaRad);

        document.getElementById('pc-result-label')!.textContent = 'Rectangular Coordinates';
        document.getElementById('pc-result')!.textContent = `(x, y) = (${fmt(x)}, ${fmt(y)})`;

        document.getElementById('pc-formula')!.textContent =
          `x = r·cos(θ) = ${r}·cos(${fmt(thetaDeg)}°) = ${fmt(x)}\ny = r·sin(θ) = ${r}·sin(${fmt(thetaDeg)}°) = ${fmt(y)}`;
      }

      document.getElementById('pc-out-r')!.textContent = fmt(r);
      document.getElementById('pc-out-deg')!.innerHTML = fmt(thetaDeg) + '&deg;';
      document.getElementById('pc-out-rad')!.textContent = fmt(thetaRad);
      document.getElementById('pc-out-x')!.textContent = fmt(x);
      document.getElementById('pc-out-y')!.textContent = fmt(y);

      // Quadrant
      let quadrant = '';
      if (x > 0 && y >= 0) quadrant = 'I';
      else if (x <= 0 && y > 0) quadrant = 'II';
      else if (x < 0 && y <= 0) quadrant = 'III';
      else if (x >= 0 && y < 0) quadrant = 'IV';
      else quadrant = 'Origin';
      document.getElementById('pc-quadrant')!.textContent = quadrant;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      document.querySelectorAll('.pc-in').forEach(el => {
        el.addEventListener('input', calcPC);
        el.addEventListener('change', calcPC);
      });
      calcPC();
    }, 50);
  </script>
</CalculatorLayout>
