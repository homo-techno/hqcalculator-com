---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';

const title = "Cost of Living Calculator - Compare Cities";
const description = "Compare the cost of living between cities. Find out how much salary you need in a new city to maintain the same lifestyle.";

const relatedCalcs = [
  { name: "Salary Calculator", url: "/salary-calculator", description: "Salary." },
  { name: "Budget Calculator", url: "/budget-calculator", description: "Budget planning." },
  { name: "Inflation Calculator", url: "/inflation-calculator", description: "Inflation." },
  { name: "Rent vs Buy", url: "/rent-vs-buy-calculator", description: "Rent or buy?" },
  { name: "Moving Cost", url: "/moving-cost-calculator", description: "Moving costs." },
  { name: "Income Tax", url: "/income-tax-calculator", description: "Income tax." },
];
---

<CalculatorLayout title={title} description={description} calculatorName="Cost of Living Calculator" keywords="cost of living calculator, compare cities, salary comparison, COL index, city comparison" breadcrumbs={[{ name: "Cost of Living", url: "/cost-of-living-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Cost of Living Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Compare costs between cities and find out what salary you'd need.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Current Salary</label>
            <div class="relative"><span class="absolute left-4 top-1/2 -translate-y-1/2 text-text-muted font-bold">$</span>
              <input type="number" id="col-salary" class="w-full pl-8 pr-4 py-3 border border-border rounded-xl text-2xl font-bold" value="75000" min="0" step="1000">
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Current City</label>
            <select id="col-from" class="w-full px-4 py-3 border border-border rounded-xl text-lg"></select>
          </div>
          <div>
            <label class="block text-xs font-medium text-text mb-1">Target City</label>
            <select id="col-to" class="w-full px-4 py-3 border border-border rounded-xl text-lg"></select>
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-6 bg-primary rounded-2xl text-white text-center">
            <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Equivalent Salary Needed</div>
            <div class="text-4xl sm:text-5xl font-extrabold" id="col-needed">$0</div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">COL Difference</div>
              <div class="text-xl font-bold text-secondary" id="col-diff">0%</div>
            </div>
            <div class="p-4 bg-surface-alt rounded-xl text-center">
              <div class="text-xs text-text-muted uppercase">Salary Difference</div>
              <div class="text-xl font-bold" id="col-sal-diff">$0</div>
            </div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl">
            <h3 class="font-semibold text-sm text-text mb-3">Category Comparison</h3>
            <div class="space-y-1 text-sm" id="col-compare"></div>
          </div>
        </div>
      </div>
      <ShareButton calculatorId="cost-of-living" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Understanding Cost of Living</h2>
      <p>Cost of living indices compare the price of goods, housing, and services between locations. A COL index of 120 means that city is 20% more expensive than the national average (100).</p>
      <p class="text-sm text-text-muted">Note: These are approximate indices for educational purposes. Actual costs vary by neighborhood and lifestyle.</p>
    </article>
    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    const fmt = (n: number) => '$' + Math.round(n).toLocaleString();

    // Approximate COL indices (100 = national avg) with category breakdowns
    const cities: Record<string, { label: string; overall: number; housing: number; food: number; transport: number; health: number }> = {
      'nyc': { label: 'New York City, NY', overall: 187, housing: 302, food: 116, transport: 131, health: 110 },
      'sf': { label: 'San Francisco, CA', overall: 179, housing: 295, food: 113, transport: 127, health: 112 },
      'la': { label: 'Los Angeles, CA', overall: 166, housing: 263, food: 107, transport: 133, health: 105 },
      'chicago': { label: 'Chicago, IL', overall: 107, housing: 107, food: 104, transport: 118, health: 100 },
      'houston': { label: 'Houston, TX', overall: 96, housing: 82, food: 96, transport: 106, health: 95 },
      'dallas': { label: 'Dallas, TX', overall: 102, housing: 95, food: 97, transport: 104, health: 98 },
      'phoenix': { label: 'Phoenix, AZ', overall: 103, housing: 103, food: 97, transport: 101, health: 95 },
      'denver': { label: 'Denver, CO', overall: 128, housing: 155, food: 103, transport: 104, health: 102 },
      'seattle': { label: 'Seattle, WA', overall: 156, housing: 222, food: 112, transport: 121, health: 108 },
      'boston': { label: 'Boston, MA', overall: 162, housing: 240, food: 110, transport: 115, health: 113 },
      'miami': { label: 'Miami, FL', overall: 128, housing: 157, food: 106, transport: 110, health: 98 },
      'dc': { label: 'Washington, DC', overall: 152, housing: 219, food: 110, transport: 116, health: 106 },
      'atlanta': { label: 'Atlanta, GA', overall: 107, housing: 106, food: 101, transport: 109, health: 100 },
      'austin': { label: 'Austin, TX', overall: 118, housing: 130, food: 99, transport: 100, health: 96 },
      'nashville': { label: 'Nashville, TN', overall: 103, housing: 104, food: 96, transport: 98, health: 93 },
      'portland': { label: 'Portland, OR', overall: 130, housing: 157, food: 105, transport: 112, health: 103 },
      'avg': { label: 'National Average', overall: 100, housing: 100, food: 100, transport: 100, health: 100 },
    };

    function populateCities() {
      const opts = Object.entries(cities).map(([k, v]) => `<option value="${k}">${v.label} (${v.overall})</option>`).join('');
      document.getElementById('col-from')!.innerHTML = opts;
      document.getElementById('col-to')!.innerHTML = opts;
      (document.getElementById('col-from') as HTMLSelectElement).value = 'chicago';
      (document.getElementById('col-to') as HTMLSelectElement).value = 'sf';
    }

    function calcCOL() {
      const salary = parseFloat((document.getElementById('col-salary') as HTMLInputElement).value) || 0;
      const from = (document.getElementById('col-from') as HTMLSelectElement).value;
      const to = (document.getElementById('col-to') as HTMLSelectElement).value;

      const fromCity = cities[from] || cities.avg;
      const toCity = cities[to] || cities.avg;

      const ratio = toCity.overall / fromCity.overall;
      const needed = salary * ratio;
      const diff = ((ratio - 1) * 100);
      const salDiff = needed - salary;

      document.getElementById('col-needed')!.textContent = fmt(needed);
      document.getElementById('col-diff')!.textContent = (diff >= 0 ? '+' : '') + diff.toFixed(1) + '%';
      document.getElementById('col-sal-diff')!.textContent = (salDiff >= 0 ? '+' : '-') + fmt(Math.abs(salDiff));

      const cats = ['housing', 'food', 'transport', 'health'] as const;
      document.getElementById('col-compare')!.innerHTML =
        '<div class="grid grid-cols-4 gap-1 font-semibold text-xs text-text-muted mb-1"><span>Category</span><span>' + fromCity.label.split(',')[0] + '</span><span>' + toCity.label.split(',')[0] + '</span><span>Diff</span></div>' +
        cats.map(cat => {
          const fv = fromCity[cat];
          const tv = toCity[cat];
          const d = ((tv / fv - 1) * 100);
          return `<div class="grid grid-cols-4 gap-1 text-xs"><span class="capitalize">${cat}</span><span>${fv}</span><span>${tv}</span><span class="${d > 0 ? 'text-red-600' : 'text-green-600'} font-semibold">${d >= 0 ? '+' : ''}${d.toFixed(0)}%</span></div>`;
        }).join('') +
        `<div class="grid grid-cols-4 gap-1 text-xs font-bold pt-1 border-t border-border mt-1"><span>Overall</span><span>${fromCity.overall}</span><span>${toCity.overall}</span><span class="${diff > 0 ? 'text-red-600' : 'text-green-600'}">${diff >= 0 ? '+' : ''}${diff.toFixed(0)}%</span></div>`;

      document.dispatchEvent(new CustomEvent('calc-update'));
    }

    setTimeout(() => {
      populateCities();
      document.getElementById('col-salary')!.addEventListener('input', calcCOL);
      ['col-from', 'col-to'].forEach(id => document.getElementById(id)!.addEventListener('change', calcCOL));
      calcCOL();
    }, 50);
  </script>
</CalculatorLayout>
