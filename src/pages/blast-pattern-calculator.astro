---
import CalculatorLayout from '../layouts/CalculatorLayout.astro';
import ShareButton from '../components/ShareButton.astro';
import FeedbackWidget from '../components/FeedbackWidget.astro';
import RelatedCalculators from '../components/RelatedCalculators.astro';
const title = "Blast Pattern Calculator - Burden, Spacing & Powder Factor";
const description = "Calculate blast pattern burden, spacing, powder factor, explosive quantity, and fragmentation size from hole diameter and rock properties.";
const relatedCalcs = [
  { name: "Excavation Calculator", url: "/excavation-calculator", description: "Earthwork volumes." },
  { name: "Concrete Calculator", url: "/concrete-calculator", description: "Concrete volume." },
  { name: "Gravel Calculator", url: "/gravel-calculator", description: "Material tonnage." },
  { name: "Force Calculator", url: "/force-calculator", description: "Force calculations." },
  { name: "Density Calculator", url: "/density-calculator", description: "Material density." },
  { name: "Volume Calculator", url: "/volume-calculator", description: "Volume shapes." },
];
---
<CalculatorLayout title={title} description={description} calculatorName="Blast Pattern Calculator" keywords="blast pattern, burden, spacing, powder factor, explosive quantity, fragmentation, mining blasting" breadcrumbs={[{ name: "Blast Pattern", url: "/blast-pattern-calculator" }]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-text mb-2">Blast Pattern Calculator</h1>
    <p class="text-text-secondary mb-8 max-w-2xl">Design blast patterns with optimal burden, spacing, powder factor, and explosive loading for surface mining.</p>

    <div class="bg-white border border-border rounded-2xl shadow-sm p-6 sm:p-8 max-w-2xl mx-auto">
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Hole Diameter (mm)</label>
            <input type="number" id="bp3-diam" class="bp3-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="150" min="50" step="5">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Bench Height (m)</label>
            <input type="number" id="bp3-bench" class="bp3-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="10" min="1" step="0.5">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Rock Density (t/m³)</label>
            <input type="number" id="bp3-density" class="bp3-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="2.65" min="1" step="0.05">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Rock Type</label>
            <select id="bp3-rock" class="bp3-in w-full px-4 py-3 border border-border rounded-xl text-lg">
              <option value="soft">Soft</option>
              <option value="medium" selected>Medium</option>
              <option value="hard">Hard</option>
              <option value="veryhard">Very Hard</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Explosive Density (g/cm³)</label>
            <input type="number" id="bp3-exdens" class="bp3-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="1.15" min="0.5" step="0.05">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Subdrill (m)</label>
            <input type="number" id="bp3-sub" class="bp3-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="1.5" min="0" step="0.1">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-text mb-1">Stemming Length (m)</label>
            <input type="number" id="bp3-stem" class="bp3-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="3" min="0" step="0.1">
          </div>
          <div>
            <label class="block text-sm font-medium text-text mb-1">Explosive Cost ($/kg)</label>
            <input type="number" id="bp3-excost" class="bp3-in w-full px-4 py-3 border border-border rounded-xl text-lg" value="1.20" min="0" step="0.05">
          </div>
        </div>
      </div>

      <div class="mt-6 space-y-3">
        <div class="p-6 bg-primary rounded-2xl text-white text-center">
          <div class="text-sm text-blue-200 uppercase tracking-wide mb-1">Recommended Burden x Spacing</div>
          <div class="text-4xl font-extrabold" id="bp3-pattern">0 x 0 m</div>
          <div class="text-sm text-blue-200 mt-1">staggered pattern</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Burden</div>
            <div class="text-xl font-bold" id="bp3-burden">0 m</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Spacing</div>
            <div class="text-xl font-bold" id="bp3-spacing">0 m</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Powder Factor</div>
            <div class="text-xl font-bold" id="bp3-pf">0 kg/t</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Explosive / Hole</div>
            <div class="text-xl font-bold" id="bp3-charge">0 kg</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Hole Depth</div>
            <div class="text-xl font-bold" id="bp3-holedepth">0 m</div>
          </div>
          <div class="p-4 bg-surface-alt rounded-xl text-center">
            <div class="text-xs text-text-muted uppercase">Rock per Hole</div>
            <div class="text-xl font-bold" id="bp3-rockhole">0 t</div>
          </div>
        </div>
        <div class="p-4 bg-surface-alt rounded-xl text-center">
          <div class="text-xs text-text-muted uppercase">Explosive Cost per Tonne Rock</div>
          <div class="text-xl font-bold text-secondary" id="bp3-costton">$0</div>
        </div>
      </div>

      <ShareButton calculatorId="blast-pattern" />
      <FeedbackWidget />
    </div>

    <article class="mt-12 max-w-4xl prose prose-slate">
      <h2 class="text-2xl font-bold text-text">Blast Pattern Design</h2>
      <div class="bg-surface-alt rounded-xl p-4 my-4 font-mono text-sm space-y-1">
        <p><strong>Burden</strong> = 25-40 x Hole Diameter (adjusted for rock type)</p>
        <p><strong>Spacing</strong> = 1.15 x Burden (staggered pattern)</p>
        <p><strong>Powder Factor</strong> = Explosive per Hole / (Burden x Spacing x Bench Height x Density)</p>
      </div>
    </article>

    <RelatedCalculators calculators={relatedCalcs} />
  </div>

  <script>
    function calcBP3() {
      const rockMultipliers: Record<string, number> = { soft: 40, medium: 33, hard: 28, veryhard: 25 };
      const diam = parseFloat((document.getElementById('bp3-diam') as HTMLInputElement).value) || 0;
      const bench = parseFloat((document.getElementById('bp3-bench') as HTMLInputElement).value) || 0;
      const density = parseFloat((document.getElementById('bp3-density') as HTMLInputElement).value) || 0;
      const rock = (document.getElementById('bp3-rock') as HTMLSelectElement).value;
      const exDens = parseFloat((document.getElementById('bp3-exdens') as HTMLInputElement).value) || 0;
      const sub = parseFloat((document.getElementById('bp3-sub') as HTMLInputElement).value) || 0;
      const stem = parseFloat((document.getElementById('bp3-stem') as HTMLInputElement).value) || 0;
      const exCost = parseFloat((document.getElementById('bp3-excost') as HTMLInputElement).value) || 0;

      const mult = rockMultipliers[rock] || 33;
      const burden = (diam / 1000) * mult;
      const spacing = burden * 1.15;
      const holeDepth = bench + sub;
      const chargeLength = holeDepth - stem;
      const holeArea = Math.PI * (diam / 2000) ** 2;
      const chargeWeight = chargeLength > 0 ? holeArea * chargeLength * exDens * 1000 : 0;
      const rockPerHole = burden * spacing * bench * density;
      const powderFactor = rockPerHole > 0 ? chargeWeight / rockPerHole : 0;
      const costPerTon = rockPerHole > 0 ? (chargeWeight * exCost) / rockPerHole : 0;

      const fmt = (n: number) => n.toLocaleString('en-US', { maximumFractionDigits: 2 });

      document.getElementById('bp3-pattern')!.textContent = fmt(burden) + ' x ' + fmt(spacing) + ' m';
      document.getElementById('bp3-burden')!.textContent = fmt(burden) + ' m';
      document.getElementById('bp3-spacing')!.textContent = fmt(spacing) + ' m';
      document.getElementById('bp3-pf')!.textContent = fmt(powderFactor) + ' kg/t';
      document.getElementById('bp3-charge')!.textContent = fmt(chargeWeight) + ' kg';
      document.getElementById('bp3-holedepth')!.textContent = fmt(holeDepth) + ' m';
      document.getElementById('bp3-rockhole')!.textContent = fmt(rockPerHole) + ' t';
      document.getElementById('bp3-costton')!.textContent = '$' + fmt(costPerTon);

      document.dispatchEvent(new CustomEvent('calc-update'));
    }
    setTimeout(() => {
      document.querySelectorAll('.bp3-in').forEach(el => { el.addEventListener('input', calcBP3); el.addEventListener('change', calcBP3); });
      calcBP3();
    }, 50);
  </script>
</CalculatorLayout>
